"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2958],{80821:function(re,B,r){r.d(B,{Z:function(){return le}});var T=r(97857),i=r.n(T),x=r(5574),R=r.n(x),M=r(24963),j=r(86738),q=r(28036),_=r(83062),ee=r(67294),H=r(85893);function le(u){var ne=(0,ee.useState)(!1),G=R()(ne,2),J=G[0],W=G[1],Y=(0,ee.useContext)(M.Z),o=Y.lang,te=Y.message,C=function(){W(!0);var X=u.action();X instanceof Promise?X.then(function($){if(W(!1),$){typeof u.onSuccess=="function"&&u.onSuccess($);var V="";u.messageSuccess?typeof u.messageSuccess=="function"?V=u.messageSuccess($):V=u.messageSuccess.indexOf("notification.")==0?o(u.messageSuccess):u.messageSuccess:V=o("notification.finish"),u.asynced?te.info(V):te.success(V)}}).catch(function($){W(!1),typeof u.onError=="function"&&u.onError($)}):W(!1)};return u.confirm?(0,H.jsx)(j.Z,i()(i()({style:{width:500},title:u.confirmTitle?u.confirmTitle:o("notification.title.tip"),description:typeof u.confirm=="string"&&u.confirm.indexOf("notification.")==0?o(u.confirm):u.confirm,onConfirm:C,okText:"Yes",cancelText:"No",onOpenChange:u.confirmOnOpenChange},u.confirmProps),{},{children:(0,H.jsx)(q.ZP,{block:u.block,disabled:u.disabled,icon:!u.children&&J?void 0:u.icon,loading:J,danger:u.danger,type:u.type,children:u.children})})):(0,H.jsx)(_.Z,{title:u.tips,children:(0,H.jsx)(q.ZP,{block:u.block,style:u.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:u.disabled,icon:!u.children&&J?void 0:u.icon,loading:J,onClick:C,danger:u.danger,type:u.type,children:u.children})})}},3616:function(re,B,r){r.d(B,{Ed:function(){return R},FK:function(){return i},R_:function(){return T},ob:function(){return x}});var T=window.innerWidth<=1024?"90vw":"65vw",i="90vw",x="60vw",R="50vh"},24963:function(re,B,r){var T=r(67294),i=(0,T.createContext)({});B.Z=i},76718:function(re,B,r){r.r(B),r.d(B,{default:function(){return We}});var T=r(15009),i=r.n(T),x=r(99289),R=r.n(x),M=r(80821),j=r(68602),q=r(67255),_=r(36693),ee=r(43425),H=r(88641),le=r(90078),u=r(41482),ne=r(66309),G=r(42075),J=r(96074),W=r(25593),Y=r(83062),o=r(67294),te=r(5574),C=r.n(te),ce=r(28036),X=r(184),$=r(5966),V=r(64317),he=r(52688),ge=r(90672),ae=r(3616),t=r(85893),Re=(0,o.forwardRef)(function(b,U){var I=(0,o.useState)(!1),O=C()(I,2),Z=O[0],S=O[1],f=(0,o.useRef)();(0,o.useImperativeHandle)(U,function(){return{edit:function(n){var e;(e=f.current)===null||e===void 0||e.setFieldsValue({username:n.username}),S(!0)},show:function(){var n;(n=f.current)===null||n===void 0||n.resetFields(),S(!0)}}}),o.useEffect(function(){if(Z){var l;(l=f.current)===null||l===void 0||l.resetFields()}},[Z,f]);var a=function(){var l=R()(i()().mark(function n(){var e,c;return i()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.prev=0,m.next=3,(e=f.current)===null||e===void 0?void 0:e.validateFields();case 3:return c=m.sent,m.next=6,b.onSubmit({username:c.username,userRole:c.userRole||"member",email:c.email,userStatus:c.userStatus||"enable",securityPassword:c.securityPassword||!0});case 6:return m.abrupt("return",!0);case 9:return m.prev=9,m.t0=m.catch(0),m.abrupt("return",!1);case 12:case"end":return m.stop()}},n,null,[[0,9]])}));return function(){return l.apply(this,arguments)}}();return(0,t.jsxs)(X.a,{name:"create",title:"\u6DFB\u52A0\u7528\u6237",open:Z,onOpenChange:function(n){if(!n){var e;(e=f.current)===null||e===void 0||e.resetFields()}S(n)},drawerProps:{forceRender:!0,width:ae.R_},formRef:f,trigger:(0,t.jsx)(ce.ZP,{type:"primary",children:"\u6DFB\u52A0\u7528\u6237"}),onFinish:R()(i()().mark(function l(){return i()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},l)})),children:[(0,t.jsx)($.Z,{label:"\u7528\u6237\u540D",name:"username",required:!0,rules:[{required:!0}]}),(0,t.jsx)($.Z,{label:"\u90AE\u7BB1",name:"email",placeholder:"",rules:[{type:"email",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740"}]}),(0,t.jsx)(V.Z,{label:"\u89D2\u8272",name:"userRole",tooltip:"\u7BA1\u7406\u5458\u9ED8\u8BA4\u5177\u6709\u9664\u3010\u7CFB\u7EDF\u3011\u5916\u7684\u6240\u6709\u6743\u9650\uFF0C\u64CD\u4F5C\u5458\u9ED8\u8BA4\u6743\u9650\u4E3A\u7A7A",required:!0,fieldProps:{defaultValue:"member"},options:[{label:"\u7BA1\u7406\u5458",value:"manager"},{label:"\u64CD\u4F5C\u5458",value:"member"}]}),(0,t.jsx)(V.Z,{label:"\u72B6\u6001",name:"userStatus",fieldProps:{defaultValue:"enable"},required:!0,options:[{label:"\u542F\u7528",value:"enable"},{label:"\u7981\u7528",value:"disable"}]}),(0,t.jsx)(he.Z,{label:"\u5F3A\u5BC6\u7801",name:"securityPassword",fieldProps:{defaultChecked:!0}}),(0,t.jsx)(ge.Z,{label:"\u5907\u6CE8",name:"remark",placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",fieldProps:{rows:4}})]})}),Se=Re,pe=r(19632),oe=r.n(pe),je=r(38345),be=r(63434),Ee=r(71230),Pe=r(15746),Ce=r(84567),F=r(83403),ye=r(85265),we=r(82346),xe=(0,o.forwardRef)(function(b,U){(0,o.useImperativeHandle)(U,function(){return{show:function(g){return R()(i()().mark(function E(){var y,P,w,K,me,z,ve;return i()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return w=g.username,K=g.uri,(y=s.current)===null||y===void 0||y.resetFields(),S(w),n(K),L.next=6,(0,j.q4)({username:w});case 6:if(me=L.sent,z=(P=me.data)===null||P===void 0||(P=P.permissions)===null||P===void 0?void 0:P[K],!z){L.next=16;break}return L.next=11,(0,we.request)(z.uri,{method:"POST"});case 11:ve=L.sent,N(ve.data.list.filter(function(ie){return z.value.includes(ie[z.key])}).map(function(ie){return{id:ie[z.key],name:ie[z.showKey]}})),p(z),L.next=17;break;case 16:N([]);case 17:m(!0);case 18:case"end":return L.stop()}},E)}))()}}});var I=(0,o.useState)(""),O=C()(I,2),Z=O[0],S=O[1],f=(0,o.useState)(""),a=C()(f,2),l=a[0],n=a[1],e=(0,o.useState)(!1),c=C()(e,2),d=c[0],m=c[1],s=(0,o.useRef)(),A=(0,o.useRef)(),Q=(0,o.useState)([]),k=C()(Q,2),se=k[0],N=k[1],ue=(0,o.useState)(),D=C()(ue,2),v=D[0],p=D[1];return(0,t.jsx)(ye.Z,{title:"\u6743\u9650\u8BBE\u7F6E",open:d,width:ae.R_,destroyOnClose:!0,onClose:function(){var g;(g=s.current)===null||g===void 0||g.resetFields(),m(!1)},children:(0,t.jsx)(u.Z,{actionRef:A,search:!1,toolBarRender:!1,scroll:{x:"max-content"},columns:[{key:"name",title:"\u540D\u79F0",dataIndex:"name"}],rowKey:"id",dataSource:se,rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},tableAlertOptionRender:function(g){var E=g.selectedRows;return(0,t.jsx)(G.Z,{size:16,wrap:!0,children:(0,t.jsx)(M.Z,{danger:!0,type:"primary",action:R()(i()().mark(function y(){return i()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,(0,j.V9)({username:Z,permission:{uri:l,key:"-",value:E.map(function(K){return K.id}),showKey:"-"}});case 2:return w.abrupt("return",!0);case 3:case"end":return w.stop()}},y)})),onSuccess:function(){return m(!1),!0},confirm:"notification.confirm.title",children:"\u6279\u91CF\u5220\u9664"})})},pagination:!1})})}),de=xe,Oe=r(24963),De=r(34646),Ze=r(60433),fe=r(25449),Ae=r(31199),Fe=(0,o.forwardRef)(function(b,U){(0,o.useImperativeHandle)(U,function(){return{show:function(d){return R()(i()().mark(function m(){var s,A;return i()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:A=d.formData,(s=e.current)===null||s===void 0||s.resetFields(),n(A),S(!0);case 4:case"end":return k.stop()}},m)}))()}}});var I=(0,o.useState)(!1),O=C()(I,2),Z=O[0],S=O[1],f=(0,o.useState)({}),a=C()(f,2),l=a[0],n=a[1],e=(0,o.useRef)();return(0,t.jsxs)(X.a,{title:"\u6743\u9650\u8BBE\u7F6E",open:Z,width:800,formRef:e,onFinish:function(){var c=R()(i()().mark(function d(m){return i()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return b.onChange(m),S(!1),A.abrupt("return",!0);case 3:case"end":return A.stop()}},d)}));return function(d){return c.apply(this,arguments)}}(),initialValues:l,drawerProps:{width:ae.R_,destroyOnClose:!0,onClose:function(){var d;(d=e.current)===null||d===void 0||d.resetFields(),S(!1)}},children:[(0,t.jsx)(Ae.Z,{name:"limit",label:"\u5BB9\u5668\u6570\u91CF",min:0}),(0,t.jsx)($.Z,{name:"name",hidden:!0})]})}),Ie=Fe,Be=(0,o.forwardRef)(function(b,U){(0,o.useImperativeHandle)(U,function(){return{edit:function(v){return R()(i()().mark(function p(){var h,g,E;return i()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return(h=a.current)===null||h===void 0||h.setFieldValue("username",v),P.next=3,(0,j.J5)({username:v});case 3:g=P.sent,g.data.resource?(E={},g.data.resource.forEach(function(w){E[w.name]=w}),ue(E)):ue({}),g.data.menus?(g.data.menus.map(function(w){var K;(K=a.current)===null||K===void 0||K.setFieldValue(["permission",w],!0)}),Q([].concat(oe()(g.data.menus||[]),oe()(F.Io)))):Q(F.Io),f(!0);case 7:case"end":return P.stop()}},p)}))()}}});var I={canSeeContainerList:F.W6.CONTAINER,canSeeImageRegistry:F.W6.REGISTRY,canSeeComposeList:F.W6.COMPOSE,canSeeSystemAppstore:F.W6.APPSTORE,canSeeSystemEnv:F.W6.DOCKER_ENV},O=(0,o.useState)(!1),Z=C()(O,2),S=Z[0],f=Z[1],a=(0,o.useRef)(),l=(0,o.useContext)(Oe.Z),n=l.message,e=l.lang,c=(0,o.useRef)(),d=(0,o.useRef)(),m=(0,o.useState)([]),s=C()(m,2),A=s[0],Q=s[1],k=(0,o.useState)({}),se=C()(k,2),N=se[0],ue=se[1];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(X.a,{title:"\u6743\u9650\u8BBE\u7F6E",open:S,onOpenChange:function(v){var p;!v&&((p=a.current)===null||p===void 0||p.resetFields()),f(v)},drawerProps:{forceRender:!0,width:ae.R_},layout:"inline",formRef:a,onValuesChange:function(v,p){var h=Object.keys(v.permission)[0];if(v.permission[h]===!1){for(var g in p.permission)if(g.startsWith(h)){var E;(E=a.current)===null||E===void 0||E.setFieldValue(["permission",g],!1)}}Q(Object.keys(p.permission).filter(function(y){return p.permission[y]}))},onFinish:function(){var D=R()(i()().mark(function v(p){var h;return i()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return h=p.permission&&Object.keys(p.permission).filter(function(y){return p.permission[y]&&!F.Io.includes(y)}),h.push.apply(h,oe()(F.Io.filter(function(y){return h.some(function(P){return P.startsWith(y)})}))),E.next=4,(0,j.SS)({username:p.username,menuPermissionNames:h,resources:Object.values(N)});case 4:return E.abrupt("return",!0);case 5:case"end":return E.stop()}},v)}));return function(v){return D.apply(this,arguments)}}(),children:[(0,t.jsx)(de,{ref:c}),(0,t.jsx)($.Z,{name:"username",hidden:!0}),F.d0.map(function(D){return(0,t.jsxs)(je.Z,{headerBordered:!0,ghost:!0,bodyStyle:{paddingTop:10,paddingBottom:20},title:(0,t.jsx)(De.Z,{}),subTitle:e("system.user.permissions.".concat(D.group)),children:[(0,t.jsx)(be.Z,{name:["permission",D.group],valuePropName:"checked",initialValue:!0,hidden:!0}),(0,t.jsx)(Ee.Z,{gutter:[16,16],children:D.permissions.map(function(v){return(0,t.jsx)(Pe.Z,{span:6,children:(0,t.jsxs)(fe.Z,{children:[(0,t.jsx)(fe.Z,{noStyle:!0,name:["permission",v],valuePropName:"checked",children:(0,t.jsx)(Ce.Z,{disabled:!A.includes(v.substring(0,v.search(/[A-Z][^A-Z]*$/))),children:e("system.user.permissions.".concat(v))})}),I[v]&&(0,t.jsx)(Y.Z,{title:"\u67E5\u770B\u6570\u636E\u6743\u9650",children:(0,t.jsx)(W.Z.Link,{onClick:function(){var h,g;(h=c.current)===null||h===void 0||h.show({username:((g=a.current)===null||g===void 0?void 0:g.getFieldValue("username"))||"",uri:I[v]||""})},children:(0,t.jsx)(Ze.Z,{})})}),["canSeeContainerListManageCreate"].includes(v)&&(0,t.jsx)(Y.Z,{title:"\u914D\u7F6E\u8D44\u6E90\u6743\u9650",children:(0,t.jsx)(W.Z.Link,{onClick:function(){var h;(h=d.current)===null||h===void 0||h.show({formData:N[v]||{name:v,limit:0}})},children:(0,t.jsx)(ee.Z,{})})})]})},v)})})]},D.group)})]}),(0,t.jsx)(de,{ref:c}),(0,t.jsx)(Ie,{onChange:function(v){var p;N[v.name]=v,(0,j.SS)({username:((p=a.current)===null||p===void 0?void 0:p.getFieldValue("username"))||"",menuPermissionNames:A,resources:Object.values(N)})},resourcePermissionsData:N,ref:d})]})}),$e=Be,Te=r(5251),Me=r(87662);function We(){var b=(0,o.useRef)(),U=(0,o.useRef)(),I=(0,o.useRef)(),O=function(){var S=R()(i()().mark(function f(a){return i()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:(0,j.sI)(a);case 1:case"end":return n.stop()}},f)}));return function(a){return S.apply(this,arguments)}}(),Z=function(){var S=R()(i()().mark(function f(a){var l,n,e,c,d;return i()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,j.mX)(a);case 2:if(e=s.sent,a.userRole==="manager"&&(0,j.SS)({username:a.username,menuPermissionNames:F.Wy}),a.userStatus==="disable"&&(0,j.az)({username:a.username,status:1}),!a.email){s.next=10;break}return s.next=8,(0,Me.pe)({groupName:"setting",name:"emailServer"});case 8:d=s.sent,(c=d.data.setting.value.emailServer)!==null&&c!==void 0&&(c=c.status)!==null&&c!==void 0&&c.includes("register")&&O({username:a.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(e.data.token)});case 10:return!((l=b.current)===null||l===void 0)&&l.reloadAndRest&&((n=b.current)===null||n===void 0||n.reloadAndRest()),s.abrupt("return",!0);case 12:case"end":return s.stop()}},f)}));return function(a){return S.apply(this,arguments)}}();return(0,t.jsxs)(le._z,{header:{extra:[(0,t.jsx)(Se,{ref:U,onSubmit:Z},"invite-user")]},children:[(0,t.jsx)($e,{ref:I}),(0,t.jsx)(u.Z,{scroll:{x:"max-content"},rowKey:"username",columns:[{title:"\u7528\u6237\u540D",ellipsis:!0,dataIndex:"username"},{title:"\u90AE\u7BB1",ellipsis:!0,dataIndex:"email"},{title:"\u89D2\u8272",ellipsis:!0,width:100,dataIndex:"userRole",valueEnum:{manager:{text:"\u7BA1\u7406\u5458",status:"manager"},member:{text:"\u64CD\u4F5C\u5458",status:"member"}},render:function(f,a){return(0,t.jsx)(ne.Z,{color:a.userRole==="member"?"gold":"blue",children:a.userRole==="member"?"\u64CD\u4F5C\u5458":"\u7BA1\u7406\u5458"})}},{title:"\u6CE8\u518C\u65F6\u95F4",ellipsis:!0,render:function(f,a,l,n){return(0,t.jsx)("div",{children:(0,Te.ZM)(a.registerAt*1e3)},a.username)},search:!1},{title:"\u5907\u6CE8",ellipsis:!0,dataIndex:"remark",search:!1},{title:"\u72B6\u6001",width:100,dataIndex:"status",valueEnum:{1:{text:"\u7981\u7528",status:"error"},2:{text:"\u6B63\u5E38",status:"success"}},search:!1,render:function(f,a){return(0,t.jsx)(ne.Z,{color:a.status===2?"green":"red",children:a.status===2?"\u6B63\u5E38":"\u7981\u7528"})}},{title:"\u64CD\u4F5C",width:100,search:!1,fixed:"right",render:function(f,a,l){return(0,t.jsxs)(G.Z,{split:(0,t.jsx)(J.Z,{type:"vertical"}),children:[(0,t.jsx)(W.Z.Link,{copyable:{tooltips:"\u590D\u5236\u91CD\u7F6E\u94FE\u63A5",icon:[(0,t.jsx)(_.Z,{})],text:function(){var n=R()(i()().mark(function c(){var d;return i()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,j.u1)({username:a.username});case 2:return d=s.sent,s.abrupt("return","".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(d.data.token));case 4:case"end":return s.stop()}},c)}));function e(){return n.apply(this,arguments)}return e}()},style:{color:"inherit"}},"copy-"+l),(0,t.jsx)(Y.Z,{title:"\u7528\u6237\u6743\u9650\u8BBE\u7F6E",children:(0,t.jsx)(W.Z.Link,{onClick:function(){var e;(e=I.current)===null||e===void 0||e.edit(a.username)},children:(0,t.jsx)(ee.Z,{})})}),(0,t.jsx)(M.Z,{ghost:!0,type:"link",tips:"\u53D1\u9001\u91CD\u7F6E\u94FE\u63A5\u5230\u90AE\u7BB1",icon:(0,t.jsx)(H.Z,{}),action:R()(i()().mark(function n(){var e;return i()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,(0,j.u1)({username:a.username});case 2:return e=d.sent,d.abrupt("return",O({username:a.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(e.data.token)}));case 4:case"end":return d.stop()}},n)}))})]})}}],request:function(){var S=R()(i()().mark(function f(a){var l;return i()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,j.lE)();case 2:return l=e.sent,e.abrupt("return",{data:l.data.list,success:!0,total:l.data.list.length});case 4:case"end":return e.stop()}},f)}));return function(f){return S.apply(this,arguments)}}(),rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},actionRef:b,tableAlertOptionRender:function(f){var a=f.selectedRowKeys;return(0,t.jsxs)(G.Z,{size:16,children:[(0,t.jsx)(M.Z,{action:R()(i()().mark(function l(){var n,e,c,d;return i()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:n=0,e=a;case 1:if(!(n<e.length)){s.next=9;break}return c=e[n],s.next=5,(0,j.az)({username:c,status:2});case 5:d=s.sent;case 6:n++,s.next=1;break;case 9:return s.abrupt("return",!0);case 10:case"end":return s.stop()}},l)})),onSuccess:function(){var n,e;return!((n=b.current)===null||n===void 0)&&n.reloadAndRest&&((e=b.current)===null||e===void 0||e.reloadAndRest()),!0},onError:function(){var n,e;return!((n=b.current)===null||n===void 0)&&n.reset&&((e=b.current)===null||e===void 0||e.reset()),!0},children:"\u542F\u7528"},"batchEnable"),(0,t.jsx)(M.Z,{danger:!0,action:R()(i()().mark(function l(){var n,e,c,d;return i()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:n=0,e=a;case 1:if(!(n<e.length)){s.next=9;break}return c=e[n],s.next=5,(0,j.az)({username:c,status:1});case 5:d=s.sent;case 6:n++,s.next=1;break;case 9:return s.abrupt("return",!0);case 10:case"end":return s.stop()}},l)})),onSuccess:function(){var n,e;return!((n=b.current)===null||n===void 0)&&n.reloadAndRest&&((e=b.current)===null||e===void 0||e.reloadAndRest()),!0},onError:function(){var n,e;return!((n=b.current)===null||n===void 0)&&n.reset&&((e=b.current)===null||e===void 0||e.reset()),!0},children:"\u7981\u7528"},"batchDisable")]})},pagination:(0,q.O)()})]})}},67255:function(re,B,r){r.d(B,{O:function(){return T},j:function(){return i}});function T(){var x=localStorage.getItem("dpanel-pagesize");return x=="all"?!1:{showSizeChanger:!0,defaultPageSize:parseInt(x!=null?x:"20")}}function i(x){var R="dpanel-table-column-".concat(x),M={};if(localStorage.getItem(R)){var j;M=JSON.parse((j=localStorage.getItem(R))!==null&&j!==void 0?j:"{}")}return{defaultValue:M,onChange:function(_){localStorage.setItem("dpanel-table-column-".concat(x),JSON.stringify(_))}}}}}]);
