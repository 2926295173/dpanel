"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3917],{44349:function(ne,$,e){var G=e(97857),p=e.n(G),V=e(15009),A=e.n(V),L=e(99289),N=e.n(L),w=e(74763),T=e(17186),I=e(5966),R=e(86250),b=e(67294),W=e(85893),K=(0,b.forwardRef)(function(v,Z){var D=(0,b.useRef)();(0,b.useImperativeHandle)(Z,function(){return{addItem:function(u){function s(f,t,a){return u.apply(this,arguments)}return s.toString=function(){return u.toString()},s}(function(u,s,f){var t,a=(t=D.current)===null||t===void 0?void 0:t.getList(),r;if(a==null||a.forEach(function(z,J){z[u]==s[u]&&(r=J)}),!(0,w.k)(r)&&f){var H;(H=D.current)===null||H===void 0||H.remove(r),r=void 0}if(!r){var x;(x=D.current)===null||x===void 0||x.add(s)}}),removeItemByKey:function(s,f){return N()(A()().mark(function t(){var a,r;return A()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return r=(a=D.current)===null||a===void 0?void 0:a.getList(),r==null||r.forEach(function(z,J){if(z[s]==f){var Q;(Q=D.current)===null||Q===void 0||Q.remove(J);return}}),x.abrupt("return");case 3:case"end":return x.stop()}},t)}))()},clear:function(s){if(!s){var f;s=(f=D.current)===null||f===void 0||(f=f.getList())===null||f===void 0?void 0:f.map(function(a,r){return r})}if(s){var t;(t=D.current)===null||t===void 0||t.remove(s)}},getList:function(){var s;return(s=D.current)===null||s===void 0?void 0:s.getList()}}});var B={};return v.hideCopyButton===!0&&(B.copyIconProps=!1),v.hideDeleteButton===!0&&(B.deleteIconProps=!1),(0,W.jsx)(T.u,p()(p()({initialValue:v.initialValue,label:v.label,name:v.name,actionRef:D,creatorButtonProps:v.showAddButton?{creatorButtonText:v.label?v.label:v.showAddButtonLabel?v.showAddButtonLabel:v.name}:!1,min:v.min?v.min:0},B),{},{children:function(s,f,t){return(0,W.jsx)(R.Z,{justify:v.justify,gap:v.gap,children:v.items.map(function(a){return a.render?(0,W.jsx)("div",{children:a.render&&a.render(s,f,t)},"".concat(v.name,"-").concat(a.name,"-").concat(s.key)):(0,W.jsx)(I.Z,{width:a.width,name:a.name,label:a.label,required:a.required,rules:[{required:a.required}],disabled:a.disabled,placeholder:a.placeholder},"".concat(v.name,"-").concat(a.name,"-").concat(s.key))})})}}))});$.Z=K},36435:function(ne,$,e){var G=e(15009),p=e.n(G),V=e(64599),A=e.n(V),L=e(99289),N=e.n(L),w=e(9783),T=e.n(w),I=e(5574),R=e.n(I),b=e(67294),W=e(184),K=e(38345),v=e(97269),Z=e(97321),D=e(97462),B=e(64317),u=e(5966),s=e(86615),f=e(68602),t=e(83622),a=e(83403),r=e(24963),H=e(1699),x=e(29177),z=e(1883),J=e(43425),Q=e(44349),ae=e(3616),q=e(36146),O=e(85893),se=(0,b.forwardRef)(function(S,ie){var oe=(0,b.useState)(!1),te=R()(oe,2),k=te[0],ee=te[1],h=(0,b.useRef)(),re=(0,b.useContext)(r.Z),X=re.message,F=(0,b.useState)([]),C=R()(F,2),d=C[0],y=C[1],i=new q.Uo("components.permissionButton"),P=T()(T()(T()(T()(T()({},a.W6.CONTAINER,"Id"),a.W6.APPSTORE,"name"),a.W6.COMPOSE,"name"),a.W6.REGISTRY,"serverAddress"),a.W6.DOCKER_ENV,"name"),Y=T()(T()(T()(T()(T()({},a.W6.CONTAINER,"name"),a.W6.APPSTORE,"name"),a.W6.COMPOSE,"name"),a.W6.REGISTRY,"title"),a.W6.DOCKER_ENV,"title"),m=P[S.type],U=Y[S.type],de=S.selected.map(function(l){return l[P[S.type]]});return b.useEffect(function(){if(k){if(!S.selected||S.selected.length==0){X.error(q.FD.format("title.noDataSelect")),ee(!1);return}(0,f.dP)({permission:{uri:S.type,key:m,value:de}}).then(function(l){var _;(_=h.current)===null||_===void 0||_.setFieldValue("list",Object.keys(l.data.list).map(function(o){return{name:o,type:l.data.list[o].type,users:l.data.list[o].users}}))}),(0,f.lE)().then(function(l){var _,o=(_=l.data)===null||_===void 0||(_=_.list)===null||_===void 0?void 0:_.map(function(n){return{label:n.username,value:n.username}});y(o)})}},[k]),(0,O.jsx)(H.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,O.jsxs)(W.a,{name:"create",title:i.format("drawerTitle"),open:k,onOpenChange:function(_){if(!_){var o;(o=h.current)===null||o===void 0||o.resetFields()}ee(_)},drawerProps:{forceRender:!0,width:ae.R_},formRef:h,trigger:(0,O.jsx)(t.ZP,{icon:(0,O.jsx)(x.Z,{}),children:i.format("drawerTriggerButton")}),onFinish:function(){var l=N()(p()().mark(function _(o){var n,E,c;return p()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:n=A()(o.list),j.prev=1,n.s();case 3:if((E=n.n()).done){j.next=9;break}return c=E.value,j.next=7,(0,f.Db)({usernames:c.users,permissionType:c.type,permission:{uri:S.type,key:m,showKey:U,value:[c.name]}});case 7:j.next=3;break;case 9:j.next=14;break;case 11:j.prev=11,j.t0=j.catch(1),n.e(j.t0);case 14:return j.prev=14,n.f(),j.finish(14);case 17:X.success(q.FD.format("finish")),ee(!1),S.onSuccess();case 20:case"end":return j.stop()}},_,null,[[1,11,14,17]])}));return function(_){return l.apply(this,arguments)}}(),children:[(0,O.jsxs)(K.Z,{ghost:!0,title:(0,O.jsx)(z.Z,{}),subTitle:i.format("batchTitle"),children:[(0,O.jsx)(v.A.Item,{name:"type",style:{marginBottom:0},children:(0,O.jsx)(Z.Z.Group,{defaultValue:"admin",onChange:function(_){var o,n,E=(o=h.current)===null||o===void 0?void 0:o.getFieldValue("list");E.forEach(function(c){c.type=_,c.users=[]}),(n=h.current)===null||n===void 0||n.setFieldValue("list",E)},children:["admin","restricted","public"].map(function(l){return(0,O.jsx)(Z.Z,{style:{width:240},title:i.format("dataTypeOption.".concat(l)),description:i.format("dataTypeDescOption.".concat(l)),value:l},l)})})}),(0,O.jsx)(D.Z,{name:["type"],children:function(_){var o=_.type;if(o==="restricted")return(0,O.jsx)(B.Z,{mode:"multiple",name:"usernames",label:i.format("formUsernames"),onChange:function(E){var c,M,j=(c=h.current)===null||c===void 0?void 0:c.getFieldValue("list");j.forEach(function(g){g.users=E}),(M=h.current)===null||M===void 0||M.setFieldValue("list",j)},rules:[{required:!0}],request:N()(p()().mark(function n(){var E,c,M;return p()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(d.length>0)){g.next=2;break}return g.abrupt("return",d);case 2:return g.next=4,(0,f.lE)();case 4:return c=g.sent,M=(E=c.data)===null||E===void 0||(E=E.list)===null||E===void 0?void 0:E.map(function(le){return{label:le.username,value:le.username}}),y(M),g.abrupt("return",M);case 8:case"end":return g.stop()}},n)}))})}})]}),(0,O.jsx)(K.Z,{ghost:!0,title:(0,O.jsx)(J.Z,{}),subTitle:i.format("dataTitle"),children:(0,O.jsx)(Q.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:i.format("dataName"),render:function(_,o,n){var E=n.getCurrentRowData();return(0,O.jsx)(u.Z,{disabled:!0,label:i.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:i.format("dataType"),render:function(_,o,n){var E=n.getCurrentRowData();return(0,O.jsx)(s.Z.Group,{label:i.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(c){return{label:i.format("dataTypeOption.".concat(c)),value:c}})})}},{name:"users",label:i.format("dataUsers"),render:function(_,o,n){return(0,O.jsx)(D.Z,{name:["type"],children:function(c){var M=c.type;if(M=="restricted")return(0,O.jsx)(B.Z,{width:"sm",mode:"tags",name:"users",label:i.format("dataUsers"),options:d})}})}}]})})]})})});$.Z=se},3616:function(ne,$,e){e.d($,{Ed:function(){return A},FK:function(){return p},R_:function(){return G},ob:function(){return V}});var G=window.innerWidth<=1024?"90vw":"65vw",p="90vw",V="60vw",A="50vh"},29337:function(ne,$,e){e.r($),e.d($,{default:function(){return ee}});var G=e(15009),p=e.n(G),V=e(99289),A=e.n(V),L=e(5574),N=e.n(L),w=e(3616),T=e(24963),I=e(15078),R=e(36146),b=e(184),W=e(5966),K=e(97462),v=e(86615),Z=e(62370),D=e(82346),B=e(83622),u=e(42075),s=e(25593),f=e(66309),t=e(40056),a=e(67294),r=e(85893),H=(0,a.forwardRef)(function(h,re){var X=(0,a.useState)(!1),F=N()(X,2),C=F[0],d=F[1],y=(0,a.useRef)(),i=(0,a.useContext)(T.Z),P=i.message,Y=(0,D.useSearchParams)(),m=N()(Y,2),U=m[0],de=m[1],l=new R.Uo("components.appstore");return(0,a.useImperativeHandle)(re,function(){return{edit:function(o){var n;(n=y.current)===null||n===void 0||n.setFieldsValue({title:o.title,name:o.name,type:o.setting.type,url:o.setting.url,id:o.id}),d(!0)}}}),(0,a.useEffect)(function(){U.get("op")=="create"&&d(!0)},[]),(0,r.jsxs)(b.a,{name:"appstoreCreate",title:l.format("createDrawerTitle"),open:C,onOpenChange:function(o){var n;!o&&((n=y.current)===null||n===void 0||n.resetFields()),d(o)},drawerProps:{forceRender:!0,width:w.R_},formRef:y,trigger:(0,r.jsx)(B.ZP,{type:"primary",children:l.format("createDrawerTitle")}),onFinish:function(){var _=A()(p()().mark(function o(n){var E,c,M;return p()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return n.type=="1panel-local"&&(n.url="/dpanel/store/".concat(n.name)),g.next=3,(0,I.ks)({name:n.name,url:n.url,type:n.type});case 3:if(E=g.sent,!(E&&E.data)){g.next=13;break}return g.next=7,(0,I.$c)({id:n.id,name:n.name,title:n.title,type:n.type,url:n.url,apps:E.data.list});case 7:if(c=g.sent,!(c&&c.data)){g.next=13;break}return P.success(R.FD.format("finish")),h.onFinish&&h.onFinish(),(M=y.current)===null||M===void 0||M.resetFields(),g.abrupt("return",!0);case 13:case"end":return g.stop()}},o)}));return function(o){return _.apply(this,arguments)}}(),children:[(0,r.jsx)(W.Z,{name:"id",hidden:!0}),(0,r.jsx)(W.Z,{label:l.format("formTitle"),name:"title",required:!0,rules:[{required:!0}],placeholder:l.format("formTitleEmpty")}),(0,r.jsx)(K.Z,{name:["id"],children:function(o){var n=o.id;return(0,r.jsx)(W.Z,{label:l.format("formName"),name:"name",required:!0,disabled:!!n,rules:[{required:!0}],placeholder:l.format("formNameEmpty")})}}),(0,r.jsx)(v.Z.Group,{name:"type",label:l.format("formType"),options:l.option("formTypeOption",["casaos","1panel","1panel-local"]),fieldProps:{onChange:function(o){var n;(n=y.current)===null||n===void 0||n.resetFields(["url"])}}}),(0,r.jsx)(K.Z,{name:["type","name"],children:function(o){var n=o.type,E=o.name,c=[],M=[];if(n=="1panel"&&(M=["https://gitee.com/qyg2297248353/appstore-dpanel","https://github.com/1Panel-dev/appstore","https://github.com/okxlin/appstore"],c=[(0,r.jsx)(W.Z,{label:l.format("formGitUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:l.format("formGitUrlEmpty")},"gitUrl")]),n=="portainer"&&(c=[(0,r.jsx)(W.Z,{label:l.format("formJsonUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:"https://github.com/Lissy93/portainer-templates/blob/main/templates.json"},"jsonUrl")]),n=="casaos"&&(M=["https://play.cuse.eu.org/Cp0204-AppStore-Play.zip"],c=[(0,r.jsx)(W.Z,{label:l.format("formZipUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:l.format("formZipUrlEmpty")},"zipUrl")]),n&&n!="1panel-local")return[c,(0,r.jsx)(Z.Z,{label:(0,r.jsxs)(u.Z,{children:[l.format("formRecommend"),(0,r.jsx)("a",{href:"https://dpanel.cc/manual/system-store",target:"_blank",children:R.FD.format("help")})]}),children:(0,r.jsx)(u.Z,{wrap:!0,children:M.map(function(j,g){return(0,r.jsx)(s.Z.Link,{onClick:function(){var ue;(ue=y.current)===null||ue===void 0||ue.setFieldValue("url",j)},children:(0,r.jsx)(f.Z,{color:"cyan",children:j})},g)})})},"recommend")];if(n=="1panel-local")return[c,(0,r.jsx)(Z.Z,{children:(0,r.jsx)(t.Z,{message:l.format("formLocalDesc",{name:E})})},"local-description")]}})]})}),x=H,z=e(80821),J=e(36435),Q=e(59683),ae=e(83403),q=e(5251),O=e(99611),se=e(86548),S=e(98165),ie=e(82061),oe=e(74453),te=e(96074),k=e(83062);function ee(){var h=(0,a.useRef)(),re=(0,D.useAccess)(),X=(0,a.useRef)();return(0,r.jsx)(oe._z,{header:{extra:[re.canSeeFounder&&(0,r.jsx)(x,{ref:X,onFinish:function(){var C,d;!((C=h.current)===null||C===void 0)&&C.reloadAndRest&&((d=h.current)===null||d===void 0||d.reloadAndRest())}},"create")]},children:(0,r.jsx)(Q.C,{rowKey:"id",columns:[{title:R.FD.format("listName"),dataIndex:"name",width:200},{title:R.FD.format("listTitle"),dataIndex:"title"},{title:R.FD.format("listTargetRoot"),width:500,search:!1,render:function(C,d,y,i,P){return(0,r.jsx)("a",{href:d.setting.url,target:"_blank",children:(0,r.jsx)(f.Z,{children:d.setting.url})})}},{title:R.FD.format("listUpdatedAt"),width:180,search:!1,render:function(C,d,y,i,P){if(d.setting.updatedAt)return(0,q.ZM)(d.setting.updatedAt*1e3)}},{title:R.FD.format("listManage"),width:150,search:!1,fixed:"right",render:function(C,d,y,i,P){return(0,r.jsxs)(u.Z,{split:(0,r.jsx)(te.Z,{type:"vertical"}),children:[(0,r.jsx)(D.Link,{to:"/compose/appstore",state:{name:d.name},children:(0,r.jsx)(k.Z,{title:R.FD.format("listManageView"),children:(0,r.jsx)(O.Z,{})})}),(0,r.jsx)(s.Z.Link,{onClick:function(){var m;(m=X.current)===null||m===void 0||m.edit(d)},children:(0,r.jsx)(k.Z,{title:R.FD.format("listManageEdit"),children:(0,r.jsx)(se.Z,{})})},"manage"),(0,r.jsx)(z.Z,{buttonProps:{type:"link",icon:(0,r.jsx)(S.Z,{}),ghost:!0},action:function(){var m,U;return(0,I.ks)({id:d.id,name:d.name,url:(m=d.setting.url)!==null&&m!==void 0?m:"",type:(U=d.setting.type)!==null&&U!==void 0?U:""})},onSuccess:function(){var m,U;return!((m=h.current)===null||m===void 0)&&m.reloadAndRest&&((U=h.current)===null||U===void 0||U.reloadAndRest()),!0},onError:function(){var m,U;return!((m=h.current)===null||m===void 0)&&m.reloadAndRest&&((U=h.current)===null||U===void 0||U.reloadAndRest()),!0},tips:R.FD.format("listManageSync")},"upgrade")]})}}],request:function(){var F=A()(p()().mark(function C(d,y,i){var P;return p()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,(0,I.eO)({name:d.name,title:d.title});case 2:return P=m.sent,m.abrupt("return",{data:P.data.list,success:!0,total:P.data.list.length});case 4:case"end":return m.stop()}},C)}));return function(C,d,y){return F.apply(this,arguments)}}(),actionRef:h,quickToolbarRender:function(C){var d=C.selectedRows;return(0,r.jsxs)(u.Z,{size:16,children:[(0,r.jsx)(J.Z,{type:ae.W6.APPSTORE,selected:d,onSuccess:function(){var i,P;return!((i=h.current)===null||i===void 0)&&i.reloadAndRest&&((P=h.current)===null||P===void 0||P.reloadAndRest()),!0}}),(0,r.jsx)(z.Z,{buttonProps:{danger:!0,type:"primary",icon:(0,r.jsx)(ie.Z,{})},confirmProps:{showCommonConfirm:!0},action:function(){return(0,I.Me)({id:d.map(function(i){return i.id})})},onSuccess:function(){var i,P;return!((i=h.current)===null||i===void 0)&&i.reloadAndRest&&((P=h.current)===null||P===void 0||P.reloadAndRest()),!0},onError:function(){var i,P;return!((i=h.current)===null||i===void 0)&&i.reset&&((P=h.current)===null||P===void 0||P.reset()),!0},children:R.FD.format("listManageDeleteBatch")},"delete")]})}},"appstore-list")})}},15078:function(ne,$,e){e.d($,{$c:function(){return N},Me:function(){return v},eO:function(){return W},ks:function(){return T},yL:function(){return D}});var G=e(15009),p=e.n(G),V=e(99289),A=e.n(V),L=e(82346);function N(u){return w.apply(this,arguments)}function w(){return w=A()(p()().mark(function u(s){return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,L.request)("/api/common/store/create",{method:"POST",data:s}));case 1:case"end":return t.stop()}},u)})),w.apply(this,arguments)}function T(u){return I.apply(this,arguments)}function I(){return I=A()(p()().mark(function u(s){return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,L.request)("/api/common/store/sync",{method:"POST",data:s}));case 1:case"end":return t.stop()}},u)})),I.apply(this,arguments)}function R(u){return b.apply(this,arguments)}function b(){return b=_asyncToGenerator(_regeneratorRuntime().mark(function u(s){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/common/store/get-detail",{method:"POST",data:s}));case 1:case"end":return t.stop()}},u)})),b.apply(this,arguments)}function W(u){return K.apply(this,arguments)}function K(){return K=A()(p()().mark(function u(s){return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,L.request)("/api/common/store/get-list",{method:"POST",data:s}));case 1:case"end":return t.stop()}},u)})),K.apply(this,arguments)}function v(u){return Z.apply(this,arguments)}function Z(){return Z=A()(p()().mark(function u(s){return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,L.request)("/api/common/store/delete",{method:"POST",data:s});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},u)})),Z.apply(this,arguments)}function D(u){return B.apply(this,arguments)}function B(){return B=A()(p()().mark(function u(s){return p()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,L.request)(s==null?void 0:s.path,{method:"GET"}));case 1:case"end":return t.stop()}},u)})),B.apply(this,arguments)}}}]);
