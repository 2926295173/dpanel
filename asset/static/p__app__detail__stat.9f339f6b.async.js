"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745,5947],{55809:function(k,C,e){var I=e(87462),t=e(67294),A=e(44805),i=e(84089),y=function(l,v){return t.createElement(i.Z,(0,I.Z)({},l,{ref:v,icon:A.Z}))},O=t.forwardRef(y);C.Z=O},60433:function(k,C,e){var I=e(87462),t=e(67294),A=e(69782),i=e(84089),y=function(l,v){return t.createElement(i.Z,(0,I.Z)({},l,{ref:v,icon:A.Z}))},O=t.forwardRef(y);C.Z=O},1699:function(k,C,e){e.d(C,{u:function(){return m}});var I=e(9783),t=e.n(I),A=e(97857),i=e.n(A),y=e(67294),O=e(82346),M=e(40411),l=e(42075),v=e(85893),m=function(c){var _=(0,O.useAccess)(),L=Array.isArray(c.access)?c.access:[c.access],s,E=c.fallback;if(typeof c.children=="function"?(s=c.children(L.reduce(function(p,n){return i()(i()({},p),{},t()({},n,_[n]))},{})),s||(s=E)):L.every(function(p){return _[p]})?s=c.children:s=E,!E&&s&&c.showProTips&&_.canSeeEnableCe){if(_.canSeeEnableHiddenProTips)return null;s=(0,v.jsx)(M.Z,{offset:c.showProTipsOffset,count:"PRO",color:"gold",style:{fontWeight:"bold"},children:s})}if(!E&&s&&c.showProRibbonTips&&_.canSeeEnableCe){if(_.canSeeEnableHiddenProTips)return null;s=(0,v.jsx)(M.Z.Ribbon,{text:"PRO",color:"gold",style:{fontWeight:"bold"},children:s})}return c.space?(0,v.jsx)(l.Z,i()(i()({},c.space),{},{children:s})):s}},27619:function(k,C,e){e.d(C,{Z:function(){return M}});var I=e(5574),t=e.n(I),A=e(82346),i=e(67294),y=e(64389),O=e(85893);function M(l){var v=(0,A.useModel)("@@initialState"),m=v.initialState,x="chart-area-".concat(l.name),c=(0,i.useState)(),_=t()(c,2),L=_[0],s=_[1],E={};l.data.forEach(function(n){n.show===!1?E[n.name]=!1:E[n.name]=!0});var p={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},valueFormatter:function(R){return l.yValueFormatter?l.yValueFormatter(R):R}},legend:{selected:E},grid:{left:"0",right:"0",bottom:"0",top:"30",containLabel:!0},xAxis:{type:"category",data:l.data[0].data.map(function(n){return n.date}),boundaryGap:!1,axisLabel:{rotate:20}},yAxis:{type:"value",axisLabel:{formatter:l.yLabelFormatter},max:function(R){if(l.yDomainMaxCallback)return l.yDomainMaxCallback(R)}},series:[]};return(0,i.useEffect)(function(){var n="",R=window.matchMedia("(prefers-color-scheme: dark)");(m==null?void 0:m.theme.algorithm)=="dark"||R.matches?n="dark":n="",L&&!L.isDisposed()&&L.dispose();var W=document.getElementById(x),B=y.S1(W,n);B.setOption(p);var f=new ResizeObserver(function(){B.resize()});W&&f.observe(W),s(B)},[m]),(0,i.useEffect)(function(){L&&!L.isDisposed()&&L.setOption({legend:{data:l.data.map(function(n){return n.name})},xAxis:{data:l.data[0].data.map(function(n){return n.date})},series:l.data.map(function(n){return{name:n.name,type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:n.data.map(function(R){return R.value})}})})},[l.data]),(0,O.jsx)("div",{style:{height:200},id:x})}},24963:function(k,C,e){var I=e(67294),t=(0,I.createContext)({});C.Z=t},50070:function(k,C,e){e.r(C),e.d(C,{AppDetailContext:function(){return n},default:function(){return R}});var I=e(15009),t=e.n(I),A=e(99289),i=e.n(A),y=e(5574),O=e.n(y),M=e(1699),l=e(24963),v=e(13822),m=e(55809),x=e(90078),c=e(82346),_=e(25593),L=e(28036),s=e(50136),E=e(67294),p=e(85893),n=(0,E.createContext)({});function R(){var W,B=(0,E.useContext)(l.Z),f=B.loading,j=(0,c.useParams)(),d=(0,c.useSearchParams)(),P=O()(d,2),g=P[0],a=P[1],G=(W=g.get("tab"))!==null&&W!==void 0?W:"edit",K=(0,E.useState)("edit"),Z=O()(K,2),z=Z[0],o=Z[1],w=(0,c.useNavigate)(),J=(0,E.useState)(1),S=O()(J,2),N=S[0],Y=S[1],V=[{label:(0,p.jsx)(c.Link,{to:"/app/detail/edit/".concat(j.id,"?tab=edit"),children:"\u5BB9\u5668\u8BE6\u60C5"}),key:"edit"},{label:(0,p.jsx)(c.Link,{to:"/app/detail/network/".concat(j.id,"?tab=network"),children:"\u7F51\u7EDC\u7BA1\u7406"}),key:"network"},{label:(0,p.jsx)(_.Z.Link,{children:"\u6587\u4EF6\u7BA1\u7406"}),key:"file",onClick:function(){w("/app/detail/file/".concat(j.id,"?tab=file"))}},{label:(0,p.jsx)(_.Z.Link,{children:"\u8FD0\u884C\u65E5\u5FD7"}),key:"log",onClick:function(){w("/app/detail/log/".concat(j.id,"?tab=log"))}},{label:(0,p.jsx)(_.Z.Link,{children:"\u8FD0\u884C\u72B6\u6001"}),key:"stat",onClick:function(){w("/app/detail/stat/".concat(j.id,"?tab=stat"))}},{label:"",key:"containerName",icon:(0,p.jsx)(m.Z,{}),disabled:!0}],Q=(0,E.useState)(V),h=O()(Q,2),X=h[0],ee=h[1];(0,E.useEffect)(function(){f.show(),o(G);var b=function(){var u=i()(t()().mark(function r(){var T,D,$;return t()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return T=V,U.prev=1,U.next=4,(0,v.jV)({md5:(D=j.id)!==null&&D!==void 0?D:""});case 4:$=U.sent,T.map(function(H){return H.key=="containerName"&&(H.label=$.data.info.Name),(!$.data.info.State.Running||$.data.info.State.Restarting)&&(H.key=="file"||H.key=="stat")&&(H.disabled=!0),H}),ee(T),U.next=13;break;case 9:return U.prev=9,U.t0=U.catch(1),w("/app/list"),U.abrupt("return");case 13:return U.prev=13,f.destroy(),U.finish(13);case 16:case"end":return U.stop()}},r,null,[[1,9,13,16]])}));return function(){return u.apply(this,arguments)}}();b()},[N,j]);var q=function(u){o(u.key)};return(0,p.jsx)(n.Provider,{value:{reload:function(){Y(N+1)}},children:(0,p.jsxs)(x._z,{header:{extra:[(0,p.jsx)(M.u,{access:"canSeeContainerListManageCreate",children:(0,p.jsx)(c.Link,{to:"/app/create/image",children:(0,p.jsx)(L.ZP,{type:"primary",children:"\u521B\u5EFA\u5BB9\u5668"})})},"create")]},children:[(0,p.jsx)(s.Z,{mode:"horizontal",onClick:q,selectedKeys:[z],items:X}),(0,p.jsx)(c.Outlet,{})]})})}},91629:function(k,C,e){e.r(C),e.d(C,{default:function(){return P}});var I=e(15009),t=e.n(I),A=e(99289),i=e.n(A),y=e(5574),O=e.n(y),M=e(19632),l=e.n(M),v=e(27619),m=e(67294);function x(g){var a=g.reqFunction,G=g.interval,K=g.maxPolling,Z=g.pollingStatus,z=g.inPath,o=(0,m.useRef)(null),w=0,J=function N(){o.current=window.setTimeout(i()(t()().mark(function Y(){var V;return t()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(w++>=K)){h.next=3;break}return S(),h.abrupt("return");case 3:if(h.prev=3,!(z&&window.location.href.indexOf(z)==-1)){h.next=7;break}return S(),h.abrupt("return");case 7:return h.next=9,a();case 9:V=h.sent,N(),h.next=17;break;case 13:h.prev=13,h.t0=h.catch(3),S(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",h.t0);case 17:case"end":return h.stop()}},Y,null,[[3,13]])})),G)},S=function(){console.log("end polling"),o.current&&window.clearTimeout(o.current)};return(0,m.useEffect)(function(){return console.log((Z?"start":"waiting")+" polling, max "+K),Z&&J(),function(){S()}},[G,K,Z]),{endPolling:S}}var c=x,_=e(24963),L=e(84410),s=e(5251),E=e(12122),p=e(60433),n=e(38345),R=e(82346),W=e(60940),B=e(50070),f=e(85893),j=new Date().toLocaleTimeString(),d={total:0,memory:[{date:j,usage:0,source:{usage:0,limit:0}}],cpu:[{date:j,usage:0}],network:[{usage:0,type:"rx",date:j,source:{usage:0}},{usage:0,type:"tx",date:j,source:{usage:0}}],io:[{usage:0,type:"read",date:j,source:{usage:0}},{usage:0,type:"write",date:j,source:{usage:0}}]};function P(){var g=function(u,r){switch(r.type){case"update":var T=new Date(r.payload.read).toLocaleTimeString(),D=r.payload.cpu_stats.cpu_usage.total_usage-r.payload.precpu_stats.cpu_usage.total_usage,$=r.payload.cpu_stats.system_cpu_usage-r.payload.precpu_stats.system_cpu_usage,F={total:u.total+1,memory:[],cpu:[].concat(l()(u.cpu),[{date:T,usage:D/$*r.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return r.payload.memory_stats&&r.payload.memory_stats.limit&&r.payload.memory_stats.usage&&(F.memory=[].concat(l()(u.memory),[{date:T,usage:Math.round(r.payload.memory_stats.usage),source:{usage:r.payload.memory_stats.usage,limit:r.payload.memory_stats.limit}}])),r.payload.networks&&(F.network=[].concat(l()(u.network),[{date:T,usage:parseFloat(r.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:r.payload.networks.eth0.rx_bytes}},{date:T,usage:parseFloat(r.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:r.payload.networks.eth0.tx_bytes}}])),r.payload.blkio_stats&&r.payload.blkio_stats.io_service_bytes_recursive&&r.payload.blkio_stats.io_service_bytes_recursive.length>0&&(F.io=[].concat(l()(u.io),[{date:T,usage:parseFloat(r.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:r.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:r.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:T,usage:parseFloat(r.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:r.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:r.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),F}},a=(0,m.useContext)(_.Z),G=a.loading,K=(0,R.useParams)(),Z=(0,m.useReducer)(g,d),z=O()(Z,2),o=z[0],w=z[1],J=(0,m.useState)(0),S=O()(J,2),N=S[0],Y=S[1],V=(0,m.useState)(),Q=O()(V,2),h=Q[0],X=Q[1],ee=c({reqFunction:function(){var b=i()(t()().mark(function r(){var T,D;return t()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,(0,L.i)({id:(T=K.id)!==null&&T!==void 0?T:""});case 2:D=F.sent,G.destroy(),w({type:"update",payload:D});case 5:case"end":return F.stop()}},r)}));function u(){return b.apply(this,arguments)}return u}(),interval:3e3,maxPolling:999,pollingStatus:N!=0,inPath:"tab=stat"}),q=(0,m.useContext)(B.AppDetailContext);return(0,m.useEffect)(function(){q.reload()},[]),(0,m.useEffect)(function(){var b,u;G.show(),(0,L.i)({id:(b=K.id)!==null&&b!==void 0?b:""}).then(function(r){return Y(Math.round(r.memory_stats.limit)),!0}),(0,L.a)({id:(u=K.id)!==null&&u!==void 0?u:""}).then(function(r){var T={columns:[],data:[]};r.data.list.Titles.map(function(D){T.columns.push({title:D,label:D,dataIndex:D})}),r.data.list.Processes.map(function(D,$){T.data.push({UID:D[0],PID:D[1],PPID:D[2],C:D[3],STIME:D[4],TTY:D[5],TIME:D[6],CMD:D[7]})}),X(T)})},[]),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(n.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[o.memory&&o.memory.length>0&&(0,f.jsx)(n.Z,{colSpan:12,title:(0,f.jsx)(E.Z,{}),subTitle:"Memory usage: ".concat((0,s.FI)(o.memory[o.memory.length-1].source.usage)," / ").concat((0,s.FI)(o.memory[o.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,f.jsx)(v.Z,{yField:"usage",xField:"date",data:o.memory,yDomainMaxCallback:function(u){return u*2},yLabelFormatter:function(u){return(0,s.FI)(parseFloat(u))}})}),(0,f.jsx)(n.Z,{colSpan:12,title:(0,f.jsx)(E.Z,{}),subTitle:"Cpu usage: ".concat(o.cpu[o.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,f.jsx)(v.Z,{yField:"usage",xField:"date",data:o.cpu,yDomainMaxCallback:function(u){return u*1.5},yLabelFormatter:function(u){return"".concat(u,"%")}})}),o.io&&o.io.length>0&&(0,f.jsx)(n.Z,{colSpan:12,title:(0,f.jsx)(E.Z,{}),subTitle:"I/O: ".concat((0,s.FI)(o.io[o.io.length-1].source.usage)," / ").concat((0,s.FI)(o.io[o.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,f.jsx)(v.Z,{yField:"usage",xField:"date",colorField:"type",data:o.io,yDomainMaxCallback:function(u){return u*2},yLabelFormatter:function(u){return(0,s.FI)(parseFloat(u))}})}),o.network&&o.network.length>0&&(0,f.jsx)(n.Z,{colSpan:12,title:(0,f.jsx)(E.Z,{}),subTitle:"Network: ".concat((0,s.FI)(o.network[o.network.length-1].source.usage)," / ").concat((0,s.FI)(o.network[o.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,f.jsx)(v.Z,{yField:"usage",xField:"date",colorField:"type",data:o.network,yDomainMaxCallback:function(u){return u*2},yLabelFormatter:function(u){return(0,s.FI)(parseFloat(u))}})})]}),(0,f.jsx)(n.Z,{title:(0,f.jsx)(p.Z,{}),subTitle:"Progress",children:(0,f.jsx)(W.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:h==null?void 0:h.columns,dataSource:h==null?void 0:h.data,pagination:{pageSize:10}})})]})}},13822:function(k,C,e){e.d(C,{IE:function(){return l},IW:function(){return O},KK:function(){return L},LJ:function(){return E},RF:function(){return W},Re:function(){return n},aF:function(){return f},eE:function(){return c},jV:function(){return m}});var I=e(15009),t=e.n(I),A=e(99289),i=e.n(A),y=e(82346);function O(d){return M.apply(this,arguments)}function M(){return M=i()(t()().mark(function d(P){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/status",{method:"POST",data:P}));case 1:case"end":return a.stop()}},d)})),M.apply(this,arguments)}function l(d){return v.apply(this,arguments)}function v(){return v=i()(t()().mark(function d(P){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/get-list",{data:P,method:"POST"}));case 1:case"end":return a.stop()}},d)})),v.apply(this,arguments)}function m(d){return x.apply(this,arguments)}function x(){return x=i()(t()().mark(function d(P){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/get-detail",{data:P,method:"POST"}));case 1:case"end":return a.stop()}},d)})),x.apply(this,arguments)}function c(d){return _.apply(this,arguments)}function _(){return _=i()(t()().mark(function d(P){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/update",{data:P,method:"POST"}));case 1:case"end":return a.stop()}},d)})),_.apply(this,arguments)}function L(){return s.apply(this,arguments)}function s(){return s=i()(t()().mark(function d(){return t()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,y.request)("/api/app/container/prune",{method:"POST"}));case 1:case"end":return g.stop()}},d)})),s.apply(this,arguments)}function E(d){return p.apply(this,arguments)}function p(){return p=i()(t()().mark(function d(P){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/export",{method:"POST",data:P,responseType:"blob"}));case 1:case"end":return a.stop()}},d)})),p.apply(this,arguments)}function n(d){return R.apply(this,arguments)}function R(){return R=i()(t()().mark(function d(P){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/commit",{method:"POST",data:P}));case 1:case"end":return a.stop()}},d)})),R.apply(this,arguments)}function W(d){return B.apply(this,arguments)}function B(){return B=i()(t()().mark(function d(P){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/upgrade",{method:"POST",data:P}));case 1:case"end":return a.stop()}},d)})),B.apply(this,arguments)}function f(d){return j.apply(this,arguments)}function j(){return j=i()(t()().mark(function d(P){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/copy",{method:"POST",data:P}));case 1:case"end":return a.stop()}},d)})),j.apply(this,arguments)}},84410:function(k,C,e){e.d(C,{a:function(){return l},i:function(){return O}});var I=e(15009),t=e.n(I),A=e(99289),i=e.n(A),y=e(82346);function O(m){return M.apply(this,arguments)}function M(){return M=i()(t()().mark(function m(x){return t()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.abrupt("return",(0,y.request)("/api/app/container/get-stat-info",{method:"POST",data:x}));case 1:case"end":return _.stop()}},m)})),M.apply(this,arguments)}function l(m){return v.apply(this,arguments)}function v(){return v=i()(t()().mark(function m(x){return t()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.abrupt("return",(0,y.request)("/api/app/container/get-process-info",{method:"POST",data:x}));case 1:case"end":return _.stop()}},m)})),v.apply(this,arguments)}}}]);
