"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745,5947],{55809:function(B,E,e){var T=e(87462),n=e(67294),x=e(44805),m=e(84089),s=function(p,c){return n.createElement(m.Z,(0,T.Z)({},p,{ref:c,icon:x.Z}))},a=n.forwardRef(s);E.Z=a},60433:function(B,E,e){var T=e(87462),n=e(67294),x=e(69782),m=e(84089),s=function(p,c){return n.createElement(m.Z,(0,T.Z)({},p,{ref:c,icon:x.Z}))},a=n.forwardRef(s);E.Z=a},27619:function(B,E,e){e.d(E,{Z:function(){return b}});var T=e(97857),n=e.n(T),x=e(19632),m=e.n(x),s=e(5574),a=e.n(s),d=e(64183),p=e(63713),c=e(67294),y=e(85893);function b(i){var v,P=(0,c.useState)("academy"),L=a()(P,2),I=L[0],g=L[1],F=Math.max.apply(Math,m()(i.data.map(function(O){var r;return(r=O[i.yField])!==null&&r!==void 0?r:0}))),S=(0,p.useModel)("@@initialState"),M=S.initialState,f=S.loading,C=S.error,k=S.refresh,t=S.setInitialState,l={xField:i.xField,yField:i.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:i.yLabelFormatter},scale:{y:{domainMin:(v=i.yDomainMin)!==null&&v!==void 0?v:0,domainMax:i.yDomainMax?i.yDomainMax:i.yDomainMaxCallback?i.yDomainMaxCallback(F):F}},data:i.data};return i.yLabelFormatter&&(l.axis.y.labelFormatter=i.yLabelFormatter),i.colorField&&(l.colorField=i.colorField),(0,c.useEffect)(function(){(M==null?void 0:M.theme.algorithm)=="dark"?g("classicDark"):g("academy")},[M]),(0,y.jsx)(d.Z,n()({theme:I},l))}},71890:function(B,E,e){var T=e(15009),n=e.n(T),x=e(99289),m=e.n(x),s=e(67294);function a(d){var p=d.reqFunction,c=d.interval,y=d.maxPolling,b=d.pollingStatus,i=d.inPath,v=(0,s.useRef)(null),P=0,L=function g(){v.current=window.setTimeout(m()(n()().mark(function F(){var S;return n()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(P++>=y)){f.next=3;break}return I(),f.abrupt("return");case 3:if(f.prev=3,!(i&&window.location.href.indexOf(i)==-1)){f.next=7;break}return I(),f.abrupt("return");case 7:return f.next=9,p();case 9:S=f.sent,g(),f.next=17;break;case 13:f.prev=13,f.t0=f.catch(3),I(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",f.t0);case 17:case"end":return f.stop()}},F,null,[[3,13]])})),c)},I=function(){console.log("end polling"),v.current&&window.clearTimeout(v.current)};return(0,s.useEffect)(function(){return console.log((b?"start":"waiting")+" polling, max "+y),b&&L(),function(){I()}},[c,y,b]),{endPolling:I}}E.Z=a},24963:function(B,E,e){var T=e(67294),n=(0,T.createContext)({});E.Z=n},50070:function(B,E,e){e.r(E),e.d(E,{AppDetailContext:function(){return L},default:function(){return I}});var T=e(15009),n=e.n(T),x=e(99289),m=e.n(x),s=e(5574),a=e.n(s),d=e(24963),p=e(60335),c=e(55809),y=e(63713),b=e(25593),i=e(50136),v=e(67294),P=e(85893),L=(0,v.createContext)({});function I(){var g,F=(0,v.useContext)(d.Z),S=F.lang,M=F.loading,f=F.message,C=(0,y.useParams)(),k=(0,y.useSearchParams)(),t=a()(k,2),l=t[0],O=t[1],r=(g=l.get("tab"))!==null&&g!==void 0?g:"edit",W=(0,v.useState)("edit"),K=a()(W,2),$=K[0],j=K[1],G=(0,y.useNavigate)(),z=(0,v.useState)(1),_=a()(z,2),H=_[0],X=_[1],N=[{label:(0,P.jsx)(y.Link,{to:"/app/detail/edit/".concat(C.id,"?tab=edit"),children:"\u5BB9\u5668\u8BE6\u60C5"}),key:"edit"},{label:(0,P.jsx)(y.Link,{to:"/app/detail/network/".concat(C.id,"?tab=network"),children:"\u7F51\u7EDC\u7BA1\u7406"}),key:"network"},{label:(0,P.jsx)(b.Z.Link,{children:"\u6587\u4EF6\u7BA1\u7406"}),key:"file",onClick:function(){f.info(S("app.detail.createExplorerPlugin")),G("/app/detail/file/".concat(C.id,"?tab=file"))}},{label:(0,P.jsx)(b.Z.Link,{children:"\u8FD0\u884C\u65E5\u5FD7"}),key:"log",onClick:function(){G("/app/detail/log/".concat(C.id,"?tab=log"))}},{label:(0,P.jsx)(b.Z.Link,{children:"\u8FD0\u884C\u72B6\u6001"}),key:"stat",onClick:function(){G("/app/detail/stat/".concat(C.id,"?tab=stat"))}},{label:"",key:"containerName",icon:(0,P.jsx)(c.Z,{}),disabled:!0}],q=(0,v.useState)(N),Y=a()(q,2),ee=Y[0],V=Y[1];(0,v.useEffect)(function(){M.show(),j(r);var w=function(){var J=m()(n()().mark(function Q(){var D,u,o;return n()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return u=N,h.next=3,(0,p.jV)({md5:(D=C.id)!==null&&D!==void 0?D:""});case 3:o=h.sent,u.map(function(R){return R.key=="containerName"&&(R.label=o.data.info.Name),(!o.data.info.State.Running||o.data.info.State.Restarting)&&(R.key=="file"||R.key=="stat")&&(R.disabled=!0),R}),V(u),M.destroy();case 7:case"end":return h.stop()}},Q)}));return function(){return J.apply(this,arguments)}}();w()},[H]);var Z=function(J){j(J.key)};return(0,P.jsxs)(L.Provider,{value:{reload:function(){X(H+1)}},children:[(0,P.jsx)(i.Z,{mode:"horizontal",onClick:Z,selectedKeys:[$],items:ee}),(0,P.jsx)(y.Outlet,{})]})}},42223:function(B,E,e){e.r(E),e.d(E,{default:function(){return r}});var T=e(15009),n=e.n(T),x=e(99289),m=e.n(x),s=e(5574),a=e.n(s),d=e(19632),p=e.n(d),c=e(27619),y=e(71890),b=e(24963),i=e(63713);function v(W){return P.apply(this,arguments)}function P(){return P=m()(n()().mark(function W(K){return n()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.abrupt("return",(0,i.request)("/api/app/container/get-stat-info",{method:"POST",data:K}));case 1:case"end":return j.stop()}},W)})),P.apply(this,arguments)}function L(W){return I.apply(this,arguments)}function I(){return I=m()(n()().mark(function W(K){return n()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.abrupt("return",(0,i.request)("/api/app/container/get-process-info",{method:"POST",data:K}));case 1:case"end":return j.stop()}},W)})),I.apply(this,arguments)}var g=e(5251),F=e(12122),S=e(60433),M=e(38345),f=e(63490),C=e(67294),k=e(50070),t=e(85893),l=new Date().toLocaleTimeString(),O={total:0,memory:[{date:l,usage:0,source:{usage:0,limit:0}}],cpu:[{date:l,usage:0}],network:[{usage:0,type:"rx",date:l,source:{usage:0}},{usage:0,type:"tx",date:l,source:{usage:0}}],io:[{usage:0,type:"read",date:l,source:{usage:0}},{usage:0,type:"write",date:l,source:{usage:0}}]};function r(){var W=function(u,o){switch(o.type){case"update":var U=new Date(o.payload.read).toLocaleTimeString(),h=o.payload.cpu_stats.cpu_usage.total_usage-o.payload.precpu_stats.cpu_usage.total_usage,R=o.payload.cpu_stats.system_cpu_usage-o.payload.precpu_stats.system_cpu_usage,A={total:u.total+1,memory:[],cpu:[].concat(p()(u.cpu),[{date:U,usage:h/R*o.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return o.payload.memory_stats&&o.payload.memory_stats.limit&&o.payload.memory_stats.usage&&(A.memory=[].concat(p()(u.memory),[{date:U,usage:Math.round(o.payload.memory_stats.usage),source:{usage:o.payload.memory_stats.usage,limit:o.payload.memory_stats.limit}}])),o.payload.networks&&(A.network=[].concat(p()(u.network),[{date:U,usage:parseFloat(o.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:o.payload.networks.eth0.rx_bytes}},{date:U,usage:parseFloat(o.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:o.payload.networks.eth0.tx_bytes}}])),o.payload.blkio_stats&&o.payload.blkio_stats.io_service_bytes_recursive&&o.payload.blkio_stats.io_service_bytes_recursive.length>0&&(A.io=[].concat(p()(u.io),[{date:U,usage:parseFloat(o.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:o.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:o.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:U,usage:parseFloat(o.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:o.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:o.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),A}},K=(0,C.useContext)(b.Z),$=K.loading,j=(0,i.useParams)(),G=(0,C.useReducer)(W,O),z=a()(G,2),_=z[0],H=z[1],X=(0,C.useState)(0),N=a()(X,2),q=N[0],Y=N[1],ee=(0,C.useState)(),V=a()(ee,2),Z=V[0],w=V[1],J=(0,y.Z)({reqFunction:function(){var D=m()(n()().mark(function o(){var U,h;return n()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,v({id:(U=j.id)!==null&&U!==void 0?U:""});case 2:h=A.sent,$.destroy(),H({type:"update",payload:h});case 5:case"end":return A.stop()}},o)}));function u(){return D.apply(this,arguments)}return u}(),interval:3e3,maxPolling:999,pollingStatus:q!=0,inPath:"tab=stat"}),Q=(0,C.useContext)(k.AppDetailContext);return(0,C.useEffect)(function(){Q.reload()},[]),(0,C.useEffect)(function(){var D,u;$.show(),v({id:(D=j.id)!==null&&D!==void 0?D:""}).then(function(o){return Y(Math.round(o.memory_stats.limit)),!0}),L({id:(u=j.id)!==null&&u!==void 0?u:""}).then(function(o){var U={columns:[],data:[]};o.data.list.Titles.map(function(h){U.columns.push({title:h,label:h,dataIndex:h})}),o.data.list.Processes.map(function(h,R){U.data.push({UID:h[0],PID:h[1],PPID:h[2],C:h[3],STIME:h[4],TTY:h[5],TIME:h[6],CMD:h[7]})}),w(U)})},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(M.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[_.memory&&_.memory.length>0&&(0,t.jsx)(M.Z,{colSpan:12,title:(0,t.jsx)(F.Z,{}),subTitle:"Memory usage: ".concat((0,g.FI)(_.memory[_.memory.length-1].source.usage)," / ").concat((0,g.FI)(_.memory[_.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(c.Z,{yField:"usage",xField:"date",data:_.memory,yDomainMaxCallback:function(u){return u*2},yLabelFormatter:function(u){return(0,g.FI)(parseFloat(u))}})}),(0,t.jsx)(M.Z,{colSpan:12,title:(0,t.jsx)(F.Z,{}),subTitle:"Cpu usage: ".concat(_.cpu[_.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,t.jsx)(c.Z,{yField:"usage",xField:"date",data:_.cpu,yDomainMaxCallback:function(u){return u*1.5},yLabelFormatter:function(u){return"".concat(u,"%")}})}),_.io&&_.io.length>0&&(0,t.jsx)(M.Z,{colSpan:12,title:(0,t.jsx)(F.Z,{}),subTitle:"I/O: ".concat((0,g.FI)(_.io[_.io.length-1].source.usage)," / ").concat((0,g.FI)(_.io[_.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(c.Z,{yField:"usage",xField:"date",colorField:"type",data:_.io,yDomainMaxCallback:function(u){return u*2},yLabelFormatter:function(u){return(0,g.FI)(parseFloat(u))}})}),_.network&&_.network.length>0&&(0,t.jsx)(M.Z,{colSpan:12,title:(0,t.jsx)(F.Z,{}),subTitle:"Network: ".concat((0,g.FI)(_.network[_.network.length-1].source.usage)," / ").concat((0,g.FI)(_.network[_.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(c.Z,{yField:"usage",xField:"date",colorField:"type",data:_.network,yDomainMaxCallback:function(u){return u*2},yLabelFormatter:function(u){return(0,g.FI)(parseFloat(u))}})})]}),(0,t.jsx)(M.Z,{title:(0,t.jsx)(S.Z,{}),subTitle:"Progress",children:(0,t.jsx)(f.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:Z==null?void 0:Z.columns,dataSource:Z==null?void 0:Z.data,pagination:{pageSize:10}})})]})}},60335:function(B,E,e){e.d(E,{IE:function(){return p},IW:function(){return a},KK:function(){return P},LJ:function(){return I},RF:function(){return M},Re:function(){return F},aF:function(){return C},eE:function(){return i},jV:function(){return y}});var T=e(15009),n=e.n(T),x=e(99289),m=e.n(x),s=e(63713);function a(t){return d.apply(this,arguments)}function d(){return d=m()(n()().mark(function t(l){return n()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/app/container/status",{method:"POST",data:l}));case 1:case"end":return r.stop()}},t)})),d.apply(this,arguments)}function p(t){return c.apply(this,arguments)}function c(){return c=m()(n()().mark(function t(l){return n()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/app/container/get-list",{data:l,method:"POST"}));case 1:case"end":return r.stop()}},t)})),c.apply(this,arguments)}function y(t){return b.apply(this,arguments)}function b(){return b=m()(n()().mark(function t(l){return n()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/app/container/get-detail",{data:l,method:"POST"}));case 1:case"end":return r.stop()}},t)})),b.apply(this,arguments)}function i(t){return v.apply(this,arguments)}function v(){return v=m()(n()().mark(function t(l){return n()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/app/container/update",{data:l,method:"POST"}));case 1:case"end":return r.stop()}},t)})),v.apply(this,arguments)}function P(){return L.apply(this,arguments)}function L(){return L=m()(n()().mark(function t(){return n()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.abrupt("return",(0,s.request)("/api/app/container/prune",{method:"POST"}));case 1:case"end":return O.stop()}},t)})),L.apply(this,arguments)}function I(t){return g.apply(this,arguments)}function g(){return g=m()(n()().mark(function t(l){return n()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/app/container/export",{method:"POST",data:l,responseType:"blob"}));case 1:case"end":return r.stop()}},t)})),g.apply(this,arguments)}function F(t){return S.apply(this,arguments)}function S(){return S=m()(n()().mark(function t(l){return n()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/app/container/commit",{method:"POST",data:l}));case 1:case"end":return r.stop()}},t)})),S.apply(this,arguments)}function M(t){return f.apply(this,arguments)}function f(){return f=m()(n()().mark(function t(l){return n()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/app/container/upgrade",{method:"POST",data:l}));case 1:case"end":return r.stop()}},t)})),f.apply(this,arguments)}function C(t){return k.apply(this,arguments)}function k(){return k=m()(n()().mark(function t(l){return n()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/app/container/copy",{method:"POST",data:l}));case 1:case"end":return r.stop()}},t)})),k.apply(this,arguments)}},5251:function(B,E,e){e.d(E,{FI:function(){return n},NF:function(){return m},ZM:function(){return x}});function T(s){return s.trim()}function n(s){var a="";s<.1*1024?a=s.toFixed(2)+"B":s<.1*1024*1024?a=(s/1024).toFixed(2)+"KB":s<1*1024*1024*1024?a=(s/(1024*1024)).toFixed(2)+"MB":a=(s/(1024*1024*1024)).toFixed(2)+"GB";var d=a+"",p=d.indexOf("."),c=d.substring(p+1,p+3);return c=="00"?d.substring(0,p)+d.substr(p+3,2):a}function x(s){if(s){var a=new Date(s),d=a.getFullYear()+"-",p=(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-",c=(a.getDate()<10?"0"+a.getDate():a.getDate())+" ",y=(a.getHours()<10?"0"+a.getHours():a.getHours())+":",b=(a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes())+":",i=a.getSeconds()<10?"0"+a.getSeconds():a.getSeconds();return d+p+c+y+b+i}}function m(s){if(!s||s=="")return"-";var a=new Date(s),d=a.getUTCFullYear(),p=String(a.getUTCMonth()+1).padStart(2,"0"),c=String(a.getUTCDate()).padStart(2,"0"),y=String(a.getUTCHours()).padStart(2,"0"),b=String(a.getUTCMinutes()).padStart(2,"0"),i=String(a.getUTCSeconds()).padStart(2,"0");return"".concat(d,"-").concat(p,"-").concat(c," ").concat(y,":").concat(b,":").concat(i)}}}]);
