!(function(){var jt=Object.defineProperty,wt=Object.defineProperties;var Et=Object.getOwnPropertyDescriptors;var ht=Object.getOwnPropertySymbols;var Ot=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable;var vt=(re,A,e)=>A in re?jt(re,A,{enumerable:!0,configurable:!0,writable:!0,value:e}):re[A]=e,mt=(re,A)=>{for(var e in A||(A={}))Ot.call(A,e)&&vt(re,e,A[e]);if(ht)for(var e of ht(A))Ct.call(A,e)&&vt(re,e,A[e]);return re},ft=(re,A)=>wt(re,Et(A));(self.webpackChunk=self.webpackChunk||[]).push([[3647],{23430:function(re,A,e){"use strict";e.d(A,{Z:function(){return k}});var Q=e(87462),d=e(67294),G={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"},v=G,p=e(84089),_=function(i,n){return d.createElement(p.Z,(0,Q.Z)({},i,{ref:n,icon:v}))},b=d.forwardRef(_),k=b},1883:function(re,A,e){"use strict";var Q=e(87462),d=e(67294),G=e(3936),v=e(84089),p=function(k,t){return d.createElement(v.Z,(0,Q.Z)({},k,{ref:t,icon:G.Z}))},_=d.forwardRef(p);A.Z=_},81146:function(re,A,e){"use strict";var Q=e(97857),d=e.n(Q),G=e(15009),v=e.n(G),p=e(99289),_=e.n(p),b=e(67294),k=e(97269),t=e(62370),i=e(5966),n=e(97462),s=e(82346),o=e(71230),f=e(15746),a=e(34041),D=e(83622),E=e(84567),y=e(42075),O=e(80821),ee=e(23430),q=e(93162),j=e.n(q),C=e(78267),w=e.n(C),u=e(75458),U=e.n(u),ye=e(12323),Ce=e(4244),be=e.n(Ce),S=e(24078),Be=e(36146),W=e(85893),oe,fe,pe,Ie={decorations:{matchBackground:"",matchBorder:"#FFFF00",activeMatchBackground:"#FFFF0066",matchOverviewRuler:"",activeMatchColorOverviewRuler:""}},Ke=(0,b.forwardRef)(function(xe,Ne){var P=(0,b.useRef)(),R=(0,s.useModel)("subscriber"),$=new Be.Uo("components.containerLog");(0,b.useImperativeHandle)(Ne,function(){return{fit:function(){oe.clear(),pe.fit()},start:function(){return _()(v()().mark(function X(){return v()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,c({lineTotal:500});case 2:case"end":return r.stop()}},X)}))()},close:function(){R.progress.close(xe.id)}}});function c(Y){return ke.apply(this,arguments)}function ke(){return ke=_()(v()().mark(function Y(X){return v()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:R.progress.close(xe.id),oe.clear(),X.download=!1,xe.request(X);case 4:case"end":return r.stop()}},Y)})),ke.apply(this,arguments)}return(0,b.useEffect)(function(){return window.addEventListener("resize",function(){pe.fit()}),oe=new Ce.Terminal(d()(d()({},ye.X),{},{fontSize:12,lineHeight:1.2,allowProposedApi:!0})),pe=new C.FitAddon,fe=new u.SearchAddon({}),oe.loadAddon(pe),oe.loadAddon(fe),oe.open(document.getElementById("terminal-container-log")),pe.fit(),R.addDataHandler(xe.id,function(Y){oe.write(Y.data)}),function(){oe.clear(),oe.reset(),R.progress.close(xe.id)}},[]),(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(k.A,{submitter:!1,layout:"horizontal",onFinish:function(X){var te;c({id:xe.id,lineTotal:parseInt(X.lineTotal),showTime:(te=X.showTime)!==null&&te!==void 0?te:!1})},formRef:P,children:(0,W.jsxs)(o.Z,{gutter:[10,0],children:[(0,W.jsx)(f.Z,{span:8,children:(0,W.jsx)(t.Z,{name:"lineTotal",initialValue:"500",label:$.format("formLineTotal"),children:(0,W.jsxs)(a.Z,{defaultValue:"500",onChange:function(X){var te;(te=P.current)===null||te===void 0||te.submit()},children:[(0,W.jsx)(a.Z.Option,{value:"100",children:$.format("formLineTotalOption",{number:"100"})}),(0,W.jsx)(a.Z.Option,{value:"200",children:$.format("formLineTotalOption",{number:"200"})}),(0,W.jsx)(a.Z.Option,{value:"500",children:$.format("formLineTotalOption",{number:"500"})}),(0,W.jsx)(a.Z.Option,{value:"1000",children:$.format("formLineTotalOption",{number:"1000"})}),(0,W.jsx)(a.Z.Option,{value:"-1",children:$.format("formLineTotalOptionAll")})]})})}),(0,W.jsx)(f.Z,{children:(0,W.jsx)(D.ZP,{onClick:function(){oe.clear()},children:$.format("clearButton")})}),(0,W.jsx)(f.Z,{children:(0,W.jsx)(t.Z,{name:"showTime",valuePropName:"checked",children:(0,W.jsx)(E.Z,{onChange:function(X){var te;(te=P.current)===null||te===void 0||te.submit()},children:$.format("formShowTime")})})}),(0,W.jsx)(f.Z,{children:(0,W.jsx)(i.Z,{label:$.format("formKeywork"),name:"keywork",fieldProps:{onPressEnter:function(){var X;fe.findNext((X=P.current)===null||X===void 0?void 0:X.getFieldValue("keywork"),Ie)},onChange:function(X){fe.findNext(X.target.value,Ie)}},placeholder:$.format("formKeyworkEmpty")})}),(0,W.jsx)(f.Z,{children:(0,W.jsx)(n.Z,{name:["keywork"],children:function(X){var te=X.keywork;return(0,W.jsxs)(y.Z,{size:10,children:[(0,W.jsx)(D.ZP,{onClick:function(){fe.findNext(te,Ie)},children:$.format("formKeyworkNext")},"next"),(0,W.jsx)(D.ZP,{onClick:function(){fe.findPrevious(te,Ie)},children:$.format("formKeyworkPrev")},"prev")]})}})}),(0,W.jsx)(f.Z,{children:(0,W.jsx)(O.Z,{icon:(0,W.jsx)(ee.Z,{}),action:_()(v()().mark(function Y(){var X,te,r;return v()().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:if(!xe.download){ve.next=5;break}return ve.next=3,xe.download({lineTotal:parseInt((X=P.current)===null||X===void 0?void 0:X.getFieldValue("lineTotal")),showTime:(te=P.current)===null||te===void 0?void 0:te.getFieldValue("showTime")});case 3:r=ve.sent,(0,q.saveAs)(r.data,r.name);case 5:case"end":return ve.stop()}},Y)})),children:$.format("downloadButton")})})]})}),(0,W.jsx)("div",{style:{marginTop:"20px",height:xe.showInDrawer?"75vh":"85vh"},id:"terminal-container-log"})]})});A.Z=Ke},37413:function(re,A,e){"use strict";e.d(A,{Z:function(){return f}});var Q=e(19632),d=e.n(Q),G=e(36146),v=e(85577),p=e(58638),_=e(36693),b=e(35995),k=e(99611),t=e(38345),i=e(42075),n=e(66309),s=e(55241),o=e(85893);function f(a){var D,E=new G.Uo("components.containerPort"),y=[];a.publicPort&&(y=d()(a.publicPort)),a.privatePort&&(y=[].concat(d()(y),d()(a.privatePort)));var O=(D=a.serverIp)!==null&&D!==void 0?D:"localhost";if(O!=""&&O.indexOf("http")===-1&&O.indexOf(":")>-1&&(O="[".concat(O,"]")),O==""||O=="127.0.0.1"){var ee=document.location.protocol+"//"+document.location.hostname;O=ee}var q=(0,o.jsxs)(t.Z,{direction:a.layout=="inline"?"row":"column",style:{width:a.layout!="inline"?750:"auto"},ghost:!0,children:[y.length>0&&(0,o.jsx)(t.Z,{title:(0,o.jsx)(v.Z,{}),subTitle:E.format("cardPortTitle"),ghost:a.ghost,bodyStyle:{maxHeight:300,overflow:"auto",margin:"10px 0"},children:y.map(function(j,C){return O==""&&(O=j.IP),(0,o.jsx)(i.Z,{size:"large",wrap:!0,children:(0,o.jsx)(n.Z,{color:j.PublicPort?"#2db7f5":"warning",icon:j.PublicPort?(0,o.jsx)(p.Z,{}):"",style:{marginBottom:10,marginRight:15},children:j.PublicPort?(0,o.jsx)("a",{href:"".concat(O.indexOf("http")===0?O:"http://"+O,":").concat(j.PublicPort),target:"_blank",children:"".concat(j.PublicPort?j.IP+":"+j.PublicPort+" -> ":"").concat(j.PrivatePort,"/").concat(j.Type)},"link".concat(C)):"".concat(j.PrivatePort,"/").concat(j.Type)})},"space".concat(C))})}),a.domain&&a.domain.length>0&&(0,o.jsx)(t.Z,{title:(0,o.jsx)(_.Z,{}),subTitle:E.format("cardDomainTitle"),ghost:a.ghost,children:(0,o.jsx)(i.Z,{wrap:!0,style:{textAlign:"left"},children:a.domain&&a.domain.map(function(j,C){return(0,o.jsx)(n.Z,{color:"blue",icon:(0,o.jsx)(p.Z,{}),children:(0,o.jsx)("a",{href:j,target:"_blank",children:j})},"domain".concat(C))})})})]});return a.showInDetail?q:(0,o.jsx)(s.Z,{placement:"bottom",content:q,children:(0,o.jsxs)(i.Z,{direction:"vertical",children:[a.privatePort&&a.privatePort.length>0&&(0,o.jsxs)(n.Z,{color:"warning",icon:(0,o.jsx)(b.Z,{}),children:[E.format("portPrivate"),": ",a.privatePort.length]}),a.publicPort&&a.publicPort.length>0&&(0,o.jsxs)(n.Z,{color:"#2db7f5",icon:(0,o.jsx)(k.Z,{}),children:[E.format("protPublic"),": ",a.publicPort.length]}),a.domain&&a.domain.length>0&&(0,o.jsx)(n.Z,{color:"blue",icon:(0,o.jsx)(_.Z,{}),children:a.domainTitle?a.domainTitle:"".concat(E.format("domain"),": ").concat(a.domain.length)})]})})}},94359:function(re,A,e){"use strict";e.d(A,{Z:function(){return D}});var Q=e(5574),d=e.n(Q),G=e(3089),v=e(98165),p=e(18429),_=e(8751),b=e(66212),k=e(14313),t=e(30159),i=e(87740),n=e(50888),s=e(66309),o=e(83062),f=e(36146),a=e(85893);function D(E){var y,O,ee=new f.Uo("components.containerStatus"),q=E.status.split("."),j=d()(q,2),C=j[0],w=j[1],u="";u=ee.format(E.status,(y=E.statusValue)!==null&&y!==void 0?y:{});var U=(0,a.jsx)(a.Fragment,{});return w=="0"&&(U=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(G.Z,{}),color:"default",children:u})),w=="10"&&(U=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(v.Z,{spin:!0}),color:"processing",children:u})),w=="20"&&(U=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(p.Z,{}),color:"error",children:u})),w=="30"&&(U=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(_.Z,{}),color:"success",children:u})),w=="new"&&(U=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(b.Z,{}),children:u})),(w=="running"||w=="healthy"||w=="active"||w=="ready")&&(U=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(k.Z,{}),color:"success",children:u})),(w=="paused"||w=="pause"||w=="rollback_paused")&&(U=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(t.Z,{}),children:u})),(w=="waiting"||w=="starting"||w=="accepted")&&(U=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(i.Z,{}),children:u})),["deploying","pending","allocated","accepted","assigned","preparing","updating","rollback_started"].includes(w)&&(U=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(n.Z,{}),color:"processing",children:u})),(w=="error"||w=="down"||w=="failed")&&(U=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(p.Z,{}),color:"error",children:u})),["complete","completed","rollback_completed"].includes(w)&&(U=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(_.Z,{}),color:"success",children:u})),["exited","dead","removing","restarting","unhealthy","created","drain","unreachable","shutdown","rejected","remove","orphaned"].includes(w)&&(U=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(p.Z,{}),color:"warning",children:u})),(0,a.jsx)(o.Z,{placement:"top",title:(O=E.tip)!==null&&O!==void 0?O:"",children:U})}},98093:function(re,A,e){"use strict";e.d(A,{Z:function(){return te}});var Q=e(15009),d=e.n(Q),G=e(99289),v=e.n(G),p=e(5574),_=e.n(p),b=e(3616),k=e(184),t=e(62370),i=e(83622),n=e(67294),s=e(59252),o=e(24796),f=e(93529),a=e(91058),D=e(82034),E=e(10523),y=e(52255),O=e(38345),ee=e(5966),q=e(24739),j=e(30291),C=e(92398),w=e(24963),u=e(36146),U=e(42963),ye=e(42075),Ce=e(64317),be=e(75870),S=e(85893);function Be(){var r=new u.Uo("components.appForm");return(0,S.jsxs)(ye.Z.Compact,{children:[(0,S.jsx)(Ce.Z,{name:"imageRegistry",width:"sm",fieldProps:{popupMatchSelectWidth:!1},request:v()(d()().mark(function le(){var ve;return d()().wrap(function(Le){for(;;)switch(Le.prev=Le.next){case 0:return Le.next=2,(0,be.Ot)();case 2:return ve=Le.sent,Le.abrupt("return",ve.data.list.map(function(ze){return{label:"".concat(ze.title,"@").concat(ze.serverAddress),value:ze.id}}));case 4:case"end":return Le.stop()}},le)})),label:r.format("dockerImageImageName")}),(0,S.jsx)(ee.Z,{label:" ",name:"imageName",width:"lg"})]})}var W=e(86615),oe=e(97462),fe=e(31199),pe=e(86250),Ie=e(44349);function Ke(){var r,le=new u.Uo("components.appForm"),ve=(0,n.useContext)(U.Z),Ve=ve.createFormRef,Le=(0,n.useRef)();return(0,S.jsxs)(O.Z,{children:[(0,S.jsxs)(pe.Z,{gap:60,children:[(0,S.jsx)(W.Z.Group,{width:"md",label:le.format("createSchedulingLabel"),name:["scheduling","mode"],options:le.option("createSchedulingOption",["global","replicated"]),initialValue:"replicated",disabled:(r=Ve.current)===null||r===void 0?void 0:r.getFieldValue("id")}),(0,S.jsx)(oe.Z,{name:["scheduling"],children:function(Qe){var Me=Qe.scheduling;return Me.mode=="replicated"&&(0,S.jsx)(fe.Z,{width:"md",label:le.format("createSchedulingReplicas"),name:["scheduling","replicas"],initialValue:1})}})]}),(0,S.jsx)(oe.Z,{name:["scheduling"],children:function(Qe){var Me=Qe.scheduling;return Me.mode=="replicated"&&[(0,S.jsx)(W.Z.Group,{label:le.format("createConstraintNode"),initialValue:"all",name:["constraint","role"],options:le.option("createConstraintNodeOption",["all","manager","worker"])},"role"),(0,S.jsx)(Ie.Z,{name:["constraint","label"],label:le.format("createConstraintLabel"),hideCopyButton:!0,showAddButton:!0,gap:10,ref:Le,items:[{label:le.format("createConstraintLabelOption.name"),name:"name",width:"md",placeholder:"node.labels.name"},{name:"operator",render:function(ge,ne,ue){return(0,S.jsx)(Ce.Z,{label:" ",name:"operator",valueEnum:{"==":"==","!=":"!="},initialValue:"=="})}},{label:le.format("createConstraintLabelOption.value"),name:"value",width:"md"}]},"label"),(0,S.jsx)(Ie.Z,{name:"placement",label:le.format("createPlacementLabel"),hideCopyButton:!0,showAddButton:!0,gap:10,items:[{name:"name",render:function(ge,ne,ue){return(0,S.jsx)(Ce.Z,{label:" ",name:"type",options:le.option("createPlacementOption",["spread"]),initialValue:"spread",allowClear:!1,width:"sm"})}},{label:le.format("createConstraintLabelOption.value"),name:"value",width:"md",placeholder:"node.labels.hostname"}]},"placement")]}})]})}var xe=e(73396),Ne=e(55730),P=e(33879);function R(){var r=new u.Uo("components.appForm");return(0,S.jsx)(O.Z,{children:(0,S.jsxs)(pe.Z,{gap:30,children:[(0,S.jsx)(Ce.Z,{label:r.format("createAdvRestart"),name:["restart","name"],width:"sm",initialValue:"any",options:r.option("createAdvRestartOption",["none","on-failure","any"])}),(0,S.jsx)(oe.Z,{name:["restart"],children:function(ve){var Ve=ve.restart;return Ve=="on-failure"&&(0,S.jsx)(fe.Z,{width:"sm",label:r.format("createAdvRestartMax"),name:["restart","maxAttempt"],initialValue:5})}}),(0,S.jsx)(fe.Z,{width:"sm",label:r.format("createAdvRestartDelay"),tooltip:r.format("createAdvRestartDelayTip"),name:["restart","delay"],initialValue:5,fieldProps:{addonAfter:u.FD.format("unitSecond")}}),(0,S.jsx)(fe.Z,{width:"sm",label:r.format("createAdvRestartWindow"),tooltip:r.format("createAdvRestartWindowTip"),name:["restart","window"],initialValue:0,fieldProps:{addonAfter:u.FD.format("unitSecond")}})]})})}function $(){var r=new u.Uo("components.appForm");return(0,S.jsxs)(O.Z,{children:[(0,S.jsxs)(pe.Z,{gap:30,children:[(0,S.jsx)(fe.Z,{label:r.format("createSwarmUpdateParallelism"),name:["scheduling","update","parallelism"],initialValue:1}),(0,S.jsx)(fe.Z,{label:r.format("createSwarmUpdateDelay"),name:["scheduling","update","delay"],initialValue:0,fieldProps:{addonAfter:u.FD.format("unitSecond")}})]}),(0,S.jsx)(W.Z.Group,{label:r.format("createSwarmUpdateFailureAction"),name:["scheduling","update","failureAction"],initialValue:"pause",options:r.option("createSwarmUpdateFailureActionOption",["pause","continue","rollback"])}),(0,S.jsx)(W.Z.Group,{label:r.format("createSwarmUpdateOrder"),name:["scheduling","update","order"],initialValue:"stop-first",options:r.option("createSwarmUpdateOrderOption",["stop-first","start-first"])})]})}var c=e(64412),ke=e(24494),Y=e(27323),X=(0,n.forwardRef)(function(r,le){(0,n.useImperativeHandle)(le,function(){return{edit:function(g){var m,L,Pe,ae,he,$e,Te,h,me,je,Ee,we,Ae,Ue,Oe,Ze,Re,M,T,x,H,F,J,ie,Se,Fe,He,We,Ge,rt,Ye,at,it,nt,st,ot={id:g.ID,siteName:(m=(L=g.Spec)===null||L===void 0?void 0:L.Name)!==null&&m!==void 0?m:"",siteTitle:((Pe=g.Spec)===null||Pe===void 0?void 0:Pe.Labels)&&((ae=g.Spec)===null||ae===void 0?void 0:ae.Labels[ke.$m]),hostname:(he=g.Spec)===null||he===void 0||(he=he.TaskTemplate)===null||he===void 0||(he=he.ContainerSpec)===null||he===void 0?void 0:he.Hostname,imageName:($e=(Te=g.Spec)===null||Te===void 0||(Te=Te.TaskTemplate)===null||Te===void 0||(Te=Te.ContainerSpec)===null||Te===void 0?void 0:Te.Image)!==null&&$e!==void 0?$e:"",environment:(h=g.Spec)===null||h===void 0||(h=h.TaskTemplate)===null||h===void 0||(h=h.ContainerSpec)===null||h===void 0||(h=h.Env)===null||h===void 0?void 0:h.map(function(l){var N=l.split("=");return{name:N[0],value:N.slice(1).join("=")}}),volumes:(me=g.Spec)===null||me===void 0||(me=me.TaskTemplate)===null||me===void 0||(me=me.ContainerSpec)===null||me===void 0||(me=me.Mounts)===null||me===void 0?void 0:me.map(function(l){var N,se;return{dest:(N=l.Target)!==null&&N!==void 0?N:"",host:(se=l.Source)!==null&&se!==void 0?se:"",type:l.Type,permission:l.ReadOnly?"readonly":"write"}}),restartPolicy:function(l,N){return{name:(N=l.Condition)!==null&&N!==void 0?N:"any",maxAttempt:l.MaxAttempts,window:l.Window,delay:l.Delay}}(((je=g.Spec)===null||je===void 0||(je=je.TaskTemplate)===null||je===void 0?void 0:je.RestartPolicy)||{}),cpus:function(l){return l?l/1e9:0}((Ee=g.Spec)===null||Ee===void 0||(Ee=Ee.TaskTemplate)===null||Ee===void 0||(Ee=Ee.Resources)===null||Ee===void 0||(Ee=Ee.Limits)===null||Ee===void 0?void 0:Ee.NanoCPUs),memory:function(l){return l?l/1024/1024:0}((we=g.Spec)===null||we===void 0||(we=we.TaskTemplate)===null||we===void 0||(we=we.Resources)===null||we===void 0||(we=we.Limits)===null||we===void 0?void 0:we.MemoryBytes),workDir:{useDefault:!((Ae=g.Spec)!==null&&Ae!==void 0&&(Ae=Ae.TaskTemplate)!==null&&Ae!==void 0&&(Ae=Ae.ContainerSpec)!==null&&Ae!==void 0&&Ae.Dir),default:"",value:(Ue=g.Spec)===null||Ue===void 0||(Ue=Ue.TaskTemplate)===null||Ue===void 0||(Ue=Ue.ContainerSpec)===null||Ue===void 0?void 0:Ue.Dir},user:{useDefault:!((Oe=g.Spec)!==null&&Oe!==void 0&&(Oe=Oe.TaskTemplate)!==null&&Oe!==void 0&&(Oe=Oe.ContainerSpec)!==null&&Oe!==void 0&&Oe.User),default:"",value:(Ze=g.Spec)===null||Ze===void 0||(Ze=Ze.TaskTemplate)===null||Ze===void 0||(Ze=Ze.ContainerSpec)===null||Ze===void 0?void 0:Ze.User},command:{useDefault:!((Re=g.Spec)!==null&&Re!==void 0&&(Re=Re.TaskTemplate)!==null&&Re!==void 0&&(Re=Re.ContainerSpec)!==null&&Re!==void 0&&Re.Command),default:"",value:(M=g.Spec)===null||M===void 0||(M=M.TaskTemplate)===null||M===void 0||(M=M.ContainerSpec)===null||M===void 0||(M=M.Command)===null||M===void 0?void 0:M.join(" ")},log:function(l,N){return{driver:(N=l==null?void 0:l.Name)!==null&&N!==void 0?N:"json-file",maxFile:(l==null?void 0:l.Options)&&l.Options["max-file"],maxSize:(l==null?void 0:l.Options)&&l.Options["max-size"]}}((T=g.Spec)===null||T===void 0||(T=T.TaskTemplate)===null||T===void 0?void 0:T.LogDriver),dns:(x=g.Spec)===null||x===void 0||(x=x.TaskTemplate)===null||x===void 0||(x=x.ContainerSpec)===null||x===void 0||(x=x.DNSConfig)===null||x===void 0?void 0:x.Nameservers,label:((H=g.Spec)===null||H===void 0||(H=H.TaskTemplate)===null||H===void 0||(H=H.ContainerSpec)===null||H===void 0?void 0:H.Labels)&&Object.entries((F=g.Spec)===null||F===void 0||(F=F.TaskTemplate)===null||F===void 0||(F=F.ContainerSpec)===null||F===void 0?void 0:F.Labels).map(function(l){return{name:l[0],value:l[1]}}),extraHosts:((J=g.Spec)===null||J===void 0||(J=J.TaskTemplate)===null||J===void 0||(J=J.ContainerSpec)===null||J===void 0?void 0:J.Hosts)&&((ie=g.Spec)===null||ie===void 0||(ie=ie.TaskTemplate)===null||ie===void 0||(ie=ie.ContainerSpec)===null||ie===void 0?void 0:ie.Hosts.map(function(l){var N=l.split(":"),se=_()(N,2),Je=se[0],qe=se[1];return{name:Je,value:qe}})),capAdd:(Se=g.Spec)===null||Se===void 0||(Se=Se.TaskTemplate)===null||Se===void 0||(Se=Se.ContainerSpec)===null||Se===void 0?void 0:Se.CapabilityAdd,scheduling:function(l){return{mode:l!=null&&l.Global?"global":"replicated",replicas:l!=null&&l.Replicated?l.Replicated.Replicas:1}}((Fe=g.Spec)===null||Fe===void 0?void 0:Fe.Mode),constraint:function(l,N,se){var Je="all";l!=null&&(N=l.Constraints)!==null&&N!==void 0&&N.includes("node.role==worker")&&(Je="worker"),l!=null&&(se=l.Constraints)!==null&&se!==void 0&&se.includes("node.role==manager")&&(Je="manager");var qe=[],tt=[];return l!=null&&l.Constraints&&l.Constraints.forEach(function(et){if(et.includes("node.lablels.node==")){var pt=et.split("node.lablels.node=="),dt=_()(pt,2),Rt=dt[0],gt=dt[1];qe.push(gt);return}if(et.includes("==")){var _t=et.split("=="),ut=_()(_t,2),St=ut[0],Dt=ut[1];tt.push({name:St,value:Dt,operator:"=="});return}if(et.includes("!=")){var Tt=et.split("!="),ct=_()(Tt,2),xt=ct[0],Pt=ct[1];tt.push({name:xt,value:Pt,operator:"!="});return}}),{role:Je,node:qe,label:tt}}((He=g.Spec)===null||He===void 0||(He=He.TaskTemplate)===null||He===void 0?void 0:He.Placement),placement:((We=g.Spec)===null||We===void 0||(We=We.TaskTemplate)===null||We===void 0||(We=We.Placement)===null||We===void 0?void 0:We.Preferences)&&Object.entries((Ge=g.Spec)===null||Ge===void 0||(Ge=Ge.TaskTemplate)===null||Ge===void 0||(Ge=Ge.Placement)===null||Ge===void 0?void 0:Ge.Preferences).map(function(l){var N,se;return{name:"spread",value:(N=(se=l[1].Spread)===null||se===void 0?void 0:se.SpreadDescriptor)!==null&&N!==void 0?N:""}}),update:function(l,N,se){return{parallelism:(N=l==null?void 0:l.Parallelism)!==null&&N!==void 0?N:1,delay:(se=l==null?void 0:l.Delay)!==null&&se!==void 0?se:0,failureAction:l==null?void 0:l.FailureAction,order:l==null?void 0:l.Order}}((rt=g.Spec)===null||rt===void 0?void 0:rt.UpdateConfig),healthcheck:function(l,N,se,Je,qe,tt){var et=l!=null&&(N=l.Test)!==null&&N!==void 0&&N.includes("CMD-SHELL")?"CMD-SHELL":"CMD";return{interval:(se=l==null?void 0:l.Interval)!==null&&se!==void 0?se:30,timeout:(Je=l==null?void 0:l.Timeout)!==null&&Je!==void 0?Je:10,retries:(qe=l==null?void 0:l.Retries)!==null&&qe!==void 0?qe:3,cmd:l!=null&&l.Test?l==null||(tt=l.Test)===null||tt===void 0?void 0:tt.join(" "):"",shellType:et}}((Ye=g.Spec)===null||Ye===void 0||(Ye=Ye.TaskTemplate)===null||Ye===void 0||(Ye=Ye.ContainerSpec)===null||Ye===void 0?void 0:Ye.Healthcheck)},lt=((at=g.Spec)===null||at===void 0?void 0:at.Labels)&&((it=g.Spec)===null||it===void 0?void 0:it.Labels[ke.ev]);if(lt&&(ot.imageRegistry=parseInt(lt)),(nt=g.Spec)!==null&&nt!==void 0&&(nt=nt.EndpointSpec)!==null&&nt!==void 0&&nt.Ports){var Xe;ot.ports=(Xe=g.Spec)===null||Xe===void 0||(Xe=Xe.EndpointSpec)===null||Xe===void 0||(Xe=Xe.Ports)===null||Xe===void 0?void 0:Xe.map(function(l){return{dest:String(l.TargetPort),host:String(l.PublishedPort),mode:l.PublishMode}})}(st=ue.current)===null||st===void 0||st.setFieldsValue(ot),B(!0)}}});var ve=(0,n.useContext)(w.Z),Ve=ve.loading,Le=ve.notice,ze=(0,n.useState)("basic"),Qe=_()(ze,2),Me=Qe[0],V=Qe[1],ge=new u.Uo("components.appForm"),ne=new u.Uo("swarm"),ue=(0,n.useRef)(),De=(0,n.useRef)(),_e=(0,n.useRef)(),ce=(0,n.useRef)(),de=(0,n.useRef)(),z=(0,n.useState)(!1),Z=_()(z,2),I=Z[0],B=Z[1];return(0,S.jsx)(U.Z.Provider,{value:{createFormRef:ue,volumeListRef:De,createEnvRef:de,createLinkRef:ce,domainRef:_e},children:(0,S.jsx)(k.a,{drawerProps:{width:b.R_,forceRender:r.forceRender},formRef:ue,title:ne.format("serviceCreateTitle.".concat(r.forceRender?"edit":"create")),onOpenChange:function(g){if(B(g),!g){var m,L;!((m=ue.current)===null||m===void 0)&&m.resetFields&&((L=ue.current)===null||L===void 0||L.resetFields()),V("basic")}},open:I,trigger:r.showTrigger?(0,S.jsx)(i.ZP,{type:"primary",children:ne.format("serviceCreateTitle.create")}):void 0,onFinish:function(){var K=v()(d()().mark(function g(m){var L;return d()().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return L={id:m.id,siteTitle:m.siteTitle,siteName:m.siteName,hostname:m.hostname,imageRegistry:m.imageRegistry,imageName:m.imageName,ports:m.ports,environment:m.environment,volumes:m.volumes,restartPolicy:m.restart,cpus:m.cpus,memory:m.memory,workDir:m.workDir&&!m.workDir.useDefault?m.workDir.value:"",user:m.user&&!m.user.useDefault?m.user.value:"",command:m.command&&!m.command.useDefault?m.command.value:"",entrypoint:m.entrypoint&&!m.entrypoint.useDefault?m.entrypoint.value:"",log:m.log,dns:m.dns,label:m.label,extraHosts:m.extraHosts,capAdd:m.capAdd,scheduling:m.scheduling,constraint:m.constraint,placement:m.placement,update:m.update},m.healthcheck&&m.healthcheck.cmd&&m.healthcheck.cmd!=""&&(L.healthcheck=m.healthcheck),ae.next=4,(0,ke.P3)(L);case 4:return r.onFinish&&r.onFinish(),ae.abrupt("return",!0);case 6:case"end":return ae.stop()}},g)}));return function(g){return K.apply(this,arguments)}}(),children:(0,S.jsxs)(O.Z,{direction:"column",gutter:[0,10],ghost:!0,children:[(0,S.jsxs)(O.Z,{children:[(0,S.jsx)(t.Z,{name:"id",hidden:!0}),(0,S.jsx)(ee.Z,{name:"siteTitle",label:u.FD.format("listDescription"),placeholder:ne.format("serviceCreateListDescriptionEmpty")}),(0,S.jsxs)(q.UW,{children:[(0,S.jsx)(ee.Z,{width:"lg",name:"siteName",label:u.FD.format("listName"),required:!0,rules:[{required:!0}],placeholder:ne.format("serviceCreateListNameEmpty")}),(0,S.jsx)(ee.Z,{label:"Hostname",name:"hostname",width:"md"})]}),(0,S.jsx)(Be,{})]}),(0,S.jsx)(j.Z,{offsetTop:50,children:(0,S.jsx)(O.Z,{style:{marginBottom:-20},children:(0,S.jsx)(C.Z,{activeKey:Me,onChange:function(g){V(g),window.scrollTo(0,450)},items:ge.option("createTabOption",["basic","scheduling","run-command","cap","other"]).map(function(K){return{label:K.label,key:K.value}})})})}),(0,S.jsxs)(y.Z,{show:Me=="basic",children:[(0,S.jsx)(D.Z,{showIngress:!0}),(0,S.jsx)(a.Z,{showAddButton:!0,showImportButton:!0,showCodeMode:!0,label:ge.format("createEnvTitle"),ref:de}),(0,S.jsx)(E.Z,{showDefault:!0,ref:De,showType:!0}),(0,S.jsx)(s.Z,{})]}),(0,S.jsxs)(y.Z,{show:Me=="scheduling",children:[(0,S.jsx)(Ke,{}),(0,S.jsx)($,{})]}),(0,S.jsxs)(y.Z,{show:Me=="run-command",children:[(0,S.jsx)(R,{}),(0,S.jsx)(P.Z,{showCommand:!0,showUser:!0,showWorkDir:!0}),(0,S.jsx)(xe.Z,{}),(0,S.jsx)(Ne.Z,{}),(0,S.jsx)(c.Z,{}),(0,S.jsx)(Y.Z,{})]}),(0,S.jsx)(y.Z,{show:Me=="other",children:(0,S.jsx)(o.Z,{})}),(0,S.jsx)(y.Z,{show:Me=="cap",children:(0,S.jsx)(f.Z,{})})]})})})}),te=X},94617:function(re,A,e){"use strict";e.d(A,{Z:function(){return Me}});var Q=e(15009),d=e.n(Q),G=e(99289),v=e.n(G),p=e(97857),_=e.n(p),b=e(5574),k=e.n(b),t=e(24494),i=e(5251),n=e(36146),s=e(86548),o=e(1883),f=e(74763),a=e(56729),D=e(42075),E=e(66309),y=e(25593),O=e(96074),ee=e(83062),q=e(60940),j=e(37413),C=e(94359),w=e(67294),u=e(87662),U=e(78451),ye=e(3616),Ce=e(33160),be=e(43425),S=e(57132),Be=e(71965),W=e(48689),oe=e(45605),fe=e(60433),pe=e(38345),Ie=e(97269),Ke=e(24739),xe=e(31199),Ne=e(62370),P=e(64317),R=e(85265),$=e(86250),c=e(83622),ke=e(84567),Y=e(26412),X=e(80821),te=e(76428),r=e(85893);function le(V){var ge,ne,ue=new n.Uo("swarm"),De=V.detail;if((ge=De.Spec)!==null&&ge!==void 0&&(ge=ge.Mode)!==null&&ge!==void 0&&ge.Replicated){var _e;return(0,r.jsxs)(D.Z,{children:[(0,r.jsx)(E.Z,{children:ue.format("listServiceMode.replicated")}),(0,r.jsx)(E.Z,{color:"success",bordered:!1,children:(_e=De.ServiceStatus)===null||_e===void 0?void 0:_e.RunningTasks}),(0,r.jsx)(E.Z,{color:"gold",bordered:!1,children:De.Spec.Mode.Replicated.Replicas})]})}else if((ne=De.Spec)!==null&&ne!==void 0&&(ne=ne.Mode)!==null&&ne!==void 0&&ne.Global)return(0,r.jsx)(E.Z,{children:ue.format("listServiceMode.global")})}var ve=e(81146);function Ve(V){var ge=(0,w.useState)(!1),ne=k()(ge,2),ue=ne[0],De=ne[1],_e=(0,w.useRef)();return(0,r.jsxs)(r.Fragment,{children:[V.trigger?w.cloneElement(V.trigger,{onClick:function(){De(!0)}}):null,(0,r.jsx)(R.Z,{title:"".concat(n.FD.format("listLog")," - ").concat(V.detail.name),open:ue,forceRender:!0,onClose:function(){De(!1)},afterOpenChange:function(de){if(de)setTimeout(function(){var Z,I;(Z=_e.current)===null||Z===void 0||Z.start(),(I=_e.current)===null||I===void 0||I.fit()},1e3);else{var z;(z=_e.current)===null||z===void 0||z.close()}},width:ye.FK,children:ue&&(0,r.jsx)(ve.Z,{ref:_e,showInDrawer:!0,id:"swarm:log:".concat(V.type,":").concat(V.detail.id),request:function(){var ce=v()(d()().mark(function de(z){var Z;return d()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,(0,t.m8)({id:V.detail.id,type:V.type,lineTotal:z.lineTotal,download:(Z=z.download)!==null&&Z!==void 0?Z:!1,showTime:z.showTime});case 2:case"end":return B.stop()}},de)}));return function(de){return ce.apply(this,arguments)}}(),download:function(){var ce=v()(d()().mark(function de(z){var Z;return d()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,(0,t.Id)({id:V.detail.id,type:V.type,lineTotal:z.lineTotal,showTime:z.showTime,download:!0});case 2:return Z=B.sent,B.abrupt("return",{data:new Blob([Z],{type:"text/plain"}),name:V.detail.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return B.stop()}},de)}));return function(de){return ce.apply(this,arguments)}}()})})]})}var Le=e(98093),ze=(0,w.forwardRef)(function(V,ge){var ne,ue,De,_e,ce,de,z,Z,I,B,K,g,m;(0,w.useImperativeHandle)(ge,function(){return{show:function(T){me(T),he(!0)}}});var L=(0,w.useState)(!1),Pe=k()(L,2),ae=Pe[0],he=Pe[1],$e=(0,w.useState)(),Te=k()($e,2),h=Te[0],me=Te[1],je=new n.Uo("swarm"),Ee=(0,w.useState)(""),we=k()(Ee,2),Ae=we[0],Ue=we[1],Oe=(0,w.useRef)(),Ze=(0,w.useRef)(),Re=(0,w.useRef)();return(0,w.useEffect)(function(){(0,u.K3)().then(function(M){var T;Ue((T=M.data.serverUrl)!==null&&T!==void 0?T:"")})},[]),(0,r.jsxs)(R.Z,{title:je.format("serviceDetailTitle",{name:h==null||(ne=h.Spec)===null||ne===void 0?void 0:ne.Name}),open:ae,forceRender:!0,width:ye.R_,onClose:function(){he(!1),me(void 0),V.onFinish&&V.onFinish()},extra:[h&&(0,r.jsx)(X.Z,{type:"link",tips:n.FD.format("listManageRefresh"),action:v()(d()().mark(function M(){var T,x;return d()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,(0,t.ig)({id:h.ID});case 2:x=F.sent,me(x.data.info),!((T=Re.current)===null||T===void 0)&&T.reloadAndRest&&Re.current.reloadAndRest();case 5:case"end":return F.stop()}},M)})),icon:(0,r.jsx)(Ce.Z,{})},"refresh")],children:[(0,r.jsx)(Le.Z,{forceRender:!0,ref:Ze,onFinish:v()(d()().mark(function M(){var T,x;return d()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,(0,t.ig)({id:(T=h==null?void 0:h.ID)!==null&&T!==void 0?T:""});case 2:x=F.sent,me(x.data.info);case 4:case"end":return F.stop()}},M)}))}),(0,r.jsxs)($.Z,{vertical:!0,gap:20,children:[(0,r.jsx)(pe.Z,{title:(0,r.jsx)(be.Z,{}),ghost:!0,subTitle:n.FD.format("listManage"),children:(0,r.jsxs)(D.Z,{wrap:!0,children:[h&&(0,r.jsx)(c.ZP,{type:"primary",icon:(0,r.jsx)(s.Z,{}),onClick:function(){var T;(T=Ze.current)===null||T===void 0||T.edit(h)},children:n.FD.format("listManageEdit")}),(0,r.jsx)(O.Z,{type:"vertical"}),h&&(0,r.jsx)(Ve,{type:"service",detail:{id:(ue=h.ID)!==null&&ue!==void 0?ue:"",name:(De=(_e=h.Spec)===null||_e===void 0?void 0:_e.Name)!==null&&De!==void 0?De:""},trigger:(0,r.jsx)(c.ZP,{icon:(0,r.jsx)(o.Z,{}),children:n.FD.format("listManageLog")},"log")}),(h==null||(ce=h.Spec)===null||ce===void 0||(ce=ce.Mode)===null||ce===void 0?void 0:ce.Replicated)&&(0,r.jsx)(X.Z,{confirmProps:{forceRender:!0},action:v()(d()().mark(function M(){var T,x,H;return d()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.abrupt("return",(0,t.x$)({name:(T=h==null?void 0:h.ID)!==null&&T!==void 0?T:"",replicas:(x=Oe.current)===null||x===void 0?void 0:x.getFieldValue("replicas"),force:(H=Oe.current)===null||H===void 0?void 0:H.getFieldValue("force")}));case 1:case"end":return J.stop()}},M)})),confirmOnOpenChange:function(){var T,x;(T=Oe.current)===null||T===void 0||T.setFieldsValue({replicas:(x=h.Spec)===null||x===void 0||(x=x.Mode)===null||x===void 0||(x=x.Replicated)===null||x===void 0?void 0:x.Replicas,force:!1})},confirm:(0,r.jsx)(Ie.A,{layout:"inline",submitter:!1,formRef:Oe,children:(0,r.jsxs)(D.Z,{direction:"vertical",size:[0,15],style:{width:600},children:[(0,r.jsx)(y.Z.Text,{children:je.format("serviceManageScalingTip")}),(0,r.jsxs)(Ke.UW,{children:[(0,r.jsx)(xe.Z,{label:je.format("serviceManageScalingReplicas"),width:"sm",name:"replicas"}),(0,r.jsx)(Ne.Z,{name:"force",valuePropName:"checked",children:(0,r.jsxs)(ke.Z,{children:[n.FD.format("listManageDeployForce"),"\uFF1F"]})})]})]})}),onSuccess:function(){(0,t.ig)({id:h.ID}).then(function(T){me(T.data.info)})},icon:(0,r.jsx)(S.Z,{}),children:n.FD.format("listManageScaling")}),h&&(0,r.jsx)(X.Z,{action:function(){return(0,t.x$)({name:h.ID,rollback:!0})},icon:(0,r.jsx)(Be.Z,{}),confirm:"notification.confirm.title",children:n.FD.format("listManageRollback")}),(0,r.jsx)(X.Z,{showDivider:!0,action:function(){var T;return(0,t.tm)({name:[(T=h==null?void 0:h.ID)!==null&&T!==void 0?T:""]})},type:"primary",danger:!0,onSuccess:function(T){he(!1),V.onFinish&&V.onFinish()},confirm:"notification.confirm.title",icon:(0,r.jsx)(W.Z,{}),children:n.FD.format("listManageDelete")})]})}),h&&(0,r.jsx)(j.Z,{publicPort:((de=h.Endpoint)===null||de===void 0?void 0:de.Ports)&&((z=h.Endpoint)===null||z===void 0?void 0:z.Ports.map(function(M){var T,x,H;return{PrivatePort:(T=M.TargetPort)!==null&&T!==void 0?T:0,Type:(x=M.Protocol)!==null&&x!==void 0?x:"tcp",IP:"",PublicPort:(H=M.PublishedPort)!==null&&H!==void 0?H:0}})),serverIp:Ae,showInDetail:!0,ghost:!0,layout:"inline"}),(0,r.jsx)(pe.Z,{title:(0,r.jsx)(oe.Z,{}),subTitle:n.FD.format("listManageDetail"),ghost:!0,children:(0,r.jsxs)(Y.Z,{column:1,bordered:!0,styles:{label:{width:150}},children:[(0,r.jsxs)(Y.Z.Item,{label:n.FD.format("listTitle"),children:[(0,r.jsx)(te.Z,{title:h==null?void 0:h.ID})," - ",h==null||(Z=h.Spec)===null||Z===void 0?void 0:Z.Name,h&&((I=h.UpdateStatus)===null||I===void 0?void 0:I.State)&&(0,r.jsxs)(r.Fragment,{children:[" - ",(0,r.jsx)(C.Z,{status:"service.".concat((B=h.UpdateStatus)===null||B===void 0?void 0:B.State)})]})]}),(0,r.jsx)(Y.Z.Item,{label:n.FD.format("listDescription"),children:(h==null||(K=h.Spec)===null||K===void 0?void 0:K.Labels)&&h.Spec.Labels[t.$m]}),(0,r.jsx)(Y.Z.Item,{label:n.FD.format("listRunTask"),children:(0,r.jsx)(D.Z,{children:(h==null?void 0:h.ServiceStatus)&&Object.keys(h.ServiceStatus).map(function(M){var T=M;return(h==null?void 0:h.ServiceStatus)&&(0,r.jsx)(ee.Z,{title:je.format("listServiceStatusTip.".concat(T)),children:(0,r.jsxs)(E.Z,{color:je.format("listServiceStatusColor.".concat(T)),bordered:!1,children:[je.format("listServiceStatus.".concat(T))," ",h==null?void 0:h.ServiceStatus[T]]})},T)})})}),(0,r.jsx)(Y.Z.Item,{label:n.FD.format("listServiceMode"),children:h&&(0,r.jsx)(le,{detail:h})}),(0,r.jsx)(Y.Z.Item,{label:n.FD.format("listImageName"),children:h==null||(g=h.Spec)===null||g===void 0||(g=g.TaskTemplate)===null||g===void 0||(g=g.ContainerSpec)===null||g===void 0?void 0:g.Image}),(0,r.jsx)(Y.Z.Item,{label:n.FD.format("listVersion"),children:h==null||(m=h.Version)===null||m===void 0?void 0:m.Index}),(0,r.jsx)(Y.Z.Item,{label:n.FD.format("listCreatedAt"),children:(0,i.NF)(h==null?void 0:h.CreatedAt)}),(0,r.jsx)(Y.Z.Item,{label:n.FD.format("listUpdatedAt"),children:(0,i.NF)(h==null?void 0:h.UpdatedAt)})]})}),h&&(0,r.jsx)(pe.Z,{title:(0,r.jsx)(fe.Z,{}),subTitle:je.format("listTaskTitle"),ghost:!0,children:(0,r.jsx)(a.Z,{scroll:{x:"max-content"},rowKey:"ID",search:{filterType:"light"},actionRef:Re,columns:[{search:!1,title:n.FD.format("listName"),render:function(T,x,H,F,J){return x.ID}},{search:!1,width:200,title:n.FD.format("listNodeName"),render:function(T,x,H,F,J){return x.NodeID}},{search:!1,width:50,title:n.FD.format("listSlot"),render:function(T,x,H,F,J){return x.Slot}},{key:"status",renderFormItem:function(T,x,H,F){return(0,r.jsx)(P.Z,{name:"status",valueEnum:Object.fromEntries(je.option("listTaskStatusOption",["running","shutdown","accepted"]).map(function(J){return[J.value,J.label]}))})},width:120,title:n.FD.format("listRunStatus"),render:function(T,x,H){var F;if(x.Status.State!="running"){var J;return(0,r.jsx)(C.Z,{status:"task.".concat(x.Status.State),tip:(J=x.Status.Err)!==null&&J!==void 0?J:x.Status.Message})}return(0,r.jsx)(C.Z,{status:"task.".concat(x.DesiredState),tip:(F=x.Status.Err)!==null&&F!==void 0?F:x.Status.Message})}},{search:!1,width:180,title:n.FD.format("listUpdatedAt"),render:function(T,x,H,F,J){return(0,i.NF)(x.UpdatedAt)}},{search:!1,width:100,title:n.FD.format("listManage"),fixed:"right",render:function(T,x,H,F,J){var ie,Se;return(0,r.jsx)(D.Z,{children:(0,r.jsx)(Ve,{type:"node",detail:{id:(ie=x.ID)!==null&&ie!==void 0?ie:"",name:(Se=x.ID)!==null&&Se!==void 0?Se:""},trigger:(0,r.jsx)(y.Z.Link,{children:(0,r.jsx)(o.Z,{})})})})}}],request:function(){var M=v()(d()().mark(function T(x){var H,F;return d()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,(0,t.XX)({serviceName:h==null?void 0:h.ID,status:x.status});case 2:return H=ie.sent,ie.next=5,(0,t.HN)();case 5:return F=ie.sent,ie.abrupt("return",{data:H.data.list.map(function(Se){var Fe,He=F&&((Fe=F.data.list.find(function(We){return We.ID==Se.NodeID}))===null||Fe===void 0||(Fe=Fe.Description)===null||Fe===void 0?void 0:Fe.Hostname);return He&&(Se.NodeID=He),Se}),success:!0,total:H.data.list.length});case 7:case"end":return ie.stop()}},T)}));return function(T){return M.apply(this,arguments)}}()})})]})]})}),Qe=ze;function Me(V){var ge=(0,w.useState)(""),ne=k()(ge,2),ue=ne[0],De=ne[1],_e=(0,w.useRef)(),ce=(0,w.useRef)();(0,w.useEffect)(function(){(0,u.K3)().then(function(z){var Z;De((Z=z.data.serverUrl)!==null&&Z!==void 0?Z:"")})},[]);var de={};return V.showManage||(de=_()(_()({},de),{})),(0,f.k)(V.showSearch)&&(de=_()(_()({},de),{search:!1})),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Qe,{ref:_e,onFinish:function(){var Z;!((Z=ce.current)===null||Z===void 0)&&Z.reloadAndRest&&ce.current.reloadAndRest()}}),(0,r.jsx)(a.Z,_()(_()({},de),{},{ghost:!0,actionRef:ce,scroll:{x:"max-content"},rowKey:"ID",columns:[{key:"serviceName",title:n.FD.format("listServiceName"),render:function(Z,I,B,K,g){var m,L=0;return I.Task&&I.Task.forEach(function(Pe){Pe.Status.State=="running"&&(L+=1)}),(0,r.jsxs)(D.Z,{children:[I.Task&&(0,r.jsx)(E.Z,{color:"success",bordered:!1,children:L}),(0,r.jsx)(y.Z.Link,{onClick:function(){var ae;(ae=_e.current)===null||ae===void 0||ae.show(I)},children:(m=I.Spec)===null||m===void 0?void 0:m.Name})]})}},{width:150,search:!1,title:n.FD.format("listPort"),render:function(Z,I,B,K,g){var m,L,Pe=[];return!((m=I.Endpoint)===null||m===void 0)&&m.Ports&&((L=I.Endpoint)===null||L===void 0||L.Ports.map(function(ae){var he,$e,Te;Pe.push({PrivatePort:(he=ae.TargetPort)!==null&&he!==void 0?he:0,Type:($e=ae.Protocol)!==null&&$e!==void 0?$e:"tcp",IP:"",PublicPort:(Te=ae.PublishedPort)!==null&&Te!==void 0?Te:0})})),(0,r.jsx)(j.Z,{ghost:!0,publicPort:Pe,serverIp:ue})}},{width:150,search:!1,title:n.FD.format("listServiceMode"),render:function(Z,I,B,K,g){return(0,r.jsx)(le,{detail:I})}},{hidden:!V.showImageName,width:400,search:!1,title:n.FD.format("listImageName"),render:function(Z,I,B,K,g){var m,L=((m=I.Spec)===null||m===void 0||(m=m.TaskTemplate)===null||m===void 0||(m=m.ContainerSpec)===null||m===void 0?void 0:m.Image)||"",Pe=L.includes("@")?L.split("@"):[L,null],ae=k()(Pe,2),he=ae[0],$e=ae[1];return(0,r.jsx)(U.Z,{children:he})}},{search:!1,width:180,title:n.FD.format("listCreatedAt"),render:function(Z,I,B,K,g){return(0,i.NF)(I.CreatedAt)}},{search:!1,width:180,title:n.FD.format("listUpdatedAt"),render:function(Z,I,B,K,g){return(0,i.NF)(I.UpdatedAt)}},{hidden:!V.showManage,search:!1,title:n.FD.format("listManage"),width:100,fixed:"right",render:function(Z,I,B,K,g){return(0,r.jsx)(D.Z,{split:(0,r.jsx)(O.Z,{type:"vertical"}),children:(0,r.jsx)(y.Z.Link,{onClick:function(){},children:(0,r.jsx)(ee.Z,{title:n.FD.format("listManageEdit"),children:(0,r.jsx)(s.Z,{})})},"edit")})}}],request:function(){var z=v()(d()().mark(function Z(I){var B,K,g;return d()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(!V.showWithNodeId){L.next=7;break}return L.next=3,(0,t.rN)({nodeId:(B=V.showWithNodeId)!==null&&B!==void 0?B:""});case 3:return K=L.sent,L.abrupt("return",{data:K.data.list,total:K.data.list.length,success:!0});case 7:return L.next=9,(0,t.kM)({name:I.serviceName});case 9:return g=L.sent,L.abrupt("return",{data:g.data.list,total:g.data.list.length,success:!0});case 11:case"end":return L.stop()}},Z)}));return function(Z){return z.apply(this,arguments)}}(),expandable:V.showWithNodeId?{expandRowByClick:!0,rowExpandable:function(Z){return Z.Task&&Z.Task.length>0&&Z.Task.filter(function(I){return I.Status.State=="running"}).length>0},expandedRowRender:function(Z){return(0,r.jsx)(q.Z,{rowKey:"ID",columns:[{title:n.FD.format("listName"),render:function(B,K,g){return K.ID}},{width:120,title:n.FD.format("listRunStatus"),render:function(B,K,g){var m;return(0,r.jsx)(C.Z,{status:"task.".concat(K.Status.State),tip:(m=K.Status.Err)!==null&&m!==void 0?m:K.Status.Message})}},{title:n.FD.format("listUpdatedAt"),width:180,render:function(B,K,g){return(0,i.NF)(K.UpdatedAt)}},{width:100,title:n.FD.format("listManage"),fixed:"right",render:function(B,K,g){var m,L;return(0,r.jsx)(D.Z,{children:(0,r.jsx)(Ve,{type:"node",detail:{id:(m=K.ID)!==null&&m!==void 0?m:"",name:(L=K.ID)!==null&&L!==void 0?L:""},trigger:(0,r.jsx)(y.Z.Link,{children:(0,r.jsx)(o.Z,{})})})})}}],pagination:!1,dataSource:Z.Task.filter(function(I){return I.Status.State=="running"})})}}:void 0}))]})}},76428:function(re,A,e){"use strict";e.d(A,{Z:function(){return v}});var Q=e(25593),d=e(67294),G=e(85893);function v(p){return(0,G.jsx)(Q.Z.Text,{copyable:!0,children:p.title})}},12323:function(re,A,e){"use strict";e.d(A,{X:function(){return Q},n:function(){return d}});var Q={convertEol:!0,fontFamily:'Menlo, Monaco, "Courier New", monospace',fontWeight:400,fontSize:16,lineHeight:1,cursorStyle:"block",cursorInactiveStyle:"outline",cursorBlink:!0,letterSpacing:0,theme:{foreground:"#bfbfbf",cursor:"gray",selectionForeground:"#ffffff"}},d=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"]},24494:function(re,A,e){"use strict";e.d(A,{$m:function(){return _},HN:function(){return D},Id:function(){return f},JC:function(){return k},P3:function(){return Ie},QB:function(){return j},UK:function(){return i},XX:function(){return U},Zc:function(){return y},ev:function(){return b},ig:function(){return xe},kM:function(){return S},kp:function(){return w},m8:function(){return s},rN:function(){return Ce},tm:function(){return fe},vb:function(){return ee},x$:function(){return W}});var Q=e(15009),d=e.n(Q),G=e(99289),v=e.n(G),p=e(82346),_="com.dpanel.swarm.service.description",b="com.dpanel.swarm.service.registry";function k(){return t.apply(this,arguments)}function t(){return t=v()(d()().mark(function P(){return d()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.abrupt("return",(0,p.request)("/api/app/swarm/info",{method:"POST"}));case 1:case"end":return $.stop()}},P)})),t.apply(this,arguments)}function i(P){return n.apply(this,arguments)}function n(){return n=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,p.request)("/api/app/swarm/init",{method:"POST",data:R}));case 1:case"end":return c.stop()}},P)})),n.apply(this,arguments)}function s(P){return o.apply(this,arguments)}function o(){return o=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return R.id=String(R.id),c.abrupt("return",(0,p.request)("/api/app/swarm/log",{method:"POST",data:R}));case 2:case"end":return c.stop()}},P)})),o.apply(this,arguments)}function f(P){return a.apply(this,arguments)}function a(){return a=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return R.download=!0,R.id=String(R.id),c.next=4,(0,p.request)("/api/app/swarm/log",{method:"POST",data:R,responseType:"blob"});case 4:return c.abrupt("return",c.sent);case 5:case"end":return c.stop()}},P)})),a.apply(this,arguments)}function D(P){return E.apply(this,arguments)}function E(){return E=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,p.request)("/api/app/swarm/node-list",{method:"POST",data:R}));case 1:case"end":return c.stop()}},P)})),E.apply(this,arguments)}function y(P){return O.apply(this,arguments)}function O(){return O=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,p.request)("/api/app/swarm/node-update",{method:"POST",data:R}));case 1:case"end":return c.stop()}},P)})),O.apply(this,arguments)}function ee(P){return q.apply(this,arguments)}function q(){return q=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,p.request)("/api/app/swarm/info-join",{method:"POST",data:R}));case 1:case"end":return c.stop()}},P)})),q.apply(this,arguments)}function j(P){return C.apply(this,arguments)}function C(){return C=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,p.request)("/api/app/swarm/node-remove",{method:"POST",data:R}));case 1:case"end":return c.stop()}},P)})),C.apply(this,arguments)}function w(P){return u.apply(this,arguments)}function u(){return u=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,p.request)("/api/app/swarm/node-prune",{method:"POST",data:R}));case 1:case"end":return c.stop()}},P)})),u.apply(this,arguments)}function U(P){return ye.apply(this,arguments)}function ye(){return ye=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,p.request)("/api/app/swarm/task-list",{method:"POST",data:R}));case 1:case"end":return c.stop()}},P)})),ye.apply(this,arguments)}function Ce(P){return be.apply(this,arguments)}function be(){return be=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,p.request)("/api/app/swarm/task-list-in-node",{method:"POST",data:R}));case 1:case"end":return c.stop()}},P)})),be.apply(this,arguments)}function S(P){return Be.apply(this,arguments)}function Be(){return Be=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,p.request)("/api/app/swarm/service-list",{method:"POST",data:R}));case 1:case"end":return c.stop()}},P)})),Be.apply(this,arguments)}function W(P){return oe.apply(this,arguments)}function oe(){return oe=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,p.request)("/api/app/swarm/service-scaling",{method:"POST",data:R}));case 1:case"end":return c.stop()}},P)})),oe.apply(this,arguments)}function fe(P){return pe.apply(this,arguments)}function pe(){return pe=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,p.request)("/api/app/swarm/service-delete",{method:"POST",data:R}));case 1:case"end":return c.stop()}},P)})),pe.apply(this,arguments)}function Ie(P){return Ke.apply(this,arguments)}function Ke(){return Ke=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,p.request)("/api/app/swarm/service-create",{method:"POST",data:R}));case 1:case"end":return c.stop()}},P)})),Ke.apply(this,arguments)}function xe(P){return Ne.apply(this,arguments)}function Ne(){return Ne=v()(d()().mark(function P(R){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,p.request)("/api/app/swarm/service-detail",{method:"POST",data:R}));case 1:case"end":return c.stop()}},P)})),Ne.apply(this,arguments)}},3393:function(re,A,e){"use strict";e.d(A,{Gb:function(){return k},Pn:function(){return s},Rb:function(){return f},YU:function(){return _},ZQ:function(){return y},_U:function(){return i},cD:function(){return ee},cd:function(){return D}});var Q=e(15009),d=e.n(Q),G=e(99289),v=e.n(G),p=e(82346);function _(j){return b.apply(this,arguments)}function b(){return b=v()(d()().mark(function j(C){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,p.request)("/api/app/image/get-detail",{method:"POST",data:C}));case 1:case"end":return u.stop()}},j)})),b.apply(this,arguments)}function k(j){return t.apply(this,arguments)}function t(){return t=v()(d()().mark(function j(C){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,p.request)("/api/app/image/tag-remote",{method:"POST",data:C}));case 1:case"end":return u.stop()}},j)})),t.apply(this,arguments)}function i(j){return n.apply(this,arguments)}function n(){return n=v()(d()().mark(function j(C){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,p.request)("/api/app/image/tag-add",{method:"POST",data:C}));case 1:case"end":return u.stop()}},j)})),n.apply(this,arguments)}function s(j){return o.apply(this,arguments)}function o(){return o=v()(d()().mark(function j(C){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,p.request)("/api/app/image/tag-delete",{method:"POST",data:C}));case 1:case"end":return u.stop()}},j)})),o.apply(this,arguments)}function f(j){return a.apply(this,arguments)}function a(){return a=v()(d()().mark(function j(C){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,p.request)("/api/app/image/export",{method:"POST",data:C,responseType:"blob"}));case 1:case"end":return u.stop()}},j)})),a.apply(this,arguments)}function D(j){return E.apply(this,arguments)}function E(){return E=v()(d()().mark(function j(C){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,p.request)("/api/pro/image/get-remote-tag",{method:"POST",data:C}));case 1:case"end":return u.stop()}},j)})),E.apply(this,arguments)}function y(j){return O.apply(this,arguments)}function O(){return O=v()(d()().mark(function j(C){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,p.request)("/api/app/image/check-upgrade",{method:"POST",data:C}));case 1:case"end":return u.stop()}},j)})),O.apply(this,arguments)}function ee(j){return q.apply(this,arguments)}function q(){return q=v()(d()().mark(function j(C){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,p.request)("/api/pro/image/get-rootfs",{method:"POST",data:C}));case 1:case"end":return u.stop()}},j)})),q.apply(this,arguments)}},75458:function(re){(function(A,e){re.exports=e()})(self,()=>(()=>{"use strict";var A={345:(G,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.runAndSubscribe=v.forwardEvent=v.EventEmitter=void 0,v.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=p=>(this._listeners.push(p),{dispose:()=>{if(!this._disposed){for(let _=0;_<this._listeners.length;_++)if(this._listeners[_]===p)return void this._listeners.splice(_,1)}}})),this._event}fire(p,_){const b=[];for(let k=0;k<this._listeners.length;k++)b.push(this._listeners[k]);for(let k=0;k<b.length;k++)b[k].call(void 0,p,_)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},v.forwardEvent=function(p,_){return p(b=>_.fire(b))},v.runAndSubscribe=function(p,_){return _(void 0),p(b=>_(b))}},859:(G,v)=>{function p(_){for(const b of _)b.dispose();_.length=0}Object.defineProperty(v,"__esModule",{value:!0}),v.getDisposeArrayDisposable=v.disposeArray=v.toDisposable=v.MutableDisposable=v.Disposable=void 0,v.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const _ of this._disposables)_.dispose();this._disposables.length=0}register(_){return this._disposables.push(_),_}unregister(_){const b=this._disposables.indexOf(_);b!==-1&&this._disposables.splice(b,1)}},v.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(_){var b;this._isDisposed||_===this._value||((b=this._value)==null||b.dispose(),this._value=_)}clear(){this.value=void 0}dispose(){var _;this._isDisposed=!0,(_=this._value)==null||_.dispose(),this._value=void 0}},v.toDisposable=function(_){return{dispose:_}},v.disposeArray=p,v.getDisposeArrayDisposable=function(_){return{dispose:()=>p(_)}}}},e={};function Q(G){var v=e[G];if(v!==void 0)return v.exports;var p=e[G]={exports:{}};return A[G](p,p.exports,Q),p.exports}var d={};return(()=>{var G=d;Object.defineProperty(G,"__esModule",{value:!0}),G.SearchAddon=void 0;const v=Q(345),p=Q(859),_=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?";class b extends p.Disposable{constructor(t){var i;super(),this._highlightedLines=new Set,this._highlightDecorations=[],this._selectedDecoration=this.register(new p.MutableDisposable),this._linesCacheTimeoutId=0,this._linesCacheDisposables=new p.MutableDisposable,this._onDidChangeResults=this.register(new v.EventEmitter),this.onDidChangeResults=this._onDidChangeResults.event,this._highlightLimit=(i=t==null?void 0:t.highlightLimit)!=null?i:1e3}activate(t){this._terminal=t,this.register(this._terminal.onWriteParsed(()=>this._updateMatches())),this.register(this._terminal.onResize(()=>this._updateMatches())),this.register((0,p.toDisposable)(()=>this.clearDecorations()))}_updateMatches(){var t;this._highlightTimeout&&window.clearTimeout(this._highlightTimeout),this._cachedSearchTerm&&((t=this._lastSearchOptions)!=null&&t.decorations)&&(this._highlightTimeout=setTimeout(()=>{const i=this._cachedSearchTerm;this._cachedSearchTerm=void 0,this.findPrevious(i,ft(mt({},this._lastSearchOptions),{incremental:!0,noScroll:!0}))},200))}clearDecorations(t){this._selectedDecoration.clear(),(0,p.disposeArray)(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear(),t||(this._cachedSearchTerm=void 0)}clearActiveDecoration(){this._selectedDecoration.clear()}findNext(t,i){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const n=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,i);this._lastSearchOptions=i,i!=null&&i.decorations&&(this._cachedSearchTerm===void 0||t!==this._cachedSearchTerm||n)&&this._highlightAllMatches(t,i);const s=this._findNextAndSelect(t,i);return this._fireResults(i),this._cachedSearchTerm=t,s}_highlightAllMatches(t,i){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!t||t.length===0)return void this.clearDecorations();i=i||{},this.clearDecorations(!0);const n=[];let s,o=this._find(t,0,0,i);for(;o&&((s==null?void 0:s.row)!==o.row||(s==null?void 0:s.col)!==o.col)&&!(n.length>=this._highlightLimit);)s=o,n.push(s),o=this._find(t,s.col+s.term.length>=this._terminal.cols?s.row+1:s.row,s.col+s.term.length>=this._terminal.cols?0:s.col+1,i);for(const f of n){const a=this._createResultDecoration(f,i.decorations);a&&(this._highlightedLines.add(a.marker.line),this._highlightDecorations.push({decoration:a,match:f,dispose(){a.dispose()}}))}}_find(t,i,n,s){var a;if(!this._terminal||!t||t.length===0)return(a=this._terminal)==null||a.clearSelection(),void this.clearDecorations();if(n>this._terminal.cols)throw new Error(`Invalid col: ${n} to search in terminal of ${this._terminal.cols} cols`);let o;this._initLinesCache();const f={startRow:i,startCol:n};if(o=this._findInLine(t,f,s),!o)for(let D=i+1;D<this._terminal.buffer.active.baseY+this._terminal.rows&&(f.startRow=D,f.startCol=0,o=this._findInLine(t,f,s),!o);D++);return o}_findNextAndSelect(t,i){var D;if(!this._terminal||!t||t.length===0)return(D=this._terminal)==null||D.clearSelection(),this.clearDecorations(),!1;const n=this._terminal.getSelectionPosition();this._terminal.clearSelection();let s=0,o=0;n&&(this._cachedSearchTerm===t?(s=n.end.x,o=n.end.y):(s=n.start.x,o=n.start.y)),this._initLinesCache();const f={startRow:o,startCol:s};let a=this._findInLine(t,f,i);if(!a)for(let E=o+1;E<this._terminal.buffer.active.baseY+this._terminal.rows&&(f.startRow=E,f.startCol=0,a=this._findInLine(t,f,i),!a);E++);if(!a&&o!==0)for(let E=0;E<o&&(f.startRow=E,f.startCol=0,a=this._findInLine(t,f,i),!a);E++);return!a&&n&&(f.startRow=n.start.y,f.startCol=0,a=this._findInLine(t,f,i)),this._selectResult(a,i==null?void 0:i.decorations,i==null?void 0:i.noScroll)}findPrevious(t,i){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const n=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,i);this._lastSearchOptions=i,i!=null&&i.decorations&&(this._cachedSearchTerm===void 0||t!==this._cachedSearchTerm||n)&&this._highlightAllMatches(t,i);const s=this._findPreviousAndSelect(t,i);return this._fireResults(i),this._cachedSearchTerm=t,s}_didOptionsChange(t,i){return!!i&&(t.caseSensitive!==i.caseSensitive||t.regex!==i.regex||t.wholeWord!==i.wholeWord)}_fireResults(t){if(t!=null&&t.decorations){let i=-1;if(this._selectedDecoration.value){const n=this._selectedDecoration.value.match;for(let s=0;s<this._highlightDecorations.length;s++){const o=this._highlightDecorations[s].match;if(o.row===n.row&&o.col===n.col&&o.size===n.size){i=s;break}}}this._onDidChangeResults.fire({resultIndex:i,resultCount:this._highlightDecorations.length})}}_findPreviousAndSelect(t,i){var E;if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!this._terminal||!t||t.length===0)return(E=this._terminal)==null||E.clearSelection(),this.clearDecorations(),!1;const n=this._terminal.getSelectionPosition();this._terminal.clearSelection();let s=this._terminal.buffer.active.baseY+this._terminal.rows-1,o=this._terminal.cols;const f=!0;this._initLinesCache();const a={startRow:s,startCol:o};let D;if(n&&(a.startRow=s=n.start.y,a.startCol=o=n.start.x,this._cachedSearchTerm!==t&&(D=this._findInLine(t,a,i,!1),D||(a.startRow=s=n.end.y,a.startCol=o=n.end.x))),D||(D=this._findInLine(t,a,i,f)),!D){a.startCol=Math.max(a.startCol,this._terminal.cols);for(let y=s-1;y>=0&&(a.startRow=y,D=this._findInLine(t,a,i,f),!D);y--);}if(!D&&s!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let y=this._terminal.buffer.active.baseY+this._terminal.rows-1;y>=s&&(a.startRow=y,D=this._findInLine(t,a,i,f),!D);y--);return this._selectResult(D,i==null?void 0:i.decorations,i==null?void 0:i.noScroll)}_initLinesCache(){const t=this._terminal;this._linesCache||(this._linesCache=new Array(t.buffer.active.length),this._linesCacheDisposables.value=(0,p.getDisposeArrayDisposable)([t.onLineFeed(()=>this._destroyLinesCache()),t.onCursorMove(()=>this._destroyLinesCache()),t.onResize(()=>this._destroyLinesCache())])),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._linesCacheDisposables.clear(),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_isWholeWord(t,i,n){return(t===0||_.includes(i[t-1]))&&(t+n.length===i.length||_.includes(i[t+n.length]))}_findInLine(t,i,n={},s=!1){var w;const o=this._terminal,f=i.startRow,a=i.startCol,D=o.buffer.active.getLine(f);if(D!=null&&D.isWrapped)return s?void(i.startCol+=o.cols):(i.startRow--,i.startCol+=o.cols,this._findInLine(t,i,n));let E=(w=this._linesCache)==null?void 0:w[f];E||(E=this._translateBufferLineToStringWithWrap(f,!0),this._linesCache&&(this._linesCache[f]=E));const[y,O]=E,ee=this._bufferColsToStringOffset(f,a),q=n.caseSensitive?t:t.toLowerCase(),j=n.caseSensitive?y:y.toLowerCase();let C=-1;if(n.regex){const u=RegExp(q,"g");let U;if(s)for(;U=u.exec(j.slice(0,ee));)C=u.lastIndex-U[0].length,t=U[0],u.lastIndex-=t.length-1;else U=u.exec(j.slice(ee)),U&&U[0].length>0&&(C=ee+(u.lastIndex-U[0].length),t=U[0])}else s?ee-q.length>=0&&(C=j.lastIndexOf(q,ee-q.length)):C=j.indexOf(q,ee);if(C>=0){if(n.wholeWord&&!this._isWholeWord(C,j,t))return;let u=0;for(;u<O.length-1&&C>=O[u+1];)u++;let U=u;for(;U<O.length-1&&C+t.length>=O[U+1];)U++;const ye=C-O[u],Ce=C+t.length-O[U],be=this._stringLengthToBufferSize(f+u,ye);return{term:t,col:be,row:f+u,size:this._stringLengthToBufferSize(f+U,Ce)-be+o.cols*(U-u)}}}_stringLengthToBufferSize(t,i){const n=this._terminal.buffer.active.getLine(t);if(!n)return 0;for(let s=0;s<i;s++){const o=n.getCell(s);if(!o)break;const f=o.getChars();f.length>1&&(i-=f.length-1);const a=n.getCell(s+1);a&&a.getWidth()===0&&i++}return i}_bufferColsToStringOffset(t,i){const n=this._terminal;let s=t,o=0,f=n.buffer.active.getLine(s);for(;i>0&&f;){for(let a=0;a<i&&a<n.cols;a++){const D=f.getCell(a);if(!D)break;D.getWidth()&&(o+=D.getCode()===0?1:D.getChars().length)}if(s++,f=n.buffer.active.getLine(s),f&&!f.isWrapped)break;i-=n.cols}return o}_translateBufferLineToStringWithWrap(t,i){var a;const n=this._terminal,s=[],o=[0];let f=n.buffer.active.getLine(t);for(;f;){const D=n.buffer.active.getLine(t+1),E=!!D&&D.isWrapped;let y=f.translateToString(!E&&i);if(E&&D){const O=f.getCell(f.length-1);O&&O.getCode()===0&&O.getWidth()===1&&((a=D.getCell(0))==null?void 0:a.getWidth())===2&&(y=y.slice(0,-1))}if(s.push(y),!E)break;o.push(o[o.length-1]+y.length),t++,f=D}return[s.join(""),o]}_selectResult(t,i,n){const s=this._terminal;if(this._selectedDecoration.clear(),!t)return s.clearSelection(),!1;if(s.select(t.col,t.row,t.size),i){const o=s.registerMarker(-s.buffer.active.baseY-s.buffer.active.cursorY+t.row);if(o){const f=s.registerDecoration({marker:o,x:t.col,width:t.size,backgroundColor:i.activeMatchBackground,layer:"top",overviewRulerOptions:{color:i.activeMatchColorOverviewRuler}});if(f){const a=[];a.push(o),a.push(f.onRender(D=>this._applyStyles(D,i.activeMatchBorder,!0))),a.push(f.onDispose(()=>(0,p.disposeArray)(a))),this._selectedDecoration.value={decoration:f,match:t,dispose(){f.dispose()}}}}}if(!n&&(t.row>=s.buffer.active.viewportY+s.rows||t.row<s.buffer.active.viewportY)){let o=t.row-s.buffer.active.viewportY;o-=Math.floor(s.rows/2),s.scrollLines(o)}return!0}_applyStyles(t,i,n){t.classList.contains("xterm-find-result-decoration")||(t.classList.add("xterm-find-result-decoration"),i&&(t.style.outline=`1px solid ${i}`)),n&&t.classList.add("xterm-find-active-result-decoration")}_createResultDecoration(t,i){const n=this._terminal,s=n.registerMarker(-n.buffer.active.baseY-n.buffer.active.cursorY+t.row);if(!s)return;const o=n.registerDecoration({marker:s,x:t.col,width:t.size,backgroundColor:i.matchBackground,overviewRulerOptions:this._highlightedLines.has(s.line)?void 0:{color:i.matchOverviewRuler,position:"center"}});if(o){const f=[];f.push(s),f.push(o.onRender(a=>this._applyStyles(a,i.matchBorder,!1))),f.push(o.onDispose(()=>(0,p.disposeArray)(f)))}return o}}G.SearchAddon=b})(),d})())}}]);
}());