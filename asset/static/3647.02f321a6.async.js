!(function(){var Tt=Object.defineProperty,Pt=Object.defineProperties;var wt=Object.getOwnPropertyDescriptors;var dt=Object.getOwnPropertySymbols;var xt=Object.prototype.hasOwnProperty,jt=Object.prototype.propertyIsEnumerable;var ut=(se,$,e)=>$ in se?Tt(se,$,{enumerable:!0,configurable:!0,writable:!0,value:e}):se[$]=e,ct=(se,$)=>{for(var e in $||($={}))xt.call($,e)&&ut(se,e,$[e]);if(dt)for(var e of dt($))jt.call($,e)&&ut(se,e,$[e]);return se},ht=(se,$)=>Pt(se,wt($));(self.webpackChunk=self.webpackChunk||[]).push([[3647],{23430:function(se,$,e){"use strict";e.d($,{Z:function(){return H}});var ee=e(87462),d=e(67294),z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"},v=z,_=e(84089),S=function(i,n){return d.createElement(_.Z,(0,ee.Z)({},i,{ref:n,icon:v}))},W=d.forwardRef(S),H=W},1883:function(se,$,e){"use strict";var ee=e(87462),d=e(67294),z=e(3936),v=e(84089),_=function(H,t){return d.createElement(v.Z,(0,ee.Z)({},H,{ref:t,icon:z.Z}))},S=d.forwardRef(_);$.Z=S},81146:function(se,$,e){"use strict";var ee=e(97857),d=e.n(ee),z=e(15009),v=e.n(z),_=e(99289),S=e.n(_),W=e(67294),H=e(97269),t=e(62370),i=e(5966),n=e(97462),s=e(82346),o=e(71230),m=e(15746),r=e(34041),P=e(83622),O=e(84567),Z=e(42075),y=e(80821),re=e(23430),te=e(93162),w=e.n(te),M=e(78267),g=e.n(M),h=e(75458),K=e.n(h),De=e(12323),Ue=e(4244),p=e.n(Ue),Je=e(24078),Me=e(36146),N=e(85893),ie,Oe,Te,Re={decorations:{matchBackground:"",matchBorder:"#FFFF00",activeMatchBackground:"#FFFF0066",matchOverviewRuler:"",activeMatchColorOverviewRuler:""}},Ke=(0,W.forwardRef)(function(je,Ne){var x=(0,W.useRef)(),I=(0,s.useModel)("subscriber"),F=new Me.Uo("components.containerLog");(0,W.useImperativeHandle)(Ne,function(){return{fit:function(){ie.clear(),Te.fit()},start:function(){return S()(v()().mark(function Y(){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,u({lineTotal:500});case 2:case"end":return a.stop()}},Y)}))()},close:function(){I.progress.close(je.id)}}});function u(G){return Xe.apply(this,arguments)}function Xe(){return Xe=S()(v()().mark(function G(Y){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:I.progress.close(je.id),ie.clear(),Y.download=!1,je.request(Y);case 4:case"end":return a.stop()}},G)})),Xe.apply(this,arguments)}return(0,W.useEffect)(function(){return window.addEventListener("resize",function(){Te.fit()}),ie=new Ue.Terminal(d()(d()({},De.X),{},{fontSize:12,lineHeight:1.2,allowProposedApi:!0})),Te=new M.FitAddon,Oe=new h.SearchAddon({}),ie.loadAddon(Te),ie.loadAddon(Oe),ie.open(document.getElementById("terminal-container-log")),Te.fit(),I.addDataHandler(je.id,function(G){ie.write(G.data)}),function(){ie.clear(),ie.reset(),I.progress.close(je.id)}},[]),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(H.A,{submitter:!1,layout:"horizontal",onFinish:function(Y){var C;u({id:je.id,lineTotal:parseInt(Y.lineTotal),showTime:(C=Y.showTime)!==null&&C!==void 0?C:!1})},formRef:x,children:(0,N.jsxs)(o.Z,{gutter:[10,0],children:[(0,N.jsx)(m.Z,{span:8,children:(0,N.jsx)(t.Z,{name:"lineTotal",initialValue:"500",label:F.format("formLineTotal"),children:(0,N.jsxs)(r.Z,{defaultValue:"500",onChange:function(Y){var C;(C=x.current)===null||C===void 0||C.submit()},children:[(0,N.jsx)(r.Z.Option,{value:"100",children:F.format("formLineTotalOption",{number:"100"})}),(0,N.jsx)(r.Z.Option,{value:"200",children:F.format("formLineTotalOption",{number:"200"})}),(0,N.jsx)(r.Z.Option,{value:"500",children:F.format("formLineTotalOption",{number:"500"})}),(0,N.jsx)(r.Z.Option,{value:"1000",children:F.format("formLineTotalOption",{number:"1000"})}),(0,N.jsx)(r.Z.Option,{value:"-1",children:F.format("formLineTotalOptionAll")})]})})}),(0,N.jsx)(m.Z,{children:(0,N.jsx)(P.ZP,{onClick:function(){ie.clear()},children:F.format("clearButton")})}),(0,N.jsx)(m.Z,{children:(0,N.jsx)(t.Z,{name:"showTime",valuePropName:"checked",children:(0,N.jsx)(O.Z,{onChange:function(Y){var C;(C=x.current)===null||C===void 0||C.submit()},children:F.format("formShowTime")})})}),(0,N.jsx)(m.Z,{children:(0,N.jsx)(i.Z,{label:F.format("formKeywork"),name:"keywork",fieldProps:{onPressEnter:function(){var Y;Oe.findNext((Y=x.current)===null||Y===void 0?void 0:Y.getFieldValue("keywork"),Re)},onChange:function(Y){Oe.findNext(Y.target.value,Re)}},placeholder:F.format("formKeyworkEmpty")})}),(0,N.jsx)(m.Z,{children:(0,N.jsx)(n.Z,{name:["keywork"],children:function(Y){var C=Y.keywork;return(0,N.jsxs)(Z.Z,{size:10,children:[(0,N.jsx)(P.ZP,{onClick:function(){Oe.findNext(C,Re)},children:F.format("formKeyworkNext")},"next"),(0,N.jsx)(P.ZP,{onClick:function(){Oe.findPrevious(C,Re)},children:F.format("formKeyworkPrev")},"prev")]})}})}),(0,N.jsx)(m.Z,{children:(0,N.jsx)(y.Z,{icon:(0,N.jsx)(re.Z,{}),action:S()(v()().mark(function G(){var Y,C,a;return v()().wrap(function(Pe){for(;;)switch(Pe.prev=Pe.next){case 0:if(!je.download){Pe.next=5;break}return Pe.next=3,je.download({lineTotal:parseInt((Y=x.current)===null||Y===void 0?void 0:Y.getFieldValue("lineTotal")),showTime:(C=x.current)===null||C===void 0?void 0:C.getFieldValue("showTime")});case 3:a=Pe.sent,(0,te.saveAs)(a.data,a.name);case 5:case"end":return Pe.stop()}},G)})),children:F.format("downloadButton")})})]})}),(0,N.jsx)("div",{style:{marginTop:"20px",height:je.showInDrawer?"75vh":"85vh"},id:"terminal-container-log"})]})});$.Z=Ke},37413:function(se,$,e){"use strict";e.d($,{Z:function(){return m}});var ee=e(19632),d=e.n(ee),z=e(36146),v=e(85577),_=e(58638),S=e(36693),W=e(35995),H=e(99611),t=e(38345),i=e(42075),n=e(66309),s=e(55241),o=e(85893);function m(r){var P,O=new z.Uo("components.containerPort"),Z=[];r.publicPort&&(Z=d()(r.publicPort)),r.privatePort&&(Z=[].concat(d()(Z),d()(r.privatePort)));var y=(P=r.serverIp)!==null&&P!==void 0?P:"localhost";if(y!=""&&y.indexOf("http")===-1&&y.indexOf(":")>-1&&(y="[".concat(y,"]")),y==""||y=="127.0.0.1"){var re=document.location.protocol+"//"+document.location.hostname;y=re}var te=(0,o.jsxs)(t.Z,{direction:r.layout=="inline"?"row":"column",style:{width:r.layout!="inline"?600:"auto"},ghost:!0,children:[Z.length>0&&(0,o.jsx)(t.Z,{title:(0,o.jsx)(v.Z,{}),subTitle:O.format("cardPortTitle"),ghost:r.ghost,bodyStyle:{maxHeight:300,overflow:"auto",margin:"10px 0"},children:Z.map(function(w,M){var g;return y==""&&w.IP&&(y=w.IP),(0,o.jsx)(i.Z,{size:"large",wrap:!0,children:(0,o.jsx)(n.Z,{color:w.PublicPort?"#2db7f5":"warning",icon:w.PublicPort?(0,o.jsx)(_.Z,{}):"",style:{marginBottom:10,marginRight:15},children:w.PublicPort?(0,o.jsx)("a",{href:"".concat(y.indexOf("http")===0?y:"http://"+y,":").concat(w.PublicPort),target:"_blank",children:"".concat(w.PublicPort?((g=w.IP)!==null&&g!==void 0?g:"0.0.0.0")+":"+w.PublicPort+" -> ":"").concat(w.PrivatePort,"/").concat(w.Type)},"link".concat(M)):"".concat(w.PrivatePort,"/").concat(w.Type)})},"space".concat(M))})}),r.domain&&r.domain.length>0&&(0,o.jsx)(t.Z,{title:(0,o.jsx)(S.Z,{}),subTitle:O.format("cardDomainTitle"),ghost:r.ghost,children:(0,o.jsx)(i.Z,{wrap:!0,style:{textAlign:"left"},children:r.domain&&r.domain.map(function(w,M){return(0,o.jsx)(n.Z,{color:"blue",icon:(0,o.jsx)(_.Z,{}),children:(0,o.jsx)("a",{href:w,target:"_blank",children:w})},"domain".concat(M))})})})]});return r.showInDetail?te:(0,o.jsx)(s.Z,{placement:"right",content:te,children:(0,o.jsxs)(i.Z,{direction:"vertical",children:[r.privatePort&&r.privatePort.length>0&&(0,o.jsxs)(n.Z,{color:"warning",icon:(0,o.jsx)(W.Z,{}),children:[O.format("portPrivate"),": ",r.privatePort.length]}),r.publicPort&&r.publicPort.length>0&&(0,o.jsxs)(n.Z,{color:"#2db7f5",icon:(0,o.jsx)(H.Z,{}),children:[O.format("protPublic"),": ",r.publicPort.length]}),r.domain&&r.domain.length>0&&(0,o.jsx)(n.Z,{color:"blue",icon:(0,o.jsx)(S.Z,{}),children:r.domainTitle?r.domainTitle:"".concat(O.format("domain"),": ").concat(r.domain.length)})]})})}},94359:function(se,$,e){"use strict";e.d($,{Z:function(){return P}});var ee=e(5574),d=e.n(ee),z=e(3089),v=e(98165),_=e(18429),S=e(8751),W=e(66212),H=e(14313),t=e(30159),i=e(87740),n=e(50888),s=e(66309),o=e(83062),m=e(36146),r=e(85893);function P(O){var Z,y,re=new m.Uo("components.containerStatus"),te=O.status.split("."),w=d()(te,2),M=w[0],g=w[1],h="";h=re.format(O.status,(Z=O.statusValue)!==null&&Z!==void 0?Z:{});var K=(0,r.jsx)(r.Fragment,{});return g=="0"&&(K=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(z.Z,{}),color:"default",children:h})),g=="10"&&(K=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(v.Z,{spin:!0}),color:"processing",children:h})),g=="20"&&(K=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(_.Z,{}),color:"error",children:h})),g=="30"&&(K=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(S.Z,{}),color:"success",children:h})),g=="new"&&(K=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(W.Z,{}),children:h})),(g=="running"||g=="healthy"||g=="active"||g=="ready")&&(K=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(H.Z,{}),color:"success",children:h})),(g=="paused"||g=="pause"||g=="rollback_paused")&&(K=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(t.Z,{}),children:h})),(g=="waiting"||g=="starting"||g=="accepted")&&(K=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(i.Z,{}),children:h})),["deploying","pending","allocated","accepted","assigned","preparing","updating","rollback_started"].includes(g)&&(K=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(n.Z,{}),color:"processing",children:h})),(g=="error"||g=="down"||g=="failed")&&(K=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(_.Z,{}),color:"error",children:h})),["complete","completed","rollback_completed"].includes(g)&&(K=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(S.Z,{}),color:"success",children:h})),["exited","dead","removing","restarting","unhealthy","created","drain","unreachable","shutdown","rejected","remove","orphaned"].includes(g)&&(K=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(_.Z,{}),color:"warning",children:h})),(0,r.jsx)(o.Z,{placement:"top",title:(y=O.tip)!==null&&y!==void 0?y:"",children:K})}},98093:function(se,$,e){"use strict";e.d($,{Z:function(){return Y}});var ee=e(15009),d=e.n(ee),z=e(99289),v=e.n(z),_=e(5574),S=e.n(_),W=e(3616),H=e(184),t=e(62370),i=e(83622),n=e(67294),s=e(59252),o=e(24796),m=e(93529),r=e(91058),P=e(82034),O=e(10523),Z=e(52255),y=e(38345),re=e(5966),te=e(24739),w=e(30291),M=e(92398),g=e(36146),h=e(42963),K=e(42075),De=e(64317),Ue=e(75870),p=e(85893);function Je(){var C=new g.Uo("components.appForm");return(0,p.jsxs)(K.Z.Compact,{children:[(0,p.jsx)(De.Z,{name:"imageRegistry",width:"sm",fieldProps:{popupMatchSelectWidth:!1},request:v()(d()().mark(function a(){var Ie;return d()().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return me.next=2,(0,Ue.Ot)();case 2:return Ie=me.sent,me.abrupt("return",Ie.data.list.map(function(We){return{label:"".concat(We.title,"@").concat(We.serverAddress),value:We.id}}));case 4:case"end":return me.stop()}},a)})),label:C.format("dockerImageImageName")}),(0,p.jsx)(re.Z,{label:" ",name:"imageName",required:!0,rules:[{required:!0}],width:"lg"})]})}var Me=e(86615),N=e(97462),ie=e(31199),Oe=e(86250),Te=e(44349),Re=e(24494);function Ke(){var C,a=new g.Uo("components.appForm"),Ie=(0,n.useContext)(h.Z),Pe=Ie.createFormRef,me=(0,n.useRef)();return(0,p.jsxs)(y.Z,{children:[(0,p.jsxs)(Oe.Z,{gap:60,children:[(0,p.jsx)(Me.Z.Group,{width:"md",label:a.format("createSchedulingLabel"),name:["scheduling","mode"],options:a.option("createSchedulingOption",["global","replicated"]),initialValue:"replicated",disabled:(C=Pe.current)===null||C===void 0?void 0:C.getFieldValue("id")}),(0,p.jsx)(N.Z,{name:["scheduling"],children:function(ke){var $e=ke.scheduling;return $e.mode=="replicated"&&(0,p.jsx)(ie.Z,{width:"md",label:a.format("createSchedulingReplicas"),name:["scheduling","replicas"],initialValue:1})}})]}),(0,p.jsx)(N.Z,{name:["scheduling","constraint"],children:function(ke){var $e=ke.scheduling,Fe=ke.constraint;return $e.mode=="replicated"&&[(0,p.jsx)(Me.Z.Group,{label:a.format("createConstraintNode"),initialValue:"all",name:["constraint","role"],options:a.option("createConstraintNodeOption",["all","manager","worker","user"])},"role"),Fe&&Fe.role=="user"&&(0,p.jsx)(De.Z,{name:["constraint","node"],request:v()(d()().mark(function ze(){var B;return d()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,(0,Re.HN)();case 2:return B=J.sent,J.abrupt("return",B.data.list&&B.data.list.map(function(_e){var ce;return{label:(ce=_e.Description)===null||ce===void 0?void 0:ce.Hostname,value:_e.ID}}));case 4:case"end":return J.stop()}},ze)}))}),(0,p.jsx)(Te.Z,{name:["constraint","label"],label:a.format("createConstraintLabel"),hideCopyButton:!0,showAddButton:!0,gap:10,ref:me,items:[{label:a.format("createConstraintLabelOption.name"),name:"name",width:"md",placeholder:"node.labels.name"},{name:"operator",render:function(B,ge,J){return(0,p.jsx)(De.Z,{label:" ",name:"operator",valueEnum:{"==":"==","!=":"!="},initialValue:"=="})}},{label:a.format("createConstraintLabelOption.value"),name:"value",width:"md"}]},"label"),(0,p.jsx)(Te.Z,{name:"placement",label:a.format("createPlacementLabel"),hideCopyButton:!0,showAddButton:!0,gap:10,items:[{name:"name",render:function(B,ge,J){return(0,p.jsx)(De.Z,{label:" ",name:"type",options:a.option("createPlacementOption",["spread"]),initialValue:"spread",allowClear:!1,width:"sm"})}},{label:a.format("createConstraintLabelOption.value"),name:"value",width:"md",placeholder:"node.labels.hostname"}]},"placement")]}})]})}var je=e(73396),Ne=e(55730),x=e(33879);function I(){var C=new g.Uo("components.appForm");return(0,p.jsx)(y.Z,{children:(0,p.jsxs)(Oe.Z,{gap:30,children:[(0,p.jsx)(De.Z,{label:C.format("createAdvRestart"),name:["restart","name"],width:"sm",initialValue:"any",options:C.option("createAdvRestartOption",["none","on-failure","any"])}),(0,p.jsx)(N.Z,{name:["restart"],children:function(Ie){var Pe=Ie.restart;return Pe=="on-failure"&&(0,p.jsx)(ie.Z,{width:"sm",label:C.format("createAdvRestartMax"),name:["restart","maxAttempt"],initialValue:5})}}),(0,p.jsx)(ie.Z,{width:"sm",label:C.format("createAdvRestartDelay"),tooltip:C.format("createAdvRestartDelayTip"),name:["restart","delay"],initialValue:5,fieldProps:{addonAfter:g.FD.format("unitSecond")}}),(0,p.jsx)(ie.Z,{width:"sm",label:C.format("createAdvRestartWindow"),tooltip:C.format("createAdvRestartWindowTip"),name:["restart","window"],initialValue:0,fieldProps:{addonAfter:g.FD.format("unitSecond")}})]})})}function F(){var C=new g.Uo("components.appForm");return(0,p.jsxs)(y.Z,{children:[(0,p.jsxs)(Oe.Z,{gap:30,children:[(0,p.jsx)(ie.Z,{label:C.format("createSwarmUpdateParallelism"),name:["scheduling","update","parallelism"],initialValue:1}),(0,p.jsx)(ie.Z,{label:C.format("createSwarmUpdateDelay"),name:["scheduling","update","delay"],initialValue:0,fieldProps:{addonAfter:g.FD.format("unitSecond")}})]}),(0,p.jsx)(Me.Z.Group,{label:C.format("createSwarmUpdateFailureAction"),name:["scheduling","update","failureAction"],initialValue:"pause",options:C.option("createSwarmUpdateFailureActionOption",["pause","continue","rollback"])}),(0,p.jsx)(Me.Z.Group,{label:C.format("createSwarmUpdateOrder"),name:["scheduling","update","order"],initialValue:"stop-first",options:C.option("createSwarmUpdateOrderOption",["stop-first","start-first"])})]})}var u=e(64412),Xe=e(27323),G=(0,n.forwardRef)(function(C,a){(0,n.useImperativeHandle)(a,function(){return{edit:function(D){var f,R,j,q,L,X,A,b,oe,ue,he,ve,c,Ee,pe,Le,be,Ce,Ge,Se,Ze,ye,U,T,E,ae,V,Q,le,Ae,xe,Qe,tt,qe,rt,at={id:D.ID,siteName:(f=(R=D.Spec)===null||R===void 0?void 0:R.Name)!==null&&f!==void 0?f:"",siteTitle:((j=D.Spec)===null||j===void 0?void 0:j.Labels)&&((q=D.Spec)===null||q===void 0?void 0:q.Labels[Re.$m]),hostname:(L=D.Spec)===null||L===void 0||(L=L.TaskTemplate)===null||L===void 0||(L=L.ContainerSpec)===null||L===void 0?void 0:L.Hostname,imageName:(X=(A=D.Spec)===null||A===void 0||(A=A.TaskTemplate)===null||A===void 0||(A=A.ContainerSpec)===null||A===void 0?void 0:A.Image)!==null&&X!==void 0?X:"",environment:(b=D.Spec)===null||b===void 0||(b=b.TaskTemplate)===null||b===void 0||(b=b.ContainerSpec)===null||b===void 0||(b=b.Env)===null||b===void 0?void 0:b.map(function(l){var k=l.split("=");return{name:k[0],value:k.slice(1).join("=")}}),volumes:(oe=D.Spec)===null||oe===void 0||(oe=oe.TaskTemplate)===null||oe===void 0||(oe=oe.ContainerSpec)===null||oe===void 0||(oe=oe.Mounts)===null||oe===void 0?void 0:oe.map(function(l){var k,de;return{dest:(k=l.Target)!==null&&k!==void 0?k:"",host:(de=l.Source)!==null&&de!==void 0?de:"",type:l.Type,permission:l.ReadOnly?"readonly":"write"}}),restartPolicy:function(l,k){return{name:(k=l.Condition)!==null&&k!==void 0?k:"any",maxAttempt:l.MaxAttempts,window:l.Window,delay:l.Delay}}(((ue=D.Spec)===null||ue===void 0||(ue=ue.TaskTemplate)===null||ue===void 0?void 0:ue.RestartPolicy)||{}),cpus:function(l){return l?l/1e9:0}((he=D.Spec)===null||he===void 0||(he=he.TaskTemplate)===null||he===void 0||(he=he.Resources)===null||he===void 0||(he=he.Limits)===null||he===void 0?void 0:he.NanoCPUs),memory:function(l){return l?l/1024/1024:0}((ve=D.Spec)===null||ve===void 0||(ve=ve.TaskTemplate)===null||ve===void 0||(ve=ve.Resources)===null||ve===void 0||(ve=ve.Limits)===null||ve===void 0?void 0:ve.MemoryBytes),workDir:{useDefault:!((c=D.Spec)!==null&&c!==void 0&&(c=c.TaskTemplate)!==null&&c!==void 0&&(c=c.ContainerSpec)!==null&&c!==void 0&&c.Dir),default:"",value:(Ee=D.Spec)===null||Ee===void 0||(Ee=Ee.TaskTemplate)===null||Ee===void 0||(Ee=Ee.ContainerSpec)===null||Ee===void 0?void 0:Ee.Dir},user:{useDefault:!((pe=D.Spec)!==null&&pe!==void 0&&(pe=pe.TaskTemplate)!==null&&pe!==void 0&&(pe=pe.ContainerSpec)!==null&&pe!==void 0&&pe.User),default:"",value:(Le=D.Spec)===null||Le===void 0||(Le=Le.TaskTemplate)===null||Le===void 0||(Le=Le.ContainerSpec)===null||Le===void 0?void 0:Le.User},command:{useDefault:!((be=D.Spec)!==null&&be!==void 0&&(be=be.TaskTemplate)!==null&&be!==void 0&&(be=be.ContainerSpec)!==null&&be!==void 0&&be.Command),default:"",value:(Ce=D.Spec)===null||Ce===void 0||(Ce=Ce.TaskTemplate)===null||Ce===void 0||(Ce=Ce.ContainerSpec)===null||Ce===void 0||(Ce=Ce.Command)===null||Ce===void 0?void 0:Ce.join(" ")},log:function(l,k){return{driver:(k=l==null?void 0:l.Name)!==null&&k!==void 0?k:"json-file",maxFile:(l==null?void 0:l.Options)&&l.Options["max-file"],maxSize:(l==null?void 0:l.Options)&&l.Options["max-size"]}}((Ge=D.Spec)===null||Ge===void 0||(Ge=Ge.TaskTemplate)===null||Ge===void 0?void 0:Ge.LogDriver),dns:(Se=D.Spec)===null||Se===void 0||(Se=Se.TaskTemplate)===null||Se===void 0||(Se=Se.ContainerSpec)===null||Se===void 0||(Se=Se.DNSConfig)===null||Se===void 0?void 0:Se.Nameservers,label:((Ze=D.Spec)===null||Ze===void 0||(Ze=Ze.TaskTemplate)===null||Ze===void 0||(Ze=Ze.ContainerSpec)===null||Ze===void 0?void 0:Ze.Labels)&&Object.entries((ye=D.Spec)===null||ye===void 0||(ye=ye.TaskTemplate)===null||ye===void 0||(ye=ye.ContainerSpec)===null||ye===void 0?void 0:ye.Labels).map(function(l){return{name:l[0],value:l[1]}}),extraHosts:((U=D.Spec)===null||U===void 0||(U=U.TaskTemplate)===null||U===void 0||(U=U.ContainerSpec)===null||U===void 0?void 0:U.Hosts)&&((T=D.Spec)===null||T===void 0||(T=T.TaskTemplate)===null||T===void 0||(T=T.ContainerSpec)===null||T===void 0?void 0:T.Hosts.map(function(l){var k=l.split(":"),de=S()(k,2),He=de[0],Be=de[1];return{name:He,value:Be}})),capAdd:(E=D.Spec)===null||E===void 0||(E=E.TaskTemplate)===null||E===void 0||(E=E.ContainerSpec)===null||E===void 0?void 0:E.CapabilityAdd,scheduling:function(l){return{mode:l!=null&&l.Global?"global":"replicated",replicas:l!=null&&l.Replicated?l.Replicated.Replicas:1}}((ae=D.Spec)===null||ae===void 0?void 0:ae.Mode),constraint:function(l,k,de,He){var Be="all";l!=null&&(k=l.Constraints)!==null&&k!==void 0&&k.includes("node.role==worker")&&(Be="worker"),l!=null&&(de=l.Constraints)!==null&&de!==void 0&&de.includes("node.role==manager")&&(Be="manager"),l==null||(He=l.Constraints)===null||He===void 0||He.forEach(function(Ye){Ye.includes("node.id==")&&(Be="user")});var et="",nt=[];return l!=null&&l.Constraints&&l.Constraints.forEach(function(Ye){if(Ye.includes("node.id==")){var vt=Ye.split("node.id=="),st=S()(vt,2),Et=st[0],mt=st[1];et=mt;return}if(Ye.includes("==")){var ft=Ye.split("=="),ot=S()(ft,2),pt=ot[0],gt=ot[1];nt.push({name:pt,value:gt,operator:"=="});return}if(Ye.includes("!=")){var _t=Ye.split("!="),lt=S()(_t,2),St=lt[0],Dt=lt[1];nt.push({name:St,value:Dt,operator:"!="});return}}),{role:Be,node:et,label:nt}}((V=D.Spec)===null||V===void 0||(V=V.TaskTemplate)===null||V===void 0?void 0:V.Placement),placement:((Q=D.Spec)===null||Q===void 0||(Q=Q.TaskTemplate)===null||Q===void 0||(Q=Q.Placement)===null||Q===void 0?void 0:Q.Preferences)&&Object.entries((le=D.Spec)===null||le===void 0||(le=le.TaskTemplate)===null||le===void 0||(le=le.Placement)===null||le===void 0?void 0:le.Preferences).map(function(l){var k,de;return{name:"spread",value:(k=(de=l[1].Spread)===null||de===void 0?void 0:de.SpreadDescriptor)!==null&&k!==void 0?k:""}}),update:function(l,k,de){return{parallelism:(k=l==null?void 0:l.Parallelism)!==null&&k!==void 0?k:1,delay:(de=l==null?void 0:l.Delay)!==null&&de!==void 0?de:0,failureAction:l==null?void 0:l.FailureAction,order:l==null?void 0:l.Order}}((Ae=D.Spec)===null||Ae===void 0?void 0:Ae.UpdateConfig),healthcheck:function(l,k,de,He,Be,et){var nt=l!=null&&(k=l.Test)!==null&&k!==void 0&&k.includes("CMD-SHELL")?"CMD-SHELL":"CMD";return{interval:(de=l==null?void 0:l.Interval)!==null&&de!==void 0?de:30,timeout:(He=l==null?void 0:l.Timeout)!==null&&He!==void 0?He:10,retries:(Be=l==null?void 0:l.Retries)!==null&&Be!==void 0?Be:3,cmd:l!=null&&l.Test?l==null||(et=l.Test)===null||et===void 0?void 0:et.join(" "):"",shellType:nt}}((xe=D.Spec)===null||xe===void 0||(xe=xe.TaskTemplate)===null||xe===void 0||(xe=xe.ContainerSpec)===null||xe===void 0?void 0:xe.Healthcheck)},it=((Qe=D.Spec)===null||Qe===void 0?void 0:Qe.Labels)&&((tt=D.Spec)===null||tt===void 0?void 0:tt.Labels[Re.ev]);if(it&&(at.imageRegistry=parseInt(it)),(qe=D.Spec)!==null&&qe!==void 0&&(qe=qe.EndpointSpec)!==null&&qe!==void 0&&qe.Ports){var Ve;at.ports=(Ve=D.Spec)===null||Ve===void 0||(Ve=Ve.EndpointSpec)===null||Ve===void 0||(Ve=Ve.Ports)===null||Ve===void 0?void 0:Ve.map(function(l){var k;return{dest:String(l.TargetPort),host:String((k=l.PublishedPort)!==null&&k!==void 0?k:""),mode:l.PublishMode}})}(rt=Fe.current)===null||rt===void 0||rt.setFieldsValue(at),fe(!0)}}});var Ie=(0,n.useState)("basic"),Pe=S()(Ie,2),me=Pe[0],We=Pe[1],ke=new g.Uo("components.appForm"),$e=new g.Uo("swarm"),Fe=(0,n.useRef)(),ze=(0,n.useRef)(),B=(0,n.useRef)(),ge=(0,n.useRef)(),J=(0,n.useRef)(),_e=(0,n.useState)(!1),ce=S()(_e,2),we=ce[0],fe=ce[1];return(0,p.jsx)(h.Z.Provider,{value:{createFormRef:Fe,volumeListRef:ze,createEnvRef:J,createLinkRef:ge,domainRef:B},children:(0,p.jsx)(H.a,{drawerProps:{width:W.R_,forceRender:C.forceRender},formRef:Fe,title:$e.format("serviceCreateTitle.".concat(C.forceRender?"edit":"create")),onOpenChange:function(D){if(fe(D),!D){var f,R;!((f=Fe.current)===null||f===void 0)&&f.resetFields&&((R=Fe.current)===null||R===void 0||R.resetFields()),We("basic")}},open:we,trigger:C.showTrigger?(0,p.jsx)(i.ZP,{type:"primary",children:$e.format("serviceCreateTitle.create")}):void 0,onFinish:function(){var ne=v()(d()().mark(function D(f){var R,j,q;return d()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return j={id:f.id,siteTitle:f.siteTitle,siteName:f.siteName,hostname:f.hostname,imageRegistry:f.imageRegistry,imageName:f.imageName,ports:f.ports,environment:f.environment,volumes:f.volumes,restartPolicy:f.restart,cpus:f.cpus,memory:f.memory,workDir:f.workDir&&!f.workDir.useDefault?f.workDir.value:"",user:f.user&&!f.user.useDefault?f.user.value:"",command:f.command&&!f.command.useDefault?f.command.value:"",entrypoint:f.entrypoint&&!f.entrypoint.useDefault?f.entrypoint.value:"",log:f.log,dns:f.dns,label:f.label,extraHosts:f.extraHosts,capAdd:f.capAdd,scheduling:f.scheduling,constraint:f.constraint,placement:f.placement,update:f.update},f.healthcheck&&f.healthcheck.cmd&&f.healthcheck.cmd!=""&&(j.healthcheck=f.healthcheck),j.scheduling&&((R=j.scheduling)===null||R===void 0?void 0:R.mode)=="global"&&j.ports&&(j.ports=(q=j.ports)===null||q===void 0?void 0:q.map(function(A){return A.mode="host",A})),X.next=5,(0,Re.P3)(j);case 5:return C.onFinish&&C.onFinish(),X.abrupt("return",!0);case 7:case"end":return X.stop()}},D)}));return function(D){return ne.apply(this,arguments)}}(),children:(0,p.jsxs)(y.Z,{direction:"column",gutter:[0,10],ghost:!0,children:[(0,p.jsxs)(y.Z,{children:[(0,p.jsx)(t.Z,{name:"id",hidden:!0}),(0,p.jsx)(re.Z,{name:"siteTitle",label:g.FD.format("listDescription"),placeholder:$e.format("serviceCreateListDescriptionEmpty")}),(0,p.jsxs)(te.UW,{children:[(0,p.jsx)(re.Z,{width:"lg",name:"siteName",label:g.FD.format("listName"),required:!0,rules:[{required:!0}],placeholder:$e.format("serviceCreateListNameEmpty")}),(0,p.jsx)(re.Z,{label:"Hostname",name:"hostname",width:"md"})]}),(0,p.jsx)(Je,{})]}),(0,p.jsx)(w.Z,{offsetTop:50,children:(0,p.jsx)(y.Z,{style:{marginBottom:-20},children:(0,p.jsx)(M.Z,{activeKey:me,onChange:function(D){We(D),window.scrollTo(0,450)},items:ke.option("createTabOption",["basic","scheduling","run-command","cap","other"]).map(function(ne){return{label:ne.label,key:ne.value}})})})}),(0,p.jsxs)(Z.Z,{show:me=="basic",children:[(0,p.jsx)(P.Z,{showIngress:!0}),(0,p.jsx)(r.Z,{showAddButton:!0,showImportButton:!0,showCodeMode:!0,label:ke.format("createEnvTitle"),ref:J}),(0,p.jsx)(O.Z,{showDefault:!0,ref:ze,showType:!0}),(0,p.jsx)(s.Z,{})]}),(0,p.jsxs)(Z.Z,{show:me=="scheduling",children:[(0,p.jsx)(Ke,{}),(0,p.jsx)(F,{})]}),(0,p.jsxs)(Z.Z,{show:me=="run-command",children:[(0,p.jsx)(I,{}),(0,p.jsx)(x.Z,{showCommand:!0,showUser:!0,showWorkDir:!0}),(0,p.jsx)(je.Z,{}),(0,p.jsx)(Ne.Z,{}),(0,p.jsx)(u.Z,{}),(0,p.jsx)(Xe.Z,{})]}),(0,p.jsx)(Z.Z,{show:me=="other",children:(0,p.jsx)(o.Z,{})}),(0,p.jsx)(Z.Z,{show:me=="cap",children:(0,p.jsx)(m.Z,{})})]})})})}),Y=G},94617:function(se,$,e){"use strict";e.d($,{Z:function(){return ze}});var ee=e(15009),d=e.n(ee),z=e(99289),v=e.n(z),_=e(97857),S=e.n(_),W=e(5574),H=e.n(W),t=e(24494),i=e(5251),n=e(36146),s=e(86548),o=e(1883),m=e(74763),r=e(56729),P=e(42075),O=e(66309),Z=e(25593),y=e(96074),re=e(83062),te=e(60940),w=e(37413),M=e(94359),g=e(67294),h=e(87662),K=e(78451),De=e(3616),Ue=e(33160),p=e(43425),Je=e(57132),Me=e(71965),N=e(48689),ie=e(45605),Oe=e(60433),Te=e(38345),Re=e(97269),Ke=e(24739),je=e(31199),Ne=e(62370),x=e(64317),I=e(85265),F=e(86250),u=e(83622),Xe=e(84567),G=e(26412),Y=e(80821),C=e(76428),a=e(85893);function Ie(B){var ge,J,_e=new n.Uo("swarm"),ce=B.detail;if((ge=ce.Spec)!==null&&ge!==void 0&&(ge=ge.Mode)!==null&&ge!==void 0&&ge.Replicated){var we;return(0,a.jsxs)(P.Z,{children:[(0,a.jsx)(O.Z,{children:_e.format("listServiceMode.replicated")}),(0,a.jsx)(O.Z,{color:"success",bordered:!1,children:(we=ce.ServiceStatus)===null||we===void 0?void 0:we.RunningTasks}),(0,a.jsx)(O.Z,{color:"gold",bordered:!1,children:ce.Spec.Mode.Replicated.Replicas})]})}else if((J=ce.Spec)!==null&&J!==void 0&&(J=J.Mode)!==null&&J!==void 0&&J.Global)return(0,a.jsx)(O.Z,{children:_e.format("listServiceMode.global")})}var Pe=e(81146);function me(B){var ge=(0,g.useState)(!1),J=H()(ge,2),_e=J[0],ce=J[1],we=(0,g.useRef)();return(0,a.jsxs)(a.Fragment,{children:[B.trigger?g.cloneElement(B.trigger,{onClick:function(){ce(!0)}}):null,(0,a.jsx)(I.Z,{title:"".concat(n.FD.format("listLog")," - ").concat(B.detail.name),open:_e,forceRender:!0,onClose:function(){ce(!1)},afterOpenChange:function(ne){if(ne)setTimeout(function(){var f,R;(f=we.current)===null||f===void 0||f.start(),(R=we.current)===null||R===void 0||R.fit()},1e3);else{var D;(D=we.current)===null||D===void 0||D.close()}},width:De.FK,children:_e&&(0,a.jsx)(Pe.Z,{ref:we,showInDrawer:!0,id:"swarm:log:".concat(B.type,":").concat(B.detail.id),request:function(){var fe=v()(d()().mark(function ne(D){var f;return d()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,(0,t.m8)({id:B.detail.id,type:B.type,lineTotal:D.lineTotal,download:(f=D.download)!==null&&f!==void 0?f:!1,showTime:D.showTime});case 2:case"end":return j.stop()}},ne)}));return function(ne){return fe.apply(this,arguments)}}(),download:function(){var fe=v()(d()().mark(function ne(D){var f;return d()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,(0,t.Id)({id:B.detail.id,type:B.type,lineTotal:D.lineTotal,showTime:D.showTime,download:!0});case 2:return f=j.sent,j.abrupt("return",{data:new Blob([f],{type:"text/plain"}),name:B.detail.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return j.stop()}},ne)}));return function(ne){return fe.apply(this,arguments)}}()})})]})}var We=e(98093),ke=(0,g.forwardRef)(function(B,ge){var J,_e,ce,we,fe,ne,D,f,R,j,q,L,X;(0,g.useImperativeHandle)(ge,function(){return{show:function(T){Ee(T),ue(!0)}}});var A=(0,g.useState)(!1),b=H()(A,2),oe=b[0],ue=b[1],he=(0,g.useState)(),ve=H()(he,2),c=ve[0],Ee=ve[1],pe=new n.Uo("swarm"),Le=(0,g.useState)(""),be=H()(Le,2),Ce=be[0],Ge=be[1],Se=(0,g.useRef)(),Ze=(0,g.useRef)(),ye=(0,g.useRef)();return(0,g.useEffect)(function(){(0,h.K3)().then(function(U){var T;Ge((T=U.data.serverUrl)!==null&&T!==void 0?T:"")})},[]),(0,a.jsxs)(I.Z,{title:pe.format("serviceDetailTitle",{name:c==null||(J=c.Spec)===null||J===void 0?void 0:J.Name}),open:oe,forceRender:!0,width:De.R_,onClose:function(){ue(!1),Ee(void 0),B.onFinish&&B.onFinish()},extra:[c&&(0,a.jsx)(Y.Z,{type:"link",tips:n.FD.format("listManageRefresh"),action:v()(d()().mark(function U(){var T,E;return d()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.next=2,(0,t.ig)({id:c.ID});case 2:E=V.sent,Ee(E.data.info),!((T=ye.current)===null||T===void 0)&&T.reloadAndRest&&ye.current.reloadAndRest();case 5:case"end":return V.stop()}},U)})),icon:(0,a.jsx)(Ue.Z,{})},"refresh")],children:[(0,a.jsx)(We.Z,{forceRender:!0,ref:Ze,onFinish:v()(d()().mark(function U(){var T,E;return d()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.next=2,(0,t.ig)({id:(T=c==null?void 0:c.ID)!==null&&T!==void 0?T:""});case 2:E=V.sent,Ee(E.data.info);case 4:case"end":return V.stop()}},U)}))}),(0,a.jsxs)(F.Z,{vertical:!0,gap:20,children:[(0,a.jsx)(Te.Z,{title:(0,a.jsx)(p.Z,{}),ghost:!0,subTitle:n.FD.format("listManage"),children:(0,a.jsxs)(P.Z,{wrap:!0,children:[c&&(0,a.jsx)(u.ZP,{type:"primary",icon:(0,a.jsx)(s.Z,{}),onClick:function(){var T;(T=Ze.current)===null||T===void 0||T.edit(c)},children:n.FD.format("listManageEdit")}),(0,a.jsx)(y.Z,{type:"vertical"}),c&&(0,a.jsx)(me,{type:"service",detail:{id:(_e=c.ID)!==null&&_e!==void 0?_e:"",name:(ce=(we=c.Spec)===null||we===void 0?void 0:we.Name)!==null&&ce!==void 0?ce:""},trigger:(0,a.jsx)(u.ZP,{icon:(0,a.jsx)(o.Z,{}),children:n.FD.format("listManageLog")},"log")}),(c==null||(fe=c.Spec)===null||fe===void 0||(fe=fe.Mode)===null||fe===void 0?void 0:fe.Replicated)&&(0,a.jsx)(Y.Z,{confirmProps:{forceRender:!0},action:v()(d()().mark(function U(){var T,E,ae;return d()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Q.abrupt("return",(0,t.x$)({name:(T=c==null?void 0:c.ID)!==null&&T!==void 0?T:"",replicas:(E=Se.current)===null||E===void 0?void 0:E.getFieldValue("replicas"),force:(ae=Se.current)===null||ae===void 0?void 0:ae.getFieldValue("force")}));case 1:case"end":return Q.stop()}},U)})),confirmOnOpenChange:function(){var T,E;(T=Se.current)===null||T===void 0||T.setFieldsValue({replicas:(E=c.Spec)===null||E===void 0||(E=E.Mode)===null||E===void 0||(E=E.Replicated)===null||E===void 0?void 0:E.Replicas,force:!1})},confirm:(0,a.jsx)(Re.A,{layout:"inline",submitter:!1,formRef:Se,children:(0,a.jsxs)(P.Z,{direction:"vertical",size:[0,15],style:{width:600},children:[(0,a.jsx)(Z.Z.Text,{children:pe.format("serviceManageScalingTip")}),(0,a.jsxs)(Ke.UW,{children:[(0,a.jsx)(je.Z,{label:pe.format("serviceManageScalingReplicas"),width:"sm",name:"replicas"}),(0,a.jsx)(Ne.Z,{name:"force",valuePropName:"checked",children:(0,a.jsxs)(Xe.Z,{children:[n.FD.format("listManageDeployForce"),"\uFF1F"]})})]})]})}),onSuccess:function(){(0,t.ig)({id:c.ID}).then(function(T){Ee(T.data.info)})},icon:(0,a.jsx)(Je.Z,{}),children:n.FD.format("listManageScaling")}),c&&(0,a.jsx)(Y.Z,{action:function(){return(0,t.x$)({name:c.ID,rollback:!0})},icon:(0,a.jsx)(Me.Z,{}),confirm:"notification.confirm.title",children:n.FD.format("listManageRollback")}),(0,a.jsx)(Y.Z,{showDivider:!0,action:function(){var T;return(0,t.tm)({name:[(T=c==null?void 0:c.ID)!==null&&T!==void 0?T:""]})},type:"primary",danger:!0,onSuccess:function(T){ue(!1),B.onFinish&&B.onFinish()},confirm:"notification.confirm.title",icon:(0,a.jsx)(N.Z,{}),children:n.FD.format("listManageDelete")})]})}),c&&(0,a.jsx)(w.Z,{publicPort:((ne=c.Endpoint)===null||ne===void 0?void 0:ne.Ports)&&((D=c.Endpoint)===null||D===void 0?void 0:D.Ports.map(function(U){var T,E,ae;return{PrivatePort:(T=U.TargetPort)!==null&&T!==void 0?T:0,Type:(E=U.Protocol)!==null&&E!==void 0?E:"tcp",IP:"",PublicPort:(ae=U.PublishedPort)!==null&&ae!==void 0?ae:0}})),serverIp:Ce,showInDetail:!0,ghost:!0,layout:"inline"}),(0,a.jsx)(Te.Z,{title:(0,a.jsx)(ie.Z,{}),subTitle:n.FD.format("listManageDetail"),ghost:!0,children:(0,a.jsxs)(G.Z,{column:1,bordered:!0,styles:{label:{width:150}},children:[(0,a.jsxs)(G.Z.Item,{label:n.FD.format("listTitle"),children:[(0,a.jsx)(C.Z,{title:c==null?void 0:c.ID})," - ",c==null||(f=c.Spec)===null||f===void 0?void 0:f.Name,c&&((R=c.UpdateStatus)===null||R===void 0?void 0:R.State)&&(0,a.jsxs)(a.Fragment,{children:[" - ",(0,a.jsx)(M.Z,{status:"service.".concat((j=c.UpdateStatus)===null||j===void 0?void 0:j.State)})]})]}),(0,a.jsx)(G.Z.Item,{label:n.FD.format("listDescription"),children:(c==null||(q=c.Spec)===null||q===void 0?void 0:q.Labels)&&c.Spec.Labels[t.$m]}),(0,a.jsx)(G.Z.Item,{label:n.FD.format("listRunTask"),children:(0,a.jsx)(P.Z,{children:(c==null?void 0:c.ServiceStatus)&&Object.keys(c.ServiceStatus).map(function(U){var T=U;return(c==null?void 0:c.ServiceStatus)&&(0,a.jsx)(re.Z,{title:pe.format("listServiceStatusTip.".concat(T)),children:(0,a.jsxs)(O.Z,{color:pe.format("listServiceStatusColor.".concat(T)),bordered:!1,children:[pe.format("listServiceStatus.".concat(T))," ",c==null?void 0:c.ServiceStatus[T]]})},T)})})}),(0,a.jsx)(G.Z.Item,{label:n.FD.format("listServiceMode"),children:c&&(0,a.jsx)(Ie,{detail:c})}),(0,a.jsx)(G.Z.Item,{label:n.FD.format("listImageName"),children:c==null||(L=c.Spec)===null||L===void 0||(L=L.TaskTemplate)===null||L===void 0||(L=L.ContainerSpec)===null||L===void 0?void 0:L.Image}),(0,a.jsx)(G.Z.Item,{label:n.FD.format("listVersion"),children:c==null||(X=c.Version)===null||X===void 0?void 0:X.Index}),(0,a.jsx)(G.Z.Item,{label:n.FD.format("listCreatedAt"),children:(0,i.NF)(c==null?void 0:c.CreatedAt)}),(0,a.jsx)(G.Z.Item,{label:n.FD.format("listUpdatedAt"),children:(0,i.NF)(c==null?void 0:c.UpdatedAt)})]})}),c&&(0,a.jsx)(Te.Z,{title:(0,a.jsx)(Oe.Z,{}),subTitle:pe.format("listTaskTitle"),ghost:!0,children:(0,a.jsx)(r.Z,{scroll:{x:"max-content"},rowKey:"ID",search:{filterType:"light"},actionRef:ye,columns:[{search:!1,title:n.FD.format("listName"),render:function(T,E,ae,V,Q){return E.ID}},{search:!1,width:200,title:n.FD.format("listNodeName"),render:function(T,E,ae,V,Q){return E.NodeID}},{search:!1,width:50,title:n.FD.format("listSlot"),render:function(T,E,ae,V,Q){return E.Slot}},{key:"status",renderFormItem:function(T,E,ae,V){return(0,a.jsx)(x.Z,{name:"status",valueEnum:Object.fromEntries(pe.option("listTaskStatusOption",["running","shutdown","accepted"]).map(function(Q){return[Q.value,Q.label]}))})},width:120,title:n.FD.format("listRunStatus"),render:function(T,E,ae){var V;if(E.Status.State!="running"){var Q;return(0,a.jsx)(M.Z,{status:"task.".concat(E.Status.State),tip:(Q=E.Status.Err)!==null&&Q!==void 0?Q:E.Status.Message})}return(0,a.jsx)(M.Z,{status:"task.".concat(E.DesiredState),tip:(V=E.Status.Err)!==null&&V!==void 0?V:E.Status.Message})}},{search:!1,width:180,title:n.FD.format("listUpdatedAt"),render:function(T,E,ae,V,Q){return(0,i.NF)(E.UpdatedAt)}},{search:!1,width:100,title:n.FD.format("listManage"),fixed:"right",render:function(T,E,ae,V,Q){var le,Ae;return(0,a.jsx)(P.Z,{children:(0,a.jsx)(me,{type:"node",detail:{id:(le=E.ID)!==null&&le!==void 0?le:"",name:(Ae=E.ID)!==null&&Ae!==void 0?Ae:""},trigger:(0,a.jsx)(Z.Z.Link,{children:(0,a.jsx)(o.Z,{})})})})}}],request:function(){var U=v()(d()().mark(function T(E){var ae,V;return d()().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:return le.next=2,(0,t.XX)({serviceName:c==null?void 0:c.ID,status:E.status});case 2:return ae=le.sent,le.next=5,(0,t.HN)();case 5:return V=le.sent,le.abrupt("return",{data:ae.data.list.map(function(Ae){var xe,Qe=V&&((xe=V.data.list.find(function(tt){return tt.ID==Ae.NodeID}))===null||xe===void 0||(xe=xe.Description)===null||xe===void 0?void 0:xe.Hostname);return Qe&&(Ae.NodeID=Qe),Ae}),success:!0,total:ae.data.list.length});case 7:case"end":return le.stop()}},T)}));return function(T){return U.apply(this,arguments)}}()})})]})]})}),$e=ke,Fe=(0,g.forwardRef)(function(B,ge){(0,g.useImperativeHandle)(ge,function(){return{reload:function(){var R;!((R=ne.current)===null||R===void 0)&&R.reloadAndRest&&ne.current.reloadAndRest()}}});var J=(0,g.useState)(""),_e=H()(J,2),ce=_e[0],we=_e[1],fe=(0,g.useRef)(),ne=(0,g.useRef)();(0,g.useEffect)(function(){(0,h.K3)().then(function(f){var R;we((R=f.data.serverUrl)!==null&&R!==void 0?R:"")})},[]);var D={};return B.showManage||(D=S()(S()({},D),{})),(0,m.k)(B.showSearch)&&(D=S()(S()({},D),{search:!1})),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($e,{ref:fe,onFinish:function(){var R;!((R=ne.current)===null||R===void 0)&&R.reloadAndRest&&ne.current.reloadAndRest()}}),(0,a.jsx)(r.Z,S()(S()({},D),{},{ghost:!0,actionRef:ne,scroll:{x:"max-content"},rowKey:"ID",columns:[{key:"serviceName",title:n.FD.format("listServiceName"),render:function(R,j,q,L,X){var A,b=0;return j.Task&&j.Task.forEach(function(oe){oe.Status.State=="running"&&(b+=1)}),(0,a.jsxs)(P.Z,{children:[j.Task&&(0,a.jsx)(O.Z,{color:"success",bordered:!1,children:b}),(0,a.jsx)(Z.Z.Link,{onClick:function(){var ue;(ue=fe.current)===null||ue===void 0||ue.show(j)},children:(A=j.Spec)===null||A===void 0?void 0:A.Name})]})}},{width:150,search:!1,title:n.FD.format("listPort"),render:function(R,j,q,L,X){var A,b,oe=[];return!((A=j.Endpoint)===null||A===void 0)&&A.Ports&&((b=j.Endpoint)===null||b===void 0||b.Ports.map(function(ue){var he,ve,c;oe.push({PrivatePort:(he=ue.TargetPort)!==null&&he!==void 0?he:0,Type:(ve=ue.Protocol)!==null&&ve!==void 0?ve:"tcp",IP:"0.0.0.0",PublicPort:(c=ue.PublishedPort)!==null&&c!==void 0?c:0})})),(0,a.jsx)(w.Z,{ghost:!0,publicPort:oe,serverIp:ce})}},{width:150,search:!1,title:n.FD.format("listServiceMode"),render:function(R,j,q,L,X){return(0,a.jsx)(Ie,{detail:j})}},{hidden:!B.showImageName,width:400,search:!1,title:n.FD.format("listImageName"),render:function(R,j,q,L,X){var A,b=((A=j.Spec)===null||A===void 0||(A=A.TaskTemplate)===null||A===void 0||(A=A.ContainerSpec)===null||A===void 0?void 0:A.Image)||"",oe=b.includes("@")?b.split("@"):[b,null],ue=H()(oe,2),he=ue[0],ve=ue[1];return(0,a.jsx)(K.Z,{children:he})}},{search:!1,width:180,title:n.FD.format("listCreatedAt"),render:function(R,j,q,L,X){return(0,i.NF)(j.CreatedAt)}},{search:!1,width:180,title:n.FD.format("listUpdatedAt"),render:function(R,j,q,L,X){return(0,i.NF)(j.UpdatedAt)}},{hidden:!B.showManage,search:!1,title:n.FD.format("listManage"),width:100,fixed:"right",render:function(R,j,q,L,X){return(0,a.jsx)(P.Z,{split:(0,a.jsx)(y.Z,{type:"vertical"}),children:B.showManage&&B.showManage.onEdit&&(0,a.jsx)(Z.Z.Link,{onClick:function(){var b;!((b=B.showManage)===null||b===void 0)&&b.onEdit&&B.showManage.onEdit(j)},children:(0,a.jsx)(re.Z,{title:n.FD.format("listManageEdit"),children:(0,a.jsx)(s.Z,{})})},"edit")})}}],request:function(){var f=v()(d()().mark(function R(j){var q,L,X;return d()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(!B.showWithNodeId){b.next=7;break}return b.next=3,(0,t.rN)({nodeId:(q=B.showWithNodeId)!==null&&q!==void 0?q:""});case 3:return L=b.sent,b.abrupt("return",{data:L.data.list,total:L.data.list.length,success:!0});case 7:return b.next=9,(0,t.kM)({name:j.serviceName});case 9:return X=b.sent,b.abrupt("return",{data:X.data.list,total:X.data.list.length,success:!0});case 11:case"end":return b.stop()}},R)}));return function(R){return f.apply(this,arguments)}}(),expandable:B.showWithNodeId?{expandRowByClick:!0,rowExpandable:function(R){return R.Task&&R.Task.length>0&&R.Task.filter(function(j){return j.Status.State=="running"}).length>0},expandedRowRender:function(R){return(0,a.jsx)(te.Z,{rowKey:"ID",columns:[{title:n.FD.format("listName"),render:function(q,L,X){return L.ID}},{width:120,title:n.FD.format("listRunStatus"),render:function(q,L,X){var A;return(0,a.jsx)(M.Z,{status:"task.".concat(L.Status.State),tip:(A=L.Status.Err)!==null&&A!==void 0?A:L.Status.Message})}},{title:n.FD.format("listUpdatedAt"),width:180,render:function(q,L,X){return(0,i.NF)(L.UpdatedAt)}},{width:100,title:n.FD.format("listManage"),fixed:"right",render:function(q,L,X){var A,b;return(0,a.jsx)(P.Z,{children:(0,a.jsx)(me,{type:"node",detail:{id:(A=L.ID)!==null&&A!==void 0?A:"",name:(b=L.ID)!==null&&b!==void 0?b:""},trigger:(0,a.jsx)(Z.Z.Link,{children:(0,a.jsx)(o.Z,{})})})})}}],pagination:!1,dataSource:R.Task.filter(function(j){return j.Status.State=="running"})})}}:void 0}))]})}),ze=Fe},76428:function(se,$,e){"use strict";e.d($,{Z:function(){return v}});var ee=e(25593),d=e(67294),z=e(85893);function v(_){return(0,z.jsx)(ee.Z.Text,{copyable:!0,children:_.title})}},12323:function(se,$,e){"use strict";e.d($,{X:function(){return ee},n:function(){return d}});var ee={convertEol:!0,fontFamily:'Menlo, Monaco, "Courier New", monospace',fontWeight:400,fontSize:16,lineHeight:1,cursorStyle:"block",cursorInactiveStyle:"outline",cursorBlink:!0,letterSpacing:0,theme:{foreground:"#bfbfbf",cursor:"gray",selectionForeground:"#ffffff"}},d=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"]},24494:function(se,$,e){"use strict";e.d($,{$m:function(){return S},HN:function(){return P},Id:function(){return m},JC:function(){return H},P3:function(){return Re},QB:function(){return w},UK:function(){return i},XX:function(){return K},Zc:function(){return Z},ev:function(){return W},ig:function(){return je},kM:function(){return Je},kp:function(){return g},m8:function(){return s},rN:function(){return Ue},tm:function(){return Oe},vb:function(){return re},x$:function(){return N}});var ee=e(15009),d=e.n(ee),z=e(99289),v=e.n(z),_=e(82346),S="com.dpanel.swarm.service.description",W="com.dpanel.swarm.service.registry";function H(){return t.apply(this,arguments)}function t(){return t=v()(d()().mark(function x(){return d()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.abrupt("return",(0,_.request)("/api/app/swarm/info",{method:"POST"}));case 1:case"end":return F.stop()}},x)})),t.apply(this,arguments)}function i(x){return n.apply(this,arguments)}function n(){return n=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/init",{method:"POST",data:I}));case 1:case"end":return u.stop()}},x)})),n.apply(this,arguments)}function s(x){return o.apply(this,arguments)}function o(){return o=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return I.id=String(I.id),u.abrupt("return",(0,_.request)("/api/app/swarm/log",{method:"POST",data:I}));case 2:case"end":return u.stop()}},x)})),o.apply(this,arguments)}function m(x){return r.apply(this,arguments)}function r(){return r=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return I.download=!0,I.id=String(I.id),u.next=4,(0,_.request)("/api/app/swarm/log",{method:"POST",data:I,responseType:"blob"});case 4:return u.abrupt("return",u.sent);case 5:case"end":return u.stop()}},x)})),r.apply(this,arguments)}function P(x){return O.apply(this,arguments)}function O(){return O=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/node-list",{method:"POST",data:I}));case 1:case"end":return u.stop()}},x)})),O.apply(this,arguments)}function Z(x){return y.apply(this,arguments)}function y(){return y=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/node-update",{method:"POST",data:I}));case 1:case"end":return u.stop()}},x)})),y.apply(this,arguments)}function re(x){return te.apply(this,arguments)}function te(){return te=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/info-join",{method:"POST",data:I}));case 1:case"end":return u.stop()}},x)})),te.apply(this,arguments)}function w(x){return M.apply(this,arguments)}function M(){return M=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/node-remove",{method:"POST",data:I}));case 1:case"end":return u.stop()}},x)})),M.apply(this,arguments)}function g(x){return h.apply(this,arguments)}function h(){return h=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/node-prune",{method:"POST",data:I}));case 1:case"end":return u.stop()}},x)})),h.apply(this,arguments)}function K(x){return De.apply(this,arguments)}function De(){return De=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/task-list",{method:"POST",data:I}));case 1:case"end":return u.stop()}},x)})),De.apply(this,arguments)}function Ue(x){return p.apply(this,arguments)}function p(){return p=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/task-list-in-node",{method:"POST",data:I}));case 1:case"end":return u.stop()}},x)})),p.apply(this,arguments)}function Je(x){return Me.apply(this,arguments)}function Me(){return Me=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/service-list",{method:"POST",data:I}));case 1:case"end":return u.stop()}},x)})),Me.apply(this,arguments)}function N(x){return ie.apply(this,arguments)}function ie(){return ie=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/service-scaling",{method:"POST",data:I}));case 1:case"end":return u.stop()}},x)})),ie.apply(this,arguments)}function Oe(x){return Te.apply(this,arguments)}function Te(){return Te=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/service-delete",{method:"POST",data:I}));case 1:case"end":return u.stop()}},x)})),Te.apply(this,arguments)}function Re(x){return Ke.apply(this,arguments)}function Ke(){return Ke=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/service-create",{method:"POST",data:I}));case 1:case"end":return u.stop()}},x)})),Ke.apply(this,arguments)}function je(x){return Ne.apply(this,arguments)}function Ne(){return Ne=v()(d()().mark(function x(I){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/service-detail",{method:"POST",data:I}));case 1:case"end":return u.stop()}},x)})),Ne.apply(this,arguments)}},3393:function(se,$,e){"use strict";e.d($,{Gb:function(){return H},Pn:function(){return s},Rb:function(){return m},YU:function(){return S},ZQ:function(){return Z},_U:function(){return i},cD:function(){return re},cd:function(){return P}});var ee=e(15009),d=e.n(ee),z=e(99289),v=e.n(z),_=e(82346);function S(w){return W.apply(this,arguments)}function W(){return W=v()(d()().mark(function w(M){return d()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,_.request)("/api/app/image/get-detail",{method:"POST",data:M}));case 1:case"end":return h.stop()}},w)})),W.apply(this,arguments)}function H(w){return t.apply(this,arguments)}function t(){return t=v()(d()().mark(function w(M){return d()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,_.request)("/api/app/image/tag-remote",{method:"POST",data:M}));case 1:case"end":return h.stop()}},w)})),t.apply(this,arguments)}function i(w){return n.apply(this,arguments)}function n(){return n=v()(d()().mark(function w(M){return d()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,_.request)("/api/app/image/tag-add",{method:"POST",data:M}));case 1:case"end":return h.stop()}},w)})),n.apply(this,arguments)}function s(w){return o.apply(this,arguments)}function o(){return o=v()(d()().mark(function w(M){return d()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,_.request)("/api/app/image/tag-delete",{method:"POST",data:M}));case 1:case"end":return h.stop()}},w)})),o.apply(this,arguments)}function m(w){return r.apply(this,arguments)}function r(){return r=v()(d()().mark(function w(M){return d()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,_.request)("/api/app/image/export",{method:"POST",data:M,responseType:"blob"}));case 1:case"end":return h.stop()}},w)})),r.apply(this,arguments)}function P(w){return O.apply(this,arguments)}function O(){return O=v()(d()().mark(function w(M){return d()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,_.request)("/api/pro/image/get-remote-tag",{method:"POST",data:M}));case 1:case"end":return h.stop()}},w)})),O.apply(this,arguments)}function Z(w){return y.apply(this,arguments)}function y(){return y=v()(d()().mark(function w(M){return d()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,_.request)("/api/app/image/check-upgrade",{method:"POST",data:M}));case 1:case"end":return h.stop()}},w)})),y.apply(this,arguments)}function re(w){return te.apply(this,arguments)}function te(){return te=v()(d()().mark(function w(M){return d()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,_.request)("/api/pro/image/get-rootfs",{method:"POST",data:M}));case 1:case"end":return h.stop()}},w)})),te.apply(this,arguments)}},75458:function(se){(function($,e){se.exports=e()})(self,()=>(()=>{"use strict";var $={345:(z,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.runAndSubscribe=v.forwardEvent=v.EventEmitter=void 0,v.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=_=>(this._listeners.push(_),{dispose:()=>{if(!this._disposed){for(let S=0;S<this._listeners.length;S++)if(this._listeners[S]===_)return void this._listeners.splice(S,1)}}})),this._event}fire(_,S){const W=[];for(let H=0;H<this._listeners.length;H++)W.push(this._listeners[H]);for(let H=0;H<W.length;H++)W[H].call(void 0,_,S)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},v.forwardEvent=function(_,S){return _(W=>S.fire(W))},v.runAndSubscribe=function(_,S){return S(void 0),_(W=>S(W))}},859:(z,v)=>{function _(S){for(const W of S)W.dispose();S.length=0}Object.defineProperty(v,"__esModule",{value:!0}),v.getDisposeArrayDisposable=v.disposeArray=v.toDisposable=v.MutableDisposable=v.Disposable=void 0,v.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const S of this._disposables)S.dispose();this._disposables.length=0}register(S){return this._disposables.push(S),S}unregister(S){const W=this._disposables.indexOf(S);W!==-1&&this._disposables.splice(W,1)}},v.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(S){var W;this._isDisposed||S===this._value||((W=this._value)==null||W.dispose(),this._value=S)}clear(){this.value=void 0}dispose(){var S;this._isDisposed=!0,(S=this._value)==null||S.dispose(),this._value=void 0}},v.toDisposable=function(S){return{dispose:S}},v.disposeArray=_,v.getDisposeArrayDisposable=function(S){return{dispose:()=>_(S)}}}},e={};function ee(z){var v=e[z];if(v!==void 0)return v.exports;var _=e[z]={exports:{}};return $[z](_,_.exports,ee),_.exports}var d={};return(()=>{var z=d;Object.defineProperty(z,"__esModule",{value:!0}),z.SearchAddon=void 0;const v=ee(345),_=ee(859),S=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?";class W extends _.Disposable{constructor(t){var i;super(),this._highlightedLines=new Set,this._highlightDecorations=[],this._selectedDecoration=this.register(new _.MutableDisposable),this._linesCacheTimeoutId=0,this._linesCacheDisposables=new _.MutableDisposable,this._onDidChangeResults=this.register(new v.EventEmitter),this.onDidChangeResults=this._onDidChangeResults.event,this._highlightLimit=(i=t==null?void 0:t.highlightLimit)!=null?i:1e3}activate(t){this._terminal=t,this.register(this._terminal.onWriteParsed(()=>this._updateMatches())),this.register(this._terminal.onResize(()=>this._updateMatches())),this.register((0,_.toDisposable)(()=>this.clearDecorations()))}_updateMatches(){var t;this._highlightTimeout&&window.clearTimeout(this._highlightTimeout),this._cachedSearchTerm&&((t=this._lastSearchOptions)!=null&&t.decorations)&&(this._highlightTimeout=setTimeout(()=>{const i=this._cachedSearchTerm;this._cachedSearchTerm=void 0,this.findPrevious(i,ht(ct({},this._lastSearchOptions),{incremental:!0,noScroll:!0}))},200))}clearDecorations(t){this._selectedDecoration.clear(),(0,_.disposeArray)(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear(),t||(this._cachedSearchTerm=void 0)}clearActiveDecoration(){this._selectedDecoration.clear()}findNext(t,i){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const n=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,i);this._lastSearchOptions=i,i!=null&&i.decorations&&(this._cachedSearchTerm===void 0||t!==this._cachedSearchTerm||n)&&this._highlightAllMatches(t,i);const s=this._findNextAndSelect(t,i);return this._fireResults(i),this._cachedSearchTerm=t,s}_highlightAllMatches(t,i){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!t||t.length===0)return void this.clearDecorations();i=i||{},this.clearDecorations(!0);const n=[];let s,o=this._find(t,0,0,i);for(;o&&((s==null?void 0:s.row)!==o.row||(s==null?void 0:s.col)!==o.col)&&!(n.length>=this._highlightLimit);)s=o,n.push(s),o=this._find(t,s.col+s.term.length>=this._terminal.cols?s.row+1:s.row,s.col+s.term.length>=this._terminal.cols?0:s.col+1,i);for(const m of n){const r=this._createResultDecoration(m,i.decorations);r&&(this._highlightedLines.add(r.marker.line),this._highlightDecorations.push({decoration:r,match:m,dispose(){r.dispose()}}))}}_find(t,i,n,s){var r;if(!this._terminal||!t||t.length===0)return(r=this._terminal)==null||r.clearSelection(),void this.clearDecorations();if(n>this._terminal.cols)throw new Error(`Invalid col: ${n} to search in terminal of ${this._terminal.cols} cols`);let o;this._initLinesCache();const m={startRow:i,startCol:n};if(o=this._findInLine(t,m,s),!o)for(let P=i+1;P<this._terminal.buffer.active.baseY+this._terminal.rows&&(m.startRow=P,m.startCol=0,o=this._findInLine(t,m,s),!o);P++);return o}_findNextAndSelect(t,i){var P;if(!this._terminal||!t||t.length===0)return(P=this._terminal)==null||P.clearSelection(),this.clearDecorations(),!1;const n=this._terminal.getSelectionPosition();this._terminal.clearSelection();let s=0,o=0;n&&(this._cachedSearchTerm===t?(s=n.end.x,o=n.end.y):(s=n.start.x,o=n.start.y)),this._initLinesCache();const m={startRow:o,startCol:s};let r=this._findInLine(t,m,i);if(!r)for(let O=o+1;O<this._terminal.buffer.active.baseY+this._terminal.rows&&(m.startRow=O,m.startCol=0,r=this._findInLine(t,m,i),!r);O++);if(!r&&o!==0)for(let O=0;O<o&&(m.startRow=O,m.startCol=0,r=this._findInLine(t,m,i),!r);O++);return!r&&n&&(m.startRow=n.start.y,m.startCol=0,r=this._findInLine(t,m,i)),this._selectResult(r,i==null?void 0:i.decorations,i==null?void 0:i.noScroll)}findPrevious(t,i){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const n=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,i);this._lastSearchOptions=i,i!=null&&i.decorations&&(this._cachedSearchTerm===void 0||t!==this._cachedSearchTerm||n)&&this._highlightAllMatches(t,i);const s=this._findPreviousAndSelect(t,i);return this._fireResults(i),this._cachedSearchTerm=t,s}_didOptionsChange(t,i){return!!i&&(t.caseSensitive!==i.caseSensitive||t.regex!==i.regex||t.wholeWord!==i.wholeWord)}_fireResults(t){if(t!=null&&t.decorations){let i=-1;if(this._selectedDecoration.value){const n=this._selectedDecoration.value.match;for(let s=0;s<this._highlightDecorations.length;s++){const o=this._highlightDecorations[s].match;if(o.row===n.row&&o.col===n.col&&o.size===n.size){i=s;break}}}this._onDidChangeResults.fire({resultIndex:i,resultCount:this._highlightDecorations.length})}}_findPreviousAndSelect(t,i){var O;if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!this._terminal||!t||t.length===0)return(O=this._terminal)==null||O.clearSelection(),this.clearDecorations(),!1;const n=this._terminal.getSelectionPosition();this._terminal.clearSelection();let s=this._terminal.buffer.active.baseY+this._terminal.rows-1,o=this._terminal.cols;const m=!0;this._initLinesCache();const r={startRow:s,startCol:o};let P;if(n&&(r.startRow=s=n.start.y,r.startCol=o=n.start.x,this._cachedSearchTerm!==t&&(P=this._findInLine(t,r,i,!1),P||(r.startRow=s=n.end.y,r.startCol=o=n.end.x))),P||(P=this._findInLine(t,r,i,m)),!P){r.startCol=Math.max(r.startCol,this._terminal.cols);for(let Z=s-1;Z>=0&&(r.startRow=Z,P=this._findInLine(t,r,i,m),!P);Z--);}if(!P&&s!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let Z=this._terminal.buffer.active.baseY+this._terminal.rows-1;Z>=s&&(r.startRow=Z,P=this._findInLine(t,r,i,m),!P);Z--);return this._selectResult(P,i==null?void 0:i.decorations,i==null?void 0:i.noScroll)}_initLinesCache(){const t=this._terminal;this._linesCache||(this._linesCache=new Array(t.buffer.active.length),this._linesCacheDisposables.value=(0,_.getDisposeArrayDisposable)([t.onLineFeed(()=>this._destroyLinesCache()),t.onCursorMove(()=>this._destroyLinesCache()),t.onResize(()=>this._destroyLinesCache())])),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._linesCacheDisposables.clear(),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_isWholeWord(t,i,n){return(t===0||S.includes(i[t-1]))&&(t+n.length===i.length||S.includes(i[t+n.length]))}_findInLine(t,i,n={},s=!1){var g;const o=this._terminal,m=i.startRow,r=i.startCol,P=o.buffer.active.getLine(m);if(P!=null&&P.isWrapped)return s?void(i.startCol+=o.cols):(i.startRow--,i.startCol+=o.cols,this._findInLine(t,i,n));let O=(g=this._linesCache)==null?void 0:g[m];O||(O=this._translateBufferLineToStringWithWrap(m,!0),this._linesCache&&(this._linesCache[m]=O));const[Z,y]=O,re=this._bufferColsToStringOffset(m,r),te=n.caseSensitive?t:t.toLowerCase(),w=n.caseSensitive?Z:Z.toLowerCase();let M=-1;if(n.regex){const h=RegExp(te,"g");let K;if(s)for(;K=h.exec(w.slice(0,re));)M=h.lastIndex-K[0].length,t=K[0],h.lastIndex-=t.length-1;else K=h.exec(w.slice(re)),K&&K[0].length>0&&(M=re+(h.lastIndex-K[0].length),t=K[0])}else s?re-te.length>=0&&(M=w.lastIndexOf(te,re-te.length)):M=w.indexOf(te,re);if(M>=0){if(n.wholeWord&&!this._isWholeWord(M,w,t))return;let h=0;for(;h<y.length-1&&M>=y[h+1];)h++;let K=h;for(;K<y.length-1&&M+t.length>=y[K+1];)K++;const De=M-y[h],Ue=M+t.length-y[K],p=this._stringLengthToBufferSize(m+h,De);return{term:t,col:p,row:m+h,size:this._stringLengthToBufferSize(m+K,Ue)-p+o.cols*(K-h)}}}_stringLengthToBufferSize(t,i){const n=this._terminal.buffer.active.getLine(t);if(!n)return 0;for(let s=0;s<i;s++){const o=n.getCell(s);if(!o)break;const m=o.getChars();m.length>1&&(i-=m.length-1);const r=n.getCell(s+1);r&&r.getWidth()===0&&i++}return i}_bufferColsToStringOffset(t,i){const n=this._terminal;let s=t,o=0,m=n.buffer.active.getLine(s);for(;i>0&&m;){for(let r=0;r<i&&r<n.cols;r++){const P=m.getCell(r);if(!P)break;P.getWidth()&&(o+=P.getCode()===0?1:P.getChars().length)}if(s++,m=n.buffer.active.getLine(s),m&&!m.isWrapped)break;i-=n.cols}return o}_translateBufferLineToStringWithWrap(t,i){var r;const n=this._terminal,s=[],o=[0];let m=n.buffer.active.getLine(t);for(;m;){const P=n.buffer.active.getLine(t+1),O=!!P&&P.isWrapped;let Z=m.translateToString(!O&&i);if(O&&P){const y=m.getCell(m.length-1);y&&y.getCode()===0&&y.getWidth()===1&&((r=P.getCell(0))==null?void 0:r.getWidth())===2&&(Z=Z.slice(0,-1))}if(s.push(Z),!O)break;o.push(o[o.length-1]+Z.length),t++,m=P}return[s.join(""),o]}_selectResult(t,i,n){const s=this._terminal;if(this._selectedDecoration.clear(),!t)return s.clearSelection(),!1;if(s.select(t.col,t.row,t.size),i){const o=s.registerMarker(-s.buffer.active.baseY-s.buffer.active.cursorY+t.row);if(o){const m=s.registerDecoration({marker:o,x:t.col,width:t.size,backgroundColor:i.activeMatchBackground,layer:"top",overviewRulerOptions:{color:i.activeMatchColorOverviewRuler}});if(m){const r=[];r.push(o),r.push(m.onRender(P=>this._applyStyles(P,i.activeMatchBorder,!0))),r.push(m.onDispose(()=>(0,_.disposeArray)(r))),this._selectedDecoration.value={decoration:m,match:t,dispose(){m.dispose()}}}}}if(!n&&(t.row>=s.buffer.active.viewportY+s.rows||t.row<s.buffer.active.viewportY)){let o=t.row-s.buffer.active.viewportY;o-=Math.floor(s.rows/2),s.scrollLines(o)}return!0}_applyStyles(t,i,n){t.classList.contains("xterm-find-result-decoration")||(t.classList.add("xterm-find-result-decoration"),i&&(t.style.outline=`1px solid ${i}`)),n&&t.classList.add("xterm-find-active-result-decoration")}_createResultDecoration(t,i){const n=this._terminal,s=n.registerMarker(-n.buffer.active.baseY-n.buffer.active.cursorY+t.row);if(!s)return;const o=n.registerDecoration({marker:s,x:t.col,width:t.size,backgroundColor:i.matchBackground,overviewRulerOptions:this._highlightedLines.has(s.line)?void 0:{color:i.matchOverviewRuler,position:"center"}});if(o){const m=[];m.push(s),m.push(o.onRender(r=>this._applyStyles(r,i.matchBorder,!1))),m.push(o.onDispose(()=>(0,_.disposeArray)(m)))}return o}}z.SearchAddon=W})(),d})())}}]);
}());