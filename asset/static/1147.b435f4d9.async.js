"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1147],{99922:function(N,U,e){var A=e(97857),D=e.n(A),M=e(15009),j=e.n(M),L=e(99289),K=e.n(L),B=e(5574),g=e.n(B),r=e(67294),Z=e(85265),F=e(42075),y=e(83622),i=e(49610),P=e(3616),d=e(93362),W=e(90581),x=e(5251),C=e(36146),p=e(85893),u=new C.Uo("components.appDetail.appDetailQuickConsole"),S=(0,r.forwardRef)(function(R,w){var o,T,a=(0,r.useRef)(),f=(0,r.useRef)(),I=(0,r.useState)(!1),E=g()(I,2),s=E[0],m=E[1],l=(0,r.useState)(),O=g()(l,2),_=O[0],c=O[1];return(0,r.useImperativeHandle)(w,function(){return{show:function(n){return K()(j()().mark(function h(){var v;return j()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:c(n),m(!0),(v=a.current)===null||v===void 0||v.resetFields();case 3:case"end":return b.stop()}},h)}))()}}}),(0,r.useEffect)(function(){return setTimeout(function(){var t;_&&((t=f.current)===null||t===void 0||t.start(_.url,{cmd:_&&_.cmd,workDir:_&&_.workDir}))},1e3),function(){var t;(t=f.current)===null||t===void 0||t.close()}},[_,s]),(0,p.jsxs)(Z.Z,{forceRender:!0,width:P.FK,open:s,onClose:function(){return[m(!1)]},title:u.format("drawerTitle",{name:_==null?void 0:_.title}),children:[(0,p.jsxs)(F.Z,{style:{marginBottom:20},children:[R.showFileExplorer&&(0,p.jsx)(d.Z,{trigger:(0,p.jsx)(y.ZP,{type:"primary",children:u.format("fileExplorerButton")}),type:"container",title:(0,x.fi)((o=_==null?void 0:_.title)!==null&&o!==void 0?o:"","/"),name:_&&_.url&&(T=_.url.split("/").pop())!==null&&T!==void 0?T:""}),(0,p.jsx)(W.Z,{onChangeShell:function(n){var h;if(!_)return!1;(h=f.current)===null||h===void 0||h.close(),c(D()(D()({},_),{cmd:n!=null?n:_==null?void 0:_.cmd}))},onOpenNewWindow:function(n){return _?(n.workDir=_&&_.workDir?_.workDir:"","".concat(_.url,"?").concat(Object.keys(n).map(function(h){return"".concat(h,"=").concat(encodeURIComponent(n[h]))}).join("&"))):""},onOpenNewWindowFinish:function(){var n;(n=f.current)===null||n===void 0||n.close(),m(!1)},onBatchCommandFinish:function(n){f.current&&f.current.run(n)}})]}),s&&(0,p.jsx)(i.Z,{height:"80vh",ref:f})]})});U.Z=S},93362:function(N,U,e){var A=e(97857),D=e.n(A),M=e(15009),j=e.n(M),L=e(99289),K=e.n(L),B=e(5574),g=e.n(B),r=e(67294),Z=e(57221),F=e(85265),y=e(3616),i=e(5251),P=e(36146),d=e(28031),W=e(24963),x=e(99922),C=e(85893),p=(0,r.forwardRef)(function(u,S){var R,w=(0,r.useState)(!1),o=g()(w,2),T=o[0],a=o[1],f=(0,r.useState)(),I=g()(f,2),E=I[0],s=I[1],m=(0,r.useRef)(),l=new P.Uo("components.appDetail.appDetailQuickFile"),O=(0,r.useContext)(W.Z),_=O.loading,c=(0,r.useRef)();return(0,r.useImperativeHandle)(S,function(){return{showContainer:function(n,h){s({name:(0,i.fi)(n,"/"),type:"container",workDir:h!=null?h:void 0}),a(!0)},showHost:function(n){s({name:n,type:"host"}),a(!0)},showVolume:function(n){return K()(j()().mark(function h(){var v;return j()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return _.show(),b.next=3,(0,d.Ak)("app",{name:n}).finally(function(){_.destroy()});case 3:v=b.sent,s({name:v.data.containerName,type:"container",workDir:v.data.path}),a(!0);case 6:case"end":return b.stop()}},h)}))()}}}),(0,C.jsxs)(C.Fragment,{children:[u.trigger?r.cloneElement(u.trigger,{onClick:function(){u.name&&u.type&&(s(u),a(!0))}}):null,(0,C.jsxs)(F.Z,{destroyOnHidden:!0,width:y.R_,title:l.format("drawerTitle",{name:(R=u.title)!==null&&R!==void 0?R:E==null?void 0:E.name}),onClose:K()(j()().mark(function t(){var n;return j()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(_.show(),a(!1),(n=m.current)===null||n===void 0||n.close(),s(void 0),!u.onCloseDestroy){v.next=7;break}return v.next=7,(0,d.nC)("app");case 7:_.destroy();case 8:case"end":return v.stop()}},t)})),open:T,children:[u.showConsole&&(0,C.jsx)(x.Z,{showFileExplorer:!1,ref:c}),T&&E&&(0,C.jsx)(Z.Z,D()(D()({ref:m},E),{},{onConsole:u.showConsole?function(t){var n;(n=c.current)===null||n===void 0||n.show({url:"/console/container/".concat(E.name),title:E.name,workDir:t})}:void 0}))]})]})});U.Z=p},90581:function(N,U,e){e.d(U,{Z:function(){return T}});var A=e(15009),D=e.n(A),M=e(99289),j=e.n(M),L=e(5574),K=e.n(L),B=e(3616),g=e(97269),r=e(38345),Z=e(64317),F=e(37476),y=e(62370),i=e(97462),P=e(11106),d=e(42075),W=e(83622),x=e(83062),C=e(67294),p=e(33160),u=e(58638),S=e(82346),R=e(75520),w=e(36146),o=e(85893);function T(a){var f=(0,C.useState)(!1),I=K()(f,2),E=I[0],s=I[1],m=(0,C.useRef)(),l=new w.Uo("components.console");return(0,o.jsx)(g.A,{layout:"inline",submitter:!1,children:(0,o.jsx)(r.Z,{ghost:!0,children:(0,o.jsxs)(d.Z,{children:[(0,o.jsx)(Z.Z,{width:"sm",name:"entryCmd",placeholder:l.format("toolbarEntryCmdEmpty"),valueEnum:{"/bin/sh":"/bin/sh","/bin/bash":"/bin/bash"},onChange:function(_){a.onChangeShell&&a.onChangeShell(_)}}),(0,o.jsx)(F.Y,{modalProps:{width:B.ob,height:B.Ed},title:l.format("toolbarBatchCommandTitle"),name:"batchCommand",open:E,trigger:(0,o.jsx)(W.ZP,{children:l.format("toolbarBatchCommandTitle")}),formKey:"batchCommand",formRef:m,isKeyPressSubmit:!0,onFinish:function(){var O=j()(D()().mark(function _(c){return D()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:a.onBatchCommandFinish&&a.onBatchCommandFinish(c.shell.split(`
`)),s(!1);case 2:case"end":return n.stop()}},_)}));return function(_){return O.apply(this,arguments)}}(),onOpenChange:function(_){s(_),_&&m.current&&m.current.resetFields()},children:(0,o.jsx)(y.Z,{name:"shell",children:(0,o.jsx)(P.ZP,{theme:"dark",height:B.Ed})})}),(0,o.jsx)(W.ZP,{onClick:function(){a.onChangeShell&&a.onChangeShell()},icon:(0,o.jsx)(p.Z,{}),type:"primary"}),(0,o.jsx)(i.Z,{name:["entryCmd"],children:function(_){var c=_.entryCmd;return(!c||c=="")&&(c="/bin/sh"),a.onOpenNewWindow&&(0,o.jsx)(S.Link,{onClick:function(){a.onOpenNewWindowFinish&&a.onOpenNewWindowFinish()},target:"_blank",to:a.onOpenNewWindow({cmd:c}),children:(0,o.jsx)(x.Z,{title:l.format("toolbarOpenInNewWindowTip"),children:(0,o.jsx)(W.ZP,{type:"dashed",icon:(0,o.jsx)(u.Z,{})})})})}}),(0,o.jsx)(R.Z,{buttonProps:{shape:"default",size:"middle"}})]})})})}},49610:function(N,U,e){var A=e(5574),D=e.n(A),M=e(67294),j=e(52626),L=e(78267),K=e.n(L),B=e(12323),g=e(87662),r=e(4244),Z=e.n(r),F=e(24078),y=e(85893),i,P,d,W,x=(0,M.forwardRef)(function(C,p){var u,S=(0,M.useState)(),R=D()(S,2),w=R[0],o=R[1],T=(0,M.useState)(""),a=D()(T,2),f=a[0],I=a[1];(0,M.useImperativeHandle)(p,function(){return{start:function(m,l){E(),P.fit(),l.width=i.cols,l.height=i.rows;var O=l?Object.keys(l).filter(function(_){return l&&l[_]}).map(function(_){if(l&&l[_])return"".concat(_,"=").concat(l[_])}):[];d=new WebSocket((0,j.R)(m+"?"+O.join("&"))),d.addEventListener("message",function(_){var c=JSON.parse(_.data),t=c.type;if(t==m&&(i.write(c.data),c.data.indexOf("exec failed")!=-1)){E();return}}),W=i.onData(function(_){var c={content:{command:_},type:m};d&&d.send(JSON.stringify(c))}),I(m),o(l)},close:function(){E()},fit:function(){return P.fit(),{width:i.cols,height:i.rows}},run:function(m){w&&m&&m.forEach(function(l){var O={content:{command:l+`
`},type:f};d&&d.send(JSON.stringify(O))})}}}),(0,M.useEffect)(function(){return i=new r.Terminal(B.X),P=new L.FitAddon,i.loadAddon(P),i.open(document.getElementById("terminal-container-console")),P.fit(),(0,g.pe)({groupName:"setting",name:"themeConsoleConfig"}).then(function(s){s.data&&s.data.fontSize&&Object.assign(i.options,s.data)}),function(){E()}},[]),(0,M.useEffect)(function(){window.addEventListener("resize",function(){P.fit();var s={size:{width:i.cols,height:i.rows},type:f};f&&d&&d.send(JSON.stringify(s))})},[f]);function E(){W&&(i.reset(),P.fit(),i.focus(),W.dispose()),d&&(d.close(),d=null)}return(0,y.jsx)("div",{style:{height:(u=C.height)!==null&&u!==void 0?u:"100vh"},id:"terminal-container-console"})});U.Z=x},12323:function(N,U,e){e.d(U,{X:function(){return A},n:function(){return D}});var A={convertEol:!0,fontFamily:'Menlo, Monaco, "Courier New", monospace',fontWeight:400,fontSize:16,lineHeight:1,cursorStyle:"block",cursorInactiveStyle:"outline",cursorBlink:!0,letterSpacing:0,theme:{foreground:"#bfbfbf",cursor:"gray",selectionForeground:"#ffffff"}},D=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"]}}]);
