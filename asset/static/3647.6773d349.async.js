!(function(){var Tt=Object.defineProperty,Pt=Object.defineProperties;var wt=Object.getOwnPropertyDescriptors;var dt=Object.getOwnPropertySymbols;var xt=Object.prototype.hasOwnProperty,jt=Object.prototype.propertyIsEnumerable;var ut=(ie,A,e)=>A in ie?Tt(ie,A,{enumerable:!0,configurable:!0,writable:!0,value:e}):ie[A]=e,ct=(ie,A)=>{for(var e in A||(A={}))xt.call(A,e)&&ut(ie,e,A[e]);if(dt)for(var e of dt(A))jt.call(A,e)&&ut(ie,e,A[e]);return ie},ht=(ie,A)=>Pt(ie,wt(A));(self.webpackChunk=self.webpackChunk||[]).push([[3647],{23430:function(ie,A,e){"use strict";e.d(A,{Z:function(){return V}});var Q=e(87462),d=e(67294),Y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"},f=Y,_=e(84089),D=function(i,n){return d.createElement(_.Z,(0,Q.Z)({},i,{ref:n,icon:f}))},L=d.forwardRef(D),V=L},1883:function(ie,A,e){"use strict";var Q=e(87462),d=e(67294),Y=e(3936),f=e(84089),_=function(V,t){return d.createElement(f.Z,(0,Q.Z)({},V,{ref:t,icon:Y.Z}))},D=d.forwardRef(_);A.Z=D},81146:function(ie,A,e){"use strict";var Q=e(97857),d=e.n(Q),Y=e(15009),f=e.n(Y),_=e(99289),D=e.n(_),L=e(67294),V=e(97269),t=e(62370),i=e(5966),n=e(97462),s=e(82346),o=e(71230),p=e(15746),r=e(34041),P=e(83622),E=e(84567),M=e(42075),C=e(80821),te=e(23430),q=e(93162),w=e.n(q),R=e(78267),S=e.n(R),v=e(75458),W=e.n(v),De=e(12323),We=e(4244),g=e.n(We),Je=e(24078),Me=e(36146),$=e(85893),re,Ee,Te,Ce={decorations:{matchBackground:"",matchBorder:"#FFFF00",activeMatchBackground:"#FFFF0066",matchOverviewRuler:"",activeMatchColorOverviewRuler:""}},ke=(0,L.forwardRef)(function(we,Ve){var x=(0,L.useRef)(),y=(0,s.useModel)("subscriber"),U=new Me.Uo("components.containerLog");(0,L.useImperativeHandle)(Ve,function(){return{fit:function(){re.clear(),Te.fit()},start:function(){return D()(f()().mark(function J(){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,u({lineTotal:500});case 2:case"end":return a.stop()}},J)}))()},close:function(){y.progress.close(we.id)}}});function u(X){return Xe.apply(this,arguments)}function Xe(){return Xe=D()(f()().mark(function X(J){return f()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:y.progress.close(we.id),re.clear(),J.download=!1,we.request(J);case 4:case"end":return a.stop()}},X)})),Xe.apply(this,arguments)}return(0,L.useEffect)(function(){return window.addEventListener("resize",function(){Te.fit()}),re=new We.Terminal(d()(d()({},De.X),{},{fontSize:12,lineHeight:1.2,allowProposedApi:!0})),Te=new R.FitAddon,Ee=new v.SearchAddon({}),re.loadAddon(Te),re.loadAddon(Ee),re.open(document.getElementById("terminal-container-log")),Te.fit(),y.addDataHandler(we.id,function(X){re.write(X.data)}),function(){re.clear(),re.reset(),y.progress.close(we.id)}},[]),(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(V.A,{submitter:!1,layout:"horizontal",onFinish:function(J){var O;u({id:we.id,lineTotal:parseInt(J.lineTotal),showTime:(O=J.showTime)!==null&&O!==void 0?O:!1})},formRef:x,children:(0,$.jsxs)(o.Z,{gutter:[10,0],children:[(0,$.jsx)(p.Z,{span:8,children:(0,$.jsx)(t.Z,{name:"lineTotal",initialValue:"500",label:U.format("formLineTotal"),children:(0,$.jsxs)(r.Z,{defaultValue:"500",onChange:function(J){var O;(O=x.current)===null||O===void 0||O.submit()},children:[(0,$.jsx)(r.Z.Option,{value:"100",children:U.format("formLineTotalOption",{number:"100"})}),(0,$.jsx)(r.Z.Option,{value:"200",children:U.format("formLineTotalOption",{number:"200"})}),(0,$.jsx)(r.Z.Option,{value:"500",children:U.format("formLineTotalOption",{number:"500"})}),(0,$.jsx)(r.Z.Option,{value:"1000",children:U.format("formLineTotalOption",{number:"1000"})}),(0,$.jsx)(r.Z.Option,{value:"-1",children:U.format("formLineTotalOptionAll")})]})})}),(0,$.jsx)(p.Z,{children:(0,$.jsx)(P.ZP,{onClick:function(){re.clear()},children:U.format("clearButton")})}),(0,$.jsx)(p.Z,{children:(0,$.jsx)(t.Z,{name:"showTime",valuePropName:"checked",children:(0,$.jsx)(E.Z,{onChange:function(J){var O;(O=x.current)===null||O===void 0||O.submit()},children:U.format("formShowTime")})})}),(0,$.jsx)(p.Z,{children:(0,$.jsx)(i.Z,{label:U.format("formKeywork"),name:"keywork",fieldProps:{onPressEnter:function(){var J;Ee.findNext((J=x.current)===null||J===void 0?void 0:J.getFieldValue("keywork"),Ce)},onChange:function(J){Ee.findNext(J.target.value,Ce)}},placeholder:U.format("formKeyworkEmpty")})}),(0,$.jsx)(p.Z,{children:(0,$.jsx)(n.Z,{name:["keywork"],children:function(J){var O=J.keywork;return(0,$.jsxs)(M.Z,{size:10,children:[(0,$.jsx)(P.ZP,{onClick:function(){Ee.findNext(O,Ce)},children:U.format("formKeyworkNext")},"next"),(0,$.jsx)(P.ZP,{onClick:function(){Ee.findPrevious(O,Ce)},children:U.format("formKeyworkPrev")},"prev")]})}})}),(0,$.jsx)(p.Z,{children:(0,$.jsx)(C.Z,{icon:(0,$.jsx)(te.Z,{}),action:D()(f()().mark(function X(){var J,O,a;return f()().wrap(function(Pe){for(;;)switch(Pe.prev=Pe.next){case 0:if(!we.download){Pe.next=5;break}return Pe.next=3,we.download({lineTotal:parseInt((J=x.current)===null||J===void 0?void 0:J.getFieldValue("lineTotal")),showTime:(O=x.current)===null||O===void 0?void 0:O.getFieldValue("showTime")});case 3:a=Pe.sent,(0,q.saveAs)(a.data,a.name);case 5:case"end":return Pe.stop()}},X)})),children:U.format("downloadButton")})})]})}),(0,$.jsx)("div",{style:{marginTop:"20px",height:we.showInDrawer?"75vh":"85vh"},id:"terminal-container-log"})]})});A.Z=ke},37413:function(ie,A,e){"use strict";e.d(A,{Z:function(){return p}});var Q=e(19632),d=e.n(Q),Y=e(36146),f=e(85577),_=e(58638),D=e(36693),L=e(35995),V=e(99611),t=e(38345),i=e(42075),n=e(66309),s=e(55241),o=e(85893);function p(r){var P,E=new Y.Uo("components.containerPort"),M=[];r.publicPort&&(M=d()(r.publicPort)),r.privatePort&&(M=[].concat(d()(M),d()(r.privatePort)));var C=(P=r.serverIp)!==null&&P!==void 0?P:"localhost";if(C!=""&&C.indexOf("http")===-1&&C.indexOf(":")>-1&&(C="[".concat(C,"]")),C==""||C=="127.0.0.1"){var te=document.location.protocol+"//"+document.location.hostname;C=te}var q=(0,o.jsxs)(t.Z,{direction:r.layout=="inline"?"row":"column",style:{width:r.layout!="inline"?600:"auto"},ghost:!0,children:[M.length>0&&(0,o.jsx)(t.Z,{title:(0,o.jsx)(f.Z,{}),subTitle:E.format("cardPortTitle"),ghost:r.ghost,bodyStyle:{maxHeight:300,overflow:"auto",margin:"10px 0"},children:M.map(function(w,R){var S;return C==""&&w.IP&&(C=w.IP),(0,o.jsx)(i.Z,{size:"large",wrap:!0,children:(0,o.jsx)(n.Z,{color:w.PublicPort?"#2db7f5":"warning",icon:w.PublicPort?(0,o.jsx)(_.Z,{}):"",style:{marginBottom:10,marginRight:15},children:w.PublicPort?(0,o.jsx)("a",{href:"".concat(C.indexOf("http")===0?C:"http://"+C,":").concat(w.PublicPort),target:"_blank",children:"".concat(w.PublicPort?((S=w.IP)!==null&&S!==void 0?S:"0.0.0.0")+":"+w.PublicPort+" -> ":"").concat(w.PrivatePort,"/").concat(w.Type)},"link".concat(R)):"".concat(w.PrivatePort,"/").concat(w.Type)})},"space".concat(R))})}),r.domain&&r.domain.length>0&&(0,o.jsx)(t.Z,{title:(0,o.jsx)(D.Z,{}),subTitle:E.format("cardDomainTitle"),ghost:r.ghost,children:(0,o.jsx)(i.Z,{wrap:!0,style:{textAlign:"left"},children:r.domain&&r.domain.map(function(w,R){return(0,o.jsx)(n.Z,{color:"blue",icon:(0,o.jsx)(_.Z,{}),children:(0,o.jsx)("a",{href:w,target:"_blank",children:w})},"domain".concat(R))})})})]});return r.showInDetail?q:(0,o.jsx)(s.Z,{placement:"right",content:q,children:(0,o.jsxs)(i.Z,{direction:"vertical",children:[r.privatePort&&r.privatePort.length>0&&(0,o.jsxs)(n.Z,{color:"warning",icon:(0,o.jsx)(L.Z,{}),children:[E.format("portPrivate"),": ",r.privatePort.length]}),r.publicPort&&r.publicPort.length>0&&(0,o.jsxs)(n.Z,{color:"#2db7f5",icon:(0,o.jsx)(V.Z,{}),children:[E.format("protPublic"),": ",r.publicPort.length]}),r.domain&&r.domain.length>0&&(0,o.jsx)(n.Z,{color:"blue",icon:(0,o.jsx)(D.Z,{}),children:r.domainTitle?r.domainTitle:"".concat(E.format("domain"),": ").concat(r.domain.length)})]})})}},94359:function(ie,A,e){"use strict";e.d(A,{Z:function(){return P}});var Q=e(5574),d=e.n(Q),Y=e(3089),f=e(98165),_=e(18429),D=e(8751),L=e(66212),V=e(14313),t=e(30159),i=e(87740),n=e(50888),s=e(66309),o=e(83062),p=e(36146),r=e(85893);function P(E){var M,C,te=new p.Uo("components.containerStatus"),q=E.status.split("."),w=d()(q,2),R=w[0],S=w[1],v="";v=te.format(E.status,(M=E.statusValue)!==null&&M!==void 0?M:{});var W=(0,r.jsx)(r.Fragment,{});return S=="0"&&(W=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(Y.Z,{}),color:"default",children:v})),S=="10"&&(W=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(f.Z,{spin:!0}),color:"processing",children:v})),S=="20"&&(W=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(_.Z,{}),color:"error",children:v})),S=="30"&&(W=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(D.Z,{}),color:"success",children:v})),S=="new"&&(W=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(L.Z,{}),children:v})),(S=="running"||S=="healthy"||S=="active"||S=="ready")&&(W=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(V.Z,{}),color:"success",children:v})),(S=="paused"||S=="pause"||S=="rollback_paused")&&(W=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(t.Z,{}),children:v})),(S=="waiting"||S=="starting"||S=="accepted")&&(W=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(i.Z,{}),children:v})),["deploying","pending","allocated","accepted","assigned","preparing","updating","rollback_started"].includes(S)&&(W=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(n.Z,{}),color:"processing",children:v})),(S=="error"||S=="down"||S=="failed")&&(W=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(_.Z,{}),color:"error",children:v})),["complete","completed","rollback_completed"].includes(S)&&(W=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(D.Z,{}),color:"success",children:v})),["exited","dead","removing","restarting","unhealthy","created","drain","unreachable","shutdown","rejected","remove","orphaned"].includes(S)&&(W=(0,r.jsx)(s.Z,{icon:(0,r.jsx)(_.Z,{}),color:"warning",children:v})),(0,r.jsx)(o.Z,{placement:"top",title:(C=E.tip)!==null&&C!==void 0?C:"",children:W})}},98093:function(ie,A,e){"use strict";e.d(A,{Z:function(){return J}});var Q=e(15009),d=e.n(Q),Y=e(99289),f=e.n(Y),_=e(5574),D=e.n(_),L=e(3616),V=e(184),t=e(62370),i=e(83622),n=e(67294),s=e(59252),o=e(24796),p=e(93529),r=e(91058),P=e(82034),E=e(10523),M=e(52255),C=e(38345),te=e(5966),q=e(24739),w=e(30291),R=e(92398),S=e(36146),v=e(42963),W=e(42075),De=e(64317),We=e(75870),g=e(85893);function Je(){var O=new S.Uo("components.appForm");return(0,g.jsxs)(W.Z.Compact,{children:[(0,g.jsx)(De.Z,{name:"imageRegistry",width:"sm",fieldProps:{popupMatchSelectWidth:!1},request:f()(d()().mark(function a(){var Ie;return d()().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return me.next=2,(0,We.Ot)();case 2:return Ie=me.sent,me.abrupt("return",Ie.data.list.map(function($e){return{label:"".concat($e.title,"@").concat($e.serverAddress),value:$e.id}}));case 4:case"end":return me.stop()}},a)})),label:O.format("dockerImageImageName")}),(0,g.jsx)(te.Z,{label:" ",name:"imageName",width:"lg"})]})}var Me=e(86615),$=e(97462),re=e(31199),Ee=e(86250),Te=e(44349),Ce=e(24494);function ke(){var O,a=new S.Uo("components.appForm"),Ie=(0,n.useContext)(v.Z),Pe=Ie.createFormRef,me=(0,n.useRef)();return(0,g.jsxs)(C.Z,{children:[(0,g.jsxs)(Ee.Z,{gap:60,children:[(0,g.jsx)(Me.Z.Group,{width:"md",label:a.format("createSchedulingLabel"),name:["scheduling","mode"],options:a.option("createSchedulingOption",["global","replicated"]),initialValue:"replicated",disabled:(O=Pe.current)===null||O===void 0?void 0:O.getFieldValue("id")}),(0,g.jsx)($.Z,{name:["scheduling"],children:function(He){var Fe=He.scheduling;return Fe.mode=="replicated"&&(0,g.jsx)(re.Z,{width:"md",label:a.format("createSchedulingReplicas"),name:["scheduling","replicas"],initialValue:1})}})]}),(0,g.jsx)($.Z,{name:["scheduling","constraint"],children:function(He){var Fe=He.scheduling,Be=He.constraint;return Fe.mode=="replicated"&&[(0,g.jsx)(Me.Z.Group,{label:a.format("createConstraintNode"),initialValue:"all",name:["constraint","role"],options:a.option("createConstraintNodeOption",["all","manager","worker","user"])},"role"),Be&&Be.role=="user"&&(0,g.jsx)(De.Z,{name:["constraint","node"],request:f()(d()().mark(function F(){var ce;return d()().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return ae.next=2,(0,Ce.HN)();case 2:return ce=ae.sent,ae.abrupt("return",ce.data.list&&ce.data.list.map(function(ge){var se;return{label:(se=ge.Description)===null||se===void 0?void 0:se.Hostname,value:ge.ID}}));case 4:case"end":return ae.stop()}},F)}))}),(0,g.jsx)(Te.Z,{name:["constraint","label"],label:a.format("createConstraintLabel"),hideCopyButton:!0,showAddButton:!0,gap:10,ref:me,items:[{label:a.format("createConstraintLabelOption.name"),name:"name",width:"md",placeholder:"node.labels.name"},{name:"operator",render:function(ce,ue,ae){return(0,g.jsx)(De.Z,{label:" ",name:"operator",valueEnum:{"==":"==","!=":"!="},initialValue:"=="})}},{label:a.format("createConstraintLabelOption.value"),name:"value",width:"md"}]},"label"),(0,g.jsx)(Te.Z,{name:"placement",label:a.format("createPlacementLabel"),hideCopyButton:!0,showAddButton:!0,gap:10,items:[{name:"name",render:function(ce,ue,ae){return(0,g.jsx)(De.Z,{label:" ",name:"type",options:a.option("createPlacementOption",["spread"]),initialValue:"spread",allowClear:!1,width:"sm"})}},{label:a.format("createConstraintLabelOption.value"),name:"value",width:"md",placeholder:"node.labels.hostname"}]},"placement")]}})]})}var we=e(73396),Ve=e(55730),x=e(33879);function y(){var O=new S.Uo("components.appForm");return(0,g.jsx)(C.Z,{children:(0,g.jsxs)(Ee.Z,{gap:30,children:[(0,g.jsx)(De.Z,{label:O.format("createAdvRestart"),name:["restart","name"],width:"sm",initialValue:"any",options:O.option("createAdvRestartOption",["none","on-failure","any"])}),(0,g.jsx)($.Z,{name:["restart"],children:function(Ie){var Pe=Ie.restart;return Pe=="on-failure"&&(0,g.jsx)(re.Z,{width:"sm",label:O.format("createAdvRestartMax"),name:["restart","maxAttempt"],initialValue:5})}}),(0,g.jsx)(re.Z,{width:"sm",label:O.format("createAdvRestartDelay"),tooltip:O.format("createAdvRestartDelayTip"),name:["restart","delay"],initialValue:5,fieldProps:{addonAfter:S.FD.format("unitSecond")}}),(0,g.jsx)(re.Z,{width:"sm",label:O.format("createAdvRestartWindow"),tooltip:O.format("createAdvRestartWindowTip"),name:["restart","window"],initialValue:0,fieldProps:{addonAfter:S.FD.format("unitSecond")}})]})})}function U(){var O=new S.Uo("components.appForm");return(0,g.jsxs)(C.Z,{children:[(0,g.jsxs)(Ee.Z,{gap:30,children:[(0,g.jsx)(re.Z,{label:O.format("createSwarmUpdateParallelism"),name:["scheduling","update","parallelism"],initialValue:1}),(0,g.jsx)(re.Z,{label:O.format("createSwarmUpdateDelay"),name:["scheduling","update","delay"],initialValue:0,fieldProps:{addonAfter:S.FD.format("unitSecond")}})]}),(0,g.jsx)(Me.Z.Group,{label:O.format("createSwarmUpdateFailureAction"),name:["scheduling","update","failureAction"],initialValue:"pause",options:O.option("createSwarmUpdateFailureActionOption",["pause","continue","rollback"])}),(0,g.jsx)(Me.Z.Group,{label:O.format("createSwarmUpdateOrder"),name:["scheduling","update","order"],initialValue:"stop-first",options:O.option("createSwarmUpdateOrderOption",["stop-first","start-first"])})]})}var u=e(64412),Xe=e(27323),X=(0,n.forwardRef)(function(O,a){(0,n.useImperativeHandle)(a,function(){return{edit:function(m){var c,I,H,k,Z,N,ve,ee,oe,Re,pe,h,xe,_e,Le,Ze,Ae,Oe,Ue,je,ye,b,T,j,z,G,ne,le,Se,Ke,be,et,nt,Qe,rt,at={id:m.ID,siteName:(c=(I=m.Spec)===null||I===void 0?void 0:I.Name)!==null&&c!==void 0?c:"",siteTitle:((H=m.Spec)===null||H===void 0?void 0:H.Labels)&&((k=m.Spec)===null||k===void 0?void 0:k.Labels[Ce.$m]),hostname:(Z=m.Spec)===null||Z===void 0||(Z=Z.TaskTemplate)===null||Z===void 0||(Z=Z.ContainerSpec)===null||Z===void 0?void 0:Z.Hostname,imageName:(N=(ve=m.Spec)===null||ve===void 0||(ve=ve.TaskTemplate)===null||ve===void 0||(ve=ve.ContainerSpec)===null||ve===void 0?void 0:ve.Image)!==null&&N!==void 0?N:"",environment:(ee=m.Spec)===null||ee===void 0||(ee=ee.TaskTemplate)===null||ee===void 0||(ee=ee.ContainerSpec)===null||ee===void 0||(ee=ee.Env)===null||ee===void 0?void 0:ee.map(function(l){var K=l.split("=");return{name:K[0],value:K.slice(1).join("=")}}),volumes:(oe=m.Spec)===null||oe===void 0||(oe=oe.TaskTemplate)===null||oe===void 0||(oe=oe.ContainerSpec)===null||oe===void 0||(oe=oe.Mounts)===null||oe===void 0?void 0:oe.map(function(l){var K,de;return{dest:(K=l.Target)!==null&&K!==void 0?K:"",host:(de=l.Source)!==null&&de!==void 0?de:"",type:l.Type,permission:l.ReadOnly?"readonly":"write"}}),restartPolicy:function(l,K){return{name:(K=l.Condition)!==null&&K!==void 0?K:"any",maxAttempt:l.MaxAttempts,window:l.Window,delay:l.Delay}}(((Re=m.Spec)===null||Re===void 0||(Re=Re.TaskTemplate)===null||Re===void 0?void 0:Re.RestartPolicy)||{}),cpus:function(l){return l?l/1e9:0}((pe=m.Spec)===null||pe===void 0||(pe=pe.TaskTemplate)===null||pe===void 0||(pe=pe.Resources)===null||pe===void 0||(pe=pe.Limits)===null||pe===void 0?void 0:pe.NanoCPUs),memory:function(l){return l?l/1024/1024:0}((h=m.Spec)===null||h===void 0||(h=h.TaskTemplate)===null||h===void 0||(h=h.Resources)===null||h===void 0||(h=h.Limits)===null||h===void 0?void 0:h.MemoryBytes),workDir:{useDefault:!((xe=m.Spec)!==null&&xe!==void 0&&(xe=xe.TaskTemplate)!==null&&xe!==void 0&&(xe=xe.ContainerSpec)!==null&&xe!==void 0&&xe.Dir),default:"",value:(_e=m.Spec)===null||_e===void 0||(_e=_e.TaskTemplate)===null||_e===void 0||(_e=_e.ContainerSpec)===null||_e===void 0?void 0:_e.Dir},user:{useDefault:!((Le=m.Spec)!==null&&Le!==void 0&&(Le=Le.TaskTemplate)!==null&&Le!==void 0&&(Le=Le.ContainerSpec)!==null&&Le!==void 0&&Le.User),default:"",value:(Ze=m.Spec)===null||Ze===void 0||(Ze=Ze.TaskTemplate)===null||Ze===void 0||(Ze=Ze.ContainerSpec)===null||Ze===void 0?void 0:Ze.User},command:{useDefault:!((Ae=m.Spec)!==null&&Ae!==void 0&&(Ae=Ae.TaskTemplate)!==null&&Ae!==void 0&&(Ae=Ae.ContainerSpec)!==null&&Ae!==void 0&&Ae.Command),default:"",value:(Oe=m.Spec)===null||Oe===void 0||(Oe=Oe.TaskTemplate)===null||Oe===void 0||(Oe=Oe.ContainerSpec)===null||Oe===void 0||(Oe=Oe.Command)===null||Oe===void 0?void 0:Oe.join(" ")},log:function(l,K){return{driver:(K=l==null?void 0:l.Name)!==null&&K!==void 0?K:"json-file",maxFile:(l==null?void 0:l.Options)&&l.Options["max-file"],maxSize:(l==null?void 0:l.Options)&&l.Options["max-size"]}}((Ue=m.Spec)===null||Ue===void 0||(Ue=Ue.TaskTemplate)===null||Ue===void 0?void 0:Ue.LogDriver),dns:(je=m.Spec)===null||je===void 0||(je=je.TaskTemplate)===null||je===void 0||(je=je.ContainerSpec)===null||je===void 0||(je=je.DNSConfig)===null||je===void 0?void 0:je.Nameservers,label:((ye=m.Spec)===null||ye===void 0||(ye=ye.TaskTemplate)===null||ye===void 0||(ye=ye.ContainerSpec)===null||ye===void 0?void 0:ye.Labels)&&Object.entries((b=m.Spec)===null||b===void 0||(b=b.TaskTemplate)===null||b===void 0||(b=b.ContainerSpec)===null||b===void 0?void 0:b.Labels).map(function(l){return{name:l[0],value:l[1]}}),extraHosts:((T=m.Spec)===null||T===void 0||(T=T.TaskTemplate)===null||T===void 0||(T=T.ContainerSpec)===null||T===void 0?void 0:T.Hosts)&&((j=m.Spec)===null||j===void 0||(j=j.TaskTemplate)===null||j===void 0||(j=j.ContainerSpec)===null||j===void 0?void 0:j.Hosts.map(function(l){var K=l.split(":"),de=D()(K,2),Ge=de[0],Ne=de[1];return{name:Ge,value:Ne}})),capAdd:(z=m.Spec)===null||z===void 0||(z=z.TaskTemplate)===null||z===void 0||(z=z.ContainerSpec)===null||z===void 0?void 0:z.CapabilityAdd,scheduling:function(l){return{mode:l!=null&&l.Global?"global":"replicated",replicas:l!=null&&l.Replicated?l.Replicated.Replicas:1}}((G=m.Spec)===null||G===void 0?void 0:G.Mode),constraint:function(l,K,de,Ge){var Ne="all";l!=null&&(K=l.Constraints)!==null&&K!==void 0&&K.includes("node.role==worker")&&(Ne="worker"),l!=null&&(de=l.Constraints)!==null&&de!==void 0&&de.includes("node.role==manager")&&(Ne="manager"),l==null||(Ge=l.Constraints)===null||Ge===void 0||Ge.forEach(function(Ye){Ye.includes("node.id==")&&(Ne="user")});var qe="",tt=[];return l!=null&&l.Constraints&&l.Constraints.forEach(function(Ye){if(Ye.includes("node.id==")){var vt=Ye.split("node.id=="),st=D()(vt,2),Et=st[0],mt=st[1];qe=mt;return}if(Ye.includes("==")){var ft=Ye.split("=="),ot=D()(ft,2),pt=ot[0],gt=ot[1];tt.push({name:pt,value:gt,operator:"=="});return}if(Ye.includes("!=")){var _t=Ye.split("!="),lt=D()(_t,2),St=lt[0],Dt=lt[1];tt.push({name:St,value:Dt,operator:"!="});return}}),{role:Ne,node:qe,label:tt}}((ne=m.Spec)===null||ne===void 0||(ne=ne.TaskTemplate)===null||ne===void 0?void 0:ne.Placement),placement:((le=m.Spec)===null||le===void 0||(le=le.TaskTemplate)===null||le===void 0||(le=le.Placement)===null||le===void 0?void 0:le.Preferences)&&Object.entries((Se=m.Spec)===null||Se===void 0||(Se=Se.TaskTemplate)===null||Se===void 0||(Se=Se.Placement)===null||Se===void 0?void 0:Se.Preferences).map(function(l){var K,de;return{name:"spread",value:(K=(de=l[1].Spread)===null||de===void 0?void 0:de.SpreadDescriptor)!==null&&K!==void 0?K:""}}),update:function(l,K,de){return{parallelism:(K=l==null?void 0:l.Parallelism)!==null&&K!==void 0?K:1,delay:(de=l==null?void 0:l.Delay)!==null&&de!==void 0?de:0,failureAction:l==null?void 0:l.FailureAction,order:l==null?void 0:l.Order}}((Ke=m.Spec)===null||Ke===void 0?void 0:Ke.UpdateConfig),healthcheck:function(l,K,de,Ge,Ne,qe){var tt=l!=null&&(K=l.Test)!==null&&K!==void 0&&K.includes("CMD-SHELL")?"CMD-SHELL":"CMD";return{interval:(de=l==null?void 0:l.Interval)!==null&&de!==void 0?de:30,timeout:(Ge=l==null?void 0:l.Timeout)!==null&&Ge!==void 0?Ge:10,retries:(Ne=l==null?void 0:l.Retries)!==null&&Ne!==void 0?Ne:3,cmd:l!=null&&l.Test?l==null||(qe=l.Test)===null||qe===void 0?void 0:qe.join(" "):"",shellType:tt}}((be=m.Spec)===null||be===void 0||(be=be.TaskTemplate)===null||be===void 0||(be=be.ContainerSpec)===null||be===void 0?void 0:be.Healthcheck)},it=((et=m.Spec)===null||et===void 0?void 0:et.Labels)&&((nt=m.Spec)===null||nt===void 0?void 0:nt.Labels[Ce.ev]);if(it&&(at.imageRegistry=parseInt(it)),(Qe=m.Spec)!==null&&Qe!==void 0&&(Qe=Qe.EndpointSpec)!==null&&Qe!==void 0&&Qe.Ports){var ze;at.ports=(ze=m.Spec)===null||ze===void 0||(ze=ze.EndpointSpec)===null||ze===void 0||(ze=ze.Ports)===null||ze===void 0?void 0:ze.map(function(l){var K;return{dest:String(l.TargetPort),host:String((K=l.PublishedPort)!==null&&K!==void 0?K:""),mode:l.PublishMode}})}(rt=Be.current)===null||rt===void 0||rt.setFieldsValue(at),he(!0)}}});var Ie=(0,n.useState)("basic"),Pe=D()(Ie,2),me=Pe[0],$e=Pe[1],He=new S.Uo("components.appForm"),Fe=new S.Uo("swarm"),Be=(0,n.useRef)(),F=(0,n.useRef)(),ce=(0,n.useRef)(),ue=(0,n.useRef)(),ae=(0,n.useRef)(),ge=(0,n.useState)(!1),se=D()(ge,2),fe=se[0],he=se[1];return(0,g.jsx)(v.Z.Provider,{value:{createFormRef:Be,volumeListRef:F,createEnvRef:ae,createLinkRef:ue,domainRef:ce},children:(0,g.jsx)(V.a,{drawerProps:{width:L.R_,forceRender:O.forceRender},formRef:Be,title:Fe.format("serviceCreateTitle.".concat(O.forceRender?"edit":"create")),onOpenChange:function(m){if(he(m),!m){var c,I;!((c=Be.current)===null||c===void 0)&&c.resetFields&&((I=Be.current)===null||I===void 0||I.resetFields()),$e("basic")}},open:fe,trigger:O.showTrigger?(0,g.jsx)(i.ZP,{type:"primary",children:Fe.format("serviceCreateTitle.create")}):void 0,onFinish:function(){var B=f()(d()().mark(function m(c){var I;return d()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return I={id:c.id,siteTitle:c.siteTitle,siteName:c.siteName,hostname:c.hostname,imageRegistry:c.imageRegistry,imageName:c.imageName,ports:c.ports,environment:c.environment,volumes:c.volumes,restartPolicy:c.restart,cpus:c.cpus,memory:c.memory,workDir:c.workDir&&!c.workDir.useDefault?c.workDir.value:"",user:c.user&&!c.user.useDefault?c.user.value:"",command:c.command&&!c.command.useDefault?c.command.value:"",entrypoint:c.entrypoint&&!c.entrypoint.useDefault?c.entrypoint.value:"",log:c.log,dns:c.dns,label:c.label,extraHosts:c.extraHosts,capAdd:c.capAdd,scheduling:c.scheduling,constraint:c.constraint,placement:c.placement,update:c.update},c.healthcheck&&c.healthcheck.cmd&&c.healthcheck.cmd!=""&&(I.healthcheck=c.healthcheck),k.next=4,(0,Ce.P3)(I);case 4:return O.onFinish&&O.onFinish(),k.abrupt("return",!0);case 6:case"end":return k.stop()}},m)}));return function(m){return B.apply(this,arguments)}}(),children:(0,g.jsxs)(C.Z,{direction:"column",gutter:[0,10],ghost:!0,children:[(0,g.jsxs)(C.Z,{children:[(0,g.jsx)(t.Z,{name:"id",hidden:!0}),(0,g.jsx)(te.Z,{name:"siteTitle",label:S.FD.format("listDescription"),placeholder:Fe.format("serviceCreateListDescriptionEmpty")}),(0,g.jsxs)(q.UW,{children:[(0,g.jsx)(te.Z,{width:"lg",name:"siteName",label:S.FD.format("listName"),required:!0,rules:[{required:!0}],placeholder:Fe.format("serviceCreateListNameEmpty")}),(0,g.jsx)(te.Z,{label:"Hostname",name:"hostname",width:"md"})]}),(0,g.jsx)(Je,{})]}),(0,g.jsx)(w.Z,{offsetTop:50,children:(0,g.jsx)(C.Z,{style:{marginBottom:-20},children:(0,g.jsx)(R.Z,{activeKey:me,onChange:function(m){$e(m),window.scrollTo(0,450)},items:He.option("createTabOption",["basic","scheduling","run-command","cap","other"]).map(function(B){return{label:B.label,key:B.value}})})})}),(0,g.jsxs)(M.Z,{show:me=="basic",children:[(0,g.jsx)(P.Z,{showIngress:!0}),(0,g.jsx)(r.Z,{showAddButton:!0,showImportButton:!0,showCodeMode:!0,label:He.format("createEnvTitle"),ref:ae}),(0,g.jsx)(E.Z,{showDefault:!0,ref:F,showType:!0}),(0,g.jsx)(s.Z,{})]}),(0,g.jsxs)(M.Z,{show:me=="scheduling",children:[(0,g.jsx)(ke,{}),(0,g.jsx)(U,{})]}),(0,g.jsxs)(M.Z,{show:me=="run-command",children:[(0,g.jsx)(y,{}),(0,g.jsx)(x.Z,{showCommand:!0,showUser:!0,showWorkDir:!0}),(0,g.jsx)(we.Z,{}),(0,g.jsx)(Ve.Z,{}),(0,g.jsx)(u.Z,{}),(0,g.jsx)(Xe.Z,{})]}),(0,g.jsx)(M.Z,{show:me=="other",children:(0,g.jsx)(o.Z,{})}),(0,g.jsx)(M.Z,{show:me=="cap",children:(0,g.jsx)(p.Z,{})})]})})})}),J=X},94617:function(ie,A,e){"use strict";e.d(A,{Z:function(){return Be}});var Q=e(15009),d=e.n(Q),Y=e(99289),f=e.n(Y),_=e(97857),D=e.n(_),L=e(5574),V=e.n(L),t=e(24494),i=e(5251),n=e(36146),s=e(86548),o=e(1883),p=e(74763),r=e(56729),P=e(42075),E=e(66309),M=e(25593),C=e(96074),te=e(83062),q=e(60940),w=e(37413),R=e(94359),S=e(67294),v=e(87662),W=e(78451),De=e(3616),We=e(33160),g=e(43425),Je=e(57132),Me=e(71965),$=e(48689),re=e(45605),Ee=e(60433),Te=e(38345),Ce=e(97269),ke=e(24739),we=e(31199),Ve=e(62370),x=e(64317),y=e(85265),U=e(86250),u=e(83622),Xe=e(84567),X=e(26412),J=e(80821),O=e(76428),a=e(85893);function Ie(F){var ce,ue,ae=new n.Uo("swarm"),ge=F.detail;if((ce=ge.Spec)!==null&&ce!==void 0&&(ce=ce.Mode)!==null&&ce!==void 0&&ce.Replicated){var se;return(0,a.jsxs)(P.Z,{children:[(0,a.jsx)(E.Z,{children:ae.format("listServiceMode.replicated")}),(0,a.jsx)(E.Z,{color:"success",bordered:!1,children:(se=ge.ServiceStatus)===null||se===void 0?void 0:se.RunningTasks}),(0,a.jsx)(E.Z,{color:"gold",bordered:!1,children:ge.Spec.Mode.Replicated.Replicas})]})}else if((ue=ge.Spec)!==null&&ue!==void 0&&(ue=ue.Mode)!==null&&ue!==void 0&&ue.Global)return(0,a.jsx)(E.Z,{children:ae.format("listServiceMode.global")})}var Pe=e(81146);function me(F){var ce=(0,S.useState)(!1),ue=V()(ce,2),ae=ue[0],ge=ue[1],se=(0,S.useRef)();return(0,a.jsxs)(a.Fragment,{children:[F.trigger?S.cloneElement(F.trigger,{onClick:function(){ge(!0)}}):null,(0,a.jsx)(y.Z,{title:"".concat(n.FD.format("listLog")," - ").concat(F.detail.name),open:ae,forceRender:!0,onClose:function(){ge(!1)},afterOpenChange:function(he){if(he)setTimeout(function(){var m,c;(m=se.current)===null||m===void 0||m.start(),(c=se.current)===null||c===void 0||c.fit()},1e3);else{var B;(B=se.current)===null||B===void 0||B.close()}},width:De.FK,children:ae&&(0,a.jsx)(Pe.Z,{ref:se,showInDrawer:!0,id:"swarm:log:".concat(F.type,":").concat(F.detail.id),request:function(){var fe=f()(d()().mark(function he(B){var m;return d()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,(0,t.m8)({id:F.detail.id,type:F.type,lineTotal:B.lineTotal,download:(m=B.download)!==null&&m!==void 0?m:!1,showTime:B.showTime});case 2:case"end":return I.stop()}},he)}));return function(he){return fe.apply(this,arguments)}}(),download:function(){var fe=f()(d()().mark(function he(B){var m;return d()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,(0,t.Id)({id:F.detail.id,type:F.type,lineTotal:B.lineTotal,showTime:B.showTime,download:!0});case 2:return m=I.sent,I.abrupt("return",{data:new Blob([m],{type:"text/plain"}),name:F.detail.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return I.stop()}},he)}));return function(he){return fe.apply(this,arguments)}}()})})]})}var $e=e(98093),He=(0,S.forwardRef)(function(F,ce){var ue,ae,ge,se,fe,he,B,m,c,I,H,k,Z;(0,S.useImperativeHandle)(ce,function(){return{show:function(T){xe(T),oe(!0)}}});var N=(0,S.useState)(!1),ve=V()(N,2),ee=ve[0],oe=ve[1],Re=(0,S.useState)(),pe=V()(Re,2),h=pe[0],xe=pe[1],_e=new n.Uo("swarm"),Le=(0,S.useState)(""),Ze=V()(Le,2),Ae=Ze[0],Oe=Ze[1],Ue=(0,S.useRef)(),je=(0,S.useRef)(),ye=(0,S.useRef)();return(0,S.useEffect)(function(){(0,v.K3)().then(function(b){var T;Oe((T=b.data.serverUrl)!==null&&T!==void 0?T:"")})},[]),(0,a.jsxs)(y.Z,{title:_e.format("serviceDetailTitle",{name:h==null||(ue=h.Spec)===null||ue===void 0?void 0:ue.Name}),open:ee,forceRender:!0,width:De.R_,onClose:function(){oe(!1),xe(void 0),F.onFinish&&F.onFinish()},extra:[h&&(0,a.jsx)(J.Z,{type:"link",tips:n.FD.format("listManageRefresh"),action:f()(d()().mark(function b(){var T,j;return d()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,(0,t.ig)({id:h.ID});case 2:j=G.sent,xe(j.data.info),!((T=ye.current)===null||T===void 0)&&T.reloadAndRest&&ye.current.reloadAndRest();case 5:case"end":return G.stop()}},b)})),icon:(0,a.jsx)(We.Z,{})},"refresh")],children:[(0,a.jsx)($e.Z,{forceRender:!0,ref:je,onFinish:f()(d()().mark(function b(){var T,j;return d()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,(0,t.ig)({id:(T=h==null?void 0:h.ID)!==null&&T!==void 0?T:""});case 2:j=G.sent,xe(j.data.info);case 4:case"end":return G.stop()}},b)}))}),(0,a.jsxs)(U.Z,{vertical:!0,gap:20,children:[(0,a.jsx)(Te.Z,{title:(0,a.jsx)(g.Z,{}),ghost:!0,subTitle:n.FD.format("listManage"),children:(0,a.jsxs)(P.Z,{wrap:!0,children:[h&&(0,a.jsx)(u.ZP,{type:"primary",icon:(0,a.jsx)(s.Z,{}),onClick:function(){var T;(T=je.current)===null||T===void 0||T.edit(h)},children:n.FD.format("listManageEdit")}),(0,a.jsx)(C.Z,{type:"vertical"}),h&&(0,a.jsx)(me,{type:"service",detail:{id:(ae=h.ID)!==null&&ae!==void 0?ae:"",name:(ge=(se=h.Spec)===null||se===void 0?void 0:se.Name)!==null&&ge!==void 0?ge:""},trigger:(0,a.jsx)(u.ZP,{icon:(0,a.jsx)(o.Z,{}),children:n.FD.format("listManageLog")},"log")}),(h==null||(fe=h.Spec)===null||fe===void 0||(fe=fe.Mode)===null||fe===void 0?void 0:fe.Replicated)&&(0,a.jsx)(J.Z,{confirmProps:{forceRender:!0},action:f()(d()().mark(function b(){var T,j,z;return d()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return ne.abrupt("return",(0,t.x$)({name:(T=h==null?void 0:h.ID)!==null&&T!==void 0?T:"",replicas:(j=Ue.current)===null||j===void 0?void 0:j.getFieldValue("replicas"),force:(z=Ue.current)===null||z===void 0?void 0:z.getFieldValue("force")}));case 1:case"end":return ne.stop()}},b)})),confirmOnOpenChange:function(){var T,j;(T=Ue.current)===null||T===void 0||T.setFieldsValue({replicas:(j=h.Spec)===null||j===void 0||(j=j.Mode)===null||j===void 0||(j=j.Replicated)===null||j===void 0?void 0:j.Replicas,force:!1})},confirm:(0,a.jsx)(Ce.A,{layout:"inline",submitter:!1,formRef:Ue,children:(0,a.jsxs)(P.Z,{direction:"vertical",size:[0,15],style:{width:600},children:[(0,a.jsx)(M.Z.Text,{children:_e.format("serviceManageScalingTip")}),(0,a.jsxs)(ke.UW,{children:[(0,a.jsx)(we.Z,{label:_e.format("serviceManageScalingReplicas"),width:"sm",name:"replicas"}),(0,a.jsx)(Ve.Z,{name:"force",valuePropName:"checked",children:(0,a.jsxs)(Xe.Z,{children:[n.FD.format("listManageDeployForce"),"\uFF1F"]})})]})]})}),onSuccess:function(){(0,t.ig)({id:h.ID}).then(function(T){xe(T.data.info)})},icon:(0,a.jsx)(Je.Z,{}),children:n.FD.format("listManageScaling")}),h&&(0,a.jsx)(J.Z,{action:function(){return(0,t.x$)({name:h.ID,rollback:!0})},icon:(0,a.jsx)(Me.Z,{}),confirm:"notification.confirm.title",children:n.FD.format("listManageRollback")}),(0,a.jsx)(J.Z,{showDivider:!0,action:function(){var T;return(0,t.tm)({name:[(T=h==null?void 0:h.ID)!==null&&T!==void 0?T:""]})},type:"primary",danger:!0,onSuccess:function(T){oe(!1),F.onFinish&&F.onFinish()},confirm:"notification.confirm.title",icon:(0,a.jsx)($.Z,{}),children:n.FD.format("listManageDelete")})]})}),h&&(0,a.jsx)(w.Z,{publicPort:((he=h.Endpoint)===null||he===void 0?void 0:he.Ports)&&((B=h.Endpoint)===null||B===void 0?void 0:B.Ports.map(function(b){var T,j,z;return{PrivatePort:(T=b.TargetPort)!==null&&T!==void 0?T:0,Type:(j=b.Protocol)!==null&&j!==void 0?j:"tcp",IP:"",PublicPort:(z=b.PublishedPort)!==null&&z!==void 0?z:0}})),serverIp:Ae,showInDetail:!0,ghost:!0,layout:"inline"}),(0,a.jsx)(Te.Z,{title:(0,a.jsx)(re.Z,{}),subTitle:n.FD.format("listManageDetail"),ghost:!0,children:(0,a.jsxs)(X.Z,{column:1,bordered:!0,styles:{label:{width:150}},children:[(0,a.jsxs)(X.Z.Item,{label:n.FD.format("listTitle"),children:[(0,a.jsx)(O.Z,{title:h==null?void 0:h.ID})," - ",h==null||(m=h.Spec)===null||m===void 0?void 0:m.Name,h&&((c=h.UpdateStatus)===null||c===void 0?void 0:c.State)&&(0,a.jsxs)(a.Fragment,{children:[" - ",(0,a.jsx)(R.Z,{status:"service.".concat((I=h.UpdateStatus)===null||I===void 0?void 0:I.State)})]})]}),(0,a.jsx)(X.Z.Item,{label:n.FD.format("listDescription"),children:(h==null||(H=h.Spec)===null||H===void 0?void 0:H.Labels)&&h.Spec.Labels[t.$m]}),(0,a.jsx)(X.Z.Item,{label:n.FD.format("listRunTask"),children:(0,a.jsx)(P.Z,{children:(h==null?void 0:h.ServiceStatus)&&Object.keys(h.ServiceStatus).map(function(b){var T=b;return(h==null?void 0:h.ServiceStatus)&&(0,a.jsx)(te.Z,{title:_e.format("listServiceStatusTip.".concat(T)),children:(0,a.jsxs)(E.Z,{color:_e.format("listServiceStatusColor.".concat(T)),bordered:!1,children:[_e.format("listServiceStatus.".concat(T))," ",h==null?void 0:h.ServiceStatus[T]]})},T)})})}),(0,a.jsx)(X.Z.Item,{label:n.FD.format("listServiceMode"),children:h&&(0,a.jsx)(Ie,{detail:h})}),(0,a.jsx)(X.Z.Item,{label:n.FD.format("listImageName"),children:h==null||(k=h.Spec)===null||k===void 0||(k=k.TaskTemplate)===null||k===void 0||(k=k.ContainerSpec)===null||k===void 0?void 0:k.Image}),(0,a.jsx)(X.Z.Item,{label:n.FD.format("listVersion"),children:h==null||(Z=h.Version)===null||Z===void 0?void 0:Z.Index}),(0,a.jsx)(X.Z.Item,{label:n.FD.format("listCreatedAt"),children:(0,i.NF)(h==null?void 0:h.CreatedAt)}),(0,a.jsx)(X.Z.Item,{label:n.FD.format("listUpdatedAt"),children:(0,i.NF)(h==null?void 0:h.UpdatedAt)})]})}),h&&(0,a.jsx)(Te.Z,{title:(0,a.jsx)(Ee.Z,{}),subTitle:_e.format("listTaskTitle"),ghost:!0,children:(0,a.jsx)(r.Z,{scroll:{x:"max-content"},rowKey:"ID",search:{filterType:"light"},actionRef:ye,columns:[{search:!1,title:n.FD.format("listName"),render:function(T,j,z,G,ne){return j.ID}},{search:!1,width:200,title:n.FD.format("listNodeName"),render:function(T,j,z,G,ne){return j.NodeID}},{search:!1,width:50,title:n.FD.format("listSlot"),render:function(T,j,z,G,ne){return j.Slot}},{key:"status",renderFormItem:function(T,j,z,G){return(0,a.jsx)(x.Z,{name:"status",valueEnum:Object.fromEntries(_e.option("listTaskStatusOption",["running","shutdown","accepted"]).map(function(ne){return[ne.value,ne.label]}))})},width:120,title:n.FD.format("listRunStatus"),render:function(T,j,z){var G;if(j.Status.State!="running"){var ne;return(0,a.jsx)(R.Z,{status:"task.".concat(j.Status.State),tip:(ne=j.Status.Err)!==null&&ne!==void 0?ne:j.Status.Message})}return(0,a.jsx)(R.Z,{status:"task.".concat(j.DesiredState),tip:(G=j.Status.Err)!==null&&G!==void 0?G:j.Status.Message})}},{search:!1,width:180,title:n.FD.format("listUpdatedAt"),render:function(T,j,z,G,ne){return(0,i.NF)(j.UpdatedAt)}},{search:!1,width:100,title:n.FD.format("listManage"),fixed:"right",render:function(T,j,z,G,ne){var le,Se;return(0,a.jsx)(P.Z,{children:(0,a.jsx)(me,{type:"node",detail:{id:(le=j.ID)!==null&&le!==void 0?le:"",name:(Se=j.ID)!==null&&Se!==void 0?Se:""},trigger:(0,a.jsx)(M.Z.Link,{children:(0,a.jsx)(o.Z,{})})})})}}],request:function(){var b=f()(d()().mark(function T(j){var z,G;return d()().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:return le.next=2,(0,t.XX)({serviceName:h==null?void 0:h.ID,status:j.status});case 2:return z=le.sent,le.next=5,(0,t.HN)();case 5:return G=le.sent,le.abrupt("return",{data:z.data.list.map(function(Se){var Ke,be=G&&((Ke=G.data.list.find(function(et){return et.ID==Se.NodeID}))===null||Ke===void 0||(Ke=Ke.Description)===null||Ke===void 0?void 0:Ke.Hostname);return be&&(Se.NodeID=be),Se}),success:!0,total:z.data.list.length});case 7:case"end":return le.stop()}},T)}));return function(T){return b.apply(this,arguments)}}()})})]})]})}),Fe=He;function Be(F){var ce=(0,S.useState)(""),ue=V()(ce,2),ae=ue[0],ge=ue[1],se=(0,S.useRef)(),fe=(0,S.useRef)();(0,S.useEffect)(function(){(0,v.K3)().then(function(B){var m;ge((m=B.data.serverUrl)!==null&&m!==void 0?m:"")})},[]);var he={};return F.showManage||(he=D()(D()({},he),{})),(0,p.k)(F.showSearch)&&(he=D()(D()({},he),{search:!1})),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Fe,{ref:se,onFinish:function(){var m;!((m=fe.current)===null||m===void 0)&&m.reloadAndRest&&fe.current.reloadAndRest()}}),(0,a.jsx)(r.Z,D()(D()({},he),{},{ghost:!0,actionRef:fe,scroll:{x:"max-content"},rowKey:"ID",columns:[{key:"serviceName",title:n.FD.format("listServiceName"),render:function(m,c,I,H,k){var Z,N=0;return c.Task&&c.Task.forEach(function(ve){ve.Status.State=="running"&&(N+=1)}),(0,a.jsxs)(P.Z,{children:[c.Task&&(0,a.jsx)(E.Z,{color:"success",bordered:!1,children:N}),(0,a.jsx)(M.Z.Link,{onClick:function(){var ee;(ee=se.current)===null||ee===void 0||ee.show(c)},children:(Z=c.Spec)===null||Z===void 0?void 0:Z.Name})]})}},{width:150,search:!1,title:n.FD.format("listPort"),render:function(m,c,I,H,k){var Z,N,ve=[];return!((Z=c.Endpoint)===null||Z===void 0)&&Z.Ports&&((N=c.Endpoint)===null||N===void 0||N.Ports.map(function(ee){var oe,Re,pe;ve.push({PrivatePort:(oe=ee.TargetPort)!==null&&oe!==void 0?oe:0,Type:(Re=ee.Protocol)!==null&&Re!==void 0?Re:"tcp",IP:"0.0.0.0",PublicPort:(pe=ee.PublishedPort)!==null&&pe!==void 0?pe:0})})),(0,a.jsx)(w.Z,{ghost:!0,publicPort:ve,serverIp:ae})}},{width:150,search:!1,title:n.FD.format("listServiceMode"),render:function(m,c,I,H,k){return(0,a.jsx)(Ie,{detail:c})}},{hidden:!F.showImageName,width:400,search:!1,title:n.FD.format("listImageName"),render:function(m,c,I,H,k){var Z,N=((Z=c.Spec)===null||Z===void 0||(Z=Z.TaskTemplate)===null||Z===void 0||(Z=Z.ContainerSpec)===null||Z===void 0?void 0:Z.Image)||"",ve=N.includes("@")?N.split("@"):[N,null],ee=V()(ve,2),oe=ee[0],Re=ee[1];return(0,a.jsx)(W.Z,{children:oe})}},{search:!1,width:180,title:n.FD.format("listCreatedAt"),render:function(m,c,I,H,k){return(0,i.NF)(c.CreatedAt)}},{search:!1,width:180,title:n.FD.format("listUpdatedAt"),render:function(m,c,I,H,k){return(0,i.NF)(c.UpdatedAt)}},{hidden:!F.showManage,search:!1,title:n.FD.format("listManage"),width:100,fixed:"right",render:function(m,c,I,H,k){return(0,a.jsx)(P.Z,{split:(0,a.jsx)(C.Z,{type:"vertical"}),children:F.showManage&&F.showManage.onEdit&&(0,a.jsx)(M.Z.Link,{onClick:function(){var N;!((N=F.showManage)===null||N===void 0)&&N.onEdit&&F.showManage.onEdit(c)},children:(0,a.jsx)(te.Z,{title:n.FD.format("listManageEdit"),children:(0,a.jsx)(s.Z,{})})},"edit")})}}],request:function(){var B=f()(d()().mark(function m(c){var I,H,k;return d()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(!F.showWithNodeId){N.next=7;break}return N.next=3,(0,t.rN)({nodeId:(I=F.showWithNodeId)!==null&&I!==void 0?I:""});case 3:return H=N.sent,N.abrupt("return",{data:H.data.list,total:H.data.list.length,success:!0});case 7:return N.next=9,(0,t.kM)({name:c.serviceName});case 9:return k=N.sent,N.abrupt("return",{data:k.data.list,total:k.data.list.length,success:!0});case 11:case"end":return N.stop()}},m)}));return function(m){return B.apply(this,arguments)}}(),expandable:F.showWithNodeId?{expandRowByClick:!0,rowExpandable:function(m){return m.Task&&m.Task.length>0&&m.Task.filter(function(c){return c.Status.State=="running"}).length>0},expandedRowRender:function(m){return(0,a.jsx)(q.Z,{rowKey:"ID",columns:[{title:n.FD.format("listName"),render:function(I,H,k){return H.ID}},{width:120,title:n.FD.format("listRunStatus"),render:function(I,H,k){var Z;return(0,a.jsx)(R.Z,{status:"task.".concat(H.Status.State),tip:(Z=H.Status.Err)!==null&&Z!==void 0?Z:H.Status.Message})}},{title:n.FD.format("listUpdatedAt"),width:180,render:function(I,H,k){return(0,i.NF)(H.UpdatedAt)}},{width:100,title:n.FD.format("listManage"),fixed:"right",render:function(I,H,k){var Z,N;return(0,a.jsx)(P.Z,{children:(0,a.jsx)(me,{type:"node",detail:{id:(Z=H.ID)!==null&&Z!==void 0?Z:"",name:(N=H.ID)!==null&&N!==void 0?N:""},trigger:(0,a.jsx)(M.Z.Link,{children:(0,a.jsx)(o.Z,{})})})})}}],pagination:!1,dataSource:m.Task.filter(function(c){return c.Status.State=="running"})})}}:void 0}))]})}},76428:function(ie,A,e){"use strict";e.d(A,{Z:function(){return f}});var Q=e(25593),d=e(67294),Y=e(85893);function f(_){return(0,Y.jsx)(Q.Z.Text,{copyable:!0,children:_.title})}},12323:function(ie,A,e){"use strict";e.d(A,{X:function(){return Q},n:function(){return d}});var Q={convertEol:!0,fontFamily:'Menlo, Monaco, "Courier New", monospace',fontWeight:400,fontSize:16,lineHeight:1,cursorStyle:"block",cursorInactiveStyle:"outline",cursorBlink:!0,letterSpacing:0,theme:{foreground:"#bfbfbf",cursor:"gray",selectionForeground:"#ffffff"}},d=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"]},24494:function(ie,A,e){"use strict";e.d(A,{$m:function(){return D},HN:function(){return P},Id:function(){return p},JC:function(){return V},P3:function(){return Ce},QB:function(){return w},UK:function(){return i},XX:function(){return W},Zc:function(){return M},ev:function(){return L},ig:function(){return we},kM:function(){return Je},kp:function(){return S},m8:function(){return s},rN:function(){return We},tm:function(){return Ee},vb:function(){return te},x$:function(){return $}});var Q=e(15009),d=e.n(Q),Y=e(99289),f=e.n(Y),_=e(82346),D="com.dpanel.swarm.service.description",L="com.dpanel.swarm.service.registry";function V(){return t.apply(this,arguments)}function t(){return t=f()(d()().mark(function x(){return d()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.abrupt("return",(0,_.request)("/api/app/swarm/info",{method:"POST"}));case 1:case"end":return U.stop()}},x)})),t.apply(this,arguments)}function i(x){return n.apply(this,arguments)}function n(){return n=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/init",{method:"POST",data:y}));case 1:case"end":return u.stop()}},x)})),n.apply(this,arguments)}function s(x){return o.apply(this,arguments)}function o(){return o=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return y.id=String(y.id),u.abrupt("return",(0,_.request)("/api/app/swarm/log",{method:"POST",data:y}));case 2:case"end":return u.stop()}},x)})),o.apply(this,arguments)}function p(x){return r.apply(this,arguments)}function r(){return r=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return y.download=!0,y.id=String(y.id),u.next=4,(0,_.request)("/api/app/swarm/log",{method:"POST",data:y,responseType:"blob"});case 4:return u.abrupt("return",u.sent);case 5:case"end":return u.stop()}},x)})),r.apply(this,arguments)}function P(x){return E.apply(this,arguments)}function E(){return E=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/node-list",{method:"POST",data:y}));case 1:case"end":return u.stop()}},x)})),E.apply(this,arguments)}function M(x){return C.apply(this,arguments)}function C(){return C=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/node-update",{method:"POST",data:y}));case 1:case"end":return u.stop()}},x)})),C.apply(this,arguments)}function te(x){return q.apply(this,arguments)}function q(){return q=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/info-join",{method:"POST",data:y}));case 1:case"end":return u.stop()}},x)})),q.apply(this,arguments)}function w(x){return R.apply(this,arguments)}function R(){return R=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/node-remove",{method:"POST",data:y}));case 1:case"end":return u.stop()}},x)})),R.apply(this,arguments)}function S(x){return v.apply(this,arguments)}function v(){return v=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/node-prune",{method:"POST",data:y}));case 1:case"end":return u.stop()}},x)})),v.apply(this,arguments)}function W(x){return De.apply(this,arguments)}function De(){return De=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/task-list",{method:"POST",data:y}));case 1:case"end":return u.stop()}},x)})),De.apply(this,arguments)}function We(x){return g.apply(this,arguments)}function g(){return g=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/task-list-in-node",{method:"POST",data:y}));case 1:case"end":return u.stop()}},x)})),g.apply(this,arguments)}function Je(x){return Me.apply(this,arguments)}function Me(){return Me=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/service-list",{method:"POST",data:y}));case 1:case"end":return u.stop()}},x)})),Me.apply(this,arguments)}function $(x){return re.apply(this,arguments)}function re(){return re=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/service-scaling",{method:"POST",data:y}));case 1:case"end":return u.stop()}},x)})),re.apply(this,arguments)}function Ee(x){return Te.apply(this,arguments)}function Te(){return Te=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/service-delete",{method:"POST",data:y}));case 1:case"end":return u.stop()}},x)})),Te.apply(this,arguments)}function Ce(x){return ke.apply(this,arguments)}function ke(){return ke=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/service-create",{method:"POST",data:y}));case 1:case"end":return u.stop()}},x)})),ke.apply(this,arguments)}function we(x){return Ve.apply(this,arguments)}function Ve(){return Ve=f()(d()().mark(function x(y){return d()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,_.request)("/api/app/swarm/service-detail",{method:"POST",data:y}));case 1:case"end":return u.stop()}},x)})),Ve.apply(this,arguments)}},3393:function(ie,A,e){"use strict";e.d(A,{Gb:function(){return V},Pn:function(){return s},Rb:function(){return p},YU:function(){return D},ZQ:function(){return M},_U:function(){return i},cD:function(){return te},cd:function(){return P}});var Q=e(15009),d=e.n(Q),Y=e(99289),f=e.n(Y),_=e(82346);function D(w){return L.apply(this,arguments)}function L(){return L=f()(d()().mark(function w(R){return d()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,_.request)("/api/app/image/get-detail",{method:"POST",data:R}));case 1:case"end":return v.stop()}},w)})),L.apply(this,arguments)}function V(w){return t.apply(this,arguments)}function t(){return t=f()(d()().mark(function w(R){return d()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,_.request)("/api/app/image/tag-remote",{method:"POST",data:R}));case 1:case"end":return v.stop()}},w)})),t.apply(this,arguments)}function i(w){return n.apply(this,arguments)}function n(){return n=f()(d()().mark(function w(R){return d()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,_.request)("/api/app/image/tag-add",{method:"POST",data:R}));case 1:case"end":return v.stop()}},w)})),n.apply(this,arguments)}function s(w){return o.apply(this,arguments)}function o(){return o=f()(d()().mark(function w(R){return d()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,_.request)("/api/app/image/tag-delete",{method:"POST",data:R}));case 1:case"end":return v.stop()}},w)})),o.apply(this,arguments)}function p(w){return r.apply(this,arguments)}function r(){return r=f()(d()().mark(function w(R){return d()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,_.request)("/api/app/image/export",{method:"POST",data:R,responseType:"blob"}));case 1:case"end":return v.stop()}},w)})),r.apply(this,arguments)}function P(w){return E.apply(this,arguments)}function E(){return E=f()(d()().mark(function w(R){return d()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,_.request)("/api/pro/image/get-remote-tag",{method:"POST",data:R}));case 1:case"end":return v.stop()}},w)})),E.apply(this,arguments)}function M(w){return C.apply(this,arguments)}function C(){return C=f()(d()().mark(function w(R){return d()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,_.request)("/api/app/image/check-upgrade",{method:"POST",data:R}));case 1:case"end":return v.stop()}},w)})),C.apply(this,arguments)}function te(w){return q.apply(this,arguments)}function q(){return q=f()(d()().mark(function w(R){return d()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,_.request)("/api/pro/image/get-rootfs",{method:"POST",data:R}));case 1:case"end":return v.stop()}},w)})),q.apply(this,arguments)}},75458:function(ie){(function(A,e){ie.exports=e()})(self,()=>(()=>{"use strict";var A={345:(Y,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.runAndSubscribe=f.forwardEvent=f.EventEmitter=void 0,f.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=_=>(this._listeners.push(_),{dispose:()=>{if(!this._disposed){for(let D=0;D<this._listeners.length;D++)if(this._listeners[D]===_)return void this._listeners.splice(D,1)}}})),this._event}fire(_,D){const L=[];for(let V=0;V<this._listeners.length;V++)L.push(this._listeners[V]);for(let V=0;V<L.length;V++)L[V].call(void 0,_,D)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},f.forwardEvent=function(_,D){return _(L=>D.fire(L))},f.runAndSubscribe=function(_,D){return D(void 0),_(L=>D(L))}},859:(Y,f)=>{function _(D){for(const L of D)L.dispose();D.length=0}Object.defineProperty(f,"__esModule",{value:!0}),f.getDisposeArrayDisposable=f.disposeArray=f.toDisposable=f.MutableDisposable=f.Disposable=void 0,f.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const D of this._disposables)D.dispose();this._disposables.length=0}register(D){return this._disposables.push(D),D}unregister(D){const L=this._disposables.indexOf(D);L!==-1&&this._disposables.splice(L,1)}},f.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(D){var L;this._isDisposed||D===this._value||((L=this._value)==null||L.dispose(),this._value=D)}clear(){this.value=void 0}dispose(){var D;this._isDisposed=!0,(D=this._value)==null||D.dispose(),this._value=void 0}},f.toDisposable=function(D){return{dispose:D}},f.disposeArray=_,f.getDisposeArrayDisposable=function(D){return{dispose:()=>_(D)}}}},e={};function Q(Y){var f=e[Y];if(f!==void 0)return f.exports;var _=e[Y]={exports:{}};return A[Y](_,_.exports,Q),_.exports}var d={};return(()=>{var Y=d;Object.defineProperty(Y,"__esModule",{value:!0}),Y.SearchAddon=void 0;const f=Q(345),_=Q(859),D=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?";class L extends _.Disposable{constructor(t){var i;super(),this._highlightedLines=new Set,this._highlightDecorations=[],this._selectedDecoration=this.register(new _.MutableDisposable),this._linesCacheTimeoutId=0,this._linesCacheDisposables=new _.MutableDisposable,this._onDidChangeResults=this.register(new f.EventEmitter),this.onDidChangeResults=this._onDidChangeResults.event,this._highlightLimit=(i=t==null?void 0:t.highlightLimit)!=null?i:1e3}activate(t){this._terminal=t,this.register(this._terminal.onWriteParsed(()=>this._updateMatches())),this.register(this._terminal.onResize(()=>this._updateMatches())),this.register((0,_.toDisposable)(()=>this.clearDecorations()))}_updateMatches(){var t;this._highlightTimeout&&window.clearTimeout(this._highlightTimeout),this._cachedSearchTerm&&((t=this._lastSearchOptions)!=null&&t.decorations)&&(this._highlightTimeout=setTimeout(()=>{const i=this._cachedSearchTerm;this._cachedSearchTerm=void 0,this.findPrevious(i,ht(ct({},this._lastSearchOptions),{incremental:!0,noScroll:!0}))},200))}clearDecorations(t){this._selectedDecoration.clear(),(0,_.disposeArray)(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear(),t||(this._cachedSearchTerm=void 0)}clearActiveDecoration(){this._selectedDecoration.clear()}findNext(t,i){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const n=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,i);this._lastSearchOptions=i,i!=null&&i.decorations&&(this._cachedSearchTerm===void 0||t!==this._cachedSearchTerm||n)&&this._highlightAllMatches(t,i);const s=this._findNextAndSelect(t,i);return this._fireResults(i),this._cachedSearchTerm=t,s}_highlightAllMatches(t,i){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!t||t.length===0)return void this.clearDecorations();i=i||{},this.clearDecorations(!0);const n=[];let s,o=this._find(t,0,0,i);for(;o&&((s==null?void 0:s.row)!==o.row||(s==null?void 0:s.col)!==o.col)&&!(n.length>=this._highlightLimit);)s=o,n.push(s),o=this._find(t,s.col+s.term.length>=this._terminal.cols?s.row+1:s.row,s.col+s.term.length>=this._terminal.cols?0:s.col+1,i);for(const p of n){const r=this._createResultDecoration(p,i.decorations);r&&(this._highlightedLines.add(r.marker.line),this._highlightDecorations.push({decoration:r,match:p,dispose(){r.dispose()}}))}}_find(t,i,n,s){var r;if(!this._terminal||!t||t.length===0)return(r=this._terminal)==null||r.clearSelection(),void this.clearDecorations();if(n>this._terminal.cols)throw new Error(`Invalid col: ${n} to search in terminal of ${this._terminal.cols} cols`);let o;this._initLinesCache();const p={startRow:i,startCol:n};if(o=this._findInLine(t,p,s),!o)for(let P=i+1;P<this._terminal.buffer.active.baseY+this._terminal.rows&&(p.startRow=P,p.startCol=0,o=this._findInLine(t,p,s),!o);P++);return o}_findNextAndSelect(t,i){var P;if(!this._terminal||!t||t.length===0)return(P=this._terminal)==null||P.clearSelection(),this.clearDecorations(),!1;const n=this._terminal.getSelectionPosition();this._terminal.clearSelection();let s=0,o=0;n&&(this._cachedSearchTerm===t?(s=n.end.x,o=n.end.y):(s=n.start.x,o=n.start.y)),this._initLinesCache();const p={startRow:o,startCol:s};let r=this._findInLine(t,p,i);if(!r)for(let E=o+1;E<this._terminal.buffer.active.baseY+this._terminal.rows&&(p.startRow=E,p.startCol=0,r=this._findInLine(t,p,i),!r);E++);if(!r&&o!==0)for(let E=0;E<o&&(p.startRow=E,p.startCol=0,r=this._findInLine(t,p,i),!r);E++);return!r&&n&&(p.startRow=n.start.y,p.startCol=0,r=this._findInLine(t,p,i)),this._selectResult(r,i==null?void 0:i.decorations,i==null?void 0:i.noScroll)}findPrevious(t,i){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const n=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,i);this._lastSearchOptions=i,i!=null&&i.decorations&&(this._cachedSearchTerm===void 0||t!==this._cachedSearchTerm||n)&&this._highlightAllMatches(t,i);const s=this._findPreviousAndSelect(t,i);return this._fireResults(i),this._cachedSearchTerm=t,s}_didOptionsChange(t,i){return!!i&&(t.caseSensitive!==i.caseSensitive||t.regex!==i.regex||t.wholeWord!==i.wholeWord)}_fireResults(t){if(t!=null&&t.decorations){let i=-1;if(this._selectedDecoration.value){const n=this._selectedDecoration.value.match;for(let s=0;s<this._highlightDecorations.length;s++){const o=this._highlightDecorations[s].match;if(o.row===n.row&&o.col===n.col&&o.size===n.size){i=s;break}}}this._onDidChangeResults.fire({resultIndex:i,resultCount:this._highlightDecorations.length})}}_findPreviousAndSelect(t,i){var E;if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!this._terminal||!t||t.length===0)return(E=this._terminal)==null||E.clearSelection(),this.clearDecorations(),!1;const n=this._terminal.getSelectionPosition();this._terminal.clearSelection();let s=this._terminal.buffer.active.baseY+this._terminal.rows-1,o=this._terminal.cols;const p=!0;this._initLinesCache();const r={startRow:s,startCol:o};let P;if(n&&(r.startRow=s=n.start.y,r.startCol=o=n.start.x,this._cachedSearchTerm!==t&&(P=this._findInLine(t,r,i,!1),P||(r.startRow=s=n.end.y,r.startCol=o=n.end.x))),P||(P=this._findInLine(t,r,i,p)),!P){r.startCol=Math.max(r.startCol,this._terminal.cols);for(let M=s-1;M>=0&&(r.startRow=M,P=this._findInLine(t,r,i,p),!P);M--);}if(!P&&s!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let M=this._terminal.buffer.active.baseY+this._terminal.rows-1;M>=s&&(r.startRow=M,P=this._findInLine(t,r,i,p),!P);M--);return this._selectResult(P,i==null?void 0:i.decorations,i==null?void 0:i.noScroll)}_initLinesCache(){const t=this._terminal;this._linesCache||(this._linesCache=new Array(t.buffer.active.length),this._linesCacheDisposables.value=(0,_.getDisposeArrayDisposable)([t.onLineFeed(()=>this._destroyLinesCache()),t.onCursorMove(()=>this._destroyLinesCache()),t.onResize(()=>this._destroyLinesCache())])),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._linesCacheDisposables.clear(),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_isWholeWord(t,i,n){return(t===0||D.includes(i[t-1]))&&(t+n.length===i.length||D.includes(i[t+n.length]))}_findInLine(t,i,n={},s=!1){var S;const o=this._terminal,p=i.startRow,r=i.startCol,P=o.buffer.active.getLine(p);if(P!=null&&P.isWrapped)return s?void(i.startCol+=o.cols):(i.startRow--,i.startCol+=o.cols,this._findInLine(t,i,n));let E=(S=this._linesCache)==null?void 0:S[p];E||(E=this._translateBufferLineToStringWithWrap(p,!0),this._linesCache&&(this._linesCache[p]=E));const[M,C]=E,te=this._bufferColsToStringOffset(p,r),q=n.caseSensitive?t:t.toLowerCase(),w=n.caseSensitive?M:M.toLowerCase();let R=-1;if(n.regex){const v=RegExp(q,"g");let W;if(s)for(;W=v.exec(w.slice(0,te));)R=v.lastIndex-W[0].length,t=W[0],v.lastIndex-=t.length-1;else W=v.exec(w.slice(te)),W&&W[0].length>0&&(R=te+(v.lastIndex-W[0].length),t=W[0])}else s?te-q.length>=0&&(R=w.lastIndexOf(q,te-q.length)):R=w.indexOf(q,te);if(R>=0){if(n.wholeWord&&!this._isWholeWord(R,w,t))return;let v=0;for(;v<C.length-1&&R>=C[v+1];)v++;let W=v;for(;W<C.length-1&&R+t.length>=C[W+1];)W++;const De=R-C[v],We=R+t.length-C[W],g=this._stringLengthToBufferSize(p+v,De);return{term:t,col:g,row:p+v,size:this._stringLengthToBufferSize(p+W,We)-g+o.cols*(W-v)}}}_stringLengthToBufferSize(t,i){const n=this._terminal.buffer.active.getLine(t);if(!n)return 0;for(let s=0;s<i;s++){const o=n.getCell(s);if(!o)break;const p=o.getChars();p.length>1&&(i-=p.length-1);const r=n.getCell(s+1);r&&r.getWidth()===0&&i++}return i}_bufferColsToStringOffset(t,i){const n=this._terminal;let s=t,o=0,p=n.buffer.active.getLine(s);for(;i>0&&p;){for(let r=0;r<i&&r<n.cols;r++){const P=p.getCell(r);if(!P)break;P.getWidth()&&(o+=P.getCode()===0?1:P.getChars().length)}if(s++,p=n.buffer.active.getLine(s),p&&!p.isWrapped)break;i-=n.cols}return o}_translateBufferLineToStringWithWrap(t,i){var r;const n=this._terminal,s=[],o=[0];let p=n.buffer.active.getLine(t);for(;p;){const P=n.buffer.active.getLine(t+1),E=!!P&&P.isWrapped;let M=p.translateToString(!E&&i);if(E&&P){const C=p.getCell(p.length-1);C&&C.getCode()===0&&C.getWidth()===1&&((r=P.getCell(0))==null?void 0:r.getWidth())===2&&(M=M.slice(0,-1))}if(s.push(M),!E)break;o.push(o[o.length-1]+M.length),t++,p=P}return[s.join(""),o]}_selectResult(t,i,n){const s=this._terminal;if(this._selectedDecoration.clear(),!t)return s.clearSelection(),!1;if(s.select(t.col,t.row,t.size),i){const o=s.registerMarker(-s.buffer.active.baseY-s.buffer.active.cursorY+t.row);if(o){const p=s.registerDecoration({marker:o,x:t.col,width:t.size,backgroundColor:i.activeMatchBackground,layer:"top",overviewRulerOptions:{color:i.activeMatchColorOverviewRuler}});if(p){const r=[];r.push(o),r.push(p.onRender(P=>this._applyStyles(P,i.activeMatchBorder,!0))),r.push(p.onDispose(()=>(0,_.disposeArray)(r))),this._selectedDecoration.value={decoration:p,match:t,dispose(){p.dispose()}}}}}if(!n&&(t.row>=s.buffer.active.viewportY+s.rows||t.row<s.buffer.active.viewportY)){let o=t.row-s.buffer.active.viewportY;o-=Math.floor(s.rows/2),s.scrollLines(o)}return!0}_applyStyles(t,i,n){t.classList.contains("xterm-find-result-decoration")||(t.classList.add("xterm-find-result-decoration"),i&&(t.style.outline=`1px solid ${i}`)),n&&t.classList.add("xterm-find-active-result-decoration")}_createResultDecoration(t,i){const n=this._terminal,s=n.registerMarker(-n.buffer.active.baseY-n.buffer.active.cursorY+t.row);if(!s)return;const o=n.registerDecoration({marker:s,x:t.col,width:t.size,backgroundColor:i.matchBackground,overviewRulerOptions:this._highlightedLines.has(s.line)?void 0:{color:i.matchOverviewRuler,position:"center"}});if(o){const p=[];p.push(s),p.push(o.onRender(r=>this._applyStyles(r,i.matchBorder,!1))),p.push(o.onDispose(()=>(0,_.disposeArray)(p)))}return o}}Y.SearchAddon=L})(),d})())}}]);
}());