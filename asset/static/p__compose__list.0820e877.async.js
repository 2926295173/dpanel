"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8022],{91806:function(ne,b,e){e.d(b,{Z:function(){return f}});var K=e(87462),R=e(67294),U={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},v=U,y=e(84089),T=function(G,I){return R.createElement(y.Z,(0,K.Z)({},G,{ref:I,icon:v}))},z=R.forwardRef(T),f=z},44349:function(ne,b,e){var K=e(97857),R=e.n(K),U=e(15009),v=e.n(U),y=e(99289),T=e.n(y),z=e(74763),f=e(17186),k=e(5966),G=e(86250),I=e(67294),Q=e(85893),q=(0,I.forwardRef)(function(c,ee){var A=(0,I.useRef)();(0,I.useImperativeHandle)(ee,function(){return{addItem:function(L){function d(p,g,a){return L.apply(this,arguments)}return d.toString=function(){return L.toString()},d}(function(L,d,p){var g,a=(g=A.current)===null||g===void 0?void 0:g.getList(),C;if(a==null||a.forEach(function(J,X){J[L]==d[L]&&(C=X)}),!(0,z.k)(C)&&p){var H;(H=A.current)===null||H===void 0||H.remove(C),C=void 0}if(!C){var S;(S=A.current)===null||S===void 0||S.add(d)}}),removeItemByKey:function(d,p){return T()(v()().mark(function g(){var a,C;return v()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return C=(a=A.current)===null||a===void 0?void 0:a.getList(),C==null||C.forEach(function(J,X){if(J[d]==p){var Y;(Y=A.current)===null||Y===void 0||Y.remove(X);return}}),S.abrupt("return");case 3:case"end":return S.stop()}},g)}))()},clear:function(d){if(!d){var p;d=(p=A.current)===null||p===void 0||(p=p.getList())===null||p===void 0?void 0:p.map(function(a,C){return C})}if(d){var g;(g=A.current)===null||g===void 0||g.remove(d)}},getList:function(){var d;return(d=A.current)===null||d===void 0?void 0:d.getList()}}});var x={};return c.hideCopyButton===!0&&(x.copyIconProps=!1),c.hideDeleteButton===!0&&(x.deleteIconProps=!1),(0,Q.jsx)(f.u,R()(R()({initialValue:c.initialValue,label:c.label,name:c.name,actionRef:A,creatorButtonProps:c.showAddButton?{creatorButtonText:c.label?c.label:c.name}:!1,min:c.min?c.min:0},x),{},{children:function(d,p,g){return(0,Q.jsx)(G.Z,{justify:c.justify,gap:c.gap,children:c.items.map(function(a){return a.render?(0,Q.jsx)("div",{children:a.render&&a.render(d,p,g)},"".concat(c.name,"-").concat(a.name,"-").concat(d.key)):(0,Q.jsx)(k.Z,{width:a.width,name:a.name,label:a.label,required:a.required,rules:[{required:a.required}],disabled:a.disabled,placeholder:a.placeholder},"".concat(c.name,"-").concat(a.name,"-").concat(d.key))})})}}))});b.Z=q},36435:function(ne,b,e){var K=e(15009),R=e.n(K),U=e(64599),v=e.n(U),y=e(99289),T=e.n(y),z=e(9783),f=e.n(z),k=e(5574),G=e.n(k),I=e(67294),Q=e(184),q=e(38345),c=e(97269),ee=e(97321),A=e(97462),x=e(64317),L=e(5966),d=e(86615),p=e(68602),g=e(83622),a=e(83403),C=e(24963),H=e(1699),S=e(29177),J=e(1883),X=e(43425),Y=e(44349),le=e(3616),te=e(36146),s=e(85893),o=(0,I.forwardRef)(function(Z,se){var ae=(0,I.useState)(!1),_e=G()(ae,2),B=_e[0],w=_e[1],F=(0,I.useRef)(),oe=(0,I.useContext)(C.Z),re=oe.message,W=(0,I.useState)([]),l=G()(W,2),n=l[0],u=l[1],t=new te.Uo("components.permissionButton"),r=f()(f()(f()(f()(f()({},a.W6.CONTAINER,"Id"),a.W6.APPSTORE,"name"),a.W6.COMPOSE,"name"),a.W6.REGISTRY,"serverAddress"),a.W6.DOCKER_ENV,"name"),h=f()(f()(f()(f()(f()({},a.W6.CONTAINER,"name"),a.W6.APPSTORE,"name"),a.W6.COMPOSE,"name"),a.W6.REGISTRY,"title"),a.W6.DOCKER_ENV,"title"),E=r[Z.type],N=h[Z.type],i=Z.selected.map(function(_){return _[r[Z.type]]});return I.useEffect(function(){if(B){if(!Z.selected||Z.selected.length==0){re.error(te.FD.format("message.noDataSelect")),w(!1);return}(0,p.dP)({permission:{uri:Z.type,key:E,value:i}}).then(function(_){var m;(m=F.current)===null||m===void 0||m.setFieldValue("list",Object.keys(_.data.list).map(function(D){return{name:D,type:_.data.list[D].type,users:_.data.list[D].users}}))}),(0,p.lE)().then(function(_){var m,D=(m=_.data)===null||m===void 0||(m=m.list)===null||m===void 0?void 0:m.map(function(O){return{label:O.username,value:O.username}});u(D)})}},[B]),(0,s.jsx)(H.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,s.jsxs)(Q.a,{name:"create",title:t.format("drawerTitle"),open:B,onOpenChange:function(m){if(!m){var D;(D=F.current)===null||D===void 0||D.resetFields()}w(m)},drawerProps:{forceRender:!0,width:le.R_},formRef:F,trigger:(0,s.jsx)(g.ZP,{icon:(0,s.jsx)(S.Z,{}),children:t.format("drawerTriggerButton")}),onFinish:function(){var _=T()(R()().mark(function m(D){var O,j,P;return R()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:O=v()(D.list),M.prev=1,O.s();case 3:if((j=O.n()).done){M.next=9;break}return P=j.value,M.next=7,(0,p.Db)({usernames:P.users,permissionType:P.type,permission:{uri:Z.type,key:E,showKey:N,value:[P.name]}});case 7:M.next=3;break;case 9:M.next=14;break;case 11:M.prev=11,M.t0=M.catch(1),O.e(M.t0);case 14:return M.prev=14,O.f(),M.finish(14);case 17:re.success(te.FD.format("finish")),w(!1),Z.onSuccess();case 20:case"end":return M.stop()}},m,null,[[1,11,14,17]])}));return function(m){return _.apply(this,arguments)}}(),children:[(0,s.jsxs)(q.Z,{ghost:!0,title:(0,s.jsx)(J.Z,{}),subTitle:t.format("batchTitle"),children:[(0,s.jsx)(c.A.Item,{name:"type",style:{marginBottom:0},children:(0,s.jsx)(ee.Z.Group,{defaultValue:"admin",onChange:function(m){var D,O,j=(D=F.current)===null||D===void 0?void 0:D.getFieldValue("list");j.forEach(function(P){P.type=m,P.users=[]}),(O=F.current)===null||O===void 0||O.setFieldValue("list",j)},children:["admin","restricted","public"].map(function(_){return(0,s.jsx)(ee.Z,{style:{width:240},title:t.format("dataTypeOption.".concat(_)),description:t.format("dataTypeOptionDesc.".concat(_)),value:_},_)})})}),(0,s.jsx)(A.Z,{name:["type"],children:function(m){var D=m.type;if(D==="restricted")return(0,s.jsx)(x.Z,{mode:"multiple",name:"usernames",label:t.format("formUsernames"),onChange:function(j){var P,$,M=(P=F.current)===null||P===void 0?void 0:P.getFieldValue("list");M.forEach(function(V){V.users=j}),($=F.current)===null||$===void 0||$.setFieldValue("list",M)},rules:[{required:!0}],request:T()(R()().mark(function O(){var j,P,$;return R()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(!(n.length>0)){V.next=2;break}return V.abrupt("return",n);case 2:return V.next=4,(0,p.lE)();case 4:return P=V.sent,$=(j=P.data)===null||j===void 0||(j=j.list)===null||j===void 0?void 0:j.map(function(ie){return{label:ie.username,value:ie.username}}),u($),V.abrupt("return",$);case 8:case"end":return V.stop()}},O)}))})}})]}),(0,s.jsx)(q.Z,{ghost:!0,title:(0,s.jsx)(X.Z,{}),subTitle:t.format("dataTitle"),children:(0,s.jsx)(Y.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:t.format("dataName"),render:function(m,D,O){var j=O.getCurrentRowData();return(0,s.jsx)(L.Z,{disabled:!0,label:t.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:t.format("dataType"),render:function(m,D,O){var j=O.getCurrentRowData();return(0,s.jsx)(d.Z.Group,{label:t.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(P){return{label:t.format("dataTypeOption.".concat(P)),value:P}})})}},{name:"users",label:t.format("dataUsers"),render:function(m,D,O){return(0,s.jsx)(A.Z,{name:["type"],children:function(P){var $=P.type;if($=="restricted")return(0,s.jsx)(x.Z,{width:"sm",mode:"tags",name:"users",label:t.format("dataUsers"),options:n})}})}}]})})]})})});b.Z=o},96781:function(ne,b,e){var K=e(67294),R=(0,K.createContext)({});b.Z=R},92922:function(ne,b,e){e.r(b),e.d(b,{default:function(){return Z}});var K=e(64599),R=e.n(K),U=e(15009),v=e.n(U),y=e(99289),T=e.n(y),z=e(80821),f=e(90098),k=e(43425),G=e(86548),I=e(23430),Q=e(90078),q=e(56729),c=e(82346),ee=e(83622),A=e(25593),x=e(83062),L=e(66309),d=e(42075),p=e(96074),g=e(67294),a=e(94359),C=e(67255),H=e(93162),S=e.n(H),J=e(96781),X=e(69626),Y=e(1699),le=e(83403),te=e(36435),s=e(36146),o=e(85893);function Z(){var se,ae,_e=(0,g.useContext)(J.Z),B=_e.listTableRef,w=(0,g.useRef)(),F=(0,c.useAccess)(),oe=(0,c.useLocation)(),re=new s.Uo("compose");return(0,o.jsxs)(Q._z,{header:{extra:[(0,o.jsx)(Y.u,{access:"canSeeComposeListManageCreate",children:(0,o.jsx)(c.Link,{to:"/compose/create",reloadDocument:oe.search.length>0,children:(0,o.jsx)(ee.ZP,{type:"primary",children:s.Ob.format("compose.create")},"createCompose")},"create")},"create")]},children:[(0,o.jsx)(X.Z,{ref:w,onClose:function(){var l;!((l=B.current)===null||l===void 0)&&l.reloadAndRest&&B.current.reloadAndRest()}}),(0,o.jsx)(q.Z,{scroll:{x:"max-content"},request:function(){var W=T()(v()().mark(function l(n){var u;return v()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,f.pm)({title:n.title,name:n.name});case 2:return u=r.sent,r.abrupt("return",{data:u.data.list,success:!0,total:u.data.list.length});case 4:case"end":return r.stop()}},l)}));return function(l){return W.apply(this,arguments)}}(),rowKey:"name",columns:[{title:s.FD.format("listName"),dataIndex:"name",width:200,render:function(l,n,u,t,r){return(0,o.jsx)(A.Z.Link,{onClick:function(){var E;(E=w.current)===null||E===void 0||E.show(n.id||n.name)},children:n.name})},sorter:function(l,n){return l.name.localeCompare(n.name)},sortDirections:["descend","ascend"]},{title:s.FD.format("listTitle"),dataIndex:"title",width:200},{title:s.FD.format("listType"),width:150,search:!1,render:function(l,n,u,t,r){var h,E=n.setting&&n.setting.type?n.setting.type:"default";return(0,o.jsx)(x.Z,{title:(h=n.setting.uri)!==null&&h!==void 0?h:"",children:(0,o.jsx)(L.Z,{color:re.format("listTypeColor.".concat(E)),children:re.format("listType.".concat(E))})})}},{title:s.FD.format("listStatus"),dataIndex:"status",search:!1,width:300,render:function(l,n,u,t,r){return(0,o.jsx)(d.Z,{children:n.setting.status.split(", ").map(function(h,E){var N,i="running",_=h.indexOf("(");return _>-1?i=h.slice(0,_):i=h,(0,o.jsx)(a.Z,{status:"compose.".concat(i),statusValue:{count:h.slice(_+1,h.length-1)},tip:"".concat(h," ").concat((N=n.setting.message)!==null&&N!==void 0?N:"")},E)})})},sorter:function(l,n){return l.setting.status.localeCompare(n.setting.status)}},{title:s.FD.format("listCreatedAt"),dataIndex:"",search:!1,width:150,render:function(l,n,u,t,r){return n.setting.createdAt?new Date(n.setting.createdAt).toLocaleString():"-"},sorter:function(l,n){var u,t;return new Date((u=l.setting.createdAt)!==null&&u!==void 0?u:"").toLocaleString().localeCompare(new Date((t=n.setting.createdAt)!==null&&t!==void 0?t:"").toLocaleString())}},{title:s.FD.format("listUpdatedAt"),dataIndex:"",search:!1,width:150,render:function(l,n,u,t,r){return n.setting.updatedAt?new Date(n.setting.updatedAt).toLocaleString():"-"},sorter:function(l,n){var u,t;return new Date((u=l.setting.updatedAt)!==null&&u!==void 0?u:"").toLocaleString().localeCompare(new Date((t=n.setting.updatedAt)!==null&&t!==void 0?t:"").toLocaleString())}},{title:s.FD.format("listManage"),width:80,valueType:"option",fixed:"right",key:"option",hidden:!F.canSeeComposeListManage,render:function(l,n,u,t,r){return n.setting.type!="dangling"&&(0,o.jsxs)(d.Z,{split:(0,o.jsx)(p.Z,{type:"vertical"}),children:[(0,o.jsx)(A.Z.Link,{onClick:function(){var E;(E=w.current)===null||E===void 0||E.show(n.id||n.name)},children:(0,o.jsx)(x.Z,{title:s.FD.format("listManageDetail"),children:(0,o.jsx)(k.Z,{})})},"3"),(0,o.jsx)(c.Link,{to:"/compose/create?id=".concat(n.id||n.name),children:(0,o.jsx)(x.Z,{title:s.FD.format("listManageEdit"),children:(0,o.jsx)(G.Z,{})})}),(0,o.jsx)(A.Z.Link,{onClick:T()(v()().mark(function h(){var E,N;return v()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,(0,f.tw)({id:n.id||n.name});case 2:E=_.sent,N=new Blob([E],{type:"application/zip"}),(0,H.saveAs)(N,"compose-"+n.name+".zip");case 5:case"end":return _.stop()}},h)})),children:(0,o.jsx)(x.Z,{title:s.FD.format("listManageDownload"),children:(0,o.jsx)(I.Z,{})})},"2")]})}}],rowSelection:F.canSeeComposeListManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0,getCheckboxProps:function(l){return{disabled:l.setting.type=="dangling"||l.setting.type=="outPath"}}}:void 0,tableAlertOptionRender:function(l){var n=l.selectedRows;return(0,o.jsxs)(d.Z,{size:16,children:[(0,o.jsx)(te.Z,{type:le.W6.COMPOSE,selected:n,onSuccess:function(){var t,r;return!((t=B.current)===null||t===void 0)&&t.reloadAndRest&&((r=B.current)===null||r===void 0||r.reloadAndRest()),!0}}),(0,o.jsx)(Y.u,{access:"canSeeComposeListManageDelete",children:(0,o.jsx)(z.Z,{danger:!0,type:"primary",action:T()(v()().mark(function u(){var t,r,h,E;return v()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:i.prev=0,r=R()(n),i.prev=2,r.s();case 4:if((h=r.n()).done){i.next=11;break}return E=h.value,i.next=8,(0,f.mg)({id:E.id||E.name});case 8:t=i.sent;case 9:i.next=4;break;case 11:i.next=16;break;case 13:i.prev=13,i.t0=i.catch(2),r.e(i.t0);case 16:return i.prev=16,r.f(),i.finish(16);case 19:i.next=23;break;case 21:i.prev=21,i.t1=i.catch(0);case 23:return i.abrupt("return",(0,f.ik)({id:n.map(function(_){return _.id})}));case 24:case"end":return i.stop()}},u,null,[[0,21],[2,13,16,19]])})),onSuccess:function(){var t,r;return!((t=B.current)===null||t===void 0)&&t.reloadAndRest&&((r=B.current)===null||r===void 0||r.reloadAndRest()),!0},onError:function(){var t,r;return!((t=B.current)===null||t===void 0)&&t.reset&&((r=B.current)===null||r===void 0||r.reset()),!0},confirm:"notification.confirm.title",children:s.FD.format("listManageDeleteBatch")})})]})},pagination:(0,C.O)({page:(se=(ae=oe.state)===null||ae===void 0?void 0:ae.page)!==null&&se!==void 0?se:1}),search:{collapsed:!1},actionRef:B,columnsState:(0,C.j)("compose-list")})]})}},67255:function(ne,b,e){e.d(b,{O:function(){return K},j:function(){return R}});function K(U){var v=localStorage.getItem("dpanel-pagesize");return v=="all"?!1:{defaultCurrent:U==null?void 0:U.page,showSizeChanger:!0,defaultPageSize:parseInt(v!=null?v:"20"),onChange:function(T,z){localStorage.setItem("dpanel-page-"+location.pathname.split("/").slice(-2).join("-"),"".concat(T))}}}function R(U){var v="dpanel-table-column-".concat(U),y={};if(localStorage.getItem(v)){var T;y=JSON.parse((T=localStorage.getItem(v))!==null&&T!==void 0?T:"{}")}return{defaultValue:y,onChange:function(f){localStorage.setItem("dpanel-table-column-".concat(U),JSON.stringify(f))}}}}}]);
