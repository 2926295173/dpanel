"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9626],{69626:function($e,je,n){n.d(je,{Z:function(){return vn}});var Ce=n(19632),g=n.n(Ce),xe=n(5574),C=n.n(xe),V=n(15009),m=n.n(V),ve=n(99289),O=n.n(ve),u=n(67294),X=n(80821),E=n(90098),we=n(26522),B=n(86548),ne=n(43425),J=n(87740),he=n(48689),T=n(33160),Se=n(87784),te=n(74842),Re=n(30159),ue=n(25035),z=n(38345),re=n(97269),ae=n(86615),L=n(62370),de=n(82346),ge=n(85265),_=n(42075),ce=n(96074),ie=n(25593),oe=n(83062),c=n(40056),s=n(84567),G=n(83622),r=n(99861),Ie=n(91058),Be=n(79245),ke=n(60940),be=n(55241),We=n(78451),Ke=n(37413),Ge=n(94359),Ne=n(91806),Qe=n(60433),Ee=n(89035),ze=n(99922),Ye=n(46357),He=n(87662),Xe=n(5251),k=n(36146),e=n(85893);function Je(o){var q=(0,u.useState)(""),W=C()(q,2),U=W[0],Y=W[1],M=(0,u.useRef)(),Z=(0,u.useRef)(),$=(0,u.useState)(!1),f=C()($,2),x=f[0],t=f[1],y=new k.Uo("components.appCompose");return(0,u.useEffect)(function(){(0,He.K3)().then(function(h){var d;Y((d=h.data.serverUrl)!==null&&d!==void 0?d:"")}),t(!1)},[o.containerList]),o.containerList&&(0,e.jsxs)(z.Z,{ghost:!0,title:(0,e.jsx)(Ne.Z,{}),subTitle:y.format("detailContainerTitle"),extra:o.enableSelectService&&(0,e.jsx)(s.Z,{onChange:function(d){t(d.target.checked)},children:y.format("selectService")},"selectService"),children:[(0,e.jsx)(ze.Z,{showFileExplorer:!0,ref:M}),(0,e.jsx)(Ye.Z,{ref:Z}),(0,e.jsx)(ke.Z,{scroll:{x:"max-content"},rowKey:"service",pagination:!1,columns:[{title:k.FD.format("listName"),dataIndex:"name",width:200,render:function(d,i,w){return(0,e.jsx)(oe.Z,{title:i.service,children:(0,e.jsx)(We.Z,{content:i.name?(0,Xe.fi)(i.name,"/"):i.service})})}},{title:k.FD.format("listPort"),render:function(d,i,w){var P=[],N=[];return i.publishers&&i.publishers.map(function(F){F.publishedPort?P.push({PrivatePort:F.targetPort,Type:F.protocol,IP:F.url,PublicPort:F.publishedPort}):F.publishedPort&&N.push({PrivatePort:F.targetPort,Type:F.protocol,IP:F.url,PublicPort:F.publishedPort})}),(0,e.jsx)(Ke.Z,{publicPort:P,privatePort:N,domain:[],serverIp:U})}},{title:k.FD.format("listStatus"),render:function(d,i,w){return(0,e.jsx)(Ge.Z,{status:"container.".concat(i.state),tip:"".concat(i.state," ").concat(i.status)},i.name)}},{title:k.FD.format("listManage"),fixed:"right",render:function(d,i,w){return(0,e.jsxs)(_.Z,{split:(0,e.jsx)(ce.Z,{type:"vertical"}),children:[i.name==""&&(0,e.jsx)(be.Z,{placement:"left",content:(0,e.jsx)(z.Z,{ghost:!0,title:k.FD.format("listManageShowContainerEnv"),children:(0,e.jsx)(_.Z,{direction:"vertical",children:i.environment&&Object.keys(i.environment).map(function(P){if(i.environment&&i.environment[P])return(0,e.jsx)(ie.Z.Text,{code:!0,children:"".concat(P,"=").concat(i.environment[P])},P)})})}),children:(0,e.jsx)(Qe.Z,{})}),i.name!=""&&(0,e.jsx)(ie.Z.Link,{onClick:function(){var N;(N=Z.current)===null||N===void 0||N.show(i.name)},children:(0,e.jsx)(ne.Z,{})},"container"),i.state=="running"&&(0,e.jsx)(ie.Z.Link,{onClick:function(){var N;(N=M.current)===null||N===void 0||N.show({url:"/console/container/".concat(i.name),title:i.name})},children:(0,e.jsx)(Ee.Z,{})},"console")]})}}],dataSource:o.containerList,rowSelection:x&&o.containerList?{defaultSelectedRowKeys:o.containerList.map(function(h){return h.service}),onChange:function(d,i,w){o.selectServiceFinish&&o.selectServiceFinish(d)}}:void 0})]})}var _e=n(81146),qe=n(1883),Fe=n(3616),en=(0,u.forwardRef)(function(o,q){(0,u.useImperativeHandle)(q,function(){return{show:function(h){return O()(m()().mark(function d(){return m()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:x(o.composeItem),M(!0);case 2:case"end":return w.stop()}},d)}))()}}});var W=(0,u.useState)(!1),U=C()(W,2),Y=U[0],M=U[1],Z=(0,u.useState)(),$=C()(Z,2),f=$[0],x=$[1],t=(0,u.useRef)();return(0,e.jsxs)(e.Fragment,{children:[o.showTriggerButton&&(0,e.jsx)(ie.Z.Link,{onClick:O()(m()().mark(function y(){return m()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:x(o.composeItem),M(!0);case 2:case"end":return d.stop()}},y)})),children:(0,e.jsx)(oe.Z,{title:k.FD.format("listManageLog"),children:(0,e.jsx)(qe.Z,{})})},"log"),(0,e.jsx)(ge.Z,{title:k.FD.format("listLog"),open:Y,forceRender:!0,onClose:function(){M(!1)},afterOpenChange:function(h){if(h)setTimeout(function(){var i,w;(i=t.current)===null||i===void 0||i.start(),(w=t.current)===null||w===void 0||w.fit()},1e3);else{var d;(d=t.current)===null||d===void 0||d.close()}},width:Fe.FK,children:f&&Y&&(0,e.jsx)(_e.Z,{ref:t,showInDrawer:!0,id:"compose:log:".concat(String(f.id||f.name)),request:function(){var y=O()(m()().mark(function h(d){var i;return m()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(0,E.Yz)({id:f.id||f.name,lineTotal:d.lineTotal,download:(i=d.download)!==null&&i!==void 0?i:!1,showTime:d.showTime});case 2:case"end":return P.stop()}},h)}));return function(h){return y.apply(this,arguments)}}(),download:function(){var y=O()(m()().mark(function h(d){var i;return m()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(0,E.vf)({id:f.id||f.name,lineTotal:d.lineTotal,showTime:d.showTime,download:!0});case 2:return i=P.sent,P.abrupt("return",{data:new Blob([i],{type:"text/plain"}),name:o.composeItem.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return P.stop()}},h)}));return function(h){return y.apply(this,arguments)}}()})})]})}),nn=en,Me=n(24963),Ue=n(184),tn=n(95213),rn=n(11106),an=n(92398),sn=n(40411);function on(o){var q=(0,u.useContext)(Me.Z),W=q.message,U=(0,u.useRef)(),Y=new k.Uo("components.appCompose"),M=new k.Uo("compose");return o.composeItem.yamlList&&(0,e.jsx)(Ue.a,{drawerProps:{width:Fe.R_,destroyOnHidden:!0},title:Y.format("yamlDrawerTitle"),formRef:U,trigger:(0,e.jsx)(ie.Z.Link,{children:(0,e.jsx)(oe.Z,{title:"Yaml",children:"Yaml"})}),onFinish:function(){var Z=O()(m()().mark(function $(f){return m()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,E.im)({id:String(o.composeItem.id?o.composeItem.id:o.composeItem.name),name:o.composeItem.name,type:o.composeItem.setting.type,yaml:f.yaml,yamlOverride:f.yamlOverride});case 2:return t.next=4,(0,E.xC)({yaml:[f.yaml,f.yamlOverride],environment:o.composeItem.setting.environment,id:o.composeItem.id||o.composeItem.name});case 4:return o.onFinish&&o.onFinish(),t.abrupt("return",!0);case 6:case"end":return t.stop()}},$)}));return function($){return Z.apply(this,arguments)}}(),children:(0,e.jsx)(z.Z,{ghost:!0,children:(0,e.jsx)(an.Z,{items:o.composeItem.yamlList.map(function(Z,$){var f=[{label:M.format("createYaml"),key:"yaml"},{label:(0,e.jsx)(sn.Z,{count:Z&&k.FD.format("listInUse"),offset:[15,-5],children:M.format("createYamlOverride")}),key:"yamlOverride"}];return{label:f[$].label,key:f[$].key,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(L.Z,{hidden:!0,name:f[$].key}),(0,e.jsx)(L.Z,{shouldUpdate:!0,children:function(t){return(0,e.jsx)(rn.ZP,{onFocus:function(){if(f[$].key=="yaml"&&o.composeItem.setting.type=="remoteUrl"){W.error(M.format("createYamlDisableEdit"));return}},readOnly:f[$].key=="yaml"&&o.composeItem.setting.type=="remoteUrl",theme:"dark",minHeight:"550px",value:Z,onChange:function(h){t.setFieldValue(f[$].key,h)},extensions:[tn.RI.yaml()]})}})]})}})})})})}var ln=n(65913),De=n(1699),un=n(16970),cn=n(75544),dn=(0,u.forwardRef)(function(o,q){(0,u.useImperativeHandle)(q,function(){return{show:function(){return O()(m()().mark(function x(){var t;return m()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return $(!0),(t=U.current)===null||t===void 0||t.clear(),h.next=4,new Promise(function(d){return setTimeout(function(){var i;(i=U.current)===null||i===void 0||i.fit(),d(!0)},1e3)});case 4:case"end":return h.stop()}},x)}))()},close:function(){var x;$(!1),(x=U.current)===null||x===void 0||x.clear()}}});var W=(0,de.useModel)("subscriber"),U=(0,u.useRef)(),Y=(0,u.useState)(!1),M=C()(Y,2),Z=M[0],$=M[1];return W.addDataHandler("compose:"+o.id,function(f){var x;(x=U.current)===null||x===void 0||x.write(f.data)}),(0,e.jsx)(z.Z,{hidden:!Z,ghost:!0,title:(0,e.jsx)(Ee.Z,{}),subTitle:"Console",extra:(0,e.jsx)(_.Z,{children:(0,e.jsx)(X.Z,{action:O()(m()().mark(function f(){var x;return m()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return(x=U.current)===null||x===void 0||x.clear(),W.progress.close("compose:"+o.id),y.abrupt("return",!0);case 3:case"end":return y.stop()}},f)})),icon:(0,e.jsx)(he.Z,{}),danger:!0,onSuccess:function(){},children:k.FD.format("listManageKill")},"kill")}),children:(0,e.jsx)(cn.Z,{id:"create-log-".concat(o.id),height:"200px",style:{fontSize:12},ref:U})})}),Ae=dn,mn=(0,u.forwardRef)(function(o,q){var W=(0,u.useState)(!1),U=C()(W,2),Y=U[0],M=U[1],Z=new k.Uo("components.appCompose"),$=(0,u.useState)(),f=C()($,2),x=f[0],t=f[1],y=(0,u.useRef)(),h=(0,u.useRef)();return(0,u.useImperativeHandle)(q,function(){return{show:function(i){var w;M(!0),t(i),(w=y.current)===null||w===void 0||w.setFieldsValue({environment:i.detail.setting.environment})}}}),(0,e.jsxs)(Ue.a,{formRef:y,open:Y,drawerProps:{forceRender:!0},title:Z.format("taskDrawerTitle",{name:""}),onOpenChange:function(i){M(i)},children:[(0,e.jsx)(z.Z,{title:(0,e.jsx)(ne.Z,{}),subTitle:Z.format("managerTitle"),ghost:!0,children:x&&(0,e.jsx)(_.Z,{wrap:!0,split:(0,e.jsx)(ce.Z,{type:"vertical"}),children:(0,e.jsx)(X.Z,{icon:(0,e.jsx)(te.Z,{}),type:"primary",confirmOnOpenChange:function(i){var w;i&&(!((w=y.current)===null||w===void 0)&&w.resetFields)&&y.current.resetFields()},action:O()(m()().mark(function d(){var i,w,P;return m()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return(i=h.current)===null||i===void 0||i.show(),P=(w=y.current)===null||w===void 0?void 0:w.getFieldValue("environment"),F.next=4,(0,E.Oh)({id:x.detail.name,environment:P,autoRemove:!0});case 4:M(!1),o.onFinish&&o.onFinish(P);case 6:case"end":return F.stop()}},d)})),children:Z.format("managerCreateButton")},"create")})},"operator"),x&&(0,e.jsx)(Ae,{ref:h,id:x.detail.name}),(0,e.jsx)(z.Z,{title:Z.format("envTitle"),subTitle:Z.format("envSubTitle"),tooltip:Z.format("envTip"),ghost:!0,children:(0,e.jsx)(Ie.Z,{showCardGhost:!0,name:"environment",showDisableName:!0,requireValue:!0,showDeleteButton:!1})})]})}),fn=mn,pn=(0,u.forwardRef)(function(o,q){var W;(0,u.useImperativeHandle)(q,function(){return{show:function(l){return O()(m()().mark(function p(){var S;return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return(S=le.current)===null||S===void 0||S.close(),Z(!0),a.prev=2,a.next=5,Ve(l);case 5:a.next=12;break;case 7:a.prev=7,a.t0=a.catch(2),Z(!1),y(void 0),o.onClose&&o.onClose();case 12:case"end":return a.stop()}},p,null,[[2,7]])}))()}}});var U=(0,u.useState)(!1),Y=C()(U,2),M=Y[0],Z=Y[1],$=(0,de.useNavigate)(),f=(0,u.useState)(),x=C()(f,2),t=x[0],y=x[1],h=(0,u.useState)(),d=C()(h,2),i=d[0],w=d[1],P=(0,u.useState)(0),N=C()(P,2),F=N[0],me=N[1],ee=(0,u.useRef)(),ye=(0,u.useRef)(),se=(0,u.useRef)(),Ze=(0,u.useRef)(),le=(0,u.useRef)(),Oe=(0,u.useRef)(),hn=(0,u.useContext)(Me.Z),gn=hn.message,Pe=(0,de.useAccess)(),D=new k.Uo("components.appCompose"),yn=(0,u.useRef)();function jn(j){return Te.apply(this,arguments)}function Te(){return Te=O()(m()().mark(function j(l){var p,S,R;return m()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,(p=le.current)===null||p===void 0?void 0:p.show();case 2:if(!l.pullImageUseDPanel){v.next=6;break}return v.next=5,(S=Ze.current)===null||S===void 0?void 0:S.start();case 5:(R=Ze.current)===null||R===void 0||R.finish();case 6:return v.prev=6,v.next=9,(0,E.Oh)(l);case 9:o.onDeployFinish&&o.onDeployFinish(),v.next=15;break;case 12:v.prev=12,v.t0=v.catch(6),o.onDeployFailed&&o.onDeployFailed(t);case 15:me(F+1);case 16:case"end":return v.stop()}},j,null,[[6,12]])})),Te.apply(this,arguments)}function Ve(j){return Le.apply(this,arguments)}function Le(){return Le=O()(m()().mark(function j(l){var p,S,R,a,v,H,Q;return m()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return(p=Oe.current)===null||p===void 0||p.show(),(S=ee.current)===null||S===void 0||S.resetFields(),I.next=4,(0,E.Pn)({id:l}).finally(O()(m()().mark(function b(){var A;return m()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:(A=Oe.current)===null||A===void 0||A.destroy();case 1:case"end":return K.stop()}},b)}))).catch(function(b){throw b});case 4:R=I.sent,a=R.data.detail,a.setting.status&&a.setting.status.indexOf("running")>-1&&(a.isRunning=!0),a.setting.status&&a.setting.status.indexOf("paused")>-1&&(a.isPaused=!0),a.setting.status&&a.setting.status.indexOf("exited")>-1&&(a.isExited=!0),a.setting.status&&a.setting.status=="waiting"?a.isDeploy=!1:a.isDeploy=!0,a.setting.status&&a.setting.status.indexOf("created")>-1&&(a.isCreated=!0,a.isDeploy=!1),v=R.data.project,v&&(a.imageList=g()(new Set(Object.keys(v.services).map(function(b){var A;return(A=v.services[b].image)!==null&&A!==void 0?A:""})))),a.containerList=R.data.containerList,(!a.containerList||a.containerList.length==0)&&v&&v.services&&(a.containerList=Object.keys(v.services).map(function(b){var A;return{project:(A=v.name)!==null&&A!==void 0?A:"",name:"",service:b,publishers:v.services[b].ports?v.services[b].ports.map(function(pe){var K;return{url:"",targetPort:pe.target,publishedPort:parseInt(pe.published),protocol:(K=pe.protocol)!==null&&K!==void 0?K:""}}):[],state:"waiting",status:"",environment:v.services[b].environment}})),a.containerList&&((H=ee.current)===null||H===void 0||H.setFieldValue("deployServiceName",R.data.detail.setting.deployServiceName)),a.yamlList=R.data.yaml,y(a),w(R.data.task),R.data.yaml&&R.data.yaml.map(function(b){(0,Be.m)(b).map(function(A){a.setting.environment&&!a.setting.environment.find(function(pe){return pe.name==A.name})&&a.setting.environment.push(A)})}),R.data.detail.setting.environment&&((Q=ee.current)===null||Q===void 0||Q.setFieldValue("environment",R.data.detail.setting.environment));case 21:case"end":return I.stop()}},j)})),Le.apply(this,arguments)}return(0,u.useEffect)(function(){F>0&&t&&Ve(t.id||t.name).catch(function(j){Z(!1)})},[F]),(0,e.jsxs)(ge.Z,{width:Fe.R_,forceRender:!0,extra:t&&t.setting.type!="dangling"&&(0,e.jsxs)(_.Z,{split:(0,e.jsx)(ce.Z,{type:"vertical"}),children:[t.isDeploy&&(0,e.jsx)(nn,{composeItem:t,showTriggerButton:!0}),Pe.canSeeComposeListManage&&(0,e.jsx)(un.Z,{trigger:(0,e.jsx)(ie.Z.Link,{children:(0,e.jsx)(we.Z,{})},"network")},"network-create"),Pe.canSeeComposeListManage&&(0,e.jsx)(on,{composeItem:t,onFinish:O()(m()().mark(function j(){return m()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:gn.info(D.format("messageYamlEditFinish")),me(F+1);case 2:case"end":return p.stop()}},j)}))}),Pe.canSeeComposeListManageCreate&&(0,e.jsx)(de.Link,{to:"/compose/create?id="+(t.id||t.name),children:(0,e.jsx)(oe.Z,{title:D.format("drawerEditButtonTip"),children:(0,e.jsx)(B.Z,{})})})]}),title:(0,e.jsx)(_.Z,{children:D.format("drawerTitle",{name:(W=t==null?void 0:t.name)!==null&&W!==void 0?W:""})}),open:M,onClose:function(){Z(!1),y(void 0),o.onClose&&o.onClose()},children:[(0,e.jsx)(fn,{onFinish:function(l){var p,S,R,a=((p=ee.current)===null||p===void 0?void 0:p.getFieldFormatValue)&&((S=ee.current)===null||S===void 0?void 0:S.getFieldFormatValue("environment"));a==null||a.forEach(function(v,H){var Q=l.find(function(fe){return fe.name==v.name});Q&&(a[H].value=Q.value)}),!((R=ee.current)===null||R===void 0)&&R.setFieldValue&&ee.current.setFieldValue("environment",a)},ref:yn}),(0,e.jsx)(ln.Z,{ref:Oe,children:(0,e.jsxs)(z.Z,{direction:"column",ghost:!0,gutter:[10,10],children:[(0,e.jsxs)(z.Z,{title:(0,e.jsx)(ne.Z,{}),subTitle:D.format("managerTitle"),ghost:!0,extra:(0,e.jsx)(e.Fragment,{children:t&&t.imageList&&t.imageList.length>0&&(0,e.jsx)(r.Z,{ref:Ze,image:t.imageList})}),children:[t&&t.setting.type=="dangling"&&(0,e.jsx)(c.Z,{type:"warning",showIcon:!0,description:(0,e.jsxs)("div",{children:[D.format("managerStatusDanglingAlert",{name:t.name})," ",(0,e.jsx)("a",{href:"https://dpanel.cc/#/zh-cn/manual/compose/external",target:"_blank",children:k.FD.format("help")})]})}),t&&t.setting.type!="dangling"&&(0,e.jsxs)(_.Z,{wrap:!0,split:(0,e.jsx)(ce.Z,{type:"vertical"}),children:[(0,e.jsx)(De.u,{access:"canSeeComposeList",children:(0,e.jsx)(X.Z,{icon:(0,e.jsx)(J.Z,{}),type:"primary",confirmOnOpenChange:function(l){var p;l&&(!((p=se.current)===null||p===void 0)&&p.resetFields)&&se.current.resetFields()},confirm:(0,e.jsxs)(_.Z,{style:{width:300},direction:"vertical",children:[(0,e.jsx)(ie.Z.Text,{children:D.format("managerCreateTip")}),(0,e.jsxs)(re.A,{name:"createForm",formRef:se,layout:"inline",submitter:!1,children:[(0,e.jsx)(ae.Z.Group,{name:"pullImageUse",layout:"vertical",fieldProps:{style:{display:"flex",flexDirection:"column",gap:8}},valueEnum:{useCommand:D.format("managerCreatePullImageUseCommand"),useDPanel:D.format("managerCreatePullImageUseDPanel")}}),(0,e.jsx)(L.Z,{initialValue:!0,name:"createPath",valuePropName:"checked",children:(0,e.jsx)(s.Z,{defaultChecked:!0,children:D.format("managerCreateCreatePath")})}),(0,e.jsx)(L.Z,{initialValue:!0,name:"removeOrphans",valuePropName:"checked",children:(0,e.jsx)(s.Z,{defaultChecked:!0,children:D.format("managerCreateRemoveOrphans")})})]})]}),action:O()(m()().mark(function j(){var l,p,S,R,a,v,H,Q,fe,I,b,A;return m()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(I={id:t.id||t.name},(l=se.current)!==null&&l!==void 0&&l.getFieldValue&&((p=se.current)===null||p===void 0?void 0:p.getFieldValue("pullImageUse"))=="useDPanel"&&(I.pullImage=!1,I.pullImageUseDPanel=!0),(S=se.current)!==null&&S!==void 0&&S.getFieldValue&&((R=se.current)===null||R===void 0?void 0:R.getFieldValue("pullImageUse"))=="useCommand"&&(I.pullImage=!0),b=((a=ee.current)===null||a===void 0?void 0:a.getFieldsFormatValue)&&ee.current.getFieldsFormatValue(),I.environment=b.environment,I.deployServiceName=b.deployServiceName,I.createPath=(v=(H=se.current)===null||H===void 0?void 0:H.getFieldValue("createPath"))!==null&&v!==void 0?v:!0,I.removeOrphans=(Q=(fe=se.current)===null||fe===void 0?void 0:fe.getFieldValue("removeOrphans"))!==null&&Q!==void 0?Q:!0,!(t!=null&&t.isDeploy)){K.next=12;break}if(!((A=se.current)!==null&&A!==void 0&&A.getFieldValue("pullImageUseCommand"))){K.next=12;break}return K.next=12,(0,E.GG)({id:t.id||t.name,op:"pull"});case 12:return K.abrupt("return",jn(I));case 13:case"end":return K.stop()}},j)})),children:D.format(t.isDeploy?"managerUpgradeButton":"managerCreateButton")},"create")}),(t.isDeploy||t.isCreated)&&Pe.canSeeComposeListManage&&(0,e.jsx)(X.Z,{action:function(){var l;return(l=le.current)===null||l===void 0||l.show(),(0,E.mg)({id:t.id||t.name,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1})},onSuccess:function(){me(F+1)},type:"primary",danger:!0,confirm:"notification.confirm.title",icon:(0,e.jsx)(he.Z,{}),children:D.format("managerDeleteContainerButton")}),t.isDeploy&&(0,e.jsxs)(De.u,{access:"canSeeComposeList",space:{direction:"horizontal"},children:[(0,e.jsx)(X.Z,{icon:(0,e.jsx)(T.Z,{}),action:O()(m()().mark(function j(){var l;return m()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return(l=le.current)===null||l===void 0||l.show(),S.abrupt("return",(0,E.GG)({id:t.id||t.name,op:"restart"}));case 2:case"end":return S.stop()}},j)})),onSuccess:function(){me(F+1)},children:D.format("managerRestartButton")},"restart"),(0,e.jsx)(X.Z,{action:function(){var l;return(l=le.current)===null||l===void 0||l.show(),(0,E.GG)({id:t.id||t.name,op:"stop"})},icon:(0,e.jsx)(Se.Z,{}),disabled:t.isExited,onSuccess:function(){me(F+1)},children:D.format("managerStopButton")}),t.isPaused&&(0,e.jsx)(X.Z,{action:function(){var l;return(l=le.current)===null||l===void 0||l.show(),(0,E.GG)({id:t.id||t.name,op:"unpause"})},onSuccess:function(){me(F+1)},icon:(0,e.jsx)(te.Z,{}),children:D.format("managerUnpauseButton")}),!t.isPaused&&(0,e.jsx)(X.Z,{action:function(){var l;return(l=le.current)===null||l===void 0||l.show(),(0,E.GG)({id:t.id||t.name,op:"pause"})},onSuccess:function(){me(F+1)},icon:(0,e.jsx)(Re.Z,{}),disabled:!t.isRunning,children:D.format("managerPauseButton")})]}),t.id>0&&Pe.canSeeComposeListManageDelete&&(0,e.jsx)(X.Z,{type:"primary",action:O()(m()().mark(function j(){var l,p,S,R,a,v,H,Q;return m()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return(l=le.current)===null||l===void 0||l.show(),I.next=3,(0,E.mg)({id:(p=t==null?void 0:t.id)!==null&&p!==void 0?p:t.name,deleteImage:(S=(R=ye.current)===null||R===void 0?void 0:R.getFieldValue("deleteImage"))!==null&&S!==void 0?S:!1,deleteVolume:(a=(v=ye.current)===null||v===void 0?void 0:v.getFieldValue("deleteVolume"))!==null&&a!==void 0?a:!1,deletePath:(H=(Q=ye.current)===null||Q===void 0?void 0:Q.getFieldValue("deletePath"))!==null&&H!==void 0?H:!1,deleteData:!0});case 3:Z(!1),y(void 0),o.onClose&&o.onClose();case 6:case"end":return I.stop()}},j)})),danger:!0,onSuccess:function(){},confirmOnOpenChange:function(){var l;!((l=ye.current)===null||l===void 0)&&l.resetFields&&ye.current.resetFields()},confirm:(0,e.jsxs)(_.Z,{style:{width:240},direction:"vertical",children:[(0,e.jsx)(ie.Z.Text,{children:D.format("managerDeleteTaskTip")}),(0,e.jsxs)(re.A,{formRef:ye,layout:"inline",submitter:!1,children:[(0,e.jsx)(L.Z,{initialValue:!1,name:"deleteImage",valuePropName:"checked",children:(0,e.jsx)(s.Z,{children:D.format("managerDeleteTaskDeleteImage")})}),(0,e.jsx)(L.Z,{addonAfter:(0,e.jsx)(oe.Z,{title:D.format("managerDeleteTaskDeleteVolumeTip"),children:(0,e.jsx)(ue.Z,{})}),initialValue:!1,name:"deleteVolume",valuePropName:"checked",children:(0,e.jsx)(s.Z,{children:D.format("managerDeleteTaskDeleteVolume")})}),(0,e.jsx)(L.Z,{initialValue:!1,name:"deletePath",valuePropName:"checked",children:(0,e.jsx)(s.Z,{children:D.format("managerDeleteTaskDeletePath")})})]})]}),children:D.format("managerDeleteTaskButton")}),o.showBackListButton&&(0,e.jsx)(de.Link,{to:"/compose/list",children:(0,e.jsx)(G.ZP,{children:k.Ob.format("compose.list")})})]})]},"operator"),t&&(0,e.jsx)(Ae,{ref:le,id:t.id||t.name}),t&&(0,e.jsx)(Je,{containerList:t.containerList,enableSelectService:!t.isDeploy,selectServiceFinish:function(l){var p;(p=ee.current)===null||p===void 0||p.setFieldValue("deployServiceName",l)}}),(0,e.jsx)(De.u,{access:"canSeeComposeList",children:(0,e.jsxs)(re.A,{submitter:!1,formRef:ee,children:[(0,e.jsx)(L.Z,{name:"deployServiceName",hidden:!0}),t&&t.setting.type!="dangling"&&(0,e.jsx)(z.Z,{title:D.format("envTitle"),subTitle:D.format("envSubTitle"),tooltip:D.format("envTip"),ghost:!0,children:(0,e.jsx)(Ie.Z,{showCardGhost:!0,name:"environment",showDisableName:!0,requireValue:!0,showDeleteButton:!1})})]})})]})})]})}),vn=pn},75544:function($e,je,n){var Ce=n(5574),g=n.n(Ce),xe=n(12323),C=n(78267),V=n.n(C),m=n(75458),ve=n.n(m),O=n(67294),u=n(4244),X=n.n(u),E=n(24078),we=n(85893),B,ne,J,he=(0,O.forwardRef)(function(T,Se){var te,Re=(0,O.useState)(!0),ue=g()(Re,2),z=ue[0],re=ue[1];return(0,O.useEffect)(function(){return B=new u.Terminal(xe.X),ne=new m.SearchAddon,J=new C.FitAddon,window.addEventListener("resize",function(){T.showInModal||J.fit()}),T.style&&T.style.fontSize&&(B.options.fontSize=T.style.fontSize),B.loadAddon(J),B.loadAddon(ne),B.open(document.getElementById(T.id?T.id:"terminal-container")),T.showInModal||J.fit(),function(){B.reset(),re(!0)}},[]),(0,O.useImperativeHandle)(Se,function(){return{write:function(L){z&&(J.fit(),re(!1)),B.write(L)},clear:function(){B.clear()},getTerminal:function(){return B},findNext:function(L){ne.findNext(L)},findPrev:function(L){ne.findPrevious(L)},fit:function(){J.fit()},onData:function(L){return B.onData(L)}}}),(0,we.jsx)("div",{id:T.id?T.id:"terminal-container",style:{width:T.width?T.width:"100%",height:T.height?T.height:"500px",marginTop:(te=T.style)===null||te===void 0?void 0:te.marginTop}})});je.Z=he},90098:function($e,je,n){n.d(je,{GG:function(){return Se},MG:function(){return ae},Oh:function(){return ne},Pn:function(){return X},Yz:function(){return Re},iE:function(){return _},ik:function(){return we},im:function(){return m},mg:function(){return he},pm:function(){return O},tw:function(){return ie},vf:function(){return z},xC:function(){return de}});var Ce=n(15009),g=n.n(Ce),xe=n(99289),C=n.n(xe),V=n(82346);function m(c){return ve.apply(this,arguments)}function ve(){return ve=C()(g()().mark(function c(s){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,V.request)("/api/app/compose/create",{method:"POST",data:s}));case 1:case"end":return r.stop()}},c)})),ve.apply(this,arguments)}function O(c){return u.apply(this,arguments)}function u(){return u=C()(g()().mark(function c(s){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,V.request)("/api/app/compose/get-list",{method:"POST",data:s}));case 1:case"end":return r.stop()}},c)})),u.apply(this,arguments)}function X(c){return E.apply(this,arguments)}function E(){return E=C()(g()().mark(function c(s){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/get-task",{method:"POST",data:s}));case 2:case"end":return r.stop()}},c)})),E.apply(this,arguments)}function we(c){return B.apply(this,arguments)}function B(){return B=C()(g()().mark(function c(s){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,V.request)("/api/app/compose/delete",{method:"POST",data:s}));case 1:case"end":return r.stop()}},c)})),B.apply(this,arguments)}function ne(c){return J.apply(this,arguments)}function J(){return J=C()(g()().mark(function c(s){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/container-deploy",{method:"POST",data:s}));case 2:case"end":return r.stop()}},c)})),J.apply(this,arguments)}function he(c){return T.apply(this,arguments)}function T(){return T=C()(g()().mark(function c(s){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/container-destroy",{method:"POST",data:s}));case 2:case"end":return r.stop()}},c)})),T.apply(this,arguments)}function Se(c){return te.apply(this,arguments)}function te(){return te=C()(g()().mark(function c(s){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/container-ctrl",{method:"POST",data:s}));case 2:case"end":return r.stop()}},c)})),te.apply(this,arguments)}function Re(c){return ue.apply(this,arguments)}function ue(){return ue=C()(g()().mark(function c(s){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/container-log",{method:"POST",data:s}));case 2:case"end":return r.stop()}},c)})),ue.apply(this,arguments)}function z(c){return re.apply(this,arguments)}function re(){return re=C()(g()().mark(function c(s){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.download=!0,s.id=String(s.id),r.next=4,(0,V.request)("/api/app/compose/container-log",{method:"POST",data:s,responseType:"blob"});case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}},c)})),re.apply(this,arguments)}function ae(c){return L.apply(this,arguments)}function L(){return L=C()(g()().mark(function c(s){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,V.request)("/api/app/compose/get-from-uri",{method:"POST",data:s}));case 1:case"end":return r.stop()}},c)})),L.apply(this,arguments)}function de(c){return ge.apply(this,arguments)}function ge(){return ge=C()(g()().mark(function c(s){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/parse",{method:"POST",data:s}));case 2:case"end":return r.stop()}},c)})),ge.apply(this,arguments)}function _(c){return ce.apply(this,arguments)}function ce(){return ce=C()(g()().mark(function c(s){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,V.request)("/api/common/store/deploy",{method:"POST",data:s}));case 1:case"end":return r.stop()}},c)})),ce.apply(this,arguments)}function ie(c){return oe.apply(this,arguments)}function oe(){return oe=C()(g()().mark(function c(s){return g()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/download",{method:"POST",data:s,responseType:"blob"}));case 2:case"end":return r.stop()}},c)})),oe.apply(this,arguments)}}}]);
