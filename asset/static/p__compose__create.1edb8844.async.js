"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1102],{18477:function(xe,ie,a){a.r(ie),a.d(ie,{default:function(){return He}});var de=a(19632),m=a.n(de),pe=a(15009),h=a.n(pe),P=a(99289),V=a.n(P),R=a(5574),S=a.n(R),K=a(184),E=a(38345),O=a(5966),g=a(67294),Y=a(91058),me=a(85576),G=a(83062),k=a(14726),J=a(94668),ce=a(44349),Q=a(92067),t=a(85893),X=(0,g.forwardRef)(function(I,A){var U=(0,g.useState)(!1),M=S()(U,2),ee=M[0],T=M[1],C=(0,g.useState)(),b=S()(C,2),v=b[0],p=b[1];return(0,g.useImperativeHandle)(A,function(){return{}}),(0,t.jsxs)(E.Z,{title:"\u670D\u52A1\u4F9D\u8D56\u66FF\u6362",subTitle:"\u66FF\u6362\u540ECompose\u4E2D\u7684\u670D\u52A1\u5C06\u4E0D\u4F1A\u521B\u5EFA",headerBordered:!0,children:[(0,t.jsx)(me.Z,{title:"\u9009\u62E9\u5BB9\u5668",width:1024,footer:!1,open:ee,onCancel:function(){return T(!1)},children:(0,t.jsx)(Q.Z,{onSelect:function(F){v==null||v.setCurrentRowData({target:F.Name}),T(!1)}})}),(0,t.jsx)(ce.Z,{name:"replace",hideCopyButton:!0,hideDeleteButton:!0,items:[{label:"\u4F9D\u8D56\u670D\u52A1",name:"depend",disabled:!0},{label:"\u66FF\u6362\u670D\u52A1",name:"target",render:function(F,L,N){return(0,t.jsx)(O.Z,{label:"\u66FF\u6362\u5DF2\u6709\u5BB9\u5668",name:"target",placeholder:"\u8BF7\u9009\u62E9\u5DF2\u6709\u5BB9\u5668",addonAfter:(0,t.jsx)(G.Z,{title:"\u9009\u62E9\u66FF\u6362\u7684\u5BB9\u5668",children:(0,t.jsx)(k.ZP,{type:"primary",icon:(0,t.jsx)(J.Z,{}),onClick:function(){p(N),T(!0)}})},F.key)},F.key)}}]})]})}),fe=X,$=a(10523),he=a(82034),q=(0,g.forwardRef)(function(I,A){var U=(0,g.useState)(!1),M=S()(U,2),ee=M[0],T=M[1],C=(0,g.useRef)();return(0,g.useImperativeHandle)(A,function(){return{edit:function(v,p){var y,F,L;if(!((y=C.current)===null||y===void 0)&&y.resetFields&&((F=C.current)===null||F===void 0||F.resetFields()),(L=C.current)===null||L===void 0||L.setFieldsValue({name:v.name}),p!=null&&p.containerName){var N;(N=C.current)===null||N===void 0||N.setFieldsValue({containerName:p.containerName})}else{var te;(te=C.current)===null||te===void 0||te.setFieldsValue({containerName:v.container_name})}if(p!=null&&p.environment){var ne;(ne=C.current)===null||ne===void 0||ne.setFieldsValue({environment:p.environment})}else{var H;(H=C.current)===null||H===void 0||H.setFieldsValue({environment:v.environment&&Object.keys(v.environment).map(function(B){return{name:B,value:v.environment&&v.environment[B]?v.environment[B]:""}})})}if(p!=null&&p.ports){var j;(j=C.current)===null||j===void 0||j.setFieldsValue({ports:p.ports})}else{var ae;(ae=C.current)===null||ae===void 0||ae.setFieldsValue({ports:v.ports&&v.ports.map(function(B){return{host:B.published,dest:String(B.target)}})})}if(p!=null&&p.volumes){var re;(re=C.current)===null||re===void 0||re.setFieldsValue({volumes:p.volumes})}else{var W;(W=C.current)===null||W===void 0||W.setFieldsValue({volumes:v.volumes&&v.volumes.map(function(B){return{host:B.source,dest:B.target,permission:B.read_only?"read":"write"}})})}if(p!=null&&p.replace){var ue;(ue=C.current)===null||ue===void 0||ue.setFieldsValue({replace:p.replace})}else{var se;(se=C.current)===null||se===void 0||se.setFieldsValue({replace:v.depends_on&&Object.keys(v.depends_on).map(function(B){return{depend:B,target:""}})})}T(!0)}}}),(0,t.jsxs)(K.a,{open:ee,onOpenChange:function(v){T(v)},drawerProps:{forceRender:!0},formRef:C,title:"\u7F16\u8F91\u5BB9\u5668\u670D\u52A1",onFinish:function(){var b=V()(h()().mark(function v(p){return h()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return I.onFinish&&I.onFinish(p),F.abrupt("return",!0);case 2:case"end":return F.stop()}},v)}));return function(v){return b.apply(this,arguments)}}(),children:[(0,t.jsxs)(E.Z,{children:[(0,t.jsx)(O.Z,{label:"\u670D\u52A1\u540D\u79F0",name:"name",disabled:!0}),(0,t.jsx)(O.Z,{label:"\u5BB9\u5668\u540D\u79F0",name:"containerName",tooltip:"\u6307\u5B9A\u5BB9\u5668\u540D\u79F0\u540E\uFF0C\u65E0\u6CD5\u591A\u6B21\u90E8\u7F72\u3002\u4E3A\u7A7A\u65F6\u7531 compose \u81EA\u52A8\u751F\u6210"})]}),(0,t.jsx)(he.Z,{showInDrawer:!0}),(0,t.jsx)(Y.Z,{showAddButton:!0,showInDrawer:!0,showImportButton:!0}),(0,t.jsx)($.Z,{showInDrawer:!0}),(0,t.jsx)(fe,{})]},"create")}),ve=q,_=a(89063),ge=a(24963),w=a(90098),s=a(45742),c=a(87462),Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},e=Z,Fe=a(84089),Pe=function(A,U){return g.createElement(Fe.Z,(0,c.Z)({},A,{ref:U,icon:e}))},Be=g.forwardRef(Pe),Ze=Be,Oe=a(27496),Se=a(43425),Ae=a(90078),Ee=a(97269),we=a(2236),Te=a(62370),be=a(86615),De=a(97462),Ve=a(90672),Ie=a(95213),Ue=a(95089),ye=a(54006),Me=a(63490),Ce=a(42075),Le=a(66309),Ne=a(96074),Ge=a(91845);function He(){var I=(0,g.useContext)(ge.Z),A=I.loading,U=I.notice,M=(0,ye.useNavigate)(),ee=(0,g.useState)([]),T=S()(ee,2),C=T[0],b=T[1],v=(0,g.useRef)(),p=(0,g.useRef)(),y=(0,g.useRef)(),F=(0,ye.useSearchParams)(),L=S()(F,2),N=L[0],te=L[1],ne=(0,g.useState)(),H=S()(ne,2),j=H[0],ae=H[1],re=(0,g.useState)("text"),W=S()(re,2),ue=W[0],se=W[1],B=(0,g.useState)(""),je=S()(B,2),We=je[0],ze=je[1],le=function(){var x=V()(h()().mark(function r(n){var l,u;return h()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(n.yaml){i.next=2;break}return i.abrupt("return");case 2:return(l=y.current)===null||l===void 0||l.setFieldValue("yaml",n.yaml),n.disableSetYaml||ze(n.yaml),i.next=6,(0,w.xC)({yaml:n.yaml});case 6:if(u=i.sent,!(!u||!u.data||!u.data.project)){i.next=10;break}return U.error(u.data.error),i.abrupt("return");case 10:u.data.project&&b(Object.keys(u.data.project.services).map(function(d,z){var f=u.data.project.services[d];if(n.override&&n.override[d]){var oe=n.override[d];oe.ports&&(f.ports=oe.ports.map(function(D){return{target:parseInt(D.dest),published:D.host}})),oe.replace&&oe.replace.map(function(D){f.depends_on&&f.depends_on[D.depend]&&D.target&&(f.depends_on["".concat(D.target,":").concat(D.depend)]=f.depends_on[D.depend],delete f.depends_on[D.depend])})}return f.name=d,f}));case 11:case"end":return i.stop()}},r)}));return function(n){return x.apply(this,arguments)}}();return(0,g.useEffect)(function(){var x=N.get("id");x&&(A.show(),(0,w.CT)({id:parseInt(x)}).then(function(r){var n;if(ae(r.data.detail),se(r.data.detail.setting.type),r.data.detail.setting.type==""&&(r.data.detail.setting.type="text"),(n=y.current)===null||n===void 0||n.setFieldsValue({name:r.data.detail.name,title:r.data.detail.title,type:r.data.detail.setting.type,yaml:r.data.detail.yaml,override:r.data.detail.setting.override}),r.data.detail.setting.type=="remoteUrl"){var l;(l=y.current)===null||l===void 0||l.setFieldValue("remoteUrl",r.data.detail.setting.uri[0])}else if(r.data.detail.setting.type=="serverPath"){var u;(u=y.current)===null||u===void 0||u.setFieldValue("serverPath",r.data.detail.setting.uri[0])}else if(r.data.detail.setting.type=="storagePath"){var o;(o=y.current)===null||o===void 0||o.setFieldValue("storagePath","/dpanel/compose/"+r.data.detail.setting.uri[0])}le({yaml:r.data.detail.yaml,override:r.data.detail.setting.override})}).finally(function(){A.destroy()}))},[]),(0,t.jsx)(Ae._z,{header:{extra:[(0,t.jsx)(ye.Link,{to:"/compose/create",reloadDocument:location.search.length>0,children:(0,t.jsx)(k.ZP,{type:"primary",children:"\u521B\u5EFA\u4EFB\u52A1"},"createCompose")},"create")]},children:(0,t.jsx)(Ee.A,{submitter:{render:function(r,n){return(0,t.jsx)(we.S,{children:n})}},formRef:y,onFinish:function(){var x=V()(h()().mark(function r(n){var l,u,o;return h()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return l={type:n.type,name:n.name,title:n.title,override:n.override},j!=null&&j.id&&(l.id=j.id),n.type=="text"?l.yaml=n.yaml:n.type=="remoteUrl"?l.remoteUrl=n.remoteUrl:n.type=="serverPath"?(l.serverPath=n.serverPath,l.yaml=n.yaml):n.type=="storagePath"&&(l.yaml=n.yaml),d.next=5,(0,w.im)(l);case 5:if(u=d.sent,!u.data.id){d.next=10;break}return(o=y.current)===null||o===void 0||o.resetFields(),M("/compose/deploy/"+u.data.id),d.abrupt("return",!0);case 10:return d.abrupt("return",!1);case 11:case"end":return d.stop()}},r)}));return function(r){return x.apply(this,arguments)}}(),children:(0,t.jsxs)(E.Z,{split:"vertical",children:[(0,t.jsxs)(E.Z,{split:"horizontal",colSpan:"55%",children:[(0,t.jsxs)(E.Z,{title:(0,t.jsx)(s.Z,{}),subTitle:"\u57FA\u7840\u4FE1\u606F",children:[(0,t.jsx)(O.Z,{label:"\u7AD9\u70B9\u540D\u79F0",name:"title",fieldProps:{onChange:function(r){var n="";if(r.target.value&&!j){var l,u=(0,Ge.N9)(r.target.value.trim(),{toneType:"none",type:"array"});n=u.join(""),(l=y.current)===null||l===void 0||l.setFieldValue("name",n)}}}}),(0,t.jsx)(O.Z,{label:"\u7AD9\u70B9\u6807\u8BC6",name:"name",required:!0,rules:[{required:!0}],disabled:!!j,placeholder:"\u6807\u8BC6Compose\u521B\u5EFA\u7684\u5BB9\u5668\u7EC4\uFF0C\u53EA\u5141\u8BB8\u4E3A\u82F1\u6587\u6216\u662F\u6570\u5B57"}),(0,t.jsx)(Te.Z,{name:"override"}),(0,t.jsx)(be.Z.Group,{label:"Yaml \u6765\u6E90",name:"type",initialValue:"text",fieldProps:{defaultValue:"text",onChange:function(){}},options:[{label:"yaml",value:"text",disabled:(j==null?void 0:j.setting.type)=="storagePath"},{label:"\u8FDC\u7A0B\u5730\u5740",value:"remoteUrl",disabled:(j==null?void 0:j.setting.type)=="storagePath"},{label:"\u9762\u677F\u5BB9\u5668\u5185\u8DEF\u5F84",value:"serverPath",disabled:(j==null?void 0:j.setting.type)=="storagePath"},{label:"\u81EA\u52A8\u53D1\u73B0",value:"storagePath"}]}),(0,t.jsx)(De.Z,{name:["type"],children:function(r){var n=r.type;if(n=="text")return(0,t.jsx)(_.Z,{title:"\u5BFC\u5165\u672C\u5730 compose \u6587\u4EF6",onImport:function(u){return le({yaml:u}),!0},onLoad:function(u){if(u.indexOf("services:")<0)throw new Error("\u5BFC\u5165\u7684compose\u6587\u4EF6\u9519\u8BEF");return!0}});if(n=="remoteUrl")return(0,t.jsx)(O.Z,{label:"",required:!0,rules:[{required:!0}],name:"remoteUrl",placeholder:"\u8BF7\u8F93\u5165\u8FDC\u7A0B docker-compose.yaml \u94FE\u63A5",fieldProps:{onBlur:function(){var l=V()(h()().mark(function o(i){var d;return h()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(i.target.value){f.next=2;break}return f.abrupt("return");case 2:return A.show(),f.next=5,(0,w.MG)({uri:i.target.value});case 5:d=f.sent,A.destroy(),d&&d.data&&d.data.content&&le({yaml:d.data.content});case 8:case"end":return f.stop()}},o)}));function u(o){return l.apply(this,arguments)}return u}()}});if(n=="serverPath")return(0,t.jsx)(O.Z,{label:"",required:!0,rules:[{required:!0}],name:"serverPath",placeholder:"\u8BF7\u6307\u5B9A\u9762\u677F\u5BB9\u5668\u5185\u7684\u76EE\u5F55\uFF0C\u5BBF\u4E3B\u673A\u76EE\u5F55\u9700\u8981\u5148\u6302\u8F7D\u5230\u9762\u677F\u5BB9\u5668\u4E2D",initialValue:"",fieldProps:{onBlur:function(){var l=V()(h()().mark(function o(i){var d;return h()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(i.target.value){f.next=2;break}return f.abrupt("return");case 2:return f.next=4,(0,w.MG)({uri:i.target.value});case 4:d=f.sent,d&&d.data&&d.data.content&&le({yaml:d.data.content});case 6:case"end":return f.stop()}},o)}));function u(o){return l.apply(this,arguments)}return u}()}});if(n=="storagePath")return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(O.Z,{name:"storagePath",required:!0,disabled:!0,placeholder:"\u6302\u8F7D /dpanel/compose \u76EE\u5F55\u540E\uFF0C\u81EA\u52A8\u53D1\u73B0\u3002",rules:[{required:!0,message:"\u6302\u8F7D /dpanel/compose \u76EE\u5F55\u540E\uFF0C\u81EA\u52A8\u53D1\u73B0\u3002"}]})})}})]}),(0,t.jsx)(ve,{ref:p,onFinish:function(r){var n,l,u=(n=y.current)===null||n===void 0?void 0:n.getFieldValue("override");u||(u={}),u[r.name]=r,b(m()(C.map(function(o){return o.name==r.name&&(r.ports&&(o.ports=r.ports.map(function(i){return{target:parseInt(i.dest),published:i.host}})),r.replace&&r.replace.map(function(i){o.depends_on&&o.depends_on[i.depend]&&i.target&&(o.depends_on["".concat(i.target,":").concat(i.depend)]=o.depends_on[i.depend],delete o.depends_on[i.depend])})),o}))),(l=y.current)===null||l===void 0||l.setFieldValue("override",u)}}),(0,t.jsx)(E.Z,{title:(0,t.jsx)(Ze,{}),subTitle:"\u670D\u52A1\u5217\u8868",children:(0,t.jsx)(Me.Z,{dataSource:C,rowKey:"name",pagination:!1,columns:[{title:"\u540D\u79F0",dataIndex:"name"},{title:"\u955C\u50CF",dataIndex:"image"},{title:"\u7AEF\u53E3",dataIndex:"ports",render:function(r,n,l){return n.ports&&n.ports.map(function(u,o){return(0,t.jsx)(Ce.Z,{size:"large",wrap:!0,children:(0,t.jsxs)(Le.Z,{color:"#2db7f5",icon:u.published?(0,t.jsx)(Oe.Z,{}):"",style:{marginBottom:5},children:[u.published," : ",u.target]})},"space".concat(o))})}},{title:"\u4F9D\u8D56",dataIndex:"dependsOn",width:150,render:function(r,n,l){if(n.depends_on)return(0,t.jsx)(Ce.Z,{wrap:!0,children:Object.keys(n.depends_on).map(function(u){var o=u;return n.external_links&&n.external_links.map(function(i){i.indexOf(":"+u)>-1&&(o=i)}),o})})}},{title:"\u64CD\u4F5C",width:80,render:function(r,n,l){return(0,t.jsx)(Ce.Z,{split:(0,t.jsx)(Ne.Z,{type:"vertical"}),children:(0,t.jsx)(k.ZP,{type:"link",onClick:function(){var o,i=(o=y.current)===null||o===void 0?void 0:o.getFieldValue("override");if(i&&i[n.name]){var d;(d=p.current)===null||d===void 0||d.edit(n,i[n.name])}else{var z;(z=p.current)===null||z===void 0||z.edit(n)}return!1},children:(0,t.jsx)(G.Z,{title:"\u7F16\u8F91\u670D\u52A1",children:(0,t.jsx)(Se.Z,{})})},"manage")})}}]})})]}),(0,t.jsxs)(E.Z,{title:(0,t.jsx)(s.Z,{}),subTitle:"compose.yaml",children:[(0,t.jsx)(Ve.Z,{name:"yaml",hidden:!0}),(0,t.jsx)(Ue.ZP,{theme:"dark",minHeight:"550px",onChange:function(r,n){var l;(l=y.current)===null||l===void 0||l.setFieldValue("yaml",r)},onBlur:function(){var r;le({yaml:(r=y.current)===null||r===void 0?void 0:r.getFieldValue("yaml"),disableSetYaml:!0})},readOnly:ue=="remoteUrl",value:We,extensions:[Ie.RI.yaml()]})]})]})},"create")})}},90098:function(xe,ie,a){a.d(ie,{CT:function(){return g},GG:function(){return t},MG:function(){return ve},Oh:function(){return k},Pn:function(){return E},U_:function(){return he},VN:function(){return fe},ik:function(){return me},im:function(){return V},mg:function(){return ce},pm:function(){return S},xC:function(){return ge}});var de=a(15009),m=a.n(de),pe=a(99289),h=a.n(pe),P=a(54006);function V(s){return R.apply(this,arguments)}function R(){return R=h()(m()().mark(function s(c){return m()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/app/compose/create",{method:"POST",data:c}));case 1:case"end":return e.stop()}},s)})),R.apply(this,arguments)}function S(s){return K.apply(this,arguments)}function K(){return K=h()(m()().mark(function s(c){return m()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/app/compose/get-list",{method:"POST",data:c}));case 1:case"end":return e.stop()}},s)})),K.apply(this,arguments)}function E(s){return O.apply(this,arguments)}function O(){return O=h()(m()().mark(function s(c){return m()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/app/compose/get-task",{method:"POST",data:c}));case 1:case"end":return e.stop()}},s)})),O.apply(this,arguments)}function g(s){return Y.apply(this,arguments)}function Y(){return Y=h()(m()().mark(function s(c){return m()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/app/compose/get-detail",{method:"POST",data:c}));case 1:case"end":return e.stop()}},s)})),Y.apply(this,arguments)}function me(s){return G.apply(this,arguments)}function G(){return G=h()(m()().mark(function s(c){return m()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/app/compose/delete",{method:"POST",data:c}));case 1:case"end":return e.stop()}},s)})),G.apply(this,arguments)}function k(s){return J.apply(this,arguments)}function J(){return J=h()(m()().mark(function s(c){return m()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/app/compose/container-deploy",{method:"POST",data:c}));case 1:case"end":return e.stop()}},s)})),J.apply(this,arguments)}function ce(s){return Q.apply(this,arguments)}function Q(){return Q=h()(m()().mark(function s(c){return m()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/app/compose/container-destroy",{method:"POST",data:c}));case 1:case"end":return e.stop()}},s)})),Q.apply(this,arguments)}function t(s){return X.apply(this,arguments)}function X(){return X=h()(m()().mark(function s(c){return m()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/app/compose/container-ctrl",{method:"POST",data:c}));case 1:case"end":return e.stop()}},s)})),X.apply(this,arguments)}function fe(s){return $.apply(this,arguments)}function $(){return $=h()(m()().mark(function s(c){return m()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/app/compose/container-log",{method:"POST",data:c}));case 1:case"end":return e.stop()}},s)})),$.apply(this,arguments)}function he(s){return q.apply(this,arguments)}function q(){return q=h()(m()().mark(function s(c){return m()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/app/compose/container-process-kill",{method:"POST",data:c}));case 1:case"end":return e.stop()}},s)})),q.apply(this,arguments)}function ve(s){return _.apply(this,arguments)}function _(){return _=h()(m()().mark(function s(c){return m()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/app/compose/get-from-uri",{method:"POST",data:c}));case 1:case"end":return e.stop()}},s)})),_.apply(this,arguments)}function ge(s){return w.apply(this,arguments)}function w(){return w=h()(m()().mark(function s(c){return m()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,P.request)("/api/app/compose/parse",{method:"POST",data:c}));case 1:case"end":return e.stop()}},s)})),w.apply(this,arguments)}}}]);
