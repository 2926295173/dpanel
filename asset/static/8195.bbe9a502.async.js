"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8195],{57546:function(A,f,e){e.d(f,{Z:function(){return d}});var _=e(87462),l=e(67294),E={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"},m=E,h=e(84089),v=function(p,O){return l.createElement(h.Z,(0,_.Z)({},p,{ref:O,icon:m}))},T=l.forwardRef(v),d=T},31199:function(A,f,e){var _=e(1413),l=e(45987),E=e(67294),m=e(40284),h=e(85893),v=["fieldProps","min","proFieldProps","max"],T=function(p,O){var C=p.fieldProps,u=p.min,s=p.proFieldProps,j=p.max,n=(0,l.Z)(p,v);return(0,h.jsx)(m.Z,(0,_.Z)({valueType:"digit",fieldProps:(0,_.Z)({min:u,max:j},C),ref:O,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:s},n))},d=E.forwardRef(T);f.Z=d},86615:function(A,f,e){var _=e(1413),l=e(45987),E=e(22270),m=e(78045),h=e(67294),v=e(90789),T=e(40284),d=e(85893),P=["fieldProps","options","radioType","layout","proFieldProps","valueEnum"],p=h.forwardRef(function(s,j){var n=s.fieldProps,b=s.options,S=s.radioType,Z=s.layout,W=s.proFieldProps,B=s.valueEnum,g=(0,l.Z)(s,P);return(0,d.jsx)(T.Z,(0,_.Z)((0,_.Z)({valueType:S==="button"?"radioButton":"radio",ref:j,valueEnum:(0,E.h)(B,void 0)},g),{},{fieldProps:(0,_.Z)({options:b,layout:Z},n),proFieldProps:W,filedConfig:{customLightMode:!0}}))}),O=h.forwardRef(function(s,j){var n=s.fieldProps,b=s.children;return(0,d.jsx)(m.ZP,(0,_.Z)((0,_.Z)({},n),{},{ref:j,children:b}))}),C=(0,v.G)(O,{valuePropName:"checked",ignoreWidth:!0}),u=C;u.Group=p,u.Button=m.ZP.Button,u.displayName="ProFormComponent",f.Z=u},52688:function(A,f,e){var _=e(1413),l=e(45987),E=e(67294),m=e(40284),h=e(85893),v=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],T=E.forwardRef(function(d,P){var p=d.fieldProps,O=d.unCheckedChildren,C=d.checkedChildren,u=d.proFieldProps,s=(0,l.Z)(d,v);return(0,h.jsx)(m.Z,(0,_.Z)({valueType:"switch",fieldProps:(0,_.Z)({unCheckedChildren:O,checkedChildren:C},p),ref:P,valuePropName:"checked",proFieldProps:u,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},s))});f.Z=T},90672:function(A,f,e){var _=e(1413),l=e(45987),E=e(67294),m=e(40284),h=e(85893),v=["fieldProps","proFieldProps"],T=function(P,p){var O=P.fieldProps,C=P.proFieldProps,u=(0,l.Z)(P,v);return(0,h.jsx)(m.Z,(0,_.Z)({ref:p,valueType:"textarea",fieldProps:O,proFieldProps:C},u))};f.Z=E.forwardRef(T)},75293:function(A,f,e){e.d(f,{Z:function(){return E}});var _=e(25593),l=e(85893);function E(m){return(0,l.jsx)(_.Z.Text,{copyable:!0,style:{padding:10,display:m.block?"block":"",background:"#24292f",color:"#ffffff"},children:m.content})}},77273:function(A,f,e){var _=e(15009),l=e.n(_),E=e(99289),m=e.n(E),h=e(5574),v=e.n(h),T=e(184),d=e(5966),P=e(86615),p=e(97462),O=e(64317),C=e(52688),u=e(62370),s=e(38345),j=e(31199),n=e(90672),b=e(71230),S=e(15746),Z=e(42075),W=e(86250),B=e(40056),g=e(67294),J=e(91845),N=e(87662),F=e(12491),z=e(89035),$=e(36146),G=e(3616),Q=e(75293),V=e(2831),r=e(85893),Y=(0,g.forwardRef)(function(x,X){var H;(0,g.useImperativeHandle)(X,function(){return{edit:function(o){var t,c=o.address.split("://"),M=v()(c,2),L=M[0],U=M[1];(t=I.current)===null||t===void 0||t.setFieldsValue({name:o.name,title:o.title,addressType:"".concat(L=="ssh"?"tcp":L,"://"),address:U,serverUrl:o.serverUrl,enableTLS:o.enableTLS,tlsCa:o.tlsCa,tlsCert:o.tlsCert,tlsKey:o.tlsKey,enableComposePath:o.enableComposePath,enableSSH:o.enableSSH,sshServerInfo:o.sshServerInfo,remoteType:o.remoteType?o.remoteType:"docker"}),re(!0),oe(o.name)}}}),(0,g.useEffect)(function(){(0,V.aF)().then(function(y){y.data.rsa.public&&q(y.data.rsa.public)})},[]);var k=(0,g.useState)(),w=v()(k,2),K=w[0],q=w[1],a=new $.Uo("components.dockerEnvCreate"),se=(0,g.useState)(!1),ee=v()(se,2),ae=ee[0],re=ee[1],I=(0,g.useRef)(),le=(0,g.useState)(""),ne=v()(le,2),te=ne[0],oe=ne[1];return(0,r.jsxs)(T.a,{drawerProps:{forceRender:!0,width:G.R_},onOpenChange:function(o){if(!o){var t;oe(""),(t=I.current)===null||t===void 0||t.resetFields()}re(o)},open:ae,width:800,trigger:x.trigger,formRef:I,title:a.format((H=I.current)!==null&&H!==void 0&&H.getFieldValue&&I.current.getFieldValue("name")=="local"?"drawerTitleDefault":"drawerTitle"),onFinish:function(){var y=m()(l()().mark(function o(t){var c,M,L,U;return l()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return M="",t.remoteType&&t.remoteType=="ssh"?M="ssh://":M=(L=t.addressType)!==null&&L!==void 0?L:"unix://",i.next=4,(0,N.ad)({name:t.name,title:t.title,address:"".concat(M).concat((c=t.address)!==null&&c!==void 0?c:t.sshServerInfo.address),serverUrl:t.serverUrl,enableTLS:t.enableTLS,tlsCa:t.tlsCa,tlsCert:t.tlsCert,tlsKey:t.tlsKey,enableComposePath:t.enableComposePath,composePath:t.enableComposePath?t.composePath:"",enableSSH:t.enableSSH||t.remoteType=="ssh",sshServerInfo:t.sshServerInfo,remoteType:t.remoteType});case 4:return U=i.sent,x.onFinish&&x.onFinish(),i.abrupt("return",!0);case 7:case"end":return i.stop()}},o)}));return function(o){return y.apply(this,arguments)}}(),children:[(0,r.jsx)(d.Z,{label:a.format("formTitle"),name:"title",required:!0,rules:[{required:!0}],fieldProps:{id:"envTitle",onChange:function(o){var t="";if(o.target.value&&!te){var c,M=(0,J.N9)(o.target.value.trim(),{toneType:"none",type:"array"});t=M.join(""),(c=I.current)===null||c===void 0||c.setFieldValue("name",t)}}}},"envTitle"),(0,r.jsx)(d.Z,{label:a.format("formName"),name:"name",required:!0,disabled:te!="",rules:[{required:!0}],placeholder:a.format("formNameEmpty")}),(0,r.jsx)(d.Z,{tooltip:a.format("formServerUrlTip"),label:a.format("formServerUrl"),name:"serverUrl",placeholder:a.format("formServerUrlEmpty")}),(0,r.jsx)(P.Z.Group,{label:a.format("formRemoteType"),name:"remoteType",options:[{label:"DockerApi",value:"docker"},{label:"SSH",value:"ssh"}]}),(0,r.jsx)(p.Z,{name:["remoteType","name"],children:function(o){var t=o.remoteType,c=o.name;return(0,r.jsxs)(r.Fragment,{children:[t=="docker"&&(0,r.jsx)(b.Z,{children:(0,r.jsx)(S.Z,{span:24,children:(0,r.jsxs)(Z.Z.Compact,{children:[(0,r.jsx)(O.Z,{name:"addressType",label:a.format("formAddressType"),valueEnum:{"unix://":"unix://","tcp://":"tcp://"},initialValue:"tcp://",fieldProps:{defaultValue:"tcp://"},width:"sm",tooltip:a.format("formAddressTypeTip")}),(0,r.jsx)(d.Z,{label:" ",name:"address",required:!0,width:"xl",rules:[{required:!0}],placeholder:a.format("formAddressEmpty")})]})})}),(0,r.jsxs)(b.Z,{gutter:[15,0],children:[t=="docker"&&(0,r.jsx)(S.Z,{children:(0,r.jsx)(C.Z,{label:a.format("formEnableTLS"),name:"enableTLS",tooltip:a.format("formEnableTLSTip")})}),c!="local"&&typeof t!="undefined"&&(0,r.jsx)(S.Z,{children:(0,r.jsx)(C.Z,{label:a.format("formEnableComposePath"),name:"enableComposePath",tooltip:a.format("formEnableComposePathTip")})}),t=="docker"&&(0,r.jsx)(S.Z,{children:(0,r.jsx)(C.Z,{label:a.format("formEnableSSH"),name:"enableSSH"})})]})]})}}),(0,r.jsx)(p.Z,{name:["enableTLS","remoteType"],children:function(o){var t=o.enableTLS,c=o.remoteType;if(t&&c=="docker"){var M,L,U;return(0,r.jsxs)(W.Z,{gap:10,justify:"start",children:[(0,r.jsx)(u.Z,{name:"tlsCa",label:a.format("formTlsCa"),children:(0,r.jsx)(F.Z,{showPaset:!0,data:(M=I.current)===null||M===void 0?void 0:M.getFieldValue("tlsCa"),title:"ca.pem",onImport:function(i){var R;return(R=I.current)===null||R===void 0||R.setFieldValue("tlsCa",i),!0},onLoad:function(i){if(i.indexOf("CERTIFICATE")<0)throw new Error(a.format("formEnableTLSMessageUploadError",{name:"ca.pem"}));return!0}})}),(0,r.jsx)(u.Z,{name:"tlsCert",label:" ",children:(0,r.jsx)(F.Z,{showPaset:!0,data:(L=I.current)===null||L===void 0?void 0:L.getFieldValue("tlsCert"),title:"cert.pem",onImport:function(i){var R;return(R=I.current)===null||R===void 0||R.setFieldValue("tlsCert",i),!0},onLoad:function(i){if(i.indexOf("CERTIFICATE")<0)throw new Error(a.format("formEnableTLSMessageUploadError",{name:"cert.pem"}));return!0}})}),(0,r.jsx)(u.Z,{label:" ",name:"tlsKey",children:(0,r.jsx)(F.Z,{showPaset:!0,data:(U=I.current)===null||U===void 0?void 0:U.getFieldValue("tlsKey"),title:"key.pem",onImport:function(i){var R;return(R=I.current)===null||R===void 0||R.setFieldValue("tlsKey",i),!0},onLoad:function(i){if(i.indexOf("PRIVATE")<0)throw new Error(a.format("formEnableTLSMessageUploadError",{name:"key.pem"}));return!0}})})]})}}}),(0,r.jsx)(p.Z,{name:["enableComposePath","name"],children:function(o){var t=o.enableComposePath,c=o.name;if(t)return(0,r.jsx)(d.Z,{label:a.format("formComposePath"),name:"composePath",disabled:!0,fieldProps:{value:"/dpanel/compose/compose-".concat(c!=null?c:"")}})}}),(0,r.jsx)(p.Z,{name:["enableSSH","sshServerInfo","remoteType","address"],children:function(o){var t=o.enableSSH,c=o.sshServerInfo,M=o.remoteType,L=o.address;return(t||M=="ssh")&&[(0,r.jsxs)(s.Z,{title:(0,r.jsx)(z.Z,{}),subTitle:a.format("formEnableSSHTitle"),ghost:!0,children:[(0,r.jsxs)(r.Fragment,{children:[M=="ssh"&&(0,r.jsx)(u.Z,{children:(0,r.jsx)(B.Z,{message:(0,r.jsxs)(r.Fragment,{children:[a.format("formEnableSSHAlert")," \xA0",(0,r.jsx)("a",{href:"https://dpanel.cc/manual/system-env#ssh",target:"_blank",children:$.FD.format("help")})]})})}),(0,r.jsx)(d.Z,{label:a.format("formSshServerInfoAddress"),placeholder:a.format("formSshServerInfoAddressEmpty"),name:["sshServerInfo","address"],required:!0,rules:[{required:!0}]})]}),(0,r.jsxs)(b.Z,{children:[(0,r.jsx)(S.Z,{children:(0,r.jsx)(j.Z,{initialValue:22,label:a.format("formSshServerInfoPort"),name:["sshServerInfo","port"]})}),(0,r.jsx)(S.Z,{offset:2,children:(0,r.jsx)(d.Z,{width:"lg",label:a.format("formSshServerInfoUsername"),name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]})})]}),(0,r.jsx)(P.Z.Group,{label:a.format("formSshServerInfoAuthType"),name:["sshServerInfo","authType"],options:a.option("formSshServerInfoAuthTypeOption",["basic","pem","pemDefault"]),fieldProps:{onChange:function(){var D;(D=I.current)===null||D===void 0||D.setFieldValue(["sshServerInfo","password"],"")}},required:!0,rules:[{required:!0}]}),c&&c.authType=="basic"&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(d.Z.Password,{label:a.format("formSshServerInfoPassword"),name:["sshServerInfo","password"],required:!0,rules:[{required:!0}]})}),c&&c.authType=="pem"&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.Z,{title:a.format("formSshServerInfoPrivateKeyImport"),onImport:function(D){var i;return(i=I.current)===null||i===void 0||i.setFieldValue(["sshServerInfo","privateKey"],D),!0},onLoad:function(D){if(!D.includes("PRIVATE KEY"))throw new Error(a.format("formEnableTLSMessageUploadError",{name:"private.key"}));return!0}}),(0,r.jsx)(n.Z,{name:["sshServerInfo","privateKey"],label:a.format("formSshServerInfoPrivateKey"),required:!0,rules:[{required:!0}]}),(0,r.jsx)(d.Z.Password,{name:["sshServerInfo","password"],label:a.format("formSshServerInfoPrivateKeyPassword")})]}),c&&c.authType=="pemDefault"&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(p.Z,{name:["sshServerInfo"],children:function(D){var i=D.sshServerInfo;if(!(!i||!i.username))return[(0,r.jsx)(B.Z,{message:a.format("formSshServerInfoAddPublicKey",{user:i.username}),style:{marginBottom:15}},"message"),K&&(0,r.jsx)(Q.Z,{content:'mkdir -p ~/.ssh && chmod 700 ~/.ssh && ! grep -q "'.concat(K.substring(K.length/2,K.length/2+18),`" ~/.ssh/authorized_keys 2>/dev/null && echo "
`).concat(K,'" >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys'),block:!0},"copycode")]}})})]},"sshSetting")]}})]})});f.Z=Y},12491:function(A,f,e){e.d(f,{Z:function(){return j}});var _=e(5574),l=e.n(_),E=e(3616),m=e(24963),h=e(36146),v=e(88484),T=e(57546),d=e(62370),P=e(11106),p=e(42075),O=e(83622),C=e(85576),u=e(67294),s=e(85893);function j(n){var b=(0,u.useContext)(m.Z),S=b.message,Z=b.notice,W=(0,u.useRef)(null),B=(0,u.useState)(!1),g=l()(B,2),J=g[0],N=g[1],F=(0,u.useState)(""),z=l()(F,2),$=z[0],G=z[1];(0,u.useEffect)(function(){n.data&&G(n.data)},[n.data]);var Q=function(){W.current&&(W.current.click(),W.current.onchange=function(r){if(!r||!r.target)return"";var Y=new FileReader;Y.onload=function(H){var k,w,K=(k=H.target)===null||k===void 0?void 0:k.result;if(n.onLoad)try{n.onLoad&&n.onLoad(K)}catch(q){Z.error(q);return}G(K),typeof n.onImport=="function"&&(S.success(h.FD.format("finish")),n.onImport(K)),(w=W.current)!==null&&w!==void 0&&w.value&&(W.current.value="")};var x=r.target;if(x.files&&x.files[0]){var X=x.files[0];try{Y.readAsText(X)}catch(H){Z.error(h.FD.format("commonContentIncorrectFormat",{name:x.files[0].name}))}}})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Z,{children:(0,s.jsxs)(p.Z.Compact,{block:!0,children:[(0,s.jsx)(O.ZP,{icon:(0,s.jsx)(v.Z,{}),block:!0,onClick:Q,children:n.title}),n.showPaset&&(0,s.jsx)(O.ZP,{icon:(0,s.jsx)(T.Z,{}),onClick:function(){N(!0)}})]})}),(0,s.jsx)("input",{style:{display:"none"},type:"file",ref:W,name:"importFileInput"}),(0,s.jsx)(C.Z,{width:E.ob,open:J,onCancel:function(){N(!1)},onOk:function(){typeof n.onImport=="function"&&(S.success(h.FD.format("finish")),n.onImport($)),N(!1)},children:(0,s.jsx)(P.ZP,{height:E.Ed,theme:"dark",value:$,onChange:function(r){G(r)}})})]})}},3616:function(A,f,e){e.d(f,{Ed:function(){return m},FK:function(){return l},R_:function(){return _},ob:function(){return E}});var _=window.innerWidth<=1024?"90vw":"65vw",l="90vw",E="60vw",m="50vh"},24963:function(A,f,e){var _=e(67294),l=(0,_.createContext)({});f.Z=l},2831:function(A,f,e){e.d(f,{Ll:function(){return p},aF:function(){return v},d6:function(){return C},u5:function(){return d}});var _=e(15009),l=e.n(_),E=e(99289),m=e.n(E),h=e(82346);function v(){return T.apply(this,arguments)}function T(){return T=m()(l()().mark(function s(){return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,h.request)("/api/common/home/info",{method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},s)})),T.apply(this,arguments)}function d(){return P.apply(this,arguments)}function P(){return P=m()(l()().mark(function s(){return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,h.request)("/api/common/home/check-new-version",{method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},s)})),P.apply(this,arguments)}function p(){return O.apply(this,arguments)}function O(){return O=m()(l()().mark(function s(){return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,h.request)("/api/common/home/usage",{method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},s)})),O.apply(this,arguments)}function C(){return u.apply(this,arguments)}function u(){return u=m()(l()().mark(function s(){return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,h.request)("/api/common/home/upgrade-script",{method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},s)})),u.apply(this,arguments)}}}]);
