"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1218],{83002:function(ze,Ee,e){var Te=e(5574),d=e.n(Te),Fe=e(15009),P=e.n(Fe),A=e(99289),s=e.n(A),ye=e(83622),F=e(85265),Q=e(67294),B=e(81146),c=e(1883),N=e(90098),h=e(3616),W=e(36146),S=e(85893),Oe=(0,Q.forwardRef)(function(f,K){(0,Q.useImperativeHandle)(K,function(){return{show:function(o){return s()(P()().mark(function y(){return P()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:we(o),q(!0);case 2:case"end":return X.stop()}},y)}))()}}});var re=(0,Q.useState)(!1),ae=d()(re,2),z=ae[0],q=ae[1],ce=(0,Q.useState)(),H=d()(ce,2),Z=H[0],we=H[1],ie=(0,Q.useRef)();return(0,S.jsxs)(S.Fragment,{children:[f.showTriggerButton&&(0,S.jsx)(ye.ZP,{onClick:s()(P()().mark(function l(){return P()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:we(f.composeItem),q(!0);case 2:case"end":return y.stop()}},l)})),icon:(0,S.jsx)(c.Z,{}),children:W.FD.format("listManageLog")},"log"),(0,S.jsx)(F.Z,{title:W.FD.format("listLog"),open:z,forceRender:!0,onClose:function(){q(!1)},afterOpenChange:function(o){if(o)setTimeout(function(){var n,X;(n=ie.current)===null||n===void 0||n.start(),(X=ie.current)===null||X===void 0||X.fit()},1e3);else{var y;(y=ie.current)===null||y===void 0||y.close()}},width:h.FK,children:Z&&z&&(0,S.jsx)(B.Z,{ref:ie,showInDrawer:!0,id:"compose:log:".concat(String(Z.id||Z.name)),request:function(){var l=s()(P()().mark(function o(y){var n;return P()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,(0,N.Yz)({id:Z.id||Z.name,lineTotal:y.lineTotal,download:(n=y.download)!==null&&n!==void 0?n:!1,showTime:y.showTime});case 2:case"end":return I.stop()}},o)}));return function(o){return l.apply(this,arguments)}}(),download:function(){var l=s()(P()().mark(function o(y){var n;return P()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,(0,N.vf)({id:Z.id||Z.name,lineTotal:y.lineTotal,showTime:y.showTime,download:!0});case 2:return n=I.sent,I.abrupt("return",{data:new Blob([n],{type:"text/plain"}),name:f.composeItem.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return I.stop()}},o)}));return function(o){return l.apply(this,arguments)}}()})})]})});Ee.Z=Oe},82848:function(ze,Ee,e){e.d(Ee,{Z:function(){return it}});var Te=e(15009),d=e.n(Te),Fe=e(99289),P=e.n(Fe),A=e(97857),s=e.n(A),ye=e(5574),F=e.n(ye),Q=e(3616),B=e(24963),c=e(90098),N=e(36146),h=e(86548),W=e(33862),S=e(38345),Oe=e(24739),f=e(5966),K=e(86615),re=e(97462),ae=e(62370),z=e(95213),q=e(11106),ce=e(92398),H=e(42075),Z=e(83622),we=e(83062),ie=e(40411),l=e(71230),o=e(15746),y=e(40056),n=e(67294),X=e(12491),I=e(85060),rt=e(97269),$e=e(86738),i=e(85893),Be=(0,n.forwardRef)(function(t,V){(0,n.useImperativeHandle)(V,function(){return{}});var je=(0,n.useRef)(),E=(0,n.useState)(!1),Ke=F()(E,2),Ne=Ke[0],ee=Ke[1];return(0,i.jsx)(ae.Z,{children:(0,i.jsx)($e.Z,{icon:!1,title:!1,description:(0,i.jsx)(rt.A,{name:"importRemote",layout:"horizontal",submitter:!1,formRef:je,children:(0,i.jsx)(f.Z,{width:"lg",label:"Url",initialValue:t.defaultUrl,name:"url",placeholder:"https:// or http://"})}),onOpenChange:function(oe){if(!oe){var le;(le=je.current)===null||le===void 0||le.resetFields()}},onConfirm:P()(d()().mark(function Pe(){var oe,le,R;return d()().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:if(le=(oe=je.current)===null||oe===void 0?void 0:oe.getFieldValue("url"),le){he.next=3;break}return he.abrupt("return");case 3:return ee(!0),he.next=6,(0,c.MG)({uri:le}).finally(function(){ee(!1)});case 6:R=he.sent,t.onFinish&&t.onFinish(R.data.content,le);case 8:case"end":return he.stop()}},Pe)})),children:(0,i.jsx)(Z.ZP,{loading:Ne,icon:(0,i.jsx)(I.Z,{}),block:!0,onClick:function(){var oe;(oe=je.current)===null||oe===void 0||oe.resetFields()},children:t.title})})})}),ve=Be,be=e(91058),We=e(79245),at=e(27166),Ye=e(82346),He=function(V){var je,E=new N.Uo("components.appCompose"),Ke=(0,n.useContext)(B.Z),Ne=Ke.message,ee=(0,n.useRef)(),Pe=(0,n.useRef)(),oe=(0,n.useState)(),le=F()(oe,2),R=le[0],pe=le[1],he=(0,n.useState)(!1),Xe=F()(he,2),ot=Xe[0],Ge=Xe[1];(0,n.useEffect)(function(){if(ee.current){if(!V.id){pe({yaml:"",override:""});return}(0,c.Pn)({id:V.id}).then(function(w){var T,L;pe({yaml:w.data.yaml[0],override:(T=w.data.yaml[1])!==null&&T!==void 0?T:""}),(L=ee.current)===null||L===void 0||L.setFieldsValue({name:w.data.detail.name,title:w.data.detail.title,type:w.data.detail.setting.type,environment:w.data.detail.setting.environment,remoteUrl:w.data.detail.setting.remoteUrl})})}},[ee.current,V.id]);var Je=(0,i.jsx)(ce.Z,{tabBarExtraContent:(0,i.jsxs)(H.Z,{children:[(0,i.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-override",target:"_blank",children:N.FD.format("help")}),(0,i.jsx)(Z.ZP,{type:"link",onClick:function(){},children:N.FD.format("listManageFullScreen")})]}),items:[{label:E.format("createYaml.yaml"),key:"yaml",children:R&&(0,i.jsx)(q.ZP,{theme:"dark",height:"600px",onChange:function(T){pe(s()(s()({},R),{yaml:T}))},onFocus:function(){var T;((T=ee.current)===null||T===void 0?void 0:T.getFieldValue("type"))=="remoteUrl"&&Ne.info(E.format("createYamlDisableEdit"))},readOnly:((je=ee.current)===null||je===void 0?void 0:je.getFieldValue("type"))=="remoteUrl",value:R.yaml,extensions:[z.RI.yaml()]})},{label:(0,i.jsx)(we.Z,{title:E.format("createYamlOverrideTip"),children:(0,i.jsx)(ie.Z,{count:(R==null?void 0:R.override)&&N.FD.format("listInUse"),offset:[15,-5],children:E.format("createYaml.override")})}),key:"yamlOverride",children:R&&(0,i.jsx)(q.ZP,{theme:"dark",height:"600px",onChange:function(T,L){pe(s()(s()({},R),{override:T}))},value:R==null?void 0:R.override,extensions:[z.RI.yaml()]})}]},"yamlEditor");return(0,i.jsxs)(at.Z,{requestLoading:R==null&&V.id!=null,drawerProps:{width:Q.R_,destroyOnHidden:!0},open:ot,onOpenChange:function(T){if(Ge(T),!T){var L;pe(void 0),(L=ee.current)===null||L===void 0||L.resetFields()}},title:E.format("yamlDrawerTitle"),formRef:ee,trigger:(0,i.jsx)(Z.ZP,{type:"primary",icon:V.id?(0,i.jsx)(h.Z,{}):void 0,children:N.Ob.format(V.id?"compose.list.edit":"compose.list.create")}),onFinish:function(){var w=P()(d()().mark(function T(L){var Le,te;return d()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.prev=0,Le={id:V.id&&V.id.toString(),type:L.type,name:L.name,title:L.title,environment:L.environment,remoteUrl:L.remoteUrl,yaml:R==null?void 0:R.yaml,yamlOverride:R==null?void 0:R.override},$.next=4,(0,c.im)(Le);case 4:return te=$.sent,V.onFinish&&V.onFinish(te.data.id),$.abrupt("return",!0);case 9:return $.prev=9,$.t0=$.catch(0),$.abrupt("return",!1);case 12:case"end":return $.stop()}},T,null,[[0,9]])}));return function(T){return w.apply(this,arguments)}}(),children:[(0,i.jsx)(S.Z,{ghost:!0,children:(0,i.jsxs)(Oe.UW,{children:[(0,i.jsx)(f.Z,{label:E.format("createFormName"),name:"name",width:"md",required:!0,disabled:!!V.id,rules:[{required:!0},{pattern:/^[a-zA-Z0-9_-]+$/,message:E.format("createFormNameRule")}],placeholder:E.format("createFormNameEmpty")}),(0,i.jsx)(f.Z,{label:E.format("createFormTitle"),name:"title",width:"md"})]})},"createForm"),(0,i.jsx)(K.Z.Group,{label:E.format("createFormType"),name:"type",initialValue:"text",fieldProps:{defaultValue:"text",onChange:function(){var T;(T=ee.current)===null||T===void 0||T.resetFields(["yaml","environment"])}},disabled:!!V.id,options:E.option("createFormTypeOption",["text","remoteUrl","storagePath","store","outPath"]).map(function(w){return{label:w.label,value:w.value}})}),(0,i.jsx)(re.Z,{name:["type"],children:function(T){var L=T.type;if(L=="text")return(0,i.jsxs)(l.Z,{gutter:[10,0],children:[(0,i.jsx)(o.Z,{span:12,children:(0,i.jsx)(X.Z,{title:E.format("createFormTypeTextImportFile"),onImport:function(te){return pe(s()(s()({},R),{yaml:te})),(0,We.m)(te).map(function(Ce){var $;($=Pe.current)===null||$===void 0||$.addEnvItem(Ce.name,Ce.value)}),!0},onLoad:function(te){if(te.indexOf("services:")<0)throw new Error(N.FD.format("commonFileIncorrectFormat",{name:"yaml"}));return!0}},"importFile")}),(0,i.jsx)(o.Z,{span:12,children:(0,i.jsx)(ve,{title:E.format("createFormTypeTextImportRemote"),onFinish:function(){var Le=P()(d()().mark(function te(Ce){return d()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return pe(s()(s()({},R),{yaml:Ce})),(0,We.m)(Ce).map(function(xe){var b;(b=Pe.current)===null||b===void 0||b.addEnvItem(xe.name,xe.value)}),j.abrupt("return",!0);case 3:case"end":return j.stop()}},te)}));return function(te){return Le.apply(this,arguments)}}()},"importRemote")})]});if(L=="remoteUrl")return(0,i.jsx)(l.Z,{gutter:[10,0],children:(0,i.jsxs)(o.Z,{span:24,children:[(0,i.jsx)(ae.Z,{shouldUpdate:!0,children:function(te){return(0,i.jsx)(ve,{defaultUrl:te.getFieldValue("remoteUrl"),title:E.format("createFormTypeRemoteImportRemote1"),onFinish:function(){var Ce=P()(d()().mark(function $(j,xe){var b;return d()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return pe(s()(s()({},R),{yaml:j})),(b=ee.current)===null||b===void 0||b.setFieldValue("remoteUrl",xe),(0,We.m)(j).map(function(De){var Re;(Re=Pe.current)===null||Re===void 0||Re.addEnvItem(De.name,De.value)}),C.abrupt("return",!0);case 4:case"end":return C.stop()}},$)}));return function($,j){return Ce.apply(this,arguments)}}()},"importRemote1")}}),(0,i.jsx)(ae.Z,{hidden:!0,name:"remoteUrl"},"remoteUrl")]})});if(L=="storagePath")return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(f.Z,{name:"storagePath",required:!0,readonly:!0,initialValue:E.format("createFormTypeStoragePathTip"),addonAfter:(0,i.jsx)("a",{href:"https://dpanel.cc/manual/compose-create",target:"_blank",children:N.FD.format("help")})})});if(L=="store")return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(f.Z,{readonly:!0,name:"store",required:!0,initialValue:E.format("createFormTypeStoreTip"),addonAfter:(0,i.jsx)(Ye.Link,{to:"/compose/appstore",children:N.Ob.format("compose.appstore")})})});if(L=="outPath")return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(f.Z,{name:"outPath",required:!0,readonly:!0,initialValue:E.format("createFormTypeOutPathTip")})})}}),(0,i.jsxs)(S.Z,{ghost:!0,direction:"row",children:[(0,i.jsxs)(S.Z,{ghost:!0,colSpan:"50%",children:[(0,i.jsx)(y.Z,{type:"warning",message:E.format("createFormTypeTextTip"),style:{marginBottom:15}},"yamlTips"),(0,i.jsx)(y.Z,{message:(0,i.jsxs)(i.Fragment,{children:[E.format("createEnvTip1")," ","${DB_NAME}",". ",E.format("createEnvTip2")]})}),(0,i.jsx)(be.Z,{drawerProps:{ghost:!0,title:(0,i.jsx)(W.Z,{}),subTitle:E.format("createEnvTitle")},name:"environment",showInDrawer:!0,showImportButton:!V.id,showAddButton:!0,showCodeMode:!V.id,ref:Pe})]}),(0,i.jsx)(S.Z,{colSpan:"50%",children:Je})]},"yamlEditor")]},"yamlCreate")},it=He},91218:function(ze,Ee,e){e.d(Ee,{Z:function(){return $}});var Te=e(97857),d=e.n(Te),Fe=e(19632),P=e.n(Fe),A=e(15009),s=e.n(A),ye=e(99289),F=e.n(ye),Q=e(5574),B=e.n(Q),c=e(67294),N=e(3616),h=e(36146),W=e(38345),S=e(97269),Oe=e(86615),f=e(62370),K=e(90098),re=e(27166),ae=e(43425),z=e(33160),q=e(82061),ce=e(87784),H=e(74842),Z=e(30159),we=e(25035),ie=e(95591),l=e(26522),o=e(33862),y=e(40056),n=e(42075),X=e(96074),I=e(25593),rt=e(86250),$e=e(84567),i=e(83062),Be=e(83622),ve=e(80821),be=e(82346),We=e(79697),at=e(99861),Ye=e(1699),He=e(89035),it=e(75544),t=e(85893),V=(0,c.forwardRef)(function(j,xe){(0,c.useImperativeHandle)(xe,function(){return{show:function(){return F()(s()().mark(function x(){var se;return s()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return Ue(!0),(se=J.current)===null||se===void 0||se.clear(),ne.next=4,new Promise(function(Ae){return setTimeout(function(){var Ie;(Ie=J.current)===null||Ie===void 0||Ie.fit(),Ae(!0)},1e3)});case 4:case"end":return ne.stop()}},x)}))()},close:function(){var x;Ue(!1),(x=J.current)===null||x===void 0||x.clear()},cancel:function(){return F()(s()().mark(function x(){var se;return s()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return(se=J.current)===null||se===void 0||se.clear(),b.progress.close("compose:"+j.id),ne.abrupt("return",!0);case 3:case"end":return ne.stop()}},x)}))()}}});var b=(0,be.useModel)("subscriber"),J=(0,c.useRef)(),C=(0,c.useState)(!1),De=B()(C,2),Re=De[0],Ue=De[1];return b.addDataHandler("compose:"+j.id,function(U){var x;(x=J.current)===null||x===void 0||x.write(U.data)}),(0,t.jsx)(W.Z,{hidden:!Re,ghost:!0,title:(0,t.jsx)(He.Z,{}),subTitle:"Console",extra:(0,t.jsx)(n.Z,{children:(0,t.jsx)(ve.Z,{action:F()(s()().mark(function U(){var x;return s()().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return(x=J.current)===null||x===void 0||x.clear(),b.progress.close("compose:"+j.id),me.abrupt("return");case 3:case"end":return me.stop()}},U)})),buttonProps:{icon:(0,t.jsx)(q.Z,{}),danger:!0},children:h.FD.format("listManageKill")},"kill")}),children:(0,t.jsx)(it.Z,{id:"create-log-".concat(j.id),height:"200px",style:{fontSize:12},ref:J})})}),je=V,E=e(83002),Ke=e(60940),Ne=e(55241),ee=e(78451),Pe=e(37413),oe=e(94359),le=e(91806),R=e(60433),pe=e(99611),he=e(99922),Xe=e(3905),ot=e(87662),Ge=e(5251),Je=e(29463);function w(j){var xe=(0,c.useState)(""),b=B()(xe,2),J=b[0],C=b[1],De=(0,c.useRef)(),Re=(0,c.useRef)(),Ue=(0,c.useState)(),U=B()(Ue,2),x=U[0],se=U[1],me=new h.Uo("components.appCompose"),ne=(0,c.useRef)(),Ae=(0,c.useState)(),Ie=B()(Ae,2),ke=Ie[0],_e=Ie[1],qe=(0,c.useState)(),et=B()(qe,2),Qe=et[0],a=et[1];return(0,c.useEffect)(function(){return(0,ot.K3)().then(function(k){var Y;C((Y=k.data.serverUrl)!==null&&Y!==void 0?Y:"")}),se(!1),j.containerList&&_e(j.containerList.filter(function(k){return k.status!=""}).map(function(k){return k.service})),a(j.containerList),function(){a([])}},[j.containerList]),(0,t.jsxs)(W.Z,{ghost:!0,title:(0,t.jsx)(le.Z,{}),subTitle:me.format("detailContainerTitle"),extra:j.enableSelectService&&(0,t.jsx)($e.Z,{checked:x,onChange:function(Y){se(Y.target.checked)},children:me.format("selectService")},"selectService"),children:[(0,t.jsx)(he.Z,{showFileExplorer:!0,ref:De}),(0,t.jsx)(Je.Z,{ref:ne}),(0,t.jsx)(Xe.Z,{ref:Re}),(0,t.jsx)(Ke.Z,{scroll:{x:"max-content"},rowKey:"service",pagination:!1,columns:[{title:h.FD.format("listName"),dataIndex:"name",width:200,render:function(Y,v,ue){return(0,t.jsx)(i.Z,{title:v.service,children:(0,t.jsx)(ee.Z,{content:v.name?(0,Ge.fi)(v.name,"/"):v.service})})}},{title:h.FD.format("listPort"),render:function(Y,v,ue){var G=[],O=[];return v.publishers&&v.publishers.map(function(fe){fe.publishedPort?G.push({PrivatePort:fe.targetPort,Type:fe.protocol,IP:fe.url,PublicPort:fe.publishedPort}):fe.publishedPort&&O.push({PrivatePort:fe.targetPort,Type:fe.protocol,IP:fe.url,PublicPort:fe.publishedPort})}),(0,t.jsx)(Pe.Z,{publicPort:G,privatePort:O,domain:[],serverIp:J})}},{title:h.FD.format("listStatus"),render:function(Y,v,ue){return(0,t.jsx)(oe.Z,{status:"container.".concat(v.state),tip:"".concat(v.state," ").concat(v.status)},v.name)}},{title:h.FD.format("listManage"),fixed:"right",render:function(Y,v,ue){return(0,t.jsxs)(n.Z,{split:(0,t.jsx)(X.Z,{type:"vertical"}),children:[v.name==""&&(0,t.jsx)(Ne.Z,{placement:"left",content:(0,t.jsx)(W.Z,{ghost:!0,title:h.FD.format("listManageShowContainerEnv"),children:(0,t.jsx)(n.Z,{direction:"vertical",children:v.environment&&Object.keys(v.environment).map(function(G){if(v.environment&&v.environment[G])return(0,t.jsx)(I.Z.Text,{code:!0,children:"".concat(G,"=").concat(v.environment[G])},G)})})}),children:(0,t.jsx)(R.Z,{})}),v.name!=""&&(0,t.jsx)(I.Z.Link,{onClick:function(){var O;(O=Re.current)===null||O===void 0||O.show(v.name)},children:(0,t.jsx)(pe.Z,{})},"container"),v.state=="running"&&(0,t.jsx)(I.Z.Link,{onClick:function(){var O;(O=De.current)===null||O===void 0||O.show({url:"/console/container/".concat((0,Ge.fi)(v.name,"/")),title:v.name})},children:(0,t.jsx)(He.Z,{})},"console"),v.state=="running"&&(0,t.jsx)(I.Z.Link,{onClick:function(){var O;(O=ne.current)===null||O===void 0||O.showContainer((0,Ge.fi)(v.name,"/"))},children:(0,t.jsx)(ie.Z,{})},"file")]})}}],dataSource:Qe,rowSelection:x&&Qe?{selectedRowKeys:ke,onChange:function(Y,v,ue){_e(Y),j.selectServiceFinish&&j.selectServiceFinish(Y)}}:void 0})]})}var T=e(91058),L=e(82848),Le=e(2831),te=e(16970),Ce=(0,c.forwardRef)(function(j,xe){var b,J=(0,be.useAccess)(),C=new h.Uo("components.appCompose"),De=new h.Uo("components.network"),Re=(0,c.useState)(0),Ue=B()(Re,2),U=Ue[0],x=Ue[1],se=(0,c.useState)(!1),me=B()(se,2),ne=me[0],Ae=me[1],Ie=(0,c.useState)(!1),ke=B()(Ie,2),_e=ke[0],qe=ke[1],et=(0,c.useState)(),Qe=B()(et,2),a=Qe[0],k=Qe[1],Y=(0,c.useRef)(),v=(0,c.useRef)(),ue=(0,c.useRef)(),G=(0,c.useRef)(),O=(0,c.useRef)(),fe=(0,c.useRef)(),ct=(0,c.useRef)(),ft=(0,c.useState)(),mt=B()(ft,2),tt=mt[0],lt=mt[1];(0,c.useImperativeHandle)(xe,function(){return{show:function(r){return F()(s()().mark(function u(){return s()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:lt(r),Ae(!0);case 2:case"end":return D.stop()}},u)}))()}}}),(0,c.useEffect)(function(){tt&&(qe(!0),(0,K.Pn)({id:tt}).finally(F()(s()().mark(function m(){return s()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:qe(!1);case 1:case"end":return u.stop()}},m)}))).then(function(m){var r=m.data.detail;r.setting.status&&r.setting.status.includes("running")&&(r.isRunning=!0),r.setting.status&&r.setting.status.includes("paused")&&(r.isPaused=!0),r.setting.status&&r.setting.status.includes("exited")&&(r.isExited=!0),r.setting.status&&r.setting.status.includes("waiting")?r.isDeploy=!1:r.isDeploy=!0,r.setting.status&&r.setting.status.includes("created")&&(r.isCreated=!0,r.isDeploy=!1);var u=m.data.project;if(u&&u.services&&(r.imageList=P()(new Set(Object.keys(u.services).map(function(de){var g;return(g=u.services[de].image)!==null&&g!==void 0?g:""})))),r.containerList=m.data.containerList,r.containerList||(r.containerList=[]),u!=null&&u.services&&Object.entries(u==null?void 0:u.services).forEach(function(de){var g,Se=B()(de,2),Ze=Se[0],ge=Se[1],Ve=r.containerList.find(function(M){return M.service==Ze});Ve||r.containerList.push({project:(g=u.name)!==null&&g!==void 0?g:"",name:"",service:Ze,publishers:ge.ports?ge.ports.map(function(M){var Me;return{url:"",targetPort:M.target,publishedPort:parseInt(M.published),protocol:(Me=M.protocol)!==null&&Me!==void 0?Me:""}}):[],state:"waiting",status:"",environment:ge.environment})}),r.containerList){var p;(p=ue.current)===null||p===void 0||p.setFieldValue("deployServiceName",m.data.detail.setting.deployServiceName)}if(k(d()(d()({},m.data),{detail:r})),m.data.detail.setting.environment){var D;(D=ue.current)===null||D===void 0||D.setFieldValue("environment",m.data.detail.setting.environment)}}))},[U,tt]);function vt(m){return st.apply(this,arguments)}function st(){return st=F()(s()().mark(function m(r){var u,p,D;return s()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if((u=O.current)===null||u===void 0||u.show(),!r.pullImageUseDPanel){g.next=5;break}return g.next=4,(p=Y.current)===null||p===void 0?void 0:p.start();case 4:(D=Y.current)===null||D===void 0||D.finish();case 5:return g.prev=5,g.next=8,(0,K.Oh)(r);case 8:j.onDeployFinish&&j.onDeployFinish(),g.next=14;break;case 11:g.prev=11,g.t0=g.catch(5),j.onDeployFailed&&j.onDeployFailed();case 14:x(U+1);case 15:case"end":return g.stop()}},m,null,[[5,11]])})),st.apply(this,arguments)}return(0,t.jsxs)(re.Z,{drawerProps:{width:N.R_,destroyOnHidden:!0},requestLoading:_e,title:a?C.format("drawerTitle",{name:(b=a==null?void 0:a.detail.name)!==null&&b!==void 0?b:""}):C.format("createTitle"),open:ne,onOpenChange:function(r){r||(lt(void 0),k(void 0),j.onClose&&j.onClose()),Ae(r)},submitter:!1,formRef:ue,children:[a&&!(0,We.Z)(a.detail.imageList)&&(0,t.jsx)(at.Z,{ref:Y,image:a.detail.imageList}),(0,t.jsx)(Je.Z,{ref:ct}),(0,t.jsxs)(W.Z,{direction:"column",ghost:!0,gutter:[0,10],children:[a&&a.detail.setting.type=="dangling"&&(0,t.jsx)(y.Z,{type:"warning",showIcon:!0,description:(0,t.jsxs)("div",{children:[C.format("managerStatusDanglingAlert",{name:a.detail.name})," ",(0,t.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-outpath",target:"_blank",children:h.FD.format("help")})]})}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(W.Z,{title:(0,t.jsx)(ae.Z,{}),subTitle:C.format("managerContainerTitle"),ghost:!0,children:(0,t.jsxs)(n.Z,{wrap:!0,split:(0,t.jsx)(X.Z,{type:"vertical"}),children:[(0,t.jsxs)(Ye.u,{access:"canSeeComposeListManage",space:{},children:[(0,t.jsx)(ve.Z,{buttonProps:{icon:(0,t.jsx)(z.Z,{}),type:"primary"},confirmProps:{onOpenChange:function(r,u){var p;r&&(!((p=v.current)===null||p===void 0)&&p.resetFields)&&v.current.resetFields()},description:(0,t.jsxs)(n.Z,{style:{minWidth:300},direction:"vertical",wrap:!0,children:[(0,t.jsx)(I.Z.Text,{children:C.format("managerCreateTip")}),(0,t.jsx)(S.A,{name:"createForm",formRef:v,layout:"inline",submitter:!1,children:(0,t.jsxs)(rt.Z,{vertical:!0,children:[(0,t.jsx)(Oe.Z.Group,{name:"pullImageUse",layout:"vertical",fieldProps:{style:{display:"flex",flexDirection:"column",gap:8}},options:C.option("managerCreatePullImageUseOption",["useCommand","useDPanel"])}),(0,t.jsx)(f.Z,{initialValue:!0,name:"createPath",valuePropName:"checked",children:(0,t.jsx)($e.Z,{children:C.format("managerCreateCreatePath")})}),(0,t.jsx)(f.Z,{initialValue:!0,name:"removeOrphans",valuePropName:"checked",children:(0,t.jsx)($e.Z,{defaultChecked:!0,children:C.format("managerCreateRemoveOrphans")})})]})})]})},action:F()(s()().mark(function m(){var r,u,p,D,de,g,Se,Ze,ge,Ve,M,Me,nt;return s()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.prev=0,_.next=3,(ge=ue.current)===null||ge===void 0?void 0:ge.validateFields();case 3:_.next=8;break;case 5:return _.prev=5,_.t0=_.catch(0),_.abrupt("return");case 8:return Ve=a?a.detail.id||a.detail.name:(r=ue.current)===null||r===void 0?void 0:r.getFieldValue("name"),M={id:Ve,createPath:(u=(p=v.current)===null||p===void 0?void 0:p.getFieldValue("createPath"))!==null&&u!==void 0?u:!1,removeOrphans:(D=(de=v.current)===null||de===void 0?void 0:de.getFieldValue("removeOrphans"))!==null&&D!==void 0?D:!0},((g=v.current)===null||g===void 0?void 0:g.getFieldValue("pullImageUse"))=="useDPanel"&&(M.pullImage=!1,M.pullImageUseDPanel=!0),((Se=v.current)===null||Se===void 0?void 0:Se.getFieldValue("pullImageUse"))=="useCommand"&&(M.pullImage=!0),Me=((Ze=ue.current)===null||Ze===void 0?void 0:Ze.getFieldsFormatValue)&&ue.current.getFieldsFormatValue(!0),M.environment=Me.environment,M.deployServiceName=Me.deployServiceName,_.next=17,(0,K.im)({id:a.detail.id.toString(),name:a.detail.name,environment:Me.environment,type:a.detail.setting.type});case 17:if(!(a!=null&&a.detail.isDeploy&&M.deployServiceName)){_.next=23;break}if(nt=[],a.detail.containerList.forEach(function(ut){var dt;ut.status!=""&&!((dt=M.deployServiceName)!==null&&dt!==void 0&&dt.includes(ut.service))&&nt.push(ut.service)}),(0,We.Z)(nt)){_.next=23;break}return _.next=23,(0,K.j6)({id:Ve,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1,destroyServiceName:nt});case 23:return _.abrupt("return",vt(M));case 24:case"end":return _.stop()}},m,null,[[0,5]])})),children:C.format(a!=null&&a.detail.isDeploy?"managerUpgradeButton":"managerCreateButton")},"deploy"),(a.detail.isDeploy||a.detail.isCreated)&&(0,t.jsx)(ve.Z,{action:function(){var r;return(r=O.current)===null||r===void 0||r.show(),(0,K.j6)({id:a.detail.id||a.detail.name,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1})},onSuccess:function(){x(U+1)},buttonProps:{type:"primary",danger:!0,icon:(0,t.jsx)(q.Z,{})},confirmProps:{showCommonConfirm:!0},children:C.format("managerDeleteContainerButton")},"destroyContainer")]}),a.detail.isDeploy&&(0,t.jsxs)(Ye.u,{access:"canSeeComposeList",space:{direction:"horizontal"},children:[(0,t.jsx)(ve.Z,{buttonProps:{icon:(0,t.jsx)(z.Z,{})},action:F()(s()().mark(function m(){var r;return s()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return(r=O.current)===null||r===void 0||r.show(),p.abrupt("return",(0,K.GG)({id:a.detail.id||a.detail.name,op:"restart"}));case 2:case"end":return p.stop()}},m)})),onSuccess:function(){x(U+1)},children:C.format("managerRestartButton")},"restart"),(0,t.jsx)(ve.Z,{action:function(){var r;return(r=O.current)===null||r===void 0||r.show(),(0,K.GG)({id:a.detail.id||a.detail.name,op:"stop"})},buttonProps:{icon:(0,t.jsx)(ce.Z,{}),disabled:a.detail.isExited},onSuccess:function(){x(U+1)},children:C.format("managerStopButton")},"stop"),a.detail.isPaused&&(0,t.jsx)(ve.Z,{action:function(){var r;return(r=O.current)===null||r===void 0||r.show(),(0,K.GG)({id:a.detail.id||a.detail.name,op:"unpause"})},onSuccess:function(){x(U+1)},buttonProps:{icon:(0,t.jsx)(H.Z,{})},children:C.format("managerUnpauseButton")},"unpause"),!a.detail.isPaused&&(0,t.jsx)(ve.Z,{action:function(){var r;return(r=O.current)===null||r===void 0||r.show(),(0,K.GG)({id:a.detail.id||a.detail.name,op:"pause"})},onSuccess:function(){x(U+1)},buttonProps:{icon:(0,t.jsx)(Z.Z,{}),disabled:!a.detail.isRunning},children:C.format("managerPauseButton")},"pause"),a.detail.isDeploy&&(0,t.jsx)(E.Z,{composeItem:a.detail,showTriggerButton:!0},"composeLog")]}),a.detail.id>0&&J.canSeeComposeListManageDelete&&(0,t.jsx)(ve.Z,{buttonProps:{type:"dashed",danger:!0,icon:(0,t.jsx)(q.Z,{})},confirmProps:{onOpenChange:function(r,u){var p;!((p=G.current)===null||p===void 0)&&p.resetFields&&G.current.resetFields()},description:(0,t.jsxs)(n.Z,{style:{width:280},direction:"vertical",children:[(0,t.jsx)(I.Z.Text,{children:C.format("managerDeleteTaskTip")}),(0,t.jsxs)(S.A,{formRef:G,layout:"inline",submitter:!1,children:[(0,t.jsx)(f.Z,{initialValue:!0,name:"deleteImage",valuePropName:"checked",children:(0,t.jsx)($e.Z,{children:C.format("managerDeleteTaskDeleteImage")})}),(0,t.jsx)(f.Z,{addonAfter:(0,t.jsx)(i.Z,{title:C.format("managerDeleteTaskDeleteVolumeTip"),children:(0,t.jsx)(we.Z,{})}),initialValue:!0,name:"deleteVolume",valuePropName:"checked",children:(0,t.jsx)($e.Z,{children:C.format("managerDeleteTaskDeleteVolume")})}),(0,t.jsx)(f.Z,{initialValue:!0,name:"deletePath",valuePropName:"checked",children:(0,t.jsx)($e.Z,{children:C.format("managerDeleteTaskDeletePath")})})]})]})},action:F()(s()().mark(function m(){var r,u,p,D,de,g,Se,Ze,ge;return s()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return(r=O.current)===null||r===void 0||r.show(),M.next=3,(0,K.j6)({id:(u=(p=a.detail)===null||p===void 0?void 0:p.id)!==null&&u!==void 0?u:a.detail.name,deleteImage:(D=(de=G.current)===null||de===void 0?void 0:de.getFieldValue("deleteImage"))!==null&&D!==void 0?D:!1,deleteVolume:(g=(Se=G.current)===null||Se===void 0?void 0:Se.getFieldValue("deleteVolume"))!==null&&g!==void 0?g:!1,deletePath:(Ze=(ge=G.current)===null||ge===void 0?void 0:ge.getFieldValue("deletePath"))!==null&&Ze!==void 0?Ze:!1,deleteData:!0});case 3:Ae(!1),k(void 0),j.onClose&&j.onClose();case 6:case"end":return M.stop()}},m)})),children:h.FD.format("listManageDelete")},"deleteTask"),j.showBackListButton&&(0,t.jsx)(be.Link,{to:"/compose/list",children:(0,t.jsx)(Be.ZP,{children:h.Ob.format("compose.list")})})]})},"operator"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(W.Z,{title:(0,t.jsx)(ae.Z,{}),subTitle:C.format("managerTitle"),ghost:!0,children:(0,t.jsxs)(n.Z,{children:[J.canSeeComposeListManage&&(0,t.jsx)(L.Z,{id:tt,onFinish:function(){var m=F()(s()().mark(function r(u){return s()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:lt(u),x(U+1);case 2:case"end":return D.stop()}},r)}));return function(r){return m.apply(this,arguments)}}()}),J.canSeeComposeListManageCreate&&(a==null?void 0:a.detail.setting.type)!="outPath"&&(0,t.jsx)(Be.ZP,{icon:(0,t.jsx)(ie.Z,{}),onClick:F()(s()().mark(function m(){var r,u,p,D;return s()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,(0,Le.aF)();case 2:u=g.sent,u.data&&(r=u.data.dpanel.containerInfo)!==null&&r!==void 0&&r.Name&&((p=ct.current)===null||p===void 0||p.showContainer((D=u.data.dpanel.containerInfo)===null||D===void 0?void 0:D.Name,"/dpanel/compose/".concat(a==null?void 0:a.detail.name)));case 4:case"end":return g.stop()}},m)})),children:h.FD.format("listManageFilePath")}),(0,t.jsx)(X.Z,{type:"vertical"}),J.canSeeComposeListManage&&(0,t.jsx)(te.Z,{trigger:(0,t.jsx)(Be.ZP,{icon:(0,t.jsx)(l.Z,{}),children:De.format("createTitle")},"network")},"network-create"),(0,t.jsx)(Be.ZP,{icon:(0,t.jsx)(z.Z,{}),onClick:function(){var r;(r=O.current)===null||r===void 0||r.close(),x(U+1)},children:h.FD.format("listManageRefresh")})]})},"manager"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(je,{ref:O,id:(a==null?void 0:a.detail.id)||(a==null?void 0:a.detail.name)}),a&&a.containerList&&(0,t.jsx)(w,{containerList:a==null?void 0:a.containerList,enableSelectService:(a==null?void 0:a.detail.setting.type)!="dangling",selectServiceFinish:function(r){var u;(u=ue.current)===null||u===void 0||u.setFieldValue("deployServiceName",r)}}),(0,t.jsx)(f.Z,{name:"deployServiceName",hidden:!0}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(T.Z,{drawerProps:{ghost:!0,title:(0,t.jsx)(o.Z,{}),subTitle:"".concat(C.format("createEnvTitle"))},showDisableName:!0,showDeleteButton:!1,name:"environment",ref:fe})]})]})}),$=Ce},75544:function(ze,Ee,e){var Te=e(5574),d=e.n(Te),Fe=e(12323),P=e(78267),A=e.n(P),s=e(75458),ye=e.n(s),F=e(67294),Q=e(4244),B=e.n(Q),c=e(24078),N=e(85893),h,W,S,Oe=(0,F.forwardRef)(function(f,K){var re,ae=(0,F.useState)(!0),z=d()(ae,2),q=z[0],ce=z[1];return(0,F.useEffect)(function(){return h=new Q.Terminal(Fe.X),W=new s.SearchAddon,S=new P.FitAddon,window.addEventListener("resize",function(){f.showInModal||S.fit()}),f.style&&f.style.fontSize&&(h.options.fontSize=f.style.fontSize),h.loadAddon(S),h.loadAddon(W),h.open(document.getElementById(f.id?f.id:"terminal-container")),f.showInModal||S.fit(),function(){h.reset(),ce(!0)}},[]),(0,F.useImperativeHandle)(K,function(){return{write:function(Z){q&&(S.fit(),ce(!1)),h.write(Z)},clear:function(){h.clear()},getTerminal:function(){return h},findNext:function(Z){W.findNext(Z)},findPrev:function(Z){W.findPrevious(Z)},fit:function(){S.fit()},onData:function(Z){return h.onData(Z)}}}),(0,N.jsx)("div",{id:f.id?f.id:"terminal-container",style:{width:f.width?f.width:"100%",height:f.height?f.height:"500px",marginTop:(re=f.style)===null||re===void 0?void 0:re.marginTop}})});Ee.Z=Oe},90098:function(ze,Ee,e){e.d(Ee,{GG:function(){return Oe},MG:function(){return q},Oh:function(){return N},Pn:function(){return B},Yz:function(){return K},iE:function(){return H},im:function(){return s},j6:function(){return W},pm:function(){return F},tw:function(){return we},vf:function(){return ae}});var Te=e(15009),d=e.n(Te),Fe=e(99289),P=e.n(Fe),A=e(82346);function s(l){return ye.apply(this,arguments)}function ye(){return ye=P()(d()().mark(function l(o){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,A.request)("/api/app/compose/create",{method:"POST",data:o}));case 1:case"end":return n.stop()}},l)})),ye.apply(this,arguments)}function F(l){return Q.apply(this,arguments)}function Q(){return Q=P()(d()().mark(function l(o){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,A.request)("/api/app/compose/get-list",{method:"POST",data:o}));case 1:case"end":return n.stop()}},l)})),Q.apply(this,arguments)}function B(l){return c.apply(this,arguments)}function c(){return c=P()(d()().mark(function l(o){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,A.request)("/api/app/compose/get-task",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),c.apply(this,arguments)}function N(l){return h.apply(this,arguments)}function h(){return h=P()(d()().mark(function l(o){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,A.request)("/api/app/compose/container-deploy",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),h.apply(this,arguments)}function W(l){return S.apply(this,arguments)}function S(){return S=P()(d()().mark(function l(o){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,A.request)("/api/app/compose/container-destroy",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),S.apply(this,arguments)}function Oe(l){return f.apply(this,arguments)}function f(){return f=P()(d()().mark(function l(o){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,A.request)("/api/app/compose/container-ctrl",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),f.apply(this,arguments)}function K(l){return re.apply(this,arguments)}function re(){return re=P()(d()().mark(function l(o){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,A.request)("/api/app/compose/container-log",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),re.apply(this,arguments)}function ae(l){return z.apply(this,arguments)}function z(){return z=P()(d()().mark(function l(o){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.download=!0,o.id=String(o.id),n.next=4,(0,A.request)("/api/app/compose/container-log",{method:"POST",data:o,responseType:"blob"});case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},l)})),z.apply(this,arguments)}function q(l){return ce.apply(this,arguments)}function ce(){return ce=P()(d()().mark(function l(o){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,A.request)("/api/app/compose/get-from-uri",{method:"POST",data:o}));case 1:case"end":return n.stop()}},l)})),ce.apply(this,arguments)}function H(l){return Z.apply(this,arguments)}function Z(){return Z=P()(d()().mark(function l(o){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,A.request)("/api/common/store/deploy",{method:"POST",data:o}));case 1:case"end":return n.stop()}},l)})),Z.apply(this,arguments)}function we(l){return ie.apply(this,arguments)}function ie(){return ie=P()(d()().mark(function l(o){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,A.request)("/api/app/compose/download",{method:"POST",data:o,responseType:"blob"}));case 2:case"end":return n.stop()}},l)})),ie.apply(this,arguments)}}}]);
