"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1102],{24963:function(Y,h,r){var g=r(67294),c=(0,g.createContext)({});h.Z=c},33208:function(Y,h,r){r.r(h),r.d(h,{default:function(){return ie}});var g=r(15009),c=r.n(g),z=r(99289),C=r.n(z),$=r(5574),P=r.n($),N=r(91058),G=r(12491),H=r(24963),f=r(90098),J=r(79245),Q=r(45742),X=r(91806),k=r(27496),w=r(33862),q=r(90078),ee=r(97269),ne=r(2236),p=r(38345),te=r(52688),v=r(5966),ae=r(86615),y=r(97462),F=r(95213),B=r(95089),U=r(82346),A=r(28036),j=r(25409),re=r(63490),R=r(42075),le=r(66309),I=r(38925),ue=r(92398),se=r(91845),E=r(67294),e=r(85893);function ie(){var x=(0,E.useContext)(H.Z),D=x.loading,oe=x.notice,T=x.message,de=(0,U.useNavigate)(),_e=(0,E.useState)([]),W=P()(_e,2),me=W[0],ce=W[1],Z=(0,E.useRef)(),_=(0,E.useRef)(),ve=(0,U.useSearchParams)(),L=P()(ve,2),Ee=L[0],ye=L[1],pe=(0,E.useState)(),K=P()(pe,2),l=K[0],he=K[1],Pe=(0,E.useState)(!1),b=P()(Pe,2),S=b[0],V=b[1],O=function(){var d=C()(c()().mark(function a(n){var u,t;return c()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(n.yaml){i.next=2;break}return i.abrupt("return");case 2:return(u=_.current)===null||u===void 0||u.setFieldValue("yaml",n.yaml),M(n.yaml),i.next=6,(0,f.xC)(n);case 6:if(t=i.sent,!(!t||!t.data||!t.data.project)){i.next=10;break}return oe.error(t.data.error),i.abrupt("return");case 10:M(n.yaml,t.data.environment),t.data.project&&ce(Object.keys(t.data.project.services).map(function(o,fe){var m=t.data.project.services[o];return m.name=o,m}));case 12:case"end":return i.stop()}},a)}));return function(n){return d.apply(this,arguments)}}(),M=function(a,n){var u=(0,J.m)(a);u&&u.map(function(t){var s;(s=Z.current)===null||s===void 0||s.addEnvItem(t.name,n&&n[t.name]?n[t.name]:t.value)})};return(0,E.useEffect)(function(){var d=Ee.get("id");d&&(D.show(),(0,f.CT)({id:d}).then(function(a){var n,u,t;if(he(a.data.detail),a.data.detail.setting.type==""&&(a.data.detail.setting.type="text"),(n=_.current)===null||n===void 0||n.setFieldsValue({name:a.data.detail.name,title:a.data.detail.title,type:a.data.detail.setting.type,yaml:(u=a.data.yaml[0])!==null&&u!==void 0?u:"",yamlOverride:(t=a.data.yaml[1])!==null&&t!==void 0?t:"",environment:a.data.detail.setting.environment}),a.data.detail.setting.type=="remoteUrl"){var s;(s=_.current)===null||s===void 0||s.setFieldValue("remoteUrl",a.data.detail.setting.remoteUrl)}else if(a.data.detail.setting.type=="storagePath"){var i;(i=_.current)===null||i===void 0||i.setFieldValue("storagePath","/dpanel/compose/"+a.data.detail.setting.uri[0])}if(a.data.yaml){var o;O({yaml:(o=a.data.yaml[0])!==null&&o!==void 0?o:"",id:a.data.detail.id})}}).finally(function(){D.destroy()}))},[]),(0,e.jsx)(q._z,{header:{extra:[]},children:(0,e.jsx)(ee.A,{submitter:{render:function(a,n){return(0,e.jsxs)(ne.S,{children:[(0,e.jsx)(A.ZP,{onClick:function(){var t;(t=a.form)===null||t===void 0||t.setFieldValue("deploy",!0),a.submit()},children:"\u90E8\u7F72"}),(0,e.jsx)("span",{children:n[1]},"submit")]})}},formRef:_,onFinishFailed:function(a){V(!1)},onFinish:function(){var d=C()(c()().mark(function a(n){var u,t,s;return c()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t={type:n.type,name:n.name,title:n.title,environment:n.environment,remoteUrl:n.remoteUrl,yaml:n.yaml,yamlOverride:n.yamlOverride},l!=null&&l.id&&(t.id=l.id),o.next=4,(0,f.im)(t);case 4:return s=o.sent,(u=_.current)===null||u===void 0||u.resetFields(),de("/compose/deploy/"+s.data.id+(n.deploy?"?op=deploy":"")),o.abrupt("return",!0);case 8:case"end":return o.stop()}},a)}));return function(a){return d.apply(this,arguments)}}(),children:(0,e.jsx)(p.Z,{split:"vertical",children:(0,e.jsxs)(j.Z,{onResize:function(){},children:[(0,e.jsx)(j.Z.Panel,{resizable:!1,size:S?"0%":"45%",children:(0,e.jsxs)(p.Z,{split:"horizontal",children:[(0,e.jsxs)(p.Z,{title:(0,e.jsx)(Q.Z,{}),subTitle:"\u57FA\u7840\u4FE1\u606F",children:[(0,e.jsx)(te.Z,{label:"\u4FDD\u5B58\u540E\u9A6C\u4E0A\u90E8\u7F72",name:"deploy",hidden:!0}),(0,e.jsx)(v.Z,{label:"\u7AD9\u70B9\u540D\u79F0",name:"title",disabled:(l==null?void 0:l.setting.type)=="outPath",fieldProps:{onChange:function(a){var n="";if(a.target.value&&!l){var u,t=(0,se.N9)(a.target.value.trim(),{toneType:"none",type:"array"});n=t.join(""),(u=_.current)===null||u===void 0||u.setFieldValue("name",n)}}}}),(0,e.jsx)(v.Z,{label:"\u7AD9\u70B9\u6807\u8BC6",name:"name",required:!0,rules:[{required:!0}],disabled:!!l,placeholder:"\u6807\u8BC6Compose\u521B\u5EFA\u7684\u5BB9\u5668\u7EC4\uFF0C\u53EA\u5141\u8BB8\u4E3A\u82F1\u6587\u6216\u662F\u6570\u5B57"}),(0,e.jsx)(ae.Z.Group,{label:"Yaml \u6765\u6E90",name:"type",initialValue:"text",fieldProps:{defaultValue:"text",onChange:function(){}},options:[{label:"yaml",value:"text",disabled:l&&l.setting.type!="text"},{label:"\u8FDC\u7A0B\u5730\u5740",value:"remoteUrl",disabled:l&&(l==null?void 0:l.setting.type)!="remoteUrl"},{label:"\u81EA\u52A8\u53D1\u73B0",value:"storagePath",disabled:l&&(l==null?void 0:l.setting.type)!="storagePath"},{label:"\u5E94\u7528\u5546\u5E97",value:"store",disabled:l&&(l==null?void 0:l.setting.type)!="store"},{label:"\u5916\u90E8\u4EFB\u52A1",value:"outPath",disabled:l&&(l==null?void 0:l.setting.type)!="outPath"}]}),(0,e.jsx)(y.Z,{name:["type"],children:function(a){var n=a.type;if(n=="text")return(0,e.jsx)(G.Z,{title:"\u5BFC\u5165\u672C\u5730 compose \u6587\u4EF6",onImport:function(t){return O({yaml:t}),!0},onLoad:function(t){if(t.indexOf("services:")<0)throw new Error("\u5BFC\u5165\u7684compose\u6587\u4EF6\u9519\u8BEF");return!0}});if(n=="remoteUrl")return(0,e.jsx)(v.Z,{label:"",required:!0,rules:[{required:!0}],name:"remoteUrl",placeholder:"\u8BF7\u8F93\u5165\u8FDC\u7A0B docker-compose.yaml \u94FE\u63A5",fieldProps:{onBlur:function(){var u=C()(c()().mark(function s(i){var o;return c()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(i.target.value){m.next=2;break}return m.abrupt("return");case 2:return D.show(),m.next=5,(0,f.MG)({uri:i.target.value});case 5:o=m.sent,D.destroy(),o&&o.data&&o.data.content&&O({yaml:o.data.content});case 8:case"end":return m.stop()}},s)}));function t(s){return u.apply(this,arguments)}return t}()}});if(n=="storagePath")return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(v.Z,{name:"storagePath",required:!0,readonly:!0,initialValue:l?"".concat(l.setting.uri[0]):"\u6302\u8F7D /dpanel/compose \u76EE\u5F55\u540E\uFF0C\u81EA\u52A8\u53D1\u73B0\u3002",rules:[{required:!0,message:"\u6302\u8F7D /dpanel/compose \u76EE\u5F55\u540E\uFF0C\u81EA\u52A8\u53D1\u73B0\u3002"}]})});if(n=="store")return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(v.Z,{readonly:!0,name:"store",required:!0,initialValue:l?"".concat(l.setting.store):"\u8BF7\u5148\u6DFB\u52A0\u5E94\u7528\u5546\u5E97\u540E\uFF0C\u5728\u5E94\u7528\u5546\u5E97\u91CC\u5B8C\u6210\u5B89\u88C5",rules:[{required:!0,message:"\u8BF7\u5148\u6DFB\u52A0\u5E94\u7528\u5546\u5E97\u540E\uFF0C\u5728\u5E94\u7528\u5546\u5E97\u91CC\u5B8C\u6210\u5B89\u88C5"}]})});if(n=="outPath")return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(v.Z,{name:"outPath",required:!0,readonly:!0,initialValue:l&&"".concat(l.setting.uri[0]),rules:[{required:!0,message:"\u5916\u90E8\u4EFB\u52A1\u53EA\u53EF\u7F16\u8F91 yaml "}]})})}})]}),(0,e.jsx)(p.Z,{title:(0,e.jsx)(X.Z,{}),subTitle:"\u670D\u52A1\u5217\u8868",children:(0,e.jsx)(re.Z,{dataSource:me,rowKey:"name",pagination:!1,columns:[{title:"\u540D\u79F0",dataIndex:"name"},{title:"\u955C\u50CF",dataIndex:"image"},{title:"\u7AEF\u53E3",dataIndex:"ports",render:function(a,n,u){return n.ports&&n.ports.map(function(t,s){return(0,e.jsx)(R.Z,{size:"large",wrap:!0,children:(0,e.jsxs)(le.Z,{color:"#2db7f5",icon:t.published?(0,e.jsx)(k.Z,{}):"",style:{marginBottom:5},children:[t.published," : ",t.target]})},"space".concat(s))})}},{title:"\u4F9D\u8D56",dataIndex:"dependsOn",width:150,render:function(a,n,u){if(n.depends_on)return(0,e.jsx)(R.Z,{wrap:!0,children:Object.keys(n.depends_on).map(function(t){var s=t;return n.external_links&&n.external_links.map(function(i){i.indexOf(":"+t)>-1&&(s=i)}),s})})}}]})}),(0,e.jsxs)(p.Z,{title:(0,e.jsx)(w.Z,{}),subTitle:"\u73AF\u5883\u53D8\u91CF",children:[(0,e.jsx)(y.Z,{name:["environment"],children:function(a){var n=a.environment;if(!n||n.length==0)return(0,e.jsx)(I.Z,{message:(0,e.jsxs)(e.Fragment,{children:["\u5728 compose.yaml \u4E2D\u58F0\u660E\u73AF\u5883\u53D8\u91CF\uFF0C\u4F8B\u5982\uFF1A","${DB_NAME}"," ",(0,e.jsx)("br",{}),"\u5728\u90E8\u7F72\u65F6\u53EF\u6839\u636E\u60C5\u51B5\u8FDB\u884C\u91CD\u65B0\u8D4B\u503C\u3002"]})})}}),(0,e.jsx)(N.Z,{name:"environment",showDisableName:!0,showInDrawer:!0,showCardGhost:!0,ref:Z})]})]})}),(0,e.jsx)(j.Z.Panel,{children:(0,e.jsx)(p.Z,{children:(0,e.jsx)(ue.Z,{tabBarExtraContent:(0,e.jsx)(A.ZP,{type:"link",onClick:function(){V(!S)},children:"\u5168\u5C4F"}),items:[{label:"Yaml \u6587\u4EF6",key:"compose",children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(v.Z,{name:"yaml",hidden:!0}),(0,e.jsx)(y.Z,{name:["type","yaml"],children:function(a){var n=a.type,u=a.yaml;return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(B.ZP,{theme:"dark",minHeight:"550px",onFocus:function(){if(n=="remoteUrl"){T.error("\u8FDC\u7A0Byaml\u6587\u4EF6\u65E0\u6CD5\u4FEE\u6539\uFF0C\u8BF7\u901A\u8FC7\u3010\u8986\u76D6 yaml \u6587\u4EF6\u3011\u7684\u65B9\u5F0F\u4FEE\u6539\u5185\u5BB9\u3002");return}if(n=="store"){T.warning("\u4E3A\u4E86\u4FDD\u8BC1\u5546\u5E97\u4E2D\u7684 compose.yaml \u6587\u4EF6\u53EF\u4EE5\u968F\u65F6\u66F4\u65B0\uFF0C\u5EFA\u8BAE\u901A\u8FC7\u3010\u8986\u76D6 yaml \u6587\u4EF6\u3011\u7684\u65B9\u5F0F\u4FEE\u6539\u5185\u5BB9\u3002");return}},onChange:function(s,i){var o;(o=_.current)===null||o===void 0||o.setFieldValue("yaml",s)},onBlur:function(){var s;O({yaml:(s=_.current)===null||s===void 0?void 0:s.getFieldValue("yaml"),id:l==null?void 0:l.id})},readOnly:n=="remoteUrl",value:u,extensions:[F.RI.yaml()]})})}})]})},{label:"\u8986\u76D6 Yaml \u6587\u4EF6",key:"override",children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(I.Z,{style:{marginBottom:20},message:(0,e.jsxs)(e.Fragment,{children:["\u8986\u76D6\u6587\u4EF6\uFF0C\u5141\u8BB8\u4F60\u5728\u4E0D\u6539\u52A8\u539F\u59CB Yaml \u6587\u4EF6\u7684\u60C5\u51B5\u4E0B\uFF0C\u8986\u76D6\u539F\u59CB\u6587\u4EF6\u4E2D\u7684\u4E00\u4E9B\u53C2\u6570\u914D\u7F6E\u3002",(0,e.jsx)("a",{href:"https://dpanel.cc/#/zh-cn/manual/compose/override",target:"_blank",children:"\u5982\u4F55\u914D\u7F6E\uFF1F"})]})}),(0,e.jsx)(v.Z,{name:"yamlOverride",hidden:!0}),(0,e.jsx)(y.Z,{name:["yamlOverride"],children:function(a){var n=a.yamlOverride;return(0,e.jsx)(B.ZP,{theme:"dark",minHeight:"550px",onChange:function(t,s){var i;(i=_.current)===null||i===void 0||i.setFieldValue("yamlOverride",t)},value:n,onBlur:function(){var t;M((t=_.current)===null||t===void 0?void 0:t.getFieldValue("yamlOverride"))},extensions:[F.RI.yaml()]})}})]})}]})})})]})})},"create")})}}}]);
