"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8195],{75293:function(k,C,r){r.d(C,{Z:function(){return O}});var M=r(25593),_=r(85893);function O(h){return(0,_.jsx)(M.Z.Text,{copyable:!0,style:{padding:10,display:h.block?"block":"",background:"#24292f",color:"#ffffff"},children:h.content})}},77273:function(k,C,r){var M=r(15009),_=r.n(M),O=r(99289),h=r.n(O),j=r(5574),g=r.n(j),x=r(184),c=r(5966),b=r(86615),D=r(97462),U=r(64317),p=r(52688),f=r(62370),a=r(38345),Y=r(31199),i=r(90672),K=r(71230),S=r(15746),$=r(42075),L=r(86250),N=r(40056),I=r(67294),J=r(91845),F=r(87662),W=r(12491),G=r(89035),V=r(36146),w=r(3616),Q=r(75293),R=r(2831),e=r(85893),z=(0,I.forwardRef)(function(A,X){var Z;(0,I.useImperativeHandle)(X,function(){return{edit:function(t){var n,l=t.address.split("://"),u=g()(l,2),v=u[0],P=u[1];(n=m.current)===null||n===void 0||n.setFieldsValue({name:t.name,title:t.title,addressType:"".concat(v=="ssh"?"tcp":v,"://"),address:P,serverUrl:t.serverUrl,enableTLS:t.enableTLS,tlsCa:t.tlsCa,tlsCert:t.tlsCert,tlsKey:t.tlsKey,enableComposePath:t.enableComposePath,enableSSH:t.enableSSH,sshServerInfo:t.sshServerInfo,remoteType:t.remoteType?t.remoteType:"docker"}),re(!0),se(t.name)}}}),(0,I.useEffect)(function(){(0,R.aF)().then(function(E){E.data.rsa.public&&q(E.data.rsa.public)})},[]);var H=(0,I.useState)(),B=g()(H,2),y=B[0],q=B[1],s=new V.Uo("components.dockerEnvCreate"),ae=(0,I.useState)(!1),ee=g()(ae,2),oe=ee[0],re=ee[1],m=(0,I.useRef)(),le=(0,I.useState)(""),ne=g()(le,2),te=ne[0],se=ne[1];return(0,e.jsxs)(x.a,{drawerProps:{forceRender:!0,width:w.R_},onOpenChange:function(t){if(!t){var n;se(""),(n=m.current)===null||n===void 0||n.resetFields()}re(t)},open:oe,width:800,trigger:A.trigger,formRef:m,title:s.format((Z=m.current)!==null&&Z!==void 0&&Z.getFieldValue&&m.current.getFieldValue("name")=="local"?"drawerTitleDefault":"drawerTitle"),onFinish:function(){var E=h()(_()().mark(function t(n){var l,u,v,P;return _()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return u="",n.remoteType&&n.remoteType=="ssh"?u="ssh://":u=(v=n.addressType)!==null&&v!==void 0?v:"unix://",o.next=4,(0,F.ad)({name:n.name,title:n.title,address:"".concat(u).concat((l=n.address)!==null&&l!==void 0?l:n.sshServerInfo.address),serverUrl:n.serverUrl,enableTLS:n.enableTLS,tlsCa:n.tlsCa,tlsCert:n.tlsCert,tlsKey:n.tlsKey,enableComposePath:n.enableComposePath,composePath:n.enableComposePath?n.composePath:"",enableSSH:n.enableSSH||n.remoteType=="ssh",sshServerInfo:n.sshServerInfo,remoteType:n.remoteType});case 4:return P=o.sent,A.onFinish&&A.onFinish(),o.abrupt("return",!0);case 7:case"end":return o.stop()}},t)}));return function(t){return E.apply(this,arguments)}}(),children:[(0,e.jsx)(c.Z,{label:s.format("formTitle"),name:"title",required:!0,rules:[{required:!0}],fieldProps:{id:"envTitle",onChange:function(t){var n="";if(t.target.value&&!te){var l,u=(0,J.N9)(t.target.value.trim(),{toneType:"none",type:"array"});n=u.join(""),(l=m.current)===null||l===void 0||l.setFieldValue("name",n)}}}},"envTitle"),(0,e.jsx)(c.Z,{label:s.format("formName"),name:"name",required:!0,disabled:te!="",rules:[{required:!0}],placeholder:s.format("formNameEmpty")}),(0,e.jsx)(c.Z,{tooltip:s.format("formServerUrlTip"),label:s.format("formServerUrl"),name:"serverUrl",placeholder:s.format("formServerUrlEmpty")}),(0,e.jsx)(b.Z.Group,{label:s.format("formRemoteType"),name:"remoteType",options:[{label:"DockerApi",value:"docker"},{label:"SSH",value:"ssh"}]}),(0,e.jsx)(D.Z,{name:["remoteType","name"],children:function(t){var n=t.remoteType,l=t.name;return(0,e.jsxs)(e.Fragment,{children:[n=="docker"&&(0,e.jsx)(K.Z,{children:(0,e.jsx)(S.Z,{span:24,children:(0,e.jsxs)($.Z.Compact,{children:[(0,e.jsx)(U.Z,{name:"addressType",label:s.format("formAddressType"),valueEnum:{"unix://":"unix://","tcp://":"tcp://"},initialValue:"tcp://",fieldProps:{defaultValue:"tcp://"},width:"sm",tooltip:s.format("formAddressTypeTip")}),(0,e.jsx)(c.Z,{label:" ",name:"address",required:!0,width:"xl",rules:[{required:!0}],placeholder:s.format("formAddressEmpty")})]})})}),(0,e.jsxs)(K.Z,{gutter:[15,0],children:[n=="docker"&&(0,e.jsx)(S.Z,{children:(0,e.jsx)(p.Z,{label:s.format("formEnableTLS"),name:"enableTLS",tooltip:s.format("formEnableTLSTip")})}),l!="local"&&typeof n!="undefined"&&(0,e.jsx)(S.Z,{children:(0,e.jsx)(p.Z,{label:s.format("formEnableComposePath"),name:"enableComposePath",tooltip:s.format("formEnableComposePathTip")})}),n=="docker"&&(0,e.jsx)(S.Z,{children:(0,e.jsx)(p.Z,{label:s.format("formEnableSSH"),name:"enableSSH"})})]})]})}}),(0,e.jsx)(D.Z,{name:["enableTLS","remoteType"],children:function(t){var n=t.enableTLS,l=t.remoteType;if(n&&l=="docker"){var u,v,P;return(0,e.jsxs)(L.Z,{gap:10,justify:"start",children:[(0,e.jsx)(f.Z,{name:"tlsCa",label:s.format("formTlsCa"),children:(0,e.jsx)(W.Z,{showPaset:!0,data:(u=m.current)===null||u===void 0?void 0:u.getFieldValue("tlsCa"),title:"ca.pem",onImport:function(o){var T;return(T=m.current)===null||T===void 0||T.setFieldValue("tlsCa",o),!0},onLoad:function(o){if(o.indexOf("CERTIFICATE")<0)throw new Error(s.format("formEnableTLSMessageUploadError",{name:"ca.pem"}));return!0}})}),(0,e.jsx)(f.Z,{name:"tlsCert",label:" ",children:(0,e.jsx)(W.Z,{showPaset:!0,data:(v=m.current)===null||v===void 0?void 0:v.getFieldValue("tlsCert"),title:"cert.pem",onImport:function(o){var T;return(T=m.current)===null||T===void 0||T.setFieldValue("tlsCert",o),!0},onLoad:function(o){if(o.indexOf("CERTIFICATE")<0)throw new Error(s.format("formEnableTLSMessageUploadError",{name:"cert.pem"}));return!0}})}),(0,e.jsx)(f.Z,{label:" ",name:"tlsKey",children:(0,e.jsx)(W.Z,{showPaset:!0,data:(P=m.current)===null||P===void 0?void 0:P.getFieldValue("tlsKey"),title:"key.pem",onImport:function(o){var T;return(T=m.current)===null||T===void 0||T.setFieldValue("tlsKey",o),!0},onLoad:function(o){if(o.indexOf("PRIVATE")<0)throw new Error(s.format("formEnableTLSMessageUploadError",{name:"key.pem"}));return!0}})})]})}}}),(0,e.jsx)(D.Z,{name:["enableComposePath","name"],children:function(t){var n=t.enableComposePath,l=t.name;if(n)return(0,e.jsx)(c.Z,{label:s.format("formComposePath"),name:"composePath",disabled:!0,fieldProps:{value:"/dpanel/compose/compose-".concat(l!=null?l:"")}})}}),(0,e.jsx)(D.Z,{name:["enableSSH","sshServerInfo","remoteType","address"],children:function(t){var n=t.enableSSH,l=t.sshServerInfo,u=t.remoteType,v=t.address;return(n||u=="ssh")&&[(0,e.jsxs)(a.Z,{title:(0,e.jsx)(G.Z,{}),subTitle:s.format("formEnableSSHTitle"),ghost:!0,children:[(0,e.jsxs)(e.Fragment,{children:[u=="ssh"&&(0,e.jsx)(f.Z,{children:(0,e.jsx)(N.Z,{message:(0,e.jsxs)(e.Fragment,{children:[s.format("formEnableSSHAlert")," \xA0",(0,e.jsx)("a",{href:"https://dpanel.cc/manual/system-env#ssh",target:"_blank",children:V.FD.format("help")})]})})}),(0,e.jsx)(c.Z,{label:s.format("formSshServerInfoAddress"),placeholder:s.format("formSshServerInfoAddressEmpty"),name:["sshServerInfo","address"],required:!0,rules:[{required:!0}]})]}),(0,e.jsxs)(K.Z,{children:[(0,e.jsx)(S.Z,{children:(0,e.jsx)(Y.Z,{initialValue:22,label:s.format("formSshServerInfoPort"),name:["sshServerInfo","port"]})}),(0,e.jsx)(S.Z,{offset:2,children:(0,e.jsx)(c.Z,{width:"lg",label:s.format("formSshServerInfoUsername"),name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]})})]}),(0,e.jsx)(b.Z.Group,{label:s.format("formSshServerInfoAuthType"),name:["sshServerInfo","authType"],options:s.option("formSshServerInfoAuthTypeOption",["basic","pem","pemDefault"]),fieldProps:{onChange:function(){var d;(d=m.current)===null||d===void 0||d.setFieldValue(["sshServerInfo","password"],"")}},required:!0,rules:[{required:!0}]}),l&&l.authType=="basic"&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(c.Z.Password,{label:s.format("formSshServerInfoPassword"),name:["sshServerInfo","password"],required:!0,rules:[{required:!0}]})}),l&&l.authType=="pem"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(W.Z,{title:s.format("formSshServerInfoPrivateKeyImport"),onImport:function(d){var o;return(o=m.current)===null||o===void 0||o.setFieldValue(["sshServerInfo","privateKey"],d),!0},onLoad:function(d){if(!d.includes("PRIVATE KEY"))throw new Error(s.format("formEnableTLSMessageUploadError",{name:"private.key"}));return!0}}),(0,e.jsx)(i.Z,{name:["sshServerInfo","privateKey"],label:s.format("formSshServerInfoPrivateKey"),required:!0,rules:[{required:!0}]}),(0,e.jsx)(c.Z.Password,{name:["sshServerInfo","password"],label:s.format("formSshServerInfoPrivateKeyPassword")})]}),l&&l.authType=="pemDefault"&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(D.Z,{name:["sshServerInfo"],children:function(d){var o=d.sshServerInfo;if(!(!o||!o.username))return[(0,e.jsx)(N.Z,{message:s.format("formSshServerInfoAddPublicKey",{user:o.username}),style:{marginBottom:15}},"message"),y&&(0,e.jsx)(Q.Z,{content:'mkdir -p ~/.ssh && chmod 700 ~/.ssh && ! grep -q "'.concat(y.substring(y.length/2,y.length/2+18),`" ~/.ssh/authorized_keys 2>/dev/null && echo "
`).concat(y,'" >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys'),block:!0},"copycode")]}})})]},"sshSetting")]}})]})});C.Z=z},12491:function(k,C,r){r.d(C,{Z:function(){return Y}});var M=r(5574),_=r.n(M),O=r(3616),h=r(24963),j=r(36146),g=r(88484),x=r(57546),c=r(62370),b=r(11106),D=r(42075),U=r(83622),p=r(85576),f=r(67294),a=r(85893);function Y(i){var K=(0,f.useContext)(h.Z),S=K.message,$=K.notice,L=(0,f.useRef)(null),N=(0,f.useState)(!1),I=_()(N,2),J=I[0],F=I[1],W=(0,f.useState)(""),G=_()(W,2),V=G[0],w=G[1];(0,f.useEffect)(function(){i.data&&w(i.data)},[i.data]);var Q=function(){L.current&&(L.current.click(),L.current.onchange=function(e){if(!e||!e.target)return"";var z=new FileReader;z.onload=function(Z){var H,B,y=(H=Z.target)===null||H===void 0?void 0:H.result;if(i.onLoad)try{i.onLoad&&i.onLoad(y)}catch(q){$.error(q);return}w(y),typeof i.onImport=="function"&&(S.success(j.FD.format("finish")),i.onImport(y)),(B=L.current)!==null&&B!==void 0&&B.value&&(L.current.value="")};var A=e.target;if(A.files&&A.files[0]){var X=A.files[0];try{z.readAsText(X)}catch(Z){$.error(j.FD.format("commonContentIncorrectFormat",{name:A.files[0].name}))}}})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{children:(0,a.jsxs)(D.Z.Compact,{block:!0,children:[(0,a.jsx)(U.ZP,{icon:(0,a.jsx)(g.Z,{}),block:!0,onClick:Q,children:i.title}),i.showPaset&&(0,a.jsx)(U.ZP,{icon:(0,a.jsx)(x.Z,{}),onClick:function(){F(!0)}})]})}),(0,a.jsx)("input",{style:{display:"none"},type:"file",ref:L,name:"importFileInput"}),(0,a.jsx)(p.Z,{width:O.ob,open:J,onCancel:function(){F(!1)},onOk:function(){typeof i.onImport=="function"&&(S.success(j.FD.format("finish")),i.onImport(V)),F(!1)},children:(0,a.jsx)(b.ZP,{height:O.Ed,theme:"dark",value:V,onChange:function(e){w(e)}})})]})}},3616:function(k,C,r){r.d(C,{Ed:function(){return h},FK:function(){return _},R_:function(){return M},ob:function(){return O}});var M=window.innerWidth<=1024?"90vw":"65vw",_="90vw",O="60vw",h="50vh"},2831:function(k,C,r){r.d(C,{Ll:function(){return D},aF:function(){return g},u5:function(){return c}});var M=r(15009),_=r.n(M),O=r(99289),h=r.n(O),j=r(82346);function g(){return x.apply(this,arguments)}function x(){return x=h()(_()().mark(function p(){return _()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,j.request)("/api/common/home/info",{method:"POST"});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},p)})),x.apply(this,arguments)}function c(){return b.apply(this,arguments)}function b(){return b=h()(_()().mark(function p(){return _()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,j.request)("/api/common/home/check-new-version",{method:"POST"});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},p)})),b.apply(this,arguments)}function D(){return U.apply(this,arguments)}function U(){return U=h()(_()().mark(function p(){return _()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,j.request)("/api/common/home/usage",{method:"POST"});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},p)})),U.apply(this,arguments)}}}]);
