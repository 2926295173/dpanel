"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1180],{44349:function(ee,S,e){var H=e(97857),j=e.n(H),z=e(15009),g=e.n(z),Y=e(99289),F=e.n(Y),J=e(74763),T=e(17186),Q=e(5966),V=e(86250),C=e(67294),p=e(85893),N=(0,C.forwardRef)(function(l,G){var M=(0,C.useRef)();(0,C.useImperativeHandle)(G,function(){return{addItem:function(W){function s(u,h,n){return W.apply(this,arguments)}return s.toString=function(){return W.toString()},s}(function(W,s,u){var h,n=(h=M.current)===null||h===void 0?void 0:h.getList(),r;if(n==null||n.forEach(function(B,y){B[W]==s[W]&&(r=y)}),!(0,J.k)(r)&&u){var L;(L=M.current)===null||L===void 0||L.remove(r),r=void 0}if(!r){var d;(d=M.current)===null||d===void 0||d.add(s)}}),removeItemByKey:function(s,u){return F()(g()().mark(function h(){var n,r;return g()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return r=(n=M.current)===null||n===void 0?void 0:n.getList(),r==null||r.forEach(function(B,y){if(B[s]==u){var x;(x=M.current)===null||x===void 0||x.remove(y);return}}),d.abrupt("return");case 3:case"end":return d.stop()}},h)}))()},clear:function(s){if(!s){var u;s=(u=M.current)===null||u===void 0||(u=u.getList())===null||u===void 0?void 0:u.map(function(n,r){return r})}if(s){var h;(h=M.current)===null||h===void 0||h.remove(s)}},getList:function(){var s;return(s=M.current)===null||s===void 0?void 0:s.getList()}}});var K={};return l.hideCopyButton===!0&&(K.copyIconProps=!1),l.hideDeleteButton===!0&&(K.deleteIconProps=!1),(0,p.jsx)(T.u,j()(j()({initialValue:l.initialValue,label:l.label,name:l.name,actionRef:M,creatorButtonProps:l.showAddButton?{creatorButtonText:l.label?l.label:l.showAddButtonLabel?l.showAddButtonLabel:l.name}:!1,min:l.min?l.min:0},K),{},{children:function(s,u,h){return(0,p.jsx)(V.Z,{justify:l.justify,gap:l.gap,children:l.items.map(function(n){return n.render?(0,p.jsx)("div",{children:n.render&&n.render(s,u,h)},"".concat(l.name,"-").concat(n.name,"-").concat(s.key)):(0,p.jsx)(Q.Z,{width:n.width,name:n.name,label:n.label,required:n.required,rules:[{required:n.required}],disabled:n.disabled,placeholder:n.placeholder},"".concat(l.name,"-").concat(n.name,"-").concat(s.key))})})}}))});S.Z=N},36435:function(ee,S,e){var H=e(15009),j=e.n(H),z=e(64599),g=e.n(z),Y=e(99289),F=e.n(Y),J=e(9783),T=e.n(J),Q=e(5574),V=e.n(Q),C=e(67294),p=e(184),N=e(38345),l=e(97269),G=e(97321),M=e(97462),K=e(64317),W=e(5966),s=e(86615),u=e(68602),h=e(83622),n=e(83403),r=e(24963),L=e(1699),d=e(29177),B=e(1883),y=e(43425),x=e(44349),X=e(3616),w=e(36146),i=e(85893),$=(0,C.forwardRef)(function(A,ne){var R=(0,C.useState)(!1),O=V()(R,2),v=O[0],t=O[1],_=(0,C.useRef)(),a=(0,C.useContext)(r.Z),Z=a.message,k=(0,C.useState)([]),ae=V()(k,2),q=ae[0],re=ae[1],U=new w.Uo("components.permissionButton"),te=T()(T()(T()(T()(T()({},n.W6.CONTAINER,"Id"),n.W6.APPSTORE,"name"),n.W6.COMPOSE,"name"),n.W6.REGISTRY,"serverAddress"),n.W6.DOCKER_ENV,"name"),oe=T()(T()(T()(T()(T()({},n.W6.CONTAINER,"name"),n.W6.APPSTORE,"name"),n.W6.COMPOSE,"name"),n.W6.REGISTRY,"title"),n.W6.DOCKER_ENV,"title"),_e=te[A.type],le=oe[A.type],ue=A.selected.map(function(m){return m[te[A.type]]});return C.useEffect(function(){if(v){if(!A.selected||A.selected.length==0){Z.error(w.FD.format("title.noDataSelect")),t(!1);return}(0,u.dP)({permission:{uri:A.type,key:_e,value:ue}}).then(function(m){var o;(o=_.current)===null||o===void 0||o.setFieldValue("list",Object.keys(m.data.list).map(function(c){return{name:c,type:m.data.list[c].type,users:m.data.list[c].users}}))}),(0,u.lE)().then(function(m){var o,c=(o=m.data)===null||o===void 0||(o=o.list)===null||o===void 0?void 0:o.map(function(E){return{label:E.username,value:E.username}});re(c)})}},[v]),(0,i.jsx)(L.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,i.jsxs)(p.a,{name:"create",title:U.format("drawerTitle"),open:v,onOpenChange:function(o){if(!o){var c;(c=_.current)===null||c===void 0||c.resetFields()}t(o)},drawerProps:{forceRender:!0,width:X.R_},formRef:_,trigger:(0,i.jsx)(h.ZP,{icon:(0,i.jsx)(d.Z,{}),children:U.format("drawerTriggerButton")}),onFinish:function(){var m=F()(j()().mark(function o(c){var E,P,f;return j()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:E=g()(c.list),D.prev=1,E.s();case 3:if((P=E.n()).done){D.next=9;break}return f=P.value,D.next=7,(0,u.Db)({usernames:f.users,permissionType:f.type,permission:{uri:A.type,key:_e,showKey:le,value:[f.name]}});case 7:D.next=3;break;case 9:D.next=14;break;case 11:D.prev=11,D.t0=D.catch(1),E.e(D.t0);case 14:return D.prev=14,E.f(),D.finish(14);case 17:Z.success(w.FD.format("finish")),t(!1),A.onSuccess();case 20:case"end":return D.stop()}},o,null,[[1,11,14,17]])}));return function(o){return m.apply(this,arguments)}}(),children:[(0,i.jsxs)(N.Z,{ghost:!0,title:(0,i.jsx)(B.Z,{}),subTitle:U.format("batchTitle"),children:[(0,i.jsx)(l.A.Item,{name:"type",style:{marginBottom:0},children:(0,i.jsx)(G.Z.Group,{defaultValue:"admin",onChange:function(o){var c,E,P=(c=_.current)===null||c===void 0?void 0:c.getFieldValue("list");P.forEach(function(f){f.type=o,f.users=[]}),(E=_.current)===null||E===void 0||E.setFieldValue("list",P)},children:["admin","restricted","public"].map(function(m){return(0,i.jsx)(G.Z,{style:{width:240},title:U.format("dataTypeOption.".concat(m)),description:U.format("dataTypeDescOption.".concat(m)),value:m},m)})})}),(0,i.jsx)(M.Z,{name:["type"],children:function(o){var c=o.type;if(c==="restricted")return(0,i.jsx)(K.Z,{mode:"multiple",name:"usernames",label:U.format("formUsernames"),onChange:function(P){var f,b,D=(f=_.current)===null||f===void 0?void 0:f.getFieldValue("list");D.forEach(function(I){I.users=P}),(b=_.current)===null||b===void 0||b.setFieldValue("list",D)},rules:[{required:!0}],request:F()(j()().mark(function E(){var P,f,b;return j()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!(q.length>0)){I.next=2;break}return I.abrupt("return",q);case 2:return I.next=4,(0,u.lE)();case 4:return f=I.sent,b=(P=f.data)===null||P===void 0||(P=P.list)===null||P===void 0?void 0:P.map(function(se){return{label:se.username,value:se.username}}),re(b),I.abrupt("return",b);case 8:case"end":return I.stop()}},E)}))})}})]}),(0,i.jsx)(N.Z,{ghost:!0,title:(0,i.jsx)(y.Z,{}),subTitle:U.format("dataTitle"),children:(0,i.jsx)(x.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:U.format("dataName"),render:function(o,c,E){var P=E.getCurrentRowData();return(0,i.jsx)(W.Z,{disabled:!0,label:U.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:U.format("dataType"),render:function(o,c,E){var P=E.getCurrentRowData();return(0,i.jsx)(s.Z.Group,{label:U.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(f){return{label:U.format("dataTypeOption.".concat(f)),value:f}})})}},{name:"users",label:U.format("dataUsers"),render:function(o,c,E){return(0,i.jsx)(M.Z,{name:["type"],children:function(f){var b=f.type;if(b=="restricted")return(0,i.jsx)(K.Z,{width:"sm",mode:"tags",name:"users",label:U.format("dataUsers"),options:q})}})}}]})})]})})});S.Z=$},98163:function(ee,S,e){e.r(S),e.d(S,{default:function(){return L}});var H=e(15009),j=e.n(H),z=e(99289),g=e.n(z),Y=e(80821),F=e(77273),J=e(36435),T=e(98510),Q=e(83403),V=e(24963),C=e(87662),p=e(36146),N=e(86548),l=e(82061),G=e(74453),M=e(82346),K=e(83622),W=e(42075),s=e(96074),u=e(25593),h=e(83062),n=e(67294),r=e(85893);function L(){var d=(0,n.useRef)(),B=(0,n.useRef)(),y=(0,M.useModel)("@@initialState"),x=y.refresh,X=y.initialState,w=(0,n.useContext)(V.Z),i=w.message,$=(0,M.useLocation)(),A=(0,M.useNavigate)(),ne=new p.Uo("system.env");return(0,n.useEffect)(function(){var R=$.state;if(R){if(A(".",{replace:!0}),R&&R.item){var O;(O=B.current)===null||O===void 0||O.edit(R.item)}if(R&&R.name){var v,t,_=X==null||(v=X.dockerEnv)===null||v===void 0?void 0:v.list.find(function(a){return a.name==R.name});_&&((t=B.current)===null||t===void 0||t.edit(_))}}},[$.state]),(0,r.jsx)(G._z,{header:{extra:[(0,r.jsx)(F.Z,{trigger:(0,r.jsx)(K.ZP,{type:"primary",children:ne.format("createButton")}),ref:B,onFinish:g()(j()().mark(function R(){var O,v,t;return j()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=$.state,!(t&&t.item)){a.next=6;break}return a.next=4,(0,C.vC)({name:t.item.name});case 4:return A($.pathname,{replace:!0,state:null}),a.abrupt("return");case 6:x(),!((O=d.current)===null||O===void 0)&&O.reloadAndRest&&((v=d.current)===null||v===void 0||v.reloadAndRest());case 8:case"end":return a.stop()}},R)}))},"dockerEnvCreate")]},children:(0,r.jsx)(T.C,{rowKey:"name",columns:[{title:p.FD.format("listName"),dataIndex:"name"},{title:p.FD.format("listTitle"),dataIndex:"title"},{title:p.FD.format("listTargetAddress"),dataIndex:"address"},{title:p.FD.format("listManage"),width:50,search:!1,render:function(O,v,t,_,a){return(0,r.jsx)(W.Z,{split:(0,r.jsx)(s.Z,{type:"vertical"}),children:(0,r.jsx)(u.Z.Link,{onClick:function(){var k;(k=B.current)===null||k===void 0||k.edit(v)},children:(0,r.jsx)(h.Z,{title:p.FD.format("listManageEdit"),children:(0,r.jsx)(N.Z,{})})},v.name)})}}],pagination:!1,request:g()(j()().mark(function R(){var O;return j()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,C.Kg)({enableCertContent:!0});case 2:return O=t.sent,t.abrupt("return",{data:O.data.list,total:O.data.list.length});case 4:case"end":return t.stop()}},R)})),search:!1,actionRef:d,quickToolbarRender:function(O){var v=O.selectedRows;return(0,r.jsxs)(W.Z,{size:16,children:[(0,r.jsx)(J.Z,{type:Q.W6.DOCKER_ENV,selected:v,onSuccess:function(){var _,a;return!((_=d.current)===null||_===void 0)&&_.reloadAndRest&&((a=d.current)===null||a===void 0||a.reloadAndRest()),!0}},"permissionButton"),(0,r.jsx)(Y.Z,{buttonProps:{danger:!0,type:"primary",icon:(0,r.jsx)(l.Z,{})},action:g()(j()().mark(function t(){return j()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!v.find(function(Z){return Z.default})){a.next=3;break}return i.warning(p.FD.format("systemEnvDefaultCannotDelete")),a.abrupt("return",!1);case 3:return a.abrupt("return",(0,C._g)({name:v.map(function(Z){return Z.name})}));case 4:case"end":return a.stop()}},t)})),onSuccess:function(){var _,a;return!((_=d.current)===null||_===void 0)&&_.reloadAndRest&&((a=d.current)===null||a===void 0||a.reloadAndRest()),!0},onError:function(){var _,a;return!((_=d.current)===null||_===void 0)&&_.reset&&((a=d.current)===null||a===void 0||a.reset()),!0},confirmProps:{showCommonConfirm:!0},children:p.FD.format("listManageDeleteBatch")})]})}})})}}}]);
