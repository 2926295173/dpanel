"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8195],{77273:function(b,T,r){var p=r(15009),j=r.n(p),L=r(99289),O=r.n(L),S=r(5574),B=r.n(S),f=r(184),i=r(5966),_=r(86615),m=r(97462),v=r(64317),c=r(52688),g=r(62370),E=r(38345),R=r(31199),I=r(90672),C=r(71230),P=r(15746),K=r(42075),U=r(86250),Z=r(38925),A=r(67294),l=r(91845),a=r(87662),t=r(12491),e=r(52756),D=r(89035),n=r(85893),Y=(0,A.forwardRef)(function(W,J){var y;(0,A.useImperativeHandle)(J,function(){return{edit:function(u){var s,o=URL.parse(u.address);(s=M.current)===null||s===void 0||s.setFieldsValue({name:u.name,title:u.title,addressType:"".concat(o==null?void 0:o.protocol,"//"),address:"".concat(o!=null&&o.host&&o.host!=""?o.host:o==null?void 0:o.pathname),serverUrl:u.serverUrl,enableTLS:u.enableTLS,tlsCa:u.tlsCa,tlsCert:u.tlsCert,tlsKey:u.tlsKey,enableComposePath:u.enableComposePath,enableSSH:u.enableSSH,sshServerInfo:u.sshServerInfo,remoteType:u.remoteType?u.remoteType:"docker"}),$(!0),N(u.name)}}});var Q=(0,A.useState)(!1),w=B()(Q,2),X=w[0],$=w[1],M=(0,A.useRef)(),q=(0,A.useState)(""),G=B()(q,2),z=G[0],N=G[1];return(0,n.jsxs)(f.a,{drawerProps:{forceRender:!0},onOpenChange:function(u){if(!u){var s;N(""),(s=M.current)===null||s===void 0||s.resetFields()}$(u)},open:X,width:800,trigger:W.trigger,formRef:M,title:(y=M.current)!==null&&y!==void 0&&y.getFieldValue&&M.current.getFieldValue("name")=="local"?"\u914D\u7F6E\u9ED8\u8BA4Docker\u670D\u52A1\u7AEF":"\u6DFB\u52A0\u8FDC\u7A0BDocker\u670D\u52A1\u7AEF",onFinish:function(){var F=O()(j()().mark(function u(s){var o,d;return j()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,a.ad)({name:s.name,title:s.title,address:"".concat((o=s.addressType)!==null&&o!==void 0?o:"unix://").concat(s.address),serverUrl:s.serverUrl,enableTLS:s.enableTLS,tlsCa:s.tlsCa,tlsCert:s.tlsCert,tlsKey:s.tlsKey,enableComposePath:s.enableComposePath,composePath:s.enableComposePath?s.composePath:"",enableSSH:s.enableSSH||s.remoteType=="ssh",sshServerInfo:s.sshServerInfo,remoteType:s.remoteType});case 2:return d=x.sent,W.onFinish&&W.onFinish(),x.abrupt("return",!0);case 5:case"end":return x.stop()}},u)}));return function(u){return F.apply(this,arguments)}}(),children:[(0,n.jsx)(i.Z,{label:"\u540D\u79F0",name:"title",required:!0,rules:[{required:!0}],fieldProps:{id:"envTitle",onChange:function(u){var s="";if(u.target.value&&!z){var o,d=(0,l.N9)(u.target.value.trim(),{toneType:"none",type:"array"});s=d.join(""),(o=M.current)===null||o===void 0||o.setFieldValue("name",s)}}}},"envTitle"),(0,n.jsx)(i.Z,{label:"\u6807\u8BC6",name:"name",required:!0,disabled:z!="",rules:[{required:!0}],placeholder:"\u6807\u8BC6Docker\u73AF\u5883\uFF0C\u53EA\u5141\u8BB8\u4E3A\u82F1\u6587\u6216\u662F\u6570\u5B57"}),(0,n.jsx)(i.Z,{tooltip:"\u8BBE\u7F6E\u5BBF\u4E3B\u673A\u7684Ip\u6216\u662F\u57DF\u540D\uFF0C\u7528\u4E8E\u901A\u8FC7\u7AEF\u53E3\u7684\u5F62\u5F0F\u8BBF\u95EE\u5BB9\u5668\u3002\u652F\u6301IpV4\u53CAIpV6",label:"\u5BB9\u5668\u7AEF\u53E3\u8BBF\u95EE\u57DF\u540D",name:"serverUrl",placeholder:"\u4F8B\u5982:192.168.1.25\u30012001:db8:1::2\u3001example.com"}),(0,n.jsx)(_.Z.Group,{label:"\u8FDE\u63A5\u65B9\u5F0F",name:"remoteType",valueEnum:{docker:"Docker Api",ssh:"SSH"}}),(0,n.jsx)(m.Z,{name:["remoteType","name"],children:function(u){var s=u.remoteType,o=u.name;return(0,n.jsxs)(n.Fragment,{children:[s=="docker"&&(0,n.jsx)(C.Z,{children:(0,n.jsx)(P.Z,{span:24,children:(0,n.jsxs)(K.Z.Compact,{children:[(0,n.jsx)(v.Z,{name:"addressType",label:"Docker Api \u5730\u5740",valueEnum:{"unix://":"unix://","tcp://":"tcp://"},fieldProps:{defaultValue:"unix://"},tooltip:"\u8FDE\u63A5\u8FDC\u7A0B Docker \u65F6\u8BF7\u5148\u5F00\u542F Api \u5730\u5740\u8BBF\u95EE\u3002"}),(0,n.jsx)(i.Z,{label:" ",name:"address",required:!0,width:"xl",rules:[{required:!0}],placeholder:"\u4F8B\u5982\uFF1Aunix:///var/run/docker.sock\u3001tcp://192.16.0.5:2375"})]})})}),(0,n.jsxs)(C.Z,{gutter:[15,0],children:[s=="docker"&&(0,n.jsx)(P.Z,{children:(0,n.jsx)(c.Z,{label:"\u542F\u7528 Docker Api TLS",name:"enableTLS",tooltip:"\u751F\u6210\u6559\u7A0B\u89C1\uFF1Ahttps://donknap.github.io/dpanel-docs/#/zh-cn/manual/remote"})}),o!="local"&&typeof s!="undefined"&&(0,n.jsx)(P.Z,{children:(0,n.jsx)(c.Z,{label:(0,e.getLang)("system.env.createEnableComposePath"),name:"enableComposePath",tooltip:"\u5F00\u542F\u72EC\u7ACBcompose\u914D\u7F6E\u540E\uFF0C\u5207\u6362\u8FDC\u7A0B docker \u5BA2\u6237\u7AEF\u65F6\u5C06\u53EA\u4F1A\u8BFB\u53D6\u8BE5\u73AF\u5883\u4E13\u5C5E\u76EE\u5F55\u4E0B\u7684 compose \u4EFB\u52A1"})}),s=="docker"&&(0,n.jsx)(P.Z,{children:(0,n.jsx)(c.Z,{label:"\u542F\u7528\u5BBF\u4E3B\u673A SSH \u8FDE\u63A5",name:"enableSSH"})})]})]})}}),(0,n.jsx)(m.Z,{name:["enableTLS"],children:function(u){var s=u.enableTLS;if(s)return(0,n.jsxs)(U.Z,{gap:10,justify:"start",children:[(0,n.jsx)(g.Z,{name:"tlsCa",label:"\u4E0A\u4F20\u5BA2\u6237\u7AEF\u8BC1\u4E66",children:(0,n.jsx)(t.Z,{title:"ca.pem",onImport:function(d){var h;return(h=M.current)===null||h===void 0||h.setFieldValue("tlsCa",d),!0},onLoad:function(d){if(d.indexOf("CERTIFICATE")<0)throw new Error("\u5BFC\u5165ca.pem\u8BC1\u4E66\u9519\u8BEF");return!0}})}),(0,n.jsx)(g.Z,{name:"tlsCert",label:" ",children:(0,n.jsx)(t.Z,{title:"cert.pem",onImport:function(d){var h;return(h=M.current)===null||h===void 0||h.setFieldValue("tlsCert",d),!0},onLoad:function(d){if(d.indexOf("CERTIFICATE")<0)throw new Error("\u5BFC\u5165cert.pem\u8BC1\u4E66\u9519\u8BEF");return!0}})}),(0,n.jsx)(g.Z,{label:" ",name:"tlsKey",children:(0,n.jsx)(t.Z,{title:"key.pem",onImport:function(d){var h;return(h=M.current)===null||h===void 0||h.setFieldValue("tlsKey",d),!0},onLoad:function(d){if(d.indexOf("PRIVATE")<0)throw new Error("\u5BFC\u5165key.pem\u8BC1\u4E66\u9519\u8BEF");return!0}})})]})}}),(0,n.jsx)(m.Z,{name:["enableComposePath","name"],children:function(u){var s=u.enableComposePath,o=u.name;if(s)return(0,n.jsx)(i.Z,{label:(0,e.getLang)("system.env.createComposePath"),name:"composePath",disabled:!0,fieldProps:{value:"/dpanel/compose/compose-".concat(o!=null?o:"")}})}}),(0,n.jsx)(m.Z,{name:["enableSSH","sshServerInfo","remoteType","address"],children:function(u){var s=u.enableSSH,o=u.sshServerInfo,d=u.remoteType,h=u.address;return(s||d=="ssh")&&[(0,n.jsxs)(E.Z,{title:(0,n.jsx)(D.Z,{}),subTitle:"\u4E3B\u673ASSH",ghost:!0,children:[(0,n.jsxs)(n.Fragment,{children:[d=="ssh"&&(0,n.jsx)(g.Z,{children:(0,n.jsx)(Z.Z,{message:(0,n.jsxs)(n.Fragment,{children:[(0,e.getLang)("system.env.remoteSSHTips")," ",(0,n.jsx)("a",{href:"https://dpanel.cc/#/zh-cn/manual/setting/docker-env?id=%e9%80%9a%e8%bf%87-ssh-%e6%b7%bb%e5%8a%a0",target:"_blank",children:(0,e.getLang)("notification.help")})]})})}),(0,n.jsx)(i.Z,{label:"\u4E3B\u673AIP\u5730\u5740",placeholder:"\u8F93\u5165\u4E3B\u673A\u7684IP\u8FDE\u63A5\u5730\u5740",name:["sshServerInfo","address"],required:!0,rules:[{required:!0}]})]}),(0,n.jsxs)(C.Z,{children:[(0,n.jsx)(P.Z,{children:(0,n.jsx)(R.Z,{initialValue:22,label:"\u7AEF\u53E3",name:["sshServerInfo","port"]})}),(0,n.jsx)(P.Z,{offset:2,children:(0,n.jsx)(_.Z.Group,{label:"\u9A8C\u8BC1\u65B9\u5F0F",name:["sshServerInfo","authType"],valueEnum:{basic:"\u5BC6\u7801\u8BA4\u8BC1",pem:"\u79C1\u94A5\u8BA4\u8BC1"},required:!0,rules:[{required:!0}]})})]}),o&&o.authType=="basic"&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.Z,{label:"\u7528\u6237\u540D",name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]}),(0,n.jsx)(i.Z.Password,{label:"\u5BC6\u7801",name:["sshServerInfo","password"],required:!0,rules:[{required:!0}]})]}),o&&o.authType=="pem"&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.Z,{label:"\u7528\u6237\u540D",name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]}),(0,n.jsx)(t.Z,{title:"\u5BFC\u5165\u5BC6\u94A5\u6587\u4EF6",onImport:function(H){var V;return(V=M.current)===null||V===void 0||V.setFieldValue(["sshServerInfo","privateKey"],H),!0},onLoad:function(H){if(!H.includes("PRIVATE KEY"))throw new Error((0,e.getLang)("system.env.sshImportKeyFileIncorrect"));return!0}}),(0,n.jsx)(I.Z,{name:["sshServerInfo","privateKey"],label:"\u5BC6\u94A5",required:!0,rules:[{required:!0}]}),(0,n.jsx)(i.Z.Password,{name:["sshServerInfo","password"],label:"\u5BC6\u94A5\u5BC6\u7801"})]})]},"sshSetting")]}})]})});T.Z=Y},12491:function(b,T,r){r.d(T,{Z:function(){return i}});var p=r(24963),j=r(88484),L=r(62370),O=r(31418),S=r(28036),B=r(67294),f=r(85893);function i(_){var m=(0,B.useContext)(p.Z),v=m.message,c=m.notice,g=m.lang,E=(0,B.useRef)(null),R=O.Z.useApp(),I=function(){E.current&&(E.current.click(),E.current.onchange=function(P){if(!P||!P.target)return"";var K=new FileReader;K.onload=function(Z){var A,l,a=(A=Z.target)===null||A===void 0?void 0:A.result;if(_.onLoad)try{_.onLoad&&_.onLoad(a)}catch(t){c.error(t);return}typeof _.onImport=="function"&&(v.success("\u6210\u529F\u5BFC\u5165 ".concat(_.title)),_.onImport(a)),(l=E.current)!==null&&l!==void 0&&l.value&&(E.current.value="")};var U=P.target;if(U.files)try{K.readAsText(U.files[0])}catch(Z){c.error("\u5BFC\u5165\u6587\u4EF6\u5FC5\u987B\u662F\u6587\u672C\u7C7B\u578B")}})};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(L.Z,{children:(0,f.jsx)(S.ZP,{icon:(0,f.jsx)(j.Z,{}),block:!0,onClick:I,children:_.title})}),(0,f.jsx)("input",{style:{display:"none"},type:"file",ref:E,name:"importFileInput"})]})}},52756:function(b,T,r){r.r(T),r.d(T,{default:function(){return m},getLang:function(){return _}});var p=r(82346),j=r(31418),L=r(26058),O=r(85137),S=r(24963),B=r(65913),f=r(67294),i=r(85893);function _(v,c){return(0,p.getIntl)((0,p.getLocale)()).formatMessage({id:v},c)}function m(){var v=(0,f.useRef)(),c=(0,p.useIntl)(),g=function(a){for(var t=arguments.length,e=new Array(t>1?t-1:0),D=1;D<t;D++)e[D-1]=arguments[D];R.notification[a]({message:c.formatMessage({id:"notification.title."+a}),description:e.join(" "),placement:"topRight"})},E=function(a){for(var t=arguments.length,e=new Array(t>1?t-1:0),D=1;D<t;D++)e[D-1]=arguments[D];R.message[a](e.join(" "))},R=j.Z.useApp(),I=(0,p.useModel)("@@initialState"),C=I.initialState,P=I.loading,K=I.error,U=I.refresh,Z=I.setInitialState,A=(0,p.useModel)("subscriber");return C!=null&&C.user.username&&A.addDataHandler("user:permission:".concat(C==null?void 0:C.user.username),function(l){U()}),(0,i.jsx)(L.Z,{children:(0,i.jsx)(S.Z.Provider,{value:{notice:{success:function(){for(var a=arguments.length,t=new Array(a),e=0;e<a;e++)t[e]=arguments[e];g.apply(void 0,["success"].concat(t))},error:function(){for(var a=arguments.length,t=new Array(a),e=0;e<a;e++)t[e]=arguments[e];g.apply(void 0,["error"].concat(t))},warning:function(){for(var a=arguments.length,t=new Array(a),e=0;e<a;e++)t[e]=arguments[e];g.apply(void 0,["warning"].concat(t))},info:function(){for(var a=arguments.length,t=new Array(a),e=0;e<a;e++)t[e]=arguments[e];g.apply(void 0,["info"].concat(t))},destroy:function(){R.notification.destroy()}},message:{success:function(){for(var a=arguments.length,t=new Array(a),e=0;e<a;e++)t[e]=arguments[e];E.apply(void 0,["success"].concat(t))},error:function(){for(var a=arguments.length,t=new Array(a),e=0;e<a;e++)t[e]=arguments[e];E.apply(void 0,["error"].concat(t))},warning:function(){for(var a=arguments.length,t=new Array(a),e=0;e<a;e++)t[e]=arguments[e];E.apply(void 0,["warning"].concat(t))},info:function(){for(var a=arguments.length,t=new Array(a),e=0;e<a;e++)t[e]=arguments[e];E.apply(void 0,["info"].concat(t))},loading:function(){for(var a=arguments.length,t=new Array(a),e=0;e<a;e++)t[e]=arguments[e];E.apply(void 0,["loading"].concat(t))},destroy:function(){R.message.destroy()}},loading:{show:function(){v.current&&v.current.show()},destroy:function(){v.current&&v.current.destroy()}},lang:function(a,t){return c.formatMessage({id:a},t)}},children:(0,i.jsxs)(B.Z,{ref:v,children:[(0,i.jsx)(p.Outlet,{}),(0,i.jsx)(O.Z.BackTop,{duration:10,style:{bottom:100}})]})},P?"1":"2")})}},65913:function(b,T,r){var p=r(5574),j=r.n(p),L=r(74330),O=r(67294),S=r(85893),B=(0,O.forwardRef)(function(f,i){(0,O.useImperativeHandle)(i,function(){return{show:function(){c(!0)},destroy:function(){c(!1)}}});var _=(0,O.useState)(!1),m=j()(_,2),v=m[0],c=m[1];return(0,S.jsx)(L.Z,{spinning:v,size:"default",children:f.children})});T.Z=B}}]);
