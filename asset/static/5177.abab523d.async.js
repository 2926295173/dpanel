"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5177],{77273:function(A,P,r){var T=r(15009),f=r.n(T),j=r(99289),O=r.n(j),R=r(5574),S=r.n(R),v=r(184),_=r(5966),u=r(86615),p=r(97462),Z=r(64317),I=r(52688),M=r(62370),E=r(38345),V=r(31199),K=r(90672),x=r(71230),m=r(15746),D=r(42075),y=r(86250),L=r(40056),c=r(67294),b=r(91845),g=r(87662),C=r(12491),J=r(89035),$=r(36146),e=r(85893),Q=(0,c.forwardRef)(function(W,X){var B,F;(0,c.useImperativeHandle)(X,function(){return{edit:function(a){var n,o=a.address.split("://"),s=S()(o,2),l=s[0],U=s[1];(n=d.current)===null||n===void 0||n.setFieldsValue({name:a.name,title:a.title,addressType:"".concat(l,"://"),address:U,serverUrl:a.serverUrl,enableTLS:a.enableTLS,tlsCa:a.tlsCa,tlsCert:a.tlsCert,tlsKey:a.tlsKey,enableComposePath:a.enableComposePath,enableSSH:a.enableSSH,sshServerInfo:a.sshServerInfo,remoteType:a.remoteType?a.remoteType:"docker"}),N(!0),Y(a.name)}}});var t=new $.Uo("components.dockerEnvCreate"),k=(0,c.useState)(!1),w=S()(k,2),q=w[0],N=w[1],d=(0,c.useRef)(),ee=(0,c.useState)(""),G=S()(ee,2),z=G[0],Y=G[1];return(0,e.jsxs)(v.a,{drawerProps:{forceRender:!0},onOpenChange:function(a){if(!a){var n;Y(""),(n=d.current)===null||n===void 0||n.resetFields()}N(a)},open:q,width:800,trigger:W.trigger,formRef:d,title:t.format((B=d.current)!==null&&B!==void 0&&B.getFieldValue&&d.current.getFieldValue("name")=="local"?"drawerTitleDefault":"drawerTitle"),onFinish:function(){var h=O()(f()().mark(function a(n){var o,s,l;return f()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,g.ad)({name:n.name,title:n.title,address:"".concat((o=n.addressType)!==null&&o!==void 0?o:"unix://").concat((s=n.address)!==null&&s!==void 0?s:"/dpanel/sock/".concat(n.name,".sock")),serverUrl:n.serverUrl,enableTLS:n.enableTLS,tlsCa:n.tlsCa,tlsCert:n.tlsCert,tlsKey:n.tlsKey,enableComposePath:n.enableComposePath,composePath:n.enableComposePath?n.composePath:"",enableSSH:n.enableSSH||n.remoteType=="ssh",sshServerInfo:n.sshServerInfo,remoteType:n.remoteType});case 2:return l=i.sent,W.onFinish&&W.onFinish(),i.abrupt("return",!0);case 5:case"end":return i.stop()}},a)}));return function(a){return h.apply(this,arguments)}}(),children:[(0,e.jsx)(_.Z,{label:t.format("formTitle"),name:"title",required:!0,rules:[{required:!0}],fieldProps:{id:"envTitle",onChange:function(a){var n="";if(a.target.value&&!z){var o,s=(0,b.N9)(a.target.value.trim(),{toneType:"none",type:"array"});n=s.join(""),(o=d.current)===null||o===void 0||o.setFieldValue("name",n)}}}},"envTitle"),(0,e.jsx)(_.Z,{label:t.format("formName"),name:"name",required:!0,disabled:z!="",rules:[{required:!0}],placeholder:t.format("formNameEmpty")}),(0,e.jsx)(_.Z,{tooltip:t.format("formServerUrlTip"),label:t.format("formServerUrl"),name:"serverUrl",placeholder:t.format("formServerUrlEmpty")}),(0,e.jsx)(u.Z.Group,{label:t.format("formRemoteType"),name:"remoteType",options:[{label:"DockerApi",value:"docker"},{label:"SSH",value:"ssh",disabled:((F=d.current)===null||F===void 0?void 0:F.getFieldValue("name"))=="local"}]}),(0,e.jsx)(p.Z,{name:["remoteType","name"],children:function(a){var n=a.remoteType,o=a.name;return(0,e.jsxs)(e.Fragment,{children:[n=="docker"&&(0,e.jsx)(x.Z,{children:(0,e.jsx)(m.Z,{span:24,children:(0,e.jsxs)(D.Z.Compact,{children:[(0,e.jsx)(Z.Z,{name:"addressType",label:t.format("formAddressType"),valueEnum:{"unix://":"unix://","tcp://":"tcp://"},initialValue:"tcp://",fieldProps:{defaultValue:"tcp://"},tooltip:t.format("formAddressTypeTip")}),(0,e.jsx)(_.Z,{label:" ",name:"address",required:!0,width:"xl",rules:[{required:!0}],placeholder:t.format("formAddressEmpty")})]})})}),(0,e.jsxs)(x.Z,{gutter:[15,0],children:[n=="docker"&&(0,e.jsx)(m.Z,{children:(0,e.jsx)(I.Z,{label:t.format("formEnableTLS"),name:"enableTLS",tooltip:t.format("formEnableTLSTip")})}),o!="local"&&typeof n!="undefined"&&(0,e.jsx)(m.Z,{children:(0,e.jsx)(I.Z,{label:t.format("formEnableComposePath"),name:"enableComposePath",tooltip:t.format("formEnableComposePathTip")})}),n=="docker"&&(0,e.jsx)(m.Z,{children:(0,e.jsx)(I.Z,{label:t.format("formEnableSSH"),name:"enableSSH"})})]})]})}}),(0,e.jsx)(p.Z,{name:["enableTLS"],children:function(a){var n=a.enableTLS;if(n)return(0,e.jsxs)(y.Z,{gap:10,justify:"start",children:[(0,e.jsx)(M.Z,{name:"tlsCa",label:t.format("formTlsCa"),children:(0,e.jsx)(C.Z,{title:"ca.pem",onImport:function(s){var l;return(l=d.current)===null||l===void 0||l.setFieldValue("tlsCa",s),!0},onLoad:function(s){if(s.indexOf("CERTIFICATE")<0)throw new Error(t.format("formEnableTLSMessageUploadError",{name:"ca.pem"}));return!0}})}),(0,e.jsx)(M.Z,{name:"tlsCert",label:" ",children:(0,e.jsx)(C.Z,{title:"cert.pem",onImport:function(s){var l;return(l=d.current)===null||l===void 0||l.setFieldValue("tlsCert",s),!0},onLoad:function(s){if(s.indexOf("CERTIFICATE")<0)throw new Error(t.format("formEnableTLSMessageUploadError",{name:"cert.pem"}));return!0}})}),(0,e.jsx)(M.Z,{label:" ",name:"tlsKey",children:(0,e.jsx)(C.Z,{title:"key.pem",onImport:function(s){var l;return(l=d.current)===null||l===void 0||l.setFieldValue("tlsKey",s),!0},onLoad:function(s){if(s.indexOf("PRIVATE")<0)throw new Error(t.format("formEnableTLSMessageUploadError",{name:"key.pem"}));return!0}})})]})}}),(0,e.jsx)(p.Z,{name:["enableComposePath","name"],children:function(a){var n=a.enableComposePath,o=a.name;if(n)return(0,e.jsx)(_.Z,{label:t.format("formComposePath"),name:"composePath",disabled:!0,fieldProps:{value:"/dpanel/compose/compose-".concat(o!=null?o:"")}})}}),(0,e.jsx)(p.Z,{name:["enableSSH","sshServerInfo","remoteType","address"],children:function(a){var n=a.enableSSH,o=a.sshServerInfo,s=a.remoteType,l=a.address;return(n||s=="ssh")&&[(0,e.jsxs)(E.Z,{title:(0,e.jsx)(J.Z,{}),subTitle:t.format("formEnableSSHTitle"),ghost:!0,children:[(0,e.jsxs)(e.Fragment,{children:[s=="ssh"&&(0,e.jsx)(M.Z,{children:(0,e.jsx)(L.Z,{message:(0,e.jsxs)(e.Fragment,{children:[t.format("formEnableSSHAlert"),(0,e.jsx)("a",{href:"https://dpanel.cc/#/zh-cn/manual/setting/docker-env?id=%e9%80%9a%e8%bf%87-ssh-%e6%b7%bb%e5%8a%a0",target:"_blank",children:$.FD.format("help")})]})})}),(0,e.jsx)(_.Z,{label:t.format("formSshServerInfoAddress"),placeholder:t.format("formSshServerInfoAddressEmpty"),name:["sshServerInfo","address"],required:!0,rules:[{required:!0}]})]}),(0,e.jsxs)(x.Z,{children:[(0,e.jsx)(m.Z,{children:(0,e.jsx)(V.Z,{initialValue:22,label:t.format("formSshServerInfoPort"),name:["sshServerInfo","port"]})}),(0,e.jsx)(m.Z,{offset:2,children:(0,e.jsx)(u.Z.Group,{label:t.format("formSshServerInfoAuthType"),name:["sshServerInfo","authType"],valueEnum:{basic:t.format("formSshServerInfoAuthTypeBasic"),pem:t.format("formSshServerInfoAuthTypePem")},required:!0,rules:[{required:!0}]})})]}),o&&o.authType=="basic"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(_.Z,{label:t.format("formSshServerInfoUsername"),name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]}),(0,e.jsx)(_.Z.Password,{label:t.format("formSshServerInfoPassword"),name:["sshServerInfo","password"],required:!0,rules:[{required:!0}]})]}),o&&o.authType=="pem"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(_.Z,{label:t.format("formSshServerInfoUsername"),name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]}),(0,e.jsx)(C.Z,{title:t.format("formSshServerInfoPrivateKeyImport"),onImport:function(i){var H;return(H=d.current)===null||H===void 0||H.setFieldValue(["sshServerInfo","privateKey"],i),!0},onLoad:function(i){if(!i.includes("PRIVATE KEY"))throw new Error(t.format("formEnableTLSMessageUploadError",{name:"private.key"}));return!0}}),(0,e.jsx)(K.Z,{name:["sshServerInfo","privateKey"],label:t.format("formSshServerInfoPrivateKey"),required:!0,rules:[{required:!0}]}),(0,e.jsx)(_.Z.Password,{name:["sshServerInfo","password"],label:t.format("formSshServerInfoPrivateKeyPassword")})]})]},"sshSetting")]}})]})});P.Z=Q},12491:function(A,P,r){r.d(P,{Z:function(){return _}});var T=r(24963),f=r(88484),j=r(62370),O=r(31418),R=r(28036),S=r(67294),v=r(85893);function _(u){var p=(0,S.useContext)(T.Z),Z=p.message,I=p.notice,M=p.lang,E=(0,S.useRef)(null),V=O.Z.useApp(),K=function(){E.current&&(E.current.click(),E.current.onchange=function(m){if(!m||!m.target)return"";var D=new FileReader;D.onload=function(L){var c,b,g=(c=L.target)===null||c===void 0?void 0:c.result;if(u.onLoad)try{u.onLoad&&u.onLoad(g)}catch(C){I.error(C);return}typeof u.onImport=="function"&&(Z.success("\u6210\u529F\u5BFC\u5165 ".concat(u.title)),u.onImport(g)),(b=E.current)!==null&&b!==void 0&&b.value&&(E.current.value="")};var y=m.target;if(y.files)try{D.readAsText(y.files[0])}catch(L){I.error("\u5BFC\u5165\u6587\u4EF6\u5FC5\u987B\u662F\u6587\u672C\u7C7B\u578B")}})};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(j.Z,{children:(0,v.jsx)(R.ZP,{icon:(0,v.jsx)(f.Z,{}),block:!0,onClick:K,children:u.title})}),(0,v.jsx)("input",{style:{display:"none"},type:"file",ref:E,name:"importFileInput"})]})}},3616:function(A,P,r){r.d(P,{Ed:function(){return O},FK:function(){return f},R_:function(){return T},ob:function(){return j}});var T=window.innerWidth<=1024?"90vw":"65vw",f="90vw",j="60vw",O="50vh"},24963:function(A,P,r){var T=r(67294),f=(0,T.createContext)({});P.Z=f}}]);
