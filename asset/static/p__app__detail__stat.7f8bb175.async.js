"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745,5947],{55809:function(N,M,e){var x=e(87462),r=e(67294),L=e(44805),_=e(84089),v=function(O,h){return r.createElement(_.Z,(0,x.Z)({},O,{ref:h,icon:L.Z}))},D=r.forwardRef(v);M.Z=D},60433:function(N,M,e){var x=e(87462),r=e(67294),L=e(69782),_=e(84089),v=function(O,h){return r.createElement(_.Z,(0,x.Z)({},O,{ref:h,icon:L.Z}))},D=r.forwardRef(v);M.Z=D},27619:function(N,M,e){e.d(M,{Z:function(){return A}});var x=e(97857),r=e.n(x),L=e(19632),_=e.n(L),v=e(5574),D=e.n(v),R=e(64183),O=e(82346),h=e(67294),y=e(85893);function A(c){var b,E=(0,h.useState)("academy"),j=D()(E,2),B=j[0],I=j[1],F=Math.max.apply(Math,_()(c.data.map(function(d){var a;return(a=d[c.yField])!==null&&a!==void 0?a:0}))),p=(0,O.useModel)("@@initialState"),T=p.initialState,K=p.loading,P=p.error,Z=p.refresh,u=p.setInitialState,t={xField:c.xField,yField:c.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:c.yLabelFormatter},scale:{y:{domainMin:(b=c.yDomainMin)!==null&&b!==void 0?b:0,domainMax:c.yDomainMax?c.yDomainMax:c.yDomainMaxCallback?c.yDomainMaxCallback(F):F}},data:c.data};return c.yLabelFormatter&&(t.axis.y.labelFormatter=c.yLabelFormatter),c.colorField&&(t.colorField=c.colorField),(0,h.useEffect)(function(){(T==null?void 0:T.theme.algorithm)=="dark"?I("classicDark"):I("academy")},[T]),(0,y.jsx)(R.Z,r()({theme:B},t))}},24963:function(N,M,e){var x=e(67294),r=(0,x.createContext)({});M.Z=r},50070:function(N,M,e){e.r(M),e.d(M,{AppDetailContext:function(){return j},default:function(){return B}});var x=e(15009),r=e.n(x),L=e(99289),_=e.n(L),v=e(5574),D=e.n(v),R=e(24963),O=e(60335),h=e(55809),y=e(82346),A=e(25593),c=e(50136),b=e(67294),E=e(85893),j=(0,b.createContext)({});function B(){var I,F=(0,b.useContext)(R.Z),p=F.lang,T=F.loading,K=F.message,P=(0,y.useParams)(),Z=(0,y.useSearchParams)(),u=D()(Z,2),t=u[0],d=u[1],a=(I=t.get("tab"))!==null&&I!==void 0?I:"edit",q=(0,b.useState)("edit"),C=D()(q,2),U=C[0],S=C[1],m=(0,y.useNavigate)(),$=(0,b.useState)(1),w=D()($,2),o=w[0],V=w[1],z=[{label:(0,E.jsx)(y.Link,{to:"/app/detail/edit/".concat(P.id,"?tab=edit"),children:"\u5BB9\u5668\u8BE6\u60C5"}),key:"edit"},{label:(0,E.jsx)(y.Link,{to:"/app/detail/network/".concat(P.id,"?tab=network"),children:"\u7F51\u7EDC\u7BA1\u7406"}),key:"network"},{label:(0,E.jsx)(A.Z.Link,{children:"\u6587\u4EF6\u7BA1\u7406"}),key:"file",onClick:function(){K.info(p("app.detail.createExplorerPlugin")),m("/app/detail/file/".concat(P.id,"?tab=file"))}},{label:(0,E.jsx)(A.Z.Link,{children:"\u8FD0\u884C\u65E5\u5FD7"}),key:"log",onClick:function(){m("/app/detail/log/".concat(P.id,"?tab=log"))}},{label:(0,E.jsx)(A.Z.Link,{children:"\u8FD0\u884C\u72B6\u6001"}),key:"stat",onClick:function(){m("/app/detail/stat/".concat(P.id,"?tab=stat"))}},{label:"",key:"containerName",icon:(0,E.jsx)(h.Z,{}),disabled:!0}],W=(0,b.useState)(z),G=D()(W,2),J=G[0],Y=G[1];(0,b.useEffect)(function(){T.show(),S(a);var l=function(){var Q=_()(r()().mark(function ee(){var X,g,s;return r()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return g=z,f.next=3,(0,O.jV)({md5:(X=P.id)!==null&&X!==void 0?X:""});case 3:s=f.sent,g.map(function(i){return i.key=="containerName"&&(i.label=s.data.info.Name),(!s.data.info.State.Running||s.data.info.State.Restarting)&&(i.key=="file"||i.key=="stat")&&(i.disabled=!0),i}),Y(g),T.destroy();case 7:case"end":return f.stop()}},ee)}));return function(){return Q.apply(this,arguments)}}();l()},[o]);var H=function(Q){S(Q.key)};return(0,E.jsxs)(j.Provider,{value:{reload:function(){V(o+1)}},children:[(0,E.jsx)(c.Z,{mode:"horizontal",onClick:H,selectedKeys:[U],items:J}),(0,E.jsx)(y.Outlet,{})]})}},41748:function(N,M,e){e.r(M),e.d(M,{default:function(){return q}});var x=e(15009),r=e.n(x),L=e(99289),_=e.n(L),v=e(5574),D=e.n(v),R=e(19632),O=e.n(R),h=e(27619),y=e(67294);function A(C){var U=C.reqFunction,S=C.interval,m=C.maxPolling,$=C.pollingStatus,w=C.inPath,o=(0,y.useRef)(null),V=0,z=function G(){o.current=window.setTimeout(_()(r()().mark(function J(){var Y;return r()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(V++>=m)){l.next=3;break}return W(),l.abrupt("return");case 3:if(l.prev=3,!(w&&window.location.href.indexOf(w)==-1)){l.next=7;break}return W(),l.abrupt("return");case 7:return l.next=9,U();case 9:Y=l.sent,G(),l.next=17;break;case 13:l.prev=13,l.t0=l.catch(3),W(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",l.t0);case 17:case"end":return l.stop()}},J,null,[[3,13]])})),S)},W=function(){console.log("end polling"),o.current&&window.clearTimeout(o.current)};return(0,y.useEffect)(function(){return console.log(($?"start":"waiting")+" polling, max "+m),$&&z(),function(){W()}},[S,m,$]),{endPolling:W}}var c=A,b=e(24963),E=e(82346);function j(C){return B.apply(this,arguments)}function B(){return B=_()(r()().mark(function C(U){return r()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,E.request)("/api/app/container/get-stat-info",{method:"POST",data:U}));case 1:case"end":return m.stop()}},C)})),B.apply(this,arguments)}function I(C){return F.apply(this,arguments)}function F(){return F=_()(r()().mark(function C(U){return r()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,E.request)("/api/app/container/get-process-info",{method:"POST",data:U}));case 1:case"end":return m.stop()}},C)})),F.apply(this,arguments)}var p=e(5251),T=e(12122),K=e(60433),P=e(38345),Z=e(60940),u=e(50070),t=e(85893),d=new Date().toLocaleTimeString(),a={total:0,memory:[{date:d,usage:0,source:{usage:0,limit:0}}],cpu:[{date:d,usage:0}],network:[{usage:0,type:"rx",date:d,source:{usage:0}},{usage:0,type:"tx",date:d,source:{usage:0}}],io:[{usage:0,type:"read",date:d,source:{usage:0}},{usage:0,type:"write",date:d,source:{usage:0}}]};function q(){var C=function(s,n){switch(n.type){case"update":var f=new Date(n.payload.read).toLocaleTimeString(),i=n.payload.cpu_stats.cpu_usage.total_usage-n.payload.precpu_stats.cpu_usage.total_usage,ae=n.payload.cpu_stats.system_cpu_usage-n.payload.precpu_stats.system_cpu_usage,k={total:s.total+1,memory:[],cpu:[].concat(O()(s.cpu),[{date:f,usage:i/ae*n.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return n.payload.memory_stats&&n.payload.memory_stats.limit&&n.payload.memory_stats.usage&&(k.memory=[].concat(O()(s.memory),[{date:f,usage:Math.round(n.payload.memory_stats.usage),source:{usage:n.payload.memory_stats.usage,limit:n.payload.memory_stats.limit}}])),n.payload.networks&&(k.network=[].concat(O()(s.network),[{date:f,usage:parseFloat(n.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:n.payload.networks.eth0.rx_bytes}},{date:f,usage:parseFloat(n.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:n.payload.networks.eth0.tx_bytes}}])),n.payload.blkio_stats&&n.payload.blkio_stats.io_service_bytes_recursive&&n.payload.blkio_stats.io_service_bytes_recursive.length>0&&(k.io=[].concat(O()(s.io),[{date:f,usage:parseFloat(n.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:n.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:n.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:f,usage:parseFloat(n.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:n.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:n.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),k}},U=(0,y.useContext)(b.Z),S=U.loading,m=(0,E.useParams)(),$=(0,y.useReducer)(C,a),w=D()($,2),o=w[0],V=w[1],z=(0,y.useState)(0),W=D()(z,2),G=W[0],J=W[1],Y=(0,y.useState)(),H=D()(Y,2),l=H[0],Q=H[1],ee=c({reqFunction:function(){var g=_()(r()().mark(function n(){var f,i;return r()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,j({id:(f=m.id)!==null&&f!==void 0?f:""});case 2:i=k.sent,S.destroy(),V({type:"update",payload:i});case 5:case"end":return k.stop()}},n)}));function s(){return g.apply(this,arguments)}return s}(),interval:3e3,maxPolling:999,pollingStatus:G!=0,inPath:"tab=stat"}),X=(0,y.useContext)(u.AppDetailContext);return(0,y.useEffect)(function(){X.reload()},[]),(0,y.useEffect)(function(){var g,s;S.show(),j({id:(g=m.id)!==null&&g!==void 0?g:""}).then(function(n){return J(Math.round(n.memory_stats.limit)),!0}),I({id:(s=m.id)!==null&&s!==void 0?s:""}).then(function(n){var f={columns:[],data:[]};n.data.list.Titles.map(function(i){f.columns.push({title:i,label:i,dataIndex:i})}),n.data.list.Processes.map(function(i,ae){f.data.push({UID:i[0],PID:i[1],PPID:i[2],C:i[3],STIME:i[4],TTY:i[5],TIME:i[6],CMD:i[7]})}),Q(f)})},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(P.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[o.memory&&o.memory.length>0&&(0,t.jsx)(P.Z,{colSpan:12,title:(0,t.jsx)(T.Z,{}),subTitle:"Memory usage: ".concat((0,p.FI)(o.memory[o.memory.length-1].source.usage)," / ").concat((0,p.FI)(o.memory[o.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(h.Z,{yField:"usage",xField:"date",data:o.memory,yDomainMaxCallback:function(s){return s*2},yLabelFormatter:function(s){return(0,p.FI)(parseFloat(s))}})}),(0,t.jsx)(P.Z,{colSpan:12,title:(0,t.jsx)(T.Z,{}),subTitle:"Cpu usage: ".concat(o.cpu[o.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,t.jsx)(h.Z,{yField:"usage",xField:"date",data:o.cpu,yDomainMaxCallback:function(s){return s*1.5},yLabelFormatter:function(s){return"".concat(s,"%")}})}),o.io&&o.io.length>0&&(0,t.jsx)(P.Z,{colSpan:12,title:(0,t.jsx)(T.Z,{}),subTitle:"I/O: ".concat((0,p.FI)(o.io[o.io.length-1].source.usage)," / ").concat((0,p.FI)(o.io[o.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(h.Z,{yField:"usage",xField:"date",colorField:"type",data:o.io,yDomainMaxCallback:function(s){return s*2},yLabelFormatter:function(s){return(0,p.FI)(parseFloat(s))}})}),o.network&&o.network.length>0&&(0,t.jsx)(P.Z,{colSpan:12,title:(0,t.jsx)(T.Z,{}),subTitle:"Network: ".concat((0,p.FI)(o.network[o.network.length-1].source.usage)," / ").concat((0,p.FI)(o.network[o.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(h.Z,{yField:"usage",xField:"date",colorField:"type",data:o.network,yDomainMaxCallback:function(s){return s*2},yLabelFormatter:function(s){return(0,p.FI)(parseFloat(s))}})})]}),(0,t.jsx)(P.Z,{title:(0,t.jsx)(K.Z,{}),subTitle:"Progress",children:(0,t.jsx)(Z.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:l==null?void 0:l.columns,dataSource:l==null?void 0:l.data,pagination:{pageSize:10}})})]})}},60335:function(N,M,e){e.d(M,{IE:function(){return O},IW:function(){return D},KK:function(){return E},LJ:function(){return B},RF:function(){return T},Re:function(){return F},aF:function(){return P},eE:function(){return c},jV:function(){return y}});var x=e(15009),r=e.n(x),L=e(99289),_=e.n(L),v=e(82346);function D(u){return R.apply(this,arguments)}function R(){return R=_()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/status",{method:"POST",data:t}));case 1:case"end":return a.stop()}},u)})),R.apply(this,arguments)}function O(u){return h.apply(this,arguments)}function h(){return h=_()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/get-list",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},u)})),h.apply(this,arguments)}function y(u){return A.apply(this,arguments)}function A(){return A=_()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/get-detail",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},u)})),A.apply(this,arguments)}function c(u){return b.apply(this,arguments)}function b(){return b=_()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/update",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},u)})),b.apply(this,arguments)}function E(){return j.apply(this,arguments)}function j(){return j=_()(r()().mark(function u(){return r()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,v.request)("/api/app/container/prune",{method:"POST"}));case 1:case"end":return d.stop()}},u)})),j.apply(this,arguments)}function B(u){return I.apply(this,arguments)}function I(){return I=_()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/export",{method:"POST",data:t,responseType:"blob"}));case 1:case"end":return a.stop()}},u)})),I.apply(this,arguments)}function F(u){return p.apply(this,arguments)}function p(){return p=_()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/commit",{method:"POST",data:t}));case 1:case"end":return a.stop()}},u)})),p.apply(this,arguments)}function T(u){return K.apply(this,arguments)}function K(){return K=_()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/upgrade",{method:"POST",data:t}));case 1:case"end":return a.stop()}},u)})),K.apply(this,arguments)}function P(u){return Z.apply(this,arguments)}function Z(){return Z=_()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/copy",{method:"POST",data:t}));case 1:case"end":return a.stop()}},u)})),Z.apply(this,arguments)}}}]);
