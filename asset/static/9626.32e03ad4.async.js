"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9626],{69626:function(Ee,je,n){n.d(je,{Z:function(){return vn}});var xe=n(19632),h=n.n(xe),we=n(5574),C=n.n(we),V=n(15009),m=n.n(V),he=n(99289),O=n.n(he),u=n(67294),X=n(80821),T=n(90098),Se=n(26522),k=n(86548),ne=n(43425),J=n(87740),ge=n(48689),L=n(33160),Re=n(87784),te=n(74842),Pe=n(30159),ce=n(25035),z=n(38345),re=n(97269),ae=n(86615),$=n(62370),me=n(82346),ye=n(85265),_=n(42075),de=n(96074),ie=n(25593),le=n(83062),De=n(40056),se=n(84567),c=n(83622),s=n(99861),B=n(91058),r=n(79245),Be=n(60940),be=n(55241),We=n(78451),Ke=n(37413),Ge=n(94359),Ne=n(91806),Qe=n(60433),Ue=n(89035),ze=n(99922),Ye=n(46357),He=n(87662),Xe=n(5251),b=n(36146),e=n(85893);function Je(o){var q=(0,u.useState)(""),G=C()(q,2),M=G[0],Y=G[1],U=(0,u.useRef)(),Z=(0,u.useRef)(),I=(0,u.useState)(!1),v=C()(I,2),j=v[0],t=v[1],P=new b.Uo("components.appCompose");return(0,u.useEffect)(function(){(0,He.K3)().then(function(g){var d;Y((d=g.data.serverUrl)!==null&&d!==void 0?d:"")}),t(!1)},[o.containerList]),o.containerList&&(0,e.jsxs)(z.Z,{ghost:!0,title:(0,e.jsx)(Ne.Z,{}),subTitle:P.format("detailContainerTitle"),extra:o.enableSelectService&&(0,e.jsx)(se.Z,{onChange:function(d){t(d.target.checked)},children:P.format("selectService")},"selectService"),children:[(0,e.jsx)(ze.Z,{showFileExplorer:!0,ref:U}),(0,e.jsx)(Ye.Z,{ref:Z}),(0,e.jsx)(Be.Z,{scroll:{x:"max-content"},rowKey:"service",pagination:!1,columns:[{title:b.FD.format("listName"),dataIndex:"name",width:200,render:function(d,i,x){return(0,e.jsx)(le.Z,{title:i.service,children:(0,e.jsx)(We.Z,{content:i.name?(0,Xe.fi)(i.name,"/"):i.service})})}},{title:b.FD.format("listPort"),render:function(d,i,x){var R=[],N=[];return i.publishers&&i.publishers.map(function(F){F.publishedPort?R.push({PrivatePort:F.targetPort,Type:F.protocol,IP:F.url,PublicPort:F.publishedPort}):F.publishedPort&&N.push({PrivatePort:F.targetPort,Type:F.protocol,IP:F.url,PublicPort:F.publishedPort})}),(0,e.jsx)(Ke.Z,{publicPort:R,privatePort:N,domain:[],serverIp:M})}},{title:b.FD.format("listStatus"),render:function(d,i,x){return(0,e.jsx)(Ge.Z,{status:"container.".concat(i.state),tip:"".concat(i.state," ").concat(i.status)},i.name)}},{title:b.FD.format("listManage"),fixed:"right",render:function(d,i,x){return(0,e.jsxs)(_.Z,{split:(0,e.jsx)(de.Z,{type:"vertical"}),children:[i.name==""&&(0,e.jsx)(be.Z,{placement:"left",content:(0,e.jsx)(z.Z,{ghost:!0,title:b.FD.format("listManageShowContainerEnv"),children:(0,e.jsx)(_.Z,{direction:"vertical",children:i.environment&&Object.keys(i.environment).map(function(R){if(i.environment&&i.environment[R])return(0,e.jsx)(ie.Z.Text,{code:!0,children:"".concat(R,"=").concat(i.environment[R])},R)})})}),children:(0,e.jsx)(Qe.Z,{})}),i.name!=""&&(0,e.jsx)(ie.Z.Link,{onClick:function(){var N;(N=Z.current)===null||N===void 0||N.show(i.name)},children:(0,e.jsx)(ne.Z,{})},"container"),i.state=="running"&&(0,e.jsx)(ie.Z.Link,{onClick:function(){var N;(N=U.current)===null||N===void 0||N.show({url:"/console/container/".concat(i.name),title:i.name})},children:(0,e.jsx)(Ue.Z,{})},"console")]})}}],dataSource:o.containerList,rowSelection:j&&o.containerList?{defaultSelectedRowKeys:o.containerList.map(function(g){return g.service}),onChange:function(d,i,x){o.selectServiceFinish&&o.selectServiceFinish(d)}}:void 0})]})}var _e=n(81146),qe=n(1883),Ze=n(3616),en=(0,u.forwardRef)(function(o,q){(0,u.useImperativeHandle)(q,function(){return{show:function(g){return O()(m()().mark(function d(){return m()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:j(o.composeItem),U(!0);case 2:case"end":return x.stop()}},d)}))()}}});var G=(0,u.useState)(!1),M=C()(G,2),Y=M[0],U=M[1],Z=(0,u.useState)(),I=C()(Z,2),v=I[0],j=I[1],t=(0,u.useRef)();return(0,e.jsxs)(e.Fragment,{children:[o.showTriggerButton&&(0,e.jsx)(ie.Z.Link,{onClick:O()(m()().mark(function P(){return m()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:j(o.composeItem),U(!0);case 2:case"end":return d.stop()}},P)})),children:(0,e.jsx)(le.Z,{title:b.FD.format("listManageLog"),children:(0,e.jsx)(qe.Z,{})})},"log"),(0,e.jsx)(ye.Z,{title:b.FD.format("listLog"),open:Y,forceRender:!0,onClose:function(){U(!1)},afterOpenChange:function(g){if(g)setTimeout(function(){var i,x;(i=t.current)===null||i===void 0||i.start(),(x=t.current)===null||x===void 0||x.fit()},1e3);else{var d;(d=t.current)===null||d===void 0||d.close()}},width:Ze.FK,children:v&&Y&&(0,e.jsx)(_e.Z,{ref:t,showInDrawer:!0,id:"compose:log:".concat(String(v.id||v.name)),request:function(){var P=O()(m()().mark(function g(d){var i;return m()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,(0,T.Yz)({id:v.id||v.name,lineTotal:d.lineTotal,download:(i=d.download)!==null&&i!==void 0?i:!1,showTime:d.showTime});case 2:case"end":return R.stop()}},g)}));return function(g){return P.apply(this,arguments)}}(),download:function(){var P=O()(m()().mark(function g(d){var i;return m()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,(0,T.vf)({id:v.id||v.name,lineTotal:d.lineTotal,showTime:d.showTime,download:!0});case 2:return i=R.sent,R.abrupt("return",{data:new Blob([i],{type:"text/plain"}),name:o.composeItem.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return R.stop()}},g)}));return function(g){return P.apply(this,arguments)}}()})})]})}),nn=en,Me=n(24963),Ae=n(184),tn=n(95213),rn=n(11106),an=n(92398),sn=n(40411);function on(o){var q=(0,u.useContext)(Me.Z),G=q.message,M=(0,u.useRef)(),Y=new b.Uo("components.appCompose"),U=new b.Uo("compose");return o.composeItem.yamlList&&(0,e.jsx)(Ae.a,{drawerProps:{width:Ze.R_,destroyOnHidden:!0},title:Y.format("yamlDrawerTitle"),formRef:M,trigger:(0,e.jsx)(ie.Z.Link,{children:(0,e.jsx)(le.Z,{title:"Yaml",children:"Yaml"})}),onFinish:function(){var Z=O()(m()().mark(function I(v){return m()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,T.im)({id:String(o.composeItem.id?o.composeItem.id:o.composeItem.name),name:o.composeItem.name,type:o.composeItem.setting.type,yaml:v.yaml,yamlOverride:v.yamlOverride});case 2:return t.next=4,(0,T.xC)({yaml:[v.yaml,v.yamlOverride],environment:o.composeItem.setting.environment,id:o.composeItem.id||o.composeItem.name});case 4:return o.onFinish&&o.onFinish(),t.abrupt("return",!0);case 6:case"end":return t.stop()}},I)}));return function(I){return Z.apply(this,arguments)}}(),children:(0,e.jsx)(z.Z,{ghost:!0,children:(0,e.jsx)(an.Z,{items:o.composeItem.yamlList.map(function(Z,I){var v=[{label:U.format("createYaml"),key:"yaml"},{label:(0,e.jsx)(sn.Z,{count:Z&&b.FD.format("listInUse"),offset:[15,-5],children:U.format("createYamlOverride")}),key:"yamlOverride"}];return{label:v[I].label,key:v[I].key,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)($.Z,{hidden:!0,name:v[I].key}),(0,e.jsx)($.Z,{shouldUpdate:!0,children:function(t){return(0,e.jsx)(rn.ZP,{onFocus:function(){if(v[I].key=="yaml"&&o.composeItem.setting.type=="remoteUrl"){G.error(U.format("createYamlDisableEdit"));return}},readOnly:v[I].key=="yaml"&&o.composeItem.setting.type=="remoteUrl",theme:"dark",minHeight:"550px",value:Z,onChange:function(g){t.setFieldValue(v[I].key,g)},extensions:[tn.RI.yaml()]})}})]})}})})})})}var ln=n(65913),Oe=n(1699),un=n(16970),cn=n(75544),dn=(0,u.forwardRef)(function(o,q){(0,u.useImperativeHandle)(q,function(){return{show:function(){return O()(m()().mark(function j(){var t;return m()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return I(!0),(t=M.current)===null||t===void 0||t.clear(),g.next=4,new Promise(function(d){return setTimeout(function(){var i;(i=M.current)===null||i===void 0||i.fit(),d(!0)},1e3)});case 4:case"end":return g.stop()}},j)}))()},close:function(){var j;I(!1),(j=M.current)===null||j===void 0||j.clear()}}});var G=(0,me.useModel)("subscriber"),M=(0,u.useRef)(),Y=(0,u.useState)(!1),U=C()(Y,2),Z=U[0],I=U[1];return G.addDataHandler("compose:"+o.id,function(v){var j;(j=M.current)===null||j===void 0||j.write(v.data)}),(0,e.jsx)(z.Z,{hidden:!Z,ghost:!0,title:(0,e.jsx)(Ue.Z,{}),subTitle:"Console",extra:(0,e.jsx)(_.Z,{children:(0,e.jsx)(X.Z,{action:function(){var j;return(j=M.current)===null||j===void 0||j.clear(),(0,T.U_)({})},icon:(0,e.jsx)(ge.Z,{}),danger:!0,onSuccess:function(){},children:b.FD.format("listManageKill")},"kill")}),children:(0,e.jsx)(cn.Z,{id:"create-log-".concat(o.id),height:"200px",style:{fontSize:12},ref:M})})}),Ve=dn,mn=(0,u.forwardRef)(function(o,q){var G=(0,u.useState)(!1),M=C()(G,2),Y=M[0],U=M[1],Z=new b.Uo("components.appCompose"),I=(0,u.useState)(),v=C()(I,2),j=v[0],t=v[1],P=(0,u.useRef)(),g=(0,u.useRef)();return(0,u.useImperativeHandle)(q,function(){return{show:function(i){var x;U(!0),t(i),(x=P.current)===null||x===void 0||x.setFieldsValue({environment:i.detail.setting.environment})}}}),(0,e.jsxs)(Ae.a,{formRef:P,open:Y,drawerProps:{forceRender:!0},title:Z.format("taskDrawerTitle",{name:""}),onOpenChange:function(i){U(i)},children:[(0,e.jsx)(z.Z,{title:(0,e.jsx)(ne.Z,{}),subTitle:Z.format("managerTitle"),ghost:!0,children:j&&(0,e.jsx)(_.Z,{wrap:!0,split:(0,e.jsx)(de.Z,{type:"vertical"}),children:(0,e.jsx)(X.Z,{icon:(0,e.jsx)(te.Z,{}),type:"primary",confirmOnOpenChange:function(i){var x;i&&(!((x=P.current)===null||x===void 0)&&x.resetFields)&&P.current.resetFields()},action:O()(m()().mark(function d(){var i,x,R;return m()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return(i=g.current)===null||i===void 0||i.show(),R=(x=P.current)===null||x===void 0?void 0:x.getFieldValue("environment"),F.next=4,(0,T.Oh)({id:j.detail.name,environment:R,autoRemove:!0});case 4:U(!1),o.onFinish&&o.onFinish(R);case 6:case"end":return F.stop()}},d)})),children:Z.format("managerCreateButton")},"create")})},"operator"),j&&(0,e.jsx)(Ve,{ref:g,id:j.detail.name}),(0,e.jsx)(z.Z,{title:Z.format("envTitle"),subTitle:Z.format("envSubTitle"),tooltip:Z.format("envTip"),ghost:!0,children:(0,e.jsx)(B.Z,{showCardGhost:!0,name:"environment",showDisableName:!0,requireValue:!0,showDeleteButton:!1})})]})}),fn=mn,pn=(0,u.forwardRef)(function(o,q){var G;(0,u.useImperativeHandle)(q,function(){return{show:function(l){return O()(m()().mark(function f(){var w;return m()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return(w=ue.current)===null||w===void 0||w.close(),Z(!0),a.prev=2,a.next=5,ke(l);case 5:a.next=12;break;case 7:a.prev=7,a.t0=a.catch(2),Z(!1),P(void 0),o.onClose&&o.onClose();case 12:case"end":return a.stop()}},f,null,[[2,7]])}))()}}});var M=(0,u.useState)(!1),Y=C()(M,2),U=Y[0],Z=Y[1],I=(0,me.useNavigate)(),v=(0,u.useState)(),j=C()(v,2),t=j[0],P=j[1],g=(0,u.useState)(),d=C()(g,2),i=d[0],x=d[1],R=(0,u.useState)(0),N=C()(R,2),F=N[0],fe=N[1],ee=(0,u.useRef)(),Ce=(0,u.useRef)(),oe=(0,u.useRef)(),Te=(0,u.useRef)(),ue=(0,u.useRef)(),Le=(0,u.useRef)(),hn=(0,u.useContext)(Me.Z),gn=hn.message,Fe=(0,me.useAccess)(),D=new b.Uo("components.appCompose"),yn=(0,u.useRef)();function Cn(y){return $e.apply(this,arguments)}function $e(){return $e=O()(m()().mark(function y(l){var f,w,S;return m()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,(f=ue.current)===null||f===void 0?void 0:f.show();case 2:if(!l.pullImageUseDPanel){p.next=6;break}return p.next=5,(w=Te.current)===null||w===void 0?void 0:w.start();case 5:(S=Te.current)===null||S===void 0||S.finish();case 6:return p.prev=6,p.next=9,(0,T.Oh)(l);case 9:o.onDeployFinish&&o.onDeployFinish(),p.next=15;break;case 12:p.prev=12,p.t0=p.catch(6),o.onDeployFailed&&o.onDeployFailed(t);case 15:fe(F+1);case 16:case"end":return p.stop()}},y,null,[[6,12]])})),$e.apply(this,arguments)}function ke(y){return Ie.apply(this,arguments)}function Ie(){return Ie=O()(m()().mark(function y(l){var f,w,S,a,p,H,Q;return m()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return(f=Le.current)===null||f===void 0||f.show(),(w=ee.current)===null||w===void 0||w.resetFields(),E.next=4,(0,T.Pn)({id:l}).finally(O()(m()().mark(function W(){var A;return m()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:(A=Le.current)===null||A===void 0||A.destroy();case 1:case"end":return K.stop()}},W)}))).catch(function(W){throw W});case 4:S=E.sent,a=S.data.detail,a.setting.status&&a.setting.status.indexOf("running")>-1&&(a.isRunning=!0),a.setting.status&&a.setting.status.indexOf("paused")>-1&&(a.isPaused=!0),a.setting.status&&a.setting.status.indexOf("exited")>-1&&(a.isExited=!0),a.setting.status&&a.setting.status=="waiting"?a.isDeploy=!1:a.isDeploy=!0,a.setting.status&&a.setting.status.indexOf("created")>-1&&(a.isCreated=!0,a.isDeploy=!1),p=S.data.project,p&&(a.imageList=h()(new Set(Object.keys(p.services).map(function(W){var A;return(A=p.services[W].image)!==null&&A!==void 0?A:""})))),a.containerList=S.data.containerList,(!a.containerList||a.containerList.length==0)&&p&&p.services&&(a.containerList=Object.keys(p.services).map(function(W){var A;return{project:(A=p.name)!==null&&A!==void 0?A:"",name:"",service:W,publishers:p.services[W].ports?p.services[W].ports.map(function(ve){var K;return{url:"",targetPort:ve.target,publishedPort:parseInt(ve.published),protocol:(K=ve.protocol)!==null&&K!==void 0?K:""}}):[],state:"waiting",status:"",environment:p.services[W].environment}})),a.containerList&&((H=ee.current)===null||H===void 0||H.setFieldValue("deployServiceName",S.data.detail.setting.deployServiceName)),a.yamlList=S.data.yaml,P(a),x(S.data.task),S.data.yaml&&S.data.yaml.map(function(W){(0,r.m)(W).map(function(A){a.setting.environment&&!a.setting.environment.find(function(ve){return ve.name==A.name})&&a.setting.environment.push(A)})}),S.data.detail.setting.environment&&((Q=ee.current)===null||Q===void 0||Q.setFieldValue("environment",S.data.detail.setting.environment));case 21:case"end":return E.stop()}},y)})),Ie.apply(this,arguments)}return(0,u.useEffect)(function(){F>0&&t&&ke(t.id||t.name).catch(function(y){Z(!1)})},[F]),(0,e.jsxs)(ye.Z,{width:Ze.R_,forceRender:!0,extra:t&&t.setting.type!="dangling"&&(0,e.jsxs)(_.Z,{split:(0,e.jsx)(de.Z,{type:"vertical"}),children:[t.isDeploy&&(0,e.jsx)(nn,{composeItem:t,showTriggerButton:!0}),Fe.canSeeComposeListManage&&(0,e.jsx)(un.Z,{trigger:(0,e.jsx)(ie.Z.Link,{children:(0,e.jsx)(Se.Z,{})},"network")},"network-create"),Fe.canSeeComposeListManage&&(0,e.jsx)(on,{composeItem:t,onFinish:O()(m()().mark(function y(){return m()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:gn.info(D.format("messageYamlEditFinish")),fe(F+1);case 2:case"end":return f.stop()}},y)}))}),Fe.canSeeComposeListManageCreate&&(0,e.jsx)(me.Link,{to:"/compose/create?id="+(t.id||t.name),children:(0,e.jsx)(le.Z,{title:D.format("drawerEditButtonTip"),children:(0,e.jsx)(k.Z,{})})})]}),title:(0,e.jsx)(_.Z,{children:D.format("drawerTitle",{name:(G=t==null?void 0:t.name)!==null&&G!==void 0?G:""})}),open:U,onClose:function(){Z(!1),P(void 0),o.onClose&&o.onClose()},children:[(0,e.jsx)(fn,{onFinish:function(l){var f,w,S,a=((f=ee.current)===null||f===void 0?void 0:f.getFieldFormatValue)&&((w=ee.current)===null||w===void 0?void 0:w.getFieldFormatValue("environment"));a==null||a.forEach(function(p,H){var Q=l.find(function(pe){return pe.name==p.name});Q&&(a[H].value=Q.value)}),!((S=ee.current)===null||S===void 0)&&S.setFieldValue&&ee.current.setFieldValue("environment",a)},ref:yn}),(0,e.jsx)(ln.Z,{ref:Le,children:(0,e.jsxs)(z.Z,{direction:"column",ghost:!0,gutter:[10,10],children:[(0,e.jsxs)(z.Z,{title:(0,e.jsx)(ne.Z,{}),subTitle:D.format("managerTitle"),ghost:!0,extra:(0,e.jsx)(e.Fragment,{children:t&&t.imageList&&t.imageList.length>0&&(0,e.jsx)(s.Z,{ref:Te,image:t.imageList})}),children:[t&&t.setting.type=="dangling"&&(0,e.jsx)(De.Z,{type:"warning",showIcon:!0,description:(0,e.jsxs)("div",{children:[D.format("managerStatusDanglingAlert",{name:t.name})," ",(0,e.jsx)("a",{href:"https://dpanel.cc/#/zh-cn/manual/compose/external",target:"_blank",children:b.FD.format("help")})]})}),t&&t.setting.type!="dangling"&&(0,e.jsxs)(_.Z,{wrap:!0,split:(0,e.jsx)(de.Z,{type:"vertical"}),children:[(0,e.jsx)(Oe.u,{access:"canSeeComposeList",children:(0,e.jsx)(X.Z,{icon:(0,e.jsx)(J.Z,{}),type:"primary",confirmOnOpenChange:function(l){var f;l&&(!((f=oe.current)===null||f===void 0)&&f.resetFields)&&oe.current.resetFields()},confirm:(0,e.jsxs)(_.Z,{style:{width:300},direction:"vertical",children:[(0,e.jsx)(ie.Z.Text,{children:D.format("managerCreateTip")}),(0,e.jsxs)(re.A,{name:"createForm",formRef:oe,layout:"inline",submitter:!1,children:[(0,e.jsx)(ae.Z.Group,{name:"pullImageUse",layout:"vertical",fieldProps:{style:{display:"flex",flexDirection:"column",gap:8}},valueEnum:{useCommand:D.format("managerCreatePullImageUseCommand"),useDPanel:D.format("managerCreatePullImageUseDPanel")}}),(0,e.jsx)($.Z,{initialValue:!0,name:"createPath",valuePropName:"checked",children:(0,e.jsx)(se.Z,{defaultChecked:!0,children:D.format("managerCreateCreatePath")})}),(0,e.jsx)($.Z,{initialValue:!0,name:"removeOrphans",valuePropName:"checked",children:(0,e.jsx)(se.Z,{defaultChecked:!0,children:D.format("managerCreateRemoveOrphans")})})]})]}),action:O()(m()().mark(function y(){var l,f,w,S,a,p,H,Q,pe,E,W,A;return m()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(E={id:t.id||t.name},(l=oe.current)!==null&&l!==void 0&&l.getFieldValue&&((f=oe.current)===null||f===void 0?void 0:f.getFieldValue("pullImageUse"))=="useDPanel"&&(E.pullImage=!1,E.pullImageUseDPanel=!0),(w=oe.current)!==null&&w!==void 0&&w.getFieldValue&&((S=oe.current)===null||S===void 0?void 0:S.getFieldValue("pullImageUse"))=="useCommand"&&(E.pullImage=!0),W=((a=ee.current)===null||a===void 0?void 0:a.getFieldsFormatValue)&&ee.current.getFieldsFormatValue(),E.environment=W.environment,E.deployServiceName=W.deployServiceName,E.createPath=(p=(H=oe.current)===null||H===void 0?void 0:H.getFieldValue("createPath"))!==null&&p!==void 0?p:!0,E.removeOrphans=(Q=(pe=oe.current)===null||pe===void 0?void 0:pe.getFieldValue("removeOrphans"))!==null&&Q!==void 0?Q:!0,!(t!=null&&t.isDeploy)){K.next=12;break}if(!((A=oe.current)!==null&&A!==void 0&&A.getFieldValue("pullImageUseCommand"))){K.next=12;break}return K.next=12,(0,T.GG)({id:t.id||t.name,op:"pull"});case 12:return K.abrupt("return",Cn(E));case 13:case"end":return K.stop()}},y)})),children:D.format(t.isDeploy?"managerUpgradeButton":"managerCreateButton")},"create")}),(t.isDeploy||t.isCreated)&&Fe.canSeeComposeListManage&&(0,e.jsx)(X.Z,{action:function(){var l;return(l=ue.current)===null||l===void 0||l.show(),(0,T.mg)({id:t.id||t.name,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1})},onSuccess:function(){fe(F+1)},type:"primary",danger:!0,confirm:"notification.confirm.title",icon:(0,e.jsx)(ge.Z,{}),children:D.format("managerDeleteContainerButton")}),t.isDeploy&&(0,e.jsxs)(Oe.u,{access:"canSeeComposeList",space:{direction:"horizontal"},children:[(0,e.jsx)(X.Z,{icon:(0,e.jsx)(L.Z,{}),action:O()(m()().mark(function y(){var l;return m()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return(l=ue.current)===null||l===void 0||l.show(),w.abrupt("return",(0,T.GG)({id:t.id||t.name,op:"restart"}));case 2:case"end":return w.stop()}},y)})),onSuccess:function(){fe(F+1)},children:D.format("managerRestartButton")},"restart"),(0,e.jsx)(X.Z,{action:function(){var l;return(l=ue.current)===null||l===void 0||l.show(),(0,T.GG)({id:t.id||t.name,op:"stop"})},icon:(0,e.jsx)(Re.Z,{}),disabled:t.isExited,onSuccess:function(){fe(F+1)},children:D.format("managerStopButton")}),t.isPaused&&(0,e.jsx)(X.Z,{action:function(){var l;return(l=ue.current)===null||l===void 0||l.show(),(0,T.GG)({id:t.id||t.name,op:"unpause"})},onSuccess:function(){fe(F+1)},icon:(0,e.jsx)(te.Z,{}),children:D.format("managerUnpauseButton")}),!t.isPaused&&(0,e.jsx)(X.Z,{action:function(){var l;return(l=ue.current)===null||l===void 0||l.show(),(0,T.GG)({id:t.id||t.name,op:"pause"})},onSuccess:function(){fe(F+1)},icon:(0,e.jsx)(Pe.Z,{}),disabled:!t.isRunning,children:D.format("managerPauseButton")})]}),t.id>0&&Fe.canSeeComposeListManageDelete&&(0,e.jsx)(X.Z,{type:"primary",action:O()(m()().mark(function y(){var l,f,w,S,a,p,H,Q;return m()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return(l=ue.current)===null||l===void 0||l.show(),E.next=3,(0,T.mg)({id:(f=t==null?void 0:t.id)!==null&&f!==void 0?f:t.name,deleteImage:(w=(S=Ce.current)===null||S===void 0?void 0:S.getFieldValue("deleteImage"))!==null&&w!==void 0?w:!1,deleteVolume:(a=(p=Ce.current)===null||p===void 0?void 0:p.getFieldValue("deleteVolume"))!==null&&a!==void 0?a:!1,deletePath:(H=(Q=Ce.current)===null||Q===void 0?void 0:Q.getFieldValue("deletePath"))!==null&&H!==void 0?H:!1,deleteData:!0});case 3:Z(!1),P(void 0),o.onClose&&o.onClose();case 6:case"end":return E.stop()}},y)})),danger:!0,onSuccess:function(){},confirmOnOpenChange:function(){var l;!((l=Ce.current)===null||l===void 0)&&l.resetFields&&Ce.current.resetFields()},confirm:(0,e.jsxs)(_.Z,{style:{width:240},direction:"vertical",children:[(0,e.jsx)(ie.Z.Text,{children:D.format("managerDeleteTaskTip")}),(0,e.jsxs)(re.A,{formRef:Ce,layout:"inline",submitter:!1,children:[(0,e.jsx)($.Z,{initialValue:!1,name:"deleteImage",valuePropName:"checked",children:(0,e.jsx)(se.Z,{children:D.format("managerDeleteTaskDeleteImage")})}),(0,e.jsx)($.Z,{addonAfter:(0,e.jsx)(le.Z,{title:D.format("managerDeleteTaskDeleteVolumeTip"),children:(0,e.jsx)(ce.Z,{})}),initialValue:!1,name:"deleteVolume",valuePropName:"checked",children:(0,e.jsx)(se.Z,{children:D.format("managerDeleteTaskDeleteVolume")})}),(0,e.jsx)($.Z,{initialValue:!1,name:"deletePath",valuePropName:"checked",children:(0,e.jsx)(se.Z,{children:D.format("managerDeleteTaskDeletePath")})})]})]}),children:D.format("managerDeleteTaskButton")}),o.showBackListButton&&(0,e.jsx)(me.Link,{to:"/compose/list",children:(0,e.jsx)(c.ZP,{children:b.Ob.format("compose.list")})})]})]},"operator"),t&&(0,e.jsx)(Ve,{ref:ue,id:t.id||t.name}),t&&(0,e.jsx)(Je,{containerList:t.containerList,enableSelectService:!t.isDeploy,selectServiceFinish:function(l){var f;(f=ee.current)===null||f===void 0||f.setFieldValue("deployServiceName",l)}}),(0,e.jsx)(Oe.u,{access:"canSeeComposeList",children:(0,e.jsxs)(re.A,{submitter:!1,formRef:ee,children:[(0,e.jsx)($.Z,{name:"deployServiceName",hidden:!0}),t&&t.setting.type!="dangling"&&(0,e.jsx)(z.Z,{title:D.format("envTitle"),subTitle:D.format("envSubTitle"),tooltip:D.format("envTip"),ghost:!0,children:(0,e.jsx)(B.Z,{showCardGhost:!0,name:"environment",showDisableName:!0,requireValue:!0,showDeleteButton:!1})})]})})]})})]})}),vn=pn},75544:function(Ee,je,n){var xe=n(5574),h=n.n(xe),we=n(12323),C=n(78267),V=n.n(C),m=n(75458),he=n.n(m),O=n(67294),u=n(4244),X=n.n(u),T=n(24078),Se=n(85893),k,ne,J,ge=(0,O.forwardRef)(function(L,Re){var te,Pe=(0,O.useState)(!0),ce=h()(Pe,2),z=ce[0],re=ce[1];return(0,O.useEffect)(function(){return k=new u.Terminal(we.X),ne=new m.SearchAddon,J=new C.FitAddon,window.addEventListener("resize",function(){L.showInModal||J.fit()}),L.style&&L.style.fontSize&&(k.options.fontSize=L.style.fontSize),k.loadAddon(J),k.loadAddon(ne),k.open(document.getElementById(L.id?L.id:"terminal-container")),L.showInModal||J.fit(),function(){k.reset(),re(!0)}},[]),(0,O.useImperativeHandle)(Re,function(){return{write:function($){z&&(J.fit(),re(!1)),k.write($)},clear:function(){k.clear()},getTerminal:function(){return k},findNext:function($){ne.findNext($)},findPrev:function($){ne.findPrevious($)},fit:function(){J.fit()},onData:function($){return k.onData($)}}}),(0,Se.jsx)("div",{id:L.id?L.id:"terminal-container",style:{width:L.width?L.width:"100%",height:L.height?L.height:"500px",marginTop:(te=L.style)===null||te===void 0?void 0:te.marginTop}})});je.Z=ge},90098:function(Ee,je,n){n.d(je,{GG:function(){return Re},MG:function(){return me},Oh:function(){return ne},Pn:function(){return X},U_:function(){return ae},Yz:function(){return Pe},iE:function(){return ie},ik:function(){return Se},im:function(){return m},mg:function(){return ge},pm:function(){return O},tw:function(){return De},vf:function(){return z},xC:function(){return _}});var xe=n(15009),h=n.n(xe),we=n(99289),C=n.n(we),V=n(82346);function m(c){return he.apply(this,arguments)}function he(){return he=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,V.request)("/api/app/compose/create",{method:"POST",data:s}));case 1:case"end":return r.stop()}},c)})),he.apply(this,arguments)}function O(c){return u.apply(this,arguments)}function u(){return u=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,V.request)("/api/app/compose/get-list",{method:"POST",data:s}));case 1:case"end":return r.stop()}},c)})),u.apply(this,arguments)}function X(c){return T.apply(this,arguments)}function T(){return T=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/get-task",{method:"POST",data:s}));case 2:case"end":return r.stop()}},c)})),T.apply(this,arguments)}function Se(c){return k.apply(this,arguments)}function k(){return k=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,V.request)("/api/app/compose/delete",{method:"POST",data:s}));case 1:case"end":return r.stop()}},c)})),k.apply(this,arguments)}function ne(c){return J.apply(this,arguments)}function J(){return J=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/container-deploy",{method:"POST",data:s}));case 2:case"end":return r.stop()}},c)})),J.apply(this,arguments)}function ge(c){return L.apply(this,arguments)}function L(){return L=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/container-destroy",{method:"POST",data:s}));case 2:case"end":return r.stop()}},c)})),L.apply(this,arguments)}function Re(c){return te.apply(this,arguments)}function te(){return te=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/container-ctrl",{method:"POST",data:s}));case 2:case"end":return r.stop()}},c)})),te.apply(this,arguments)}function Pe(c){return ce.apply(this,arguments)}function ce(){return ce=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/container-log",{method:"POST",data:s}));case 2:case"end":return r.stop()}},c)})),ce.apply(this,arguments)}function z(c){return re.apply(this,arguments)}function re(){return re=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.download=!0,s.id=String(s.id),r.next=4,(0,V.request)("/api/app/compose/container-log",{method:"POST",data:s,responseType:"blob"});case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}},c)})),re.apply(this,arguments)}function ae(c){return $.apply(this,arguments)}function $(){return $=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,V.request)("/api/app/compose/container-process-kill",{method:"POST",data:s}));case 1:case"end":return r.stop()}},c)})),$.apply(this,arguments)}function me(c){return ye.apply(this,arguments)}function ye(){return ye=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,V.request)("/api/app/compose/get-from-uri",{method:"POST",data:s}));case 1:case"end":return r.stop()}},c)})),ye.apply(this,arguments)}function _(c){return de.apply(this,arguments)}function de(){return de=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/parse",{method:"POST",data:s}));case 2:case"end":return r.stop()}},c)})),de.apply(this,arguments)}function ie(c){return le.apply(this,arguments)}function le(){return le=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,V.request)("/api/common/store/deploy",{method:"POST",data:s}));case 1:case"end":return r.stop()}},c)})),le.apply(this,arguments)}function De(c){return se.apply(this,arguments)}function se(){return se=C()(h()().mark(function c(s){return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return s.id=String(s.id),r.abrupt("return",(0,V.request)("/api/app/compose/download",{method:"POST",data:s,responseType:"blob"}));case 2:case"end":return r.stop()}},c)})),se.apply(this,arguments)}}}]);
