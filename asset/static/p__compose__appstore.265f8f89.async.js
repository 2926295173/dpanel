"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7499],{43774:function(oe,U,t){t.r(U),t.d(U,{default:function(){return xe}});var Q=t(5574),c=t.n(Q),H=t(24963),S=t(15078),Z=t(90078),W=t(97269),z=t(62370),V=t(97462),B=t(38345),ae=t(45360),F=t(42075),X=t(65233),b=t(28036),Y=t(92398),P=t(2487),G=t(32983),M=t(4393),n=t(67294),h=t(15009),p=t.n(h),r=t(99289),k=t.n(r),le=t(184),ce=t(5966),q=t(51652),K=t(71230),C=t(15746),de=t(34041),he=t(74842),_=t(25593),me=t(83062),re=t(66309),e=t(85893);function se(a){var A=(0,n.useState)(),v=c()(A,2),d=v[0],g=v[1];return(0,n.useEffect)(function(){var D=a.url.substring(0,a.url.indexOf("://"));switch(D){case"image":g((0,e.jsx)("img",{width:a.imageSize?a.imageSize.width:"auto",height:a.imageSize?a.imageSize.height:"auto",src:a.url.replace("image://","/dpanel/static/store/file/")}));break;case"http":case"https":g((0,e.jsx)("img",{width:a.imageSize?a.imageSize.width:"auto",height:a.imageSize?a.imageSize.height:"auto",src:a.url}));break;case"markdown-file":(0,S.yL)({path:a.url.replace("markdown-file://","/dpanel/static/store/file/")}).then(function(I){g((0,e.jsx)(q.Z,{source:I,style:{padding:5}},"content"))});break;case"markdown":g((0,e.jsx)(q.Z,{source:a.url.replace("markdown://",""),style:{padding:5}},"content"));break;default:g("")}},[a.url]),(0,e.jsx)(e.Fragment,{children:d})}function ie(a){return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(K.Z,{gutter:[10,10],children:[(0,e.jsx)(C.Z,{span:6,children:(0,e.jsx)(se,{url:a.app.logo,imageSize:a.logoSize})}),(0,e.jsxs)(C.Z,{span:a.extra?12:18,children:[(0,e.jsx)(K.Z,{children:(0,e.jsx)(C.Z,{span:24,children:(0,e.jsxs)(F.Z,{direction:"horizontal",children:[(0,e.jsx)(_.Z.Title,{level:5,children:(0,e.jsx)("a",{href:a.app.website,target:"_blank",children:a.app.title})}),(0,e.jsx)(_.Z.Text,{children:a.app.name})]})})}),(0,e.jsx)(K.Z,{style:{height:"60px"},children:(0,e.jsx)(C.Z,{children:(0,e.jsx)(me.Z,{title:a.app.description,children:(0,e.jsx)(_.Z.Paragraph,{ellipsis:{rows:2},children:a.app.description})})})}),(0,e.jsx)(K.Z,{style:{height:"35px"},children:(0,e.jsx)(C.Z,{children:(0,e.jsxs)(F.Z,{wrap:!0,children:[a.app.storeName?(0,e.jsx)(re.Z,{color:"blue-inverse",children:a.app.storeName}):"",a.app.tag&&a.app.tag.map(function(A,v){return(0,e.jsx)(re.Z,{children:A},v)})]})})})]}),(0,e.jsx)(C.Z,{span:a.extra?6:0,children:a.extra})]})})}var pe=t(80821),fe=t(90098),ue=t(82346),ve=t(73587),ge=(0,n.forwardRef)(function(a,A){var v=(0,n.useState)(!1),d=c()(v,2),g=d[0],D=d[1],I=(0,n.useState)(),ee=c()(I,2),u=ee[0],J=ee[1],j=(0,n.useState)(""),O=c()(j,2),R=O[0],N=O[1],te=(0,ue.useNavigate)(),L=(0,n.useRef)(),w=(0,n.useRef)(),o=(0,n.useState)(),i=c()(o,2),y=i[0],E=i[1];return(0,n.useImperativeHandle)(A,function(){return{show:function(l){D(!0),J(l),N(Object.keys(l.version)[0])}}}),(0,e.jsxs)(le.a,{submitter:!1,open:g,onOpenChange:function(l){D(l)},title:"".concat(u==null?void 0:u.name," \u8BE6\u60C5\u4ECB\u7ECD"),children:[(0,e.jsx)(ve.Z,{showBackListButton:!0,ref:w,onDeployFinish:function(){te("/compose/list")},onDeployFailed:function(){var s=k()(p()().mark(function l(m){return p()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:case"end":return x.stop()}},l)}));return function(l){return s.apply(this,arguments)}}(),onClose:k()(p()().mark(function s(){return p()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:case"end":return m.stop()}},s)}))}),u&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B.Z,{ghost:!0,style:{marginBottom:"20px",paddingBottom:"20px",borderBottom:"#eeeeee solid 1px"},children:(0,e.jsx)(ie,{app:u,logoSize:{width:"130",height:"130"},extra:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(K.Z,{gutter:[10,10],children:[(0,e.jsx)(C.Z,{span:24,children:(0,e.jsx)(pe.Z,{block:!0,type:"primary",action:k()(p()().mark(function s(){var l,m,f,x,ne;return p()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,(0,fe.iE)({storeId:(l=u.storeId)!==null&&l!==void 0?l:0,name:(m=(f=L.current)===null||f===void 0?void 0:f.getFieldValue("name"))!==null&&m!==void 0?m:u.name,title:u.title,composeFile:u.version[R].composeFile,environment:u.version[R].environment});case 2:x=$.sent,x&&x.data.id&&(E(x.data.id),(ne=w.current)===null||ne===void 0||ne.show(x.data.id));case 4:case"end":return $.stop()}},s)})),icon:(0,e.jsx)(he.Z,{}),confirm:(0,e.jsx)(W.A,{submitter:!1,formRef:L,layout:"horizontal",isKeyPressSubmit:!0,children:(0,e.jsx)(ce.Z,{label:"\u6807\u8BC6",name:"name"})}),children:"\u90E8\u7F72"},"deploy")}),(0,e.jsx)(C.Z,{span:24,children:u.version&&(0,e.jsx)(de.Z,{style:{width:"100%"},value:R,onChange:function(l){N(l)},options:Object.keys(u.version).map(function(s){return{value:s,label:s}})})})]})})})}),Object.keys(u.version).map(function(s){if(!(R!=s||!u.version[s].environment||u.version[s].environment.length==0)){var l=[{name:"%CONTAINER_DEFAULT_NAME%",value:"-",label:"\u4F7F\u7528 Compose \u9ED8\u8BA4\u5BB9\u5668\u540D\u79F0"}],m=`## DPanel \u9762\u677F\u5185\u7F6E\u53D8\u91CF 
 |\u53D8\u91CF\u540D|\u9ED8\u8BA4\u503C|\u8BF4\u660E| 
 |---|---|---|
`;return l.map(function(f){m+="|".concat(f.name,"|").concat(f.value,"|").concat(f.label,`| 
`)}),m+="## \u7248\u672C\u4FE1\u606F <sup>".concat(s,`</sup> 
 |\u53D8\u91CF\u540D|\u9ED8\u8BA4\u503C|\u8BF4\u660E| 
 |---|---|---|
`),u.version[s].environment.map(function(f){m+="|".concat(f.name,"|").concat(f.value,"|").concat(f.label,`| 
`)}),m+="<br />",(0,e.jsx)(q.Z,{source:m,style:{padding:5}},s)}}),(0,e.jsx)(se,{url:u==null?void 0:u.content})]})]})}),je=ge,T="dpanel-search-result";function xe(){var a=(0,n.useRef)(),A=(0,n.useState)(),v=c()(A,2),d=v[0],g=v[1],D=(0,n.useContext)(H.Z),I=D.loading,ee=D.lang,u=(0,n.useState)(""),J=c()(u,2),j=J[0],O=J[1],R=(0,n.useState)([]),N=c()(R,2),te=N[0],L=N[1];(0,n.useEffect)(function(){I.show(),(0,S.eO)().then(function(o){o&&o.data&&o.data.list&&o.data.list.push({id:-1,name:T,title:"\u641C\u7D22\u7ED3\u679C",setting:{apps:[]}}),g(Object.fromEntries(o.data.list.map(function(i){return[i.name,i]}))),o.data.list.length>0&&O(o.data.list[0].name)}).finally(function(){I.destroy()})},[]);var w=function(i){var y=[];i=i.toLowerCase(),d&&(Object.keys(d).map(function(E){E!=T&&d[E].setting.apps.map(function(s){if(i&&(s.name.toLowerCase().indexOf(i)!==-1||s.title&&s.title.toLowerCase().indexOf(i)!==-1||s.description&&s.description.toLocaleLowerCase().indexOf(i)!==-1)){var l=JSON.parse(JSON.stringify(s));l.storeName="".concat(d[E].title),l.storeId=d[E].id,y.push(l)}})}),y.length>0?(L(y),O(T)):(ae.ZP.error("\u672A\u80FD\u627E\u5230\u5305\u542B\u5173\u952E\u5B57\u7684\u5E94\u7528"),O(Object.keys(d)[0]),L([])))};return(0,e.jsxs)(Z._z,{extra:[(0,e.jsx)(W.A,{isKeyPressSubmit:!0,submitter:!1,onFinish:function(i){w(i.search)},children:(0,e.jsxs)(F.Z.Compact,{children:[(0,e.jsx)(z.Z,{style:{margin:0},name:"search",children:(0,e.jsx)(X.Z,{allowClear:!0,addonBefore:"\u5168\u5546\u5E97\u67E5\u8BE2",placeholder:"\u6309\u56DE\u8F66\u67E5\u8BE2\u5E94\u7528",onClear:function(){w("")}})}),(0,e.jsx)(V.Z,{name:["search"],children:function(i){var y=i.search;return(0,e.jsx)(b.ZP,{onClick:function(){w(y)},children:"\u641C\u7D22"})}})]})},"form")],children:[(0,e.jsx)(je,{ref:a}),(0,e.jsxs)(B.Z,{children:[j!=""&&d&&(0,e.jsx)(Y.Z,{activeKey:j,onChange:function(i){L([]),O(i)},items:Object.keys(d).map(function(o){return{label:d[o].title,key:o,disabled:j!=T&&o==T}})}),(0,e.jsx)(P.Z,{locale:{emptyText:(0,e.jsx)(G.Z,{image:G.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsxs)(e.Fragment,{children:["\u9762\u677F\u652F\u6301\u591A\u79CD\u7C7B\u578B\u7684\u7B2C\u4E09\u65B9\u5E94\u7528\u5546\u5E97\uFF0C",(0,e.jsx)(ue.Link,{to:"/system/appstore?op=create",children:"\u8BF7\u5148\u6DFB\u52A0\u7B2C\u4E09\u65B9\u5546\u5E97"})]})})},pagination:{pageSize:36},rowKey:function(i){return"".concat(i.name).concat(i.storeName)},grid:{gutter:10,xs:1,sm:2,md:2,lg:2,xl:2,xxl:3},dataSource:j==T?te:d&&d[j]&&d[j].setting.apps,renderItem:function(i,y){return(0,e.jsx)(P.Z.Item,{children:(0,e.jsx)(M.Z,{onClick:function(){if(d){var s;i.storeId||(i.storeId=d[j].id),(s=a.current)===null||s===void 0||s.show(i)}},hoverable:!0,children:(0,e.jsx)(ie,{app:i,logoSize:{width:"50",height:"50"}})})},y)}})]})]})}},15078:function(oe,U,t){t.d(U,{$c:function(){return W},Me:function(){return Y},eO:function(){return X},ks:function(){return V},yL:function(){return G}});var Q=t(15009),c=t.n(Q),H=t(99289),S=t.n(H),Z=t(82346);function W(n){return z.apply(this,arguments)}function z(){return z=S()(c()().mark(function n(h){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,Z.request)("/api/common/store/create",{method:"POST",data:h}));case 1:case"end":return r.stop()}},n)})),z.apply(this,arguments)}function V(n){return B.apply(this,arguments)}function B(){return B=S()(c()().mark(function n(h){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,Z.request)("/api/common/store/sync",{method:"POST",data:h}));case 1:case"end":return r.stop()}},n)})),B.apply(this,arguments)}function ae(n){return F.apply(this,arguments)}function F(){return F=_asyncToGenerator(_regeneratorRuntime().mark(function n(h){return _regeneratorRuntime().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",request("/api/common/store/get-detail",{method:"POST",data:h}));case 1:case"end":return r.stop()}},n)})),F.apply(this,arguments)}function X(n){return b.apply(this,arguments)}function b(){return b=S()(c()().mark(function n(h){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,Z.request)("/api/common/store/get-list",{method:"POST",data:h}));case 1:case"end":return r.stop()}},n)})),b.apply(this,arguments)}function Y(n){return P.apply(this,arguments)}function P(){return P=S()(c()().mark(function n(h){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,Z.request)("/api/common/store/delete",{method:"POST",data:h});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},n)})),P.apply(this,arguments)}function G(n){return M.apply(this,arguments)}function M(){return M=S()(c()().mark(function n(h){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,Z.request)(h==null?void 0:h.path,{method:"GET"}));case 1:case"end":return r.stop()}},n)})),M.apply(this,arguments)}}}]);
