"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7499],{43774:function(le,W,t){t.r(W),t.d(W,{default:function(){return Ee}});var Q=t(5574),h=t.n(Q),H=t(24963),f=t(15078),y=t(90078),$=t(97269),L=t(62370),V=t(97462),D=t(38345),se=t(45360),E=t(42075),X=t(65233),z=t(28036),Y=t(92398),O=t(2487),k=t(86250),B=t(32983),m=t(4393),s=t(67294),C=t(15009),n=t.n(C),ce=t(99289),q=t.n(ce),de=t(184),he=t(5966),_=t(51652),M=t(71230),x=t(15746),me=t(34041),pe=t(74842),ee=t(25593),fe=t(83062),ie=t(66309),e=t(85893);function ue(a){var Z=(0,s.useState)(),v=h()(Z,2),c=v[0],g=v[1];return(0,s.useEffect)(function(){var A=a.url.substring(0,a.url.indexOf("://"));switch(A){case"image":g((0,e.jsx)("img",{width:a.imageSize?a.imageSize.width:"auto",height:a.imageSize?a.imageSize.height:"auto",src:a.url.replace("image://","/dpanel/static/store/file/")}));break;case"http":case"https":g((0,e.jsx)("img",{width:a.imageSize?a.imageSize.width:"auto",height:a.imageSize?a.imageSize.height:"auto",src:a.url}));break;case"markdown-file":(0,f.yL)({path:a.url.replace("markdown-file://","/dpanel/static/store/file/")}).then(function(R){g((0,e.jsx)(_.Z,{source:R,style:{padding:5}},"content"))});break;case"markdown":g((0,e.jsx)(_.Z,{source:a.url.replace("markdown://",""),style:{padding:5}},"content"));break;default:g("")}},[a.url]),(0,e.jsx)(e.Fragment,{children:c})}function oe(a){return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(M.Z,{gutter:[10,10],children:[(0,e.jsx)(x.Z,{span:6,children:(0,e.jsx)(ue,{url:a.app.logo,imageSize:a.logoSize})}),(0,e.jsxs)(x.Z,{span:a.extra?12:18,children:[(0,e.jsx)(M.Z,{children:(0,e.jsx)(x.Z,{span:24,children:(0,e.jsxs)(E.Z,{direction:"horizontal",children:[(0,e.jsx)(ee.Z.Title,{level:5,children:(0,e.jsx)("a",{href:a.app.website,target:"_blank",children:a.app.title})}),(0,e.jsx)(ee.Z.Text,{children:a.app.name})]})})}),(0,e.jsx)(M.Z,{style:{height:"60px"},children:(0,e.jsx)(x.Z,{children:(0,e.jsx)(fe.Z,{title:a.app.description,children:(0,e.jsx)(ee.Z.Paragraph,{ellipsis:{rows:2},children:a.app.description})})})}),(0,e.jsx)(M.Z,{style:{height:"35px"},children:(0,e.jsx)(x.Z,{children:(0,e.jsxs)(E.Z,{wrap:!0,children:[a.app.storeName?(0,e.jsx)(ie.Z,{color:"blue-inverse",children:a.app.storeName}):"",a.app.tag&&a.app.tag.map(function(Z,v){return(0,e.jsx)(ie.Z,{children:Z},v)})]})})})]}),(0,e.jsx)(x.Z,{span:a.extra?6:0,children:a.extra})]})})}var ve=t(80821),ge=t(90098),te=t(82346),je=t(69626),xe=t(3616),Se=(0,s.forwardRef)(function(a,Z){var v=(0,s.useState)(!1),c=h()(v,2),g=c[0],A=c[1],R=(0,s.useState)(),ne=h()(R,2),l=ne[0],G=ne[1],j=(0,s.useState)(""),S=h()(j,2),T=S[0],K=S[1],ae=(0,te.useNavigate)(),F=(0,s.useRef)(),I=(0,s.useRef)(),b=(0,s.useState)(),u=h()(b,2),o=u[0],p=u[1];return(0,s.useImperativeHandle)(Z,function(){return{show:function(i){A(!0),G(i),K(Object.keys(i.version)[0])}}}),(0,e.jsxs)(de.a,{drawerProps:{width:xe.R_},submitter:!1,open:g,onOpenChange:function(i){var d;A(i),(d=F.current)===null||d===void 0||d.resetFields()},title:"".concat(l==null?void 0:l.name," \u8BE6\u60C5\u4ECB\u7ECD"),children:[(0,e.jsx)(je.Z,{showBackListButton:!0,ref:I,onDeployFinish:function(){ae("/compose/list")},onDeployFailed:function(){var r=q()(n()().mark(function i(d){return n()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:case"end":return w.stop()}},i)}));return function(i){return r.apply(this,arguments)}}(),onClose:q()(n()().mark(function r(){return n()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:case"end":return d.stop()}},r)}))}),l&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(D.Z,{ghost:!0,style:{marginBottom:"20px",paddingBottom:"20px",borderBottom:"#eeeeee solid 1px"},children:(0,e.jsx)(oe,{app:l,logoSize:{width:"130",height:"130"},extra:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(M.Z,{gutter:[10,10],children:[(0,e.jsx)(x.Z,{span:24,children:(0,e.jsx)(ve.Z,{block:!0,type:"primary",action:q()(n()().mark(function r(){var i,d,J,w,N,re;return n()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return w={storeId:(i=l.storeId)!==null&&i!==void 0?i:0,name:(d=(J=F.current)===null||J===void 0?void 0:J.getFieldValue("name"))!==null&&d!==void 0?d:"".concat(l.name,"-%CURRENT_DATE%"),appName:l.name,title:l.title,composeFile:l.version[T].composeFile,environment:l.version[T].environment},U.next=3,(0,ge.iE)(w);case 3:N=U.sent,N&&N.data.id&&(p(N.data.id),(re=I.current)===null||re===void 0||re.show(N.data.id));case 5:case"end":return U.stop()}},r)})),icon:(0,e.jsx)(pe.Z,{}),confirm:(0,e.jsx)($.A,{submitter:!1,formRef:F,layout:"horizontal",isKeyPressSubmit:!0,children:(0,e.jsx)(he.Z,{placeholder:"\u9ED8\u8BA4\u81EA\u52A8\u751F\u6210\u6807\u8BC6",width:"md",label:"\u81EA\u5B9A\u4E49\u4EFB\u52A1\u6807\u8BC6",name:"name"})}),children:"\u90E8\u7F72"},"deploy")}),(0,e.jsx)(x.Z,{span:24,children:l.version&&(0,e.jsx)(me.Z,{style:{width:"100%"},value:T,onChange:function(i){K(i)},options:Object.keys(l.version).map(function(r){return{value:r,label:r}})})})]})})})}),Object.keys(l.version).map(function(r){if(!(T!=r||!l.version[r].environment||l.version[r].environment.length==0)){var i="";return i+="## \u7248\u672C\u4FE1\u606F <sup>".concat(r,`</sup> 
 |\u53D8\u91CF\u540D|\u9ED8\u8BA4\u503C|\u8BF4\u660E| 
 |---|---|---|
`),l.version[r].environment.map(function(d){i+="|".concat(d.name,"|").concat(d.value,"|").concat(d.label,`| 
`)}),i+="<br />",(0,e.jsx)(_.Z,{source:i,style:{padding:5}},r)}}),(0,e.jsx)(ue,{url:l==null?void 0:l.content})]})]})}),ye=Se,P="dpanel-search-result";function Ee(){var a=(0,s.useRef)(),Z=(0,s.useState)(),v=h()(Z,2),c=v[0],g=v[1],A=(0,s.useContext)(H.Z),R=A.loading,ne=A.lang,l=(0,s.useState)(""),G=h()(l,2),j=G[0],S=G[1],T=(0,s.useState)([]),K=h()(T,2),ae=K[0],F=K[1],I=(0,te.useLocation)();(0,s.useEffect)(function(){R.show(),(0,f.eO)().then(function(u){if(u&&u.data&&u.data.list&&u.data.list.push({id:-1,name:P,title:"\u641C\u7D22\u7ED3\u679C",setting:{apps:[]}}),u.data.list&&u.data.list.forEach(function(p){if(p.setting.type=="1panel-local"&&(!p.setting.updatedAt||Math.floor(Date.now()/1e3)-p.setting.updatedAt>86400)){var r;(0,f.ks)({id:p.id,name:p.name,url:(r=p.setting.url)!==null&&r!==void 0?r:"",type:"1panel-local"})}}),g(Object.fromEntries(u.data.list.map(function(p){return[p.name,p]}))),I.state){var o=I.state;o.name!=""&&S(I.state.name)}else u.data.list.length>0&&S(u.data.list[0].name)}).finally(function(){R.destroy()})},[]);var b=function(o){var p=[];o=o.toLowerCase(),c&&(Object.keys(c).map(function(r){r!=P&&c[r].setting.apps&&c[r].setting.apps.map(function(i){if(o&&(i.name.toLowerCase().indexOf(o)!==-1||i.title&&i.title.toLowerCase().indexOf(o)!==-1||i.description&&i.description.toLocaleLowerCase().indexOf(o)!==-1)){var d=JSON.parse(JSON.stringify(i));d.storeName="".concat(c[r].title),d.storeId=c[r].id,p.push(d)}})}),p.length>0?(F(p),S(P)):(se.ZP.error("\u672A\u80FD\u627E\u5230\u5305\u542B\u5173\u952E\u5B57\u7684\u5E94\u7528"),S(Object.keys(c)[0]),F([])))};return(0,e.jsxs)(y._z,{extra:[(0,e.jsx)($.A,{isKeyPressSubmit:!0,submitter:!1,onFinish:function(o){b(o.search)},children:(0,e.jsxs)(E.Z.Compact,{children:[(0,e.jsx)(L.Z,{style:{margin:0},name:"search",children:(0,e.jsx)(X.Z,{allowClear:!0,addonBefore:"\u5168\u5546\u5E97\u67E5\u8BE2",placeholder:"\u6309\u56DE\u8F66\u67E5\u8BE2\u5E94\u7528",onClear:function(){b("")}})}),(0,e.jsx)(V.Z,{name:["search"],children:function(o){var p=o.search;return(0,e.jsx)(z.ZP,{onClick:function(){b(p)},children:"\u641C\u7D22"})}})]})},"form")],children:[(0,e.jsx)(ye,{ref:a}),(0,e.jsxs)(D.Z,{children:[j!=""&&c&&(0,e.jsx)(Y.Z,{activeKey:j,onChange:function(o){F([]),S(o)},items:Object.keys(c).map(function(u){return{label:c[u].title,key:u,disabled:j!=P&&u==P}})}),(0,e.jsx)(O.Z,{locale:{emptyText:(0,e.jsx)(k.Z,{justify:"center",style:{height:"40vh"},vertical:!0,children:(0,e.jsx)(B.Z,{image:B.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsxs)(e.Fragment,{children:["\u9762\u677F\u652F\u6301\u591A\u79CD\u7C7B\u578B\u7684\u7B2C\u4E09\u65B9\u5E94\u7528\u5546\u5E97\uFF0C",(0,e.jsx)(te.Link,{to:"/system/appstore?op=create",children:"\u8BF7\u5148\u6DFB\u52A0\u7B2C\u4E09\u65B9\u5546\u5E97"})]})})})},pagination:{pageSize:36},rowKey:function(o){return"".concat(o.name).concat(o.storeName)},grid:{gutter:10,xs:1,sm:2,md:2,lg:2,xl:2,xxl:3},dataSource:j==P?ae:c&&c[j]&&c[j].setting.apps,renderItem:function(o,p){return(0,e.jsx)(O.Z.Item,{children:(0,e.jsx)(m.Z,{onClick:function(){if(c){var i;o.storeId||(o.storeId=c[j].id),(i=a.current)===null||i===void 0||i.show(o)}},hoverable:!0,children:(0,e.jsx)(oe,{app:o,logoSize:{width:"50",height:"50"}})})},p)}})]})]})}},15078:function(le,W,t){t.d(W,{$c:function(){return $},Me:function(){return Y},eO:function(){return X},ks:function(){return V},yL:function(){return k}});var Q=t(15009),h=t.n(Q),H=t(99289),f=t.n(H),y=t(82346);function $(m){return L.apply(this,arguments)}function L(){return L=f()(h()().mark(function m(s){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,y.request)("/api/common/store/create",{method:"POST",data:s}));case 1:case"end":return n.stop()}},m)})),L.apply(this,arguments)}function V(m){return D.apply(this,arguments)}function D(){return D=f()(h()().mark(function m(s){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,y.request)("/api/common/store/sync",{method:"POST",data:s}));case 1:case"end":return n.stop()}},m)})),D.apply(this,arguments)}function se(m){return E.apply(this,arguments)}function E(){return E=_asyncToGenerator(_regeneratorRuntime().mark(function m(s){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",request("/api/common/store/get-detail",{method:"POST",data:s}));case 1:case"end":return n.stop()}},m)})),E.apply(this,arguments)}function X(m){return z.apply(this,arguments)}function z(){return z=f()(h()().mark(function m(s){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,y.request)("/api/common/store/get-list",{method:"POST",data:s}));case 1:case"end":return n.stop()}},m)})),z.apply(this,arguments)}function Y(m){return O.apply(this,arguments)}function O(){return O=f()(h()().mark(function m(s){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,y.request)("/api/common/store/delete",{method:"POST",data:s});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},m)})),O.apply(this,arguments)}function k(m){return B.apply(this,arguments)}function B(){return B=f()(h()().mark(function m(s){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,y.request)(s==null?void 0:s.path,{method:"GET"}));case 1:case"end":return n.stop()}},m)})),B.apply(this,arguments)}}}]);
