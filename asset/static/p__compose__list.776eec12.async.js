"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8022],{44349:function(de,N,n){var Q=n(97857),T=n.n(Q),ne=n(15009),O=n.n(ne),re=n(99289),L=n.n(re),ae=n(74763),A=n(17186),F=n(5966),W=n(86250),y=n(67294),k=n(85893),X=(0,y.forwardRef)(function(f,w){var U=(0,y.useRef)();(0,y.useImperativeHandle)(w,function(){return{addItem:function(b){function E(v,R,d){return b.apply(this,arguments)}return E.toString=function(){return b.toString()},E}(function(b,E,v){var R,d=(R=U.current)===null||R===void 0?void 0:R.getList(),M;if(d==null||d.forEach(function(Y,S){Y[b]==E[b]&&(M=S)}),!(0,ae.k)(M)&&v){var H;(H=U.current)===null||H===void 0||H.remove(M),M=void 0}if(!M){var I;(I=U.current)===null||I===void 0||I.add(E)}}),removeItemByKey:function(E,v){return L()(O()().mark(function R(){var d,M;return O()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return M=(d=U.current)===null||d===void 0?void 0:d.getList(),M==null||M.forEach(function(Y,S){if(Y[E]==v){var J;(J=U.current)===null||J===void 0||J.remove(S);return}}),I.abrupt("return");case 3:case"end":return I.stop()}},R)}))()},clear:function(E){if(!E){var v;E=(v=U.current)===null||v===void 0||(v=v.getList())===null||v===void 0?void 0:v.map(function(d,M){return M})}if(E){var R;(R=U.current)===null||R===void 0||R.remove(E)}},getList:function(){var E;return(E=U.current)===null||E===void 0?void 0:E.getList()}}});var z={};return f.hideCopyButton===!0&&(z.copyIconProps=!1),f.hideDeleteButton===!0&&(z.deleteIconProps=!1),(0,k.jsx)(A.u,T()(T()({initialValue:f.initialValue,label:f.label,name:f.name,actionRef:U,creatorButtonProps:f.showAddButton?{creatorButtonText:f.label?f.label:f.showAddButtonLabel?f.showAddButtonLabel:f.name}:!1,min:f.min?f.min:0},z),{},{children:function(E,v,R){return(0,k.jsx)(W.Z,{justify:f.justify,gap:f.gap,children:f.items.map(function(d){return d.render?(0,k.jsx)("div",{children:d.render&&d.render(E,v,R)},"".concat(f.name,"-").concat(d.name,"-").concat(E.key)):(0,k.jsx)(F.Z,{width:d.width,name:d.name,label:d.label,required:d.required,rules:[{required:d.required}],disabled:d.disabled,placeholder:d.placeholder},"".concat(f.name,"-").concat(d.name,"-").concat(E.key))})})}}))});N.Z=X},36435:function(de,N,n){var Q=n(15009),T=n.n(Q),ne=n(64599),O=n.n(ne),re=n(99289),L=n.n(re),ae=n(9783),A=n.n(ae),F=n(5574),W=n.n(F),y=n(67294),k=n(184),X=n(38345),f=n(97269),w=n(97321),U=n(97462),z=n(64317),b=n(5966),E=n(86615),v=n(68602),R=n(83622),d=n(83403),M=n(24963),H=n(1699),I=n(29177),Y=n(1883),S=n(43425),J=n(44349),B=n(3616),q=n(36146),j=n(85893),ce=(0,y.forwardRef)(function(Z,_e){var me=(0,y.useState)(!1),oe=W()(me,2),p=oe[0],K=oe[1],$=(0,y.useRef)(),Ee=(0,y.useContext)(M.Z),le=Ee.message,pe=(0,y.useState)([]),se=W()(pe,2),_=se[0],ie=se[1],g=new q.Uo("components.permissionButton"),G=A()(A()(A()(A()(A()({},d.W6.CONTAINER,"Id"),d.W6.APPSTORE,"name"),d.W6.COMPOSE,"name"),d.W6.REGISTRY,"serverAddress"),d.W6.DOCKER_ENV,"name"),x=A()(A()(A()(A()(A()({},d.W6.CONTAINER,"name"),d.W6.APPSTORE,"name"),d.W6.COMPOSE,"name"),d.W6.REGISTRY,"title"),d.W6.DOCKER_ENV,"title"),ee=G[Z.type],ue=x[Z.type],te=Z.selected.map(function(P){return P[G[Z.type]]});return y.useEffect(function(){if(p){if(!Z.selected||Z.selected.length==0){le.error(q.FD.format("message.noDataSelect")),K(!1);return}(0,v.dP)({permission:{uri:Z.type,key:ee,value:te}}).then(function(P){var m;(m=$.current)===null||m===void 0||m.setFieldValue("list",Object.keys(P.data.list).map(function(D){return{name:D,type:P.data.list[D].type,users:P.data.list[D].users}}))}),(0,v.lE)().then(function(P){var m,D=(m=P.data)===null||m===void 0||(m=m.list)===null||m===void 0?void 0:m.map(function(h){return{label:h.username,value:h.username}});ie(D)})}},[p]),(0,j.jsx)(H.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,j.jsxs)(k.a,{name:"create",title:g.format("drawerTitle"),open:p,onOpenChange:function(m){if(!m){var D;(D=$.current)===null||D===void 0||D.resetFields()}K(m)},drawerProps:{forceRender:!0,width:B.R_},formRef:$,trigger:(0,j.jsx)(R.ZP,{icon:(0,j.jsx)(I.Z,{}),children:g.format("drawerTriggerButton")}),onFinish:function(){var P=L()(T()().mark(function m(D){var h,C,s;return T()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:h=O()(D.list),r.prev=1,h.s();case 3:if((C=h.n()).done){r.next=9;break}return s=C.value,r.next=7,(0,v.Db)({usernames:s.users,permissionType:s.type,permission:{uri:Z.type,key:ee,showKey:ue,value:[s.name]}});case 7:r.next=3;break;case 9:r.next=14;break;case 11:r.prev=11,r.t0=r.catch(1),h.e(r.t0);case 14:return r.prev=14,h.f(),r.finish(14);case 17:le.success(q.FD.format("finish")),K(!1),Z.onSuccess();case 20:case"end":return r.stop()}},m,null,[[1,11,14,17]])}));return function(m){return P.apply(this,arguments)}}(),children:[(0,j.jsxs)(X.Z,{ghost:!0,title:(0,j.jsx)(Y.Z,{}),subTitle:g.format("batchTitle"),children:[(0,j.jsx)(f.A.Item,{name:"type",style:{marginBottom:0},children:(0,j.jsx)(w.Z.Group,{defaultValue:"admin",onChange:function(m){var D,h,C=(D=$.current)===null||D===void 0?void 0:D.getFieldValue("list");C.forEach(function(s){s.type=m,s.users=[]}),(h=$.current)===null||h===void 0||h.setFieldValue("list",C)},children:["admin","restricted","public"].map(function(P){return(0,j.jsx)(w.Z,{style:{width:240},title:g.format("dataTypeOption.".concat(P)),description:g.format("dataTypeOptionDesc.".concat(P)),value:P},P)})})}),(0,j.jsx)(U.Z,{name:["type"],children:function(m){var D=m.type;if(D==="restricted")return(0,j.jsx)(z.Z,{mode:"multiple",name:"usernames",label:g.format("formUsernames"),onChange:function(C){var s,o,r=(s=$.current)===null||s===void 0?void 0:s.getFieldValue("list");r.forEach(function(l){l.users=C}),(o=$.current)===null||o===void 0||o.setFieldValue("list",r)},rules:[{required:!0}],request:L()(T()().mark(function h(){var C,s,o;return T()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(_.length>0)){l.next=2;break}return l.abrupt("return",_);case 2:return l.next=4,(0,v.lE)();case 4:return s=l.sent,o=(C=s.data)===null||C===void 0||(C=C.list)===null||C===void 0?void 0:C.map(function(i){return{label:i.username,value:i.username}}),ie(o),l.abrupt("return",o);case 8:case"end":return l.stop()}},h)}))})}})]}),(0,j.jsx)(X.Z,{ghost:!0,title:(0,j.jsx)(S.Z,{}),subTitle:g.format("dataTitle"),children:(0,j.jsx)(J.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:g.format("dataName"),render:function(m,D,h){var C=h.getCurrentRowData();return(0,j.jsx)(b.Z,{disabled:!0,label:g.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:g.format("dataType"),render:function(m,D,h){var C=h.getCurrentRowData();return(0,j.jsx)(E.Z.Group,{label:g.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(s){return{label:g.format("dataTypeOption.".concat(s)),value:s}})})}},{name:"users",label:g.format("dataUsers"),render:function(m,D,h){return(0,j.jsx)(U.Z,{name:["type"],children:function(s){var o=s.type;if(o=="restricted")return(0,j.jsx)(z.Z,{width:"sm",mode:"tags",name:"users",label:g.format("dataUsers"),options:_})}})}}]})})]})})});N.Z=ce},96781:function(de,N,n){var Q=n(67294),T=(0,Q.createContext)({});N.Z=T},92922:function(de,N,n){n.r(N),n.d(N,{default:function(){return ie}});var Q=n(64599),T=n.n(Q),ne=n(15009),O=n.n(ne),re=n(99289),L=n.n(re),ae=n(5574),A=n.n(ae),F=n(80821),W=n(90098),y=n(43425),k=n(86548),X=n(23430),f=n(74842),w=n(87784),U=n(33160),z=n(30159),b=n(90078),E=n(56729),v=n(82346),R=n(83622),d=n(25593),M=n(83062),H=n(66309),I=n(42075),Y=n(96074),S=n(67294),J=n(94359),B=n(67255),q=n(93162),j=n.n(q),ce=n(96781),Z=n(69626),_e=n(1699),me=n(83403),oe=n(36435),p=n(36146),K=n(55375),$=n(96486),Ee=n.n($),le=n(37413),pe=n(87662),se=n(5251),_=n(85893);function ie(){var g=(0,S.useContext)(ce.Z),G=g.listTableRef,x=g.reload,ee=(0,S.useRef)(),ue=(0,v.useAccess)(),te=(0,v.useLocation)(),P=new p.Uo("compose"),m=(0,S.useState)(""),D=A()(m,2),h=D[0],C=D[1];return(0,S.useEffect)(function(){(0,pe.K3)().then(function(s){var o;C((o=s.data.serverUrl)!==null&&o!==void 0?o:"")})},[]),(0,S.useEffect)(function(){var s;te.state&&!((s=G.current)===null||s===void 0)&&s.setPageInfo&&G.current.setPageInfo({current:(0,B.G$)(K.q9,G.current.pageInfo)})},[te.state,G.current]),(0,_.jsxs)(b._z,{header:{extra:[(0,_.jsx)(_e.u,{access:"canSeeComposeListManageCreate",children:(0,_.jsx)(v.Link,{to:"/compose/create",reloadDocument:te.search.length>0,children:(0,_.jsx)(R.ZP,{type:"primary",children:p.Ob.format("compose.create")},"createCompose")},"create")},"create")]},children:[(0,_.jsx)(Z.Z,{ref:ee,onClose:function(){x()}}),(0,_.jsx)(E.Z,{scroll:{x:"max-content"},request:function(){var s=L()(O()().mark(function o(r){var l;return O()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,W.pm)({title:r.title,name:r.name});case 2:return l=a.sent,a.abrupt("return",{data:l.data.list.map(function(t){var u=l.data.containerList.filter(function(c){return c.project.lastIndexOf(t.name)===9||c.project==t.name});return u&&(t.containerList=u),t}),success:!0,total:l.data.list.length});case 4:case"end":return a.stop()}},o)}));return function(o){return s.apply(this,arguments)}}(),onChange:function(o,r,l){!Ee().isArray(l)&&(0,B.LX)(K.q9,l.columnKey,l.order),(0,B.MJ)(K.q9,o.current)},rowKey:"name",columns:[{key:"name",title:p.FD.format("listName"),dataIndex:"name",width:200,render:function(o,r,l,i,a){return(0,_.jsx)(d.Z.Link,{onClick:function(){var u;(u=ee.current)===null||u===void 0||u.show(r.id||r.name)},children:r.name})},sorter:function(o,r){return o.name.localeCompare(r.name)},defaultSortOrder:(0,B.rj)(K.q9,"name"),sortDirections:B.h5},{key:"title",title:p.FD.format("listTitle"),dataIndex:"title",width:200,sorter:function(o,r){return o.title.localeCompare(r.title)},defaultSortOrder:(0,B.rj)(K.q9,"title")},{key:"ports",title:p.FD.format("listAccess"),tooltip:p.FD.format("listAccessTip"),width:150,dataIndex:"ports",search:!1,render:function(o,r,l,i){if((0,$.isEmpty)(r.containerList))return null;var a=[],t=[];return r.containerList&&r.containerList.forEach(function(u){u.publishers.map(function(c){c.publishedPort?a.push({PrivatePort:c.targetPort,Type:c.protocol,IP:c.url,PublicPort:c.publishedPort}):c.publishedPort&&t.push({PrivatePort:c.targetPort,Type:c.protocol,IP:c.url,PublicPort:c.publishedPort})})}),(0,_.jsx)(le.Z,{publicPort:a,privatePort:t,domain:[],serverIp:h})}},{title:p.FD.format("listType"),width:150,search:!1,render:function(o,r,l,i,a){var t,u=r.setting&&r.setting.type?r.setting.type:"default";return(0,_.jsx)(M.Z,{title:(t=r.setting.uri)!==null&&t!==void 0?t:"",children:(0,_.jsx)(H.Z,{color:P.format("listTypeColor.".concat(u)),children:P.format("listType.".concat(u))})})}},{title:p.FD.format("listStatus"),dataIndex:"status",search:!1,key:"status",render:function(o,r,l,i,a){return(0,_.jsx)(I.Z,{children:r.setting.status.split(", ").map(function(t,u){var c,V="running",e=t.indexOf("(");return e>-1?V=t.slice(0,e):V=t,(0,_.jsx)(J.Z,{status:"compose.".concat(V),statusValue:{count:t.slice(e+1,t.length-1)},tip:"".concat(t," ").concat((c=r.setting.message)!==null&&c!==void 0?c:"")},u)})})},sorter:function(o,r){return o.setting.status.localeCompare(r.setting.status)},defaultSortOrder:(0,B.rj)(K.q9,"status")},{title:p.FD.format("listCreatedAt"),dataIndex:"",search:!1,width:160,key:"created",render:function(o,r,l,i,a){return(0,se.NF)(r.setting.createdAt)},sorter:function(o,r){var l,i;return new Date((l=o.setting.createdAt)!==null&&l!==void 0?l:"").toLocaleString().localeCompare(new Date((i=r.setting.createdAt)!==null&&i!==void 0?i:"").toLocaleString())},defaultSortOrder:(0,B.rj)(K.q9,"created")},{title:p.FD.format("listUpdatedAt"),dataIndex:"",search:!1,width:160,render:function(o,r,l,i,a){return(0,se.NF)(r.setting.updatedAt)},sorter:function(o,r){var l,i;return new Date((l=o.setting.updatedAt)!==null&&l!==void 0?l:"").toLocaleString().localeCompare(new Date((i=r.setting.updatedAt)!==null&&i!==void 0?i:"").toLocaleString())},key:"updated",defaultSortOrder:(0,B.rj)(K.q9,"updated")},{title:p.FD.format("listManage"),width:80,valueType:"option",fixed:"right",key:"option",hidden:!ue.canSeeComposeListManage,render:function(o,r,l,i,a){return r.setting.type!="dangling"&&(0,_.jsxs)(I.Z,{split:(0,_.jsx)(Y.Z,{type:"vertical"}),children:[(0,_.jsx)(d.Z.Link,{onClick:function(){var u;(u=ee.current)===null||u===void 0||u.show(r.id||r.name)},children:(0,_.jsx)(M.Z,{title:p.FD.format("listManageDetail"),children:(0,_.jsx)(y.Z,{})})},"3"),(0,_.jsx)(v.Link,{to:"/compose/create?id=".concat(r.id||r.name),children:(0,_.jsx)(M.Z,{title:p.FD.format("listManageEdit"),children:(0,_.jsx)(k.Z,{})})}),(0,_.jsx)(d.Z.Link,{onClick:L()(O()().mark(function t(){var u,c;return O()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,W.tw)({id:r.id||r.name});case 2:u=e.sent,c=new Blob([u],{type:"application/zip"}),(0,q.saveAs)(c,"compose-"+r.name+".zip");case 5:case"end":return e.stop()}},t)})),children:(0,_.jsx)(M.Z,{title:p.FD.format("listManageDownload"),children:(0,_.jsx)(X.Z,{})})},"2")]})}}],rowSelection:ue.canSeeComposeListManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0,getCheckboxProps:function(o){return{disabled:o.setting.type=="dangling"||o.setting.type=="outPath"}}}:void 0,tableAlertOptionRender:function(o){var r=o.selectedRows,l=o.selectedRowKeys;return(0,_.jsxs)(I.Z,{size:16,children:[(0,_.jsx)(oe.Z,{type:me.W6.COMPOSE,selected:r,onSuccess:function(){return x(),!0}}),(0,_.jsxs)(_e.u,{access:"canSeeComposeList",space:{size:16,wrap:!0},children:[(0,_.jsx)(F.Z,{icon:(0,_.jsx)(f.Z,{}),action:L()(O()().mark(function i(){var a,t,u,c;return O()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=T()(l),e.prev=1,a.s();case 3:if((t=a.n()).done){e.next=10;break}return u=t.value,e.next=7,(0,W.GG)({id:u,op:"start"});case 7:c=e.sent;case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),a.e(e.t0);case 15:return e.prev=15,a.f(),e.finish(15);case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}},i,null,[[1,12,15,18]])})),onSuccess:function(){return x(),!0},children:p.FD.format("listManageStart")}),(0,_.jsx)(F.Z,{action:L()(O()().mark(function i(){var a,t,u,c;return O()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=T()(l),e.prev=1,a.s();case 3:if((t=a.n()).done){e.next=10;break}return u=t.value,e.next=7,(0,W.GG)({id:u,op:"stop"});case 7:c=e.sent;case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),a.e(e.t0);case 15:return e.prev=15,a.f(),e.finish(15);case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}},i,null,[[1,12,15,18]])})),icon:(0,_.jsx)(w.Z,{}),onSuccess:function(){return x(),!0},children:p.FD.format("listManageStop")}),(0,_.jsx)(F.Z,{action:L()(O()().mark(function i(){var a,t,u,c;return O()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=T()(l),e.prev=1,a.s();case 3:if((t=a.n()).done){e.next=10;break}return u=t.value,e.next=7,(0,W.GG)({id:u,op:"restart"});case 7:c=e.sent;case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),a.e(e.t0);case 15:return e.prev=15,a.f(),e.finish(15);case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}},i,null,[[1,12,15,18]])})),onSuccess:function(){return x(),!0},icon:(0,_.jsx)(U.Z,{}),children:p.FD.format("listManageRestart")}),(0,_.jsx)(F.Z,{action:L()(O()().mark(function i(){var a,t,u,c;return O()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=T()(l),e.prev=1,a.s();case 3:if((t=a.n()).done){e.next=10;break}return u=t.value,e.next=7,(0,W.GG)({id:u,op:"pause"});case 7:c=e.sent;case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),a.e(e.t0);case 15:return e.prev=15,a.f(),e.finish(15);case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}},i,null,[[1,12,15,18]])})),onSuccess:function(){return x(),!0},icon:(0,_.jsx)(z.Z,{}),children:p.FD.format("listManagePause")}),(0,_.jsx)(F.Z,{action:L()(O()().mark(function i(){var a,t,u,c;return O()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=T()(l),e.prev=1,a.s();case 3:if((t=a.n()).done){e.next=10;break}return u=t.value,e.next=7,(0,W.GG)({id:u,op:"unpause"});case 7:c=e.sent;case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),a.e(e.t0);case 15:return e.prev=15,a.f(),e.finish(15);case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}},i,null,[[1,12,15,18]])})),onSuccess:function(){return x(),!0},icon:(0,_.jsx)(f.Z,{}),children:p.FD.format("listManageUnpause")})]}),(0,_.jsx)(_e.u,{access:"canSeeComposeListManageDelete",children:(0,_.jsx)(F.Z,{danger:!0,type:"primary",action:L()(O()().mark(function i(){var a,t,u,c;return O()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t=T()(r),e.prev=2,t.s();case 4:if((u=t.n()).done){e.next=11;break}return c=u.value,e.next=8,(0,W.mg)({id:c.id||c.name});case 8:a=e.sent;case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),t.e(e.t0);case 16:return e.prev=16,t.f(),e.finish(16);case 19:e.next=23;break;case 21:e.prev=21,e.t1=e.catch(0);case 23:return e.abrupt("return",(0,W.ik)({id:r.map(function(fe){return fe.id})}));case 24:case"end":return e.stop()}},i,null,[[0,21],[2,13,16,19]])})),onSuccess:function(){var a;return!((a=G.current)===null||a===void 0)&&a.reloadAndRest&&G.current.reloadAndRest(),!0},onError:function(){return x(),!0},confirm:"notification.confirm.title",children:p.FD.format("listManageDeleteBatch")})})]})},pagination:(0,B.Oh)(),search:{collapsed:!1},actionRef:G,columnsState:(0,B.j_)(K.q9)})]})}}}]);
