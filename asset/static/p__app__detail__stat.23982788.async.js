"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745],{60433:function(A,f,e){var E=e(87462),u=e(67294),F=e(69782),n=e(84089),t=function(y,p){return u.createElement(n.Z,(0,E.Z)({},y,{ref:p,icon:F.Z}))},c=u.forwardRef(t);f.Z=c},27619:function(A,f,e){e.d(f,{Z:function(){return C}});var E=e(97857),u=e.n(E),F=e(19632),n=e.n(F),t=e(5574),c=e.n(t),d=e(64183),y=e(63713),p=e(67294),j=e(85893);function C(o){var P,I=(0,p.useState)("academy"),S=c()(I,2),M=S[0],m=S[1],O=Math.max.apply(Math,n()(o.data.map(function(Z){var D;return(D=Z[o.yField])!==null&&D!==void 0?D:0}))),T=(0,y.useModel)("@@initialState"),b=T.initialState,i=T.loading,U=T.error,l=T.refresh,L=T.setInitialState,W={xField:o.xField,yField:o.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:o.yLabelFormatter},scale:{y:{domainMin:(P=o.yDomainMin)!==null&&P!==void 0?P:0,domainMax:o.yDomainMax?o.yDomainMax:o.yDomainMaxCallback?o.yDomainMaxCallback(O):O}},data:o.data};return o.yLabelFormatter&&(W.axis.y.labelFormatter=o.yLabelFormatter),o.colorField&&(W.colorField=o.colorField),(0,p.useEffect)(function(){(b==null?void 0:b.theme.algorithm)=="dark"?m("classicDark"):m("academy")},[b]),(0,j.jsx)(d.Z,u()({theme:M},W))}},71890:function(A,f,e){var E=e(15009),u=e.n(E),F=e(99289),n=e.n(F),t=e(67294);function c(d){var y=d.reqFunction,p=d.interval,j=d.maxPolling,C=d.pollingStatus,o=d.inPath,P=(0,t.useRef)(null),I=0,S=function m(){P.current=window.setTimeout(n()(u()().mark(function O(){var T;return u()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(I++>=j)){i.next=3;break}return M(),i.abrupt("return");case 3:if(i.prev=3,!(o&&window.location.href.indexOf(o)==-1)){i.next=7;break}return M(),i.abrupt("return");case 7:return i.next=9,y();case 9:T=i.sent,m(),i.next=17;break;case 13:i.prev=13,i.t0=i.catch(3),M(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",i.t0);case 17:case"end":return i.stop()}},O,null,[[3,13]])})),p)},M=function(){console.log("end polling"),P.current&&window.clearTimeout(P.current)};return(0,t.useEffect)(function(){return console.log((C?"start":"waiting")+" polling, max "+j),C&&S(),function(){M()}},[p,j,C]),{endPolling:M}}f.Z=c},24963:function(A,f,e){var E=e(67294),u=(0,E.createContext)({});f.Z=u},42223:function(A,f,e){e.r(f),e.d(f,{default:function(){return Z}});var E=e(15009),u=e.n(E),F=e(99289),n=e.n(F),t=e(5574),c=e.n(t),d=e(19632),y=e.n(d),p=e(27619),j=e(71890),C=e(24963),o=e(63713);function P(D){return I.apply(this,arguments)}function I(){return I=n()(u()().mark(function D(B){return u()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,o.request)("/api/app/container/get-stat-info",{method:"POST",data:B}));case 1:case"end":return h.stop()}},D)})),I.apply(this,arguments)}function S(D){return M.apply(this,arguments)}function M(){return M=n()(u()().mark(function D(B){return u()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,o.request)("/api/app/container/get-process-info",{method:"POST",data:B}));case 1:case"end":return h.stop()}},D)})),M.apply(this,arguments)}var m=e(5251),O=e(12122),T=e(60433),b=e(38345),i=e(63490),U=e(67294),l=e(85893),L=new Date().toLocaleTimeString(),W={total:0,memory:[{date:L,usage:0,source:{usage:0,limit:0}}],cpu:[{date:L,usage:0}],network:[{usage:0,type:"rx",date:L,source:{usage:0}},{usage:0,type:"tx",date:L,source:{usage:0}}],io:[{usage:0,type:"read",date:L,source:{usage:0}},{usage:0,type:"write",date:L,source:{usage:0}}]};function Z(){var D=function(r,a){switch(a.type){case"update":var v=new Date(a.payload.read).toLocaleTimeString(),_=a.payload.cpu_stats.cpu_usage.total_usage-a.payload.precpu_stats.cpu_usage.total_usage,K=a.payload.cpu_stats.system_cpu_usage-a.payload.precpu_stats.system_cpu_usage,x={total:r.total+1,memory:[],cpu:[].concat(y()(r.cpu),[{date:v,usage:_/K*a.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return a.payload.memory_stats&&a.payload.memory_stats.limit&&a.payload.memory_stats.usage&&(x.memory=[].concat(y()(r.memory),[{date:v,usage:Math.round(a.payload.memory_stats.usage),source:{usage:a.payload.memory_stats.usage,limit:a.payload.memory_stats.limit}}])),a.payload.networks&&(x.network=[].concat(y()(r.network),[{date:v,usage:parseFloat(a.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:a.payload.networks.eth0.rx_bytes}},{date:v,usage:parseFloat(a.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:a.payload.networks.eth0.tx_bytes}}])),a.payload.blkio_stats&&a.payload.blkio_stats.io_service_bytes_recursive&&a.payload.blkio_stats.io_service_bytes_recursive.length>0&&(x.io=[].concat(y()(r.io),[{date:v,usage:parseFloat(a.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:a.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:a.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:v,usage:parseFloat(a.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:a.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:a.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),x}},B=(0,U.useContext)(C.Z),k=B.loading,h=(0,o.useParams)(),z=(0,U.useReducer)(D,W),w=c()(z,2),s=w[0],H=w[1],Y=(0,U.useState)(0),$=c()(Y,2),N=$[0],J=$[1],Q=(0,U.useState)(),G=c()(Q,2),R=G[0],V=G[1],X=(0,j.Z)({reqFunction:function(){var g=n()(u()().mark(function a(){var v,_;return u()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,P({id:(v=h.id)!==null&&v!==void 0?v:""});case 2:_=x.sent,k.destroy(),H({type:"update",payload:_});case 5:case"end":return x.stop()}},a)}));function r(){return g.apply(this,arguments)}return r}(),interval:3e3,maxPolling:999,pollingStatus:N!=0,inPath:"tab=stat"});return(0,U.useEffect)(function(){var g,r;k.show(),P({id:(g=h.id)!==null&&g!==void 0?g:""}).then(function(a){return J(Math.round(a.memory_stats.limit)),!0}),S({id:(r=h.id)!==null&&r!==void 0?r:""}).then(function(a){var v={columns:[],data:[]};a.data.list.Titles.map(function(_){v.columns.push({title:_,label:_,dataIndex:_})}),a.data.list.Processes.map(function(_,K){v.data.push({UID:_[0],PID:_[1],PPID:_[2],C:_[3],STIME:_[4],TTY:_[5],TIME:_[6],CMD:_[7]})}),V(v)})},[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(b.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[s.memory&&s.memory.length>0&&(0,l.jsx)(b.Z,{colSpan:12,title:(0,l.jsx)(O.Z,{}),subTitle:"Memory usage: ".concat((0,m.FI)(s.memory[s.memory.length-1].source.usage)," / ").concat((0,m.FI)(s.memory[s.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,l.jsx)(p.Z,{yField:"usage",xField:"date",data:s.memory,yDomainMaxCallback:function(r){return r*2},yLabelFormatter:function(r){return(0,m.FI)(parseFloat(r))}})}),(0,l.jsx)(b.Z,{colSpan:12,title:(0,l.jsx)(O.Z,{}),subTitle:"Cpu usage: ".concat(s.cpu[s.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,l.jsx)(p.Z,{yField:"usage",xField:"date",data:s.cpu,yDomainMaxCallback:function(r){return r*1.5},yLabelFormatter:function(r){return"".concat(r,"%")}})}),s.io&&s.io.length>0&&(0,l.jsx)(b.Z,{colSpan:12,title:(0,l.jsx)(O.Z,{}),subTitle:"I/O: ".concat((0,m.FI)(s.io[s.io.length-1].source.usage)," / ").concat((0,m.FI)(s.io[s.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,l.jsx)(p.Z,{yField:"usage",xField:"date",colorField:"type",data:s.io,yDomainMaxCallback:function(r){return r*2},yLabelFormatter:function(r){return(0,m.FI)(parseFloat(r))}})}),s.network&&s.network.length>0&&(0,l.jsx)(b.Z,{colSpan:12,title:(0,l.jsx)(O.Z,{}),subTitle:"Network: ".concat((0,m.FI)(s.network[s.network.length-1].source.usage)," / ").concat((0,m.FI)(s.network[s.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,l.jsx)(p.Z,{yField:"usage",xField:"date",colorField:"type",data:s.network,yDomainMaxCallback:function(r){return r*2},yLabelFormatter:function(r){return(0,m.FI)(parseFloat(r))}})})]}),(0,l.jsx)(b.Z,{title:(0,l.jsx)(T.Z,{}),subTitle:"Progress",children:(0,l.jsx)(i.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:R==null?void 0:R.columns,dataSource:R==null?void 0:R.data,pagination:{pageSize:10}})})]})}},5251:function(A,f,e){e.d(f,{FI:function(){return u},ZM:function(){return F}});function E(n){return n.trim()}function u(n){var t="";n<.1*1024?t=n.toFixed(2)+"B":n<.1*1024*1024?t=(n/1024).toFixed(2)+"KB":n<1*1024*1024*1024?t=(n/(1024*1024)).toFixed(2)+"MB":t=(n/(1024*1024*1024)).toFixed(2)+"GB";var c=t+"",d=c.indexOf("."),y=c.substring(d+1,d+3);return y=="00"?c.substring(0,d)+c.substr(d+3,2):t}function F(n){if(n){var t=new Date(n),c=t.getFullYear()+"-",d=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",y=(t.getDate()<10?"0"+t.getDate():t.getDate())+" ",p=(t.getHours()<10?"0"+t.getHours():t.getHours())+":",j=(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":",C=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds();return c+d+y+p+j+C}}}}]);
