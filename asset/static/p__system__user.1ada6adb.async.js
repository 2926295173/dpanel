"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2958],{80821:function(se,W,e){e.d(W,{Z:function(){return fe}});var K=e(97857),l=e.n(K),T=e(5574),h=e.n(T),J=e(24963),B=e(86738),ee=e(83062),V=e(28036),Y=e(67294),y=e(85893);function fe(s){var ie=(0,Y.useState)(!1),ue=h()(ie,2),re=ue[0],X=ue[1],ne=(0,Y.useContext)(J.Z),H=ne.lang,le=ne.message,Q=function(){X(!0);var c=s.action();c instanceof Promise?c.then(function(q){if(X(!1),q){typeof s.onSuccess=="function"&&s.onSuccess(q);var w="";s.messageSuccess?typeof s.messageSuccess=="function"?w=s.messageSuccess(q):w=s.messageSuccess.indexOf("notification.")==0?H(s.messageSuccess):s.messageSuccess:w=H("notification.finish"),s.asynced?le.info(w):le.success(w)}}).catch(function(q){X(!1),typeof s.onError=="function"&&s.onError(q)}):X(!1)};return s.confirm?(0,y.jsx)(B.Z,l()(l()({style:{width:500},title:s.confirmTitle?s.confirmTitle:H("notification.title.tip"),description:typeof s.confirm=="string"&&s.confirm.indexOf("notification.")==0?H(s.confirm):s.confirm,onConfirm:Q,okText:"Yes",cancelText:"No",onOpenChange:s.confirmOnOpenChange},s.confirmProps),{},{children:(0,y.jsx)(ee.Z,{title:s.tips,children:(0,y.jsx)(V.ZP,{block:s.block,disabled:s.disabled,icon:!s.children&&re?void 0:s.icon,loading:re,danger:s.danger,type:s.type,children:s.children})})})):(0,y.jsx)(ee.Z,{title:s.tips,children:(0,y.jsx)(V.ZP,{block:s.block,style:s.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:s.disabled,icon:!s.children&&re?void 0:s.icon,loading:re,onClick:Q,danger:s.danger,type:s.type,children:s.children})})}},3616:function(se,W,e){e.d(W,{Ed:function(){return h},FK:function(){return l},R_:function(){return K},ob:function(){return T}});var K=window.innerWidth<=1024?"90vw":"65vw",l="90vw",T="60vw",h="50vh"},24963:function(se,W,e){var K=e(67294),l=(0,K.createContext)({});W.Z=l},59549:function(se,W,e){e.r(W),e.d(W,{default:function(){return Ve}});var K=e(15009),l=e.n(K),T=e(99289),h=e.n(T),J=e(9783),B=e.n(J),ee=e(19632),V=e.n(ee),Y=e(80821),y=e(68602),fe=e(67255),s=e(36693),ie=e(43425),ue=e(88641),re=e(90078),X=e(78099),ne=e(66309),H=e(42075),le=e(96074),Q=e(25593),oe=e(83062),c=e(67294),q=e(5574),w=e.n(q),pe=e(28036),me=e(184),ce=e(5966),ve=e(64317),je=e(52688),Pe=e(90672),te=e(3616),M=e(83403),ye=e(87662),F=e(36146),r=e(85893),Ce=(0,c.forwardRef)(function(C,k){var $=(0,c.useState)(!1),m=w()($,2),R=m[0],g=m[1],u=(0,c.useRef)(),i=new F.Uo("components.userInvite"),a=new F.Uo("system.user");(0,c.useImperativeHandle)(k,function(){return{edit:function(o){var f;(f=u.current)===null||f===void 0||f.setFieldsValue({username:o.username}),g(!0)},show:function(){var o;(o=u.current)===null||o===void 0||o.resetFields(),g(!0)}}}),c.useEffect(function(){if(R){var d;(d=u.current)===null||d===void 0||d.resetFields()}},[R,u]);var n=function(){var d=h()(l()().mark(function o(){var f,t,b,Z,O,N;return l()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,(f=u.current)===null||f===void 0?void 0:f.validateFields();case 3:return t=S.sent,b={username:t.username,userRole:t.userRole||"member",email:t.email,userStatus:t.userStatus||"enable",securityPassword:t.securityPassword||!0},S.next=7,(0,y.mX)(b);case 7:if(Z=S.sent,b.userRole==="manager"&&(0,y.SS)({username:b.username,menuPermissionNames:M.Wy}),b.userStatus==="disable"&&(0,y.az)({username:b.username,status:1}),!b.email){S.next=15;break}return S.next=13,(0,ye.pe)({groupName:"setting",name:"emailServer"});case 13:N=S.sent,(O=N.data)!==null&&O!==void 0&&(O=O.status)!==null&&O!==void 0&&O.includes("register")&&(0,y.sI)({username:b.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(Z.data.token)});case 15:return C.onFinish&&C.onFinish(),S.abrupt("return",!0);case 19:return S.prev=19,S.t0=S.catch(0),S.abrupt("return",!1);case 22:case"end":return S.stop()}},o,null,[[0,19]])}));return function(){return d.apply(this,arguments)}}();return(0,r.jsxs)(me.a,{name:"create",title:i.format("drawerTitle"),open:R,onOpenChange:function(o){if(!o){var f;(f=u.current)===null||f===void 0||f.resetFields()}g(o)},drawerProps:{forceRender:!0,width:te.R_},formRef:u,trigger:(0,r.jsx)(pe.ZP,{type:"primary",children:i.format("drawerTitle")}),onFinish:h()(l()().mark(function d(){return l()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,n();case 2:return f.abrupt("return",f.sent);case 3:case"end":return f.stop()}},d)})),children:[(0,r.jsx)(ce.Z,{label:i.format("formUsername"),name:"username",required:!0,rules:[{required:!0}]}),(0,r.jsx)(ce.Z,{label:i.format("formEmail"),name:"email",placeholder:"",rules:[{type:"email"}]}),(0,r.jsx)(ve.Z,{label:i.format("formUserRole"),name:"userRole",tooltip:i.format("formUserRoleTip"),required:!0,fieldProps:{defaultValue:"member"},options:a.option("listUserRoleOption",["manager","member"])}),(0,r.jsx)(ve.Z,{label:i.format("formUserStatus"),name:"userStatus",fieldProps:{defaultValue:"enable"},required:!0,options:a.option("listStatusOption",["enable","disable"])}),(0,r.jsx)(je.Z,{label:i.format("formSecurityPassword"),name:"securityPassword",fieldProps:{defaultChecked:!0}}),(0,r.jsx)(Pe.Z,{label:i.format("formRemark"),name:"remark",fieldProps:{rows:4}})]})}),be=Ce,Oe=e(38345),we=e(63434),xe=e(71230),Ee=e(15746),Ze=e(84567),De=e(85265),Ue=e(82346),Te=(0,c.forwardRef)(function(C,k){(0,c.useImperativeHandle)(k,function(){return{show:function(P){return h()(l()().mark(function L(){var E,I,U,ae,Re,G,Se;return l()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return U=P.username,ae=P.uri,(E=b.current)===null||E===void 0||E.resetFields(),g(U),n(ae),z.next=6,(0,y.q4)({username:U});case 6:if(Re=z.sent,G=(I=Re.data)===null||I===void 0||(I=I.permissions)===null||I===void 0?void 0:I[ae],!G){z.next=16;break}return z.next=11,(0,Ue.request)(G.uri,{method:"POST"});case 11:Se=z.sent,S(Se.data.list.filter(function(de){return G.value.includes(de[G.key])}).map(function(de){return{id:de[G.key],name:de[G.showKey]}})),p(G),z.next=17;break;case 16:S([]);case 17:t(!0);case 18:case"end":return z.stop()}},L)}))()}}});var $=(0,c.useState)(""),m=w()($,2),R=m[0],g=m[1],u=(0,c.useState)(""),i=w()(u,2),a=i[0],n=i[1],d=(0,c.useState)(!1),o=w()(d,2),f=o[0],t=o[1],b=(0,c.useRef)(),Z=(0,c.useRef)(),O=(0,c.useState)([]),N=w()(O,2),A=N[0],S=N[1],_=(0,c.useState)(),D=w()(_,2),v=D[0],p=D[1],j=new F.Uo("components.userPermission");return(0,r.jsx)(De.Z,{title:j.format("permissionTitle"),open:f,width:te.R_,destroyOnClose:!0,onClose:function(){var P;(P=b.current)===null||P===void 0||P.resetFields(),t(!1)},children:(0,r.jsx)(X.Z,{actionRef:Z,search:!1,toolBarRender:!1,scroll:{x:"max-content"},columns:[{key:"name",title:F.FD.format("listTitle"),dataIndex:"name"}],rowKey:"id",dataSource:A,rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},tableAlertOptionRender:function(P){var L=P.selectedRows;return(0,r.jsx)(H.Z,{size:16,wrap:!0,children:(0,r.jsx)(Y.Z,{danger:!0,type:"primary",action:h()(l()().mark(function E(){return l()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.next=2,(0,y.V9)({username:R,permission:{uri:a,key:"-",value:L.map(function(ae){return ae.id}),showKey:"-"}});case 2:return U.abrupt("return",!0);case 3:case"end":return U.stop()}},E)})),onSuccess:function(){return t(!1),!0},confirm:"notification.confirm.title",children:F.FD.format("listManageDeleteBatch")})})},pagination:!1})})}),he=Te,Ae=e(31199),Ie=(0,c.forwardRef)(function(C,k){(0,c.useImperativeHandle)(k,function(){return{show:function(t){return h()(l()().mark(function b(){var Z,O;return l()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:O=t.formData,(Z=d.current)===null||Z===void 0||Z.resetFields(),n(O),g(!0);case 4:case"end":return A.stop()}},b)}))()}}});var $=(0,c.useState)(!1),m=w()($,2),R=m[0],g=m[1],u=(0,c.useState)({}),i=w()(u,2),a=i[0],n=i[1],d=(0,c.useRef)(),o=new F.Uo("components.userPermission");return(0,r.jsxs)(me.a,{title:o.format("permissionTitle"),open:R,width:te.R_,formRef:d,onFinish:function(){var f=h()(l()().mark(function t(b){return l()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return C.onChange(b),g(!1),O.abrupt("return",!0);case 3:case"end":return O.stop()}},t)}));return function(t){return f.apply(this,arguments)}}(),initialValues:a,drawerProps:{width:te.R_,destroyOnClose:!0,onClose:function(){var t;(t=d.current)===null||t===void 0||t.resetFields(),g(!1)}},children:[(0,r.jsx)(Ae.Z,{name:"limit",label:o.format("formContainerLimit"),min:0}),(0,r.jsx)(ce.Z,{name:"name",hidden:!0})]})}),Me=Ie,Fe=e(24963),$e=e(34646),Le=e(60433),ge=e(25449),We=(0,c.forwardRef)(function(C,k){(0,c.useImperativeHandle)(k,function(){return{edit:function(v){return h()(l()().mark(function p(){var j,x,P;return l()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return(j=i.current)===null||j===void 0||j.setFieldValue("username",v),E.next=3,(0,y.J5)({username:v});case 3:x=E.sent,x.data.resource?(P={},x.data.resource.forEach(function(I){P[I.name]=I}),S(P)):S({}),x.data.menus?(x.data.menus.map(function(I){var U;(U=i.current)===null||U===void 0||U.setFieldValue(["permission",I],!0)}),Z([].concat(V()(x.data.menus||[]),V()(M.Io)))):Z(M.Io),u(!0);case 7:case"end":return E.stop()}},p)}))()}}});var $={canSeeContainerList:M.W6.CONTAINER,canSeeImageRegistry:M.W6.REGISTRY,canSeeComposeList:M.W6.COMPOSE,canSeeSystemAppstore:M.W6.APPSTORE,canSeeSystemEnv:M.W6.DOCKER_ENV},m=(0,c.useState)(!1),R=w()(m,2),g=R[0],u=R[1],i=(0,c.useRef)(),a=(0,c.useContext)(Fe.Z),n=a.message,d=(0,c.useRef)(),o=(0,c.useRef)(),f=(0,c.useState)([]),t=w()(f,2),b=t[0],Z=t[1],O=(0,c.useState)({}),N=w()(O,2),A=N[0],S=N[1],_=new F.Uo("components.userPermission");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(me.a,{title:_.format("drawerTitle"),open:g,onOpenChange:function(v){var p;!v&&((p=i.current)===null||p===void 0||p.resetFields()),u(v)},drawerProps:{forceRender:!0,width:te.R_},layout:"inline",formRef:i,onValuesChange:function(v,p){var j=Object.keys(v.permission)[0];if(v.permission[j]===!1){for(var x in p.permission)if(x.startsWith(j)){var P;(P=i.current)===null||P===void 0||P.setFieldValue(["permission",x],!1)}}Z(Object.keys(p.permission).filter(function(L){return p.permission[L]}))},onFinish:function(){var D=h()(l()().mark(function v(p){var j;return l()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return j=p.permission&&Object.keys(p.permission).filter(function(L){return p.permission[L]&&!M.Io.includes(L)}),j.push.apply(j,V()(M.Io.filter(function(L){return j.some(function(E){return E.startsWith(L)})}))),P.next=4,(0,y.SS)({username:p.username,menuPermissionNames:j,resources:Object.values(A)});case 4:return n.success(F.FD.format("finish")),P.abrupt("return",!0);case 6:case"end":return P.stop()}},v)}));return function(v){return D.apply(this,arguments)}}(),children:[(0,r.jsx)(he,{ref:d}),(0,r.jsx)(ce.Z,{name:"username",hidden:!0}),M.d0.map(function(D){return(0,r.jsxs)(Oe.Z,{headerBordered:!0,ghost:!0,bodyStyle:{paddingTop:10,paddingBottom:20},title:(0,r.jsx)($e.Z,{}),subTitle:_.format(D.group),children:[(0,r.jsx)(we.Z,{name:["permission",D.group],valuePropName:"checked",initialValue:!0,hidden:!0}),(0,r.jsx)(xe.Z,{gutter:[16,16],children:D.permissions.map(function(v){return(0,r.jsx)(Ee.Z,{span:6,children:(0,r.jsxs)(ge.Z,{children:[(0,r.jsx)(ge.Z,{noStyle:!0,name:["permission",v],valuePropName:"checked",children:(0,r.jsx)(Ze.Z,{disabled:!b.includes(v.substring(0,v.search(/[A-Z][^A-Z]*$/))),children:_.format(v)})}),$[v]&&(0,r.jsx)(oe.Z,{title:_.format("dataPermissionButton"),children:(0,r.jsx)(Q.Z.Link,{onClick:function(){var j,x;(j=d.current)===null||j===void 0||j.show({username:((x=i.current)===null||x===void 0?void 0:x.getFieldValue("username"))||"",uri:$[v]||""})},children:(0,r.jsx)(Le.Z,{})})}),["canSeeContainerListManageCreate"].includes(v)&&(0,r.jsx)(oe.Z,{title:_.format("resourcePermssionButton"),children:(0,r.jsx)(Q.Z.Link,{onClick:function(){var j;(j=o.current)===null||j===void 0||j.show({formData:A[v]||{name:v,limit:0}})},children:(0,r.jsx)(ie.Z,{})})})]})},v)})})]},D.group)})]}),(0,r.jsx)(he,{ref:d}),(0,r.jsx)(Me,{onChange:function(v){var p;A[v.name]=v,(0,y.SS)({username:((p=i.current)===null||p===void 0?void 0:p.getFieldValue("username"))||"",menuPermissionNames:b,resources:Object.values(A)})},resourcePermissionsData:A,ref:o})]})}),Ke=We,Be=e(5251);function Ve(){var C=(0,c.useRef)(),k=(0,c.useRef)(),$=(0,c.useRef)(),m=new F.Uo("system.user");return(0,r.jsxs)(re._z,{header:{extra:[(0,r.jsx)(be,{ref:k,onFinish:function(){var g,u;!((g=C.current)===null||g===void 0)&&g.reloadAndRest&&((u=C.current)===null||u===void 0||u.reloadAndRest())}},"invite-user")]},children:[(0,r.jsx)(Ke,{ref:$}),(0,r.jsx)(X.Z,{scroll:{x:"max-content"},rowKey:"username",columns:[{title:F.FD.format("listUsername"),ellipsis:!0,dataIndex:"username"},{title:m.format("listEmail"),ellipsis:!0,dataIndex:"email"},{title:m.format("listUserRole"),ellipsis:!0,width:100,dataIndex:"userRole",valueEnum:Object.assign.apply(Object,[{}].concat(V()(m.option("listUserRoleOption",["manager","member"]).map(function(R){return B()({},R.value,{text:R.label,status:R.value})})))),render:function(g,u){return(0,r.jsx)(ne.Z,{color:m.format("listUserRoleColor."+u.userRole),children:m.format("listUserRoleOption."+u.userRole)})}},{title:m.format("listRegisterAt"),ellipsis:!0,render:function(g,u,i,a){return(0,r.jsx)("div",{children:(0,Be.ZM)(u.registerAt*1e3)},u.username)},search:!1},{title:m.format("listRemark"),ellipsis:!0,dataIndex:"remark",search:!1},{title:m.format("listStatus"),width:100,dataIndex:"status",search:!1,render:function(g,u){return(0,r.jsx)(ne.Z,{color:m.format("listStatusColor."+u.status),children:m.format("listStatusOption."+u.status)})}},{title:F.FD.format("listManage"),width:100,search:!1,fixed:"right",render:function(g,u,i){return(0,r.jsxs)(H.Z,{split:(0,r.jsx)(le.Z,{type:"vertical"}),children:[(0,r.jsx)(Q.Z.Link,{copyable:{tooltips:m.format("listManageCopyUrl"),icon:[(0,r.jsx)(s.Z,{})],text:function(){var a=h()(l()().mark(function d(){var o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,y.u1)({username:u.username});case 2:return o=t.sent,t.abrupt("return","".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(o.data.token));case 4:case"end":return t.stop()}},d)}));function n(){return a.apply(this,arguments)}return n}()},style:{color:"inherit"}},"copy-"+i),(0,r.jsx)(oe.Z,{title:m.format("listManageSetting"),children:(0,r.jsx)(Q.Z.Link,{onClick:function(){var n;(n=$.current)===null||n===void 0||n.edit(u.username)},children:(0,r.jsx)(ie.Z,{})})}),(0,r.jsx)(Y.Z,{ghost:!0,type:"link",tips:m.format("listManageSendEmail"),icon:(0,r.jsx)(ue.Z,{}),action:h()(l()().mark(function a(){var n;return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,y.u1)({username:u.username});case 2:return n=o.sent,o.abrupt("return",(0,y.sI)({username:u.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(n.data.token)}));case 4:case"end":return o.stop()}},a)}))})]})}}],request:function(){var R=h()(l()().mark(function g(u){var i;return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,y.lE)();case 2:return i=n.sent,n.abrupt("return",{data:i.data.list,success:!0,total:i.data.list.length});case 4:case"end":return n.stop()}},g)}));return function(g){return R.apply(this,arguments)}}(),rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},actionRef:C,tableAlertOptionRender:function(g){var u=g.selectedRowKeys;return(0,r.jsxs)(H.Z,{size:16,children:[(0,r.jsx)(Y.Z,{action:h()(l()().mark(function i(){var a,n,d,o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=0,n=u;case 1:if(!(a<n.length)){t.next=9;break}return d=n[a],t.next=5,(0,y.az)({username:d,status:2});case 5:o=t.sent;case 6:a++,t.next=1;break;case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},i)})),onSuccess:function(){var a,n;return!((a=C.current)===null||a===void 0)&&a.reloadAndRest&&((n=C.current)===null||n===void 0||n.reloadAndRest()),!0},onError:function(){var a,n;return!((a=C.current)===null||a===void 0)&&a.reset&&((n=C.current)===null||n===void 0||n.reset()),!0},children:m.format("listManageEnable")},"batchEnable"),(0,r.jsx)(Y.Z,{danger:!0,action:h()(l()().mark(function i(){var a,n,d,o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=0,n=u;case 1:if(!(a<n.length)){t.next=9;break}return d=n[a],t.next=5,(0,y.az)({username:d,status:1});case 5:o=t.sent;case 6:a++,t.next=1;break;case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},i)})),onSuccess:function(){var a,n;return!((a=C.current)===null||a===void 0)&&a.reloadAndRest&&((n=C.current)===null||n===void 0||n.reloadAndRest()),!0},onError:function(){var a,n;return!((a=C.current)===null||a===void 0)&&a.reset&&((n=C.current)===null||n===void 0||n.reset()),!0},children:m.format("listManageDisable")},"batchDisable")]})},pagination:(0,fe.O)()})]})}},67255:function(se,W,e){e.d(W,{O:function(){return K},j:function(){return l}});function K(T){var h=localStorage.getItem("dpanel-pagesize");return h=="all"?!1:{defaultCurrent:T==null?void 0:T.page,showSizeChanger:!0,defaultPageSize:parseInt(h!=null?h:"20"),onChange:function(B,ee){localStorage.setItem("dpanel-page-"+location.pathname.split("/").slice(-2).join("-"),"".concat(B))}}}function l(T){var h="dpanel-table-column-".concat(T),J={};if(localStorage.getItem(h)){var B;J=JSON.parse((B=localStorage.getItem(h))!==null&&B!==void 0?B:"{}")}return{defaultValue:J,onChange:function(V){localStorage.setItem("dpanel-table-column-".concat(T),JSON.stringify(V))}}}}}]);
