"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8195],{77273:function(Q,L,n){var g=n(15009),P=n.n(g),U=n(99289),A=n.n(U),R=n(5574),T=n.n(R),j=n(184),l=n(5966),O=n(86615),d=n(97462),M=n(64317),I=n(52688),f=n(62370),c=n(38345),H=n(31199),Z=n(90672),x=n(71230),i=n(15746),D=n(42075),p=n(86250),b=n(40056),v=n(67294),S=n(91845),C=n(87662),h=n(12491),K=n(89035),$=n(36146),e=n(85893),X=(0,v.forwardRef)(function(W,w){var B,F;(0,v.useImperativeHandle)(w,function(){return{edit:function(a){var r,o=a.address.split("://"),s=T()(o,2),_=s[0],y=s[1];(r=m.current)===null||r===void 0||r.setFieldsValue({name:a.name,title:a.title,addressType:"".concat(_,"://"),address:y,serverUrl:a.serverUrl,enableTLS:a.enableTLS,tlsCa:a.tlsCa,tlsCert:a.tlsCert,tlsKey:a.tlsKey,enableComposePath:a.enableComposePath,enableSSH:a.enableSSH,sshServerInfo:a.sshServerInfo,remoteType:a.remoteType?a.remoteType:"docker"}),G(!0),J(a.name)}}});var t=new $.Uo("components.dockerEnvCreate"),k=(0,v.useState)(!1),N=T()(k,2),q=N[0],G=N[1],m=(0,v.useRef)(),ee=(0,v.useState)(""),z=T()(ee,2),Y=z[0],J=z[1];return(0,e.jsxs)(j.a,{drawerProps:{forceRender:!0},onOpenChange:function(a){if(!a){var r;J(""),(r=m.current)===null||r===void 0||r.resetFields()}G(a)},open:q,width:800,trigger:W.trigger,formRef:m,title:t.format((B=m.current)!==null&&B!==void 0&&B.getFieldValue&&m.current.getFieldValue("name")=="local"?"drawerTitleDefault":"drawerTitle"),onFinish:function(){var E=A()(P()().mark(function a(r){var o,s,_;return P()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,(0,C.ad)({name:r.name,title:r.title,address:"".concat((o=r.addressType)!==null&&o!==void 0?o:"unix://").concat((s=r.address)!==null&&s!==void 0?s:"/dpanel/sock/".concat(r.name,".sock")),serverUrl:r.serverUrl,enableTLS:r.enableTLS,tlsCa:r.tlsCa,tlsCert:r.tlsCert,tlsKey:r.tlsKey,enableComposePath:r.enableComposePath,composePath:r.enableComposePath?r.composePath:"",enableSSH:r.enableSSH||r.remoteType=="ssh",sshServerInfo:r.sshServerInfo,remoteType:r.remoteType});case 2:return _=u.sent,W.onFinish&&W.onFinish(),u.abrupt("return",!0);case 5:case"end":return u.stop()}},a)}));return function(a){return E.apply(this,arguments)}}(),children:[(0,e.jsx)(l.Z,{label:t.format("formTitle"),name:"title",required:!0,rules:[{required:!0}],fieldProps:{id:"envTitle",onChange:function(a){var r="";if(a.target.value&&!Y){var o,s=(0,S.N9)(a.target.value.trim(),{toneType:"none",type:"array"});r=s.join(""),(o=m.current)===null||o===void 0||o.setFieldValue("name",r)}}}},"envTitle"),(0,e.jsx)(l.Z,{label:t.format("formName"),name:"name",required:!0,disabled:Y!="",rules:[{required:!0}],placeholder:t.format("formNameEmpty")}),(0,e.jsx)(l.Z,{tooltip:t.format("formServerUrlTip"),label:t.format("formServerUrl"),name:"serverUrl",placeholder:t.format("formServerUrlEmpty")}),(0,e.jsx)(O.Z.Group,{label:t.format("formRemoteType"),name:"remoteType",options:[{label:"DockerApi",value:"docker"},{label:"SSH",value:"ssh",disabled:((F=m.current)===null||F===void 0?void 0:F.getFieldValue("name"))=="local"}]}),(0,e.jsx)(d.Z,{name:["remoteType","name"],children:function(a){var r=a.remoteType,o=a.name;return(0,e.jsxs)(e.Fragment,{children:[r=="docker"&&(0,e.jsx)(x.Z,{children:(0,e.jsx)(i.Z,{span:24,children:(0,e.jsxs)(D.Z.Compact,{children:[(0,e.jsx)(M.Z,{name:"addressType",label:t.format("formAddressType"),valueEnum:{"unix://":"unix://","tcp://":"tcp://"},initialValue:"tcp://",fieldProps:{defaultValue:"tcp://"},tooltip:t.format("formAddressTypeTip")}),(0,e.jsx)(l.Z,{label:" ",name:"address",required:!0,width:"xl",rules:[{required:!0}],placeholder:t.format("formAddressEmpty")})]})})}),(0,e.jsxs)(x.Z,{gutter:[15,0],children:[r=="docker"&&(0,e.jsx)(i.Z,{children:(0,e.jsx)(I.Z,{label:t.format("formEnableTLS"),name:"enableTLS",tooltip:t.format("formEnableTLSTip")})}),o!="local"&&typeof r!="undefined"&&(0,e.jsx)(i.Z,{children:(0,e.jsx)(I.Z,{label:t.format("formEnableComposePath"),name:"enableComposePath",tooltip:t.format("formEnableComposePathTip")})}),r=="docker"&&(0,e.jsx)(i.Z,{children:(0,e.jsx)(I.Z,{label:t.format("formEnableSSH"),name:"enableSSH"})})]})]})}}),(0,e.jsx)(d.Z,{name:["enableTLS"],children:function(a){var r=a.enableTLS;if(r)return(0,e.jsxs)(p.Z,{gap:10,justify:"start",children:[(0,e.jsx)(f.Z,{name:"tlsCa",label:t.format("formTlsCa"),children:(0,e.jsx)(h.Z,{title:"ca.pem",onImport:function(s){var _;return(_=m.current)===null||_===void 0||_.setFieldValue("tlsCa",s),!0},onLoad:function(s){if(s.indexOf("CERTIFICATE")<0)throw new Error(t.format("formEnableTLSMessageUploadError",{name:"ca.pem"}));return!0}})}),(0,e.jsx)(f.Z,{name:"tlsCert",label:" ",children:(0,e.jsx)(h.Z,{title:"cert.pem",onImport:function(s){var _;return(_=m.current)===null||_===void 0||_.setFieldValue("tlsCert",s),!0},onLoad:function(s){if(s.indexOf("CERTIFICATE")<0)throw new Error(t.format("formEnableTLSMessageUploadError",{name:"cert.pem"}));return!0}})}),(0,e.jsx)(f.Z,{label:" ",name:"tlsKey",children:(0,e.jsx)(h.Z,{title:"key.pem",onImport:function(s){var _;return(_=m.current)===null||_===void 0||_.setFieldValue("tlsKey",s),!0},onLoad:function(s){if(s.indexOf("PRIVATE")<0)throw new Error(t.format("formEnableTLSMessageUploadError",{name:"key.pem"}));return!0}})})]})}}),(0,e.jsx)(d.Z,{name:["enableComposePath","name"],children:function(a){var r=a.enableComposePath,o=a.name;if(r)return(0,e.jsx)(l.Z,{label:t.format("formComposePath"),name:"composePath",disabled:!0,fieldProps:{value:"/dpanel/compose/compose-".concat(o!=null?o:"")}})}}),(0,e.jsx)(d.Z,{name:["enableSSH","sshServerInfo","remoteType","address"],children:function(a){var r=a.enableSSH,o=a.sshServerInfo,s=a.remoteType,_=a.address;return(r||s=="ssh")&&[(0,e.jsxs)(c.Z,{title:(0,e.jsx)(K.Z,{}),subTitle:t.format("formEnableSSHTitle"),ghost:!0,children:[(0,e.jsxs)(e.Fragment,{children:[s=="ssh"&&(0,e.jsx)(f.Z,{children:(0,e.jsx)(b.Z,{message:(0,e.jsxs)(e.Fragment,{children:[t.format("formEnableSSHAlert"),(0,e.jsx)("a",{href:"https://dpanel.cc/#/zh-cn/manual/setting/docker-env?id=%e9%80%9a%e8%bf%87-ssh-%e6%b7%bb%e5%8a%a0",target:"_blank",children:$.FD.format("help")})]})})}),(0,e.jsx)(l.Z,{label:t.format("formSshServerInfoAddress"),placeholder:t.format("formSshServerInfoAddressEmpty"),name:["sshServerInfo","address"],required:!0,rules:[{required:!0}]})]}),(0,e.jsxs)(x.Z,{children:[(0,e.jsx)(i.Z,{children:(0,e.jsx)(H.Z,{initialValue:22,label:t.format("formSshServerInfoPort"),name:["sshServerInfo","port"]})}),(0,e.jsx)(i.Z,{offset:2,children:(0,e.jsx)(O.Z.Group,{label:t.format("formSshServerInfoAuthType"),name:["sshServerInfo","authType"],valueEnum:{basic:t.format("formSshServerInfoAuthTypeBasic"),pem:t.format("formSshServerInfoAuthTypePem")},required:!0,rules:[{required:!0}]})})]}),o&&o.authType=="basic"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.Z,{label:t.format("formSshServerInfoUsername"),name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]}),(0,e.jsx)(l.Z.Password,{label:t.format("formSshServerInfoPassword"),name:["sshServerInfo","password"],required:!0,rules:[{required:!0}]})]}),o&&o.authType=="pem"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.Z,{label:t.format("formSshServerInfoUsername"),name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]}),(0,e.jsx)(h.Z,{title:t.format("formSshServerInfoPrivateKeyImport"),onImport:function(u){var V;return(V=m.current)===null||V===void 0||V.setFieldValue(["sshServerInfo","privateKey"],u),!0},onLoad:function(u){if(!u.includes("PRIVATE KEY"))throw new Error(t.format("formEnableTLSMessageUploadError",{name:"private.key"}));return!0}}),(0,e.jsx)(Z.Z,{name:["sshServerInfo","privateKey"],label:t.format("formSshServerInfoPrivateKey"),required:!0,rules:[{required:!0}]}),(0,e.jsx)(l.Z.Password,{name:["sshServerInfo","password"],label:t.format("formSshServerInfoPrivateKeyPassword")})]})]},"sshSetting")]}})]})});L.Z=X},12491:function(Q,L,n){n.d(L,{Z:function(){return O}});var g=n(24963),P=n(36146),U=n(88484),A=n(62370),R=n(31418),T=n(28036),j=n(67294),l=n(85893);function O(d){var M=(0,j.useContext)(g.Z),I=M.message,f=M.notice,c=(0,j.useRef)(null),H=R.Z.useApp(),Z=function(){c.current&&(c.current.click(),c.current.onchange=function(i){if(!i||!i.target)return"";var D=new FileReader;D.onload=function(v){var S,C,h=(S=v.target)===null||S===void 0?void 0:S.result;if(d.onLoad)try{d.onLoad&&d.onLoad(h)}catch(K){f.error(K);return}typeof d.onImport=="function"&&(I.success(P.FD.format("finish")),d.onImport(h)),(C=c.current)!==null&&C!==void 0&&C.value&&(c.current.value="")};var p=i.target;if(p.files&&p.files[0]){var b=p.files[0];if(b.type!=""&&!b.type.includes("text/")){f.error(P.FD.format("commonContentIncorrectFormat",{name:p.files[0].name}));return}try{D.readAsText(p.files[0])}catch(v){f.error(P.FD.format("commonContentIncorrectFormat",{name:p.files[0].name}))}}})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(A.Z,{children:(0,l.jsx)(T.ZP,{icon:(0,l.jsx)(U.Z,{}),block:!0,onClick:Z,children:d.title})}),(0,l.jsx)("input",{style:{display:"none"},type:"file",ref:c,name:"importFileInput"})]})}}}]);
