"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7667],{99861:function(N,A,e){var B=e(15009),f=e.n(B),F=e(64599),h=e.n(F),x=e(99289),O=e.n(x),v=e(5574),T=e.n(v),c=e(42119),l=e(67294),g=e(92754),r=e(3393),C=e(184),a=e(38345),i=e(85893),D=(0,l.forwardRef)(function(_,E){(0,l.useImperativeHandle)(E,function(){return{start:function(){return b(!0),te()},finish:function(){b(!1)}}});var y=(0,l.useState)(0),m=T()(y,2),P=m[0],j=m[1],o=(0,l.useRef)(),Y=(0,l.useState)(!1),Q=T()(Y,2),de=Q[0],b=Q[1],te=function(){var G=O()(f()().mark(function w(){var z,I,V,ce,re,ie,_e;return f()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:I=0,V=h()(_.image),S.prev=2,V.s();case 4:if((ce=V.n()).done){S.next=14;break}return ie=ce.value,j(I),(re=o.current)===null||re===void 0||re.setStart(ie),S.next=10,(0,r.Gb)({tag:ie,type:"pull"});case 10:_e=S.sent,I++;case 12:S.next=4;break;case 14:S.next=19;break;case 16:S.prev=16,S.t0=S.catch(2),V.e(S.t0);case 19:return S.prev=19,V.f(),S.finish(19);case 22:(z=o.current)===null||z===void 0||z.setFinish(),j(I);case 24:case"end":return S.stop()}},w,null,[[2,16,19,22]])}));return function(){return G.apply(this,arguments)}}();return(0,i.jsxs)(C.a,{trigger:_.trigger,width:800,open:de,submitter:!1,title:"\u4E00\u952E\u62C9\u53D6\u955C\u50CF",onOpenChange:function(){var G=O()(f()().mark(function w(z){return f()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:b(z),z&&_.trigger&&te();case 2:case"end":return V.stop()}},w)}));return function(w){return G.apply(this,arguments)}}(),drawerProps:{forceRender:!0},children:[(0,i.jsx)(a.Z,{children:(0,i.jsx)(c.Z,{current:P,items:_.image.map(function(G,w){return{title:G,key:w}})})}),(0,i.jsx)(a.Z,{children:(0,i.jsx)(g.Z,{ref:o})})]})});A.Z=D},57165:function(N,A,e){e.d(A,{Z:function(){return T}});var B=e(5574),f=e.n(B),F=e(89035),h=e(63713),x=e(83062),O=e(67294),v=e(85893);function T(c){var l=(0,O.useState)({height:800,width:1024}),g=f()(l,2),r=g[0],C=g[1],a=function(){var _=window.innerWidth,E=window.innerHeight;C({height:E,width:_})};(0,O.useEffect)(function(){window.addEventListener("resize",function(){a()}),a()},[c]);var i=c.query?Object.keys(c.query).map(function(D){return"".concat(D,"=").concat(c.query[D])}):[];return(0,v.jsx)(h.Link,{target:"_blank",to:"/console/"+c.container+"?width=".concat(r.width,"&height=").concat(r.height,"&").concat(i.join("&")),children:(0,v.jsxs)(x.Z,{title:c.tips?c.tips:"\u7EC8\u7AEF",children:[(0,v.jsx)(F.Z,{})," ",c.content]})})}},80821:function(N,A,e){e.d(A,{Z:function(){return c}});var B=e(5574),f=e.n(B),F=e(24963),h=e(86738),x=e(28036),O=e(83062),v=e(67294),T=e(85893);function c(l){var g=(0,v.useState)(!1),r=f()(g,2),C=r[0],a=r[1],i=(0,v.useContext)(F.Z),D=i.lang,_=i.notice,E=i.message,y=function(){a(!0),l.action().then(function(P){if(a(!1),typeof l.onSuccess=="function"&&l.onSuccess(P),l.messageSuccess){var j="";typeof l.messageSuccess=="function"?j=l.messageSuccess(P):j=l.messageSuccess,j=D("notification.".concat(j))+D("notification.title.success"),l.asynced?E.info(j):E.success(j)}}).catch(function(P){a(!1),typeof l.onError=="function"&&l.onError(P)})};return l.confirm?(0,T.jsx)(h.Z,{style:{width:500},title:l.confirmTitle?l.confirmTitle:D("notification.title.tip"),description:l.confirm,onConfirm:y,okText:"Yes",cancelText:"No",children:(0,T.jsx)(x.ZP,{disabled:l.disabled,icon:l.icon,loading:C,danger:l.danger,type:l.type,children:l.children})}):(0,T.jsx)(O.Z,{title:l.tips,children:(0,T.jsx)(x.ZP,{disabled:l.disabled,icon:l.icon,loading:C,onClick:y,danger:l.danger,type:l.type,children:l.children})})}},37413:function(N,A,e){e.d(A,{Z:function(){return C}});var B=e(19632),f=e.n(B),F=e(27496),h=e(35995),x=e(99611),O=e(29158),v=e(38345),T=e(55241),c=e(42075),l=e(66309),g=e(67294),r=e(85893);function C(a){return(0,r.jsx)(T.Z,{placement:"right",content:(0,r.jsxs)(v.Z,{direction:"column",style:{width:500},ghost:!0,children:[(0,r.jsx)(v.Z,{title:"\u7AEF\u53E3",children:[].concat(f()(a.publicPort),f()(a.privatePort)).map(function(i,D){var _=a.serverIp;if(_!=""&&_.indexOf("http")===-1&&_.indexOf(":")>-1&&(_="[".concat(_,"]")),_==""){var E=document.location.protocol+"//"+document.location.hostname;_=E}return _==""&&(_=i.IP),(0,r.jsx)(c.Z,{size:"large",wrap:!0,children:(0,r.jsx)(l.Z,{color:i.PublicPort?"#2db7f5":"warning",icon:i.PublicPort?(0,r.jsx)(F.Z,{}):"",style:{marginBottom:5,width:210},children:i.PublicPort?(0,r.jsx)("a",{href:"".concat(_.indexOf("http")===0?_:"http://"+_,":").concat(i.PublicPort),target:"_blank",children:"".concat(i.PublicPort?i.IP+":"+i.PublicPort+" -> ":"").concat(i.PrivatePort,"/").concat(i.Type)},"link".concat(D)):"".concat(i.PrivatePort,"/").concat(i.Type)})},"space".concat(D))})}),a.domain.length>0&&(0,r.jsx)(v.Z,{title:"\u57DF\u540D",children:(0,r.jsx)(c.Z,{direction:"vertical",style:{textAlign:"left"},children:a.domain.map(function(i,D){return(0,r.jsx)(l.Z,{color:"blue",icon:(0,r.jsx)(F.Z,{}),children:(0,r.jsx)("a",{href:i,target:"_blank",children:i})},"domain".concat(D))})})})]}),children:(0,r.jsxs)(c.Z,{direction:"vertical",children:[a.privatePort.length>0&&(0,r.jsxs)(l.Z,{color:"warning",icon:(0,r.jsx)(h.Z,{}),children:["\u5185\u90E8\u7AEF\u53E3: ",a.privatePort.length]}),a.publicPort.length>0&&(0,r.jsxs)(l.Z,{color:"#2db7f5",icon:(0,r.jsx)(x.Z,{}),children:["\u5BF9\u5916\u7AEF\u53E3: ",a.publicPort.length]}),a.domain.length>0&&(0,r.jsxs)(l.Z,{color:"blue",icon:(0,r.jsx)(O.Z,{}),children:["\u7ED1\u5B9A\u57DF\u540D: ",a.domain.length]})]})})}},94359:function(N,A,e){e.d(A,{Z:function(){return C}});var B=e(67294),f=e(3089),F=e(98165),h=e(18429),x=e(8751),O=e(14313),v=e(30159),T=e(87740),c=e(66309),l=e(83062),g=e(63713),r=e(85893);function C(a){var i=(0,r.jsx)(r.Fragment,{});if(a.status=="0"&&(i=(0,r.jsx)(c.Z,{icon:(0,r.jsx)(f.Z,{}),color:"default",children:"waiting"})),a.status=="10"&&(i=(0,r.jsx)(c.Z,{icon:(0,r.jsx)(F.Z,{spin:!0}),color:"processing",children:"processing"})),a.status=="20"&&(i=(0,r.jsx)(c.Z,{icon:(0,r.jsx)(h.Z,{}),color:"error",children:"error"})),a.status=="30"&&(i=(0,r.jsx)(c.Z,{icon:(0,r.jsx)(x.Z,{}),color:"success",children:"success"})),a.status=="running"||a.status=="healthy"){var D,_;i=(0,r.jsx)(c.Z,{icon:(0,r.jsx)(O.Z,{}),color:"success",children:(D=a.message)!==null&&D!==void 0&&D.showInTag?(_=a.message)===null||_===void 0?void 0:_.content:a.status})}if(a.status=="paused"){var E,y;i=(0,r.jsx)(c.Z,{icon:(0,r.jsx)(v.Z,{}),children:(E=a.message)!==null&&E!==void 0&&E.showInTag?(y=a.message)===null||y===void 0?void 0:y.content:a.status})}if(a.status=="waiting"||a.status=="starting"){var m,P;i=(0,r.jsx)(c.Z,{icon:(0,r.jsx)(T.Z,{}),children:(m=a.message)!==null&&m!==void 0&&m.showInTag?(P=a.message)===null||P===void 0?void 0:P.content:a.status})}if(a.status=="exited"||a.status=="dead"||a.status=="removing"||a.status=="restarting"||a.status=="unhealthy"||a.status=="created"){var j,o;i=(0,r.jsx)(c.Z,{icon:(0,r.jsx)(h.Z,{}),color:"warning",children:(j=a.message)!==null&&j!==void 0&&j.showInTag?(o=a.message)===null||o===void 0?void 0:o.content:a.status})}if(a.link&&(i=(0,r.jsx)(g.Link,{to:a.link,children:i})),a.message){var Y;i=(0,r.jsx)(l.Z,{placement:(Y=a.message.placement)!==null&&Y!==void 0?Y:"top",title:a.message.content,children:i})}return(0,r.jsx)(r.Fragment,{children:i})}},92754:function(N,A,e){var B=e(5574),f=e.n(B),F=e(67294),h=e(63713),x=e(38703),O=e(85893),v=(0,F.forwardRef)(function(T,c){var l=(0,F.useState)(""),g=f()(l,2),r=g[0],C=g[1];(0,F.useImperativeHandle)(c,function(){return{setFinish:function(){E({finish:{downloading:100,extracting:100}})},setStart:function(m){m&&C(m),E({start:{downloading:0,extracting:0}})}}});var a=(0,h.useModel)("subscriber");a.addDataHandler("image:pull:"+r,function(y){E(y.data)});var i=(0,F.useState)(),D=f()(i,2),_=D[0],E=D[1];return(0,F.useEffect)(function(){E({start:{downloading:0,extracting:0}})},[]),(0,O.jsx)(O.Fragment,{children:_&&Object.keys(_).map(function(y){return(0,O.jsx)(x.Z,{percent:_[y].downloading,success:{percent:_[y].extracting}},y)})})});A.Z=v},78451:function(N,A,e){e.d(A,{Z:function(){return F}});var B=e(67294),f=e(85893);function F(h){return(0,f.jsx)("span",{style:{width:h.width?h.width:"auto",wordBreak:"break-word"},children:h.content})}},54964:function(N,A,e){e.d(A,{a:function(){return l}});var B=e(78267),f=e.n(B),F=e(75458),h=e.n(F),x=e(67294),O=e(12320),v=e.n(O),T=e(89629),c=e(85893),l={convertEol:!0,fontFamily:'Menlo, Monaco, "Courier New", monospace',fontWeight:400,fontSize:16,cursorStyle:"block",cursorBlink:!0,theme:{foreground:"#bfbfbf",cursor:"gray",selectionForeground:"#ffffff"}},g=new O.Terminal(l),r=new F.SearchAddon,C=new B.FitAddon,a=(0,x.forwardRef)(function(i,D){return(0,x.useEffect)(function(){window.addEventListener("resize",function(){i.showInModal||C.fit()}),i.style&&i.style.fontSize&&(g.options.fontSize=i.style.fontSize),g.loadAddon(C),g.loadAddon(r),g.open(document.getElementById("terminal-container")),i.showInModal||C.fit()},[]),(0,x.useImperativeHandle)(D,function(){return{write:function(E){g.write(E)},clear:function(){g.clear()},getTerminal:function(){return g},findNext:function(E){r.findNext(E)},findPrev:function(E){r.findPrevious(E)},fit:function(){C.fit()},onData:function(E){g.onData(E)}}}),(0,c.jsx)("div",{id:"terminal-container",style:{width:i.width?i.width:"100%",height:i.height?i.height:"500px"}})});A.Z=a},9740:function(N,A,e){e.r(A),e.d(A,{default:function(){return Ue}});var B=e(15009),f=e.n(B),F=e(99289),h=e.n(F),x=e(5574),O=e.n(x),v=e(80821),T=e(54964),c=e(90098),l=e(43425),g=e(74842),r=e(48689),C=e(33160),a=e(87784),i=e(30159),D=e(86548),_=e(89035),E=e(45742),y=e(90078),m=e(38345),P=e(97269),j=e(62370),o=e(63713),Y=e(28036),Q=e(42075),de=e(25593),b=e(84567),te=e(96074),G=e(63490),w=e(83062),z=e(92398),I=e(67294),V=e(99861),ce=e(95089),re=e(95213),ie=e(24963),_e=e(91058),Ee=e(12320),S=e(89629),Ae=e(78267),t=e(85893),se=new Ee.Terminal(T.a),fe=new Ae.FitAddon;function Te(X){var ne=(0,o.useModel)("subscriber");return ne.addDataHandler("compose:log:"+X.id,function(ue){se.write(ue.data)}),(0,I.useEffect)(function(){return window.addEventListener("resize",function(){fe.fit()}),se.options.fontSize=12,se.loadAddon(fe),se.open(document.getElementById("terminal-log")),fe.fit(),se.clear(),function(){ne.progress.close("compose:log:"+X.id)}},[X.id]),(0,t.jsx)("div",{id:"terminal-log",style:{width:"100%",height:"500px"}})}var Re=e(37413),Ie=e(87662),Ze=e(94359),Be=e(57165),Le=e(79245),ge=e(78451);function Ue(){var X,ne,ue,ve=(0,I.useContext)(ie.Z),Pe=ve.loading,Se=ve.lang,He=ve.notice,le=(0,o.useParams)(),je=(0,o.useNavigate)(),We=(0,I.useState)(),De=O()(We,2),s=De[0],pe=De[1],$=(0,I.useRef)(),Ke=(0,I.useState)(0),xe=O()(Ke,2),J=xe[0],k=xe[1],be=(0,I.useState)("default"),Oe=O()(be,2),Ve=Oe[0],q=Oe[1],K=(0,I.useRef)(),Fe=(0,o.useModel)("subscriber"),Ne=(0,I.useState)(""),Me=O()(Ne,2),Ge=Me[0],we=Me[1],me=(0,I.useRef)(),oe=(0,I.useRef)(),he=(0,I.useRef)(),ze=(0,I.useState)(!1),Ce=O()(ze,2),$e=Ce[0],ye=Ce[1];return Fe.addDataHandler("compose:"+le.id,function(u){var n;(n=$.current)===null||n===void 0||n.write(u.data)}),(0,I.useEffect)(function(){return Pe.show(),ye(!1),(0,c.Pn)({id:le.id}).then(function(u){var n=u.data.detail;n.setting.status&&n.setting.status.indexOf("running")>-1&&(n.isRunning=!0),n.setting.status&&n.setting.status.indexOf("paused")>-1&&(n.isPaused=!0),n.setting.status&&n.setting.status.indexOf("exited")>-1&&(n.isExited=!0),n.setting.status&&n.setting.status=="waiting"?n.isDeploy=!1:n.isDeploy=!0,n.setting.status&&n.setting.status.indexOf("created")>-1&&(n.isCreated=!0,n.isDeploy=!1),u.data.project&&(n.imageList=Object.keys(u.data.project.services).map(function(M){var Z;return(Z=u.data.project.services[M].image)!==null&&Z!==void 0?Z:""}));var d=u.data.project;if((!u.data.containerList||u.data.containerList.length==0)&&d&&d.services&&(u.data.containerList=Object.keys(d.services).map(function(M){return{name:"-",service:M,publishers:d.services[M].ports?d.services[M].ports.map(function(Z){var p;return{url:"",targetPort:Z.target,publishedPort:parseInt(Z.published),protocol:(p=Z.protocol)!==null&&p!==void 0?p:""}}):[],state:"waiting",status:""}})),u.data.containerList){var U;(0,Ie.EH)().then(function(M){we(M.data.ip)}),n.containerList=u.data.containerList,(U=K.current)===null||U===void 0||U.setFieldValue("deployServiceName",u.data.detail.setting.deployServiceName)}if(n.yamlList=u.data.yaml,pe(n),d!=null&&d.services&&Object.keys(d.services).map(function(M){var Z=[];if(d.services&&d.services[M]&&(d.services[M].environment&&Object.keys(d.services[M].environment).map(function(ee){d.services[M].environment&&Z.push({name:ee,value:d.services[M].environment[ee]})}),Z.length!=0)){var p;(p=K.current)===null||p===void 0||p.setFieldValue(["environmentService",M],Z)}}),u.data.detail.setting.environment){var L;(L=K.current)===null||L===void 0||L.setFieldValue("environment",u.data.detail.setting.environment)}else{var W,R=(0,Le.m)(u.data.yaml[0]);(W=K.current)===null||W===void 0||W.setFieldValue("environment",R)}n.isDeploy&&(0,c.VN)({id:le.id})}).catch(function(u){console.log(u),je("/compose/list")}).finally(function(){Pe.destroy()}),function(){Fe.progress.close("compose:log:"+le.id)}},[J]),(0,t.jsx)(y._z,{header:{extra:[(0,t.jsx)(o.Link,{to:"/compose/create",reloadDocument:location.search.length>0,children:(0,t.jsx)(Y.ZP,{type:"primary",children:"\u521B\u5EFA\u4EFB\u52A1"},"createCompose")},"create")]},children:(0,t.jsxs)(m.Z,{direction:"column",ghost:!0,gutter:[10,10],children:[(0,t.jsx)(m.Z,{title:(0,t.jsx)(l.Z,{}),subTitle:"\u64CD\u4F5C - "+(s==null?void 0:s.name),bordered:!0,extra:(0,t.jsx)(t.Fragment,{children:s&&s.imageList&&s.imageList.length>0&&(0,t.jsx)(V.Z,{ref:he,image:s.imageList})}),headerBordered:!0,children:s&&(0,t.jsxs)(Q.Z,{wrap:!0,children:[(0,t.jsx)(v.Z,{icon:(0,t.jsx)(g.Z,{}),type:"primary",confirm:(0,t.jsxs)(Q.Z,{style:{width:300},direction:"vertical",children:[(0,t.jsx)(de.Z.Text,{children:"\u91CD\u65B0\u521B\u5EFA\u8BE5\u4EFB\u52A1\u4E0B\u7684\u5BB9\u5668\uFF1F"}),(0,t.jsxs)(P.A,{name:"createForm",formRef:oe,layout:"inline",submitter:!1,children:[(0,t.jsx)(j.Z,{initialValue:!1,name:"pullImageUseCommand",valuePropName:"checked",children:(0,t.jsx)(b.Z,{children:"\u4F7F\u7528\u547D\u4EE4\u62C9\u53D6\u955C\u50CF\uFF08\u9700\u914D\u7F6E\u547D\u4EE4\u4EE3\u7406\uFF09\uFF1F"})}),(0,t.jsx)(j.Z,{initialValue:!0,name:"pullImageUseDPanel",valuePropName:"checked",children:(0,t.jsx)(b.Z,{defaultChecked:!0,children:"\u4F7F\u7528\u9762\u677F\u62C9\u53D6\u955C\u50CF\uFF08\u9700\u914D\u7F6E\u4ED3\u5E93\u52A0\u901F\uFF09\uFF1F"})}),(0,t.jsx)(j.Z,{initialValue:!0,name:"createPath",valuePropName:"checked",children:(0,t.jsx)(b.Z,{defaultChecked:!0,children:"\u521B\u5EFA\u6302\u8F7D\u76EE\u5F55\uFF08\u4EC5\u9762\u677F\u975E\u5BB9\u5668\u90E8\u7F72\u751F\u6548\uFF09\uFF1F"})})]})]}),action:h()(f()().mark(function u(){var n,d,U,L,W,R,M,Z,p,ee;return f()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(q("deploy"),(n=$.current)===null||n===void 0||n.clear(),M={id:s.id||s.name},!((d=oe.current)!==null&&d!==void 0&&d.getFieldValue&&oe.current.getFieldValue("pullImageUseDPanel"))){H.next=7;break}return H.next=6,(Z=he.current)===null||Z===void 0?void 0:Z.start();case 6:(p=he.current)===null||p===void 0||p.finish();case 7:if(M.environment=(U=K.current)===null||U===void 0?void 0:U.getFieldValue("environment"),M.deployServiceName=(L=K.current)===null||L===void 0?void 0:L.getFieldValue("deployServiceName"),M.createPath=(W=(R=oe.current)===null||R===void 0?void 0:R.getFieldValue("createPath"))!==null&&W!==void 0?W:!0,!(s!=null&&s.isDeploy)){H.next=14;break}if(!((ee=oe.current)!==null&&ee!==void 0&&ee.getFieldValue("pullImageUseCommand"))){H.next=14;break}return H.next=14,(0,c.GG)({id:s.id||s.name,op:"pull"});case 14:return H.next=16,(0,c.Oh)(M);case 16:k(J+1);case 17:case"end":return H.stop()}},u)})),children:s.isDeploy?"\u66F4\u65B0":"\u542F\u52A8"},"create"),(s.isDeploy||s.isCreated)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.Z,{action:function(){var n;return(n=$.current)===null||n===void 0||n.clear(),q("destory"),(0,c.mg)({id:s.id||s.name,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1})},onSuccess:function(){k(J+1)},confirm:"\u662F\u5426\u8981\u5220\u9664\u5BB9\u5668\uFF1F",type:"primary",danger:!0,messageSuccess:"delete",icon:(0,t.jsx)(r.Z,{}),children:"\u5220\u9664\u5BB9\u5668"}),(0,t.jsx)(te.Z,{type:"vertical"})]}),s.isDeploy&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.Z,{icon:(0,t.jsx)(C.Z,{}),action:h()(f()().mark(function u(){return f()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return q("crtl"),d.next=3,(0,c.GG)({id:s.id||s.name,op:"restart"});case 3:k(J+1);case 4:case"end":return d.stop()}},u)})),children:"\u91CD\u542F"},"restart"),(0,t.jsx)(v.Z,{action:function(){var n;return(n=$.current)===null||n===void 0||n.clear(),q("crtl"),(0,c.GG)({id:s.id||s.name,op:"stop"})},messageSuccess:"stop",icon:(0,t.jsx)(a.Z,{}),disabled:s.isExited,onSuccess:function(){k(J+1)},children:"\u505C\u6B62"}),s.isPaused&&(0,t.jsx)(v.Z,{action:function(){var n;return q("crtl"),(n=$.current)===null||n===void 0||n.clear(),(0,c.GG)({id:s.id||s.name,op:"unpause"})},messageSuccess:"resume",onSuccess:function(){k(J+1)},icon:(0,t.jsx)(g.Z,{}),children:"\u6062\u590D"}),!s.isPaused&&(0,t.jsx)(v.Z,{action:function(){var n;return q("crtl"),(n=$.current)===null||n===void 0||n.clear(),(0,c.GG)({id:s.id||s.name,op:"pause"})},onSuccess:function(){k(J+1)},messageSuccess:"pause",icon:(0,t.jsx)(i.Z,{}),disabled:!s.isRunning,children:"\u6682\u505C"})]}),(0,t.jsx)(te.Z,{type:"vertical"}),s.isDeploy&&(0,t.jsx)(o.Link,{to:"/compose/create?id="+(s.id||s.name),children:(0,t.jsx)(Y.ZP,{icon:(0,t.jsx)(D.Z,{}),children:"\u7F16\u8F91\u4EFB\u52A1"})}),s.isDeploy&&s.id>0&&(0,t.jsx)(v.Z,{type:"primary",action:h()(f()().mark(function u(){var n,d,U,L,W,R,M,Z,p;return f()().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return(n=$.current)===null||n===void 0||n.clear(),q("destory"),ae.next=4,(0,c.mg)({id:(d=s==null?void 0:s.id)!==null&&d!==void 0?d:0,deleteImage:(U=(L=me.current)===null||L===void 0?void 0:L.getFieldValue("deleteImage"))!==null&&U!==void 0?U:!1,deleteData:!0,deleteVolume:(W=(R=me.current)===null||R===void 0?void 0:R.getFieldValue("deleteVolume"))!==null&&W!==void 0?W:!1,deletePath:(M=(Z=me.current)===null||Z===void 0?void 0:Z.getFieldValue("deletePath"))!==null&&M!==void 0?M:!1});case 4:p=ae.sent;case 5:case"end":return ae.stop()}},u)})),danger:!0,onSuccess:function(){je("/compose/list")},confirm:(0,t.jsxs)(Q.Z,{style:{width:200},direction:"vertical",children:[(0,t.jsx)(de.Z.Text,{children:"\u4F1A\u540C\u65F6\u5220\u9664\u5BB9\u5668\u53CA\u90E8\u7F72\u76F8\u5173\u6570\u636E\uFF0C\u672A\u52FE\u9009\u5220\u9664 compose \u6587\u4EF6\u65F6 yaml \u6587\u4EF6\u5C06\u4F1A\u4FDD\u7559\uFF0C\u786E\u8BA4\u5417\uFF1F"}),(0,t.jsxs)(P.A,{formRef:me,layout:"inline",submitter:!1,children:[(0,t.jsx)(j.Z,{initialValue:!1,name:"deleteImage",valuePropName:"checked",children:(0,t.jsx)(b.Z,{children:"\u5220\u9664\u955C\u50CF\uFF1F"})}),(0,t.jsx)(j.Z,{initialValue:!1,name:"deleteVolume",valuePropName:"checked",children:(0,t.jsx)(b.Z,{children:"\u5220\u9664\u5B58\u50A8\u5377\uFF1F"})}),(0,t.jsx)(j.Z,{initialValue:!1,name:"deletePath",valuePropName:"checked",children:(0,t.jsx)(b.Z,{children:"\u5220\u9664 Compose \u6587\u4EF6\u548C\u4EFB\u52A1\u76EE\u5F55\uFF1F"})})]})]}),children:"\u5220\u9664\u4EFB\u52A1"})]})},"operator"),(0,t.jsxs)(m.Z,{split:"vertical",children:[(0,t.jsxs)(m.Z,{colSpan:"45%",direction:"column",split:"horizontal",title:"\u542F\u52A8\u914D\u7F6E",subTitle:"\u7F16\u8F91\u540E\u53EA\u5F71\u54CD\u672C\u6B21\u90E8\u7F72",extra:[s&&!s.isDeploy&&(0,t.jsx)(b.Z,{onChange:function(n){ye(n.target.checked)},children:"\u81EA\u5B9A\u4E49\u90E8\u7F72\u5BB9\u5668\u670D\u52A1\uFF1F"},"selectService")],children:[Ve!="default"&&(0,t.jsx)(m.Z,{title:(0,t.jsx)(_.Z,{}),subTitle:"\u63A7\u5236\u53F0",extra:(0,t.jsx)(Q.Z,{children:(0,t.jsx)(v.Z,{action:function(){var n;return(n=$.current)===null||n===void 0||n.clear(),(0,c.U_)({})},icon:(0,t.jsx)(r.Z,{}),danger:!0,onSuccess:function(){k(J+1)},children:"\u4E2D\u6B62\u6267\u884C"},"kill")}),children:(0,t.jsx)(T.Z,{height:"300px",style:{fontSize:12},ref:$})}),s&&(0,t.jsx)(m.Z,{children:(0,t.jsx)(G.Z,{scroll:{x:"max-content"},rowKey:"service",pagination:!1,columns:[{title:"\u5BB9\u5668\u540D",dataIndex:"name",width:170,render:function(n,d,U){return(0,t.jsx)(ge.Z,{content:d.name})}},{title:"\u670D\u52A1\u540D",dataIndex:"service",width:100,render:function(n,d,U){return(0,t.jsx)(ge.Z,{content:d.service})}},{title:"\u7AEF\u53E3",render:function(n,d,U){var L=[],W=[];return d.publishers&&d.publishers.map(function(R){R.publishedPort?L.push({PrivatePort:R.targetPort,Type:R.protocol,IP:R.url,PublicPort:R.publishedPort}):R.publishedPort&&W.push({PrivatePort:R.targetPort,Type:R.protocol,IP:R.url,PublicPort:R.publishedPort})}),(0,t.jsx)(Re.Z,{publicPort:L,privatePort:W,domain:[],serverIp:Ge})}},{title:"\u72B6\u6001",render:function(n,d,U){return(0,t.jsx)(Ze.Z,{status:d.state,message:{content:Se("container.status.".concat(d.state)),placement:"top",showInTag:!0}},d.name)}},{title:"\u64CD\u4F5C",render:function(n,d,U){return(0,t.jsxs)(Q.Z,{split:(0,t.jsx)(te.Z,{type:"vertical"}),children:[(0,t.jsx)(o.Link,{to:"/app/detail/edit/"+d.name,target:"_blank",children:(0,t.jsx)(w.Z,{title:"\u7BA1\u7406\u5BB9\u5668",children:(0,t.jsx)(l.Z,{})})},"edit"),d.state=="running"&&(0,t.jsx)(Be.Z,{container:d.name},"console")]})}}],dataSource:s.containerList,rowSelection:$e&&s.containerList?{defaultSelectedRowKeys:s.containerList.map(function(u){return u.service}),onChange:function(n,d,U){var L;(L=K.current)===null||L===void 0||L.setFieldValue("deployServiceName",n)}}:void 0})}),(0,t.jsxs)(P.A,{formRef:K,submitter:!1,children:[(0,t.jsx)(j.Z,{name:"deployServiceName",hidden:!0}),!(s!=null&&s.isDeploy)&&(0,t.jsx)(m.Z,{title:"\u73AF\u5883\u53D8\u91CF",subTitle:"\u9762\u677F\u751F\u6210 .dpanel.env \u6587\u4EF6\uFF0C\u540C\u65F6\u4F1A\u52A0\u8F7D .env",children:(0,t.jsx)(_e.Z,{showCardGhost:!0,name:"environment",showDisableName:!0,showInDrawer:!0,requireValue:!0})}),!(s!=null&&s.isDeploy)&&(0,t.jsx)(m.Z,{title:"\u670D\u52A1\u73AF\u5883\u53D8\u91CF",tooltip:"\u4FEE\u6539\u670D\u52A1\u4E2D\u7684\u73AF\u5883\u53D8\u91CF\u65F6\uFF0C\u8BF7\u5728 yaml \u4E2D\u5C06\u503C\u5148\u6620\u5C04\u6210\u81EA\u5B9A\u4E49\u7684\u53D8\u91CF\u540D",children:(0,t.jsx)(z.Z,{indicator:{align:"center"},items:K&&K.current&&((X=K.current)===null||X===void 0?void 0:X.getFieldValue("environmentService"))&&Object.keys((ne=K.current)===null||ne===void 0?void 0:ne.getFieldValue("environmentService")).map(function(u){return{label:u,key:u,children:(0,t.jsx)(_e.Z,{showCardGhost:!0,name:["environmentService",u],showDisableName:!0,showDisableValue:!0,showInDrawer:!0,requireValue:!0})}})})})]})]}),s&&!s.isDeploy&&(0,t.jsx)(m.Z,{colSpan:"55%",children:(0,t.jsx)(z.Z,{items:s.yamlList&&s.yamlList.map(function(u,n){var d=[{label:"Yaml \u6587\u4EF6",key:"yaml"},{label:"\u8986\u76D6 Yaml \u6587\u4EF6",key:"yamlOverride"}];return{label:d[n].label,key:d[n].key,disabled:u=="",children:(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(ce.ZP,{theme:"dark",minHeight:"550px",value:u,readOnly:!0,extensions:[re.RI.yaml()]})})}})})}),s&&s.isDeploy&&(0,t.jsx)(m.Z,{title:(0,t.jsx)(E.Z,{}),subTitle:"\u65E5\u5FD7",colSpan:"55%",children:(0,t.jsx)(Te,{id:(ue=le.id)!==null&&ue!==void 0?ue:""})})]})]})})}},3393:function(N,A,e){e.d(A,{Gb:function(){return T},Pn:function(){return r},Rb:function(){return a},YU:function(){return O},ZQ:function(){return E},_U:function(){return l},cd:function(){return D}});var B=e(15009),f=e.n(B),F=e(99289),h=e.n(F),x=e(63713);function O(m){return v.apply(this,arguments)}function v(){return v=h()(f()().mark(function m(P){return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,x.request)("/api/app/image/get-detail",{method:"POST",data:P}));case 1:case"end":return o.stop()}},m)})),v.apply(this,arguments)}function T(m){return c.apply(this,arguments)}function c(){return c=h()(f()().mark(function m(P){return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,x.request)("/api/app/image/tag-remote",{method:"POST",data:P}));case 1:case"end":return o.stop()}},m)})),c.apply(this,arguments)}function l(m){return g.apply(this,arguments)}function g(){return g=h()(f()().mark(function m(P){return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,x.request)("/api/app/image/tag-add",{method:"POST",data:P}));case 1:case"end":return o.stop()}},m)})),g.apply(this,arguments)}function r(m){return C.apply(this,arguments)}function C(){return C=h()(f()().mark(function m(P){return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,x.request)("/api/app/image/tag-delete",{method:"POST",data:P}));case 1:case"end":return o.stop()}},m)})),C.apply(this,arguments)}function a(m){return i.apply(this,arguments)}function i(){return i=h()(f()().mark(function m(P){return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,x.request)("/api/app/image/export",{method:"POST",data:P,responseType:"blob"}));case 1:case"end":return o.stop()}},m)})),i.apply(this,arguments)}function D(m){return _.apply(this,arguments)}function _(){return _=h()(f()().mark(function m(P){return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,x.request)("/api/pro/image/get-remote-tag",{method:"POST",data:P}));case 1:case"end":return o.stop()}},m)})),_.apply(this,arguments)}function E(m){return y.apply(this,arguments)}function y(){return y=h()(f()().mark(function m(P){return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,x.request)("/api/app/image/check-upgrade",{method:"POST",data:P}));case 1:case"end":return o.stop()}},m)})),y.apply(this,arguments)}}}]);
