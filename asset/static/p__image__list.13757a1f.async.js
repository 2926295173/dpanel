"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4214],{1699:function(w,M,e){e.d(M,{u:function(){return R}});var A=e(9783),u=e.n(A),E=e(97857),o=e.n(E),P=e(67294),i=e(82346),I=e(40411),S=e(42075),T=e(85893),R=function(c){var D=(0,i.useAccess)(),F=Array.isArray(c.access)?c.access:[c.access],f,O=c.fallback;if(typeof c.children=="function"?(f=c.children(F.reduce(function(p,b){return o()(o()({},p),{},u()({},b,D[b]))},{})),f||(f=O)):F.every(function(p){return D[p]})?f=c.children:f=O,!O&&f&&c.showProTips&&D.canSeeEnableCe){if(D.canSeeEnableHiddenProTips)return null;f=(0,T.jsx)(I.Z,{offset:c.showProTipsOffset,count:"PRO",color:"gold",style:{fontWeight:"bold"},children:f})}if(!O&&f&&c.showProRibbonTips&&D.canSeeEnableCe){if(D.canSeeEnableHiddenProTips)return null;f=(0,T.jsx)(I.Z.Ribbon,{text:"PRO",color:"gold",style:{fontWeight:"bold"},children:f})}return c.space?(0,T.jsx)(S.Z,o()(o()({},c.space),{},{children:f})):f}},92754:function(w,M,e){var A=e(5574),u=e.n(A),E=e(67294),o=e(82346),P=e(38703),i=e(85893),I=(0,E.forwardRef)(function(S,T){var R=(0,E.useState)(""),C=u()(R,2),c=C[0],D=C[1];(0,E.useImperativeHandle)(T,function(){return{setFinish:function(){b({finish:{downloading:100,extracting:100}})},setStart:function($){$&&D($),b({start:{downloading:0,extracting:0}})},close:function(){F.progress.close("image:pull:"+c),b({start:{downloading:0,extracting:0}})}}});var F=(0,o.useModel)("subscriber");F.addDataHandler("image:pull:"+c,function(y){b(y.data)});var f=(0,E.useState)(),O=u()(f,2),p=O[0],b=O[1];return(0,E.useEffect)(function(){return b({start:{downloading:0,extracting:0}}),function(){F.progress.close("image:pull:"+c)}},[]),(0,i.jsx)(i.Fragment,{children:p&&Object.keys(p).map(function(y){return(0,i.jsx)(P.Z,{percent:p[y].downloading,success:{percent:p[y].extracting}},y)})})});M.Z=I},78451:function(w,M,e){e.d(M,{Z:function(){return E}});var A=e(67294),u=e(85893);function E(o){return(0,u.jsx)("span",{style:{width:o.width?o.width:"auto",wordBreak:"break-word"},children:o.content})}},51100:function(w,M,e){e.d(M,{Z:function(){return P}});var A=e(97961),u=e(91604),E=e(1677),o=e(85893);function P(i){return i.showDragger?(0,o.jsx)(u.Z,{max:i.max?i.max:1,title:i.title,label:i.label,required:i.required,rules:[{required:i.required}],fieldProps:{multiple:!!(i.max&&i.max>1),name:"file",accept:i.accept,action:"/api/common/attach/upload",headers:{Authorization:"Bearer "+localStorage.getItem("token")},onRemove:function(S){return new Promise(function(T){var R;(0,A._2)({path:(R=S.response.data.path)!==null&&R!==void 0?R:""}).then(function(C){T(!0)})})}},name:i.name}):(0,o.jsx)(E.Z,{max:i.max?i.max:1,title:i.title,label:i.label,required:i.required,rules:[{required:i.required}],fieldProps:{multiple:!!(i.max&&i.max>1),name:"file",accept:i.accept,action:"/api/common/attach/upload",headers:{Authorization:"Bearer "+localStorage.getItem("token")},onRemove:function(S){return new Promise(function(T){var R;(0,A._2)({path:(R=S.response.data.path)!==null&&R!==void 0?R:""}).then(function(C){T(!0)})})}},name:i.name})}},65913:function(w,M,e){var A=e(5574),u=e.n(A),E=e(74330),o=e(67294),P=e(85893),i=(0,o.forwardRef)(function(I,S){(0,o.useImperativeHandle)(S,function(){return{show:function(){c(!0)},destroy:function(){c(!1)}}});var T=(0,o.useState)(!1),R=u()(T,2),C=R[0],c=R[1];return(0,P.jsx)(E.Z,{spinning:C,size:"default",children:I.children})});M.Z=i},17550:function(w,M,e){e.r(M),e.d(M,{default:function(){return _e}});var A=e(19632),u=e.n(A),E=e(15009),o=e.n(E),P=e(99289),i=e.n(P),I=e(5574),S=e.n(I),T=e(90078),R=e(78099),C=e(97269),c=e(62370),D=e(37476),F=e(5966),f=e(28036),O=e(25593),p=e(42075),b=e(66309),y=e(96074),$=e(83062),z=e(84567),d=e(50136),m=e(67294),U=e(82346),n=e(18148),ee=e(5251),J=e(80821),re=e(43425),ne=e(64789),ae=e(58638),se=e(1912),ie=e(2205),te=e(67255),le=e(3393),oe=e(93162),ue=e(78914),N=e(1699),ce=e(184),de=e(44349),me=e(97961),fe=e(51100),j=e(36146),t=e(85893),he=(0,m.forwardRef)(function(V,g){(0,m.useImperativeHandle)(g,function(){return{}});var Y=(0,m.useRef)(),W=new j.Uo("components.image");return(0,t.jsxs)(ce.a,{title:W.format("importTitle"),trigger:(0,t.jsx)(f.ZP,{children:W.format("importTitle")},"create"),formRef:Y,onFinish:function(){var k=i()(o()().mark(function X(K){var B,H;return o()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,(0,me.GH)({localUrl:K.imageTarUpload?K.imageTarUpload.map(function(l){return l.response.data.path}):[],remoteUrl:K.remoteUrl?K.remoteUrl.map(function(l){return l.url}):[]});case 2:return H=h.sent,!((B=Y.current)===null||B===void 0)&&B.resetFields&&Y.current.resetFields(),V.onFinish&&V.onFinish(),h.abrupt("return",!0);case 6:case"end":return h.stop()}},X)}));return function(X){return k.apply(this,arguments)}}(),children:[(0,t.jsx)(fe.Z,{label:W.format("importLocal"),showDragger:!0,max:10,title:W.format("importLocalTip"),name:"imageTarUpload",accept:".tar"}),(0,t.jsx)(de.Z,{label:W.format("importRemote"),name:"remoteUrl",showAddButton:!0,hideCopyButton:!0,min:1,items:[{width:"lg",name:"url",placeholder:W.format("importRemoteEmpty")}]})]})}),ge=he,pe=e(3616),ve=e(47248);function _e(){var V=(0,U.useAccess)(),g=(0,m.useRef)(),Y=(0,m.useState)({force:!1}),W=S()(Y,2),k=W[0],X=W[1],K=(0,m.useRef)(),B=(0,m.useRef)(),H=(0,m.useRef)(),Z=new j.Uo("image");return(0,t.jsxs)(T._z,{header:{extra:[(0,t.jsx)(N.u,{access:"canSeeImageListManageCreate",children:(0,t.jsx)(U.Link,{to:"/image/create",children:(0,t.jsx)(f.ZP,{type:"primary",children:j.Ob.format("image.create")},"create")},"create")},"create"),(0,t.jsx)(N.u,{access:"canSeeImageListPull",children:(0,t.jsx)(ve.Z,{onFinish:function(){var l,r;!((l=g.current)===null||l===void 0)&&l.reloadAndRest&&((r=g.current)===null||r===void 0||r.reloadAndRest())}},"remote")},"remote"),(0,t.jsx)(N.u,{access:"canSeeImageListManageCreate",children:(0,t.jsx)(ge,{onFinish:function(){var l;!((l=g.current)===null||l===void 0)&&l.reloadAndRest&&g.current.reloadAndRest()}})},"import")]},children:[(0,t.jsx)(ue.Z,{ref:B,onClose:function(){var l,r;!((l=g.current)===null||l===void 0)&&l.reloadAndRest&&((r=g.current)===null||r===void 0||r.reloadAndRest())}}),(0,t.jsx)(R.Z,{scroll:{x:"max-content"},rowKey:"Id",columns:[{title:"Id",dataIndex:"title",search:!1,render:function(l,r,v,_,a){var s=r.Id.substring(7,19);return r.Title&&(s=r.Title),(0,t.jsx)(O.Z.Link,{onClick:function(){var L;!((L=B.current)===null||L===void 0)&&L.show&&B.current.show(r.Id)},children:s},"title-".concat(v))}},{title:j.FD.format("listTitle"),dataIndex:"tag",render:function(l,r,v,_){return(0,t.jsx)(p.Z,{direction:"vertical",style:{textAlign:"left"},children:r.RepoTags.map(function(a,s){return(0,t.jsxs)(p.Z,{children:[(0,t.jsx)(b.Z,{color:"#2db7f5",children:(0,t.jsx)(O.Z.Text,{copyable:!0,title:a,style:{color:"#ffffff"},children:a},"tag-"+s)},"tag-".concat(s)),r.Containers>0&&(0,t.jsx)(b.Z,{color:"cyan",children:j.FD.format("listInUse")},"use-".concat(s))]},s)})},r.Id)}},{title:"Digest",search:!1,tooltip:j.FD.format("listDigestTip"),render:function(l,r,v,_,a){return(0,t.jsx)(p.Z,{direction:"vertical",children:r.RepoDigests&&r.RepoDigests.map(function(s){return s.substring(s.indexOf("@")+8).substring(0,12)})})}},{title:j.FD.format("listArch"),width:80,search:!1,render:function(l,r,v,_,a){if(r.Labels&&r.Labels["com.dpanel.image.arch"])return(0,t.jsx)(b.Z,{children:r.Labels["com.dpanel.image.arch"]},"arch"+r.Id)}},{title:j.FD.format("listSize"),dataIndex:"size",ellipsis:!0,width:"120px",search:!1,sorter:function(l,r){return parseFloat(l.Size)-parseFloat(r.Size)},render:function(l,r,v,_){return(0,t.jsx)("div",{children:(0,ee.FI)(parseFloat(r.Size))},r.Id)}},{title:j.FD.format("listCreatedAt"),dataIndex:"Created",ellipsis:!0,search:!1,width:"180px",render:function(l,r,v,_){return(0,t.jsx)("div",{children:(0,ee.ZM)(r.Created*1e3)},r.Id)},sorter:function(l,r){return l.Created-r.Created}},{title:j.FD.format("listManage"),valueType:"option",key:"option",width:100,fixed:"right",hidden:!V.canSeeImageListManage,render:function(l,r,v,_){return(0,t.jsxs)(p.Z,{split:(0,t.jsx)(y.Z,{type:"vertical"}),children:[(0,t.jsx)(O.Z.Link,{onClick:function(){var s;!((s=B.current)===null||s===void 0)&&s.show&&B.current.show(r.Id)},children:(0,t.jsx)($.Z,{title:j.FD.format("listManageEdit"),children:(0,t.jsx)(re.Z,{})})},"edit"),(0,t.jsx)(U.Link,{to:"/app/create/image?imageId="+r.RepoTags[0],children:(0,t.jsx)($.Z,{title:j.FD.format("listManageBuild"),children:(0,t.jsx)(ne.Z,{})})},"create")]})}}],request:function(){var h=i()(o()().mark(function l(r,v,_){var a;return o()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,n.KG)({tag:r.tag,title:r.title,use:r.use?r.use=="1"?1:2:0});case 2:if(a=x.sent,!(!a||!a.data||!a.data.list)){x.next=5;break}return x.abrupt("return",{data:[],success:!0,total:0});case 5:return a.data.list.map(function(L){var G="";L.RepoTags.map(function(q){a.data.title[q]&&(G=a.data.title[q])}),L.Title=G}),x.abrupt("return",{data:a.data.list,success:!0,total:a.data.list.length});case 7:case"end":return x.stop()}},l)}));return function(l,r,v){return h.apply(this,arguments)}}(),pagination:(0,te.O)(),search:{collapsed:!1},rowSelection:V.canSeeImageListManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0}:void 0,actionRef:g,tableAlertOptionRender:function(l){var r=l.selectedRowKeys,v=l.selectedRows;return(0,t.jsxs)(p.Z,{size:16,children:[(0,t.jsx)(J.Z,{icon:(0,t.jsx)(ae.Z,{}),confirm:(0,t.jsxs)(p.Z,{style:{width:500,marginTop:"10px",paddingRight:"10px"},direction:"vertical",size:20,children:[(0,t.jsx)(O.Z.Text,{children:(0,t.jsx)("ul",{children:Z.prefix("listManageExportTip",3).map(function(_,a){return(0,t.jsx)("li",{children:_},a)})})}),(0,t.jsx)(C.A,{layout:"horizontal",formRef:H,submitter:!1,children:(0,t.jsx)(c.Z,{valuePropName:"checked",name:"enableExportToPath",children:(0,t.jsx)(z.Z,{children:Z.format("listManageExportOptionToHost")})},"enableExportToPath")})]}),confirmOnOpenChange:function(){var a;!((a=H.current)===null||a===void 0)&&a.resetFields&&H.current.resetFields()},action:function(){var a,s=[];return v.map(function(x){s.push.apply(s,u()(x.RepoTags))}),(0,le.Rb)({md5:s,enableExportToPath:(a=H.current)===null||a===void 0?void 0:a.getFieldValue("enableExportToPath")})},onSuccess:function(a){var s,x=v.map(function(G){return G.RepoTags[0]});if(a.size>29){var L=new Blob([a],{type:"application/tar"});(0,oe.saveAs)(L,x.join("-")+".tar")}!((s=g.current)===null||s===void 0)&&s.reset&&g.current.reset()},children:j.FD.format("listManageExport")}),(0,t.jsxs)(D.Y,{modalProps:{width:pe.ob},formRef:K,title:Z.format("listManagePushTip"),trigger:(0,t.jsx)(f.ZP,{icon:(0,t.jsx)(se.Z,{}),children:Z.format("listManagePush")}),onFinish:function(){var _=i()(o()().mark(function a(s){var x,L,G;return o()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Q.next=2,(0,n.KX)({md5:r,registryId:s.registryId,newNamespace:s.newNamespace});case 2:return G=Q.sent,(x=g.current)===null||x===void 0||x.reload(),!((L=g.current)===null||L===void 0)&&L.clearSelected&&g.current.clearSelected(),Q.abrupt("return",!0);case 6:case"end":return Q.stop()}},a)}));return function(a){return _.apply(this,arguments)}}(),children:[(0,t.jsx)(c.Z,{name:"registryId",hidden:!0}),(0,t.jsx)(c.Z,{label:Z.format("listManagePushImageRespo"),name:"imageRespo",tooltip:Z.format("listManagePushImageRespoTip"),children:(0,t.jsx)(ie.Z,{multiple:!0,top:!0,onChangeList:function(a){var s;(s=K.current)===null||s===void 0||s.setFieldValue("registryId",a.map(function(x){return x.id}))}})}),(0,t.jsx)(F.Z,{tooltip:Z.format("listManagePushNewNamespaceTip"),label:Z.format("listManagePushNewNamespace"),name:"newNamespace"})]}),(0,t.jsx)(N.u,{access:"canSeeImageListManageDelete",children:(0,t.jsx)(J.Z,{danger:!0,type:"primary",action:function(){return(0,n.ao)({md5:r,force:k.force})},onSuccess:function(){var a,s;return!((a=g.current)===null||a===void 0)&&a.reloadAndRest&&((s=g.current)===null||s===void 0||s.reloadAndRest()),!0},onError:function(){var a,s;return!((a=g.current)===null||a===void 0)&&a.reset&&((s=g.current)===null||s===void 0||s.reset()),!0},confirm:(0,t.jsxs)(p.Z,{style:{width:280},direction:"vertical",children:[(0,t.jsx)(O.Z.Text,{children:j.FD.format("confirm.title")}),(0,t.jsxs)(z.Z,{name:"deleteVolume",onChange:function(a){return X({force:a.target.checked})},children:[j.FD.format("listManageDeleteForce"),"?"]})]}),children:j.FD.format("listManageDeleteBatch")})})]})},tableExtraRender:function(){return(0,t.jsx)(N.u,{access:"canSeeImageListManageCreate",children:(0,t.jsx)(d.Z,{mode:"horizontal",selectedKeys:["all"],items:[{label:(0,t.jsx)(U.Link,{to:"/image/list",replace:!0,children:Z.format("title")}),key:"all"},{label:(0,t.jsx)(U.Link,{to:"/image/list/recycle",replace:!0,children:Z.format("taskTitle")}),key:"build"}]})})},toolBarRender:function(){return[(0,t.jsx)(N.u,{access:"canSeeImageListManageDelete",children:(0,t.jsx)(J.Z,{action:function(){return(0,n.c7)()},onSuccess:function(){var r,v;return!((r=g.current)===null||r===void 0)&&r.reloadAndRest&&((v=g.current)===null||v===void 0||v.reloadAndRest()),!0},tips:j.FD.format("listManagePruneTip"),onError:function(){var r,v;return!((r=g.current)===null||r===void 0)&&r.reset&&((v=g.current)===null||v===void 0||v.reset()),!0},confirm:"notification.confirm.title",children:j.FD.format("listManagePrune")})},"prune")]},columnsState:(0,te.j)("image-list")})]})}},3393:function(w,M,e){e.d(M,{Gb:function(){return S},Pn:function(){return c},Rb:function(){return F},YU:function(){return i},ZQ:function(){return b},_U:function(){return R},cD:function(){return $},cd:function(){return O}});var A=e(15009),u=e.n(A),E=e(99289),o=e.n(E),P=e(82346);function i(d){return I.apply(this,arguments)}function I(){return I=o()(u()().mark(function d(m){return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,P.request)("/api/app/image/get-detail",{method:"POST",data:m}));case 1:case"end":return n.stop()}},d)})),I.apply(this,arguments)}function S(d){return T.apply(this,arguments)}function T(){return T=o()(u()().mark(function d(m){return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,P.request)("/api/app/image/tag-remote",{method:"POST",data:m}));case 1:case"end":return n.stop()}},d)})),T.apply(this,arguments)}function R(d){return C.apply(this,arguments)}function C(){return C=o()(u()().mark(function d(m){return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,P.request)("/api/app/image/tag-add",{method:"POST",data:m}));case 1:case"end":return n.stop()}},d)})),C.apply(this,arguments)}function c(d){return D.apply(this,arguments)}function D(){return D=o()(u()().mark(function d(m){return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,P.request)("/api/app/image/tag-delete",{method:"POST",data:m}));case 1:case"end":return n.stop()}},d)})),D.apply(this,arguments)}function F(d){return f.apply(this,arguments)}function f(){return f=o()(u()().mark(function d(m){return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,P.request)("/api/app/image/export",{method:"POST",data:m,responseType:"blob"}));case 1:case"end":return n.stop()}},d)})),f.apply(this,arguments)}function O(d){return p.apply(this,arguments)}function p(){return p=o()(u()().mark(function d(m){return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,P.request)("/api/pro/image/get-remote-tag",{method:"POST",data:m}));case 1:case"end":return n.stop()}},d)})),p.apply(this,arguments)}function b(d){return y.apply(this,arguments)}function y(){return y=o()(u()().mark(function d(m){return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,P.request)("/api/app/image/check-upgrade",{method:"POST",data:m}));case 1:case"end":return n.stop()}},d)})),y.apply(this,arguments)}function $(d){return z.apply(this,arguments)}function z(){return z=o()(u()().mark(function d(m){return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,P.request)("/api/pro/image/get-rootfs",{method:"POST",data:m}));case 1:case"end":return n.stop()}},d)})),z.apply(this,arguments)}}}]);
