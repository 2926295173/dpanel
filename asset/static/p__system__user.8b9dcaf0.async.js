"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2958],{80821:function(ue,W,r){r.d(W,{Z:function(){return _}});var G=r(5574),u=r.n(G),A=r(24963),p=r(86738),B=r(28036),j=r(83062),Y=r(67294),V=r(85893);function _(i){var ie=(0,Y.useState)(!1),X=u()(ie,2),Q=X[0],k=X[1],q=(0,Y.useContext)(A.Z),T=q.lang,ee=q.notice,c=q.message,re=function(){k(!0);var ne=i.action();ne instanceof Promise?ne.then(function(M){if(k(!1),M){typeof i.onSuccess=="function"&&i.onSuccess(M);var $="";i.messageSuccess?typeof i.messageSuccess=="function"?$=i.messageSuccess(M):$=i.messageSuccess.indexOf("notification.")==0?T(i.messageSuccess):i.messageSuccess:$=T("notification.finish"),i.asynced?c.info($):c.success($)}}).catch(function(M){k(!1),typeof i.onError=="function"&&i.onError(M)}):k(!1)};return i.confirm?(0,V.jsx)(p.Z,{style:{width:500},title:i.confirmTitle?i.confirmTitle:T("notification.title.tip"),description:typeof i.confirm=="string"&&i.confirm.indexOf("notification.")==0?T(i.confirm):i.confirm,onConfirm:re,okText:"Yes",cancelText:"No",onOpenChange:i.confirmOnOpenChange,children:(0,V.jsx)(B.ZP,{block:i.block,disabled:i.disabled,icon:i.icon,loading:Q,danger:i.danger,type:i.type,children:i.children})}):(0,V.jsx)(j.Z,{title:i.tips,children:(0,V.jsx)(B.ZP,{block:i.block,style:i.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:i.disabled,icon:i.icon,loading:Q,onClick:re,danger:i.danger,type:i.type,children:i.children})})}},24963:function(ue,W,r){var G=r(67294),u=(0,G.createContext)({});W.Z=u},76718:function(ue,W,r){r.r(W),r.d(W,{default:function(){return Me}});var G=r(15009),u=r.n(G),A=r(99289),p=r.n(A),B=r(80821),j=r(68602),Y=r(67255),V=r(36693),_=r(43425),i=r(88641),ie=r(90078),X=r(78099),Q=r(66309),k=r(42075),q=r(96074),T=r(25593),ee=r(83062),c=r(67294),re=r(5574),O=r.n(re),ne=r(28036),M=r(184),$=r(5966),oe=r(64317),ve=r(52688),he=r(90672),t=r(85893),ge=(0,c.forwardRef)(function(y,U){var I=(0,c.useState)(!1),w=O()(I,2),x=w[0],S=w[1],f=(0,c.useRef)();(0,c.useImperativeHandle)(U,function(){return{edit:function(n){var e;(e=f.current)===null||e===void 0||e.setFieldsValue({username:n.username}),S(!0)},show:function(){var n;(n=f.current)===null||n===void 0||n.resetFields(),S(!0)}}}),c.useEffect(function(){if(x){var s;(s=f.current)===null||s===void 0||s.resetFields()}},[x,f]);var a=function(){var s=p()(u()().mark(function n(){var e,d;return u()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,(e=f.current)===null||e===void 0?void 0:e.validateFields();case 3:return d=l.sent,l.next=6,y.onSubmit({username:d.username,userRole:d.userRole||"member",email:d.email,userStatus:d.userStatus||"enable",securityPassword:d.securityPassword||!0});case 6:return l.abrupt("return",!0);case 9:return l.prev=9,l.t0=l.catch(0),l.abrupt("return",!1);case 12:case"end":return l.stop()}},n,null,[[0,9]])}));return function(){return s.apply(this,arguments)}}();return(0,t.jsxs)(M.a,{name:"create",title:"\u6DFB\u52A0\u7528\u6237",open:x,onOpenChange:function(n){if(!n){var e;(e=f.current)===null||e===void 0||e.resetFields()}S(n)},drawerProps:{forceRender:!0},formRef:f,trigger:(0,t.jsx)(ne.ZP,{type:"primary",children:"\u6DFB\u52A0\u7528\u6237"}),onFinish:p()(u()().mark(function s(){return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},s)})),children:[(0,t.jsx)($.Z,{label:"\u7528\u6237\u540D",name:"username",required:!0,rules:[{required:!0}]}),(0,t.jsx)($.Z,{label:"\u90AE\u7BB1",name:"email",placeholder:"",rules:[{type:"email",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740"}]}),(0,t.jsx)(oe.Z,{label:"\u89D2\u8272",name:"userRole",tooltip:"\u7BA1\u7406\u5458\u9ED8\u8BA4\u5177\u6709\u9664\u3010\u7CFB\u7EDF\u3011\u5916\u7684\u6240\u6709\u6743\u9650\uFF0C\u64CD\u4F5C\u5458\u9ED8\u8BA4\u6743\u9650\u4E3A\u7A7A",required:!0,fieldProps:{defaultValue:"member"},options:[{label:"\u7BA1\u7406\u5458",value:"manager"},{label:"\u64CD\u4F5C\u5458",value:"member"}]}),(0,t.jsx)(oe.Z,{label:"\u72B6\u6001",name:"userStatus",fieldProps:{defaultValue:"enable"},required:!0,options:[{label:"\u542F\u7528",value:"enable"},{label:"\u7981\u7528",value:"disable"}]}),(0,t.jsx)(ve.Z,{label:"\u5F3A\u5BC6\u7801",name:"securityPassword",fieldProps:{defaultChecked:!0}}),(0,t.jsx)(he.Z,{label:"\u5907\u6CE8",name:"remark",placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",fieldProps:{rows:4}})]})}),Se=ge,Re=r(19632),le=r.n(Re),pe=r(38345),je=r(63434),ye=r(71230),Ce=r(15746),Pe=r(84567),F=r(83403),Ee=r(85265),be=r(82346),xe=(0,c.forwardRef)(function(y,U){(0,c.useImperativeHandle)(U,function(){return{show:function(g){return p()(u()().mark(function C(){var E,P,b,K,fe,H,me;return u()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return b=g.username,K=g.uri,(E=o.current)===null||E===void 0||E.resetFields(),S(b),n(K),L.next=6,(0,j.q4)({username:b});case 6:if(fe=L.sent,H=(P=fe.data)===null||P===void 0||(P=P.permissions)===null||P===void 0?void 0:P[K],!H){L.next=16;break}return L.next=11,(0,be.request)(H.uri,{method:"POST"});case 11:me=L.sent,z(me.data.list.filter(function(se){return H.value.includes(se[H.key])}).map(function(se){return{id:se[H.key],name:se[H.showKey]}})),R(H),L.next=17;break;case 16:z([]);case 17:l(!0);case 18:case"end":return L.stop()}},C)}))()}}});var I=(0,c.useState)(""),w=O()(I,2),x=w[0],S=w[1],f=(0,c.useState)(""),a=O()(f,2),s=a[0],n=a[1],e=(0,c.useState)(!1),d=O()(e,2),m=d[0],l=d[1],o=(0,c.useRef)(),D=(0,c.useRef)(),J=(0,c.useState)([]),N=O()(J,2),te=N[0],z=N[1],ae=(0,c.useState)(),Z=O()(ae,2),v=Z[0],R=Z[1];return(0,t.jsx)(Ee.Z,{title:"\u6743\u9650\u8BBE\u7F6E",open:m,width:800,destroyOnClose:!0,onClose:function(){var g;(g=o.current)===null||g===void 0||g.resetFields(),l(!1)},children:(0,t.jsx)(X.Z,{actionRef:D,search:!1,toolBarRender:!1,scroll:{x:"max-content"},columns:[{key:"name",title:"\u540D\u79F0",dataIndex:"name"}],rowKey:"id",dataSource:te,rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},tableAlertOptionRender:function(g){var C=g.selectedRows;return(0,t.jsx)(k.Z,{size:16,wrap:!0,children:(0,t.jsx)(B.Z,{danger:!0,type:"primary",action:p()(u()().mark(function E(){return u()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,(0,j.V9)({username:x,permission:{uri:s,key:"-",value:C.map(function(K){return K.id}),showKey:"-"}});case 2:return b.abrupt("return",!0);case 3:case"end":return b.stop()}},E)})),onSuccess:function(){return l(!1),!0},confirm:"notification.confirm.title",children:"\u6279\u91CF\u5220\u9664"})})},pagination:!1})})}),ce=xe,Ze=r(24963),Oe=r(34646),we=r(60433),de=r(25449),De=r(31199),Ae=(0,c.forwardRef)(function(y,U){(0,c.useImperativeHandle)(U,function(){return{show:function(m){return p()(u()().mark(function l(){var o,D;return u()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:D=m.formData,(o=e.current)===null||o===void 0||o.resetFields(),n(D),S(!0);case 4:case"end":return N.stop()}},l)}))()}}});var I=(0,c.useState)(!1),w=O()(I,2),x=w[0],S=w[1],f=(0,c.useState)({}),a=O()(f,2),s=a[0],n=a[1],e=(0,c.useRef)();return(0,t.jsxs)(M.a,{title:"\u6743\u9650\u8BBE\u7F6E",open:x,width:800,formRef:e,onFinish:function(){var d=p()(u()().mark(function m(l){return u()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return y.onChange(l),S(!1),D.abrupt("return",!0);case 3:case"end":return D.stop()}},m)}));return function(m){return d.apply(this,arguments)}}(),initialValues:s,drawerProps:{destroyOnClose:!0,onClose:function(){var m;(m=e.current)===null||m===void 0||m.resetFields(),S(!1)}},children:[(0,t.jsx)(De.Z,{name:"limit",label:"\u5BB9\u5668\u6570\u91CF",min:0}),(0,t.jsx)($.Z,{name:"name",hidden:!0})]})}),Fe=Ae,Ie=(0,c.forwardRef)(function(y,U){(0,c.useImperativeHandle)(U,function(){return{edit:function(v){return p()(u()().mark(function R(){var h,g,C;return u()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return(h=a.current)===null||h===void 0||h.setFieldValue("username",v),P.next=3,(0,j.J5)({username:v});case 3:g=P.sent,g.data.resource?(C={},g.data.resource.forEach(function(b){C[b.name]=b}),ae(C)):ae({}),g.data.menus?(g.data.menus.map(function(b){var K;(K=a.current)===null||K===void 0||K.setFieldValue(["permission",b],!0)}),J([].concat(le()(g.data.menus||[]),le()(F.Io)))):J(F.Io),f(!0);case 7:case"end":return P.stop()}},R)}))()}}});var I={canSeeContainerList:F.W6.CONTAINER,canSeeImageRegistry:F.W6.REGISTRY,canSeeComposeList:F.W6.COMPOSE,canSeeSystemAppstore:F.W6.APPSTORE,canSeeSystemEnv:F.W6.DOCKER_ENV},w=(0,c.useState)(!1),x=O()(w,2),S=x[0],f=x[1],a=(0,c.useRef)(),s=(0,c.useContext)(Ze.Z),n=s.message,e=s.lang,d=(0,c.useRef)(),m=(0,c.useRef)(),l=(0,c.useState)([]),o=O()(l,2),D=o[0],J=o[1],N=(0,c.useState)({}),te=O()(N,2),z=te[0],ae=te[1];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(M.a,{title:"\u6743\u9650\u8BBE\u7F6E",open:S,onOpenChange:function(v){var R;!v&&((R=a.current)===null||R===void 0||R.resetFields()),f(v)},drawerProps:{forceRender:!0},layout:"inline",formRef:a,onValuesChange:function(v,R){var h=Object.keys(v.permission)[0];if(v.permission[h]===!1){for(var g in R.permission)if(g.startsWith(h)){var C;(C=a.current)===null||C===void 0||C.setFieldValue(["permission",g],!1)}}J(Object.keys(R.permission).filter(function(E){return R.permission[E]}))},onFinish:function(){var Z=p()(u()().mark(function v(R){var h;return u()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return h=R.permission&&Object.keys(R.permission).filter(function(E){return R.permission[E]&&!F.Io.includes(E)}),h.push.apply(h,le()(F.Io.filter(function(E){return h.some(function(P){return P.startsWith(E)})}))),C.next=4,(0,j.SS)({username:R.username,menuPermissionNames:h,resources:Object.values(z)});case 4:return C.abrupt("return",!0);case 5:case"end":return C.stop()}},v)}));return function(v){return Z.apply(this,arguments)}}(),children:[(0,t.jsx)(ce,{ref:d}),(0,t.jsx)($.Z,{name:"username",hidden:!0}),F.d0.map(function(Z){return(0,t.jsxs)(pe.Z,{headerBordered:!0,ghost:!0,bodyStyle:{paddingTop:10,paddingBottom:20},title:(0,t.jsx)(Oe.Z,{}),subTitle:e("system.user.permissions.".concat(Z.group)),children:[(0,t.jsx)(je.Z,{name:["permission",Z.group],valuePropName:"checked",initialValue:!0,hidden:!0}),(0,t.jsx)(ye.Z,{gutter:[16,16],children:Z.permissions.map(function(v){return(0,t.jsx)(Ce.Z,{span:6,children:(0,t.jsxs)(de.Z,{children:[(0,t.jsx)(de.Z,{noStyle:!0,name:["permission",v],valuePropName:"checked",children:(0,t.jsx)(Pe.Z,{disabled:!D.includes(v.substring(0,v.search(/[A-Z][^A-Z]*$/))),children:e("system.user.permissions.".concat(v))})}),I[v]&&(0,t.jsx)(ee.Z,{title:"\u67E5\u770B\u6570\u636E\u6743\u9650",children:(0,t.jsx)(T.Z.Link,{onClick:function(){var h,g;(h=d.current)===null||h===void 0||h.show({username:((g=a.current)===null||g===void 0?void 0:g.getFieldValue("username"))||"",uri:I[v]||""})},children:(0,t.jsx)(we.Z,{})})}),["canSeeContainerListManageCreate"].includes(v)&&(0,t.jsx)(ee.Z,{title:"\u914D\u7F6E\u8D44\u6E90\u6743\u9650",children:(0,t.jsx)(T.Z.Link,{onClick:function(){var h;(h=m.current)===null||h===void 0||h.show({formData:z[v]||{name:v,limit:0}})},children:(0,t.jsx)(_.Z,{})})})]})},v)})})]},Z.group)})]}),(0,t.jsx)(ce,{ref:d}),(0,t.jsx)(Fe,{onChange:function(v){var R;z[v.name]=v,(0,j.SS)({username:((R=a.current)===null||R===void 0?void 0:R.getFieldValue("username"))||"",menuPermissionNames:D,resources:Object.values(z)})},resourcePermissionsData:z,ref:m})]})}),Be=Ie,$e=r(5251),Te=r(87662);function Me(){var y=(0,c.useRef)(),U=(0,c.useRef)(),I=(0,c.useRef)(),w=function(){var S=p()(u()().mark(function f(a){var s,n,e,d;return u()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,(0,j.mX)(a);case 2:if(e=l.sent,a.userRole==="manager"&&(0,j.SS)({username:a.username,menuPermissionNames:F.Wy}),a.userStatus==="disable"&&(0,j.az)({username:a.username,status:1}),!a.email){l.next=10;break}return l.next=8,(0,Te.pe)({groupName:"setting",name:"emailServer"});case 8:d=l.sent,d.data.setting.value.emailServer&&d.data.setting.value.emailServer.status&&x({username:a.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(e.data.token)});case 10:return!((s=y.current)===null||s===void 0)&&s.reloadAndRest&&((n=y.current)===null||n===void 0||n.reloadAndRest()),l.abrupt("return",!0);case 12:case"end":return l.stop()}},f)}));return function(a){return S.apply(this,arguments)}}(),x=function(){var S=p()(u()().mark(function f(a){return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:(0,j.sI)(a);case 1:case"end":return n.stop()}},f)}));return function(a){return S.apply(this,arguments)}}();return(0,t.jsxs)(ie._z,{header:{extra:[(0,t.jsx)(Se,{ref:U,onSubmit:w},"invite-user")]},children:[(0,t.jsx)(Be,{ref:I}),(0,t.jsx)(X.Z,{scroll:{x:"max-content"},rowKey:"username",columns:[{title:"\u7528\u6237\u540D",ellipsis:!0,dataIndex:"username"},{title:"\u90AE\u7BB1",ellipsis:!0,dataIndex:"email"},{title:"\u89D2\u8272",ellipsis:!0,width:100,dataIndex:"userRole",valueEnum:{manager:{text:"\u7BA1\u7406\u5458",status:"manager"},member:{text:"\u64CD\u4F5C\u5458",status:"member"}},render:function(f,a){return(0,t.jsx)(Q.Z,{color:a.userRole==="member"?"gold":"blue",children:a.userRole==="member"?"\u64CD\u4F5C\u5458":"\u7BA1\u7406\u5458"})}},{title:"\u6CE8\u518C\u65F6\u95F4",ellipsis:!0,render:function(f,a,s,n){return(0,t.jsx)("div",{children:(0,$e.ZM)(a.registerAt*1e3)},a.username)},search:!1},{title:"\u5907\u6CE8",ellipsis:!0,dataIndex:"remark",search:!1},{title:"\u72B6\u6001",width:100,dataIndex:"status",valueEnum:{1:{text:"\u7981\u7528",status:"error"},2:{text:"\u6B63\u5E38",status:"success"}},search:!1,render:function(f,a){return(0,t.jsx)(Q.Z,{color:a.status===2?"green":"red",children:a.status===2?"\u6B63\u5E38":"\u7981\u7528"})}},{title:"\u64CD\u4F5C",width:100,search:!1,fixed:"right",render:function(f,a,s){return(0,t.jsxs)(k.Z,{split:(0,t.jsx)(q.Z,{type:"vertical"}),children:[(0,t.jsx)(T.Z.Link,{copyable:{tooltips:"\u590D\u5236\u91CD\u7F6E\u94FE\u63A5",icon:[(0,t.jsx)(V.Z,{})],text:function(){var n=p()(u()().mark(function d(){var m;return u()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,j.u1)({username:a.username});case 2:return m=o.sent,o.abrupt("return","".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(m.data.token));case 4:case"end":return o.stop()}},d)}));function e(){return n.apply(this,arguments)}return e}()},style:{color:"inherit"}},"copy-"+s),(0,t.jsx)(ee.Z,{title:"\u7528\u6237\u6743\u9650\u8BBE\u7F6E",children:(0,t.jsx)(T.Z.Link,{onClick:function(){var e;(e=I.current)===null||e===void 0||e.edit(a.username)},children:(0,t.jsx)(_.Z,{})})}),(0,t.jsx)(B.Z,{ghost:!0,type:"link",tips:"\u53D1\u9001\u91CD\u7F6E\u94FE\u63A5\u5230\u90AE\u7BB1",icon:(0,t.jsx)(i.Z,{}),action:p()(u()().mark(function n(){var e;return u()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,(0,j.u1)({username:a.username});case 2:return e=m.sent,m.abrupt("return",x({username:a.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(e.data.token)}));case 4:case"end":return m.stop()}},n)}))})]})}}],request:function(){var S=p()(u()().mark(function f(a){var s;return u()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,j.lE)();case 2:return s=e.sent,e.abrupt("return",{data:s.data.list,success:!0,total:s.data.list.length});case 4:case"end":return e.stop()}},f)}));return function(f){return S.apply(this,arguments)}}(),rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},actionRef:y,tableAlertOptionRender:function(f){var a=f.selectedRowKeys;return(0,t.jsxs)(k.Z,{size:16,children:[(0,t.jsx)(B.Z,{action:p()(u()().mark(function s(){var n,e,d,m;return u()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:n=0,e=a;case 1:if(!(n<e.length)){o.next=9;break}return d=e[n],o.next=5,(0,j.az)({username:d,status:2});case 5:m=o.sent;case 6:n++,o.next=1;break;case 9:return o.abrupt("return",!0);case 10:case"end":return o.stop()}},s)})),onSuccess:function(){var n,e;return!((n=y.current)===null||n===void 0)&&n.reloadAndRest&&((e=y.current)===null||e===void 0||e.reloadAndRest()),!0},onError:function(){var n,e;return!((n=y.current)===null||n===void 0)&&n.reset&&((e=y.current)===null||e===void 0||e.reset()),!0},children:"\u542F\u7528"},"batchEnable"),(0,t.jsx)(B.Z,{danger:!0,action:p()(u()().mark(function s(){var n,e,d,m;return u()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:n=0,e=a;case 1:if(!(n<e.length)){o.next=9;break}return d=e[n],o.next=5,(0,j.az)({username:d,status:1});case 5:m=o.sent;case 6:n++,o.next=1;break;case 9:return o.abrupt("return",!0);case 10:case"end":return o.stop()}},s)})),onSuccess:function(){var n,e;return!((n=y.current)===null||n===void 0)&&n.reloadAndRest&&((e=y.current)===null||e===void 0||e.reloadAndRest()),!0},onError:function(){var n,e;return!((n=y.current)===null||n===void 0)&&n.reset&&((e=y.current)===null||e===void 0||e.reset()),!0},children:"\u7981\u7528"},"batchDisable")]})},pagination:(0,Y.O)()})]})}},67255:function(ue,W,r){r.d(W,{O:function(){return G},j:function(){return u}});function G(){var A=localStorage.getItem("dpanel-pagesize");return A=="all"?!1:{showSizeChanger:!0,defaultPageSize:parseInt(A!=null?A:"20")}}function u(A){var p="dpanel-table-column-".concat(A),B={};if(localStorage.getItem(p)){var j;B=JSON.parse((j=localStorage.getItem(p))!==null&&j!==void 0?j:"{}")}return{defaultValue:B,onChange:function(V){localStorage.setItem("dpanel-table-column-".concat(A),JSON.stringify(V))}}}}}]);
