"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2628],{54958:function(X,Z,e){e.r(Z),e.d(Z,{default:function(){return Q}});var O=e(15009),F=e.n(O),$=e(99289),L=e.n($),B=e(22191),j=e(24963),u=e(67294);function D(i){var v=(0,u.useContext)(j.Z),f=v.lang;return i.expression.unit=="preWeek"?"".concat(f("cron.week.".concat(i.expression.dayOfWeek),i.expression)).concat(f("cron.".concat(i.expression.unit),i.expression)):f("cron.".concat(i.expression.unit),i.expression)}var I=e(5574),S=e.n(I),C=e(83727),E=e(184),K=e(14726),z=e(63490),x=e(42075),m=e(25593),N=e(55241),n=e(85893),P=(0,u.forwardRef)(function(i,v){var f=(0,u.useState)(!1),g=S()(f,2),p=g[0],R=g[1],l=(0,u.useState)([]),r=S()(l,2),t=r[0],c=r[1],d=(0,u.useContext)(j.Z),a=d.lang;return(0,u.useImperativeHandle)(v,function(){return{}}),(0,u.useEffect)(function(){(0,C.VB)().then(function(o){c(o.data.list)})},[]),(0,n.jsx)(E.a,{name:"templte",title:"\u8BA1\u5212\u4EFB\u52A1\u811A\u672C\u6A21\u677F",open:p,onOpenChange:function(s){R(s)},submitter:!1,trigger:(0,n.jsx)(K.ZP,{children:"\u811A\u672C\u6A21\u677F"}),children:(0,n.jsx)(z.Z,{rowKey:"name",columns:[{title:"\u540D\u79F0",dataIndex:"name"},{title:"\u63CF\u8FF0",dataIndex:"description",render:function(s,h,U){return"".concat(h.description," ").concat(h.tag.indexOf("run-in-dpanel")?"(".concat(a("cron.runInDPanel"),")"):"")}},{title:"\u64CD\u4F5C",width:100,render:function(s,h,U){return(0,n.jsxs)(x.Z,{children:[(0,n.jsx)(m.Z.Link,{onClick:function(){R(!1),i.onFinish&&i.onFinish(h)},children:"\u4F7F\u7528"},"use"),(0,n.jsx)(N.Z,{placement:"left",content:(0,n.jsx)("pre",{children:h.script}),children:(0,n.jsx)(m.Z.Link,{children:"\u9884\u89C8"},"preview")})]})}}],dataSource:t})})}),G=P,W=e(80821),w=e(67255),H=e(86548),J=e(43425),V=e(90078),Y=e(10641),A=e(54006),T=e(66309),M=e(96074),y=e(83062);function Q(){var i=(0,u.useRef)(),v=(0,u.useRef)(),f=(0,u.useRef)(),g=(0,u.useContext)(j.Z),p=g.lang,R=(0,A.useNavigate)();return(0,n.jsx)(V._z,{header:{extra:[(0,n.jsx)(B.Z,{ref:v,onFinish:function(){var r,t;!((r=i.current)===null||r===void 0)&&r.reloadAndRest&&((t=i.current)===null||t===void 0||t.reloadAndRest())},showTriggerButton:!0},"create"),(0,n.jsx)(G,{ref:f,onFinish:function(r){var t;(t=v.current)===null||t===void 0||t.edit({title:"",setting:{script:r.script,environment:r.environment,enableRunBlock:!0,disable:!1,keepLogTotal:10}})}},"template")]},children:(0,n.jsx)(Y.Z,{scroll:{x:"max-content"},rowKey:"id",pagination:(0,w.O)(),columns:[{title:"\u540D\u79F0",dataIndex:"title",render:function(r,t,c,d,a){return(0,n.jsx)(A.Link,{to:"/app/cron/log/"+t.id,children:t.title})}},{title:"\u6267\u884C\u5BB9\u5668",dataIndex:["setting","containerName"],search:!1},{title:"\u6267\u884C\u8BA1\u5212",search:!1,width:300,render:function(r,t,c,d,a){return(0,n.jsx)(x.Z,{direction:"vertical",children:t.setting.expression&&t.setting.expression.map(function(o,s){return(0,n.jsx)(D,{expression:o},"runCron-".concat(s))})})}},{title:"\u4E0B\u6B21\u6267\u884C\u65F6\u95F4",search:!1,width:200,render:function(r,t,c,d,a){return(0,n.jsx)(x.Z,{direction:"vertical",children:t.setting.nextRunTime?t.setting.nextRunTime.map(function(o,s){return(0,n.jsx)(T.Z,{children:new Date(o).toLocaleString()},"runNextTime-".concat(s))}):(0,n.jsx)(T.Z,{color:"error",children:p("cron.error")},"runNextTime-".concat(c))})}},{title:"\u64CD\u4F5C",width:100,search:!1,render:function(r,t,c,d,a){return(0,n.jsxs)(x.Z,{split:(0,n.jsx)(M.Z,{type:"vertical"}),children:[(0,n.jsx)(m.Z.Link,{onClick:function(){var s;(s=v.current)===null||s===void 0||s.edit(t)},children:(0,n.jsx)(y.Z,{title:"\u7F16\u8F91",children:(0,n.jsx)(H.Z,{})})},"manage"),(0,n.jsx)(m.Z.Link,{onClick:function(){R("/app/cron/log/"+t.id)},children:(0,n.jsx)(y.Z,{title:"\u8BF4\u60C5",children:(0,n.jsx)(J.Z,{})})},"log")]})}}],request:function(){var l=L()(F()().mark(function r(t,c,d){var a;return F()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,C.SY)({title:t.title,page:t.current,pageSize:t.pageSize});case 2:return a=s.sent,s.abrupt("return",{data:a.data.list,success:!0,total:a.data.total});case 4:case"end":return s.stop()}},r)}));return function(r,t,c){return l.apply(this,arguments)}}(),rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},actionRef:i,tableAlertOptionRender:function(r){var t=r.selectedRowKeys,c=r.selectedRows;return(0,n.jsx)(x.Z,{size:16,children:(0,n.jsx)(W.Z,{danger:!0,type:"primary",action:function(){return(0,C.Ji)({id:c.map(function(a){return a.id})})},onSuccess:function(){var a,o;return!((a=i.current)===null||a===void 0)&&a.reloadAndRest&&((o=i.current)===null||o===void 0||o.reloadAndRest()),!0},onError:function(){var a,o;return!((a=i.current)===null||a===void 0)&&a.reset&&((o=i.current)===null||o===void 0||o.reset()),!0},messageSuccess:"\u5220\u9664\u6210\u529F",children:"\u6279\u91CF\u5220\u9664"},"delete")})}})})}}}]);
