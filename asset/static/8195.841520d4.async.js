"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8195],{77273:function(b,O,n){var p=n(15009),I=n.n(p),F=n(99289),D=n.n(F),T=n(5574),M=n.n(T),f=n(184),l=n(5966),m=n(86615),h=n(97462),d=n(52688),c=n(62370),B=n(38345),E=n(31199),L=n(90672),g=n(71230),v=n(15746),x=n(86250),R=n(38925),C=n(67294),U=n(91845),S=n(87662),o=n(12491),r=n(52756),t=n(89035),e=n(85893),P=(0,C.forwardRef)(function(K,z){var Z;(0,C.useImperativeHandle)(z,function(){return{edit:function(s){var a;(a=A.current)===null||a===void 0||a.setFieldsValue({name:s.name,title:s.title,address:s.address,serverUrl:s.serverUrl,enableTLS:s.enableTLS,tlsCa:s.tlsCa,tlsCert:s.tlsCert,tlsKey:s.tlsKey,enableComposePath:s.enableComposePath,enableSSH:s.enableSSH,sshServerInfo:s.sshServerInfo,remoteType:s.remoteType?s.remoteType:"docker"}),V(!0),G(s.name)}}});var N=(0,C.useState)(!1),H=M()(N,2),Y=H[0],V=H[1],A=(0,C.useRef)(),J=(0,C.useState)(""),w=M()(J,2),$=w[0],G=w[1];return(0,e.jsxs)(f.a,{drawerProps:{forceRender:!0},onOpenChange:function(s){if(!s){var a;G(""),(a=A.current)===null||a===void 0||a.resetFields()}V(s)},open:Y,width:800,trigger:K.trigger,formRef:A,title:(Z=A.current)!==null&&Z!==void 0&&Z.getFieldValue&&A.current.getFieldValue("name")=="local"?"\u914D\u7F6E\u9ED8\u8BA4Docker\u670D\u52A1\u7AEF":"\u6DFB\u52A0\u8FDC\u7A0BDocker\u670D\u52A1\u7AEF",onFinish:function(){var j=D()(I()().mark(function s(a){var u;return I()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return console.log(a),i.next=3,(0,S.ad)({name:a.name,title:a.title,address:a.address,serverUrl:a.serverUrl,enableTLS:a.enableTLS,tlsCa:a.tlsCa,tlsCert:a.tlsCert,tlsKey:a.tlsKey,enableComposePath:a.enableComposePath,composePath:a.enableComposePath?a.composePath:"",enableSSH:a.enableSSH||a.remoteType=="ssh",sshServerInfo:a.sshServerInfo,remoteType:a.remoteType});case 3:return u=i.sent,K.onFinish&&K.onFinish(),i.abrupt("return",!0);case 6:case"end":return i.stop()}},s)}));return function(s){return j.apply(this,arguments)}}(),children:[(0,e.jsx)(l.Z,{label:"\u540D\u79F0",name:"title",required:!0,rules:[{required:!0}],fieldProps:{id:"envTitle",onChange:function(s){var a="";if(s.target.value&&!$){var u,_=(0,U.N9)(s.target.value.trim(),{toneType:"none",type:"array"});a=_.join(""),(u=A.current)===null||u===void 0||u.setFieldValue("name",a)}}}},"envTitle"),(0,e.jsx)(l.Z,{label:"\u6807\u8BC6",name:"name",required:!0,disabled:$!="",rules:[{required:!0}],placeholder:"\u6807\u8BC6Docker\u73AF\u5883\uFF0C\u53EA\u5141\u8BB8\u4E3A\u82F1\u6587\u6216\u662F\u6570\u5B57"}),(0,e.jsx)(l.Z,{tooltip:"\u8BBE\u7F6E\u5BBF\u4E3B\u673A\u7684Ip\u6216\u662F\u57DF\u540D\uFF0C\u7528\u4E8E\u901A\u8FC7\u7AEF\u53E3\u7684\u5F62\u5F0F\u8BBF\u95EE\u5BB9\u5668\u3002\u652F\u6301IpV4\u53CAIpV6",label:"\u5BB9\u5668\u7AEF\u53E3\u8BBF\u95EE\u57DF\u540D",name:"serverUrl",placeholder:"\u4F8B\u5982:192.168.1.25\u30012001:db8:1::2\u3001example.com"}),(0,e.jsx)(m.Z.Group,{label:"\u8FDE\u63A5\u65B9\u5F0F",name:"remoteType",valueEnum:{docker:"Docker Api",ssh:"SSH"}}),(0,e.jsx)(h.Z,{name:["remoteType","name"],children:function(s){var a=s.remoteType,u=s.name;return(0,e.jsxs)(e.Fragment,{children:[a=="docker"&&(0,e.jsx)(g.Z,{children:(0,e.jsx)(v.Z,{span:24,children:(0,e.jsx)(l.Z,{label:"Docker Api \u5730\u5740",name:"address",required:!0,rules:[{required:!0}],tooltip:"\u8FDE\u63A5\u8FDC\u7A0B Docker \u65F6\u8BF7\u5148\u5F00\u542F Api \u5730\u5740\u8BBF\u95EE\u3002",placeholder:"\u4F8B\u5982\uFF1Aunix:///var/run/docker.sock\u3001tcp://192.16.0.5:2375"})})}),(0,e.jsxs)(g.Z,{gutter:[15,0],children:[a=="docker"&&(0,e.jsx)(v.Z,{children:(0,e.jsx)(d.Z,{label:"\u542F\u7528 Docker Api TLS",name:"enableTLS",tooltip:"\u751F\u6210\u6559\u7A0B\u89C1\uFF1Ahttps://donknap.github.io/dpanel-docs/#/zh-cn/manual/remote"})}),u!="local"&&typeof a!="undefined"&&(0,e.jsx)(v.Z,{children:(0,e.jsx)(d.Z,{label:(0,r.getLang)("system.env.createEnableComposePath"),name:"enableComposePath",tooltip:"\u5F00\u542F\u72EC\u7ACBcompose\u914D\u7F6E\u540E\uFF0C\u5207\u6362\u8FDC\u7A0B docker \u5BA2\u6237\u7AEF\u65F6\u5C06\u53EA\u4F1A\u8BFB\u53D6\u8BE5\u73AF\u5883\u4E13\u5C5E\u76EE\u5F55\u4E0B\u7684 compose \u4EFB\u52A1"})}),a=="docker"&&(0,e.jsx)(v.Z,{children:(0,e.jsx)(d.Z,{label:"\u542F\u7528\u5BBF\u4E3B\u673A SSH \u8FDE\u63A5",name:"enableSSH"})})]})]})}}),(0,e.jsx)(h.Z,{name:["enableTLS"],children:function(s){var a=s.enableTLS;if(a)return(0,e.jsxs)(x.Z,{gap:10,justify:"start",children:[(0,e.jsx)(c.Z,{name:"tlsCa",label:"\u4E0A\u4F20\u5BA2\u6237\u7AEF\u8BC1\u4E66",children:(0,e.jsx)(o.Z,{title:"ca.pem",onImport:function(_){var i;return(i=A.current)===null||i===void 0||i.setFieldValue("tlsCa",_),!0},onLoad:function(_){if(_.indexOf("CERTIFICATE")<0)throw new Error("\u5BFC\u5165ca.pem\u8BC1\u4E66\u9519\u8BEF");return!0}})}),(0,e.jsx)(c.Z,{name:"tlsCert",label:" ",children:(0,e.jsx)(o.Z,{title:"cert.pem",onImport:function(_){var i;return(i=A.current)===null||i===void 0||i.setFieldValue("tlsCert",_),!0},onLoad:function(_){if(_.indexOf("CERTIFICATE")<0)throw new Error("\u5BFC\u5165cert.pem\u8BC1\u4E66\u9519\u8BEF");return!0}})}),(0,e.jsx)(c.Z,{label:" ",name:"tlsKey",children:(0,e.jsx)(o.Z,{title:"key.pem",onImport:function(_){var i;return(i=A.current)===null||i===void 0||i.setFieldValue("tlsKey",_),!0},onLoad:function(_){if(_.indexOf("PRIVATE")<0)throw new Error("\u5BFC\u5165key.pem\u8BC1\u4E66\u9519\u8BEF");return!0}})})]})}}),(0,e.jsx)(h.Z,{name:["enableComposePath","name"],children:function(s){var a=s.enableComposePath,u=s.name;if(a)return(0,e.jsx)(l.Z,{label:(0,r.getLang)("system.env.createComposePath"),name:"composePath",disabled:!0,fieldProps:{value:"/dpanel/compose/compose-".concat(u!=null?u:"")}})}}),(0,e.jsx)(h.Z,{name:["enableSSH","sshServerInfo","remoteType"],children:function(s){var a=s.enableSSH,u=s.sshServerInfo,_=s.remoteType;return(a||_=="ssh")&&[(0,e.jsxs)(B.Z,{title:(0,e.jsx)(t.Z,{}),subTitle:"\u4E3B\u673ASSH",ghost:!0,children:[_=="ssh"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(c.Z,{children:(0,e.jsx)(R.Z,{message:(0,e.jsxs)(e.Fragment,{children:[(0,r.getLang)("system.env.remoteSSHTips")," ",(0,e.jsx)("a",{href:"https://dpanel.cc/#/zh-cn/manual/setting/docker-env?id=%e9%80%9a%e8%bf%87-ssh-%e6%b7%bb%e5%8a%a0",target:"_blank",children:(0,r.getLang)("notification.help")})]})})}),(0,e.jsx)(l.Z,{label:"\u4E3B\u673AIP\u5730\u5740",placeholder:"\u8F93\u5165\u4E3B\u673A\u7684IP\u8FDE\u63A5\u5730\u5740",name:"address"})]}),(0,e.jsxs)(g.Z,{children:[(0,e.jsx)(v.Z,{children:(0,e.jsx)(E.Z,{initialValue:22,label:"\u7AEF\u53E3",name:["sshServerInfo","port"]})}),(0,e.jsx)(v.Z,{offset:2,children:(0,e.jsx)(m.Z.Group,{label:"\u9A8C\u8BC1\u65B9\u5F0F",name:["sshServerInfo","authType"],valueEnum:{basic:"\u5BC6\u7801\u8BA4\u8BC1",pem:"\u79C1\u94A5\u8BA4\u8BC1"}})})]}),u&&u.authType=="basic"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.Z,{label:"\u7528\u6237\u540D",name:["sshServerInfo","username"]}),(0,e.jsx)(l.Z.Password,{label:"\u5BC6\u7801",name:["sshServerInfo","password"]})]}),u&&u.authType=="pem"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(l.Z,{label:"\u7528\u6237\u540D",name:["sshServerInfo","username"]}),(0,e.jsx)(o.Z,{title:"\u5BFC\u5165\u5BC6\u94A5\u6587\u4EF6",onImport:function(W){var y;return(y=A.current)===null||y===void 0||y.setFieldValue(["sshServerInfo","privateKey"],W),!0},onLoad:function(W){if(!W.includes("PRIVATE KEY"))throw new Error((0,r.getLang)("system.env.sshImportKeyFileIncorrect"));return!0}}),(0,e.jsx)(L.Z,{name:["sshServerInfo","privateKey"],label:"\u5BC6\u94A5"}),(0,e.jsx)(l.Z.Password,{name:["sshServerInfo","password"],label:"\u5BC6\u94A5\u5BC6\u7801"})]})]},"sshSetting")]}})]})});O.Z=P},12491:function(b,O,n){n.d(O,{Z:function(){return l}});var p=n(24963),I=n(88484),F=n(62370),D=n(31418),T=n(28036),M=n(67294),f=n(85893);function l(m){var h=(0,M.useContext)(p.Z),d=h.message,c=h.notice,B=h.lang,E=(0,M.useRef)(null),L=D.Z.useApp(),g=function(){E.current&&(E.current.click(),E.current.onchange=function(x){if(!x||!x.target)return"";var R=new FileReader;R.onload=function(U){var S,o,r=(S=U.target)===null||S===void 0?void 0:S.result;if(m.onLoad)try{m.onLoad&&m.onLoad(r)}catch(t){c.error(t);return}typeof m.onImport=="function"&&(d.success("\u6210\u529F\u5BFC\u5165 ".concat(m.title)),m.onImport(r)),(o=E.current)!==null&&o!==void 0&&o.value&&(E.current.value="")};var C=x.target;if(C.files)try{R.readAsText(C.files[0])}catch(U){c.error("\u5BFC\u5165\u6587\u4EF6\u5FC5\u987B\u662F\u6587\u672C\u7C7B\u578B")}})};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(F.Z,{children:(0,f.jsx)(T.ZP,{icon:(0,f.jsx)(I.Z,{}),block:!0,onClick:g,children:m.title})}),(0,f.jsx)("input",{style:{display:"none"},type:"file",ref:E,name:"importFileInput"})]})}},52756:function(b,O,n){n.r(O),n.d(O,{default:function(){return h},getLang:function(){return m}});var p=n(82346),I=n(31418),F=n(26058),D=n(85137),T=n(24963),M=n(65913),f=n(67294),l=n(85893);function m(d,c){return(0,p.getIntl)((0,p.getLocale)()).formatMessage({id:d},c)}function h(){var d=(0,f.useRef)(),c=(0,p.useIntl)(),B=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),P=1;P<t;P++)e[P-1]=arguments[P];L.notification[r]({message:c.formatMessage({id:"notification.title."+r}),description:e.join(" "),placement:"topRight"})},E=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),P=1;P<t;P++)e[P-1]=arguments[P];L.message[r](e.join(" "))},L=I.Z.useApp(),g=(0,p.useModel)("@@initialState"),v=g.initialState,x=g.loading,R=g.error,C=g.refresh,U=g.setInitialState,S=(0,p.useModel)("subscriber");return v!=null&&v.user.username&&S.addDataHandler("user:permission:".concat(v==null?void 0:v.user.username),function(o){C()}),(0,l.jsx)(F.Z,{children:(0,l.jsx)(T.Z.Provider,{value:{notice:{success:function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];B.apply(void 0,["success"].concat(t))},error:function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];B.apply(void 0,["error"].concat(t))},warning:function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];B.apply(void 0,["warning"].concat(t))},info:function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];B.apply(void 0,["info"].concat(t))},destroy:function(){L.notification.destroy()}},message:{success:function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];E.apply(void 0,["success"].concat(t))},error:function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];E.apply(void 0,["error"].concat(t))},warning:function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];E.apply(void 0,["warning"].concat(t))},info:function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];E.apply(void 0,["info"].concat(t))},loading:function(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++)t[e]=arguments[e];E.apply(void 0,["loading"].concat(t))},destroy:function(){L.message.destroy()}},loading:{show:function(){d.current&&d.current.show()},destroy:function(){d.current&&d.current.destroy()}},lang:function(r,t){return c.formatMessage({id:r},t)}},children:(0,l.jsxs)(M.Z,{ref:d,children:[(0,l.jsx)(p.Outlet,{}),(0,l.jsx)(D.Z.BackTop,{duration:10,style:{bottom:100}})]})},x?"1":"2")})}},65913:function(b,O,n){var p=n(5574),I=n.n(p),F=n(74330),D=n(67294),T=n(85893),M=(0,D.forwardRef)(function(f,l){(0,D.useImperativeHandle)(l,function(){return{show:function(){c(!0)},destroy:function(){c(!1)}}});var m=(0,D.useState)(!1),h=I()(m,2),d=h[0],c=h[1];return(0,T.jsx)(F.Z,{spinning:d,size:"default",children:f.children})});O.Z=M}}]);
