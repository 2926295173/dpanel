"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2958],{80821:function(ce,K,e){e.d(K,{Z:function(){return B}});var V=e(97857),l=e.n(V),_=e(5574),b=e.n(_),ae=e(24963),se=e(36146),ie=e(86738),z=e(83062),k=e(96074),c=e(83622),h=e(67294),C=e(85893);function B(n){var ue=(0,h.useState)(!1),q=b()(ue,2),ee=q[0],X=q[1],me=(0,h.useContext)(ae.Z),re=me.message,Y=new se.Uo,d=function(){X(!0);var x=n.action();x instanceof Promise?x.then(function(ne){if(X(!1),ne){typeof n.onSuccess=="function"&&n.onSuccess(ne);var N="";n.messageSuccess?typeof n.messageSuccess=="function"?N=n.messageSuccess(ne):N=n.messageSuccess.indexOf("notification.")==0?Y.format(n.messageSuccess):n.messageSuccess:N=Y.format("notification.finish"),n.asynced?re.info(N):re.success(N)}}).catch(function(ne){X(!1),typeof n.onError=="function"&&n.onError(ne)}):X(!1)};return n.confirm?(0,C.jsx)(ie.Z,l()(l()({style:{width:500},title:n.confirmTitle?n.confirmTitle:Y.format("notification.title.tip"),description:typeof n.confirm=="string"&&n.confirm.indexOf("notification.")==0?Y.format(n.confirm):n.confirm,onConfirm:d,okText:"Yes",cancelText:"No",onOpenChange:n.confirmOnOpenChange},n.confirmProps),{},{children:(0,C.jsxs)(z.Z,{title:n.tips,children:[n.showDivider&&(0,C.jsx)(k.Z,{type:"vertical",style:{marginRight:15}}),(0,C.jsx)(c.ZP,{block:n.block,disabled:n.disabled,icon:!n.children&&ee?void 0:n.icon,loading:ee,danger:n.danger,type:n.type,children:n.children})]})})):(0,C.jsxs)(z.Z,{title:n.tips,children:[n.showDivider&&(0,C.jsx)(k.Z,{type:"vertical",style:{marginRight:15}}),(0,C.jsx)(c.ZP,{block:n.block,style:n.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:n.disabled,icon:!n.children&&ee?void 0:n.icon,loading:ee,onClick:d,danger:n.danger,type:n.type,children:n.children})]})}},3616:function(ce,K,e){e.d(K,{Ed:function(){return b},FK:function(){return l},R_:function(){return V},ob:function(){return _}});var V=window.innerWidth<=1024?"90vw":"65vw",l="90vw",_="60vw",b="50vh"},24963:function(ce,K,e){var V=e(67294),l=(0,V.createContext)({});K.Z=l},59549:function(ce,K,e){e.r(K),e.d(K,{default:function(){return Ve}});var V=e(15009),l=e.n(V),_=e(99289),b=e.n(_),ae=e(9783),se=e.n(ae),ie=e(19632),z=e.n(ie),k=e(80821),c=e(68602),h=e(67255),C=e(36693),B=e(43425),n=e(88641),ue=e(90078),q=e(56729),ee=e(66309),X=e(42075),me=e(96074),re=e(25593),Y=e(83062),d=e(67294),ve=e(5574),x=e.n(ve),ne=e(83622),N=e(184),de=e(5966),he=e(64317),Pe=e(52688),pe=e(90672),le=e(3616),F=e(83403),ye=e(87662),T=e(36146),r=e(85893),be=(0,d.forwardRef)(function(O,H){var $=(0,d.useState)(!1),g=x()($,2),S=g[0],R=g[1],u=(0,d.useRef)(),i=new T.Uo("components.userInvite"),s=new T.Uo("system.user");(0,d.useImperativeHandle)(H,function(){return{edit:function(o){var m;(m=u.current)===null||m===void 0||m.setFieldsValue({username:o.username}),R(!0)},show:function(){var o;(o=u.current)===null||o===void 0||o.resetFields(),R(!0)}}}),d.useEffect(function(){if(S){var f;(f=u.current)===null||f===void 0||f.resetFields()}},[S,u]);var t=function(){var f=b()(l()().mark(function o(){var m,a,E,U,D,G;return l()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.prev=0,j.next=3,(m=u.current)===null||m===void 0?void 0:m.validateFields();case 3:return a=j.sent,E={username:a.username,userRole:a.userRole||"member",email:a.email,userStatus:a.userStatus||"enable",securityPassword:a.securityPassword||!0},j.next=7,(0,c.mX)(E);case 7:if(U=j.sent,E.userRole==="manager"&&(0,c.SS)({username:E.username,menuPermissionNames:F.Wy}),E.userStatus==="disable"&&(0,c.az)({username:E.username,status:1}),!E.email){j.next=15;break}return j.next=13,(0,ye.pe)({groupName:"setting",name:"emailServer"});case 13:G=j.sent,(D=G.data)!==null&&D!==void 0&&(D=D.status)!==null&&D!==void 0&&D.includes("register")&&(0,c.sI)({username:E.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(U.data.token)});case 15:return O.onFinish&&O.onFinish(),j.abrupt("return",!0);case 19:return j.prev=19,j.t0=j.catch(0),j.abrupt("return",!1);case 22:case"end":return j.stop()}},o,null,[[0,19]])}));return function(){return f.apply(this,arguments)}}();return(0,r.jsxs)(N.a,{name:"create",title:i.format("drawerTitle"),open:S,onOpenChange:function(o){if(!o){var m;(m=u.current)===null||m===void 0||m.resetFields()}R(o)},drawerProps:{forceRender:!0,width:le.R_},formRef:u,trigger:(0,r.jsx)(ne.ZP,{type:"primary",children:i.format("drawerTitle")}),onFinish:b()(l()().mark(function f(){return l()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,t();case 2:return m.abrupt("return",m.sent);case 3:case"end":return m.stop()}},f)})),children:[(0,r.jsx)(de.Z,{label:i.format("formUsername"),name:"username",required:!0,rules:[{required:!0}]}),(0,r.jsx)(de.Z,{label:i.format("formEmail"),name:"email",placeholder:"",rules:[{type:"email"}]}),(0,r.jsx)(he.Z,{label:i.format("formUserRole"),name:"userRole",tooltip:i.format("formUserRoleTip"),required:!0,fieldProps:{defaultValue:"member"},options:s.option("listUserRoleOption",["manager","member"])}),(0,r.jsx)(he.Z,{label:i.format("formUserStatus"),name:"userStatus",fieldProps:{defaultValue:"enable"},required:!0,options:s.option("listStatusOption",["enable","disable"])}),(0,r.jsx)(Pe.Z,{label:i.format("formSecurityPassword"),name:"securityPassword",fieldProps:{defaultChecked:!0}}),(0,r.jsx)(pe.Z,{label:i.format("formRemark"),name:"remark",fieldProps:{rows:4}})]})}),Ce=be,Oe=e(38345),Ee=e(63434),De=e(71230),we=e(15746),xe=e(84567),Ze=e(85265),Te=e(82346),Ue=(0,d.forwardRef)(function(O,H){(0,d.useImperativeHandle)(H,function(){return{show:function(y){return b()(l()().mark(function W(){var Z,L,M,oe,Se,Q,je;return l()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return M=y.username,oe=y.uri,(Z=E.current)===null||Z===void 0||Z.resetFields(),R(M),t(oe),J.next=6,(0,c.q4)({username:M});case 6:if(Se=J.sent,Q=(L=Se.data)===null||L===void 0||(L=L.permissions)===null||L===void 0?void 0:L[oe],!Q){J.next=16;break}return J.next=11,(0,Te.request)(Q.uri,{method:"POST"});case 11:je=J.sent,j(je.data.list.filter(function(fe){return Q.value.includes(fe[Q.key])}).map(function(fe){return{id:fe[Q.key],name:fe[Q.showKey]}})),P(Q),J.next=17;break;case 16:j([]);case 17:a(!0);case 18:case"end":return J.stop()}},W)}))()}}});var $=(0,d.useState)(""),g=x()($,2),S=g[0],R=g[1],u=(0,d.useState)(""),i=x()(u,2),s=i[0],t=i[1],f=(0,d.useState)(!1),o=x()(f,2),m=o[0],a=o[1],E=(0,d.useRef)(),U=(0,d.useRef)(),D=(0,d.useState)([]),G=x()(D,2),I=G[0],j=G[1],te=(0,d.useState)(),A=x()(te,2),v=A[0],P=A[1],p=new T.Uo("components.userPermission");return(0,r.jsx)(Ze.Z,{title:p.format("permissionTitle"),open:m,width:le.R_,destroyOnHidden:!0,onClose:function(){var y;(y=E.current)===null||y===void 0||y.resetFields(),a(!1)},children:(0,r.jsx)(q.Z,{actionRef:U,search:!1,toolBarRender:!1,scroll:{x:"max-content"},columns:[{key:"name",title:T.FD.format("listTitle"),dataIndex:"name"}],rowKey:"id",dataSource:I,rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},tableAlertOptionRender:function(y){var W=y.selectedRows;return(0,r.jsx)(X.Z,{size:16,wrap:!0,children:(0,r.jsx)(k.Z,{danger:!0,type:"primary",action:b()(l()().mark(function Z(){return l()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,(0,c.V9)({username:S,permission:{uri:s,key:"-",value:W.map(function(oe){return oe.id}),showKey:"-"}});case 2:return M.abrupt("return",!0);case 3:case"end":return M.stop()}},Z)})),onSuccess:function(){return a(!1),!0},confirm:"notification.confirm.title",children:T.FD.format("listManageDeleteBatch")})})},pagination:!1})})}),ge=Ue,Ae=e(31199),Me=(0,d.forwardRef)(function(O,H){(0,d.useImperativeHandle)(H,function(){return{show:function(a){return b()(l()().mark(function E(){var U,D;return l()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:D=a.formData,(U=f.current)===null||U===void 0||U.resetFields(),t(D),R(!0);case 4:case"end":return I.stop()}},E)}))()}}});var $=(0,d.useState)(!1),g=x()($,2),S=g[0],R=g[1],u=(0,d.useState)({}),i=x()(u,2),s=i[0],t=i[1],f=(0,d.useRef)(),o=new T.Uo("components.userPermission");return(0,r.jsxs)(N.a,{title:o.format("permissionTitle"),open:S,width:le.R_,formRef:f,onFinish:function(){var m=b()(l()().mark(function a(E){return l()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return O.onChange(E),R(!1),D.abrupt("return",!0);case 3:case"end":return D.stop()}},a)}));return function(a){return m.apply(this,arguments)}}(),initialValues:s,drawerProps:{width:le.R_,destroyOnHidden:!0,onClose:function(){var a;(a=f.current)===null||a===void 0||a.resetFields(),R(!1)}},children:[(0,r.jsx)(Ae.Z,{name:"limit",label:o.format("formContainerLimit"),min:0}),(0,r.jsx)(de.Z,{name:"name",hidden:!0})]})}),Ie=Me,Le=e(24963),Fe=e(60532),$e=e(60433),Re=e(25449),We=(0,d.forwardRef)(function(O,H){(0,d.useImperativeHandle)(H,function(){return{edit:function(v){return b()(l()().mark(function P(){var p,w,y;return l()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return(p=i.current)===null||p===void 0||p.setFieldValue("username",v),Z.next=3,(0,c.J5)({username:v});case 3:w=Z.sent,w.data.resource?(y={},w.data.resource.forEach(function(L){y[L.name]=L}),j(y)):j({}),w.data.menus?(w.data.menus.map(function(L){var M;(M=i.current)===null||M===void 0||M.setFieldValue(["permission",L],!0)}),U([].concat(z()(w.data.menus||[]),z()(F.Io)))):U(F.Io),u(!0);case 7:case"end":return Z.stop()}},P)}))()}}});var $={canSeeContainerList:F.W6.CONTAINER,canSeeImageRegistry:F.W6.REGISTRY,canSeeComposeList:F.W6.COMPOSE,canSeeSystemAppstore:F.W6.APPSTORE,canSeeSystemEnv:F.W6.DOCKER_ENV},g=(0,d.useState)(!1),S=x()(g,2),R=S[0],u=S[1],i=(0,d.useRef)(),s=(0,d.useContext)(Le.Z),t=s.message,f=(0,d.useRef)(),o=(0,d.useRef)(),m=(0,d.useState)([]),a=x()(m,2),E=a[0],U=a[1],D=(0,d.useState)({}),G=x()(D,2),I=G[0],j=G[1],te=new T.Uo("components.userPermission");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(N.a,{title:te.format("drawerTitle"),open:R,onOpenChange:function(v){var P;!v&&((P=i.current)===null||P===void 0||P.resetFields()),u(v)},drawerProps:{forceRender:!0,width:le.R_},layout:"inline",formRef:i,onValuesChange:function(v,P){var p=Object.keys(v.permission)[0];if(v.permission[p]===!1){for(var w in P.permission)if(w.startsWith(p)){var y;(y=i.current)===null||y===void 0||y.setFieldValue(["permission",w],!1)}}U(Object.keys(P.permission).filter(function(W){return P.permission[W]}))},onFinish:function(){var A=b()(l()().mark(function v(P){var p;return l()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return p=P.permission&&Object.keys(P.permission).filter(function(W){return P.permission[W]&&!F.Io.includes(W)}),p.push.apply(p,z()(F.Io.filter(function(W){return p.some(function(Z){return Z.startsWith(W)})}))),y.next=4,(0,c.SS)({username:P.username,menuPermissionNames:p,resources:Object.values(I)});case 4:return t.success(T.FD.format("finish")),y.abrupt("return",!0);case 6:case"end":return y.stop()}},v)}));return function(v){return A.apply(this,arguments)}}(),children:[(0,r.jsx)(ge,{ref:f}),(0,r.jsx)(de.Z,{name:"username",hidden:!0}),F.d0.map(function(A){return(0,r.jsxs)(Oe.Z,{headerBordered:!0,ghost:!0,bodyStyle:{paddingTop:10,paddingBottom:20},title:(0,r.jsx)(Fe.Z,{}),subTitle:te.format(A.group),children:[(0,r.jsx)(Ee.Z,{name:["permission",A.group],valuePropName:"checked",initialValue:!0,hidden:!0}),(0,r.jsx)(De.Z,{gutter:[16,16],children:A.permissions.map(function(v){return(0,r.jsx)(we.Z,{span:6,children:(0,r.jsxs)(Re.Z,{children:[(0,r.jsx)(Re.Z,{noStyle:!0,name:["permission",v],valuePropName:"checked",children:(0,r.jsx)(xe.Z,{disabled:!E.includes(v.substring(0,v.search(/[A-Z][^A-Z]*$/))),children:te.format(v)})}),$[v]&&(0,r.jsx)(Y.Z,{title:te.format("dataPermissionButton"),children:(0,r.jsx)(re.Z.Link,{onClick:function(){var p,w;(p=f.current)===null||p===void 0||p.show({username:((w=i.current)===null||w===void 0?void 0:w.getFieldValue("username"))||"",uri:$[v]||""})},children:(0,r.jsx)($e.Z,{})})}),["canSeeContainerListManageCreate"].includes(v)&&(0,r.jsx)(Y.Z,{title:te.format("resourcePermssionButton"),children:(0,r.jsx)(re.Z.Link,{onClick:function(){var p;(p=o.current)===null||p===void 0||p.show({formData:I[v]||{name:v,limit:0}})},children:(0,r.jsx)(B.Z,{})})})]})},v)})})]},A.group)})]}),(0,r.jsx)(ge,{ref:f}),(0,r.jsx)(Ie,{onChange:function(v){var P;I[v.name]=v,(0,c.SS)({username:((P=i.current)===null||P===void 0?void 0:P.getFieldValue("username"))||"",menuPermissionNames:E,resources:Object.values(I)})},resourcePermissionsData:I,ref:o})]})}),Ke=We,Be=e(5251);function Ve(){var O=(0,d.useRef)(),H=(0,d.useRef)(),$=(0,d.useRef)(),g=new T.Uo("system.user");return(0,r.jsxs)(ue._z,{header:{extra:[(0,r.jsx)(Ce,{ref:H,onFinish:function(){var R,u;!((R=O.current)===null||R===void 0)&&R.reloadAndRest&&((u=O.current)===null||u===void 0||u.reloadAndRest())}},"invite-user")]},children:[(0,r.jsx)(Ke,{ref:$}),(0,r.jsx)(q.Z,{scroll:{x:"max-content"},rowKey:"username",columns:[{title:T.FD.format("listUsername"),ellipsis:!0,dataIndex:"username"},{title:g.format("listEmail"),ellipsis:!0,dataIndex:"email"},{title:g.format("listUserRole"),ellipsis:!0,width:100,dataIndex:"userRole",valueEnum:Object.assign.apply(Object,[{}].concat(z()(g.option("listUserRoleOption",["manager","member"]).map(function(S){return se()({},S.value,{text:S.label,status:S.value})})))),render:function(R,u){return(0,r.jsx)(ee.Z,{color:g.format("listUserRoleColor."+u.userRole),children:g.format("listUserRoleOption."+u.userRole)})}},{title:g.format("listRegisterAt"),ellipsis:!0,render:function(R,u,i,s){return(0,r.jsx)("div",{children:(0,Be.ZM)(u.registerAt*1e3)},u.username)},search:!1},{title:g.format("listRemark"),ellipsis:!0,dataIndex:"remark",search:!1},{title:g.format("listStatus"),width:100,dataIndex:"status",search:!1,render:function(R,u){return(0,r.jsx)(ee.Z,{color:g.format("listStatusColor."+u.status),children:g.format("listStatusOption."+u.status)})}},{title:T.FD.format("listManage"),width:100,search:!1,fixed:"right",render:function(R,u,i){return(0,r.jsxs)(X.Z,{split:(0,r.jsx)(me.Z,{type:"vertical"}),children:[(0,r.jsx)(re.Z.Link,{copyable:{tooltips:g.format("listManageCopyUrl"),icon:[(0,r.jsx)(C.Z,{})],text:function(){var s=b()(l()().mark(function f(){var o;return l()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,c.u1)({username:u.username});case 2:return o=a.sent,a.abrupt("return","".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(o.data.token));case 4:case"end":return a.stop()}},f)}));function t(){return s.apply(this,arguments)}return t}()},style:{color:"inherit"}},"copy-"+i),(0,r.jsx)(Y.Z,{title:g.format("listManageSetting"),children:(0,r.jsx)(re.Z.Link,{onClick:function(){var t;(t=$.current)===null||t===void 0||t.edit(u.username)},children:(0,r.jsx)(B.Z,{})})}),(0,r.jsx)(k.Z,{ghost:!0,type:"link",tips:g.format("listManageSendEmail"),icon:(0,r.jsx)(n.Z,{}),action:b()(l()().mark(function s(){var t;return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,c.u1)({username:u.username});case 2:return t=o.sent,o.abrupt("return",(0,c.sI)({username:u.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(t.data.token)}));case 4:case"end":return o.stop()}},s)}))})]})}}],request:function(){var S=b()(l()().mark(function R(u){var i;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,c.lE)();case 2:return i=t.sent,t.abrupt("return",{data:i.data.list,success:!0,total:i.data.list.length});case 4:case"end":return t.stop()}},R)}));return function(R){return S.apply(this,arguments)}}(),rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},actionRef:O,tableAlertOptionRender:function(R){var u=R.selectedRowKeys;return(0,r.jsxs)(X.Z,{size:16,children:[(0,r.jsx)(k.Z,{action:b()(l()().mark(function i(){var s,t,f,o;return l()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:s=0,t=u;case 1:if(!(s<t.length)){a.next=9;break}return f=t[s],a.next=5,(0,c.az)({username:f,status:2});case 5:o=a.sent;case 6:s++,a.next=1;break;case 9:return a.abrupt("return",!0);case 10:case"end":return a.stop()}},i)})),onSuccess:function(){var s,t;return!((s=O.current)===null||s===void 0)&&s.reloadAndRest&&((t=O.current)===null||t===void 0||t.reloadAndRest()),!0},onError:function(){var s,t;return!((s=O.current)===null||s===void 0)&&s.reset&&((t=O.current)===null||t===void 0||t.reset()),!0},children:T.FD.format("listManageEnable")},"batchEnable"),(0,r.jsx)(k.Z,{danger:!0,action:b()(l()().mark(function i(){var s,t,f,o;return l()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:s=0,t=u;case 1:if(!(s<t.length)){a.next=9;break}return f=t[s],a.next=5,(0,c.az)({username:f,status:1});case 5:o=a.sent;case 6:s++,a.next=1;break;case 9:return a.abrupt("return",!0);case 10:case"end":return a.stop()}},i)})),onSuccess:function(){var s,t;return!((s=O.current)===null||s===void 0)&&s.reloadAndRest&&((t=O.current)===null||t===void 0||t.reloadAndRest()),!0},onError:function(){var s,t;return!((s=O.current)===null||s===void 0)&&s.reset&&((t=O.current)===null||t===void 0||t.reset()),!0},children:T.FD.format("listManageDisable")},"batchDisable")]})},pagination:(0,h.Oh)()})]})}},67255:function(ce,K,e){e.d(K,{G$:function(){return ae},LX:function(){return k},MJ:function(){return b},Oh:function(){return _},h5:function(){return ie},j_:function(){return se},rj:function(){return z}});var V=e(5574),l=e.n(V);function _(c){var h=localStorage.getItem("dpanel-pagesize");return h=="all"?!1:{defaultCurrent:c==null?void 0:c.page,showSizeChanger:!0,defaultPageSize:parseInt(h!=null?h:"20"),showQuickJumper:!0}}function b(c,h){h?localStorage.setItem("dpanel-page-"+c,"".concat(h)):localStorage.removeItem("dpanel-page-"+c)}function ae(c,h){var C,B=h?Math.ceil((h==null?void 0:h.total)/(h==null?void 0:h.pageSize)):void 0,n=parseInt((C=localStorage.getItem("dpanel-page-"+c))!==null&&C!==void 0?C:"");if(n!=0)return B&&n>B?B:n}function se(c){return{persistenceKey:c,persistenceType:"localStorage"}}var ie=["descend","ascend"];function z(c,h){var C=localStorage.getItem("dpanel-table-sort-".concat(c));if(C){var B=C.split("|"),n=l()(B,2),ue=n[0],q=n[1];if(ue==h)return q}}function k(c,h,C){!h||!C?localStorage.removeItem("dpanel-table-sort-".concat(c)):localStorage.setItem("dpanel-table-sort-".concat(c),"".concat(h,"|").concat(C))}}}]);
