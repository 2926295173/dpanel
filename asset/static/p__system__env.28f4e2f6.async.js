"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1180],{44349:function(ne,F,e){var Y=e(97857),T=e.n(Y),J=e(15009),L=e.n(J),Q=e(99289),V=e.n(Q),X=e(74763),C=e(17186),w=e(5966),N=e(86250),W=e(67294),R=e(85893),G=(0,W.forwardRef)(function(s,$){var P=(0,W.useRef)();(0,W.useImperativeHandle)($,function(){return{addItem:function(U){function r(l,M,n){return U.apply(this,arguments)}return r.toString=function(){return U.toString()},r}(function(U,r,l){var M,n=(M=P.current)===null||M===void 0?void 0:M.getList(),a;if(n==null||n.forEach(function(I,Z){I[U]==r[U]&&(a=Z)}),!(0,X.k)(a)&&l){var x;(x=P.current)===null||x===void 0||x.remove(a),a=void 0}if(!a){var u;(u=P.current)===null||u===void 0||u.add(r)}}),removeItemByKey:function(r,l){return V()(L()().mark(function M(){var n,a;return L()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return a=(n=P.current)===null||n===void 0?void 0:n.getList(),a==null||a.forEach(function(I,Z){if(I[r]==l){var S;(S=P.current)===null||S===void 0||S.remove(Z);return}}),u.abrupt("return");case 3:case"end":return u.stop()}},M)}))()},clear:function(r){if(!r){var l;r=(l=P.current)===null||l===void 0||(l=l.getList())===null||l===void 0?void 0:l.map(function(n,a){return a})}if(r){var M;(M=P.current)===null||M===void 0||M.remove(r)}},getList:function(){var r;return(r=P.current)===null||r===void 0?void 0:r.getList()}}});var y={};return s.hideCopyButton===!0&&(y.copyIconProps=!1),s.hideDeleteButton===!0&&(y.deleteIconProps=!1),(0,R.jsx)(C.u,T()(T()({initialValue:s.initialValue,label:s.label,name:s.name,actionRef:P,creatorButtonProps:s.showAddButton?{creatorButtonText:s.label?s.label:s.showAddButtonLabel?s.showAddButtonLabel:s.name}:!1,min:s.min?s.min:0},y),{},{children:function(r,l,M){return(0,R.jsx)(N.Z,{justify:s.justify,gap:s.gap,children:s.items.map(function(n){return n.render?(0,R.jsx)("div",{children:n.render&&n.render(r,l,M)},"".concat(s.name,"-").concat(n.name,"-").concat(r.key)):(0,R.jsx)(w.Z,{width:n.width,name:n.name,label:n.label,required:n.required,rules:[{required:n.required}],disabled:n.disabled,placeholder:n.placeholder},"".concat(s.name,"-").concat(n.name,"-").concat(r.key))})})}}))});F.Z=G},36435:function(ne,F,e){var Y=e(15009),T=e.n(Y),J=e(64599),L=e.n(J),Q=e(99289),V=e.n(Q),X=e(9783),C=e.n(X),w=e(5574),N=e.n(w),W=e(67294),R=e(184),G=e(38345),s=e(97269),$=e(97321),P=e(97462),y=e(64317),U=e(5966),r=e(86615),l=e(68602),M=e(83622),n=e(83403),a=e(24963),x=e(1699),u=e(29177),I=e(1883),Z=e(43425),S=e(44349),k=e(3616),q=e(36146),i=e(85893),H=(0,W.forwardRef)(function(b,ae){var j=(0,W.useState)(!1),E=N()(j,2),v=E[0],o=E[1],A=(0,W.useRef)(),h=(0,W.useContext)(a.Z),p=h.message,t=(0,W.useState)([]),z=N()(t,2),ee=z[0],re=z[1],B=new q.Uo("components.permissionButton"),te=C()(C()(C()(C()(C()({},n.W6.CONTAINER,"Id"),n.W6.APPSTORE,"name"),n.W6.COMPOSE,"name"),n.W6.REGISTRY,"serverAddress"),n.W6.DOCKER_ENV,"name"),oe=C()(C()(C()(C()(C()({},n.W6.CONTAINER,"name"),n.W6.APPSTORE,"name"),n.W6.COMPOSE,"name"),n.W6.REGISTRY,"title"),n.W6.DOCKER_ENV,"title"),_e=te[b.type],le=oe[b.type],ue=b.selected.map(function(d){return d[te[b.type]]});return W.useEffect(function(){if(v){if(!b.selected||b.selected.length==0){p.error(q.FD.format("title.noDataSelect")),o(!1);return}(0,l.dP)({permission:{uri:b.type,key:_e,value:ue}}).then(function(d){var _;(_=A.current)===null||_===void 0||_.setFieldValue("list",Object.keys(d.data.list).map(function(m){return{name:m,type:d.data.list[m].type,users:d.data.list[m].users}}))}),(0,l.lE)().then(function(d){var _,m=(_=d.data)===null||_===void 0||(_=_.list)===null||_===void 0?void 0:_.map(function(c){return{label:c.username,value:c.username}});re(m)})}},[v]),(0,i.jsx)(x.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,i.jsxs)(R.a,{name:"create",title:B.format("drawerTitle"),open:v,onOpenChange:function(_){if(!_){var m;(m=A.current)===null||m===void 0||m.resetFields()}o(_)},drawerProps:{forceRender:!0,width:k.R_},formRef:A,trigger:(0,i.jsx)(M.ZP,{icon:(0,i.jsx)(u.Z,{}),children:B.format("drawerTriggerButton")}),onFinish:function(){var d=V()(T()().mark(function _(m){var c,O,f;return T()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:c=L()(m.list),D.prev=1,c.s();case 3:if((O=c.n()).done){D.next=9;break}return f=O.value,D.next=7,(0,l.Db)({usernames:f.users,permissionType:f.type,permission:{uri:b.type,key:_e,showKey:le,value:[f.name]}});case 7:D.next=3;break;case 9:D.next=14;break;case 11:D.prev=11,D.t0=D.catch(1),c.e(D.t0);case 14:return D.prev=14,c.f(),D.finish(14);case 17:p.success(q.FD.format("finish")),o(!1),b.onSuccess();case 20:case"end":return D.stop()}},_,null,[[1,11,14,17]])}));return function(_){return d.apply(this,arguments)}}(),children:[(0,i.jsxs)(G.Z,{ghost:!0,title:(0,i.jsx)(I.Z,{}),subTitle:B.format("batchTitle"),children:[(0,i.jsx)(s.A.Item,{name:"type",style:{marginBottom:0},children:(0,i.jsx)($.Z.Group,{defaultValue:"admin",onChange:function(_){var m,c,O=(m=A.current)===null||m===void 0?void 0:m.getFieldValue("list");O.forEach(function(f){f.type=_,f.users=[]}),(c=A.current)===null||c===void 0||c.setFieldValue("list",O)},children:["admin","restricted","public"].map(function(d){return(0,i.jsx)($.Z,{style:{width:240},title:B.format("dataTypeOption.".concat(d)),description:B.format("dataTypeDescOption.".concat(d)),value:d},d)})})}),(0,i.jsx)(P.Z,{name:["type"],children:function(_){var m=_.type;if(m==="restricted")return(0,i.jsx)(y.Z,{mode:"multiple",name:"usernames",label:B.format("formUsernames"),onChange:function(O){var f,g,D=(f=A.current)===null||f===void 0?void 0:f.getFieldValue("list");D.forEach(function(K){K.users=O}),(g=A.current)===null||g===void 0||g.setFieldValue("list",D)},rules:[{required:!0}],request:V()(T()().mark(function c(){var O,f,g;return T()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(!(ee.length>0)){K.next=2;break}return K.abrupt("return",ee);case 2:return K.next=4,(0,l.lE)();case 4:return f=K.sent,g=(O=f.data)===null||O===void 0||(O=O.list)===null||O===void 0?void 0:O.map(function(se){return{label:se.username,value:se.username}}),re(g),K.abrupt("return",g);case 8:case"end":return K.stop()}},c)}))})}})]}),(0,i.jsx)(G.Z,{ghost:!0,title:(0,i.jsx)(Z.Z,{}),subTitle:B.format("dataTitle"),children:(0,i.jsx)(S.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:B.format("dataName"),render:function(_,m,c){var O=c.getCurrentRowData();return(0,i.jsx)(U.Z,{disabled:!0,label:B.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:B.format("dataType"),render:function(_,m,c){var O=c.getCurrentRowData();return(0,i.jsx)(r.Z.Group,{label:B.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(f){return{label:B.format("dataTypeOption.".concat(f)),value:f}})})}},{name:"users",label:B.format("dataUsers"),render:function(_,m,c){return(0,i.jsx)(P.Z,{name:["type"],children:function(f){var g=f.type;if(g=="restricted")return(0,i.jsx)(y.Z,{width:"sm",mode:"tags",name:"users",label:B.format("dataUsers"),options:ee})}})}}]})})]})})});F.Z=H},98163:function(ne,F,e){e.r(F),e.d(F,{default:function(){return x}});var Y=e(15009),T=e.n(Y),J=e(99289),L=e.n(J),Q=e(80821),V=e(77273),X=e(36435),C=e(98510),w=e(83403),N=e(24963),W=e(87662),R=e(36146),G=e(86548),s=e(82061),$=e(74453),P=e(82346),y=e(83622),U=e(42075),r=e(96074),l=e(25593),M=e(83062),n=e(67294),a=e(85893);function x(){var u=(0,n.useRef)(),I=(0,n.useRef)(),Z=(0,P.useModel)("@@initialState"),S=Z.refresh,k=Z.initialState,q=(0,n.useContext)(N.Z),i=q.message,H=(0,P.useLocation)(),b=(0,P.useNavigate)(),ae=new R.Uo("system.env");return(0,n.useEffect)(function(){var j=H.state;if(j){if(b(".",{replace:!0}),j&&j.item){var E;(E=I.current)===null||E===void 0||E.edit(j.item)}if(j&&j.name){var v,o,A=k==null||(v=k.dockerEnv)===null||v===void 0?void 0:v.list.find(function(h){return h.name==j.name});A&&((o=I.current)===null||o===void 0||o.edit(A))}}},[H.state]),(0,a.jsx)($._z,{header:{extra:[(0,a.jsx)(V.Z,{trigger:(0,a.jsx)(y.ZP,{type:"primary",children:ae.format("createButton")}),ref:I,onFinish:L()(T()().mark(function j(){var E,v,o;return T()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(o=H.state,!(o&&o.item)){h.next=6;break}return h.next=4,(0,W.vC)({name:o.item.name});case 4:return b(H.pathname,{replace:!0,state:null}),h.abrupt("return");case 6:S(),!((E=u.current)===null||E===void 0)&&E.reloadAndRest&&((v=u.current)===null||v===void 0||v.reloadAndRest());case 8:case"end":return h.stop()}},j)}))},"dockerEnvCreate")]},children:(0,a.jsx)(C.C,{rowKey:"name",columns:[{title:R.FD.format("listName"),dataIndex:"name"},{title:R.FD.format("listTitle"),dataIndex:"title"},{title:R.FD.format("listTargetAddress"),dataIndex:"address"},{title:R.FD.format("listManage"),width:50,search:!1,render:function(E,v,o,A,h){return(0,a.jsx)(U.Z,{split:(0,a.jsx)(r.Z,{type:"vertical"}),children:(0,a.jsx)(l.Z.Link,{onClick:function(){var t;(t=I.current)===null||t===void 0||t.edit(v)},children:(0,a.jsx)(M.Z,{title:R.FD.format("listManageEdit"),children:(0,a.jsx)(G.Z,{})})},v.name)})}}],pagination:!1,request:L()(T()().mark(function j(){var E;return T()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,W.Kg)({enableCertContent:!0});case 2:return E=o.sent,o.abrupt("return",{data:E.data.list,total:E.data.list.length});case 4:case"end":return o.stop()}},j)})),search:!1,actionRef:u,quickToolbarRender:function(E){var v=E.selectedRows,o=E.finish,A=E.loading;return(0,a.jsxs)(U.Z,{size:16,children:[(0,a.jsx)(X.Z,{type:w.W6.DOCKER_ENV,selected:v,onSuccess:function(){var p,t;return!((p=u.current)===null||p===void 0)&&p.reloadAndRest&&((t=u.current)===null||t===void 0||t.reloadAndRest()),!0}},"permissionButton"),(0,a.jsx)(Q.Z,{buttonProps:{danger:!0,type:"primary",icon:(0,a.jsx)(s.Z,{})},action:L()(T()().mark(function h(){return T()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!v.find(function(z){return z.default})){t.next=3;break}return i.warning(R.FD.format("systemEnvDefaultCannotDelete")),t.abrupt("return",!1);case 3:return A(),t.abrupt("return",(0,W._g)({name:v.map(function(z){return z.name})}).finally(function(){o(!0)}));case 5:case"end":return t.stop()}},h)})),onSuccess:function(){var p,t;return!((p=u.current)===null||p===void 0)&&p.reloadAndRest&&((t=u.current)===null||t===void 0||t.reloadAndRest()),!0},onError:function(){var p,t;return!((p=u.current)===null||p===void 0)&&p.reset&&((t=u.current)===null||t===void 0||t.reset()),!0},confirmProps:{showCommonConfirm:!0},children:R.FD.format("listManageDeleteBatch")})]})}})})}}}]);
