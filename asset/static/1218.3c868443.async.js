"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1218],{83002:function(be,he,e){var ge=e(5574),s=e.n(ge),ye=e(15009),y=e.n(ye),I=e(99289),u=e.n(I),J=e(83622),E=e(85265),_=e(67294),A=e(81146),c=e(1883),w=e(90098),h=e(3616),f=e(36146),T=e(85893),Ze=(0,_.forwardRef)(function(p,K){(0,_.useImperativeHandle)(K,function(){return{show:function(o){return u()(y()().mark(function C(){return y()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:we(o),q(!0);case 2:case"end":return Y.stop()}},C)}))()}}});var ae=(0,_.useState)(!1),ie=s()(ae,2),G=ie[0],q=ie[1],me=(0,_.useState)(),z=s()(me,2),O=z[0],we=z[1],oe=(0,_.useRef)();return(0,T.jsxs)(T.Fragment,{children:[p.showTriggerButton&&(0,T.jsx)(J.ZP,{onClick:u()(y()().mark(function l(){return y()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:we(p.composeItem),q(!0);case 2:case"end":return C.stop()}},l)})),icon:(0,T.jsx)(c.Z,{}),children:f.FD.format("listManageLog")},"log"),(0,T.jsx)(E.Z,{title:f.FD.format("listLog"),open:G,forceRender:!0,onClose:function(){q(!1)},afterOpenChange:function(o){if(o)setTimeout(function(){var n,Y;(n=oe.current)===null||n===void 0||n.start(),(Y=oe.current)===null||Y===void 0||Y.fit()},1e3);else{var C;(C=oe.current)===null||C===void 0||C.close()}},width:h.FK,children:O&&G&&(0,T.jsx)(A.Z,{ref:oe,showInDrawer:!0,id:"compose:log:".concat(String(O.id||O.name)),request:function(){var l=u()(y()().mark(function o(C){var n;return y()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,(0,w.Yz)({id:O.id||O.name,lineTotal:C.lineTotal,download:(n=C.download)!==null&&n!==void 0?n:!1,showTime:C.showTime});case 2:case"end":return B.stop()}},o)}));return function(o){return l.apply(this,arguments)}}(),download:function(){var l=u()(y()().mark(function o(C){var n;return y()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,(0,w.vf)({id:O.id||O.name,lineTotal:C.lineTotal,showTime:C.showTime,download:!0});case 2:return n=B.sent,B.abrupt("return",{data:new Blob([n],{type:"text/plain"}),name:p.composeItem.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return B.stop()}},o)}));return function(o){return l.apply(this,arguments)}}()})})]})});he.Z=Ze},82848:function(be,he,e){e.d(he,{Z:function(){return t}});var ge=e(15009),s=e.n(ge),ye=e(99289),y=e.n(ye),I=e(97857),u=e.n(I),J=e(5574),E=e.n(J),_=e(3616),A=e(24963),c=e(90098),w=e(36146),h=e(86548),f=e(33862),T=e(38345),Ze=e(24739),p=e(5966),K=e(86615),ae=e(97462),ie=e(62370),G=e(95213),q=e(11106),me=e(92398),z=e(42075),O=e(83622),we=e(83062),oe=e(40411),l=e(71230),o=e(15746),C=e(40056),n=e(67294),Y=e(12491),B=e(85060),Ie=e(97269),Qe=e(86738),i=e(85893),xe=(0,n.forwardRef)(function(Ue,V){(0,n.useImperativeHandle)(V,function(){return{}});var Re=(0,n.useRef)(),Z=(0,n.useState)(!1),Be=E()(Z,2),Ve=Be[0],ee=Be[1];return(0,i.jsx)(ie.Z,{children:(0,i.jsx)(Qe.Z,{icon:!1,title:!1,description:(0,i.jsx)(Ie.A,{name:"importRemote",layout:"horizontal",submitter:!1,formRef:Re,children:(0,i.jsx)(p.Z,{width:"lg",label:"Url",initialValue:Ue.defaultUrl,name:"url",placeholder:"https:// or http://"})}),onOpenChange:function(se){if(!se){var le;(le=Re.current)===null||le===void 0||le.resetFields()}},onConfirm:y()(s()().mark(function Ee(){var se,le,S;return s()().wrap(function(Pe){for(;;)switch(Pe.prev=Pe.next){case 0:if(le=(se=Re.current)===null||se===void 0?void 0:se.getFieldValue("url"),le){Pe.next=3;break}return Pe.abrupt("return");case 3:return ee(!0),Pe.next=6,(0,c.MG)({uri:le}).finally(function(){ee(!1)});case 6:S=Pe.sent,Ue.onFinish&&Ue.onFinish(S.data.content,le);case 8:case"end":return Pe.stop()}},Ee)})),children:(0,i.jsx)(O.ZP,{loading:Ve,icon:(0,i.jsx)(B.Z,{}),block:!0,onClick:function(){var se;(se=Re.current)===null||se===void 0||se.resetFields()},children:Ue.title})})})}),Ae=xe,ze=e(91058),Ke=e(79245),Ye=e(27166),ke=e(82346),at=function(V){var Re,Z=new w.Uo("components.appCompose"),Be=(0,n.useContext)(A.Z),Ve=Be.message,ee=(0,n.useRef)(),Ee=(0,n.useRef)(),se=(0,n.useState)(),le=E()(se,2),S=le[0],je=le[1],Pe=(0,n.useState)(!1),He=E()(Pe,2),Ne=He[0],Xe=He[1];(0,n.useEffect)(function(){if(ee.current){if(!V.id){je({yaml:"",override:""});return}(0,c.Pn)({id:V.id}).then(function(U){var F,M;je({yaml:U.data.yaml[0],override:(F=U.data.yaml[1])!==null&&F!==void 0?F:""}),(M=ee.current)===null||M===void 0||M.setFieldsValue({name:U.data.detail.name,title:U.data.detail.title,type:U.data.detail.setting.type,environment:U.data.detail.setting.environment,remoteUrl:U.data.detail.setting.remoteUrl})})}},[ee.current,V.id]);var it=(0,i.jsx)(me.Z,{tabBarExtraContent:(0,i.jsxs)(z.Z,{children:[(0,i.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-override",target:"_blank",children:w.FD.format("help")}),(0,i.jsx)(O.ZP,{type:"link",onClick:function(){},children:w.FD.format("listManageFullScreen")})]}),items:[{label:Z.format("createYaml.yaml"),key:"yaml",children:S&&(0,i.jsx)(q.ZP,{theme:"dark",height:"600px",onChange:function(F){je(u()(u()({},S),{yaml:F}))},onFocus:function(){var F;((F=ee.current)===null||F===void 0?void 0:F.getFieldValue("type"))=="remoteUrl"&&Ve.info(Z.format("createYamlDisableEdit"))},readOnly:((Re=ee.current)===null||Re===void 0?void 0:Re.getFieldValue("type"))=="remoteUrl",value:S.yaml,extensions:[G.RI.yaml()]})},{label:(0,i.jsx)(we.Z,{title:Z.format("createYamlOverrideTip"),children:(0,i.jsx)(oe.Z,{count:(S==null?void 0:S.override)&&w.FD.format("listInUse"),offset:[15,-5],children:Z.format("createYaml.override")})}),key:"yamlOverride",children:S&&(0,i.jsx)(q.ZP,{theme:"dark",height:"600px",onChange:function(F,M){je(u()(u()({},S),{override:F}))},value:S==null?void 0:S.override,extensions:[G.RI.yaml()]})}]},"yamlEditor");return(0,i.jsxs)(Ye.Z,{requestLoading:S==null&&V.id!=null,drawerProps:{width:_.R_,destroyOnHidden:!0},open:Ne,onOpenChange:function(F){if(Xe(F),!F){var M;je(void 0),(M=ee.current)===null||M===void 0||M.resetFields()}},title:Z.format("yamlDrawerTitle"),formRef:ee,trigger:(0,i.jsx)(O.ZP,{type:"primary",icon:V.id?(0,i.jsx)(h.Z,{}):void 0,children:w.Ob.format(V.id?"compose.list.edit":"compose.list.create")}),onFinish:function(){var U=y()(s()().mark(function F(M){var Fe,te;return s()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.prev=0,Fe={id:V.id&&V.id.toString(),type:M.type,name:M.name,title:M.title,environment:M.environment,remoteUrl:M.remoteUrl,yaml:S==null?void 0:S.yaml,yamlOverride:S==null?void 0:S.override},m.next=4,(0,c.im)(Fe);case 4:return te=m.sent,V.onFinish&&V.onFinish(te.data.id),m.abrupt("return",!0);case 9:return m.prev=9,m.t0=m.catch(0),m.abrupt("return",!1);case 12:case"end":return m.stop()}},F,null,[[0,9]])}));return function(F){return U.apply(this,arguments)}}(),children:[(0,i.jsx)(T.Z,{ghost:!0,children:(0,i.jsxs)(Ze.UW,{children:[(0,i.jsx)(p.Z,{label:Z.format("createFormName"),name:"name",width:"md",required:!0,disabled:!!V.id,rules:[{required:!0},{pattern:/^[a-zA-Z0-9_-]+$/,message:Z.format("createFormNameRule")}],placeholder:Z.format("createFormNameEmpty")}),(0,i.jsx)(p.Z,{label:Z.format("createFormTitle"),name:"title",width:"md"})]})},"createForm"),(0,i.jsx)(K.Z.Group,{label:Z.format("createFormType"),name:"type",initialValue:"text",fieldProps:{defaultValue:"text",onChange:function(){var F;(F=ee.current)===null||F===void 0||F.resetFields(["yaml","environment"])}},disabled:!!V.id,options:Z.option("createFormTypeOption",["text","remoteUrl","storagePath","store","outPath"]).map(function(U){return{label:U.label,value:U.value}})}),(0,i.jsx)(ae.Z,{name:["type"],children:function(F){var M=F.type;if(M=="text")return(0,i.jsxs)(l.Z,{gutter:[10,0],children:[(0,i.jsx)(o.Z,{span:12,children:(0,i.jsx)(Y.Z,{title:Z.format("createFormTypeTextImportFile"),onImport:function(te){return je(u()(u()({},S),{yaml:te})),(0,Ke.m)(te).map(function(Se){var m;(m=Ee.current)===null||m===void 0||m.addEnvItem(Se.name,Se.value)}),!0},onLoad:function(te){if(te.indexOf("services:")<0)throw new Error(w.FD.format("commonFileIncorrectFormat",{name:"yaml"}));return!0}},"importFile")}),(0,i.jsx)(o.Z,{span:12,children:(0,i.jsx)(Ae,{title:Z.format("createFormTypeTextImportRemote"),onFinish:function(){var Fe=y()(s()().mark(function te(Se){return s()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return je(u()(u()({},S),{yaml:Se})),(0,Ke.m)(Se).map(function(k){var $;($=Ee.current)===null||$===void 0||$.addEnvItem(k.name,k.value)}),ne.abrupt("return",!0);case 3:case"end":return ne.stop()}},te)}));return function(te){return Fe.apply(this,arguments)}}()},"importRemote")})]});if(M=="remoteUrl")return(0,i.jsx)(l.Z,{gutter:[10,0],children:(0,i.jsxs)(o.Z,{span:24,children:[(0,i.jsx)(ie.Z,{shouldUpdate:!0,children:function(te){return(0,i.jsx)(Ae,{defaultUrl:te.getFieldValue("remoteUrl"),title:Z.format("createFormTypeRemoteImportRemote1"),onFinish:function(){var Se=y()(s()().mark(function m(ne,k){var $;return s()().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return je(u()(u()({},S),{yaml:ne})),($=ee.current)===null||$===void 0||$.setFieldValue("remoteUrl",k),(0,Ke.m)(ne).map(function(Le){var Ce;(Ce=Ee.current)===null||Ce===void 0||Ce.addEnvItem(Le.name,Le.value)}),fe.abrupt("return",!0);case 4:case"end":return fe.stop()}},m)}));return function(m,ne){return Se.apply(this,arguments)}}()},"importRemote1")}}),(0,i.jsx)(ie.Z,{hidden:!0,name:"remoteUrl"},"remoteUrl")]})});if(M=="storagePath")return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(p.Z,{name:"storagePath",required:!0,readonly:!0,initialValue:Z.format("createFormTypeStoragePathTip"),addonAfter:(0,i.jsx)("a",{href:"https://dpanel.cc/manual/compose-create",target:"_blank",children:w.FD.format("help")})})});if(M=="store")return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(p.Z,{readonly:!0,name:"store",required:!0,initialValue:Z.format("createFormTypeStoreTip"),addonAfter:(0,i.jsx)(ke.Link,{to:"/compose/appstore",children:w.Ob.format("compose.appstore")})})});if(M=="outPath")return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(p.Z,{name:"outPath",required:!0,readonly:!0,initialValue:Z.format("createFormTypeOutPathTip")})})}}),(0,i.jsxs)(T.Z,{ghost:!0,direction:"row",children:[(0,i.jsxs)(T.Z,{ghost:!0,colSpan:"50%",children:[(0,i.jsx)(C.Z,{type:"warning",message:Z.format("createFormTypeTextTip"),style:{marginBottom:15}},"yamlTips"),(0,i.jsx)(C.Z,{message:(0,i.jsxs)(i.Fragment,{children:[Z.format("createEnvTip1")," ","${DB_NAME}",". ",Z.format("createEnvTip2")]})}),(0,i.jsx)(ze.Z,{drawerProps:{ghost:!0,title:(0,i.jsx)(f.Z,{}),subTitle:Z.format("createEnvTitle")},name:"environment",showInDrawer:!0,showImportButton:!V.id,showAddButton:!0,showCodeMode:!V.id,ref:Ee})]}),(0,i.jsx)(T.Z,{colSpan:"50%",children:it})]},"yamlEditor")]},"yamlCreate")},t=at},91218:function(be,he,e){e.d(he,{Z:function(){return Se}});var ge=e(97857),s=e.n(ge),ye=e(19632),y=e.n(ye),I=e(15009),u=e.n(I),J=e(99289),E=e.n(J),_=e(5574),A=e.n(_),c=e(67294),w=e(3616),h=e(36146),f=e(38345),T=e(97269),Ze=e(86615),p=e(62370),K=e(90098),ae=e(27166),ie=e(43425),G=e(33160),q=e(82061),me=e(87784),z=e(74842),O=e(30159),we=e(25035),oe=e(95591),l=e(26522),o=e(33862),C=e(40056),n=e(42075),Y=e(96074),B=e(25593),Ie=e(84567),Qe=e(83062),i=e(83622),xe=e(80821),Ae=e(82346),ze=e(79697),Ke=e(99861),Ye=e(1699),ke=e(89035),at=e(75544),t=e(85893),Ue=(0,c.forwardRef)(function(m,ne){(0,c.useImperativeHandle)(ne,function(){return{show:function(){return E()(u()().mark(function x(){var ue;return u()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return Ce(!0),(ue=$.current)===null||ue===void 0||ue.clear(),re.next=4,new Promise(function(_e){return setTimeout(function(){var Me;(Me=$.current)===null||Me===void 0||Me.fit(),_e(!0)},1e3)});case 4:case"end":return re.stop()}},x)}))()},close:function(){var x;Ce(!1),(x=$.current)===null||x===void 0||x.clear()},cancel:function(){return E()(u()().mark(function x(){var ue;return u()().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return(ue=$.current)===null||ue===void 0||ue.clear(),k.progress.close("compose:"+m.id),re.abrupt("return",!0);case 3:case"end":return re.stop()}},x)}))()}}});var k=(0,Ae.useModel)("subscriber"),$=(0,c.useRef)(),D=(0,c.useState)(!1),fe=A()(D,2),Le=fe[0],Ce=fe[1];return k.addDataHandler("compose:"+m.id,function(b){var x;(x=$.current)===null||x===void 0||x.write(b.data)}),(0,t.jsx)(f.Z,{hidden:!Le,ghost:!0,title:(0,t.jsx)(ke.Z,{}),subTitle:"Console",extra:(0,t.jsx)(n.Z,{children:(0,t.jsx)(xe.Z,{action:E()(u()().mark(function b(){var x;return u()().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return(x=$.current)===null||x===void 0||x.clear(),k.progress.close("compose:"+m.id),ve.abrupt("return");case 3:case"end":return ve.stop()}},b)})),buttonProps:{icon:(0,t.jsx)(q.Z,{}),danger:!0},children:h.FD.format("listManageKill")},"kill")}),children:(0,t.jsx)(at.Z,{id:"create-log-".concat(m.id),height:"200px",style:{fontSize:12},ref:$})})}),V=Ue,Re=e(83002),Z=e(60940),Be=e(55241),Ve=e(78451),ee=e(37413),Ee=e(94359),se=e(91806),le=e(60433),S=e(99611),je=e(99922),Pe=e(67007),He=e(87662),Ne=e(5251),Xe=e(24905);function it(m){var ne=(0,c.useState)(""),k=A()(ne,2),$=k[0],D=k[1],fe=(0,c.useRef)(),Le=(0,c.useRef)(),Ce=(0,c.useState)(),b=A()(Ce,2),x=b[0],ue=b[1],ve=new h.Uo("components.appCompose"),re=(0,c.useRef)(),_e=(0,c.useState)(),Me=A()(_e,2),Je=Me[0],qe=Me[1],et=(0,c.useState)(),tt=A()(et,2),Ge=tt[0],a=tt[1];return(0,c.useEffect)(function(){return(0,He.K3)().then(function(H){var Q;D((Q=H.data.serverUrl)!==null&&Q!==void 0?Q:"")}),ue(!1),m.containerList&&qe(m.containerList.filter(function(H){return H.status!=""}).map(function(H){return H.service})),a(m.containerList),function(){a([])}},[m.containerList]),(0,t.jsxs)(f.Z,{ghost:!0,title:(0,t.jsx)(se.Z,{}),subTitle:ve.format("detailContainerTitle"),extra:m.enableSelectService&&(0,t.jsx)(Ie.Z,{checked:x,onChange:function(Q){ue(Q.target.checked)},children:ve.format("selectService")},"selectService"),children:[(0,t.jsx)(je.Z,{showFileExplorer:!0,ref:fe}),(0,t.jsx)(Xe.Z,{ref:re}),(0,t.jsx)(Pe.Z,{ref:Le}),(0,t.jsx)(Z.Z,{scroll:{x:"max-content"},rowKey:"service",pagination:!1,columns:[{title:h.FD.format("listName"),dataIndex:"name",width:200,render:function(Q,g,de){return(0,t.jsx)(Qe.Z,{title:g.service,children:(0,t.jsx)(Ve.Z,{content:g.name?(0,Ne.fi)(g.name,"/"):g.service})})}},{title:h.FD.format("listPort"),render:function(Q,g,de){var N=[],L=[];return g.publishers&&g.publishers.map(function(pe){pe.publishedPort?N.push({PrivatePort:pe.targetPort,Type:pe.protocol,IP:pe.url,PublicPort:pe.publishedPort}):pe.publishedPort&&L.push({PrivatePort:pe.targetPort,Type:pe.protocol,IP:pe.url,PublicPort:pe.publishedPort})}),(0,t.jsx)(ee.Z,{publicPort:N,privatePort:L,domain:[],serverIp:$})}},{title:h.FD.format("listStatus"),render:function(Q,g,de){return(0,t.jsx)(Ee.Z,{status:"container.".concat(g.state),tip:"".concat(g.state," ").concat(g.status)},g.name)}},{title:h.FD.format("listManage"),fixed:"right",render:function(Q,g,de){return(0,t.jsxs)(n.Z,{split:(0,t.jsx)(Y.Z,{type:"vertical"}),children:[g.name==""&&(0,t.jsx)(Be.Z,{placement:"left",content:(0,t.jsx)(f.Z,{ghost:!0,title:h.FD.format("listManageShowContainerEnv"),children:(0,t.jsx)(n.Z,{direction:"vertical",children:g.environment&&Object.keys(g.environment).map(function(N){if(g.environment&&g.environment[N])return(0,t.jsx)(B.Z.Text,{code:!0,children:"".concat(N,"=").concat(g.environment[N])},N)})})}),children:(0,t.jsx)(le.Z,{})}),g.name!=""&&(0,t.jsx)(B.Z.Link,{onClick:function(){var L;(L=Le.current)===null||L===void 0||L.show(g.name)},children:(0,t.jsx)(S.Z,{})},"container"),g.state=="running"&&(0,t.jsx)(B.Z.Link,{onClick:function(){var L;(L=fe.current)===null||L===void 0||L.show({url:"/console/container/".concat((0,Ne.fi)(g.name,"/")),title:g.name})},children:(0,t.jsx)(ke.Z,{})},"console"),g.state=="running"&&(0,t.jsx)(B.Z.Link,{onClick:function(){var L;(L=re.current)===null||L===void 0||L.showContainer((0,Ne.fi)(g.name,"/"))},children:(0,t.jsx)(oe.Z,{})},"file")]})}}],dataSource:Ge,rowSelection:x&&Ge?{selectedRowKeys:Je,onChange:function(Q,g,de){qe(Q),m.selectServiceFinish&&m.selectServiceFinish(Q)}}:void 0})]})}var U=e(91058),F=e(82848),M=e(2831),Fe=e(16970),te=(0,c.forwardRef)(function(m,ne){var k,$=(0,Ae.useAccess)(),D=new h.Uo("components.appCompose"),fe=new h.Uo("components.network"),Le=(0,c.useState)(0),Ce=A()(Le,2),b=Ce[0],x=Ce[1],ue=(0,c.useState)(!1),ve=A()(ue,2),re=ve[0],_e=ve[1],Me=(0,c.useState)(!1),Je=A()(Me,2),qe=Je[0],et=Je[1],tt=(0,c.useState)(),Ge=A()(tt,2),a=Ge[0],H=Ge[1],Q=(0,c.useRef)(),g=(0,c.useRef)(),de=(0,c.useRef)(),N=(0,c.useRef)(),L=(0,c.useRef)(),pe=(0,c.useRef)(),dt=(0,c.useRef)(),mt=(0,c.useState)(),ct=A()(mt,2),nt=ct[0],ot=ct[1];(0,c.useImperativeHandle)(ne,function(){return{show:function(r){return E()(u()().mark(function d(){return u()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:ot(r),_e(!0);case 2:case"end":return R.stop()}},d)}))()}}}),(0,c.useEffect)(function(){nt&&(et(!0),(0,K.Pn)({id:nt}).finally(E()(u()().mark(function v(){return u()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:et(!1);case 1:case"end":return d.stop()}},v)}))).then(function(v){var r=v.data.detail;r.setting.status&&r.setting.status.includes("running")&&(r.isRunning=!0),r.setting.status&&r.setting.status.includes("paused")&&(r.isPaused=!0),r.setting.status&&r.setting.status.includes("exited")&&(r.isExited=!0),r.setting.status&&r.setting.status.includes("waiting")?r.isDeploy=!1:r.isDeploy=!0,r.setting.status&&r.setting.status.includes("created")&&(r.isCreated=!0,r.isDeploy=!1);var d=v.data.project;if(d&&d.services&&(r.imageList=y()(new Set(Object.keys(d.services).map(function(ce){var P;return(P=d.services[ce].image)!==null&&P!==void 0?P:""})))),r.containerList=v.data.containerList,r.containerList||(r.containerList=[]),d!=null&&d.services&&Object.entries(d==null?void 0:d.services).forEach(function(ce){var P,Te=A()(ce,2),Oe=Te[0],De=Te[1],We=r.containerList.find(function(W){return W.service==Oe});We||r.containerList.push({project:(P=d.name)!==null&&P!==void 0?P:"",name:"",service:Oe,publishers:De.ports?De.ports.map(function(W){var $e;return{url:"",targetPort:W.target,publishedPort:parseInt(W.published),protocol:($e=W.protocol)!==null&&$e!==void 0?$e:""}}):[],state:"waiting",status:"",environment:De.environment})}),r.containerList){var j;(j=de.current)===null||j===void 0||j.setFieldValue("deployServiceName",v.data.detail.setting.deployServiceName)}if(H(s()(s()({},v.data),{detail:r})),v.data.detail.setting.environment){var R;(R=de.current)===null||R===void 0||R.setFieldValue("environment",v.data.detail.setting.environment)}}))},[b,nt]);function ft(v){return st.apply(this,arguments)}function st(){return st=E()(u()().mark(function v(r){var d,j,R;return u()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if((d=L.current)===null||d===void 0||d.show(),!r.pullImageUseDPanel){P.next=5;break}return P.next=4,(j=Q.current)===null||j===void 0?void 0:j.start();case 4:(R=Q.current)===null||R===void 0||R.finish();case 5:return P.prev=5,P.next=8,(0,K.Oh)(r);case 8:m.onDeployFinish&&m.onDeployFinish(),P.next=14;break;case 11:P.prev=11,P.t0=P.catch(5),m.onDeployFailed&&m.onDeployFailed();case 14:x(b+1);case 15:case"end":return P.stop()}},v,null,[[5,11]])})),st.apply(this,arguments)}return(0,t.jsxs)(ae.Z,{drawerProps:{width:w.R_,destroyOnHidden:!0},requestLoading:qe,title:a?D.format("drawerTitle",{name:(k=a==null?void 0:a.detail.name)!==null&&k!==void 0?k:""}):D.format("createTitle"),open:re,onOpenChange:function(r){r||(ot(void 0),H(void 0),m.onClose&&m.onClose()),_e(r)},submitter:!1,formRef:de,children:[a&&!(0,ze.Z)(a.detail.imageList)&&(0,t.jsx)(Ke.Z,{ref:Q,image:a.detail.imageList}),(0,t.jsx)(Xe.Z,{ref:dt}),(0,t.jsxs)(f.Z,{direction:"column",ghost:!0,gutter:[0,10],children:[a&&a.detail.setting.type=="dangling"&&(0,t.jsx)(C.Z,{type:"warning",showIcon:!0,description:(0,t.jsxs)("div",{children:[D.format("managerStatusDanglingAlert",{name:a.detail.name})," ",(0,t.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-outpath",target:"_blank",children:h.FD.format("help")})]})}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(f.Z,{title:(0,t.jsx)(ie.Z,{}),subTitle:D.format("managerContainerTitle"),ghost:!0,children:(0,t.jsxs)(n.Z,{wrap:!0,split:(0,t.jsx)(Y.Z,{type:"vertical"}),children:[(0,t.jsxs)(Ye.u,{access:"canSeeComposeListManage",space:{},children:[(0,t.jsx)(xe.Z,{buttonProps:{icon:(0,t.jsx)(G.Z,{}),type:"primary"},confirmProps:{onOpenChange:function(r,d){var j;r&&(!((j=g.current)===null||j===void 0)&&j.resetFields)&&g.current.resetFields()},description:(0,t.jsxs)(n.Z,{style:{width:300},direction:"vertical",children:[(0,t.jsx)(B.Z.Text,{children:D.format("managerCreateTip")}),(0,t.jsxs)(T.A,{name:"createForm",formRef:g,layout:"inline",submitter:!1,children:[(0,t.jsx)(Ze.Z.Group,{name:"pullImageUse",layout:"vertical",fieldProps:{style:{display:"flex",flexDirection:"column",gap:8}},options:D.option("managerCreatePullImageUseOption",["useCommand","useDPanel"])}),(0,t.jsx)(p.Z,{initialValue:!0,name:"createPath",valuePropName:"checked",children:(0,t.jsx)(Ie.Z,{children:D.format("managerCreateCreatePath")})}),(0,t.jsx)(p.Z,{initialValue:!0,name:"removeOrphans",valuePropName:"checked",children:(0,t.jsx)(Ie.Z,{defaultChecked:!0,children:D.format("managerCreateRemoveOrphans")})})]})]})},action:E()(u()().mark(function v(){var r,d,j,R,ce,P,Te,Oe,De,We,W,$e,rt;return u()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return X.prev=0,X.next=3,(De=de.current)===null||De===void 0?void 0:De.validateFields();case 3:X.next=8;break;case 5:return X.prev=5,X.t0=X.catch(0),X.abrupt("return");case 8:return We=a?a.detail.id||a.detail.name:(r=de.current)===null||r===void 0?void 0:r.getFieldValue("name"),W={id:We,createPath:(d=(j=g.current)===null||j===void 0?void 0:j.getFieldValue("createPath"))!==null&&d!==void 0?d:!1,removeOrphans:(R=(ce=g.current)===null||ce===void 0?void 0:ce.getFieldValue("removeOrphans"))!==null&&R!==void 0?R:!0},((P=g.current)===null||P===void 0?void 0:P.getFieldValue("pullImageUse"))=="useDPanel"&&(W.pullImage=!1,W.pullImageUseDPanel=!0),((Te=g.current)===null||Te===void 0?void 0:Te.getFieldValue("pullImageUse"))=="useCommand"&&(W.pullImage=!0),$e=((Oe=de.current)===null||Oe===void 0?void 0:Oe.getFieldsFormatValue)&&de.current.getFieldsFormatValue(!0),W.environment=$e.environment,W.deployServiceName=$e.deployServiceName,X.next=17,(0,K.im)({id:a.detail.id.toString(),name:a.detail.name,environment:$e.environment,type:a.detail.setting.type});case 17:if(!(a!=null&&a.detail.isDeploy&&W.deployServiceName)){X.next=23;break}if(rt=[],a.detail.containerList.forEach(function(lt){var ut;lt.status!=""&&!((ut=W.deployServiceName)!==null&&ut!==void 0&&ut.includes(lt.service))&&rt.push(lt.service)}),(0,ze.Z)(rt)){X.next=23;break}return X.next=23,(0,K.j6)({id:We,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1,destroyServiceName:rt});case 23:return X.abrupt("return",ft(W));case 24:case"end":return X.stop()}},v,null,[[0,5]])})),children:D.format(a!=null&&a.detail.isDeploy?"managerUpgradeButton":"managerCreateButton")},"deploy"),(a.detail.isDeploy||a.detail.isCreated)&&(0,t.jsx)(xe.Z,{action:function(){var r;return(r=L.current)===null||r===void 0||r.show(),(0,K.j6)({id:a.detail.id||a.detail.name,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1})},onSuccess:function(){x(b+1)},buttonProps:{type:"primary",danger:!0,icon:(0,t.jsx)(q.Z,{})},confirmProps:{showCommonConfirm:!0},children:D.format("managerDeleteContainerButton")},"destroyContainer")]}),a.detail.isDeploy&&(0,t.jsxs)(Ye.u,{access:"canSeeComposeList",space:{direction:"horizontal"},children:[(0,t.jsx)(xe.Z,{buttonProps:{icon:(0,t.jsx)(G.Z,{})},action:E()(u()().mark(function v(){var r;return u()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return(r=L.current)===null||r===void 0||r.show(),j.abrupt("return",(0,K.GG)({id:a.detail.id||a.detail.name,op:"restart"}));case 2:case"end":return j.stop()}},v)})),onSuccess:function(){x(b+1)},children:D.format("managerRestartButton")},"restart"),(0,t.jsx)(xe.Z,{action:function(){var r;return(r=L.current)===null||r===void 0||r.show(),(0,K.GG)({id:a.detail.id||a.detail.name,op:"stop"})},buttonProps:{icon:(0,t.jsx)(me.Z,{}),disabled:a.detail.isExited},onSuccess:function(){x(b+1)},children:D.format("managerStopButton")},"stop"),a.detail.isPaused&&(0,t.jsx)(xe.Z,{action:function(){var r;return(r=L.current)===null||r===void 0||r.show(),(0,K.GG)({id:a.detail.id||a.detail.name,op:"unpause"})},onSuccess:function(){x(b+1)},buttonProps:{icon:(0,t.jsx)(z.Z,{})},children:D.format("managerUnpauseButton")},"unpause"),!a.detail.isPaused&&(0,t.jsx)(xe.Z,{action:function(){var r;return(r=L.current)===null||r===void 0||r.show(),(0,K.GG)({id:a.detail.id||a.detail.name,op:"pause"})},onSuccess:function(){x(b+1)},buttonProps:{icon:(0,t.jsx)(O.Z,{}),disabled:!a.detail.isRunning},children:D.format("managerPauseButton")},"pause"),a.detail.isDeploy&&(0,t.jsx)(Re.Z,{composeItem:a.detail,showTriggerButton:!0},"composeLog")]}),a.detail.id>0&&$.canSeeComposeListManageDelete&&(0,t.jsx)(xe.Z,{buttonProps:{type:"dashed",danger:!0,icon:(0,t.jsx)(q.Z,{})},confirmProps:{onOpenChange:function(r,d){var j;!((j=N.current)===null||j===void 0)&&j.resetFields&&N.current.resetFields()},description:(0,t.jsxs)(n.Z,{style:{width:280},direction:"vertical",children:[(0,t.jsx)(B.Z.Text,{children:D.format("managerDeleteTaskTip")}),(0,t.jsxs)(T.A,{formRef:N,layout:"inline",submitter:!1,children:[(0,t.jsx)(p.Z,{initialValue:!0,name:"deleteImage",valuePropName:"checked",children:(0,t.jsx)(Ie.Z,{children:D.format("managerDeleteTaskDeleteImage")})}),(0,t.jsx)(p.Z,{addonAfter:(0,t.jsx)(Qe.Z,{title:D.format("managerDeleteTaskDeleteVolumeTip"),children:(0,t.jsx)(we.Z,{})}),initialValue:!0,name:"deleteVolume",valuePropName:"checked",children:(0,t.jsx)(Ie.Z,{children:D.format("managerDeleteTaskDeleteVolume")})}),(0,t.jsx)(p.Z,{initialValue:!0,name:"deletePath",valuePropName:"checked",children:(0,t.jsx)(Ie.Z,{children:D.format("managerDeleteTaskDeletePath")})})]})]})},action:E()(u()().mark(function v(){var r,d,j,R,ce,P,Te,Oe,De;return u()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return(r=L.current)===null||r===void 0||r.show(),W.next=3,(0,K.j6)({id:(d=(j=a.detail)===null||j===void 0?void 0:j.id)!==null&&d!==void 0?d:a.detail.name,deleteImage:(R=(ce=N.current)===null||ce===void 0?void 0:ce.getFieldValue("deleteImage"))!==null&&R!==void 0?R:!1,deleteVolume:(P=(Te=N.current)===null||Te===void 0?void 0:Te.getFieldValue("deleteVolume"))!==null&&P!==void 0?P:!1,deletePath:(Oe=(De=N.current)===null||De===void 0?void 0:De.getFieldValue("deletePath"))!==null&&Oe!==void 0?Oe:!1,deleteData:!0});case 3:_e(!1),H(void 0),m.onClose&&m.onClose();case 6:case"end":return W.stop()}},v)})),children:D.format("managerDeleteTaskButton")},"deleteTask"),m.showBackListButton&&(0,t.jsx)(Ae.Link,{to:"/compose/list",children:(0,t.jsx)(i.ZP,{children:h.Ob.format("compose.list")})})]})},"operator"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(f.Z,{title:(0,t.jsx)(ie.Z,{}),subTitle:D.format("managerTitle"),ghost:!0,children:(0,t.jsxs)(n.Z,{children:[$.canSeeComposeListManage&&(0,t.jsx)(F.Z,{id:nt,onFinish:function(){var v=E()(u()().mark(function r(d){return u()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:ot(d),x(b+1);case 2:case"end":return R.stop()}},r)}));return function(r){return v.apply(this,arguments)}}()}),$.canSeeComposeListManageCreate&&(a==null?void 0:a.detail.setting.type)!="outPath"&&(0,t.jsx)(i.ZP,{icon:(0,t.jsx)(oe.Z,{}),onClick:E()(u()().mark(function v(){var r,d,j,R;return u()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(0,M.aF)();case 2:d=P.sent,d.data&&(r=d.data.dpanel.containerInfo)!==null&&r!==void 0&&r.Name&&((j=dt.current)===null||j===void 0||j.showContainer((R=d.data.dpanel.containerInfo)===null||R===void 0?void 0:R.Name,"/dpanel/compose/".concat(a==null?void 0:a.detail.name)));case 4:case"end":return P.stop()}},v)})),children:h.FD.format("listManageFilePath")}),(0,t.jsx)(Y.Z,{type:"vertical"}),$.canSeeComposeListManage&&(0,t.jsx)(Fe.Z,{trigger:(0,t.jsx)(i.ZP,{icon:(0,t.jsx)(l.Z,{}),children:fe.format("createTitle")},"network")},"network-create"),(0,t.jsx)(i.ZP,{icon:(0,t.jsx)(G.Z,{}),onClick:function(){var r;(r=L.current)===null||r===void 0||r.close(),x(b+1)},children:h.FD.format("listManageRefresh")})]})},"manager"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(V,{ref:L,id:(a==null?void 0:a.detail.id)||(a==null?void 0:a.detail.name)}),a&&a.containerList&&(0,t.jsx)(it,{containerList:a==null?void 0:a.containerList,enableSelectService:(a==null?void 0:a.detail.setting.type)!="dangling",selectServiceFinish:function(r){var d;(d=de.current)===null||d===void 0||d.setFieldValue("deployServiceName",r)}}),(0,t.jsx)(p.Z,{name:"deployServiceName",hidden:!0}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(U.Z,{drawerProps:{ghost:!0,title:(0,t.jsx)(o.Z,{}),subTitle:"".concat(D.format("createEnvTitle"))},showDisableName:!0,showDeleteButton:!1,name:"environment",ref:pe})]})]})}),Se=te},75544:function(be,he,e){var ge=e(5574),s=e.n(ge),ye=e(12323),y=e(78267),I=e.n(y),u=e(75458),J=e.n(u),E=e(67294),_=e(4244),A=e.n(_),c=e(24078),w=e(85893),h,f,T,Ze=(0,E.forwardRef)(function(p,K){var ae,ie=(0,E.useState)(!0),G=s()(ie,2),q=G[0],me=G[1];return(0,E.useEffect)(function(){return h=new _.Terminal(ye.X),f=new u.SearchAddon,T=new y.FitAddon,window.addEventListener("resize",function(){p.showInModal||T.fit()}),p.style&&p.style.fontSize&&(h.options.fontSize=p.style.fontSize),h.loadAddon(T),h.loadAddon(f),h.open(document.getElementById(p.id?p.id:"terminal-container")),p.showInModal||T.fit(),function(){h.reset(),me(!0)}},[]),(0,E.useImperativeHandle)(K,function(){return{write:function(O){q&&(T.fit(),me(!1)),h.write(O)},clear:function(){h.clear()},getTerminal:function(){return h},findNext:function(O){f.findNext(O)},findPrev:function(O){f.findPrevious(O)},fit:function(){T.fit()},onData:function(O){return h.onData(O)}}}),(0,w.jsx)("div",{id:p.id?p.id:"terminal-container",style:{width:p.width?p.width:"100%",height:p.height?p.height:"500px",marginTop:(ae=p.style)===null||ae===void 0?void 0:ae.marginTop}})});he.Z=Ze},2831:function(be,he,e){e.d(he,{Ll:function(){return A},aF:function(){return u},u5:function(){return E}});var ge=e(15009),s=e.n(ge),ye=e(99289),y=e.n(ye),I=e(82346);function u(){return J.apply(this,arguments)}function J(){return J=y()(s()().mark(function w(){return s()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,I.request)("/api/common/home/info",{method:"POST"});case 2:return f.abrupt("return",f.sent);case 3:case"end":return f.stop()}},w)})),J.apply(this,arguments)}function E(){return _.apply(this,arguments)}function _(){return _=y()(s()().mark(function w(){return s()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,I.request)("/api/common/home/check-new-version",{method:"POST"});case 2:return f.abrupt("return",f.sent);case 3:case"end":return f.stop()}},w)})),_.apply(this,arguments)}function A(){return c.apply(this,arguments)}function c(){return c=y()(s()().mark(function w(){return s()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,I.request)("/api/common/home/usage",{method:"POST"});case 2:return f.abrupt("return",f.sent);case 3:case"end":return f.stop()}},w)})),c.apply(this,arguments)}},90098:function(be,he,e){e.d(he,{GG:function(){return Ze},MG:function(){return q},Oh:function(){return w},Pn:function(){return A},Yz:function(){return K},iE:function(){return z},im:function(){return u},j6:function(){return f},pm:function(){return E},tw:function(){return we},vf:function(){return ie}});var ge=e(15009),s=e.n(ge),ye=e(99289),y=e.n(ye),I=e(82346);function u(l){return J.apply(this,arguments)}function J(){return J=y()(s()().mark(function l(o){return s()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,I.request)("/api/app/compose/create",{method:"POST",data:o}));case 1:case"end":return n.stop()}},l)})),J.apply(this,arguments)}function E(l){return _.apply(this,arguments)}function _(){return _=y()(s()().mark(function l(o){return s()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,I.request)("/api/app/compose/get-list",{method:"POST",data:o}));case 1:case"end":return n.stop()}},l)})),_.apply(this,arguments)}function A(l){return c.apply(this,arguments)}function c(){return c=y()(s()().mark(function l(o){return s()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,I.request)("/api/app/compose/get-task",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),c.apply(this,arguments)}function w(l){return h.apply(this,arguments)}function h(){return h=y()(s()().mark(function l(o){return s()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,I.request)("/api/app/compose/container-deploy",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),h.apply(this,arguments)}function f(l){return T.apply(this,arguments)}function T(){return T=y()(s()().mark(function l(o){return s()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,I.request)("/api/app/compose/container-destroy",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),T.apply(this,arguments)}function Ze(l){return p.apply(this,arguments)}function p(){return p=y()(s()().mark(function l(o){return s()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,I.request)("/api/app/compose/container-ctrl",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),p.apply(this,arguments)}function K(l){return ae.apply(this,arguments)}function ae(){return ae=y()(s()().mark(function l(o){return s()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,I.request)("/api/app/compose/container-log",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),ae.apply(this,arguments)}function ie(l){return G.apply(this,arguments)}function G(){return G=y()(s()().mark(function l(o){return s()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.download=!0,o.id=String(o.id),n.next=4,(0,I.request)("/api/app/compose/container-log",{method:"POST",data:o,responseType:"blob"});case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},l)})),G.apply(this,arguments)}function q(l){return me.apply(this,arguments)}function me(){return me=y()(s()().mark(function l(o){return s()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,I.request)("/api/app/compose/get-from-uri",{method:"POST",data:o}));case 1:case"end":return n.stop()}},l)})),me.apply(this,arguments)}function z(l){return O.apply(this,arguments)}function O(){return O=y()(s()().mark(function l(o){return s()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,I.request)("/api/common/store/deploy",{method:"POST",data:o}));case 1:case"end":return n.stop()}},l)})),O.apply(this,arguments)}function we(l){return oe.apply(this,arguments)}function oe(){return oe=y()(s()().mark(function l(o){return s()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,I.request)("/api/app/compose/download",{method:"POST",data:o,responseType:"blob"}));case 2:case"end":return n.stop()}},l)})),oe.apply(this,arguments)}}}]);
