"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1218],{83002:function(Qe,Ze,e){var Ee=e(5574),c=e.n(Ee),Te=e(15009),P=e.n(Te),A=e(99289),s=e.n(A),je=e(83622),O=e(85265),G=e(67294),B=e(81146),m=e(1883),b=e(90098),y=e(3616),W=e(36146),S=e(85893),Oe=(0,G.forwardRef)(function(v,K){(0,G.useImperativeHandle)(K,function(){return{show:function(o){return s()(P()().mark(function j(){return P()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:we(o),_(!0);case 2:case"end":return H.stop()}},j)}))()}}});var re=(0,G.useState)(!1),ae=c()(re,2),Q=ae[0],_=ae[1],ce=(0,G.useState)(),Y=c()(ce,2),Z=Y[0],we=Y[1],ie=(0,G.useRef)();return(0,S.jsxs)(S.Fragment,{children:[v.showTriggerButton&&(0,S.jsx)(je.ZP,{onClick:s()(P()().mark(function l(){return P()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:we(v.composeItem),_(!0);case 2:case"end":return j.stop()}},l)})),icon:(0,S.jsx)(m.Z,{}),children:W.FD.format("listManageLog")},"log"),(0,S.jsx)(O.Z,{title:W.FD.format("listLog"),open:Q,forceRender:!0,onClose:function(){_(!1)},afterOpenChange:function(o){if(o)setTimeout(function(){var n,H;(n=ie.current)===null||n===void 0||n.start(),(H=ie.current)===null||H===void 0||H.fit()},1e3);else{var j;(j=ie.current)===null||j===void 0||j.close()}},width:y.FK,children:Z&&Q&&(0,S.jsx)(B.Z,{ref:ie,showInDrawer:!0,id:"compose:log:".concat(String(Z.id||Z.name)),request:function(){var l=s()(P()().mark(function o(j){var n;return P()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,(0,b.Yz)({id:Z.id||Z.name,lineTotal:j.lineTotal,download:(n=j.download)!==null&&n!==void 0?n:!1,showTime:j.showTime});case 2:case"end":return I.stop()}},o)}));return function(o){return l.apply(this,arguments)}}(),download:function(){var l=s()(P()().mark(function o(j){var n;return P()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,(0,b.vf)({id:Z.id||Z.name,lineTotal:j.lineTotal,showTime:j.showTime,download:!0});case 2:return n=I.sent,I.abrupt("return",{data:new Blob([n],{type:"text/plain"}),name:v.composeItem.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return I.stop()}},o)}));return function(o){return l.apply(this,arguments)}}()})})]})});Ze.Z=Oe},82848:function(Qe,Ze,e){e.d(Ze,{Z:function(){return t}});var Ee=e(15009),c=e.n(Ee),Te=e(99289),P=e.n(Te),A=e(97857),s=e.n(A),je=e(5574),O=e.n(je),G=e(3616),B=e(24963),m=e(90098),b=e(36146),y=e(86548),W=e(33862),S=e(38345),Oe=e(24739),v=e(5966),K=e(86615),re=e(97462),ae=e(62370),Q=e(95213),_=e(11106),ce=e(92398),Y=e(42075),Z=e(83622),we=e(83062),ie=e(40411),l=e(71230),o=e(15746),j=e(40056),n=e(67294),H=e(12491),I=e(85060),$e=e(97269),ze=e(86738),i=e(85893),Pe=(0,n.forwardRef)(function(Ue,V){(0,n.useImperativeHandle)(V,function(){return{}});var Ce=(0,n.useRef)(),E=(0,n.useState)(!1),We=O()(E,2),be=We[0],q=We[1];return(0,i.jsx)(ae.Z,{children:(0,i.jsx)(ze.Z,{icon:!1,title:!1,description:(0,i.jsx)($e.A,{name:"importRemote",layout:"horizontal",submitter:!1,formRef:Ce,children:(0,i.jsx)(v.Z,{width:"lg",label:"Url",initialValue:Ue.defaultUrl,name:"url",placeholder:"https:// or http://"})}),onOpenChange:function(oe){if(!oe){var le;(le=Ce.current)===null||le===void 0||le.resetFields()}},onConfirm:P()(c()().mark(function xe(){var oe,le,R;return c()().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:if(le=(oe=Ce.current)===null||oe===void 0?void 0:oe.getFieldValue("url"),le){he.next=3;break}return he.abrupt("return");case 3:return q(!0),he.next=6,(0,m.MG)({uri:le}).finally(function(){q(!1)});case 6:R=he.sent,Ue.onFinish&&Ue.onFinish(R.data.content,le);case 8:case"end":return he.stop()}},xe)})),children:(0,i.jsx)(Z.ZP,{loading:be,icon:(0,i.jsx)(I.Z,{}),block:!0,onClick:function(){var oe;(oe=Ce.current)===null||oe===void 0||oe.resetFields()},children:Ue.title})})})}),Be=Pe,Ye=e(91058),Ve=e(79245),He=e(27166),Xe=e(82346),at=function(V){var Ce,E=new b.Uo("components.appCompose"),We=(0,n.useContext)(B.Z),be=We.message,q=(0,n.useRef)(),xe=(0,n.useRef)(),oe=(0,n.useState)(),le=O()(oe,2),R=le[0],pe=le[1],he=(0,n.useState)(!1),Je=O()(he,2),Ne=Je[0],ke=Je[1];(0,n.useEffect)(function(){if(q.current){if(!V.id){pe({yaml:"",override:""});return}(0,m.Pn)({id:V.id}).then(function($){var T,L;pe({yaml:$.data.yaml[0],override:(T=$.data.yaml[1])!==null&&T!==void 0?T:""}),(L=q.current)===null||L===void 0||L.setFieldsValue({name:$.data.detail.name,title:$.data.detail.title,type:$.data.detail.setting.type,environment:$.data.detail.setting.environment,remoteUrl:$.data.detail.setting.remoteUrl})})}},[q.current,V.id]);var it=(0,i.jsx)(ce.Z,{tabBarExtraContent:(0,i.jsxs)(Y.Z,{children:[(0,i.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-override",target:"_blank",children:b.FD.format("help")}),(0,i.jsx)(Z.ZP,{type:"link",onClick:function(){},children:b.FD.format("listManageFullScreen")})]}),items:[{label:E.format("createYaml.yaml"),key:"yaml",children:R&&(0,i.jsx)(_.ZP,{theme:"dark",height:"600px",onChange:function(T){pe(s()(s()({},R),{yaml:T}))},onFocus:function(){var T;((T=q.current)===null||T===void 0?void 0:T.getFieldValue("type"))=="remoteUrl"&&be.info(E.format("createYamlDisableEdit"))},readOnly:((Ce=q.current)===null||Ce===void 0?void 0:Ce.getFieldValue("type"))=="remoteUrl",value:R.yaml,extensions:[Q.RI.yaml()]})},{label:(0,i.jsx)(we.Z,{title:E.format("createYamlOverrideTip"),children:(0,i.jsx)(ie.Z,{count:(R==null?void 0:R.override)&&b.FD.format("listInUse"),offset:[15,-5],children:E.format("createYaml.override")})}),key:"yamlOverride",children:R&&(0,i.jsx)(_.ZP,{theme:"dark",height:"600px",onChange:function(T,L){pe(s()(s()({},R),{override:T}))},value:R==null?void 0:R.override,extensions:[Q.RI.yaml()]})}]},"yamlEditor");return(0,i.jsxs)(He.Z,{requestLoading:R==null&&V.id!=null,drawerProps:{width:G.R_,destroyOnHidden:!0},open:Ne,onOpenChange:function(T){if(ke(T),!T){var L;pe(void 0),(L=q.current)===null||L===void 0||L.resetFields()}},title:E.format("yamlDrawerTitle"),formRef:q,trigger:(0,i.jsx)(Z.ZP,{type:"primary",icon:V.id?(0,i.jsx)(y.Z,{}):void 0,children:b.Ob.format(V.id?"compose.list.edit":"compose.list.create")}),onFinish:function(){var $=P()(c()().mark(function T(L){var Fe,ee;return c()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.prev=0,Fe={id:V.id&&V.id.toString(),type:L.type,name:L.name,title:L.title,environment:L.environment,remoteUrl:L.remoteUrl,yaml:R==null?void 0:R.yaml,yamlOverride:R==null?void 0:R.override},d.next=4,(0,m.im)(Fe);case 4:return ee=d.sent,V.onFinish&&V.onFinish(ee.data.id),d.abrupt("return",!0);case 9:return d.prev=9,d.t0=d.catch(0),d.abrupt("return",!1);case 12:case"end":return d.stop()}},T,null,[[0,9]])}));return function(T){return $.apply(this,arguments)}}(),children:[(0,i.jsx)(S.Z,{ghost:!0,children:(0,i.jsxs)(Oe.UW,{children:[(0,i.jsx)(v.Z,{label:E.format("createFormName"),name:"name",width:"md",required:!0,disabled:!!V.id,rules:[{required:!0},{pattern:/^[a-zA-Z0-9_-]+$/,message:E.format("createFormNameRule")}],placeholder:E.format("createFormNameEmpty")}),(0,i.jsx)(v.Z,{label:E.format("createFormTitle"),name:"title",width:"md"})]})},"createForm"),(0,i.jsx)(K.Z.Group,{label:E.format("createFormType"),name:"type",initialValue:"text",fieldProps:{defaultValue:"text",onChange:function(){var T;(T=q.current)===null||T===void 0||T.resetFields(["yaml","environment"])}},disabled:!!V.id,options:E.option("createFormTypeOption",["text","remoteUrl","storagePath","store","outPath"]).map(function($){return{label:$.label,value:$.value}})}),(0,i.jsx)(re.Z,{name:["type"],children:function(T){var L=T.type;if(L=="text")return(0,i.jsxs)(l.Z,{gutter:[10,0],children:[(0,i.jsx)(o.Z,{span:12,children:(0,i.jsx)(H.Z,{title:E.format("createFormTypeTextImportFile"),onImport:function(ee){return pe(s()(s()({},R),{yaml:ee})),(0,Ve.m)(ee).map(function(De){var d;(d=xe.current)===null||d===void 0||d.addEnvItem(De.name,De.value)}),!0},onLoad:function(ee){if(ee.indexOf("services:")<0)throw new Error(b.FD.format("commonFileIncorrectFormat",{name:"yaml"}));return!0}},"importFile")}),(0,i.jsx)(o.Z,{span:12,children:(0,i.jsx)(Be,{title:E.format("createFormTypeTextImportRemote"),onFinish:function(){var Fe=P()(c()().mark(function ee(De){return c()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return pe(s()(s()({},R),{yaml:De})),(0,Ve.m)(De).map(function(X){var w;(w=xe.current)===null||w===void 0||w.addEnvItem(X.name,X.value)}),te.abrupt("return",!0);case 3:case"end":return te.stop()}},ee)}));return function(ee){return Fe.apply(this,arguments)}}()},"importRemote")})]});if(L=="remoteUrl")return(0,i.jsx)(l.Z,{gutter:[10,0],children:(0,i.jsxs)(o.Z,{span:24,children:[(0,i.jsx)(ae.Z,{shouldUpdate:!0,children:function(ee){return(0,i.jsx)(Be,{defaultUrl:ee.getFieldValue("remoteUrl"),title:E.format("createFormTypeRemoteImportRemote1"),onFinish:function(){var De=P()(c()().mark(function d(te,X){var w;return c()().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return pe(s()(s()({},R),{yaml:te})),(w=q.current)===null||w===void 0||w.setFieldValue("remoteUrl",X),(0,Ve.m)(te).map(function(Le){var ge;(ge=xe.current)===null||ge===void 0||ge.addEnvItem(Le.name,Le.value)}),me.abrupt("return",!0);case 4:case"end":return me.stop()}},d)}));return function(d,te){return De.apply(this,arguments)}}()},"importRemote1")}}),(0,i.jsx)(ae.Z,{hidden:!0,name:"remoteUrl"},"remoteUrl")]})});if(L=="storagePath")return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(v.Z,{name:"storagePath",required:!0,readonly:!0,initialValue:E.format("createFormTypeStoragePathTip"),addonAfter:(0,i.jsx)("a",{href:"https://dpanel.cc/manual/compose-create",target:"_blank",children:b.FD.format("help")})})});if(L=="store")return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(v.Z,{readonly:!0,name:"store",required:!0,initialValue:E.format("createFormTypeStoreTip"),addonAfter:(0,i.jsx)(Xe.Link,{to:"/compose/appstore",children:b.Ob.format("compose.appstore")})})});if(L=="outPath")return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(v.Z,{name:"outPath",required:!0,readonly:!0,initialValue:E.format("createFormTypeOutPathTip")})})}}),(0,i.jsxs)(S.Z,{ghost:!0,direction:"row",children:[(0,i.jsxs)(S.Z,{ghost:!0,colSpan:"50%",children:[(0,i.jsx)(j.Z,{type:"warning",message:E.format("createFormTypeTextTip"),style:{marginBottom:15}},"yamlTips"),(0,i.jsx)(j.Z,{message:(0,i.jsxs)(i.Fragment,{children:[E.format("createEnvTip1")," ","${DB_NAME}",". ",E.format("createEnvTip2")]})}),(0,i.jsx)(Ye.Z,{drawerProps:{ghost:!0,title:(0,i.jsx)(W.Z,{}),subTitle:E.format("createEnvTitle")},name:"environment",showInDrawer:!0,showImportButton:!V.id,showAddButton:!0,showCodeMode:!V.id,ref:xe})]}),(0,i.jsx)(S.Z,{colSpan:"50%",children:it})]},"yamlEditor")]},"yamlCreate")},t=at},91218:function(Qe,Ze,e){e.d(Ze,{Z:function(){return De}});var Ee=e(97857),c=e.n(Ee),Te=e(19632),P=e.n(Te),A=e(15009),s=e.n(A),je=e(99289),O=e.n(je),G=e(5574),B=e.n(G),m=e(67294),b=e(3616),y=e(36146),W=e(38345),S=e(97269),Oe=e(86615),v=e(62370),K=e(90098),re=e(27166),ae=e(43425),Q=e(33160),_=e(82061),ce=e(87784),Y=e(74842),Z=e(30159),we=e(25035),ie=e(95591),l=e(26522),o=e(33862),j=e(40056),n=e(42075),H=e(96074),I=e(25593),$e=e(84567),ze=e(83062),i=e(83622),Pe=e(80821),Be=e(82346),Ye=e(79697),Ve=e(99861),He=e(1699),Xe=e(89035),at=e(75544),t=e(85893),Ue=(0,m.forwardRef)(function(d,te){(0,m.useImperativeHandle)(te,function(){return{show:function(){return O()(s()().mark(function x(){var se;return s()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return ge(!0),(se=w.current)===null||se===void 0||se.clear(),ne.next=4,new Promise(function(Ae){return setTimeout(function(){var Ie;(Ie=w.current)===null||Ie===void 0||Ie.fit(),Ae(!0)},1e3)});case 4:case"end":return ne.stop()}},x)}))()},close:function(){var x;ge(!1),(x=w.current)===null||x===void 0||x.clear()},cancel:function(){return O()(s()().mark(function x(){var se;return s()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return(se=w.current)===null||se===void 0||se.clear(),X.progress.close("compose:"+d.id),ne.abrupt("return",!0);case 3:case"end":return ne.stop()}},x)}))()}}});var X=(0,Be.useModel)("subscriber"),w=(0,m.useRef)(),C=(0,m.useState)(!1),me=B()(C,2),Le=me[0],ge=me[1];return X.addDataHandler("compose:"+d.id,function(U){var x;(x=w.current)===null||x===void 0||x.write(U.data)}),(0,t.jsx)(W.Z,{hidden:!Le,ghost:!0,title:(0,t.jsx)(Xe.Z,{}),subTitle:"Console",extra:(0,t.jsx)(n.Z,{children:(0,t.jsx)(Pe.Z,{action:O()(s()().mark(function U(){var x;return s()().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return(x=w.current)===null||x===void 0||x.clear(),X.progress.close("compose:"+d.id),fe.abrupt("return");case 3:case"end":return fe.stop()}},U)})),buttonProps:{icon:(0,t.jsx)(_.Z,{}),danger:!0},children:y.FD.format("listManageKill")},"kill")}),children:(0,t.jsx)(at.Z,{id:"create-log-".concat(d.id),height:"200px",style:{fontSize:12},ref:w})})}),V=Ue,Ce=e(83002),E=e(60940),We=e(55241),be=e(78451),q=e(37413),xe=e(94359),oe=e(91806),le=e(60433),R=e(99611),pe=e(99922),he=e(67007),Je=e(87662),Ne=e(5251),ke=e(29463);function it(d){var te=(0,m.useState)(""),X=B()(te,2),w=X[0],C=X[1],me=(0,m.useRef)(),Le=(0,m.useRef)(),ge=(0,m.useState)(),U=B()(ge,2),x=U[0],se=U[1],fe=new y.Uo("components.appCompose"),ne=(0,m.useRef)(),Ae=(0,m.useState)(),Ie=B()(Ae,2),_e=Ie[0],qe=Ie[1],et=(0,m.useState)(),tt=B()(et,2),Ge=tt[0],a=tt[1];return(0,m.useEffect)(function(){return(0,Je.K3)().then(function(J){var z;C((z=J.data.serverUrl)!==null&&z!==void 0?z:"")}),se(!1),d.containerList&&qe(d.containerList.filter(function(J){return J.status!=""}).map(function(J){return J.service})),a(d.containerList),function(){a([])}},[d.containerList]),(0,t.jsxs)(W.Z,{ghost:!0,title:(0,t.jsx)(oe.Z,{}),subTitle:fe.format("detailContainerTitle"),extra:d.enableSelectService&&(0,t.jsx)($e.Z,{checked:x,onChange:function(z){se(z.target.checked)},children:fe.format("selectService")},"selectService"),children:[(0,t.jsx)(pe.Z,{showFileExplorer:!0,ref:me}),(0,t.jsx)(ke.Z,{ref:ne}),(0,t.jsx)(he.Z,{ref:Le}),(0,t.jsx)(E.Z,{scroll:{x:"max-content"},rowKey:"service",pagination:!1,columns:[{title:y.FD.format("listName"),dataIndex:"name",width:200,render:function(z,p,ue){return(0,t.jsx)(ze.Z,{title:p.service,children:(0,t.jsx)(be.Z,{content:p.name?(0,Ne.fi)(p.name,"/"):p.service})})}},{title:y.FD.format("listPort"),render:function(z,p,ue){var N=[],F=[];return p.publishers&&p.publishers.map(function(ve){ve.publishedPort?N.push({PrivatePort:ve.targetPort,Type:ve.protocol,IP:ve.url,PublicPort:ve.publishedPort}):ve.publishedPort&&F.push({PrivatePort:ve.targetPort,Type:ve.protocol,IP:ve.url,PublicPort:ve.publishedPort})}),(0,t.jsx)(q.Z,{publicPort:N,privatePort:F,domain:[],serverIp:w})}},{title:y.FD.format("listStatus"),render:function(z,p,ue){return(0,t.jsx)(xe.Z,{status:"container.".concat(p.state),tip:"".concat(p.state," ").concat(p.status)},p.name)}},{title:y.FD.format("listManage"),fixed:"right",render:function(z,p,ue){return(0,t.jsxs)(n.Z,{split:(0,t.jsx)(H.Z,{type:"vertical"}),children:[p.name==""&&(0,t.jsx)(We.Z,{placement:"left",content:(0,t.jsx)(W.Z,{ghost:!0,title:y.FD.format("listManageShowContainerEnv"),children:(0,t.jsx)(n.Z,{direction:"vertical",children:p.environment&&Object.keys(p.environment).map(function(N){if(p.environment&&p.environment[N])return(0,t.jsx)(I.Z.Text,{code:!0,children:"".concat(N,"=").concat(p.environment[N])},N)})})}),children:(0,t.jsx)(le.Z,{})}),p.name!=""&&(0,t.jsx)(I.Z.Link,{onClick:function(){var F;(F=Le.current)===null||F===void 0||F.show(p.name)},children:(0,t.jsx)(R.Z,{})},"container"),p.state=="running"&&(0,t.jsx)(I.Z.Link,{onClick:function(){var F;(F=me.current)===null||F===void 0||F.show({url:"/console/container/".concat((0,Ne.fi)(p.name,"/")),title:p.name})},children:(0,t.jsx)(Xe.Z,{})},"console"),p.state=="running"&&(0,t.jsx)(I.Z.Link,{onClick:function(){var F;(F=ne.current)===null||F===void 0||F.showContainer((0,Ne.fi)(p.name,"/"))},children:(0,t.jsx)(ie.Z,{})},"file")]})}}],dataSource:Ge,rowSelection:x&&Ge?{selectedRowKeys:_e,onChange:function(z,p,ue){qe(z),d.selectServiceFinish&&d.selectServiceFinish(z)}}:void 0})]})}var $=e(91058),T=e(82848),L=e(2831),Fe=e(16970),ee=(0,m.forwardRef)(function(d,te){var X,w=(0,Be.useAccess)(),C=new y.Uo("components.appCompose"),me=new y.Uo("components.network"),Le=(0,m.useState)(0),ge=B()(Le,2),U=ge[0],x=ge[1],se=(0,m.useState)(!1),fe=B()(se,2),ne=fe[0],Ae=fe[1],Ie=(0,m.useState)(!1),_e=B()(Ie,2),qe=_e[0],et=_e[1],tt=(0,m.useState)(),Ge=B()(tt,2),a=Ge[0],J=Ge[1],z=(0,m.useRef)(),p=(0,m.useRef)(),ue=(0,m.useRef)(),N=(0,m.useRef)(),F=(0,m.useRef)(),ve=(0,m.useRef)(),dt=(0,m.useRef)(),mt=(0,m.useState)(),ct=B()(mt,2),nt=ct[0],ot=ct[1];(0,m.useImperativeHandle)(te,function(){return{show:function(r){return O()(s()().mark(function u(){return s()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:ot(r),Ae(!0);case 2:case"end":return D.stop()}},u)}))()}}}),(0,m.useEffect)(function(){nt&&(et(!0),(0,K.Pn)({id:nt}).finally(O()(s()().mark(function f(){return s()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:et(!1);case 1:case"end":return u.stop()}},f)}))).then(function(f){var r=f.data.detail;r.setting.status&&r.setting.status.includes("running")&&(r.isRunning=!0),r.setting.status&&r.setting.status.includes("paused")&&(r.isPaused=!0),r.setting.status&&r.setting.status.includes("exited")&&(r.isExited=!0),r.setting.status&&r.setting.status.includes("waiting")?r.isDeploy=!1:r.isDeploy=!0,r.setting.status&&r.setting.status.includes("created")&&(r.isCreated=!0,r.isDeploy=!1);var u=f.data.project;if(u&&u.services&&(r.imageList=P()(new Set(Object.keys(u.services).map(function(de){var g;return(g=u.services[de].image)!==null&&g!==void 0?g:""})))),r.containerList=f.data.containerList,r.containerList||(r.containerList=[]),u!=null&&u.services&&Object.entries(u==null?void 0:u.services).forEach(function(de){var g,Re=B()(de,2),Se=Re[0],ye=Re[1],Ke=r.containerList.find(function(M){return M.service==Se});Ke||r.containerList.push({project:(g=u.name)!==null&&g!==void 0?g:"",name:"",service:Se,publishers:ye.ports?ye.ports.map(function(M){var Me;return{url:"",targetPort:M.target,publishedPort:parseInt(M.published),protocol:(Me=M.protocol)!==null&&Me!==void 0?Me:""}}):[],state:"waiting",status:"",environment:ye.environment})}),r.containerList){var h;(h=ue.current)===null||h===void 0||h.setFieldValue("deployServiceName",f.data.detail.setting.deployServiceName)}if(J(c()(c()({},f.data),{detail:r})),f.data.detail.setting.environment){var D;(D=ue.current)===null||D===void 0||D.setFieldValue("environment",f.data.detail.setting.environment)}}))},[U,nt]);function ft(f){return lt.apply(this,arguments)}function lt(){return lt=O()(s()().mark(function f(r){var u,h,D;return s()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if((u=F.current)===null||u===void 0||u.show(),!r.pullImageUseDPanel){g.next=5;break}return g.next=4,(h=z.current)===null||h===void 0?void 0:h.start();case 4:(D=z.current)===null||D===void 0||D.finish();case 5:return g.prev=5,g.next=8,(0,K.Oh)(r);case 8:d.onDeployFinish&&d.onDeployFinish(),g.next=14;break;case 11:g.prev=11,g.t0=g.catch(5),d.onDeployFailed&&d.onDeployFailed();case 14:x(U+1);case 15:case"end":return g.stop()}},f,null,[[5,11]])})),lt.apply(this,arguments)}return(0,t.jsxs)(re.Z,{drawerProps:{width:b.R_,destroyOnHidden:!0},requestLoading:qe,title:a?C.format("drawerTitle",{name:(X=a==null?void 0:a.detail.name)!==null&&X!==void 0?X:""}):C.format("createTitle"),open:ne,onOpenChange:function(r){r||(ot(void 0),J(void 0),d.onClose&&d.onClose()),Ae(r)},submitter:!1,formRef:ue,children:[a&&!(0,Ye.Z)(a.detail.imageList)&&(0,t.jsx)(Ve.Z,{ref:z,image:a.detail.imageList}),(0,t.jsx)(ke.Z,{ref:dt}),(0,t.jsxs)(W.Z,{direction:"column",ghost:!0,gutter:[0,10],children:[a&&a.detail.setting.type=="dangling"&&(0,t.jsx)(j.Z,{type:"warning",showIcon:!0,description:(0,t.jsxs)("div",{children:[C.format("managerStatusDanglingAlert",{name:a.detail.name})," ",(0,t.jsx)("a",{href:"https://dpanel.cc/manual/compose-create-outpath",target:"_blank",children:y.FD.format("help")})]})}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(W.Z,{title:(0,t.jsx)(ae.Z,{}),subTitle:C.format("managerContainerTitle"),ghost:!0,children:(0,t.jsxs)(n.Z,{wrap:!0,split:(0,t.jsx)(H.Z,{type:"vertical"}),children:[(0,t.jsxs)(He.u,{access:"canSeeComposeListManage",space:{},children:[(0,t.jsx)(Pe.Z,{buttonProps:{icon:(0,t.jsx)(Q.Z,{}),type:"primary"},confirmProps:{onOpenChange:function(r,u){var h;r&&(!((h=p.current)===null||h===void 0)&&h.resetFields)&&p.current.resetFields()},description:(0,t.jsxs)(n.Z,{style:{width:300},direction:"vertical",children:[(0,t.jsx)(I.Z.Text,{children:C.format("managerCreateTip")}),(0,t.jsxs)(S.A,{name:"createForm",formRef:p,layout:"inline",submitter:!1,children:[(0,t.jsx)(Oe.Z.Group,{name:"pullImageUse",layout:"vertical",fieldProps:{style:{display:"flex",flexDirection:"column",gap:8}},options:C.option("managerCreatePullImageUseOption",["useCommand","useDPanel"])}),(0,t.jsx)(v.Z,{initialValue:!0,name:"createPath",valuePropName:"checked",children:(0,t.jsx)($e.Z,{children:C.format("managerCreateCreatePath")})}),(0,t.jsx)(v.Z,{initialValue:!0,name:"removeOrphans",valuePropName:"checked",children:(0,t.jsx)($e.Z,{defaultChecked:!0,children:C.format("managerCreateRemoveOrphans")})})]})]})},action:O()(s()().mark(function f(){var r,u,h,D,de,g,Re,Se,ye,Ke,M,Me,rt;return s()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.prev=0,k.next=3,(ye=ue.current)===null||ye===void 0?void 0:ye.validateFields();case 3:k.next=8;break;case 5:return k.prev=5,k.t0=k.catch(0),k.abrupt("return");case 8:return Ke=a?a.detail.id||a.detail.name:(r=ue.current)===null||r===void 0?void 0:r.getFieldValue("name"),M={id:Ke,createPath:(u=(h=p.current)===null||h===void 0?void 0:h.getFieldValue("createPath"))!==null&&u!==void 0?u:!1,removeOrphans:(D=(de=p.current)===null||de===void 0?void 0:de.getFieldValue("removeOrphans"))!==null&&D!==void 0?D:!0},((g=p.current)===null||g===void 0?void 0:g.getFieldValue("pullImageUse"))=="useDPanel"&&(M.pullImage=!1,M.pullImageUseDPanel=!0),((Re=p.current)===null||Re===void 0?void 0:Re.getFieldValue("pullImageUse"))=="useCommand"&&(M.pullImage=!0),Me=((Se=ue.current)===null||Se===void 0?void 0:Se.getFieldsFormatValue)&&ue.current.getFieldsFormatValue(!0),M.environment=Me.environment,M.deployServiceName=Me.deployServiceName,k.next=17,(0,K.im)({id:a.detail.id.toString(),name:a.detail.name,environment:Me.environment,type:a.detail.setting.type});case 17:if(!(a!=null&&a.detail.isDeploy&&M.deployServiceName)){k.next=23;break}if(rt=[],a.detail.containerList.forEach(function(st){var ut;st.status!=""&&!((ut=M.deployServiceName)!==null&&ut!==void 0&&ut.includes(st.service))&&rt.push(st.service)}),(0,Ye.Z)(rt)){k.next=23;break}return k.next=23,(0,K.j6)({id:Ke,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1,destroyServiceName:rt});case 23:return k.abrupt("return",ft(M));case 24:case"end":return k.stop()}},f,null,[[0,5]])})),children:C.format(a!=null&&a.detail.isDeploy?"managerUpgradeButton":"managerCreateButton")},"deploy"),(a.detail.isDeploy||a.detail.isCreated)&&(0,t.jsx)(Pe.Z,{action:function(){var r;return(r=F.current)===null||r===void 0||r.show(),(0,K.j6)({id:a.detail.id||a.detail.name,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1})},onSuccess:function(){x(U+1)},buttonProps:{type:"primary",danger:!0,icon:(0,t.jsx)(_.Z,{})},confirmProps:{showCommonConfirm:!0},children:C.format("managerDeleteContainerButton")},"destroyContainer")]}),a.detail.isDeploy&&(0,t.jsxs)(He.u,{access:"canSeeComposeList",space:{direction:"horizontal"},children:[(0,t.jsx)(Pe.Z,{buttonProps:{icon:(0,t.jsx)(Q.Z,{})},action:O()(s()().mark(function f(){var r;return s()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return(r=F.current)===null||r===void 0||r.show(),h.abrupt("return",(0,K.GG)({id:a.detail.id||a.detail.name,op:"restart"}));case 2:case"end":return h.stop()}},f)})),onSuccess:function(){x(U+1)},children:C.format("managerRestartButton")},"restart"),(0,t.jsx)(Pe.Z,{action:function(){var r;return(r=F.current)===null||r===void 0||r.show(),(0,K.GG)({id:a.detail.id||a.detail.name,op:"stop"})},buttonProps:{icon:(0,t.jsx)(ce.Z,{}),disabled:a.detail.isExited},onSuccess:function(){x(U+1)},children:C.format("managerStopButton")},"stop"),a.detail.isPaused&&(0,t.jsx)(Pe.Z,{action:function(){var r;return(r=F.current)===null||r===void 0||r.show(),(0,K.GG)({id:a.detail.id||a.detail.name,op:"unpause"})},onSuccess:function(){x(U+1)},buttonProps:{icon:(0,t.jsx)(Y.Z,{})},children:C.format("managerUnpauseButton")},"unpause"),!a.detail.isPaused&&(0,t.jsx)(Pe.Z,{action:function(){var r;return(r=F.current)===null||r===void 0||r.show(),(0,K.GG)({id:a.detail.id||a.detail.name,op:"pause"})},onSuccess:function(){x(U+1)},buttonProps:{icon:(0,t.jsx)(Z.Z,{}),disabled:!a.detail.isRunning},children:C.format("managerPauseButton")},"pause"),a.detail.isDeploy&&(0,t.jsx)(Ce.Z,{composeItem:a.detail,showTriggerButton:!0},"composeLog")]}),a.detail.id>0&&w.canSeeComposeListManageDelete&&(0,t.jsx)(Pe.Z,{buttonProps:{type:"dashed",danger:!0,icon:(0,t.jsx)(_.Z,{})},confirmProps:{onOpenChange:function(r,u){var h;!((h=N.current)===null||h===void 0)&&h.resetFields&&N.current.resetFields()},description:(0,t.jsxs)(n.Z,{style:{width:280},direction:"vertical",children:[(0,t.jsx)(I.Z.Text,{children:C.format("managerDeleteTaskTip")}),(0,t.jsxs)(S.A,{formRef:N,layout:"inline",submitter:!1,children:[(0,t.jsx)(v.Z,{initialValue:!0,name:"deleteImage",valuePropName:"checked",children:(0,t.jsx)($e.Z,{children:C.format("managerDeleteTaskDeleteImage")})}),(0,t.jsx)(v.Z,{addonAfter:(0,t.jsx)(ze.Z,{title:C.format("managerDeleteTaskDeleteVolumeTip"),children:(0,t.jsx)(we.Z,{})}),initialValue:!0,name:"deleteVolume",valuePropName:"checked",children:(0,t.jsx)($e.Z,{children:C.format("managerDeleteTaskDeleteVolume")})}),(0,t.jsx)(v.Z,{initialValue:!0,name:"deletePath",valuePropName:"checked",children:(0,t.jsx)($e.Z,{children:C.format("managerDeleteTaskDeletePath")})})]})]})},action:O()(s()().mark(function f(){var r,u,h,D,de,g,Re,Se,ye;return s()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return(r=F.current)===null||r===void 0||r.show(),M.next=3,(0,K.j6)({id:(u=(h=a.detail)===null||h===void 0?void 0:h.id)!==null&&u!==void 0?u:a.detail.name,deleteImage:(D=(de=N.current)===null||de===void 0?void 0:de.getFieldValue("deleteImage"))!==null&&D!==void 0?D:!1,deleteVolume:(g=(Re=N.current)===null||Re===void 0?void 0:Re.getFieldValue("deleteVolume"))!==null&&g!==void 0?g:!1,deletePath:(Se=(ye=N.current)===null||ye===void 0?void 0:ye.getFieldValue("deletePath"))!==null&&Se!==void 0?Se:!1,deleteData:!0});case 3:Ae(!1),J(void 0),d.onClose&&d.onClose();case 6:case"end":return M.stop()}},f)})),children:C.format("managerDeleteTaskButton")},"deleteTask"),d.showBackListButton&&(0,t.jsx)(Be.Link,{to:"/compose/list",children:(0,t.jsx)(i.ZP,{children:y.Ob.format("compose.list")})})]})},"operator"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(W.Z,{title:(0,t.jsx)(ae.Z,{}),subTitle:C.format("managerTitle"),ghost:!0,children:(0,t.jsxs)(n.Z,{children:[w.canSeeComposeListManage&&(0,t.jsx)(T.Z,{id:nt,onFinish:function(){var f=O()(s()().mark(function r(u){return s()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:ot(u),x(U+1);case 2:case"end":return D.stop()}},r)}));return function(r){return f.apply(this,arguments)}}()}),w.canSeeComposeListManageCreate&&(a==null?void 0:a.detail.setting.type)!="outPath"&&(0,t.jsx)(i.ZP,{icon:(0,t.jsx)(ie.Z,{}),onClick:O()(s()().mark(function f(){var r,u,h,D;return s()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,(0,L.aF)();case 2:u=g.sent,u.data&&(r=u.data.dpanel.containerInfo)!==null&&r!==void 0&&r.Name&&((h=dt.current)===null||h===void 0||h.showContainer((D=u.data.dpanel.containerInfo)===null||D===void 0?void 0:D.Name,"/dpanel/compose/".concat(a==null?void 0:a.detail.name)));case 4:case"end":return g.stop()}},f)})),children:y.FD.format("listManageFilePath")}),(0,t.jsx)(H.Z,{type:"vertical"}),w.canSeeComposeListManage&&(0,t.jsx)(Fe.Z,{trigger:(0,t.jsx)(i.ZP,{icon:(0,t.jsx)(l.Z,{}),children:me.format("createTitle")},"network")},"network-create"),(0,t.jsx)(i.ZP,{icon:(0,t.jsx)(Q.Z,{}),onClick:function(){var r;(r=F.current)===null||r===void 0||r.close(),x(U+1)},children:y.FD.format("listManageRefresh")})]})},"manager"),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)(V,{ref:F,id:(a==null?void 0:a.detail.id)||(a==null?void 0:a.detail.name)}),a&&a.containerList&&(0,t.jsx)(it,{containerList:a==null?void 0:a.containerList,enableSelectService:(a==null?void 0:a.detail.setting.type)!="dangling",selectServiceFinish:function(r){var u;(u=ue.current)===null||u===void 0||u.setFieldValue("deployServiceName",r)}}),(0,t.jsx)(v.Z,{name:"deployServiceName",hidden:!0}),a&&a.detail.setting.type!="dangling"&&(0,t.jsx)($.Z,{drawerProps:{ghost:!0,title:(0,t.jsx)(o.Z,{}),subTitle:"".concat(C.format("createEnvTitle"))},showDisableName:!0,showDeleteButton:!1,name:"environment",ref:ve})]})]})}),De=ee},75544:function(Qe,Ze,e){var Ee=e(5574),c=e.n(Ee),Te=e(12323),P=e(78267),A=e.n(P),s=e(75458),je=e.n(s),O=e(67294),G=e(4244),B=e.n(G),m=e(24078),b=e(85893),y,W,S,Oe=(0,O.forwardRef)(function(v,K){var re,ae=(0,O.useState)(!0),Q=c()(ae,2),_=Q[0],ce=Q[1];return(0,O.useEffect)(function(){return y=new G.Terminal(Te.X),W=new s.SearchAddon,S=new P.FitAddon,window.addEventListener("resize",function(){v.showInModal||S.fit()}),v.style&&v.style.fontSize&&(y.options.fontSize=v.style.fontSize),y.loadAddon(S),y.loadAddon(W),y.open(document.getElementById(v.id?v.id:"terminal-container")),v.showInModal||S.fit(),function(){y.reset(),ce(!0)}},[]),(0,O.useImperativeHandle)(K,function(){return{write:function(Z){_&&(S.fit(),ce(!1)),y.write(Z)},clear:function(){y.clear()},getTerminal:function(){return y},findNext:function(Z){W.findNext(Z)},findPrev:function(Z){W.findPrevious(Z)},fit:function(){S.fit()},onData:function(Z){return y.onData(Z)}}}),(0,b.jsx)("div",{id:v.id?v.id:"terminal-container",style:{width:v.width?v.width:"100%",height:v.height?v.height:"500px",marginTop:(re=v.style)===null||re===void 0?void 0:re.marginTop}})});Ze.Z=Oe},90098:function(Qe,Ze,e){e.d(Ze,{GG:function(){return Oe},MG:function(){return _},Oh:function(){return b},Pn:function(){return B},Yz:function(){return K},iE:function(){return Y},im:function(){return s},j6:function(){return W},pm:function(){return O},tw:function(){return we},vf:function(){return ae}});var Ee=e(15009),c=e.n(Ee),Te=e(99289),P=e.n(Te),A=e(82346);function s(l){return je.apply(this,arguments)}function je(){return je=P()(c()().mark(function l(o){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,A.request)("/api/app/compose/create",{method:"POST",data:o}));case 1:case"end":return n.stop()}},l)})),je.apply(this,arguments)}function O(l){return G.apply(this,arguments)}function G(){return G=P()(c()().mark(function l(o){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,A.request)("/api/app/compose/get-list",{method:"POST",data:o}));case 1:case"end":return n.stop()}},l)})),G.apply(this,arguments)}function B(l){return m.apply(this,arguments)}function m(){return m=P()(c()().mark(function l(o){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,A.request)("/api/app/compose/get-task",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),m.apply(this,arguments)}function b(l){return y.apply(this,arguments)}function y(){return y=P()(c()().mark(function l(o){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,A.request)("/api/app/compose/container-deploy",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),y.apply(this,arguments)}function W(l){return S.apply(this,arguments)}function S(){return S=P()(c()().mark(function l(o){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,A.request)("/api/app/compose/container-destroy",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),S.apply(this,arguments)}function Oe(l){return v.apply(this,arguments)}function v(){return v=P()(c()().mark(function l(o){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,A.request)("/api/app/compose/container-ctrl",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),v.apply(this,arguments)}function K(l){return re.apply(this,arguments)}function re(){return re=P()(c()().mark(function l(o){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,A.request)("/api/app/compose/container-log",{method:"POST",data:o}));case 2:case"end":return n.stop()}},l)})),re.apply(this,arguments)}function ae(l){return Q.apply(this,arguments)}function Q(){return Q=P()(c()().mark(function l(o){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.download=!0,o.id=String(o.id),n.next=4,(0,A.request)("/api/app/compose/container-log",{method:"POST",data:o,responseType:"blob"});case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},l)})),Q.apply(this,arguments)}function _(l){return ce.apply(this,arguments)}function ce(){return ce=P()(c()().mark(function l(o){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,A.request)("/api/app/compose/get-from-uri",{method:"POST",data:o}));case 1:case"end":return n.stop()}},l)})),ce.apply(this,arguments)}function Y(l){return Z.apply(this,arguments)}function Z(){return Z=P()(c()().mark(function l(o){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,A.request)("/api/common/store/deploy",{method:"POST",data:o}));case 1:case"end":return n.stop()}},l)})),Z.apply(this,arguments)}function we(l){return ie.apply(this,arguments)}function ie(){return ie=P()(c()().mark(function l(o){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o.id=String(o.id),n.abrupt("return",(0,A.request)("/api/app/compose/download",{method:"POST",data:o,responseType:"blob"}));case 2:case"end":return n.stop()}},l)})),ie.apply(this,arguments)}}}]);
