"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3917],{44349:function(ne,G,e){var V=e(97857),f=e.n(V),N=e(15009),A=e.n(N),K=e(99289),w=e.n(K),H=e(74763),T=e(17186),B=e(5966),R=e(86250),b=e(67294),W=e(85893),Z=(0,b.forwardRef)(function(p,S){var D=(0,b.useRef)();(0,b.useImperativeHandle)(S,function(){return{addItem:function(i){function o(m,t,a){return i.apply(this,arguments)}return o.toString=function(){return i.toString()},o}(function(i,o,m){var t,a=(t=D.current)===null||t===void 0?void 0:t.getList(),r;if(a==null||a.forEach(function(Y,J){Y[i]==o[i]&&(r=J)}),!(0,H.k)(r)&&m){var z;(z=D.current)===null||z===void 0||z.remove(r),r=void 0}if(!r){var L;(L=D.current)===null||L===void 0||L.add(o)}}),removeItemByKey:function(o,m){return w()(A()().mark(function t(){var a,r;return A()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return r=(a=D.current)===null||a===void 0?void 0:a.getList(),r==null||r.forEach(function(Y,J){if(Y[o]==m){var Q;(Q=D.current)===null||Q===void 0||Q.remove(J);return}}),L.abrupt("return");case 3:case"end":return L.stop()}},t)}))()},clear:function(o){if(!o){var m;o=(m=D.current)===null||m===void 0||(m=m.getList())===null||m===void 0?void 0:m.map(function(a,r){return r})}if(o){var t;(t=D.current)===null||t===void 0||t.remove(o)}},getList:function(){var o;return(o=D.current)===null||o===void 0?void 0:o.getList()}}});var x={};return p.hideCopyButton===!0&&(x.copyIconProps=!1),p.hideDeleteButton===!0&&(x.deleteIconProps=!1),(0,W.jsx)(T.u,f()(f()({initialValue:p.initialValue,label:p.label,name:p.name,actionRef:D,creatorButtonProps:p.showAddButton?{creatorButtonText:p.label?p.label:p.showAddButtonLabel?p.showAddButtonLabel:p.name}:!1,min:p.min?p.min:0},x),{},{children:function(o,m,t){return(0,W.jsx)(R.Z,{justify:p.justify,gap:p.gap,children:p.items.map(function(a){return a.render?(0,W.jsx)("div",{children:a.render&&a.render(o,m,t)},"".concat(p.name,"-").concat(a.name,"-").concat(o.key)):(0,W.jsx)(B.Z,{width:a.width,name:a.name,label:a.label,required:a.required,rules:[{required:a.required}],disabled:a.disabled,placeholder:a.placeholder},"".concat(p.name,"-").concat(a.name,"-").concat(o.key))})})}}))});G.Z=Z},36435:function(ne,G,e){var V=e(15009),f=e.n(V),N=e(64599),A=e.n(N),K=e(99289),w=e.n(K),H=e(9783),T=e.n(H),B=e(5574),R=e.n(B),b=e(67294),W=e(184),Z=e(38345),p=e(97269),S=e(97321),D=e(97462),x=e(64317),i=e(5966),o=e(86615),m=e(68602),t=e(83622),a=e(83403),r=e(24963),z=e(1699),L=e(29177),Y=e(1883),J=e(43425),Q=e(44349),ae=e(3616),q=e(36146),O=e(85893),se=(0,b.forwardRef)(function(F,ie){var oe=(0,b.useState)(!1),te=R()(oe,2),k=te[0],ee=te[1],v=(0,b.useRef)(),re=(0,b.useContext)(r.Z),X=re.message,$=(0,b.useState)([]),y=R()($,2),d=y[0],C=y[1],g=new q.Uo("components.permissionButton"),U=T()(T()(T()(T()(T()({},a.W6.CONTAINER,"Id"),a.W6.APPSTORE,"name"),a.W6.COMPOSE,"name"),a.W6.REGISTRY,"serverAddress"),a.W6.DOCKER_ENV,"name"),P=T()(T()(T()(T()(T()({},a.W6.CONTAINER,"name"),a.W6.APPSTORE,"name"),a.W6.COMPOSE,"name"),a.W6.REGISTRY,"title"),a.W6.DOCKER_ENV,"title"),s=U[F.type],I=P[F.type],de=F.selected.map(function(u){return u[U[F.type]]});return b.useEffect(function(){if(k){if(!F.selected||F.selected.length==0){X.error(q.FD.format("title.noDataSelect")),ee(!1);return}(0,m.dP)({permission:{uri:F.type,key:s,value:de}}).then(function(u){var _;(_=v.current)===null||_===void 0||_.setFieldValue("list",Object.keys(u.data.list).map(function(l){return{name:l,type:u.data.list[l].type,users:u.data.list[l].users}}))}),(0,m.lE)().then(function(u){var _,l=(_=u.data)===null||_===void 0||(_=_.list)===null||_===void 0?void 0:_.map(function(n){return{label:n.username,value:n.username}});C(l)})}},[k]),(0,O.jsx)(z.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,O.jsxs)(W.a,{name:"create",title:g.format("drawerTitle"),open:k,onOpenChange:function(_){if(!_){var l;(l=v.current)===null||l===void 0||l.resetFields()}ee(_)},drawerProps:{forceRender:!0,width:ae.R_},formRef:v,trigger:(0,O.jsx)(t.ZP,{icon:(0,O.jsx)(L.Z,{}),children:g.format("drawerTriggerButton")}),onFinish:function(){var u=w()(f()().mark(function _(l){var n,h,c;return f()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:n=A()(l.list),j.prev=1,n.s();case 3:if((h=n.n()).done){j.next=9;break}return c=h.value,j.next=7,(0,m.Db)({usernames:c.users,permissionType:c.type,permission:{uri:F.type,key:s,showKey:I,value:[c.name]}});case 7:j.next=3;break;case 9:j.next=14;break;case 11:j.prev=11,j.t0=j.catch(1),n.e(j.t0);case 14:return j.prev=14,n.f(),j.finish(14);case 17:X.success(q.FD.format("finish")),ee(!1),F.onSuccess();case 20:case"end":return j.stop()}},_,null,[[1,11,14,17]])}));return function(_){return u.apply(this,arguments)}}(),children:[(0,O.jsxs)(Z.Z,{ghost:!0,title:(0,O.jsx)(Y.Z,{}),subTitle:g.format("batchTitle"),children:[(0,O.jsx)(p.A.Item,{name:"type",style:{marginBottom:0},children:(0,O.jsx)(S.Z.Group,{defaultValue:"admin",onChange:function(_){var l,n,h=(l=v.current)===null||l===void 0?void 0:l.getFieldValue("list");h.forEach(function(c){c.type=_,c.users=[]}),(n=v.current)===null||n===void 0||n.setFieldValue("list",h)},children:["admin","restricted","public"].map(function(u){return(0,O.jsx)(S.Z,{style:{width:240},title:g.format("dataTypeOption.".concat(u)),description:g.format("dataTypeDescOption.".concat(u)),value:u},u)})})}),(0,O.jsx)(D.Z,{name:["type"],children:function(_){var l=_.type;if(l==="restricted")return(0,O.jsx)(x.Z,{mode:"multiple",name:"usernames",label:g.format("formUsernames"),onChange:function(h){var c,M,j=(c=v.current)===null||c===void 0?void 0:c.getFieldValue("list");j.forEach(function(E){E.users=h}),(M=v.current)===null||M===void 0||M.setFieldValue("list",j)},rules:[{required:!0}],request:w()(f()().mark(function n(){var h,c,M;return f()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(!(d.length>0)){E.next=2;break}return E.abrupt("return",d);case 2:return E.next=4,(0,m.lE)();case 4:return c=E.sent,M=(h=c.data)===null||h===void 0||(h=h.list)===null||h===void 0?void 0:h.map(function(le){return{label:le.username,value:le.username}}),C(M),E.abrupt("return",M);case 8:case"end":return E.stop()}},n)}))})}})]}),(0,O.jsx)(Z.Z,{ghost:!0,title:(0,O.jsx)(J.Z,{}),subTitle:g.format("dataTitle"),children:(0,O.jsx)(Q.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:g.format("dataName"),render:function(_,l,n){var h=n.getCurrentRowData();return(0,O.jsx)(i.Z,{disabled:!0,label:g.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:g.format("dataType"),render:function(_,l,n){var h=n.getCurrentRowData();return(0,O.jsx)(o.Z.Group,{label:g.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(c){return{label:g.format("dataTypeOption.".concat(c)),value:c}})})}},{name:"users",label:g.format("dataUsers"),render:function(_,l,n){return(0,O.jsx)(D.Z,{name:["type"],children:function(c){var M=c.type;if(M=="restricted")return(0,O.jsx)(x.Z,{width:"sm",mode:"tags",name:"users",label:g.format("dataUsers"),options:d})}})}}]})})]})})});G.Z=se},3616:function(ne,G,e){e.d(G,{Ed:function(){return A},FK:function(){return f},R_:function(){return V},ob:function(){return N}});var V=window.innerWidth<=1024?"90vw":"65vw",f="90vw",N="60vw",A="50vh"},29337:function(ne,G,e){e.r(G),e.d(G,{default:function(){return ee}});var V=e(15009),f=e.n(V),N=e(99289),A=e.n(N),K=e(5574),w=e.n(K),H=e(3616),T=e(24963),B=e(15078),R=e(36146),b=e(184),W=e(5966),Z=e(97462),p=e(86615),S=e(62370),D=e(82346),x=e(83622),i=e(42075),o=e(25593),m=e(66309),t=e(40056),a=e(67294),r=e(85893),z=(0,a.forwardRef)(function(v,re){var X=(0,a.useState)(!1),$=w()(X,2),y=$[0],d=$[1],C=(0,a.useRef)(),g=(0,a.useContext)(T.Z),U=g.message,P=(0,D.useSearchParams)(),s=w()(P,2),I=s[0],de=s[1],u=new R.Uo("components.appstore");return(0,a.useImperativeHandle)(re,function(){return{edit:function(l){var n;(n=C.current)===null||n===void 0||n.setFieldsValue({title:l.title,name:l.name,type:l.setting.type,url:l.setting.url,id:l.id}),d(!0)}}}),(0,a.useEffect)(function(){I.get("op")=="create"&&d(!0)},[]),(0,r.jsxs)(b.a,{name:"appstoreCreate",title:u.format("createDrawerTitle"),open:y,onOpenChange:function(l){var n;!l&&((n=C.current)===null||n===void 0||n.resetFields()),d(l)},drawerProps:{forceRender:!0,width:H.R_},formRef:C,trigger:(0,r.jsx)(x.ZP,{type:"primary",children:u.format("createDrawerTitle")}),onFinish:function(){var _=A()(f()().mark(function l(n){var h,c,M;return f()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return n.type=="1panel-local"&&(n.url="/dpanel/store/".concat(n.name)),E.next=3,(0,B.ks)({name:n.name,url:n.url,type:n.type});case 3:if(h=E.sent,!(h&&h.data)){E.next=13;break}return E.next=7,(0,B.$c)({id:n.id,name:n.name,title:n.title,type:n.type,url:n.url,apps:h.data.list});case 7:if(c=E.sent,!(c&&c.data)){E.next=13;break}return U.success(R.FD.format("finish")),v.onFinish&&v.onFinish(),(M=C.current)===null||M===void 0||M.resetFields(),E.abrupt("return",!0);case 13:case"end":return E.stop()}},l)}));return function(l){return _.apply(this,arguments)}}(),children:[(0,r.jsx)(W.Z,{name:"id",hidden:!0}),(0,r.jsx)(W.Z,{label:u.format("formTitle"),name:"title",required:!0,rules:[{required:!0}],placeholder:u.format("formTitleEmpty")}),(0,r.jsx)(Z.Z,{name:["id"],children:function(l){var n=l.id;return(0,r.jsx)(W.Z,{label:u.format("formName"),name:"name",required:!0,disabled:!!n,rules:[{required:!0}],placeholder:u.format("formNameEmpty")})}}),(0,r.jsx)(p.Z.Group,{name:"type",label:u.format("formType"),options:u.option("formTypeOption",["casaos","1panel","1panel-local"]),fieldProps:{onChange:function(l){var n;(n=C.current)===null||n===void 0||n.resetFields(["url"])}}}),(0,r.jsx)(Z.Z,{name:["type","name"],children:function(l){var n=l.type,h=l.name,c=[],M=[];if(n=="1panel"&&(M=["https://gitee.com/qyg2297248353/appstore-dpanel","https://github.com/1Panel-dev/appstore","https://github.com/okxlin/appstore"],c=[(0,r.jsx)(W.Z,{label:u.format("formGitUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:u.format("formGitUrlEmpty")},"gitUrl")]),n=="portainer"&&(c=[(0,r.jsx)(W.Z,{label:u.format("formJsonUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:"https://github.com/Lissy93/portainer-templates/blob/main/templates.json"},"jsonUrl")]),n=="casaos"&&(M=["https://play.cuse.eu.org/Cp0204-AppStore-Play.zip"],c=[(0,r.jsx)(W.Z,{label:u.format("formZipUrl"),name:"url",required:!0,rules:[{required:!0}],placeholder:u.format("formZipUrlEmpty")},"zipUrl")]),n&&n!="1panel-local")return[c,(0,r.jsx)(S.Z,{label:(0,r.jsxs)(i.Z,{children:[u.format("formRecommend"),(0,r.jsx)("a",{href:"https://dpanel.cc/manual/system-store",target:"_blank",children:R.FD.format("help")})]}),children:(0,r.jsx)(i.Z,{wrap:!0,children:M.map(function(j,E){return(0,r.jsx)(o.Z.Link,{onClick:function(){var ue;(ue=C.current)===null||ue===void 0||ue.setFieldValue("url",j)},children:(0,r.jsx)(m.Z,{color:"cyan",children:j})},E)})})},"recommend")];if(n=="1panel-local")return[c,(0,r.jsx)(S.Z,{children:(0,r.jsx)(t.Z,{message:u.format("formLocalDesc",{name:h})})},"local-description")]}})]})}),L=z,Y=e(80821),J=e(36435),Q=e(98510),ae=e(83403),q=e(5251),O=e(99611),se=e(86548),F=e(98165),ie=e(82061),oe=e(74453),te=e(96074),k=e(83062);function ee(){var v=(0,a.useRef)(),re=(0,D.useAccess)(),X=(0,a.useRef)();return(0,r.jsx)(oe._z,{header:{extra:[re.canSeeFounder&&(0,r.jsx)(L,{ref:X,onFinish:function(){var y,d;!((y=v.current)===null||y===void 0)&&y.reloadAndRest&&((d=v.current)===null||d===void 0||d.reloadAndRest())}},"create")]},children:(0,r.jsx)(Q.C,{rowKey:"id",columns:[{title:R.FD.format("listName"),dataIndex:"name",width:200},{title:R.FD.format("listTitle"),dataIndex:"title"},{title:R.FD.format("listTargetRoot"),width:500,search:!1,render:function(y,d,C,g,U){return(0,r.jsx)("a",{href:d.setting.url,target:"_blank",children:(0,r.jsx)(m.Z,{children:d.setting.url})})}},{title:R.FD.format("listUpdatedAt"),width:180,search:!1,render:function(y,d,C,g,U){if(d.setting.updatedAt)return(0,q.ZM)(d.setting.updatedAt*1e3)}},{title:R.FD.format("listManage"),width:150,search:!1,fixed:"right",render:function(y,d,C,g,U){return(0,r.jsxs)(i.Z,{split:(0,r.jsx)(te.Z,{type:"vertical"}),children:[(0,r.jsx)(D.Link,{to:"/compose/appstore",state:{name:d.name},children:(0,r.jsx)(k.Z,{title:R.FD.format("listManageView"),children:(0,r.jsx)(O.Z,{})})}),(0,r.jsx)(o.Z.Link,{onClick:function(){var s;(s=X.current)===null||s===void 0||s.edit(d)},children:(0,r.jsx)(k.Z,{title:R.FD.format("listManageEdit"),children:(0,r.jsx)(se.Z,{})})},"manage"),(0,r.jsx)(Y.Z,{buttonProps:{type:"link",icon:(0,r.jsx)(F.Z,{}),ghost:!0},action:function(){var s,I;return(0,B.ks)({id:d.id,name:d.name,url:(s=d.setting.url)!==null&&s!==void 0?s:"",type:(I=d.setting.type)!==null&&I!==void 0?I:""})},onSuccess:function(){var s,I;return!((s=v.current)===null||s===void 0)&&s.reloadAndRest&&((I=v.current)===null||I===void 0||I.reloadAndRest()),!0},onError:function(){var s,I;return!((s=v.current)===null||s===void 0)&&s.reloadAndRest&&((I=v.current)===null||I===void 0||I.reloadAndRest()),!0},tips:R.FD.format("listManageSync")},"upgrade")]})}}],request:function(){var $=A()(f()().mark(function y(d,C,g){var U;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,B.eO)({name:d.name,title:d.title});case 2:return U=s.sent,s.abrupt("return",{data:U.data.list,success:!0,total:U.data.list.length});case 4:case"end":return s.stop()}},y)}));return function(y,d,C){return $.apply(this,arguments)}}(),actionRef:v,quickToolbarRender:function(y){var d=y.selectedRows,C=y.finish,g=y.loading;return(0,r.jsxs)(i.Z,{size:16,children:[(0,r.jsx)(J.Z,{type:ae.W6.APPSTORE,selected:d,onSuccess:function(){var P,s;return!((P=v.current)===null||P===void 0)&&P.reloadAndRest&&((s=v.current)===null||s===void 0||s.reloadAndRest()),!0}}),(0,r.jsx)(Y.Z,{buttonProps:{danger:!0,type:"primary",icon:(0,r.jsx)(ie.Z,{})},confirmProps:{showCommonConfirm:!0},action:function(){return g(),(0,B.Me)({id:d.map(function(P){return P.id})}).finally(function(){C(!0)})},onSuccess:function(){var P,s;return!((P=v.current)===null||P===void 0)&&P.reloadAndRest&&((s=v.current)===null||s===void 0||s.reloadAndRest()),!0},onError:function(){var P,s;return!((P=v.current)===null||P===void 0)&&P.reset&&((s=v.current)===null||s===void 0||s.reset()),!0},children:R.FD.format("listManageDeleteBatch")},"delete")]})}},"appstore-list")})}},15078:function(ne,G,e){e.d(G,{$c:function(){return w},Me:function(){return p},eO:function(){return W},ks:function(){return T},yL:function(){return D}});var V=e(15009),f=e.n(V),N=e(99289),A=e.n(N),K=e(82346);function w(i){return H.apply(this,arguments)}function H(){return H=A()(f()().mark(function i(o){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,K.request)("/api/common/store/create",{method:"POST",data:o}));case 1:case"end":return t.stop()}},i)})),H.apply(this,arguments)}function T(i){return B.apply(this,arguments)}function B(){return B=A()(f()().mark(function i(o){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,K.request)("/api/common/store/sync",{method:"POST",data:o}));case 1:case"end":return t.stop()}},i)})),B.apply(this,arguments)}function R(i){return b.apply(this,arguments)}function b(){return b=_asyncToGenerator(_regeneratorRuntime().mark(function i(o){return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",request("/api/common/store/get-detail",{method:"POST",data:o}));case 1:case"end":return t.stop()}},i)})),b.apply(this,arguments)}function W(i){return Z.apply(this,arguments)}function Z(){return Z=A()(f()().mark(function i(o){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,K.request)("/api/common/store/get-list",{method:"POST",data:o}));case 1:case"end":return t.stop()}},i)})),Z.apply(this,arguments)}function p(i){return S.apply(this,arguments)}function S(){return S=A()(f()().mark(function i(o){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,K.request)("/api/common/store/delete",{method:"POST",data:o});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},i)})),S.apply(this,arguments)}function D(i){return x.apply(this,arguments)}function x(){return x=A()(f()().mark(function i(o){return f()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,K.request)(o==null?void 0:o.path,{method:"GET"}));case 1:case"end":return t.stop()}},i)})),x.apply(this,arguments)}}}]);
