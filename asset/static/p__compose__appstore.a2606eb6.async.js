"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7499],{43774:function(me,G,t){t.r(G),t.d(G,{default:function(){return Oe}});var k=t(5574),d=t.n(k),q=t(24963),S=t(15078),D=t(90078),J=t(97269),b=t(62370),_=t(97462),R=t(38345),le=t(45360),O=t(42075),ee=t(65233),N=t(28036),te=t(92398),F=t(2487),ne=t(86250),I=t(32983),m=t(4393),r=t(67294),A=t(15009),n=t.n(A),he=t(99289),ae=t.n(he),pe=t(184),fe=t(5966),re=t(51652),B=t(71230),y=t(15746),ve=t(34041),ge=t(74842),se=t(25593),je=t(83062),ue=t(66309),e=t(85893);function ce(a){var Z=(0,r.useState)(),v=d()(Z,2),u=v[0],g=v[1];return(0,r.useEffect)(function(){var L=a.url.substring(0,a.url.indexOf("://"));switch(L){case"image":g((0,e.jsx)("img",{width:a.imageSize?a.imageSize.width:"auto",height:a.imageSize?a.imageSize.height:"auto",src:a.url.replace("image://","/dpanel/static/store/file/")}));break;case"http":case"https":g((0,e.jsx)("img",{width:a.imageSize?a.imageSize.width:"auto",height:a.imageSize?a.imageSize.height:"auto",src:a.url}));break;case"markdown-file":(0,S.yL)({path:a.url.replace("markdown-file://","/dpanel/static/store/file/")}).then(function(z){g((0,e.jsx)(re.Z,{source:z,style:{padding:5}},"content"))});break;case"markdown":g((0,e.jsx)(re.Z,{source:a.url.replace("markdown://",""),style:{padding:5}},"content"));break;default:g("")}},[a.url]),(0,e.jsx)(e.Fragment,{children:u})}var E=t(36146);function de(a){var Z=new E.Uo;return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(B.Z,{gutter:[10,10],children:[(0,e.jsx)(y.Z,{span:6,children:(0,e.jsx)(ce,{url:a.app.logo,imageSize:a.logoSize})}),(0,e.jsxs)(y.Z,{span:a.extra?12:18,children:[(0,e.jsx)(B.Z,{children:(0,e.jsx)(y.Z,{span:24,children:(0,e.jsxs)(O.Z,{direction:"horizontal",children:[(0,e.jsx)(se.Z.Title,{level:5,children:(0,e.jsx)("a",{href:a.app.website,target:"_blank",children:a.app.title})}),(0,e.jsx)(se.Z.Text,{children:a.app.name})]})})}),(0,e.jsx)(B.Z,{style:{height:"60px"},children:(0,e.jsx)(y.Z,{children:(0,e.jsx)(je.Z,{title:Z.formatCurrent(a.app.descriptions,a.app.description),children:(0,e.jsx)(se.Z.Paragraph,{ellipsis:{rows:2},children:Z.formatCurrent(a.app.descriptions,a.app.description)})})})}),(0,e.jsx)(B.Z,{style:{height:"35px"},children:(0,e.jsx)(y.Z,{children:(0,e.jsxs)(O.Z,{wrap:!0,children:[a.app.storeName?(0,e.jsx)(ue.Z,{color:"blue-inverse",children:a.app.storeName}):"",a.app.tag&&a.app.tag.map(function(v,u){return(0,e.jsx)(ue.Z,{children:v},u)})]})})})]}),(0,e.jsx)(y.Z,{span:a.extra?6:0,children:a.extra})]})})}var xe=t(80821),Se=t(90098),ie=t(82346),ye=t(69626),Ze=t(3616),Ce=(0,r.forwardRef)(function(a,Z){var v=(0,r.useState)(!1),u=d()(v,2),g=u[0],L=u[1],z=(0,r.useState)(),Q=d()(z,2),i=Q[0],j=Q[1],T=(0,r.useState)(""),V=d()(T,2),C=V[0],H=V[1],U=(0,ie.useNavigate)(),P=(0,r.useRef)(),x=(0,r.useRef)(),K=(0,r.useState)(),c=d()(K,2),o=c[0],f=c[1],h=new E.Uo("components.appstore");return(0,r.useImperativeHandle)(Z,function(){return{show:function(l){L(!0),j(l),H(Object.keys(l.version)[0])}}}),(0,e.jsxs)(pe.a,{drawerProps:{width:Ze.R_},submitter:!1,open:g,onOpenChange:function(l){var p;L(l),(p=P.current)===null||p===void 0||p.resetFields()},title:"".concat(i==null?void 0:i.name," ").concat(E.FD.format("listManageDetail")),children:[(0,e.jsx)(ye.Z,{showBackListButton:!0,ref:x,onDeployFinish:function(){U("/compose/list")},onDeployFailed:function(){var s=ae()(n()().mark(function l(p){return n()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:case"end":return M.stop()}},l)}));return function(l){return s.apply(this,arguments)}}(),onClose:ae()(n()().mark(function s(){return n()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:case"end":return p.stop()}},s)}))}),i&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(R.Z,{ghost:!0,style:{marginBottom:"20px",paddingBottom:"20px",borderBottom:"#eeeeee solid 1px"},children:(0,e.jsx)(de,{app:i,logoSize:{width:"130",height:"130"},extra:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(B.Z,{gutter:[10,10],children:[(0,e.jsx)(y.Z,{span:24,children:(0,e.jsx)(xe.Z,{block:!0,type:"primary",action:ae()(n()().mark(function s(){var l,p,X,M,$,oe;return n()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return M={storeId:(l=i.storeId)!==null&&l!==void 0?l:0,name:(p=(X=P.current)===null||X===void 0?void 0:X.getFieldValue("name"))!==null&&p!==void 0?p:"".concat(i.name,"-%CURRENT_DATE%"),appName:i.name,title:i.title,composeFile:i.version[C].composeFile,environment:i.version[C].environment&&i.version[C].environment.map(function(Y){return Y.label=h.formatCurrent(Y.labels,Y.label),Y})},W.next=3,(0,Se.iE)(M);case 3:$=W.sent,$&&$.data.id&&(f($.data.id),(oe=x.current)===null||oe===void 0||oe.show($.data.id));case 5:case"end":return W.stop()}},s)})),icon:(0,e.jsx)(ge.Z,{}),confirm:(0,e.jsx)(J.A,{submitter:!1,formRef:P,layout:"horizontal",isKeyPressSubmit:!0,children:(0,e.jsx)(fe.Z,{placeholder:h.format("detailNameEmpty"),width:"md",label:h.format("detailName"),name:"name"})}),children:E.FD.format("listManageDeploy")},"deploy")}),(0,e.jsx)(y.Z,{span:24,children:i.version&&(0,e.jsx)(ve.Z,{style:{width:"100%"},value:C,onChange:function(l){H(l)},options:Object.keys(i.version).map(function(s){return{value:s,label:s}})})})]})})})}),Object.keys(i.version).map(function(s){if(!(C!=s||!i.version[s].environment||i.version[s].environment.length==0)){var l="";return l+="## ".concat(h.format("detailDescVersion")," <sup>").concat(s,`</sup> 
 |`).concat(h.format("detailDescName"),"|").concat(h.format("detailDescDefault"),"|").concat(h.format("detailDescDesc"),`| 
 |---|---|---|
`),i.version[s].environment.map(function(p){l+="|".concat(p.name,"|").concat(p.value,"|").concat(h.formatCurrent(p.labels,p.label),`| 
`)}),l+="<br />",(0,e.jsx)(re.Z,{source:l,style:{padding:5}},s)}}),(0,e.jsx)(ce,{url:h.formatCurrent(i==null?void 0:i.contents,i==null?void 0:i.content)})]})]})}),De=Ce,w="dpanel-search-result";function Oe(){var a=(0,r.useRef)(),Z=(0,r.useState)(),v=d()(Z,2),u=v[0],g=v[1],L=(0,r.useContext)(q.Z),z=L.loading,Q=(0,r.useState)(""),i=d()(Q,2),j=i[0],T=i[1],V=(0,r.useState)([]),C=d()(V,2),H=C[0],U=C[1],P=(0,ie.useLocation)(),x=new E.Uo("compose");(0,r.useEffect)(function(){z.show(),(0,S.eO)().then(function(c){if(c&&c.data&&c.data.list&&c.data.list.push({id:-1,name:w,title:x.format("storeSearchTitle"),setting:{apps:[]}}),g(Object.fromEntries(c.data.list.map(function(f){return[f.name,f]}))),P.state){var o=P.state;o.name!=""&&T(P.state.name)}else c.data.list.length>0&&T(c.data.list[0].name)}).finally(function(){z.destroy()})},[]);var K=function(o){var f=[];o=o.toLowerCase(),u&&(Object.keys(u).map(function(h){h!=w&&u[h].setting.apps&&u[h].setting.apps.map(function(s){if(o&&(s.name.toLowerCase().indexOf(o)!==-1||s.title&&s.title.toLowerCase().indexOf(o)!==-1||s.description&&s.description.toLocaleLowerCase().indexOf(o)!==-1)){var l=JSON.parse(JSON.stringify(s));l.storeName="".concat(u[h].title),l.storeId=u[h].id,f.push(l)}})}),f.length>0?(U(f),T(w)):(le.ZP.error(x.format("storeSearchNotMatch")),T(Object.keys(u)[0]),U([])))};return(0,e.jsxs)(D._z,{extra:[(0,e.jsx)(J.A,{isKeyPressSubmit:!0,submitter:!1,onFinish:function(o){K(o.search)},children:(0,e.jsxs)(O.Z.Compact,{children:[(0,e.jsx)(b.Z,{style:{margin:0},name:"search",children:(0,e.jsx)(ee.Z,{allowClear:!0,addonBefore:x.format("storeSearchButtonTip"),placeholder:x.format("storeSearchButtonEmpty"),onClear:function(){K("")}})}),(0,e.jsx)(_.Z,{name:["search"],children:function(o){var f=o.search;return(0,e.jsx)(N.ZP,{onClick:function(){K(f)},children:x.format("storeSearchButton")})}})]})},"form")],children:[(0,e.jsx)(De,{ref:a}),(0,e.jsxs)(R.Z,{children:[j!=""&&u&&(0,e.jsx)(te.Z,{activeKey:j,onChange:function(o){U([]),T(o)},items:Object.keys(u).map(function(c){return{label:u[c].title||new E.Uo("compose").format("storeTitle."+c),key:c,disabled:j!=w&&c==w}})}),(0,e.jsx)(F.Z,{locale:{emptyText:(0,e.jsx)(ne.Z,{justify:"center",style:{height:"40vh"},vertical:!0,children:(0,e.jsx)(I.Z,{image:I.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsxs)(e.Fragment,{children:[x.format("storeEmpty"),", ",(0,e.jsx)(ie.Link,{to:"/system/appstore?op=create",children:E.Ob.format("compose.appstore.create")})]})})})},pagination:{pageSize:36},rowKey:function(o){return"".concat(o.name).concat(o.storeName)},grid:{gutter:10,xs:1,sm:2,md:2,lg:2,xl:2,xxl:3},dataSource:j==w?H:u&&u[j]&&u[j].setting.apps,renderItem:function(o,f){return(0,e.jsx)(F.Z.Item,{children:(0,e.jsx)(m.Z,{onClick:function(){if(u){var s;o.storeId||(o.storeId=u[j].id),(s=a.current)===null||s===void 0||s.show(o)}},hoverable:!0,children:(0,e.jsx)(de,{app:o,logoSize:{width:"50",height:"50"}})})},f)}})]})]})}},15078:function(me,G,t){t.d(G,{$c:function(){return J},Me:function(){return te},eO:function(){return ee},ks:function(){return _},yL:function(){return ne}});var k=t(15009),d=t.n(k),q=t(99289),S=t.n(q),D=t(82346);function J(m){return b.apply(this,arguments)}function b(){return b=S()(d()().mark(function m(r){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,D.request)("/api/common/store/create",{method:"POST",data:r}));case 1:case"end":return n.stop()}},m)})),b.apply(this,arguments)}function _(m){return R.apply(this,arguments)}function R(){return R=S()(d()().mark(function m(r){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,D.request)("/api/common/store/sync",{method:"POST",data:r}));case 1:case"end":return n.stop()}},m)})),R.apply(this,arguments)}function le(m){return O.apply(this,arguments)}function O(){return O=_asyncToGenerator(_regeneratorRuntime().mark(function m(r){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",request("/api/common/store/get-detail",{method:"POST",data:r}));case 1:case"end":return n.stop()}},m)})),O.apply(this,arguments)}function ee(m){return N.apply(this,arguments)}function N(){return N=S()(d()().mark(function m(r){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,D.request)("/api/common/store/get-list",{method:"POST",data:r}));case 1:case"end":return n.stop()}},m)})),N.apply(this,arguments)}function te(m){return F.apply(this,arguments)}function F(){return F=S()(d()().mark(function m(r){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,D.request)("/api/common/store/delete",{method:"POST",data:r});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},m)})),F.apply(this,arguments)}function ne(m){return I.apply(this,arguments)}function I(){return I=S()(d()().mark(function m(r){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,D.request)(r==null?void 0:r.path,{method:"GET"}));case 1:case"end":return n.stop()}},m)})),I.apply(this,arguments)}}}]);
