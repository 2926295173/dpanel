"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1102],{24963:function(N,h,a){var j=a(67294),c=(0,j.createContext)({});h.Z=c},33208:function(N,h,a){a.r(h),a.d(h,{default:function(){return _e}});var j=a(15009),c=a.n(j),G=a(99289),x=a.n(G),H=a(5574),P=a.n(H),J=a(91058),Q=a(12491),X=a(24963),f=a(90098),k=a(79245),w=a(45742),q=a(91806),ee=a(27496),ne=a(33862),te=a(90078),ae=a(97269),re=a(2236),p=a(38345),le=a(52688),v=a(5966),ue=a(86615),y=a(97462),U=a(95213),A=a(95089),R=a(82346),I=a(28036),M=a(25409),se=a(63490),T=a(42075),ie=a(66309),W=a(38925),oe=a(92398),de=a(91845),E=a(67294),e=a(85893);function _e(){var F,D=(0,E.useContext)(X.Z),O=D.loading,me=D.notice,Z=D.message,Oe=D.lang,L=(0,R.useNavigate)(),ce=(0,E.useState)([]),K=P()(ce,2),ve=K[0],Ee=K[1],b=(0,E.useRef)(),_=(0,E.useRef)(),pe=(0,R.useSearchParams)(),S=P()(pe,2),he=S[0],ge=S[1],Pe=(0,E.useState)(),V=P()(Pe,2),r=V[0],fe=V[1],ye=(0,E.useState)(!1),Y=P()(ye,2),z=Y[0],$=Y[1],g=(F=he.get("id"))!==null&&F!==void 0?F:"",C=function(){var l=x()(c()().mark(function u(n){var s,t;return c()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(n.yaml){o.next=2;break}return o.abrupt("return");case 2:return(s=_.current)===null||s===void 0||s.setFieldValue("yaml",n.yaml),B(n.yaml),o.next=6,(0,f.xC)(n);case 6:if(t=o.sent,!(!t||!t.data||!t.data.project)){o.next=10;break}return me.error(t.data.error),o.abrupt("return");case 10:B(n.yaml,t.data.environment),t.data.project&&Ee(Object.keys(t.data.project.services).map(function(d,De){var m=t.data.project.services[d];return m.name=d,m}));case 12:case"end":return o.stop()}},u)}));return function(n){return l.apply(this,arguments)}}(),B=function(u,n){var s=(0,k.m)(u);s&&s.map(function(t){var i;(i=b.current)===null||i===void 0||i.addEnvItem(t.name,n&&n[t.name]?n[t.name]:t.value)})};return(0,E.useEffect)(function(){g&&(O.show(),(0,f.Pn)({id:g}).then(function(l){var u,n,s;if(fe(l.data.detail),l.data.detail.setting.type==""&&(l.data.detail.setting.type="text"),(u=_.current)===null||u===void 0||u.setFieldsValue({name:l.data.detail.name,title:l.data.detail.title,type:l.data.detail.setting.type,yaml:(n=l.data.yaml[0])!==null&&n!==void 0?n:"",yamlOverride:(s=l.data.yaml[1])!==null&&s!==void 0?s:"",environment:l.data.detail.setting.environment}),l.data.detail.setting.type=="remoteUrl"){var t;(t=_.current)===null||t===void 0||t.setFieldValue("remoteUrl",l.data.detail.setting.remoteUrl)}else if(l.data.detail.setting.type=="storagePath"){var i;(i=_.current)===null||i===void 0||i.setFieldValue("storagePath","/dpanel/compose/"+l.data.detail.setting.uri[0])}if(l.data.yaml){var o;C({yaml:(o=l.data.yaml[0])!==null&&o!==void 0?o:"",id:g})}}).catch(function(l){L("/compose/list")}).finally(function(){O.destroy()}))},[]),(0,e.jsx)(te._z,{header:{extra:[]},children:(0,e.jsx)(ae.A,{submitter:{render:function(u,n){return(0,e.jsxs)(re.S,{children:[(0,e.jsx)(I.ZP,{onClick:function(){var t;(t=u.form)===null||t===void 0||t.setFieldValue("deploy",!0),u.submit()},children:"\u90E8\u7F72"}),(0,e.jsx)("span",{children:n[1]},"submit")]})}},formRef:_,onFinishFailed:function(u){$(!1)},onFinish:function(){var l=x()(c()().mark(function u(n){var s,t,i;return c()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return t={type:n.type,name:n.name,title:n.title,environment:n.environment,remoteUrl:n.remoteUrl,yaml:n.yaml,yamlOverride:n.yamlOverride},r!=null&&r.id&&(t.id=r.id),d.next=4,(0,f.im)(t);case 4:return i=d.sent,(s=_.current)===null||s===void 0||s.resetFields(),L("/compose/deploy/"+i.data.id+(n.deploy?"?op=deploy":"")),d.abrupt("return",!0);case 8:case"end":return d.stop()}},u)}));return function(u){return l.apply(this,arguments)}}(),children:(0,e.jsx)(p.Z,{split:"vertical",children:(0,e.jsxs)(M.Z,{onResize:function(){},children:[(0,e.jsx)(M.Z.Panel,{resizable:!1,size:z?"0%":"45%",children:(0,e.jsxs)(p.Z,{split:"horizontal",children:[(0,e.jsxs)(p.Z,{title:(0,e.jsx)(w.Z,{}),subTitle:"\u57FA\u7840\u4FE1\u606F",children:[(0,e.jsx)(le.Z,{label:"\u4FDD\u5B58\u540E\u9A6C\u4E0A\u90E8\u7F72",name:"deploy",hidden:!0}),(0,e.jsx)(v.Z,{label:"\u7AD9\u70B9\u540D\u79F0",name:"title",disabled:(r==null?void 0:r.setting.type)=="outPath",fieldProps:{onChange:function(u){var n="";if(u.target.value&&!r){var s,t=(0,de.N9)(u.target.value.trim(),{toneType:"none",type:"array"});n=t.join(""),(s=_.current)===null||s===void 0||s.setFieldValue("name",n)}}}}),(0,e.jsx)(v.Z,{label:"\u7AD9\u70B9\u6807\u8BC6",name:"name",required:!0,rules:[{required:!0}],disabled:!!r,placeholder:"\u6807\u8BC6Compose\u521B\u5EFA\u7684\u5BB9\u5668\u7EC4\uFF0C\u53EA\u5141\u8BB8\u4E3A\u82F1\u6587\u6216\u662F\u6570\u5B57"}),(0,e.jsx)(ue.Z.Group,{label:"Yaml \u6765\u6E90",name:"type",initialValue:"text",fieldProps:{defaultValue:"text",onChange:function(){}},options:[{label:"yaml",value:"text",disabled:r&&r.setting.type!="text"},{label:"\u8FDC\u7A0B\u5730\u5740",value:"remoteUrl",disabled:r&&(r==null?void 0:r.setting.type)!="remoteUrl"},{label:"\u81EA\u52A8\u53D1\u73B0",value:"storagePath",disabled:r&&(r==null?void 0:r.setting.type)!="storagePath"},{label:"\u5E94\u7528\u5546\u5E97",value:"store",disabled:r&&(r==null?void 0:r.setting.type)!="store"},{label:"\u5916\u90E8\u4EFB\u52A1",value:"outPath",disabled:r&&(r==null?void 0:r.setting.type)!="outPath"}]}),(0,e.jsx)(y.Z,{name:["type"],children:function(u){var n=u.type;if(n=="text")return(0,e.jsx)(Q.Z,{title:"\u5BFC\u5165\u672C\u5730 compose \u6587\u4EF6",onImport:function(t){return C({yaml:t}),!0},onLoad:function(t){if(t.indexOf("services:")<0)throw new Error("\u5BFC\u5165\u7684compose\u6587\u4EF6\u9519\u8BEF");return!0}});if(n=="remoteUrl")return(0,e.jsx)(v.Z,{label:"",required:!0,rules:[{required:!0}],name:"remoteUrl",placeholder:"\u8BF7\u8F93\u5165\u8FDC\u7A0B docker-compose.yaml \u94FE\u63A5",fieldProps:{onBlur:function(){var s=x()(c()().mark(function i(o){var d;return c()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(o.target.value){m.next=2;break}return m.abrupt("return");case 2:return O.show(),m.next=5,(0,f.MG)({uri:o.target.value});case 5:d=m.sent,O.destroy(),d&&d.data&&d.data.content&&C({yaml:d.data.content});case 8:case"end":return m.stop()}},i)}));function t(i){return s.apply(this,arguments)}return t}()}});if(n=="storagePath")return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(v.Z,{name:"storagePath",required:!0,readonly:!0,initialValue:r?"".concat(r.setting.uri[0]):"\u6302\u8F7D /dpanel/compose \u76EE\u5F55\u540E\uFF0C\u81EA\u52A8\u53D1\u73B0\u3002",rules:[{required:!0,message:"\u6302\u8F7D /dpanel/compose \u76EE\u5F55\u540E\uFF0C\u81EA\u52A8\u53D1\u73B0\u3002"}]})});if(n=="store")return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(v.Z,{readonly:!0,name:"store",required:!0,initialValue:r?"".concat(r.setting.store):"\u8BF7\u5148\u6DFB\u52A0\u5E94\u7528\u5546\u5E97\u540E\uFF0C\u5728\u5E94\u7528\u5546\u5E97\u91CC\u5B8C\u6210\u5B89\u88C5",rules:[{required:!0,message:"\u8BF7\u5148\u6DFB\u52A0\u5E94\u7528\u5546\u5E97\u540E\uFF0C\u5728\u5E94\u7528\u5546\u5E97\u91CC\u5B8C\u6210\u5B89\u88C5"}]})});if(n=="outPath")return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(v.Z,{name:"outPath",required:!0,readonly:!0,initialValue:r&&"".concat(r.setting.uri[0]),rules:[{required:!0,message:"\u5916\u90E8\u4EFB\u52A1\u53EA\u53EF\u7F16\u8F91 yaml "}]})})}})]}),(0,e.jsx)(p.Z,{title:(0,e.jsx)(q.Z,{}),subTitle:"\u670D\u52A1\u5217\u8868",children:(0,e.jsx)(se.Z,{dataSource:ve,rowKey:"name",pagination:!1,columns:[{title:"\u540D\u79F0",dataIndex:"name"},{title:"\u955C\u50CF",dataIndex:"image"},{title:"\u7AEF\u53E3",dataIndex:"ports",render:function(u,n,s){return n.ports&&n.ports.map(function(t,i){return(0,e.jsx)(T.Z,{size:"large",wrap:!0,children:(0,e.jsxs)(ie.Z,{color:"#2db7f5",icon:t.published?(0,e.jsx)(ee.Z,{}):"",style:{marginBottom:5},children:[t.published," : ",t.target]})},"space".concat(i))})}},{title:"\u4F9D\u8D56",dataIndex:"dependsOn",width:150,render:function(u,n,s){if(n.depends_on)return(0,e.jsx)(T.Z,{wrap:!0,children:Object.keys(n.depends_on).map(function(t){var i=t;return n.external_links&&n.external_links.map(function(o){o.indexOf(":"+t)>-1&&(i=o)}),i})})}}]})}),(0,e.jsxs)(p.Z,{title:(0,e.jsx)(ne.Z,{}),subTitle:"\u73AF\u5883\u53D8\u91CF",children:[(0,e.jsx)(y.Z,{name:["environment"],children:function(u){var n=u.environment;if(!n||n.length==0)return(0,e.jsx)(W.Z,{message:(0,e.jsxs)(e.Fragment,{children:["\u5728 compose.yaml \u4E2D\u58F0\u660E\u73AF\u5883\u53D8\u91CF\uFF0C\u4F8B\u5982\uFF1A","${DB_NAME}"," ",(0,e.jsx)("br",{}),"\u5728\u90E8\u7F72\u65F6\u53EF\u6839\u636E\u60C5\u51B5\u8FDB\u884C\u91CD\u65B0\u8D4B\u503C\u3002"]})})}}),(0,e.jsx)(J.Z,{name:"environment",showDisableName:!0,showInDrawer:!0,showCardGhost:!0,ref:b})]})]})}),(0,e.jsx)(M.Z.Panel,{children:(0,e.jsx)(p.Z,{children:(0,e.jsx)(oe.Z,{tabBarExtraContent:(0,e.jsx)(I.ZP,{type:"link",onClick:function(){$(!z)},children:"\u5168\u5C4F"}),items:[{label:"Yaml \u6587\u4EF6",key:"compose",children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(v.Z,{name:"yaml",hidden:!0}),(0,e.jsx)(y.Z,{name:["type","yaml"],children:function(u){var n=u.type,s=u.yaml;return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(A.ZP,{theme:"dark",minHeight:"550px",onFocus:function(){if(n=="remoteUrl"){Z.error("\u8FDC\u7A0Byaml\u6587\u4EF6\u65E0\u6CD5\u4FEE\u6539\uFF0C\u8BF7\u901A\u8FC7\u3010\u8986\u76D6 yaml \u6587\u4EF6\u3011\u7684\u65B9\u5F0F\u4FEE\u6539\u5185\u5BB9\u3002");return}if(n=="store"){Z.warning("\u4E3A\u4E86\u4FDD\u8BC1\u5546\u5E97\u4E2D\u7684 compose.yaml \u6587\u4EF6\u53EF\u4EE5\u968F\u65F6\u66F4\u65B0\uFF0C\u5EFA\u8BAE\u901A\u8FC7\u3010\u8986\u76D6 yaml \u6587\u4EF6\u3011\u7684\u65B9\u5F0F\u4FEE\u6539\u5185\u5BB9\u3002");return}},onChange:function(i,o){var d;(d=_.current)===null||d===void 0||d.setFieldValue("yaml",i)},onBlur:function(){var i;C({yaml:(i=_.current)===null||i===void 0?void 0:i.getFieldValue("yaml"),id:g})},readOnly:n=="remoteUrl",value:s,extensions:[U.RI.yaml()]})})}})]})},{label:"\u8986\u76D6 Yaml \u6587\u4EF6",key:"override",children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(W.Z,{style:{marginBottom:20},message:(0,e.jsxs)(e.Fragment,{children:["\u8986\u76D6\u6587\u4EF6\uFF0C\u5141\u8BB8\u4F60\u5728\u4E0D\u6539\u52A8\u539F\u59CB Yaml \u6587\u4EF6\u7684\u60C5\u51B5\u4E0B\uFF0C\u8986\u76D6\u539F\u59CB\u6587\u4EF6\u4E2D\u7684\u4E00\u4E9B\u53C2\u6570\u914D\u7F6E\u3002",(0,e.jsx)("a",{href:"https://dpanel.cc/#/zh-cn/manual/compose/override",target:"_blank",children:"\u5982\u4F55\u914D\u7F6E\uFF1F"})]})}),(0,e.jsx)(v.Z,{name:"yamlOverride",hidden:!0}),(0,e.jsx)(y.Z,{name:["yamlOverride"],children:function(u){var n=u.yamlOverride;return(0,e.jsx)(A.ZP,{theme:"dark",minHeight:"550px",onChange:function(t,i){var o;(o=_.current)===null||o===void 0||o.setFieldValue("yamlOverride",t)},value:n,onBlur:function(){var t;B((t=_.current)===null||t===void 0?void 0:t.getFieldValue("yamlOverride"))},extensions:[U.RI.yaml()]})}})]})}]})})})]})})},"create")})}}}]);
