"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745],{55809:function(G,b,e){var M=e(87462),r=e(67294),x=e(44805),_=e(84089),h=function(C,i){return r.createElement(_.Z,(0,M.Z)({},C,{ref:i,icon:x.Z}))},v=r.forwardRef(h);b.Z=v},60433:function(G,b,e){var M=e(87462),r=e(67294),x=e(69782),_=e(84089),h=function(C,i){return r.createElement(_.Z,(0,M.Z)({},C,{ref:i,icon:x.Z}))},v=r.forwardRef(h);b.Z=v},1699:function(G,b,e){e.d(b,{u:function(){return I}});var M=e(97857),r=e.n(M),x=e(67294),_=e(82346),h=e(42075),v=e(85893),I=function(i){var E=(0,_.useAccess)(),A=Array.isArray(i.access)?i.access:[i.access];return i.space?(0,v.jsx)(h.Z,r()(r()({},i.space),{},{children:A.every(function(u){return E[u]})?i.children:i.fallback})):(0,v.jsx)(v.Fragment,{children:A.every(function(u){return E[u]})?i.children:i.fallback})}},27619:function(G,b,e){e.d(b,{Z:function(){return A}});var M=e(97857),r=e.n(M),x=e(19632),_=e.n(x),h=e(5574),v=e.n(h),I=e(64183),C=e(82346),i=e(67294),E=e(85893);function A(u){var L,B=(0,i.useState)("academy"),R=v()(B,2),j=R[0],p=R[1],U=Math.max.apply(Math,_()(u.data.map(function(m){var a;return(a=m[u.yField])!==null&&a!==void 0?a:0}))),y=(0,C.useModel)("@@initialState"),O=y.initialState,S=y.loading,F=y.error,k=y.refresh,o=y.setInitialState,t={xField:u.xField,yField:u.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:u.yLabelFormatter},scale:{y:{domainMin:(L=u.yDomainMin)!==null&&L!==void 0?L:0,domainMax:u.yDomainMax?u.yDomainMax:u.yDomainMaxCallback?u.yDomainMaxCallback(U):U}},data:u.data};return u.yLabelFormatter&&(t.axis.y.labelFormatter=u.yLabelFormatter),u.colorField&&(t.colorField=u.colorField),(0,i.useEffect)(function(){(O==null?void 0:O.theme.algorithm)=="dark"?p("classicDark"):p("academy")},[O]),(0,E.jsx)(I.Z,r()({theme:j},t))}},24963:function(G,b,e){var M=e(67294),r=(0,M.createContext)({});b.Z=r},50070:function(G,b,e){e.r(b),e.d(b,{AppDetailContext:function(){return U},default:function(){return y}});var M=e(15009),r=e.n(M),x=e(99289),_=e.n(x),h=e(5574),v=e.n(h),I=e(1699),C=e(24963),i=e(60335),E=e(55809),A=e(90078),u=e(82346),L=e(25593),B=e(28036),R=e(50136),j=e(67294),p=e(85893),U=(0,j.createContext)({});function y(){var O,S=(0,j.useContext)(C.Z),F=S.lang,k=S.loading,o=S.message,t=(0,u.useParams)(),m=(0,u.useSearchParams)(),a=v()(m,2),ee=a[0],T=a[1],K=(O=ee.get("tab"))!==null&&O!==void 0?O:"edit",Z=(0,j.useState)("edit"),g=v()(Z,2),N=g[0],w=g[1],s=(0,u.useNavigate)(),Q=(0,j.useState)(1),z=v()(Q,2),W=z[0],V=z[1],J=[{label:(0,p.jsx)(u.Link,{to:"/app/detail/edit/".concat(t.id,"?tab=edit"),children:"\u5BB9\u5668\u8BE6\u60C5"}),key:"edit"},{label:(0,p.jsx)(u.Link,{to:"/app/detail/network/".concat(t.id,"?tab=network"),children:"\u7F51\u7EDC\u7BA1\u7406"}),key:"network"},{label:(0,p.jsx)(L.Z.Link,{children:"\u6587\u4EF6\u7BA1\u7406"}),key:"file",onClick:function(){o.info(F("app.detail.createExplorerPlugin")),s("/app/detail/file/".concat(t.id,"?tab=file"))}},{label:(0,p.jsx)(L.Z.Link,{children:"\u8FD0\u884C\u65E5\u5FD7"}),key:"log",onClick:function(){s("/app/detail/log/".concat(t.id,"?tab=log"))}},{label:(0,p.jsx)(L.Z.Link,{children:"\u8FD0\u884C\u72B6\u6001"}),key:"stat",onClick:function(){s("/app/detail/stat/".concat(t.id,"?tab=stat"))}},{label:"",key:"containerName",icon:(0,p.jsx)(E.Z,{}),disabled:!0}],X=(0,j.useState)(J),Y=v()(X,2),d=Y[0],ae=Y[1];(0,j.useEffect)(function(){k.show(),w(K);var $=function(){var P=_()(r()().mark(function l(){var n,D,f;return r()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return n=J,c.prev=1,c.next=4,(0,i.jV)({md5:(D=t.id)!==null&&D!==void 0?D:""});case 4:f=c.sent,n.map(function(H){return H.key=="containerName"&&(H.label=f.data.info.Name),(!f.data.info.State.Running||f.data.info.State.Restarting)&&(H.key=="file"||H.key=="stat")&&(H.disabled=!0),H}),ae(n),c.next=13;break;case 9:return c.prev=9,c.t0=c.catch(1),s("/app/list"),c.abrupt("return");case 13:return c.prev=13,k.destroy(),c.finish(13);case 16:case"end":return c.stop()}},l,null,[[1,9,13,16]])}));return function(){return P.apply(this,arguments)}}();$()},[W,t]);var te=function(P){w(P.key)};return(0,p.jsx)(U.Provider,{value:{reload:function(){V(W+1)}},children:(0,p.jsxs)(A._z,{header:{extra:[(0,p.jsx)(I.u,{access:"canSeeContainerListManageCreate",children:(0,p.jsx)(u.Link,{to:"/app/create/image",children:(0,p.jsx)(B.ZP,{type:"primary",children:"\u521B\u5EFA\u5BB9\u5668"})})},"create")]},children:[(0,p.jsx)(R.Z,{mode:"horizontal",onClick:te,selectedKeys:[N],items:d}),(0,p.jsx)(u.Outlet,{})]})})}},41748:function(G,b,e){e.r(b),e.d(b,{default:function(){return ee}});var M=e(15009),r=e.n(M),x=e(99289),_=e.n(x),h=e(5574),v=e.n(h),I=e(19632),C=e.n(I),i=e(27619),E=e(67294);function A(T){var K=T.reqFunction,Z=T.interval,g=T.maxPolling,N=T.pollingStatus,w=T.inPath,s=(0,E.useRef)(null),Q=0,z=function V(){s.current=window.setTimeout(_()(r()().mark(function J(){var X;return r()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(Q++>=g)){d.next=3;break}return W(),d.abrupt("return");case 3:if(d.prev=3,!(w&&window.location.href.indexOf(w)==-1)){d.next=7;break}return W(),d.abrupt("return");case 7:return d.next=9,K();case 9:X=d.sent,V(),d.next=17;break;case 13:d.prev=13,d.t0=d.catch(3),W(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",d.t0);case 17:case"end":return d.stop()}},J,null,[[3,13]])})),Z)},W=function(){console.log("end polling"),s.current&&window.clearTimeout(s.current)};return(0,E.useEffect)(function(){return console.log((N?"start":"waiting")+" polling, max "+g),N&&z(),function(){W()}},[Z,g,N]),{endPolling:W}}var u=A,L=e(24963),B=e(82346);function R(T){return j.apply(this,arguments)}function j(){return j=_()(r()().mark(function T(K){return r()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,B.request)("/api/app/container/get-stat-info",{method:"POST",data:K}));case 1:case"end":return g.stop()}},T)})),j.apply(this,arguments)}function p(T){return U.apply(this,arguments)}function U(){return U=_()(r()().mark(function T(K){return r()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,B.request)("/api/app/container/get-process-info",{method:"POST",data:K}));case 1:case"end":return g.stop()}},T)})),U.apply(this,arguments)}var y=e(5251),O=e(12122),S=e(60433),F=e(38345),k=e(60940),o=e(50070),t=e(85893),m=new Date().toLocaleTimeString(),a={total:0,memory:[{date:m,usage:0,source:{usage:0,limit:0}}],cpu:[{date:m,usage:0}],network:[{usage:0,type:"rx",date:m,source:{usage:0}},{usage:0,type:"tx",date:m,source:{usage:0}}],io:[{usage:0,type:"read",date:m,source:{usage:0}},{usage:0,type:"write",date:m,source:{usage:0}}]};function ee(){var T=function(l,n){switch(n.type){case"update":var D=new Date(n.payload.read).toLocaleTimeString(),f=n.payload.cpu_stats.cpu_usage.total_usage-n.payload.precpu_stats.cpu_usage.total_usage,q=n.payload.cpu_stats.system_cpu_usage-n.payload.precpu_stats.system_cpu_usage,c={total:l.total+1,memory:[],cpu:[].concat(C()(l.cpu),[{date:D,usage:f/q*n.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return n.payload.memory_stats&&n.payload.memory_stats.limit&&n.payload.memory_stats.usage&&(c.memory=[].concat(C()(l.memory),[{date:D,usage:Math.round(n.payload.memory_stats.usage),source:{usage:n.payload.memory_stats.usage,limit:n.payload.memory_stats.limit}}])),n.payload.networks&&(c.network=[].concat(C()(l.network),[{date:D,usage:parseFloat(n.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:n.payload.networks.eth0.rx_bytes}},{date:D,usage:parseFloat(n.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:n.payload.networks.eth0.tx_bytes}}])),n.payload.blkio_stats&&n.payload.blkio_stats.io_service_bytes_recursive&&n.payload.blkio_stats.io_service_bytes_recursive.length>0&&(c.io=[].concat(C()(l.io),[{date:D,usage:parseFloat(n.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:n.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:n.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:D,usage:parseFloat(n.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:n.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:n.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),c}},K=(0,E.useContext)(L.Z),Z=K.loading,g=(0,B.useParams)(),N=(0,E.useReducer)(T,a),w=v()(N,2),s=w[0],Q=w[1],z=(0,E.useState)(0),W=v()(z,2),V=W[0],J=W[1],X=(0,E.useState)(),Y=v()(X,2),d=Y[0],ae=Y[1],te=u({reqFunction:function(){var P=_()(r()().mark(function n(){var D,f;return r()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,R({id:(D=g.id)!==null&&D!==void 0?D:""});case 2:f=c.sent,Z.destroy(),Q({type:"update",payload:f});case 5:case"end":return c.stop()}},n)}));function l(){return P.apply(this,arguments)}return l}(),interval:3e3,maxPolling:999,pollingStatus:V!=0,inPath:"tab=stat"}),$=(0,E.useContext)(o.AppDetailContext);return(0,E.useEffect)(function(){$.reload()},[]),(0,E.useEffect)(function(){var P,l;Z.show(),R({id:(P=g.id)!==null&&P!==void 0?P:""}).then(function(n){return J(Math.round(n.memory_stats.limit)),!0}),p({id:(l=g.id)!==null&&l!==void 0?l:""}).then(function(n){var D={columns:[],data:[]};n.data.list.Titles.map(function(f){D.columns.push({title:f,label:f,dataIndex:f})}),n.data.list.Processes.map(function(f,q){D.data.push({UID:f[0],PID:f[1],PPID:f[2],C:f[3],STIME:f[4],TTY:f[5],TIME:f[6],CMD:f[7]})}),ae(D)})},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(F.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[s.memory&&s.memory.length>0&&(0,t.jsx)(F.Z,{colSpan:12,title:(0,t.jsx)(O.Z,{}),subTitle:"Memory usage: ".concat((0,y.FI)(s.memory[s.memory.length-1].source.usage)," / ").concat((0,y.FI)(s.memory[s.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(i.Z,{yField:"usage",xField:"date",data:s.memory,yDomainMaxCallback:function(l){return l*2},yLabelFormatter:function(l){return(0,y.FI)(parseFloat(l))}})}),(0,t.jsx)(F.Z,{colSpan:12,title:(0,t.jsx)(O.Z,{}),subTitle:"Cpu usage: ".concat(s.cpu[s.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,t.jsx)(i.Z,{yField:"usage",xField:"date",data:s.cpu,yDomainMaxCallback:function(l){return l*1.5},yLabelFormatter:function(l){return"".concat(l,"%")}})}),s.io&&s.io.length>0&&(0,t.jsx)(F.Z,{colSpan:12,title:(0,t.jsx)(O.Z,{}),subTitle:"I/O: ".concat((0,y.FI)(s.io[s.io.length-1].source.usage)," / ").concat((0,y.FI)(s.io[s.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(i.Z,{yField:"usage",xField:"date",colorField:"type",data:s.io,yDomainMaxCallback:function(l){return l*2},yLabelFormatter:function(l){return(0,y.FI)(parseFloat(l))}})}),s.network&&s.network.length>0&&(0,t.jsx)(F.Z,{colSpan:12,title:(0,t.jsx)(O.Z,{}),subTitle:"Network: ".concat((0,y.FI)(s.network[s.network.length-1].source.usage)," / ").concat((0,y.FI)(s.network[s.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(i.Z,{yField:"usage",xField:"date",colorField:"type",data:s.network,yDomainMaxCallback:function(l){return l*2},yLabelFormatter:function(l){return(0,y.FI)(parseFloat(l))}})})]}),(0,t.jsx)(F.Z,{title:(0,t.jsx)(S.Z,{}),subTitle:"Progress",children:(0,t.jsx)(k.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:d==null?void 0:d.columns,dataSource:d==null?void 0:d.data,pagination:{pageSize:10}})})]})}},60335:function(G,b,e){e.d(b,{IE:function(){return C},IW:function(){return v},KK:function(){return B},LJ:function(){return j},RF:function(){return O},Re:function(){return U},aF:function(){return F},eE:function(){return u},jV:function(){return E}});var M=e(15009),r=e.n(M),x=e(99289),_=e.n(x),h=e(82346);function v(o){return I.apply(this,arguments)}function I(){return I=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/status",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),I.apply(this,arguments)}function C(o){return i.apply(this,arguments)}function i(){return i=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/get-list",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},o)})),i.apply(this,arguments)}function E(o){return A.apply(this,arguments)}function A(){return A=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/get-detail",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},o)})),A.apply(this,arguments)}function u(o){return L.apply(this,arguments)}function L(){return L=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/update",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},o)})),L.apply(this,arguments)}function B(){return R.apply(this,arguments)}function R(){return R=_()(r()().mark(function o(){return r()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,h.request)("/api/app/container/prune",{method:"POST"}));case 1:case"end":return m.stop()}},o)})),R.apply(this,arguments)}function j(o){return p.apply(this,arguments)}function p(){return p=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/export",{method:"POST",data:t,responseType:"blob"}));case 1:case"end":return a.stop()}},o)})),p.apply(this,arguments)}function U(o){return y.apply(this,arguments)}function y(){return y=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/commit",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),y.apply(this,arguments)}function O(o){return S.apply(this,arguments)}function S(){return S=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/upgrade",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),S.apply(this,arguments)}function F(o){return k.apply(this,arguments)}function k(){return k=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/copy",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),k.apply(this,arguments)}}}]);
