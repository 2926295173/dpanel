"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745],{55809:function(G,O,e){var T=e(87462),r=e(67294),x=e(44805),i=e(84089),v=function(j,h){return r.createElement(i.Z,(0,T.Z)({},j,{ref:h,icon:x.Z}))},P=r.forwardRef(v);O.Z=P},60433:function(G,O,e){var T=e(87462),r=e(67294),x=e(69782),i=e(84089),v=function(j,h){return r.createElement(i.Z,(0,T.Z)({},j,{ref:h,icon:x.Z}))},P=r.forwardRef(v);O.Z=P},1699:function(G,O,e){e.d(O,{u:function(){return C}});var T=e(9783),r=e.n(T),x=e(97857),i=e.n(x),v=e(67294),P=e(82346),L=e(40411),j=e(42075),h=e(85893),C=function(n){var b=(0,P.useAccess)(),U=Array.isArray(n.access)?n.access:[n.access],d,g=n.fallback;return typeof n.children=="function"?(d=n.children(U.reduce(function(_,R){return i()(i()({},_),{},r()({},R,b[R]))},{})),d||(d=g)):U.every(function(_){return b[_]})?d=n.children:d=g,!g&&d&&n.showProTips&&b.canSeeEnableCe&&(d=(0,h.jsx)(L.Z,{offset:n.showProTipsOffset,count:"PRO",color:"gold",style:{fontWeight:"bold"},children:d})),!g&&d&&n.showProRibbonTips&&b.canSeeEnableCe&&(d=(0,h.jsx)(L.Z.Ribbon,{text:"PRO",color:"gold",style:{fontWeight:"bold"},children:d})),n.space?(0,h.jsx)(j.Z,i()(i()({},n.space),{},{children:d})):d}},27619:function(G,O,e){e.d(O,{Z:function(){return B}});var T=e(97857),r=e.n(T),x=e(19632),i=e.n(x),v=e(5574),P=e.n(v),L=e(64183),j=e(82346),h=e(67294),C=e(85893);function B(n){var b,U=(0,h.useState)("academy"),d=P()(U,2),g=d[0],_=d[1],R=Math.max.apply(Math,i()(n.data.map(function(p){var a;return(a=p[n.yField])!==null&&a!==void 0?a:0}))),y=(0,j.useModel)("@@initialState"),I=y.initialState,S=y.loading,W=y.error,K=y.refresh,u=y.setInitialState,t={xField:n.xField,yField:n.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:n.yLabelFormatter},scale:{y:{domainMin:(b=n.yDomainMin)!==null&&b!==void 0?b:0,domainMax:n.yDomainMax?n.yDomainMax:n.yDomainMaxCallback?n.yDomainMaxCallback(R):R}},data:n.data};return n.yLabelFormatter&&(t.axis.y.labelFormatter=n.yLabelFormatter),n.colorField&&(t.colorField=n.colorField),(0,h.useEffect)(function(){(I==null?void 0:I.theme.algorithm)=="dark"?_("classicDark"):_("academy")},[I]),(0,C.jsx)(L.Z,r()({theme:g},t))}},24963:function(G,O,e){var T=e(67294),r=(0,T.createContext)({});O.Z=r},50070:function(G,O,e){e.r(O),e.d(O,{AppDetailContext:function(){return R},default:function(){return y}});var T=e(15009),r=e.n(T),x=e(99289),i=e.n(x),v=e(5574),P=e.n(v),L=e(1699),j=e(24963),h=e(60335),C=e(55809),B=e(90078),n=e(82346),b=e(25593),U=e(28036),d=e(50136),g=e(67294),_=e(85893),R=(0,g.createContext)({});function y(){var I,S=(0,g.useContext)(j.Z),W=S.lang,K=S.loading,u=S.message,t=(0,n.useParams)(),p=(0,n.useSearchParams)(),a=P()(p,2),ee=a[0],A=a[1],k=(I=ee.get("tab"))!==null&&I!==void 0?I:"edit",Z=(0,g.useState)("edit"),E=P()(Z,2),N=E[0],w=E[1],o=(0,n.useNavigate)(),Q=(0,g.useState)(1),z=P()(Q,2),F=z[0],J=z[1],V=[{label:(0,_.jsx)(n.Link,{to:"/app/detail/edit/".concat(t.id,"?tab=edit"),children:"\u5BB9\u5668\u8BE6\u60C5"}),key:"edit"},{label:(0,_.jsx)(n.Link,{to:"/app/detail/network/".concat(t.id,"?tab=network"),children:"\u7F51\u7EDC\u7BA1\u7406"}),key:"network"},{label:(0,_.jsx)(b.Z.Link,{children:"\u6587\u4EF6\u7BA1\u7406"}),key:"file",onClick:function(){u.info(W("app.detail.createExplorerPlugin")),o("/app/detail/file/".concat(t.id,"?tab=file"))}},{label:(0,_.jsx)(b.Z.Link,{children:"\u8FD0\u884C\u65E5\u5FD7"}),key:"log",onClick:function(){o("/app/detail/log/".concat(t.id,"?tab=log"))}},{label:(0,_.jsx)(b.Z.Link,{children:"\u8FD0\u884C\u72B6\u6001"}),key:"stat",onClick:function(){o("/app/detail/stat/".concat(t.id,"?tab=stat"))}},{label:"",key:"containerName",icon:(0,_.jsx)(C.Z,{}),disabled:!0}],X=(0,g.useState)(V),Y=P()(X,2),c=Y[0],ae=Y[1];(0,g.useEffect)(function(){K.show(),w(k);var $=function(){var D=i()(r()().mark(function l(){var s,M,f;return r()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return s=V,m.prev=1,m.next=4,(0,h.jV)({md5:(M=t.id)!==null&&M!==void 0?M:""});case 4:f=m.sent,s.map(function(H){return H.key=="containerName"&&(H.label=f.data.info.Name),(!f.data.info.State.Running||f.data.info.State.Restarting)&&(H.key=="file"||H.key=="stat")&&(H.disabled=!0),H}),ae(s),m.next=13;break;case 9:return m.prev=9,m.t0=m.catch(1),o("/app/list"),m.abrupt("return");case 13:return m.prev=13,K.destroy(),m.finish(13);case 16:case"end":return m.stop()}},l,null,[[1,9,13,16]])}));return function(){return D.apply(this,arguments)}}();$()},[F,t]);var te=function(D){w(D.key)};return(0,_.jsx)(R.Provider,{value:{reload:function(){J(F+1)}},children:(0,_.jsxs)(B._z,{header:{extra:[(0,_.jsx)(L.u,{access:"canSeeContainerListManageCreate",children:(0,_.jsx)(n.Link,{to:"/app/create/image",children:(0,_.jsx)(U.ZP,{type:"primary",children:"\u521B\u5EFA\u5BB9\u5668"})})},"create")]},children:[(0,_.jsx)(d.Z,{mode:"horizontal",onClick:te,selectedKeys:[N],items:c}),(0,_.jsx)(n.Outlet,{})]})})}},41748:function(G,O,e){e.r(O),e.d(O,{default:function(){return ee}});var T=e(15009),r=e.n(T),x=e(99289),i=e.n(x),v=e(5574),P=e.n(v),L=e(19632),j=e.n(L),h=e(27619),C=e(67294);function B(A){var k=A.reqFunction,Z=A.interval,E=A.maxPolling,N=A.pollingStatus,w=A.inPath,o=(0,C.useRef)(null),Q=0,z=function J(){o.current=window.setTimeout(i()(r()().mark(function V(){var X;return r()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(Q++>=E)){c.next=3;break}return F(),c.abrupt("return");case 3:if(c.prev=3,!(w&&window.location.href.indexOf(w)==-1)){c.next=7;break}return F(),c.abrupt("return");case 7:return c.next=9,k();case 9:X=c.sent,J(),c.next=17;break;case 13:c.prev=13,c.t0=c.catch(3),F(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",c.t0);case 17:case"end":return c.stop()}},V,null,[[3,13]])})),Z)},F=function(){console.log("end polling"),o.current&&window.clearTimeout(o.current)};return(0,C.useEffect)(function(){return console.log((N?"start":"waiting")+" polling, max "+E),N&&z(),function(){F()}},[Z,E,N]),{endPolling:F}}var n=B,b=e(24963),U=e(82346);function d(A){return g.apply(this,arguments)}function g(){return g=i()(r()().mark(function A(k){return r()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.abrupt("return",(0,U.request)("/api/app/container/get-stat-info",{method:"POST",data:k}));case 1:case"end":return E.stop()}},A)})),g.apply(this,arguments)}function _(A){return R.apply(this,arguments)}function R(){return R=i()(r()().mark(function A(k){return r()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.abrupt("return",(0,U.request)("/api/app/container/get-process-info",{method:"POST",data:k}));case 1:case"end":return E.stop()}},A)})),R.apply(this,arguments)}var y=e(5251),I=e(12122),S=e(60433),W=e(38345),K=e(60940),u=e(50070),t=e(85893),p=new Date().toLocaleTimeString(),a={total:0,memory:[{date:p,usage:0,source:{usage:0,limit:0}}],cpu:[{date:p,usage:0}],network:[{usage:0,type:"rx",date:p,source:{usage:0}},{usage:0,type:"tx",date:p,source:{usage:0}}],io:[{usage:0,type:"read",date:p,source:{usage:0}},{usage:0,type:"write",date:p,source:{usage:0}}]};function ee(){var A=function(l,s){switch(s.type){case"update":var M=new Date(s.payload.read).toLocaleTimeString(),f=s.payload.cpu_stats.cpu_usage.total_usage-s.payload.precpu_stats.cpu_usage.total_usage,q=s.payload.cpu_stats.system_cpu_usage-s.payload.precpu_stats.system_cpu_usage,m={total:l.total+1,memory:[],cpu:[].concat(j()(l.cpu),[{date:M,usage:f/q*s.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return s.payload.memory_stats&&s.payload.memory_stats.limit&&s.payload.memory_stats.usage&&(m.memory=[].concat(j()(l.memory),[{date:M,usage:Math.round(s.payload.memory_stats.usage),source:{usage:s.payload.memory_stats.usage,limit:s.payload.memory_stats.limit}}])),s.payload.networks&&(m.network=[].concat(j()(l.network),[{date:M,usage:parseFloat(s.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:s.payload.networks.eth0.rx_bytes}},{date:M,usage:parseFloat(s.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:s.payload.networks.eth0.tx_bytes}}])),s.payload.blkio_stats&&s.payload.blkio_stats.io_service_bytes_recursive&&s.payload.blkio_stats.io_service_bytes_recursive.length>0&&(m.io=[].concat(j()(l.io),[{date:M,usage:parseFloat(s.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:s.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:s.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:M,usage:parseFloat(s.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:s.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:s.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),m}},k=(0,C.useContext)(b.Z),Z=k.loading,E=(0,U.useParams)(),N=(0,C.useReducer)(A,a),w=P()(N,2),o=w[0],Q=w[1],z=(0,C.useState)(0),F=P()(z,2),J=F[0],V=F[1],X=(0,C.useState)(),Y=P()(X,2),c=Y[0],ae=Y[1],te=n({reqFunction:function(){var D=i()(r()().mark(function s(){var M,f;return r()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,d({id:(M=E.id)!==null&&M!==void 0?M:""});case 2:f=m.sent,Z.destroy(),Q({type:"update",payload:f});case 5:case"end":return m.stop()}},s)}));function l(){return D.apply(this,arguments)}return l}(),interval:3e3,maxPolling:999,pollingStatus:J!=0,inPath:"tab=stat"}),$=(0,C.useContext)(u.AppDetailContext);return(0,C.useEffect)(function(){$.reload()},[]),(0,C.useEffect)(function(){var D,l;Z.show(),d({id:(D=E.id)!==null&&D!==void 0?D:""}).then(function(s){return V(Math.round(s.memory_stats.limit)),!0}),_({id:(l=E.id)!==null&&l!==void 0?l:""}).then(function(s){var M={columns:[],data:[]};s.data.list.Titles.map(function(f){M.columns.push({title:f,label:f,dataIndex:f})}),s.data.list.Processes.map(function(f,q){M.data.push({UID:f[0],PID:f[1],PPID:f[2],C:f[3],STIME:f[4],TTY:f[5],TIME:f[6],CMD:f[7]})}),ae(M)})},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(W.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[o.memory&&o.memory.length>0&&(0,t.jsx)(W.Z,{colSpan:12,title:(0,t.jsx)(I.Z,{}),subTitle:"Memory usage: ".concat((0,y.FI)(o.memory[o.memory.length-1].source.usage)," / ").concat((0,y.FI)(o.memory[o.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(h.Z,{yField:"usage",xField:"date",data:o.memory,yDomainMaxCallback:function(l){return l*2},yLabelFormatter:function(l){return(0,y.FI)(parseFloat(l))}})}),(0,t.jsx)(W.Z,{colSpan:12,title:(0,t.jsx)(I.Z,{}),subTitle:"Cpu usage: ".concat(o.cpu[o.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,t.jsx)(h.Z,{yField:"usage",xField:"date",data:o.cpu,yDomainMaxCallback:function(l){return l*1.5},yLabelFormatter:function(l){return"".concat(l,"%")}})}),o.io&&o.io.length>0&&(0,t.jsx)(W.Z,{colSpan:12,title:(0,t.jsx)(I.Z,{}),subTitle:"I/O: ".concat((0,y.FI)(o.io[o.io.length-1].source.usage)," / ").concat((0,y.FI)(o.io[o.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(h.Z,{yField:"usage",xField:"date",colorField:"type",data:o.io,yDomainMaxCallback:function(l){return l*2},yLabelFormatter:function(l){return(0,y.FI)(parseFloat(l))}})}),o.network&&o.network.length>0&&(0,t.jsx)(W.Z,{colSpan:12,title:(0,t.jsx)(I.Z,{}),subTitle:"Network: ".concat((0,y.FI)(o.network[o.network.length-1].source.usage)," / ").concat((0,y.FI)(o.network[o.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(h.Z,{yField:"usage",xField:"date",colorField:"type",data:o.network,yDomainMaxCallback:function(l){return l*2},yLabelFormatter:function(l){return(0,y.FI)(parseFloat(l))}})})]}),(0,t.jsx)(W.Z,{title:(0,t.jsx)(S.Z,{}),subTitle:"Progress",children:(0,t.jsx)(K.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:c==null?void 0:c.columns,dataSource:c==null?void 0:c.data,pagination:{pageSize:10}})})]})}},60335:function(G,O,e){e.d(O,{IE:function(){return j},IW:function(){return P},KK:function(){return U},LJ:function(){return g},RF:function(){return I},Re:function(){return R},aF:function(){return W},eE:function(){return n},jV:function(){return C}});var T=e(15009),r=e.n(T),x=e(99289),i=e.n(x),v=e(82346);function P(u){return L.apply(this,arguments)}function L(){return L=i()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/status",{method:"POST",data:t}));case 1:case"end":return a.stop()}},u)})),L.apply(this,arguments)}function j(u){return h.apply(this,arguments)}function h(){return h=i()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/get-list",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},u)})),h.apply(this,arguments)}function C(u){return B.apply(this,arguments)}function B(){return B=i()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/get-detail",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},u)})),B.apply(this,arguments)}function n(u){return b.apply(this,arguments)}function b(){return b=i()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/update",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},u)})),b.apply(this,arguments)}function U(){return d.apply(this,arguments)}function d(){return d=i()(r()().mark(function u(){return r()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,v.request)("/api/app/container/prune",{method:"POST"}));case 1:case"end":return p.stop()}},u)})),d.apply(this,arguments)}function g(u){return _.apply(this,arguments)}function _(){return _=i()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/export",{method:"POST",data:t,responseType:"blob"}));case 1:case"end":return a.stop()}},u)})),_.apply(this,arguments)}function R(u){return y.apply(this,arguments)}function y(){return y=i()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/commit",{method:"POST",data:t}));case 1:case"end":return a.stop()}},u)})),y.apply(this,arguments)}function I(u){return S.apply(this,arguments)}function S(){return S=i()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/upgrade",{method:"POST",data:t}));case 1:case"end":return a.stop()}},u)})),S.apply(this,arguments)}function W(u){return K.apply(this,arguments)}function K(){return K=i()(r()().mark(function u(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,v.request)("/api/app/container/copy",{method:"POST",data:t}));case 1:case"end":return a.stop()}},u)})),K.apply(this,arguments)}}}]);
