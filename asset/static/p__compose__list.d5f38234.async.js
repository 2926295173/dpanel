"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8022],{91806:function(k,B,e){e.d(B,{Z:function(){return _}});var Z=e(87462),C=e(67294),M={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},y=M,S=e(84089),P=function(Q,j){return C.createElement(S.Z,(0,Z.Z)({},Q,{ref:j,icon:y}))},U=C.forwardRef(P),_=U},44349:function(k,B,e){var Z=e(97857),C=e.n(Z),M=e(17186),y=e(5966),S=e(86250),P=e(67294),U=e(85893),_=(0,P.forwardRef)(function(m,Q){var j=(0,P.useRef)();(0,P.useImperativeHandle)(Q,function(){return{addItem:function(g,x){var A,u=(A=j.current)===null||A===void 0?void 0:A.getList(),Y=!1;if(u==null||u.map(function(J){if(J.name==g){Y=!0;return}}),!Y){var F;(F=j.current)===null||F===void 0||F.add({name:g,value:x})}},clear:function(){var g;(g=j.current)===null||g===void 0||(g=g.getList())===null||g===void 0||g.map(function(x,A){var u;(u=j.current)===null||u===void 0||u.remove(A)})}}});var w={};return m.hideCopyButton===!0&&(w.copyIconProps=!1),m.hideDeleteButton===!0&&(w.deleteIconProps=!1),(0,U.jsx)(M.u,C()(C()({initialValue:m.initialValue,label:m.label,name:m.name,actionRef:j,creatorButtonProps:m.showAddButton?{creatorButtonText:"\u6DFB\u52A0"+(m.label?m.label:m.name)}:!1,min:m.min?m.min:0},w),{},{children:function(g,x,A){return(0,U.jsx)(S.Z,{justify:m.justify,gap:m.gap,children:m.items.map(function(u){return u.render?(0,U.jsx)("div",{children:u.render&&u.render(g,x,A)},"".concat(m.name,"-").concat(u.name,"-").concat(g.key)):(0,U.jsx)(y.Z,{width:u.width,name:u.name,label:u.label,required:u.required,rules:[{required:u.required}],disabled:u.disabled,placeholder:u.placeholder},"".concat(m.name,"-").concat(u.name,"-").concat(g.key))})})}}))});B.Z=_},8680:function(k,B,e){var Z=e(15009),C=e.n(Z),M=e(64599),y=e.n(M),S=e(99289),P=e.n(S),U=e(9783),_=e.n(U),m=e(5574),Q=e.n(m),j=e(67294),w=e(184),G=e(38345),g=e(97269),x=e(97321),A=e(97462),u=e(64317),Y=e(5966),F=e(86615),J=e(68602),q=e(28036),W=e(83403),ee=e(24963),$=e(1699),t=e(29177),ae=e(45742),re=e(43425),se=e(44349),ne=e(3616),c=e(85893),le=(0,j.forwardRef)(function(N,I){var L=(0,j.useState)(!1),X=Q()(L,2),T=X[0],b=X[1],K=(0,j.useRef)(),te=(0,j.useContext)(ee.Z),D=te.message,l=(0,j.useState)([]),n=Q()(l,2),o=n[0],r=n[1],a=_()(_()(_()(_()(_()({},W.W6.CONTAINER,"Id"),W.W6.APPSTORE,"name"),W.W6.COMPOSE,"name"),W.W6.REGISTRY,"serverAddress"),W.W6.DOCKER_ENV,"name"),E=_()(_()(_()(_()(_()({},W.W6.CONTAINER,"name"),W.W6.APPSTORE,"name"),W.W6.COMPOSE,"name"),W.W6.REGISTRY,"title"),W.W6.DOCKER_ENV,"title"),h=a[N.type],V=E[N.type],s=N.selected.map(function(i){return i[a[N.type]]});return j.useEffect(function(){T&&((0,J.dP)({permission:{uri:N.type,key:h,value:s}}).then(function(i){var d;(d=K.current)===null||d===void 0||d.setFieldValue("list",Object.keys(i.data.list).map(function(v){return{name:v,type:i.data.list[v].type,users:i.data.list[v].users}}))}),(0,J.lE)().then(function(i){var d,v=(d=i.data)===null||d===void 0||(d=d.list)===null||d===void 0?void 0:d.map(function(f){return{label:f.username,value:f.username}});r(v)}))},[T]),(0,c.jsx)($.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,c.jsxs)(w.a,{name:"create",title:"\u6570\u636E\u6743\u9650\u8BBE\u7F6E",open:T,onOpenChange:function(d){if(!d){var v;(v=K.current)===null||v===void 0||v.resetFields()}b(d)},drawerProps:{forceRender:!0,width:ne.R_},formRef:K,trigger:(0,c.jsx)(q.ZP,{icon:(0,c.jsx)(t.Z,{}),children:"\u6570\u636E\u6743\u9650"}),onFinish:function(){var i=P()(C()().mark(function d(v){var f,O,R;return C()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:f=y()(v.list),p.prev=1,f.s();case 3:if((O=f.n()).done){p.next=9;break}return R=O.value,p.next=7,(0,J.Db)({usernames:R.users,permissionType:R.type,permission:{uri:N.type,key:h,showKey:V,value:[R.name]}});case 7:p.next=3;break;case 9:p.next=14;break;case 11:p.prev=11,p.t0=p.catch(1),f.e(p.t0);case 14:return p.prev=14,f.f(),p.finish(14);case 17:D.success("\u6743\u9650\u8BBE\u7F6E\u6210\u529F"),b(!1),N.onSuccess();case 20:case"end":return p.stop()}},d,null,[[1,11,14,17]])}));return function(d){return i.apply(this,arguments)}}(),children:[(0,c.jsxs)(G.Z,{ghost:!0,title:(0,c.jsx)(ae.Z,{}),subTitle:"\u6279\u91CF\u8BBE\u7F6E",children:[(0,c.jsx)(g.A.Item,{name:"type",style:{marginBottom:0},children:(0,c.jsxs)(x.Z.Group,{defaultValue:"admin",onChange:function(d){var v,f,O=(v=K.current)===null||v===void 0?void 0:v.getFieldValue("list");O.forEach(function(R){R.type=d,R.users=[]}),(f=K.current)===null||f===void 0||f.setFieldValue("list",O)},children:[(0,c.jsx)(x.Z,{style:{width:240},title:"\u7BA1\u7406\u5458",description:"\u4EC5\u7BA1\u7406\u5458\u53EF\u89C1",value:"admin"}),(0,c.jsx)(x.Z,{style:{width:240},title:"\u6307\u5B9A\u7528\u6237",description:"\u4EC5\u9009\u4E2D\u7528\u6237\u53EF\u89C1",value:"restricted"}),(0,c.jsx)(x.Z,{style:{width:240},title:"\u516C\u5171",description:"\u6240\u6709\u4EBA\u53EF\u89C1",value:"public"})]})}),(0,c.jsx)(A.Z,{name:["type"],children:function(d){var v=d.type;if(v==="restricted")return(0,c.jsx)(u.Z,{mode:"multiple",name:"usernames",label:"\u9009\u62E9\u7528\u6237",onChange:function(O){var R,z,p=(R=K.current)===null||R===void 0?void 0:R.getFieldValue("list");p.forEach(function(H){H.users=O}),(z=K.current)===null||z===void 0||z.setFieldValue("list",p)},rules:[{required:!0}],request:P()(C()().mark(function f(){var O,R,z;return C()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(!(o.length>0)){H.next=2;break}return H.abrupt("return",o);case 2:return H.next=4,(0,J.lE)();case 4:return R=H.sent,z=(O=R.data)===null||O===void 0||(O=O.list)===null||O===void 0?void 0:O.map(function(oe){return{label:oe.username,value:oe.username}}),r(z),H.abrupt("return",z);case 8:case"end":return H.stop()}},f)}))})}})]}),(0,c.jsx)(G.Z,{ghost:!0,title:(0,c.jsx)(re.Z,{}),subTitle:"\u6570\u636E\u6743\u9650\u8BBE\u7F6E",children:(0,c.jsx)(se.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:"\u540D\u79F0",render:function(d,v,f){var O=f.getCurrentRowData();return(0,c.jsx)(Y.Z,{disabled:!0,label:"\u540D\u79F0",width:"sm",name:"name"})}},{name:"type",label:"\u6743\u9650\u7C7B\u578B",render:function(d,v,f){var O=f.getCurrentRowData();return(0,c.jsx)(F.Z.Group,{label:"\u6743\u9650\u7C7B\u578B",name:"type",radioType:"button",options:[{label:"\u7BA1\u7406\u5458",value:"admin"},{label:"\u516C\u5171",value:"public"},{label:"\u6307\u5B9A\u7528\u6237",value:"restricted"}]})}},{name:"users",label:"\u5173\u8054\u7528\u6237",render:function(d,v,f){return(0,c.jsx)(A.Z,{name:["type"],children:function(R){var z=R.type;if(z=="restricted")return(0,c.jsx)(u.Z,{width:"sm",mode:"tags",name:"users",label:"\u5173\u8054\u7528\u6237",options:o})}})}}]})})]})})});B.Z=le},96781:function(k,B,e){var Z=e(67294),C=(0,Z.createContext)({});B.Z=C},83536:function(k,B,e){e.r(B),e.d(B,{default:function(){return N}});var Z=e(64599),C=e.n(Z),M=e(15009),y=e.n(M),S=e(99289),P=e.n(S),U=e(80821),_=e(90098),m=e(43425),Q=e(23430),j=e(90078),w=e(41482),G=e(82346),g=e(28036),x=e(25593),A=e(42075),u=e(96074),Y=e(83062),F=e(67294),J=e(94359),q=e(67255),W=e(93162),ee=e(24963),$=e(66309),t=e(85893);function ae(I){var L=(0,G.useIntl)(),X=(0,F.useContext)(ee.Z),T=X.lang,b;if(!I.type)b=(0,t.jsx)($.Z,{children:T("compose.type.default")});else switch(I.type){case"remoteUrl":b=(0,t.jsx)($.Z,{color:"cyan",children:T("compose.type.".concat(I.type))});break;case"serverPath":b=(0,t.jsx)($.Z,{color:"blue",children:T("compose.type.".concat(I.type))});break;case"storagePath":b=(0,t.jsx)($.Z,{color:"geekblue",children:T("compose.type.".concat(I.type))});break;case"outPath":b=(0,t.jsx)($.Z,{color:"yellow",children:T("compose.type.".concat(I.type))});break;case"store":b=(0,t.jsx)($.Z,{color:"green",children:T("compose.type.".concat(I.type))});break;case"dangling":b=(0,t.jsx)($.Z,{color:"error",children:T("compose.type.".concat(I.type))});break;default:b=(0,t.jsx)($.Z,{children:T("compose.type.".concat(I.type))})}return(0,t.jsx)(Y.Z,{title:I.tootip,children:b})}var re=e(96781),se=e(73587),ne=e(1699),c=e(83403),le=e(8680);function N(){var I=(0,F.useContext)(re.Z),L=I.listTableRef,X=(0,F.useContext)(ee.Z),T=X.lang,b=X.notice,K=(0,F.useRef)(),te=(0,G.useAccess)();return(0,t.jsxs)(j._z,{header:{extra:[(0,t.jsx)(ne.u,{access:"canSeeComposeListManageCreate",children:(0,t.jsx)(G.Link,{to:"/compose/create",reloadDocument:location.search.length>0,children:(0,t.jsx)(g.ZP,{type:"primary",children:"\u521B\u5EFA\u4EFB\u52A1"},"createCompose")},"create")},"create")]},children:[(0,t.jsx)(se.Z,{ref:K,onClose:function(){var l;!((l=L.current)===null||l===void 0)&&l.reloadAndRest&&L.current.reloadAndRest()}}),(0,t.jsx)(w.Z,{scroll:{x:"max-content"},request:function(){var D=P()(y()().mark(function l(n){var o;return y()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,_.pm)({title:n.title,name:n.name});case 2:return o=a.sent,a.abrupt("return",{data:o.data.list,success:!0,total:o.data.list.length});case 4:case"end":return a.stop()}},l)}));return function(l){return D.apply(this,arguments)}}(),rowKey:"name",columns:[{title:"\u6807\u8BC6",dataIndex:"name",width:200,render:function(l,n,o,r,a){return(0,t.jsx)(x.Z.Link,{onClick:function(){var h;(h=K.current)===null||h===void 0||h.show(n.id||n.name)},children:n.name})},sorter:function(l,n){return l.name.localeCompare(n.name)},sortDirections:["descend","ascend"]},{title:"\u9879\u76EE\u540D\u79F0",dataIndex:"title",width:200},{title:"\u7C7B\u578B",width:150,search:!1,render:function(l,n,o,r,a){var E;return(0,t.jsx)(ae,{tootip:(E=n.setting.uri)!==null&&E!==void 0?E:"",type:n.setting&&n.setting.type?n.setting.type:""})}},{title:"\u5BB9\u5668\u72B6\u6001",dataIndex:"status",search:!1,width:300,render:function(l,n,o,r,a){return(0,t.jsx)(A.Z,{children:n.setting.status.split(", ").map(function(E,h){var V="running",s=E.indexOf("(");return s>-1?V=E.slice(0,s):V=E,(0,t.jsx)(J.Z,{status:V,message:{content:T("compose.status.".concat(V),{count:E.slice(s+1,E.length-1)}),title:n.setting.message,placement:"top",showInTag:!0}},h)})})},sorter:function(l,n){return l.setting.status.localeCompare(n.setting.status)}},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"",search:!1,width:150,render:function(l,n,o,r,a){return n.setting.createdAt?new Date(n.setting.createdAt).toLocaleString():"-"},sorter:function(l,n){var o,r;return new Date((o=l.setting.createdAt)!==null&&o!==void 0?o:"").toLocaleString().localeCompare(new Date((r=n.setting.createdAt)!==null&&r!==void 0?r:"").toLocaleString())}},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"",search:!1,width:150,render:function(l,n,o,r,a){return n.setting.updatedAt?new Date(n.setting.updatedAt).toLocaleString():"-"},sorter:function(l,n){var o,r;return new Date((o=l.setting.updatedAt)!==null&&o!==void 0?o:"").toLocaleString().localeCompare(new Date((r=n.setting.updatedAt)!==null&&r!==void 0?r:"").toLocaleString())}},{title:"\u64CD\u4F5C",width:80,valueType:"option",fixed:"right",key:"option",hidden:!te.canSeeComposeListManage,render:function(l,n,o,r,a){return n.setting.type!="dangling"&&(0,t.jsxs)(A.Z,{split:(0,t.jsx)(u.Z,{type:"vertical"}),children:[(0,t.jsx)(x.Z.Link,{onClick:function(){var h;(h=K.current)===null||h===void 0||h.show(n.id||n.name)},children:(0,t.jsx)(Y.Z,{title:"\u90E8\u7F72",children:(0,t.jsx)(m.Z,{})})},"3"),(0,t.jsx)(x.Z.Link,{onClick:P()(y()().mark(function E(){var h,V;return y()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,_.tw)({id:n.id||n.name});case 2:h=i.sent,V=new Blob([h],{type:"application/zip"}),(0,W.saveAs)(V,"compose-"+n.name+".zip");case 5:case"end":return i.stop()}},E)})),children:(0,t.jsx)(Y.Z,{title:"\u4E0B\u8F7D",children:(0,t.jsx)(Q.Z,{})})},"2")]})}}],rowSelection:te.canSeeComposeListManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0,getCheckboxProps:function(l){return{disabled:l.setting.type=="dangling"||l.setting.type=="outPath"}}}:void 0,tableAlertOptionRender:function(l){var n=l.selectedRows;return(0,t.jsxs)(A.Z,{size:16,children:[(0,t.jsx)(le.Z,{type:c.W6.COMPOSE,selected:n,onSuccess:function(){var r,a;return!((r=L.current)===null||r===void 0)&&r.reloadAndRest&&((a=L.current)===null||a===void 0||a.reloadAndRest()),!0}}),(0,t.jsx)(ne.u,{access:"canSeeComposeListManageDelete",children:(0,t.jsx)(U.Z,{danger:!0,type:"primary",action:P()(y()().mark(function o(){var r,a,E,h;return y()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:s.prev=0,a=C()(n),s.prev=2,a.s();case 4:if((E=a.n()).done){s.next=11;break}return h=E.value,s.next=8,(0,_.mg)({id:h.id||h.name});case 8:r=s.sent;case 9:s.next=4;break;case 11:s.next=16;break;case 13:s.prev=13,s.t0=s.catch(2),a.e(s.t0);case 16:return s.prev=16,a.f(),s.finish(16);case 19:s.next=23;break;case 21:s.prev=21,s.t1=s.catch(0);case 23:return s.abrupt("return",(0,_.ik)({id:n.map(function(i){return i.id})}));case 24:case"end":return s.stop()}},o,null,[[0,21],[2,13,16,19]])})),onSuccess:function(){var r,a;return!((r=L.current)===null||r===void 0)&&r.reloadAndRest&&((a=L.current)===null||a===void 0||a.reloadAndRest()),!0},onError:function(){var r,a;return!((r=L.current)===null||r===void 0)&&r.reset&&((a=L.current)===null||a===void 0||a.reset()),!0},confirm:"notification.confirm.title",children:"\u6279\u91CF\u5220\u9664"})})]})},pagination:(0,q.O)(),search:{collapsed:!1},actionRef:L,columnsState:(0,q.j)("compose-list")})]})}},67255:function(k,B,e){e.d(B,{O:function(){return Z},j:function(){return C}});function Z(){var M=localStorage.getItem("dpanel-pagesize");return M=="all"?!1:{showSizeChanger:!0,defaultPageSize:parseInt(M!=null?M:"20")}}function C(M){var y="dpanel-table-column-".concat(M),S={};if(localStorage.getItem(y)){var P;S=JSON.parse((P=localStorage.getItem(y))!==null&&P!==void 0?P:"{}")}return{defaultValue:S,onChange:function(_){localStorage.setItem("dpanel-table-column-".concat(M),JSON.stringify(_))}}}}}]);
