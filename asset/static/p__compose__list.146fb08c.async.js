"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8022],{91806:function(ee,y,e){e.d(y,{Z:function(){return C}});var B=e(87462),o=e(67294),F={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},h=F,$=e(84089),Z=function(S,W){return o.createElement($.Z,(0,B.Z)({},S,{ref:W,icon:h}))},I=o.forwardRef(Z),C=I},33862:function(ee,y,e){e.d(y,{Z:function(){return C}});var B=e(87462),o=e(67294),F={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 289.1a362.49 362.49 0 00-79.9-115.7 370.83 370.83 0 00-118.2-77.8C610.7 76.6 562.1 67 512 67c-50.1 0-98.7 9.6-144.5 28.5-44.3 18.3-84 44.5-118.2 77.8A363.6 363.6 0 00169.4 289c-19.5 45-29.4 92.8-29.4 142 0 70.6 16.9 140.9 50.1 208.7 26.7 54.5 64 107.6 111 158.1 80.3 86.2 164.5 138.9 188.4 153a43.9 43.9 0 0022.4 6.1c7.8 0 15.5-2 22.4-6.1 23.9-14.1 108.1-66.8 188.4-153 47-50.4 84.3-103.6 111-158.1C867.1 572 884 501.8 884 431.1c0-49.2-9.9-97-29.4-142zM512 880.2c-65.9-41.9-300-207.8-300-449.1 0-77.9 31.1-151.1 87.6-206.3C356.3 169.5 431.7 139 512 139s155.7 30.5 212.4 85.9C780.9 280 812 353.2 812 431.1c0 241.3-234.1 407.2-300 449.1zm0-617.2c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 551c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 439c0-29.9 11.7-58 32.8-79.2C454 338.6 482.1 327 512 327c29.9 0 58 11.6 79.2 32.8C612.4 381 624 409.1 624 439c0 29.9-11.6 58-32.8 79.2z"}}]},name:"environment",theme:"outlined"},h=F,$=e(84089),Z=function(S,W){return o.createElement($.Z,(0,B.Z)({},S,{ref:W,icon:h}))},I=o.forwardRef(Z),C=I},36435:function(ee,y,e){var B=e(15009),o=e.n(B),F=e(64599),h=e.n(F),$=e(99289),Z=e.n($),I=e(9783),C=e.n(I),Q=e(5574),S=e.n(Q),W=e(67294),de=e(184),ne=e(38345),ce=e(97269),te=e(97321),ae=e(97462),re=e(64317),se=e(5966),w=e(86615),G=e(68602),me=e(83622),j=e(83403),Ee=e(24963),b=e(1699),fe=e(29177),V=e(1883),pe=e(43425),ve=e(44349),oe=e(3616),H=e(36146),P=e(85893),E=(0,W.forwardRef)(function(g,Pe){var Oe=(0,W.useState)(!1),ie=S()(Oe,2),Y=ie[0],J=ie[1],K=(0,W.useRef)(),Me=(0,W.useContext)(Ee.Z),_e=Me.message,L=(0,W.useState)([]),le=S()(L,2),X=le[0],ue=le[1],R=new H.Uo("components.permissionButton"),s=C()(C()(C()(C()(C()({},j.W6.CONTAINER,"Id"),j.W6.APPSTORE,"name"),j.W6.COMPOSE,"name"),j.W6.REGISTRY,"serverAddress"),j.W6.DOCKER_ENV,"name"),De=C()(C()(C()(C()(C()({},j.W6.CONTAINER,"name"),j.W6.APPSTORE,"name"),j.W6.COMPOSE,"name"),j.W6.REGISTRY,"title"),j.W6.DOCKER_ENV,"title"),k=s[g.type],x=De[g.type],N=g.selected.map(function(u){return u[s[g.type]]});return W.useEffect(function(){if(Y){if(!g.selected||g.selected.length==0){_e.error(H.FD.format("title.noDataSelect")),J(!1);return}(0,G.dP)({permission:{uri:g.type,key:k,value:N}}).then(function(u){var d;(d=K.current)===null||d===void 0||d.setFieldValue("list",Object.keys(u.data.list).map(function(c){return{name:c,type:u.data.list[c].type,users:u.data.list[c].users}}))}),(0,G.lE)().then(function(u){var d,c=(d=u.data)===null||d===void 0||(d=d.list)===null||d===void 0?void 0:d.map(function(m){return{label:m.username,value:m.username}});ue(c)})}},[Y]),(0,P.jsx)(b.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,P.jsxs)(de.a,{name:"create",title:R.format("drawerTitle"),open:Y,onOpenChange:function(d){if(!d){var c;(c=K.current)===null||c===void 0||c.resetFields()}J(d)},drawerProps:{forceRender:!0,width:oe.R_},formRef:K,trigger:(0,P.jsx)(me.ZP,{icon:(0,P.jsx)(fe.Z,{}),children:R.format("drawerTriggerButton")}),onFinish:function(){var u=Z()(o()().mark(function d(c){var m,O,f;return o()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:m=h()(c.list),D.prev=1,m.s();case 3:if((O=m.n()).done){D.next=9;break}return f=O.value,D.next=7,(0,G.Db)({usernames:f.users,permissionType:f.type,permission:{uri:g.type,key:k,showKey:x,value:[f.name]}});case 7:D.next=3;break;case 9:D.next=14;break;case 11:D.prev=11,D.t0=D.catch(1),m.e(D.t0);case 14:return D.prev=14,m.f(),D.finish(14);case 17:_e.success(H.FD.format("finish")),J(!1),g.onSuccess();case 20:case"end":return D.stop()}},d,null,[[1,11,14,17]])}));return function(d){return u.apply(this,arguments)}}(),children:[(0,P.jsxs)(ne.Z,{ghost:!0,title:(0,P.jsx)(V.Z,{}),subTitle:R.format("batchTitle"),children:[(0,P.jsx)(ce.A.Item,{name:"type",style:{marginBottom:0},children:(0,P.jsx)(te.Z.Group,{defaultValue:"admin",onChange:function(d){var c,m,O=(c=K.current)===null||c===void 0?void 0:c.getFieldValue("list");O.forEach(function(f){f.type=d,f.users=[]}),(m=K.current)===null||m===void 0||m.setFieldValue("list",O)},children:["admin","restricted","public"].map(function(u){return(0,P.jsx)(te.Z,{style:{width:240},title:R.format("dataTypeOption.".concat(u)),description:R.format("dataTypeDescOption.".concat(u)),value:u},u)})})}),(0,P.jsx)(ae.Z,{name:["type"],children:function(d){var c=d.type;if(c==="restricted")return(0,P.jsx)(re.Z,{mode:"multiple",name:"usernames",label:R.format("formUsernames"),onChange:function(O){var f,U,D=(f=K.current)===null||f===void 0?void 0:f.getFieldValue("list");D.forEach(function(A){A.users=O}),(U=K.current)===null||U===void 0||U.setFieldValue("list",D)},rules:[{required:!0}],request:Z()(o()().mark(function m(){var O,f,U;return o()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!(X.length>0)){A.next=2;break}return A.abrupt("return",X);case 2:return A.next=4,(0,G.lE)();case 4:return f=A.sent,U=(O=f.data)===null||O===void 0||(O=O.list)===null||O===void 0?void 0:O.map(function(q){return{label:q.username,value:q.username}}),ue(U),A.abrupt("return",U);case 8:case"end":return A.stop()}},m)}))})}})]}),(0,P.jsx)(ne.Z,{ghost:!0,title:(0,P.jsx)(pe.Z,{}),subTitle:R.format("dataTitle"),children:(0,P.jsx)(ve.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:R.format("dataName"),render:function(d,c,m){var O=m.getCurrentRowData();return(0,P.jsx)(se.Z,{disabled:!0,label:R.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:R.format("dataType"),render:function(d,c,m){var O=m.getCurrentRowData();return(0,P.jsx)(w.Z.Group,{label:R.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(f){return{label:R.format("dataTypeOption.".concat(f)),value:f}})})}},{name:"users",label:R.format("dataUsers"),render:function(d,c,m){return(0,P.jsx)(ae.Z,{name:["type"],children:function(f){var U=f.type;if(U=="restricted")return(0,P.jsx)(re.Z,{width:"sm",mode:"tags",name:"users",label:R.format("dataUsers"),options:X})}})}}]})})]})})});y.Z=E},96781:function(ee,y,e){var B=e(67294),o=(0,B.createContext)({});y.Z=o},92922:function(ee,y,e){e.r(y),e.d(y,{default:function(){return De}});var B=e(15009),o=e.n(B),F=e(99289),h=e.n(F),$=e(5574),Z=e.n($),I=e(90098),C=e(33160),Q=e(87784),S=e(30159),W=e(74842),de=e(99611),ne=e(1883),ce=e(95591),te=e(23430),ae=e(43425),re=e(74453),se=e(82346),w=e(83062),G=e(25593),me=e(66309),j=e(42075),Ee=e(96074),b=e(67294),fe=e(94359),V=e(67255),pe=e(96781),ve=e(91218),oe=e(1699),H=e(83403),P=e(36435),E=e(36146),g=e(55375),Pe=e(96486),Oe=e.n(Pe),ie=e(37413),Y=e(87662),J=e(5251),K=e(93162),Me=e.n(K),_e=e(82848),L=e(98510),le=e(80821),X=e(83002),ue=e(29463),R=e(2831),s=e(85893);function De(){var k=(0,b.useContext)(pe.Z),x=k.listTableRef,N=k.reload,u=(0,b.useRef)(),d=(0,se.useAccess)(),c=(0,se.useLocation)(),m=new E.Uo("compose"),O=(0,b.useState)(""),f=Z()(O,2),U=f[0],D=f[1],A=(0,b.useRef)(),q=(0,b.useRef)();return(0,b.useEffect)(function(){(0,Y.K3)().then(function(p){var i;D((i=p.data.serverUrl)!==null&&i!==void 0?i:"")})},[]),(0,b.useEffect)(function(){var p;c.state&&!((p=x.current)===null||p===void 0)&&p.setPageInfo&&x.current.setPageInfo({current:(0,V.G$)(g.q9,x.current.pageInfo)})},[c.state,x.current]),(0,s.jsxs)(re._z,{header:{extra:[(0,s.jsx)(oe.u,{access:"canSeeComposeListManageCreate",children:(0,s.jsx)(_e.Z,{onFinish:function(i){var n,l;!((n=u.current)===null||n===void 0)&&n.show&&((l=u.current)===null||l===void 0||l.show(i)),N()}})},"create")]},children:[(0,s.jsx)(X.Z,{ref:A},"composeLog"),(0,s.jsx)(ve.Z,{ref:u,onClose:function(){N()}}),(0,s.jsx)(ue.Z,{ref:q}),(0,s.jsx)(L.C,{tableKey:g.q9,contextMenu:function(i){var n=i.selectedRows,l=i.finish,v=i.loading;return{items:[{type:"group",label:E.FD.format("listManageManage"),key:"manage",children:[{access:"canSeeComposeList",label:(0,s.jsx)(L.C.ContextMenuItem,{buttonProps:{icon:(0,s.jsx)(C.Z,{})},action:h()(o()().mark(function _(){return o()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return v(),t.abrupt("return",Promise.all(n.map(function(a){return(0,I.GG)({id:a.id||a.name,op:"restart"})})).finally(function(){l(!0)}));case 2:case"end":return t.stop()}},_)})),children:E.FD.format("listManageRestart")}),key:"restart"},{label:(0,s.jsx)(L.C.ContextMenuItem,{action:h()(o()().mark(function _(){return o()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return v(),t.abrupt("return",Promise.all(n.map(function(a){return(0,I.GG)({id:a.id||a.name,op:"stop"})})).finally(function(){l(!0)}));case 2:case"end":return t.stop()}},_)})),buttonProps:{icon:(0,s.jsx)(Q.Z,{})},children:E.FD.format("listManageStop")}),key:"stop"},{label:(0,s.jsx)(L.C.ContextMenuItem,{action:h()(o()().mark(function _(){return o()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return v(),t.abrupt("return",Promise.all(n.map(function(a){return(0,I.GG)({id:a.id||a.name,op:"pause"})})).finally(function(){l(!0)}));case 2:case"end":return t.stop()}},_)})),buttonProps:{icon:(0,s.jsx)(S.Z,{})},children:E.FD.format("listManagePause")}),key:"pause"},{label:(0,s.jsx)(L.C.ContextMenuItem,{action:h()(o()().mark(function _(){return o()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return v(),t.abrupt("return",Promise.all(n.map(function(a){return(0,I.GG)({id:a.id||a.name,op:"unpause"})})).finally(function(){l(!0)}));case 2:case"end":return t.stop()}},_)})),buttonProps:{icon:(0,s.jsx)(W.Z,{})},children:E.FD.format("listManageUnpause")}),key:"unpause"}]},{type:"group",label:E.FD.format("listManage"),key:"operator",children:[{label:(0,s.jsx)(L.C.ContextMenuItem,{buttonProps:{icon:(0,s.jsx)(de.Z,{}),disabled:n.length>1},action:h()(o()().mark(function _(){var r,t;return o()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:l(!0),n!=null&&n[0]&&((r=u.current)===null||r===void 0||r.show((t=n[0].id)!==null&&t!==void 0?t:n[0].name));case 2:case"end":return M.stop()}},_)})),children:E.FD.format("listManageView")}),key:"view"},{label:(0,s.jsx)(L.C.ContextMenuItem,{buttonProps:{icon:(0,s.jsx)(ne.Z,{}),disabled:n.length>1},action:h()(o()().mark(function _(){var r,t;return o()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(t=n==null?void 0:n[0],t){M.next=3;break}return M.abrupt("return");case 3:(r=A.current)===null||r===void 0||r.show(t),l(!0);case 5:case"end":return M.stop()}},_)})),children:E.FD.format("listManageLog")}),key:"log"},{label:(0,s.jsx)(L.C.ContextMenuItem,{buttonProps:{icon:(0,s.jsx)(ce.Z,{}),disabled:n.length>1},action:h()(o()().mark(function _(){var r,t,a,M,T;return o()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(t=n==null?void 0:n[0],t){z.next=3;break}return z.abrupt("return");case 3:return z.next=5,(0,R.aF)();case 5:a=z.sent,a.data&&(r=a.data.dpanel.containerInfo)!==null&&r!==void 0&&r.Name&&((M=q.current)===null||M===void 0||M.showContainer((T=a.data.dpanel.containerInfo)===null||T===void 0?void 0:T.Name,"/dpanel/compose/".concat(t.name))),l(!0);case 8:case"end":return z.stop()}},_)})),children:E.FD.format("listManageFilePath")}),key:"file"},{key:"download",label:(0,s.jsx)(L.C.ContextMenuItem,{buttonProps:{icon:(0,s.jsx)(te.Z,{}),disabled:n.length>1},action:h()(o()().mark(function _(){var r,t,a;return o()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(v(),r=n==null?void 0:n[0],r){T.next=4;break}return T.abrupt("return");case 4:return T.next=6,(0,I.tw)({id:r.id||r.name}).finally(function(){l(!0)});case 6:t=T.sent,a=new Blob([t],{type:"application/zip"}),(0,K.saveAs)(a,"compose-"+r.name+".zip");case 9:case"end":return T.stop()}},_)})),children:E.FD.format("listManageDownload")})}]}]}},request:function(){var p=h()(o()().mark(function i(n){var l;return o()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,(0,I.pm)({title:n.title,name:n.name});case 2:return l=_.sent,_.abrupt("return",{data:l.data.list.map(function(r){var t=l.data.containerList.filter(function(a){return a.project==r.name});return t&&(r.containerList=t),r}),success:!0,total:l.data.list.length});case 4:case"end":return _.stop()}},i)}));return function(i){return p.apply(this,arguments)}}(),rowKey:function(i){return i.id>0?i.id:i.name},columns:[{key:"name",title:E.FD.format("listTitle"),dataIndex:"name",width:300,render:function(i,n,l,v,_){return(0,s.jsx)(w.Z,{title:"".concat(n.title),placement:"right",children:(0,s.jsx)(G.Z.Link,{onClick:function(){var t;(t=u.current)===null||t===void 0||t.show(n.id||n.name)},children:n.name})})},sorter:function(i,n){return i.name.localeCompare(n.name)},defaultSortOrder:(0,V.rj)(g.q9,"name"),sortDirections:V.h5},{key:"ports",title:E.FD.format("listAccess"),tooltip:E.FD.format("listAccessTip"),width:150,dataIndex:"ports",search:!1,render:function(i,n,l,v){if((0,Pe.isEmpty)(n.containerList))return null;var _=[],r=[];return n.containerList&&n.containerList.forEach(function(t){t.publishers.forEach(function(a){a.publishedPort?_.push({PrivatePort:a.targetPort,Type:a.protocol,IP:a.url,PublicPort:a.publishedPort}):a.publishedPort&&r.push({PrivatePort:a.targetPort,Type:a.protocol,IP:a.url,PublicPort:a.publishedPort})})}),(0,s.jsx)(ie.Z,{publicPort:_,privatePort:r,domain:[],serverIp:U})}},{title:E.FD.format("listType"),width:150,search:!1,render:function(i,n,l,v,_){var r,t=n.setting&&n.setting.type?n.setting.type:"default";return(0,s.jsx)(w.Z,{placement:"right",title:((r=n.setting.uri)!==null&&r!==void 0?r:[]).join(", "),children:(0,s.jsx)(me.Z,{color:m.format("listTypeColorOption.".concat(t)),children:m.format("listTypeOption.".concat(t))})})}},{title:E.FD.format("listStatus"),dataIndex:"status",search:!1,key:"status",render:function(i,n,l,v,_){return(0,s.jsx)(j.Z,{children:n.setting.status.split(", ").map(function(r,t){var a,M="running",T=r.indexOf("(");return T>-1?M=r.slice(0,T):M=r,(0,s.jsx)(fe.Z,{status:"compose.".concat(M),statusValue:{count:r.slice(T+1,r.length-1)},tip:"".concat(r," ").concat((a=n.setting.message)!==null&&a!==void 0?a:"")},t)})})},sorter:function(i,n){return i.setting.status.localeCompare(n.setting.status)},defaultSortOrder:(0,V.rj)(g.q9,"status")},{title:E.FD.format("listUpdatedAt"),dataIndex:"",search:!1,width:180,render:function(i,n,l,v,_){return(0,J.NF)(n.setting.updatedAt)},sorter:function(i,n){var l,v;return new Date((l=i.setting.updatedAt)!==null&&l!==void 0?l:"").toLocaleString().localeCompare(new Date((v=n.setting.updatedAt)!==null&&v!==void 0?v:"").toLocaleString())},key:"updated",defaultSortOrder:(0,V.rj)(g.q9,"updated")},{title:E.FD.format("listManage"),width:60,valueType:"option",fixed:"right",key:"option",hidden:!d.canSeeComposeListManage,render:function(i,n,l,v,_){return n.setting.type!="dangling"&&(0,s.jsx)(j.Z,{split:(0,s.jsx)(Ee.Z,{type:"vertical"}),children:(0,s.jsx)(G.Z.Link,{onClick:function(){var t;(t=u.current)===null||t===void 0||t.show(n.id||n.name)},children:(0,s.jsx)(w.Z,{title:E.FD.format("listManageDetail"),children:(0,s.jsx)(ae.Z,{})})},"3")})}}],rowSelection:d.canSeeComposeListManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0,getCheckboxProps:function(i){return{disabled:i.setting.type=="dangling"||i.setting.type=="outPath"}}}:void 0,actionRef:x,quickToolbarRender:function(i){var n=i.selectedRows;return(0,s.jsxs)(j.Z,{size:16,children:[(0,s.jsx)(P.Z,{type:H.W6.COMPOSE,selected:n,onSuccess:function(){return N(),!0}}),(0,s.jsx)(oe.u,{access:"canSeeComposeListManageDelete",children:(0,s.jsx)(le.Z,{buttonProps:{danger:!0,type:"primary"},confirmProps:{showCommonConfirm:!0},action:function(){return Promise.all(n.map(function(){var v=h()(o()().mark(function _(r){return o()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,I.j6)({id:r.id||r.name,deleteData:!0,deletePath:!0});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},_)}));return function(_){return v.apply(this,arguments)}}()))},onSuccess:function(){var v;return!((v=x.current)===null||v===void 0)&&v.reloadAndRest&&x.current.reloadAndRest(),!0},onError:function(){return N(),!0},children:E.FD.format("listManageDeleteBatch")})})]})}},"table")]})}}}]);
