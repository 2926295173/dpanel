"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8195],{77273:function(Z,F,r){var f=r(15009),x=r.n(f),S=r(99289),B=r.n(S),R=r(5574),I=r.n(R),g=r(184),i=r(5966),m=r(86615),p=r(97462),h=r(64317),E=r(52688),c=r(62370),_=r(38345),T=r(31199),j=r(90672),C=r(71230),P=r(15746),K=r(42075),U=r(86250),b=r(40056),A=r(67294),l=r(91845),s=r(87662),t=r(12491),e=r(52756),D=r(89035),n=r(85893),Y=(0,A.forwardRef)(function(W,J){var y,V;(0,A.useImperativeHandle)(J,function(){return{edit:function(o){var a,u=URL.parse(o.address);(a=M.current)===null||a===void 0||a.setFieldsValue({name:o.name,title:o.title,addressType:"".concat(u==null?void 0:u.protocol,"//"),address:"".concat(u!=null&&u.host&&u.host!=""?u.host:u==null?void 0:u.pathname),serverUrl:o.serverUrl,enableTLS:o.enableTLS,tlsCa:o.tlsCa,tlsCert:o.tlsCert,tlsKey:o.tlsKey,enableComposePath:o.enableComposePath,enableSSH:o.enableSSH,sshServerInfo:o.sshServerInfo,remoteType:o.remoteType?o.remoteType:"docker"}),$(!0),N(o.name)}}});var Q=(0,A.useState)(!1),w=I()(Q,2),q=w[0],$=w[1],M=(0,A.useRef)(),k=(0,A.useState)(""),z=I()(k,2),G=z[0],N=z[1];return(0,n.jsxs)(g.a,{drawerProps:{forceRender:!0},onOpenChange:function(o){if(!o){var a;N(""),(a=M.current)===null||a===void 0||a.resetFields()}$(o)},open:q,width:800,trigger:W.trigger,formRef:M,title:(y=M.current)!==null&&y!==void 0&&y.getFieldValue&&M.current.getFieldValue("name")=="local"?"\u914D\u7F6E\u9ED8\u8BA4Docker\u670D\u52A1\u7AEF":"\u6DFB\u52A0\u8FDC\u7A0BDocker\u670D\u52A1\u7AEF",onFinish:function(){var L=B()(x()().mark(function o(a){var u,d,v;return x()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,(0,s.ad)({name:a.name,title:a.title,address:"".concat((u=a.addressType)!==null&&u!==void 0?u:"unix://").concat((d=a.address)!==null&&d!==void 0?d:"/dpanel/sock/".concat(a.name,".sock")),serverUrl:a.serverUrl,enableTLS:a.enableTLS,tlsCa:a.tlsCa,tlsCert:a.tlsCert,tlsKey:a.tlsKey,enableComposePath:a.enableComposePath,composePath:a.enableComposePath?a.composePath:"",enableSSH:a.enableSSH||a.remoteType=="ssh",sshServerInfo:a.sshServerInfo,remoteType:a.remoteType});case 2:return v=O.sent,W.onFinish&&W.onFinish(),O.abrupt("return",!0);case 5:case"end":return O.stop()}},o)}));return function(o){return L.apply(this,arguments)}}(),children:[(0,n.jsx)(i.Z,{label:"\u540D\u79F0",name:"title",required:!0,rules:[{required:!0}],fieldProps:{id:"envTitle",onChange:function(o){var a="";if(o.target.value&&!G){var u,d=(0,l.N9)(o.target.value.trim(),{toneType:"none",type:"array"});a=d.join(""),(u=M.current)===null||u===void 0||u.setFieldValue("name",a)}}}},"envTitle"),(0,n.jsx)(i.Z,{label:"\u6807\u8BC6",name:"name",required:!0,disabled:G!="",rules:[{required:!0}],placeholder:"\u6807\u8BC6Docker\u73AF\u5883\uFF0C\u53EA\u5141\u8BB8\u4E3A\u82F1\u6587\u6216\u662F\u6570\u5B57"}),(0,n.jsx)(i.Z,{tooltip:"\u8BBE\u7F6E\u5BBF\u4E3B\u673A\u7684Ip\u6216\u662F\u57DF\u540D\uFF0C\u7528\u4E8E\u901A\u8FC7\u7AEF\u53E3\u7684\u5F62\u5F0F\u8BBF\u95EE\u5BB9\u5668\u3002\u652F\u6301IpV4\u53CAIpV6",label:"\u5BB9\u5668\u7AEF\u53E3\u8BBF\u95EE\u57DF\u540D",name:"serverUrl",placeholder:"\u4F8B\u5982:192.168.1.25\u30012001:db8:1::2\u3001example.com"}),(0,n.jsx)(m.Z.Group,{label:"\u8FDE\u63A5\u65B9\u5F0F",name:"remoteType",options:[{label:"DockerApi",value:"docker"},{label:"SSH",value:"ssh",disabled:((V=M.current)===null||V===void 0?void 0:V.getFieldValue("name"))=="local"}]}),(0,n.jsx)(p.Z,{name:["remoteType","name"],children:function(o){var a=o.remoteType,u=o.name;return(0,n.jsxs)(n.Fragment,{children:[a=="docker"&&(0,n.jsx)(C.Z,{children:(0,n.jsx)(P.Z,{span:24,children:(0,n.jsxs)(K.Z.Compact,{children:[(0,n.jsx)(h.Z,{name:"addressType",label:"Docker Api \u5730\u5740",valueEnum:{"unix://":"unix://","tcp://":"tcp://"},initialValue:"tcp://",fieldProps:{defaultValue:"tcp://"},tooltip:"\u8FDE\u63A5\u8FDC\u7A0B Docker \u65F6\u8BF7\u5148\u5F00\u542F Api \u5730\u5740\u8BBF\u95EE\u3002"}),(0,n.jsx)(i.Z,{label:" ",name:"address",required:!0,width:"xl",rules:[{required:!0}],placeholder:"\u4F8B\u5982\uFF1Aunix:///var/run/docker.sock\u3001tcp://192.16.0.5:2375"})]})})}),(0,n.jsxs)(C.Z,{gutter:[15,0],children:[a=="docker"&&(0,n.jsx)(P.Z,{children:(0,n.jsx)(E.Z,{label:"\u542F\u7528 Docker Api TLS",name:"enableTLS",tooltip:"\u751F\u6210\u6559\u7A0B\u89C1\uFF1Ahttps://donknap.github.io/dpanel-docs/#/zh-cn/manual/remote"})}),u!="local"&&typeof a!="undefined"&&(0,n.jsx)(P.Z,{children:(0,n.jsx)(E.Z,{label:(0,e.getLang)("system.env.createEnableComposePath"),name:"enableComposePath",tooltip:"\u5F00\u542F\u72EC\u7ACBcompose\u914D\u7F6E\u540E\uFF0C\u5207\u6362\u8FDC\u7A0B docker \u5BA2\u6237\u7AEF\u65F6\u5C06\u53EA\u4F1A\u8BFB\u53D6\u8BE5\u73AF\u5883\u4E13\u5C5E\u76EE\u5F55\u4E0B\u7684 compose \u4EFB\u52A1"})}),a=="docker"&&(0,n.jsx)(P.Z,{children:(0,n.jsx)(E.Z,{label:"\u542F\u7528\u5BBF\u4E3B\u673A SSH \u8FDE\u63A5",name:"enableSSH"})})]})]})}}),(0,n.jsx)(p.Z,{name:["enableTLS"],children:function(o){var a=o.enableTLS;if(a)return(0,n.jsxs)(U.Z,{gap:10,justify:"start",children:[(0,n.jsx)(c.Z,{name:"tlsCa",label:"\u4E0A\u4F20\u5BA2\u6237\u7AEF\u8BC1\u4E66",children:(0,n.jsx)(t.Z,{title:"ca.pem",onImport:function(d){var v;return(v=M.current)===null||v===void 0||v.setFieldValue("tlsCa",d),!0},onLoad:function(d){if(d.indexOf("CERTIFICATE")<0)throw new Error("\u5BFC\u5165ca.pem\u8BC1\u4E66\u9519\u8BEF");return!0}})}),(0,n.jsx)(c.Z,{name:"tlsCert",label:" ",children:(0,n.jsx)(t.Z,{title:"cert.pem",onImport:function(d){var v;return(v=M.current)===null||v===void 0||v.setFieldValue("tlsCert",d),!0},onLoad:function(d){if(d.indexOf("CERTIFICATE")<0)throw new Error("\u5BFC\u5165cert.pem\u8BC1\u4E66\u9519\u8BEF");return!0}})}),(0,n.jsx)(c.Z,{label:" ",name:"tlsKey",children:(0,n.jsx)(t.Z,{title:"key.pem",onImport:function(d){var v;return(v=M.current)===null||v===void 0||v.setFieldValue("tlsKey",d),!0},onLoad:function(d){if(d.indexOf("PRIVATE")<0)throw new Error("\u5BFC\u5165key.pem\u8BC1\u4E66\u9519\u8BEF");return!0}})})]})}}),(0,n.jsx)(p.Z,{name:["enableComposePath","name"],children:function(o){var a=o.enableComposePath,u=o.name;if(a)return(0,n.jsx)(i.Z,{label:(0,e.getLang)("system.env.createComposePath"),name:"composePath",disabled:!0,fieldProps:{value:"/dpanel/compose/compose-".concat(u!=null?u:"")}})}}),(0,n.jsx)(p.Z,{name:["enableSSH","sshServerInfo","remoteType","address"],children:function(o){var a=o.enableSSH,u=o.sshServerInfo,d=o.remoteType,v=o.address;return(a||d=="ssh")&&[(0,n.jsxs)(_.Z,{title:(0,n.jsx)(D.Z,{}),subTitle:"\u4E3B\u673ASSH",ghost:!0,children:[(0,n.jsxs)(n.Fragment,{children:[d=="ssh"&&(0,n.jsx)(c.Z,{children:(0,n.jsx)(b.Z,{message:(0,n.jsxs)(n.Fragment,{children:[(0,e.getLang)("system.env.remoteSSHTips")," ",(0,n.jsx)("a",{href:"https://dpanel.cc/#/zh-cn/manual/setting/docker-env?id=%e9%80%9a%e8%bf%87-ssh-%e6%b7%bb%e5%8a%a0",target:"_blank",children:(0,e.getLang)("notification.help")})]})})}),(0,n.jsx)(i.Z,{label:"\u4E3B\u673AIP\u5730\u5740",placeholder:"\u8F93\u5165\u4E3B\u673A\u7684IP\u8FDE\u63A5\u5730\u5740",name:["sshServerInfo","address"],required:!0,rules:[{required:!0}]})]}),(0,n.jsxs)(C.Z,{children:[(0,n.jsx)(P.Z,{children:(0,n.jsx)(T.Z,{initialValue:22,label:"\u7AEF\u53E3",name:["sshServerInfo","port"]})}),(0,n.jsx)(P.Z,{offset:2,children:(0,n.jsx)(m.Z.Group,{label:"\u9A8C\u8BC1\u65B9\u5F0F",name:["sshServerInfo","authType"],valueEnum:{basic:"\u5BC6\u7801\u8BA4\u8BC1",pem:"\u79C1\u94A5\u8BA4\u8BC1"},required:!0,rules:[{required:!0}]})})]}),u&&u.authType=="basic"&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.Z,{label:"\u7528\u6237\u540D",name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]}),(0,n.jsx)(i.Z.Password,{label:"\u5BC6\u7801",name:["sshServerInfo","password"],required:!0,rules:[{required:!0}]})]}),u&&u.authType=="pem"&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.Z,{label:"\u7528\u6237\u540D",name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]}),(0,n.jsx)(t.Z,{title:"\u5BFC\u5165\u5BC6\u94A5\u6587\u4EF6",onImport:function(O){var H;return(H=M.current)===null||H===void 0||H.setFieldValue(["sshServerInfo","privateKey"],O),!0},onLoad:function(O){if(!O.includes("PRIVATE KEY"))throw new Error((0,e.getLang)("system.env.sshImportKeyFileIncorrect"));return!0}}),(0,n.jsx)(j.Z,{name:["sshServerInfo","privateKey"],label:"\u5BC6\u94A5",required:!0,rules:[{required:!0}]}),(0,n.jsx)(i.Z.Password,{name:["sshServerInfo","password"],label:"\u5BC6\u94A5\u5BC6\u7801"})]})]},"sshSetting")]}})]})});F.Z=Y},12491:function(Z,F,r){r.d(F,{Z:function(){return i}});var f=r(24963),x=r(88484),S=r(62370),B=r(31418),R=r(28036),I=r(67294),g=r(85893);function i(m){var p=(0,I.useContext)(f.Z),h=p.message,E=p.notice,c=p.lang,_=(0,I.useRef)(null),T=B.Z.useApp(),j=function(){_.current&&(_.current.click(),_.current.onchange=function(P){if(!P||!P.target)return"";var K=new FileReader;K.onload=function(b){var A,l,s=(A=b.target)===null||A===void 0?void 0:A.result;if(m.onLoad)try{m.onLoad&&m.onLoad(s)}catch(t){E.error(t);return}typeof m.onImport=="function"&&(h.success("\u6210\u529F\u5BFC\u5165 ".concat(m.title)),m.onImport(s)),(l=_.current)!==null&&l!==void 0&&l.value&&(_.current.value="")};var U=P.target;if(U.files)try{K.readAsText(U.files[0])}catch(b){E.error("\u5BFC\u5165\u6587\u4EF6\u5FC5\u987B\u662F\u6587\u672C\u7C7B\u578B")}})};return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(S.Z,{children:(0,g.jsx)(R.ZP,{icon:(0,g.jsx)(x.Z,{}),block:!0,onClick:j,children:m.title})}),(0,g.jsx)("input",{style:{display:"none"},type:"file",ref:_,name:"importFileInput"})]})}},52756:function(Z,F,r){r.r(F),r.d(F,{default:function(){return p},getLang:function(){return m}});var f=r(82346),x=r(31418),S=r(26058),B=r(85137),R=r(24963),I=r(65913),g=r(67294),i=r(85893);function m(h,E,c){var _=(0,f.getLocale)();c!=null&&c.XK&&(_="zh-XK");var T=(0,f.getIntl)(_).formatMessage({id:h},E);return T}function p(){var h=(0,g.useRef)(),E=(0,f.useIntl)(),c=function(s){for(var t=arguments.length,e=new Array(t>1?t-1:0),D=1;D<t;D++)e[D-1]=arguments[D];T.notification[s]({message:E.formatMessage({id:"notification.title."+s}),description:e.join(" "),placement:"topRight"})},_=function(s){for(var t=arguments.length,e=new Array(t>1?t-1:0),D=1;D<t;D++)e[D-1]=arguments[D];T.message[s](e.join(" "))},T=x.Z.useApp(),j=(0,f.useModel)("@@initialState"),C=j.initialState,P=j.loading,K=j.error,U=j.refresh,b=j.setInitialState,A=(0,f.useModel)("subscriber");return C!=null&&C.user.username&&A.addDataHandler("user:permission:".concat(C==null?void 0:C.user.username),function(l){U()}),(0,i.jsx)(S.Z,{children:(0,i.jsx)(R.Z.Provider,{value:{notice:{success:function(){for(var s=arguments.length,t=new Array(s),e=0;e<s;e++)t[e]=arguments[e];c.apply(void 0,["success"].concat(t))},error:function(){for(var s=arguments.length,t=new Array(s),e=0;e<s;e++)t[e]=arguments[e];c.apply(void 0,["error"].concat(t))},warning:function(){for(var s=arguments.length,t=new Array(s),e=0;e<s;e++)t[e]=arguments[e];c.apply(void 0,["warning"].concat(t))},info:function(){for(var s=arguments.length,t=new Array(s),e=0;e<s;e++)t[e]=arguments[e];c.apply(void 0,["info"].concat(t))},destroy:function(){T.notification.destroy()}},message:{success:function(){for(var s=arguments.length,t=new Array(s),e=0;e<s;e++)t[e]=arguments[e];_.apply(void 0,["success"].concat(t))},error:function(){for(var s=arguments.length,t=new Array(s),e=0;e<s;e++)t[e]=arguments[e];_.apply(void 0,["error"].concat(t))},warning:function(){for(var s=arguments.length,t=new Array(s),e=0;e<s;e++)t[e]=arguments[e];_.apply(void 0,["warning"].concat(t))},info:function(){for(var s=arguments.length,t=new Array(s),e=0;e<s;e++)t[e]=arguments[e];_.apply(void 0,["info"].concat(t))},loading:function(){for(var s=arguments.length,t=new Array(s),e=0;e<s;e++)t[e]=arguments[e];_.apply(void 0,["loading"].concat(t))},destroy:function(){T.message.destroy()}},loading:{show:function(){h.current&&h.current.show()},destroy:function(){h.current&&h.current.destroy()}},lang:function(s,t){return E.formatMessage({id:s},t)}},children:(0,i.jsxs)(I.Z,{ref:h,children:[(0,i.jsx)(f.Outlet,{}),(0,i.jsx)(B.Z.BackTop,{duration:10,style:{bottom:100}})]})},P?"1":"2")})}},65913:function(Z,F,r){var f=r(5574),x=r.n(f),S=r(74330),B=r(67294),R=r(85893),I=(0,B.forwardRef)(function(g,i){(0,B.useImperativeHandle)(i,function(){return{show:function(){E(!0)},destroy:function(){E(!1)}}});var m=(0,B.useState)(!1),p=x()(m,2),h=p[0],E=p[1];return(0,R.jsx)(S.Z,{spinning:h,size:"default",children:g.children})});F.Z=I}}]);
