"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2628],{54958:function(k,Z,n){n.r(Z),n.d(Z,{default:function(){return U}});var O=n(15009),F=n.n(O),$=n(99289),I=n.n($),L=n(22191),R=n(24963),l=n(67294);function B(i){var f=(0,l.useContext)(R.Z),v=f.lang;return i.expression.unit=="preWeek"?"".concat(v("cron.week.".concat(i.expression.dayOfWeek),i.expression)).concat(v("cron.".concat(i.expression.unit),i.expression)):v("cron.".concat(i.expression.unit),i.expression)}var D=n(5574),S=n.n(D),C=n(83727),K=n(25035),E=n(184),h=n(42075),z=n(14726),N=n(63490),m=n(25593),P=n(55241),e=n(85893),w=(0,l.forwardRef)(function(i,f){var v=(0,l.useState)(!1),g=S()(v,2),p=g[0],j=g[1],u=(0,l.useState)([]),a=S()(u,2),t=a[0],c=a[1],d=(0,l.useContext)(R.Z),o=d.lang;return(0,l.useImperativeHandle)(f,function(){return{}}),(0,l.useEffect)(function(){},[]),(0,e.jsx)(E.a,{name:"templte",title:(0,e.jsxs)(h.Z,{children:[(0,e.jsx)("span",{children:"\u8BA1\u5212\u4EFB\u52A1\u811A\u672C\u6A21\u677F"}),(0,e.jsx)("a",{href:"",target:"_blank",children:(0,e.jsx)(K.Z,{})})]}),open:p,onOpenChange:function(r){j(r),r&&(0,C.VB)().then(function(x){c(x.data.list)})},submitter:!1,trigger:(0,e.jsx)(z.ZP,{children:"\u811A\u672C\u6A21\u677F"}),children:(0,e.jsx)(N.Z,{rowKey:function(r){return"".concat(r.project,"-").concat(r.name)},columns:[{title:"\u540D\u79F0",dataIndex:"name"},{title:"\u5206\u7C7B",dataIndex:"project"},{title:"\u63CF\u8FF0",width:350,dataIndex:"description",render:function(r,x,X){return"".concat(x.description," ").concat(x.tag.indexOf("run-in-dpanel")?"(".concat(o("cron.runInDPanel"),")"):"")}},{title:"\u64CD\u4F5C",width:100,render:function(r,x,X){return(0,e.jsxs)(h.Z,{children:[(0,e.jsx)(m.Z.Link,{onClick:function(){j(!1),i.onFinish&&i.onFinish(x)},children:"\u4F7F\u7528"},"use"),(0,e.jsx)(P.Z,{placement:"left",content:(0,e.jsx)("pre",{children:x.script}),children:(0,e.jsx)(m.Z.Link,{children:"\u9884\u89C8"},"preview")})]})}}],dataSource:t})})}),G=w,W=n(80821),H=n(67255),J=n(86548),Q=n(43425),V=n(90078),Y=n(10641),A=n(54006),y=n(66309),M=n(96074),T=n(83062);function U(){var i=(0,l.useRef)(),f=(0,l.useRef)(),v=(0,l.useRef)(),g=(0,l.useContext)(R.Z),p=g.lang,j=(0,A.useNavigate)();return(0,e.jsx)(V._z,{header:{extra:[(0,e.jsx)(L.Z,{ref:f,onFinish:function(){var a,t;!((a=i.current)===null||a===void 0)&&a.reloadAndRest&&((t=i.current)===null||t===void 0||t.reloadAndRest())},showTriggerButton:!0},"create"),(0,e.jsx)(G,{ref:v,onFinish:function(a){var t;(t=f.current)===null||t===void 0||t.edit({title:"",setting:{script:a.script,environment:a.environment,enableRunBlock:!0,disable:!1,keepLogTotal:10}})}},"template")]},children:(0,e.jsx)(Y.Z,{scroll:{x:"max-content"},rowKey:"id",pagination:(0,H.O)(),columns:[{title:"\u540D\u79F0",dataIndex:"title",render:function(a,t,c,d,o){return(0,e.jsx)(A.Link,{to:"/app/cron/log/"+t.id,children:t.title})}},{title:"\u6267\u884C\u5BB9\u5668",dataIndex:["setting","containerName"],search:!1},{title:"\u6267\u884C\u8BA1\u5212",search:!1,width:300,render:function(a,t,c,d,o){return(0,e.jsx)(h.Z,{direction:"vertical",children:t.setting.expression&&t.setting.expression.map(function(s,r){return(0,e.jsx)(B,{expression:s},"runCron-".concat(r))})})}},{title:"\u4E0B\u6B21\u6267\u884C\u65F6\u95F4",search:!1,width:200,render:function(a,t,c,d,o){return(0,e.jsx)(h.Z,{direction:"vertical",children:t.setting.nextRunTime?t.setting.nextRunTime.map(function(s,r){return(0,e.jsx)(y.Z,{children:new Date(s).toLocaleString()},"runNextTime-".concat(r))}):(0,e.jsx)(y.Z,{color:"error",children:p("cron.error")},"runNextTime-".concat(c))})}},{title:"\u64CD\u4F5C",width:100,search:!1,render:function(a,t,c,d,o){return(0,e.jsxs)(h.Z,{split:(0,e.jsx)(M.Z,{type:"vertical"}),children:[(0,e.jsx)(m.Z.Link,{onClick:function(){var r;(r=f.current)===null||r===void 0||r.edit(t)},children:(0,e.jsx)(T.Z,{title:"\u7F16\u8F91",children:(0,e.jsx)(J.Z,{})})},"manage"),(0,e.jsx)(m.Z.Link,{onClick:function(){j("/app/cron/log/"+t.id)},children:(0,e.jsx)(T.Z,{title:"\u8BF4\u60C5",children:(0,e.jsx)(Q.Z,{})})},"log")]})}}],request:function(){var u=I()(F()().mark(function a(t,c,d){var o;return F()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,C.SY)({title:t.title,page:t.current,pageSize:t.pageSize});case 2:return o=r.sent,r.abrupt("return",{data:o.data.list,success:!0,total:o.data.total});case 4:case"end":return r.stop()}},a)}));return function(a,t,c){return u.apply(this,arguments)}}(),rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},actionRef:i,tableAlertOptionRender:function(a){var t=a.selectedRowKeys,c=a.selectedRows;return(0,e.jsx)(h.Z,{size:16,children:(0,e.jsx)(W.Z,{danger:!0,type:"primary",action:function(){return(0,C.Ji)({id:c.map(function(o){return o.id})})},onSuccess:function(){var o,s;return!((o=i.current)===null||o===void 0)&&o.reloadAndRest&&((s=i.current)===null||s===void 0||s.reloadAndRest()),!0},onError:function(){var o,s;return!((o=i.current)===null||o===void 0)&&o.reset&&((s=i.current)===null||s===void 0||s.reset()),!0},messageSuccess:"delete",children:"\u6279\u91CF\u5220\u9664"},"delete")})}})})}}}]);
