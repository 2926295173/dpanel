"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7499],{43774:function(de,G,t){t.r(G),t.d(G,{default:function(){return Ae}});var Y=t(5574),d=t.n(Y),k=t(24963),v=t(15078),Z=t(90078),J=t(97269),z=t(62370),q=t(97462),R=t(38345),oe=t(45360),C=t(42075),_=t(65233),N=t(28036),ee=t(92398),T=t(2487),te=t(86250),F=t(32983),m=t(4393),r=t(67294),A=t(15009),n=t.n(A),me=t(99289),ne=t.n(me),he=t(184),pe=t(5966),ae=t(51652),B=t(71230),y=t(15746),fe=t(34041),ve=t(74842),re=t(25593),ge=t(83062),le=t(66309),e=t(85893);function ue(a){var D=(0,r.useState)(),g=d()(D,2),c=g[0],j=g[1];return(0,r.useEffect)(function(){var w=a.url.substring(0,a.url.indexOf("://"));switch(w){case"image":j((0,e.jsx)("img",{width:a.imageSize?a.imageSize.width:"auto",height:a.imageSize?a.imageSize.height:"auto",src:a.url.replace("image://","/dpanel/static/store/file/")}));break;case"http":case"https":j((0,e.jsx)("img",{width:a.imageSize?a.imageSize.width:"auto",height:a.imageSize?a.imageSize.height:"auto",src:a.url}));break;case"markdown-file":(0,v.yL)({path:a.url.replace("markdown-file://","/dpanel/static/store/file/")}).then(function(L){j((0,e.jsx)(ae.Z,{source:L,style:{padding:5}},"content"))});break;case"markdown":j((0,e.jsx)(ae.Z,{source:a.url.replace("markdown://",""),style:{padding:5}},"content"));break;default:j("")}},[a.url]),(0,e.jsx)(e.Fragment,{children:c})}function ce(a){return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(B.Z,{gutter:[10,10],children:[(0,e.jsx)(y.Z,{span:6,children:(0,e.jsx)(ue,{url:a.app.logo,imageSize:a.logoSize})}),(0,e.jsxs)(y.Z,{span:a.extra?12:18,children:[(0,e.jsx)(B.Z,{children:(0,e.jsx)(y.Z,{span:24,children:(0,e.jsxs)(C.Z,{direction:"horizontal",children:[(0,e.jsx)(re.Z.Title,{level:5,children:(0,e.jsx)("a",{href:a.app.website,target:"_blank",children:a.app.title})}),(0,e.jsx)(re.Z.Text,{children:a.app.name})]})})}),(0,e.jsx)(B.Z,{style:{height:"60px"},children:(0,e.jsx)(y.Z,{children:(0,e.jsx)(ge.Z,{title:a.app.description,children:(0,e.jsx)(re.Z.Paragraph,{ellipsis:{rows:2},children:a.app.description})})})}),(0,e.jsx)(B.Z,{style:{height:"35px"},children:(0,e.jsx)(y.Z,{children:(0,e.jsxs)(C.Z,{wrap:!0,children:[a.app.storeName?(0,e.jsx)(le.Z,{color:"blue-inverse",children:a.app.storeName}):"",a.app.tag&&a.app.tag.map(function(D,g){return(0,e.jsx)(le.Z,{children:D},g)})]})})})]}),(0,e.jsx)(y.Z,{span:a.extra?6:0,children:a.extra})]})})}var je=t(80821),xe=t(90098),se=t(82346),Se=t(69626),ye=t(3616),K=t(36146),Ze=(0,r.forwardRef)(function(a,D){var g=(0,r.useState)(!1),c=d()(g,2),j=c[0],w=c[1],L=(0,r.useState)(),Q=d()(L,2),i=Q[0],x=Q[1],O=(0,r.useState)(""),V=d()(O,2),E=V[0],H=V[1],U=(0,se.useNavigate)(),P=(0,r.useRef)(),S=(0,r.useRef)(),b=(0,r.useState)(),o=d()(b,2),l=o[0],h=o[1],p=new K.Uo("components.appstore");return(0,r.useImperativeHandle)(D,function(){return{show:function(u){w(!0),x(u),H(Object.keys(u.version)[0])}}}),(0,e.jsxs)(he.a,{drawerProps:{width:ye.R_},submitter:!1,open:j,onOpenChange:function(u){var f;w(u),(f=P.current)===null||f===void 0||f.resetFields()},title:"".concat(i==null?void 0:i.name," ").concat(K.FD.format("listManageDetail")),children:[(0,e.jsx)(Se.Z,{showBackListButton:!0,ref:S,onDeployFinish:function(){U("/compose/list")},onDeployFailed:function(){var s=ne()(n()().mark(function u(f){return n()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:case"end":return M.stop()}},u)}));return function(u){return s.apply(this,arguments)}}(),onClose:ne()(n()().mark(function s(){return n()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:case"end":return f.stop()}},s)}))}),i&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(R.Z,{ghost:!0,style:{marginBottom:"20px",paddingBottom:"20px",borderBottom:"#eeeeee solid 1px"},children:(0,e.jsx)(ce,{app:i,logoSize:{width:"130",height:"130"},extra:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(B.Z,{gutter:[10,10],children:[(0,e.jsx)(y.Z,{span:24,children:(0,e.jsx)(je.Z,{block:!0,type:"primary",action:ne()(n()().mark(function s(){var u,f,X,M,W,ie;return n()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return M={storeId:(u=i.storeId)!==null&&u!==void 0?u:0,name:(f=(X=P.current)===null||X===void 0?void 0:X.getFieldValue("name"))!==null&&f!==void 0?f:"".concat(i.name,"-%CURRENT_DATE%"),appName:i.name,title:i.title,composeFile:i.version[E].composeFile,environment:i.version[E].environment},$.next=3,(0,xe.iE)(M);case 3:W=$.sent,W&&W.data.id&&(h(W.data.id),(ie=S.current)===null||ie===void 0||ie.show(W.data.id));case 5:case"end":return $.stop()}},s)})),icon:(0,e.jsx)(ve.Z,{}),confirm:(0,e.jsx)(J.A,{submitter:!1,formRef:P,layout:"horizontal",isKeyPressSubmit:!0,children:(0,e.jsx)(pe.Z,{placeholder:p.format("detailNameEmpty"),width:"md",label:p.format("detailName"),name:"name"})}),children:K.FD.format("listManageDeploy")},"deploy")}),(0,e.jsx)(y.Z,{span:24,children:i.version&&(0,e.jsx)(fe.Z,{style:{width:"100%"},value:E,onChange:function(u){H(u)},options:Object.keys(i.version).map(function(s){return{value:s,label:s}})})})]})})})}),Object.keys(i.version).map(function(s){if(!(E!=s||!i.version[s].environment||i.version[s].environment.length==0)){var u="";return u+="## ".concat(p.format("detailDescVersion")," <sup>").concat(s,`</sup> 
 |`).concat(p.format("detailDescName"),"|").concat(p.format("detailDescDefault"),"|").concat(p.format("detailDescDesc"),`| 
 |---|---|---|
`),i.version[s].environment.map(function(f){u+="|".concat(f.name,"|").concat(f.value,"|").concat(f.label,`| 
`)}),u+="<br />",(0,e.jsx)(ae.Z,{source:u,style:{padding:5}},s)}}),(0,e.jsx)(ue,{url:i==null?void 0:i.content})]})]})}),Ce=Ze,I="dpanel-search-result";function Ae(){var a=(0,r.useRef)(),D=(0,r.useState)(),g=d()(D,2),c=g[0],j=g[1],w=(0,r.useContext)(k.Z),L=w.loading,Q=(0,r.useState)(""),i=d()(Q,2),x=i[0],O=i[1],V=(0,r.useState)([]),E=d()(V,2),H=E[0],U=E[1],P=(0,se.useLocation)(),S=new K.Uo("compose");(0,r.useEffect)(function(){L.show(),(0,v.eO)().then(function(o){if(o&&o.data&&o.data.list&&o.data.list.push({id:-1,name:I,title:S.format("storeSearchTitle"),setting:{apps:[]}}),o.data.list&&o.data.list.forEach(function(h){if(h.setting.type=="1panel-local"&&(!h.setting.updatedAt||Math.floor(Date.now()/1e3)-h.setting.updatedAt>86400)){var p;(0,v.ks)({id:h.id,name:h.name,url:(p=h.setting.url)!==null&&p!==void 0?p:"",type:"1panel-local"})}}),j(Object.fromEntries(o.data.list.map(function(h){return[h.name,h]}))),P.state){var l=P.state;l.name!=""&&O(P.state.name)}else o.data.list.length>0&&O(o.data.list[0].name)}).finally(function(){L.destroy()})},[]);var b=function(l){var h=[];l=l.toLowerCase(),c&&(Object.keys(c).map(function(p){p!=I&&c[p].setting.apps&&c[p].setting.apps.map(function(s){if(l&&(s.name.toLowerCase().indexOf(l)!==-1||s.title&&s.title.toLowerCase().indexOf(l)!==-1||s.description&&s.description.toLocaleLowerCase().indexOf(l)!==-1)){var u=JSON.parse(JSON.stringify(s));u.storeName="".concat(c[p].title),u.storeId=c[p].id,h.push(u)}})}),h.length>0?(U(h),O(I)):(oe.ZP.error(S.format("storeSearchNotMatch")),O(Object.keys(c)[0]),U([])))};return(0,e.jsxs)(Z._z,{extra:[(0,e.jsx)(J.A,{isKeyPressSubmit:!0,submitter:!1,onFinish:function(l){b(l.search)},children:(0,e.jsxs)(C.Z.Compact,{children:[(0,e.jsx)(z.Z,{style:{margin:0},name:"search",children:(0,e.jsx)(_.Z,{allowClear:!0,addonBefore:S.format("storeSearchButtonTip"),placeholder:S.format("storeSearchButtonEmpty"),onClear:function(){b("")}})}),(0,e.jsx)(q.Z,{name:["search"],children:function(l){var h=l.search;return(0,e.jsx)(N.ZP,{onClick:function(){b(h)},children:S.format("storeSearchButton")})}})]})},"form")],children:[(0,e.jsx)(Ce,{ref:a}),(0,e.jsxs)(R.Z,{children:[x!=""&&c&&(0,e.jsx)(ee.Z,{activeKey:x,onChange:function(l){U([]),O(l)},items:Object.keys(c).map(function(o){return{label:c[o].title,key:o,disabled:x!=I&&o==I}})}),(0,e.jsx)(T.Z,{locale:{emptyText:(0,e.jsx)(te.Z,{justify:"center",style:{height:"40vh"},vertical:!0,children:(0,e.jsx)(F.Z,{image:F.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsxs)(e.Fragment,{children:[S.format("storeEmpty"),", ",(0,e.jsx)(se.Link,{to:"/system/appstore?op=create",children:K.Ob.format("compose.appstore.create")})]})})})},pagination:{pageSize:36},rowKey:function(l){return"".concat(l.name).concat(l.storeName)},grid:{gutter:10,xs:1,sm:2,md:2,lg:2,xl:2,xxl:3},dataSource:x==I?H:c&&c[x]&&c[x].setting.apps,renderItem:function(l,h){return(0,e.jsx)(T.Z.Item,{children:(0,e.jsx)(m.Z,{onClick:function(){if(c){var s;l.storeId||(l.storeId=c[x].id),(s=a.current)===null||s===void 0||s.show(l)}},hoverable:!0,children:(0,e.jsx)(ce,{app:l,logoSize:{width:"50",height:"50"}})})},h)}})]})]})}},15078:function(de,G,t){t.d(G,{$c:function(){return J},Me:function(){return ee},eO:function(){return _},ks:function(){return q},yL:function(){return te}});var Y=t(15009),d=t.n(Y),k=t(99289),v=t.n(k),Z=t(82346);function J(m){return z.apply(this,arguments)}function z(){return z=v()(d()().mark(function m(r){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,Z.request)("/api/common/store/create",{method:"POST",data:r}));case 1:case"end":return n.stop()}},m)})),z.apply(this,arguments)}function q(m){return R.apply(this,arguments)}function R(){return R=v()(d()().mark(function m(r){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,Z.request)("/api/common/store/sync",{method:"POST",data:r}));case 1:case"end":return n.stop()}},m)})),R.apply(this,arguments)}function oe(m){return C.apply(this,arguments)}function C(){return C=_asyncToGenerator(_regeneratorRuntime().mark(function m(r){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",request("/api/common/store/get-detail",{method:"POST",data:r}));case 1:case"end":return n.stop()}},m)})),C.apply(this,arguments)}function _(m){return N.apply(this,arguments)}function N(){return N=v()(d()().mark(function m(r){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,Z.request)("/api/common/store/get-list",{method:"POST",data:r}));case 1:case"end":return n.stop()}},m)})),N.apply(this,arguments)}function ee(m){return T.apply(this,arguments)}function T(){return T=v()(d()().mark(function m(r){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,Z.request)("/api/common/store/delete",{method:"POST",data:r});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},m)})),T.apply(this,arguments)}function te(m){return F.apply(this,arguments)}function F(){return F=v()(d()().mark(function m(r){return d()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,Z.request)(r==null?void 0:r.path,{method:"GET"}));case 1:case"end":return n.stop()}},m)})),F.apply(this,arguments)}}}]);
