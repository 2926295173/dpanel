"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3985],{99861:function(_e,oe,u){var ce=u(15009),A=u.n(ce),xe=u(64599),z=u.n(xe),Ce=u(99289),W=u.n(Ce),Y=u(5574),I=u.n(Y),J=u(42119),Q=u(67294),h=u(92754),k=u(3393),Pe=u(184),P=u(38345),ae=u(85893),f=(0,Q.forwardRef)(function(Z,ie){(0,Q.useImperativeHandle)(ie,function(){return{start:function(){Ee(!0)}}});var re=(0,Q.useState)(0),le=I()(re,2),M=le[0],X=le[1],D=(0,Q.useRef)(),se=(0,Q.useState)(!1),de=I()(se,2),he=de[0],Ee=de[1];return(0,ae.jsxs)(Pe.a,{trigger:Z.trigger,width:800,open:he,submitter:!1,title:"\u4E00\u952E\u62C9\u53D6\u955C\u50CF",onOpenChange:function(){var me=W()(A()().mark(function ve(Be){var R,x,T,S,_,ue,e;return A()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(Ee(Be),!Be){b.next=26;break}x=0,T=z()(Z.image),b.prev=4,T.s();case 6:if((S=T.n()).done){b.next=16;break}return ue=S.value,X(x),(_=D.current)===null||_===void 0||_.setStart(ue),b.next=12,(0,k.Gb)({tag:ue,type:"pull"});case 12:e=b.sent,x++;case 14:b.next=6;break;case 16:b.next=21;break;case 18:b.prev=18,b.t0=b.catch(4),T.e(b.t0);case 21:return b.prev=21,T.f(),b.finish(21);case 24:(R=D.current)===null||R===void 0||R.setFinish(),X(x);case 26:case"end":return b.stop()}},ve,null,[[4,18,21,24]])}));return function(ve){return me.apply(this,arguments)}}(),children:[(0,ae.jsx)(P.Z,{children:(0,ae.jsx)(J.Z,{current:M,items:Z.image.map(function(me,ve){return{title:me,key:ve}})})}),(0,ae.jsx)(P.Z,{children:(0,ae.jsx)(h.Z,{ref:D})})]})});oe.Z=f},91058:function(_e,oe,u){var ce=u(5574),A=u.n(ce),xe=u(89035),z=u(38345),Ce=u(17186),W=u(24739),Y=u(5966),I=u(42075),J=u(14726),Q=u(85576),h=u(67294),k=u(95089),Pe=u(89063),P=u(85893),ae="docker-image",f=(0,h.forwardRef)(function(Z,ie){var re=(0,h.useState)(ae),le=A()(re,2),M=le[0],X=le[1],D=(0,h.useRef)(),se=(0,h.useState)(""),de=A()(se,2),he=de[0],Ee=de[1],me=function(){M!="code"?X("code"):X(ae)};(0,h.useImperativeHandle)(ie,function(){return{addEnvItem:function(x,T){var S,_=(S=D.current)===null||S===void 0?void 0:S.getList(),ue=!1;if(_==null||_.map(function(je){if(je.name==x){ue=!0;return}}),!ue){var e;(e=D.current)===null||e===void 0||e.add({name:x,value:T})}},clear:function(){var x;(x=D.current)===null||x===void 0||(x=x.getList())===null||x===void 0||x.map(function(T,S){var _;(_=D.current)===null||_===void 0||_.remove(S)})}}});function ve(R){try{var x,T;R==""&&(R=Be());for(var S=(x=(T=D.current)===null||T===void 0||(T=T.getList())===null||T===void 0?void 0:T.length)!==null&&x!==void 0?x:0,_=S;_>=0;_--){var ue;(ue=D.current)===null||ue===void 0||ue.remove(_)}var e=R.split(`
`),je=0;e.map(function(b){var ye,G=b.split("=");G.length<2||((ye=D.current)===null||ye===void 0||ye.add({name:G[0],value:G.slice(1).join("=")},je),je++)})}catch(b){console.log(b)}}function Be(){if(D&&D.current&&D.current.getList){var R,x=(R=D.current)===null||R===void 0?void 0:R.getList();if(x){var T=[];return x.map(function(S){T.push("".concat(S.name,"=").concat(S.value))}),T.join(`
`)}else return""}else return""}return(0,P.jsxs)(z.Z,{ghost:Z.showCardGhost,title:Z.label?Z.label:null,headerBordered:!0,extra:(Z.showCodeMode||Z.showImportButton)&&(0,P.jsxs)(I.Z,{children:[Z.showImportButton&&(0,P.jsx)("div",{style:{marginBottom:"-25px"},children:(0,P.jsx)(Pe.Z,{title:"\u5BFC\u5165 env \u6587\u4EF6",onImport:function(x){return ve(x),!0},onLoad:function(x){if(x.indexOf("=")<0)throw new Error("\u5BFC\u5165env\u6587\u4EF6\u9519\u8BEF");return!0}})}),Z.showCodeMode?(0,P.jsx)(J.ZP,{icon:(0,P.jsx)(xe.Z,{}),type:M=="code"?"primary":"default",onClick:me,children:"\u4EE3\u7801\u6A21\u5F0F"},"code"):""]}),children:[(0,P.jsx)(Ce.u,{name:Z.name?Z.name:"environment",actionRef:D,creatorButtonProps:Z.showAddButton?{creatorButtonText:"\u6DFB\u52A0\u5BB9\u5668\u73AF\u5883\u53D8\u91CF"}:!1,copyIconProps:!1,min:100,children:function(x,T,S){var _=S.getCurrentRowData();return(0,P.jsxs)(W.UW,{children:[(0,P.jsx)(Y.Z,{width:Z.showInDrawer?"sm":"md",name:"name",label:"\u53D8\u91CF\u540D",required:!0,rules:[{required:!0}],disabled:Z.showDisableName,placeholder:"\u8F93\u5165\u53D8\u91CF\u540D\u79F0"}),(0,P.jsx)(Y.Z,{width:Z.showInDrawer?"sm":"md",name:"value",label:"\u53D8\u91CF\u503C",rules:[{required:!!Z.requireValue}],disabled:Z.showDisableValue,placeholder:_&&_.label?_.label:"\u8F93\u5165\u53D8\u91CF\u503C"})]})}}),(0,P.jsx)(Q.Z,{width:"800px",open:M=="code",onCancel:function(){return X("docker-image")},onOk:function(){ve(he),X("docker-image")},children:(0,P.jsx)(k.ZP,{onChange:function(x){return Ee(x)},value:Be(),height:"680px",theme:"light"})})]})});oe.Z=f},89063:function(_e,oe,u){u.d(oe,{Z:function(){return I}});var ce=u(24963),A=u(88484),xe=u(62370),z=u(31418),Ce=u(14726),W=u(67294),Y=u(85893);function I(J){var Q=(0,W.useContext)(ce.Z),h=Q.message,k=Q.notice,Pe=Q.lang,P=(0,W.useRef)(null),ae=z.Z.useApp(),f=function(){P.current&&(P.current.click(),P.current.onchange=function(ie){if(!ie||!ie.target)return"";var re=new FileReader;re.onload=function(M){var X,D,se=(X=M.target)===null||X===void 0?void 0:X.result;if(J.onLoad)try{J.onLoad&&J.onLoad(se)}catch(de){k.error(de);return}typeof J.onImport=="function"&&(h.success("\u6210\u529F\u5BFC\u5165 ".concat(J.title)),J.onImport(se)),(D=P.current)!==null&&D!==void 0&&D.value&&(P.current.value="")};var le=ie.target;if(le.files)try{re.readAsText(le.files[0])}catch(M){k.error("\u5BFC\u5165\u6587\u4EF6\u5FC5\u987B\u662F\u6587\u672C\u7C7B\u578B")}})};return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(xe.Z,{children:(0,Y.jsx)(Ce.ZP,{icon:(0,Y.jsx)(A.Z,{}),block:!0,onClick:f,children:J.title})}),(0,Y.jsx)("input",{style:{display:"none"},type:"file",ref:P,name:"importFileInput"})]})}},35880:function(_e,oe,u){var ce=u(67294),A=(0,ce.createContext)({});oe.Z=A},52384:function(_e,oe,u){u.r(oe),u.d(oe,{default:function(){return Bu}});var ce=u(15009),A=u.n(ce),xe=u(99289),z=u.n(xe),Ce=u(5574),W=u.n(Ce),Y=u(90078),I=u(38345),J=u(97269),Q=u(2236),h=u(5966),k=u(97462),Pe=u(64218),P=u(92398),ae=u(38925),f=u(67294),Z=u(35880),ie=u(10641),re=u(62370),le=u(85576),M=u(42075),X=u(96074),D=u(25593),se=u(83062),de=u(71230),he=u(15746),Ee=u(14726),me=u(3393),ve=u(18148),Be=u(5251),R=u(64789),x=u(75162),T=u(23430),S=u(28307),_=u(78451),ue=u(99861),e=u(85893);function je(n){var B=(0,f.useState)(!1),E=W()(B,2),s=E[0],v=E[1],d=(0,f.useRef)(),r=(0,f.useContext)(Z.Z),l=r.createFormRef,i=r.volumeListRef,p=r.createEnvRef,o=r.domainRef,c=(0,f.useRef)(),j=function(){var F=z()(A()().mark(function C(m){var g,V,U,y,H,q,L,Ze,ee,te,Ae,$;return A()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return v(!1),a.next=3,(0,me.YU)({md5:m});case 3:y=a.sent,n.redeploy||(Ze=(H=l.current)===null||H===void 0?void 0:H.getFieldsValue(),(q=l.current)===null||q===void 0||q.resetFields(),(L=l.current)===null||L===void 0||L.setFieldsValue({siteName:Ze.siteName,siteTitle:Ze.siteTitle})),y.data.info.Config.Env&&y.data.info.Config.Env.map(function(t){var K,ne=t.split("=");(K=p.current)===null||K===void 0||K.addEnvItem(ne[0],ne.slice(1).join("="))}),(g=l.current)===null||g===void 0||g.setFieldValue("imageName",m),(V=l.current)===null||V===void 0||V.setFieldValue("workDir",y.data.info.Config.WorkingDir),(U=o.current)===null||U===void 0||U.setExposePort(y.data.info.Config.ExposedPorts),n.redeploy||(y.data.info.Config.Volumes?(Ae=[],Object.keys(y.data.info.Config.Volumes).map(function(t,K){Ae.push(t)}),(te=i.current)===null||te===void 0||te.setDefaultDestPath(Ae)):($=i.current)===null||$===void 0||$.setDefaultDestPath([]),(ee=l.current)===null||ee===void 0||ee.setFieldsValue({workDir:{value:"",useDefault:!0,default:y.data.info.Config.WorkingDir},user:{value:"",useDefault:!0,default:y.data.info.Config.User},command:{value:"",useDefault:!0,default:y.data.info.Config.Cmd&&y.data.info.Config.Cmd.join(" ")},entrypoint:{value:"",useDefault:!0,default:y.data.info.Config.Entrypoint&&y.data.info.Config.Entrypoint.join(" ")}}));case 10:case"end":return a.stop()}},C)}));return function(m){return F.apply(this,arguments)}}();return(0,f.useEffect)(function(){n.fromImageId&&j(n.fromImageId)},[n.fromImageId]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(le.Z,{open:s,width:1024,title:"\u9009\u62E9\u955C\u50CF",footer:!1,onCancel:function(){return v(!1)},children:(0,e.jsx)(ie.Z,{scroll:{x:"max-content"},columns:[{title:"Id",dataIndex:"Id",search:!1,width:200,render:function(C,m,g,V,U){return(0,e.jsx)(_.Z,{content:m.Id})}},{title:"\u955C\u50CF\u540D\u79F0",dataIndex:"tag",width:200,render:function(C,m,g,V){return(0,e.jsx)(_.Z,{content:m.RepoTags[0]})}},{title:"\u521B\u5EFA\u65E5\u671F",dataIndex:"Created",ellipsis:!0,search:!1,width:"180px",render:function(C,m,g,V){return(0,e.jsx)("div",{children:(0,Be.ZM)(m.Created*1e3)},m.Id)},sorter:function(C,m){return C.Created-m.Created}},{title:"\u64CD\u4F5C",valueType:"option",key:"option",width:80,render:function(C,m,g,V){return(0,e.jsxs)(M.Z,{split:(0,e.jsx)(X.Z,{type:"vertical"}),children:[(0,e.jsx)(D.Z.Link,{onClick:z()(A()().mark(function U(){return A()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.abrupt("return",j(m.RepoTags[0]));case 1:case"end":return H.stop()}},U)})),children:(0,e.jsx)(se.Z,{title:"\u4F7F\u7528\u955C\u50CF",children:(0,e.jsx)(R.Z,{})})},"addImage"),(0,e.jsx)(D.Z.Link,{onClick:z()(A()().mark(function U(){var y;return A()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:m.RepoTags[0]&&((y=c.current)===null||y===void 0||y.setImageName(m.RepoTags[0]));case 1:case"end":return q.stop()}},U)})),children:(0,e.jsx)(se.Z,{title:"\u66F4\u65B0\u955C\u50CF",children:(0,e.jsx)(x.Z,{})})},"updateImage")]})}}],request:function(){var F=z()(A()().mark(function C(m,g,V){var U,y,H,q,L;return A()().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return n.redeploy&&(y=(U=l.current)===null||U===void 0?void 0:U.getFieldValue("imageName"),m.tag=y?y.split(":")[0]:m.tag),ee.next=3,(0,ve.KG)({tag:m.tag});case 3:return H=ee.sent,q=0,L=[],H.data.list&&(L=H.data.list.flatMap(function(te){return te.RepoTags.map(function(Ae){return{Key:q++,Id:te.Id,Created:te.Created,RepoTags:[Ae]}})})),ee.abrupt("return",{data:L,success:!0,total:L.length});case 8:case"end":return ee.stop()}},C)}));return function(C,m,g){return F.apply(this,arguments)}}(),toolBarRender:function(){return[(0,e.jsx)(S.Z,{onClick:function(){v(!1)},buttonType:"primary",ref:c,onFinish:function(m){j(m)}},"remote")]},formRef:d,rowKey:"Key",pagination:{pageSize:5}})},"imageTableList"),(0,e.jsxs)(de.Z,{children:[(0,e.jsx)(he.Z,{span:14,children:(0,e.jsx)(h.Z,{label:"\u955C\u50CF",tooltip:n.redeploy?"\u66F4\u65B0\u5BB9\u5668\u65F6,\u53EA\u53EF\u4EE5\u9009\u62E9\u8BE5\u955C\u50CF\u4E0B\u7684\u4E0D\u540Ctag.\u4E5F\u53EF\u4EE5\u5F3A\u5236\u66F4\u65B0\u5DF2\u90E8\u7F72tag,\u66F4\u6B21\u90E8\u7F72":"\u65B0\u5EFA\u5BB9\u5668\u65F6,\u53EF\u4EE5\u4F7F\u7528\u672C\u5730\u955C\u50CF,\u4E5F\u53EF\u4EE5\u4E0B\u8F7D\u5168\u65B0\u7684\u955C\u50CF\u6216\u662F\u66F4\u65B0\u672C\u5730\u955C\u50CF\u7684tag",name:"imageName",disabled:!0,placeholder:"\u8BF7\u9009\u62E9\u955C\u50CF\uFF0C\u5982\u679C\u662F\u8FDC\u7A0B\u955C\u50CF\u8BF7\u5148\u4E0B\u8F7D",rules:[{required:!0}],required:!0})}),(0,e.jsx)(he.Z,{children:(0,e.jsx)(re.Z,{label:" ",children:(0,e.jsxs)(M.Z,{children:[(0,e.jsx)(Ee.ZP,{type:"primary",onClick:function(){return v(!0)},children:n.redeploy?"\u66F4\u65B0\u955C\u50CF":"\u9009\u62E9\u955C\u50CF"},"showBtn"),(0,e.jsx)(k.Z,{name:["imageName"],children:function(C){var m=C.imageName;if(n.redeploy)return(0,e.jsx)(ue.Z,{image:[m],trigger:(0,e.jsx)(se.Z,{title:"\u5FEB\u901F\u91CD\u65B0\u62C9\u53D6\u955C\u50CF\uFF0C\u66F4\u65B0\u5BB9\u5668",children:(0,e.jsx)(Ee.ZP,{icon:(0,e.jsx)(T.Z,{}),children:"\u66F4\u65B0\u6216\u662F\u62C9\u53D6\u5F53\u524D\u955C\u50CF"})})})}})]})})})]})]})}var b=u(60335),ye=u(24969),G=u(24739),$e=u(63434),ge=u(17186),ze=u(27496),Ye=u(66309);function Je(n){return(0,e.jsx)(ie.Z,{columns:[{title:"\u5BB9\u5668\u540D\u79F0",dataIndex:"names",render:function(E,s,v,d){return(0,e.jsx)(M.Z,{direction:"vertical",style:{textAlign:"left"},children:s==null?void 0:s.Names.map(function(r){return r})},s.Id)}},{title:"\u7AEF\u53E3",dataIndex:"ports",search:!1,render:function(E,s,v,d){return s!=null&&s.Ports?(0,e.jsx)(M.Z,{direction:"vertical",style:{textAlign:"left"},children:s==null?void 0:s.Ports.map(function(r,l){return(0,e.jsx)(Ye.Z,{color:"#2db7f5",icon:r.PublicPort?(0,e.jsx)(ze.Z,{}):"",children:"".concat(r.PublicPort?r.IP+":"+r.PublicPort+"->":"").concat(r.PrivatePort,"/").concat(r.Type)},l)})},s.Id):(0,e.jsx)(e.Fragment,{})}},{title:"\u8FD0\u884C\u5BB9\u5668",search:!1,render:function(E,s,v,d){return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(D.Z.Text,{ellipsis:{tooltip:s.Image},children:s.Image},s.Id)})}},{title:"\u64CD\u4F5C",valueType:"option",key:"option",ellipsis:!0,width:100,render:function(E,s,v,d){return[(0,e.jsx)(Ee.ZP,{type:"link",onClick:function(){(0,b.jV)({md5:s.Id}).then(function(l){return n.onSelect&&n.onSelect(l.data.info),!0})},children:(0,e.jsx)(R.Z,{})},s.Id)]}}],rowKey:"Id",request:function(){var B=z()(A()().mark(function E(s,v,d){return A()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(i,p){(0,b.IE)({tag:s.names}).then(function(o){var c={data:o.data.list,success:!0,total:o.data.list.length};i(c)})}));case 1:case"end":return l.stop()}},E)}));return function(E,s,v){return B.apply(this,arguments)}}(),pagination:{pageSize:5}})}var Qe=(0,f.forwardRef)(function(n,B){var E=(0,f.useState)(!1),s=W()(E,2),v=s[0],d=s[1],r=(0,f.useRef)(),l=function(o){var c=(0,f.useState)([]),j=W()(c,2),F=j[0],C=j[1];return(0,f.useEffect)(function(){(0,b.jV)({md5:o.name}).then(function(m){var g;return C((g=m.data.info.Config.Env)!==null&&g!==void 0?g:[]),!0})},[]),(0,e.jsxs)(I.Z,{bordered:!0,extra:o.action,style:{marginBottom:10},children:[(0,e.jsx)(I.Z,{title:"\u5173\u8054\u4FE1\u606F",children:(0,e.jsxs)(G.UW,{children:[(0,e.jsx)(h.Z,{label:"\u5BB9\u5668\u540D\u79F0",name:"name",width:"md",readonly:!0}),(0,e.jsx)(h.Z,{label:"\u8BBF\u95EEHostName",name:"alise",width:"md",tooltip:"\u901A\u8FC7\u914D\u7F6E\u6B64\u540D\u79F0\uFF0C\u5728\u5BB9\u5668\u5185\u90E8\u8FDB\u884C\u8BF7\u6C42\u8BBF\u95EE"}),(0,e.jsx)($e.Z,{label:"\u5173\u8054\u5B58\u50A8",name:"volume"})]})}),(0,e.jsx)(I.Z,{title:"\u73AF\u5883\u53D8\u91CF",children:(0,e.jsx)(M.Z,{direction:"vertical",children:F&&F.map(function(m,g){return(0,e.jsx)(D.Z.Text,{copyable:{icon:(0,e.jsx)(ye.Z,{}),onCopy:function(){var U=m.split("=");n.onAddEnv(U[0],U[1])},tooltips:["add env","success"]},code:!0,ellipsis:{tooltip:m},style:{width:300},children:m},g)})},"linkEnv")})]})},i=function(o){var c,j,F=!1,C=(c=(j=r.current)===null||j===void 0?void 0:j.getList())!==null&&c!==void 0?c:[];if(C.map(function(g){g.name==o.name&&(F=!0)}),!F){var m;(m=r.current)===null||m===void 0||m.add(o)}};return(0,f.useImperativeHandle)(B,function(){return{setDefaultLink:function(o){o&&o.map(function(c){c.name!=""&&i(c)})}}}),(0,e.jsxs)(I.Z,{title:"\u5173\u8054\u5BB9\u5668",headerBordered:!0,children:[(0,e.jsx)(ge.u,{name:"links",actionRef:r,creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u5173\u8054"},actionGuard:{beforeAddRow:function(o,c){return d(!0),!1}},copyIconProps:!1,min:0,itemRender:function(o,c){return(0,e.jsx)(l,{action:o.action,name:c.record.name})}}),(0,e.jsx)(le.Z,{title:"\u9009\u62E9\u5BB9\u5668",width:1024,footer:!1,open:v,onCancel:function(){return d(!1)},children:(0,e.jsx)(Je,{onSelect:function(o){i({name:o.Name,alise:o.Config.Hostname,volume:!1}),d(!1)}})})]})}),Xe=Qe,qe=u(91058),Le=u(86615),Re=u(64317),eu=(0,f.forwardRef)(function(n,B){var E=(0,f.useRef)(),s=(0,f.useRef)();return(0,f.useImperativeHandle)(B,function(){return{setDefaultDestPath:function(d){var r,l,i=(r=(l=E.current)===null||l===void 0?void 0:l.getList())!==null&&r!==void 0?r:[];d.length!=0&&d.filter(function(p){return p!=""}).map(function(p){var o=!1;if(i.map(function(j){if(j.dest==p){o=!0;return}}),!o){var c;(c=E.current)===null||c===void 0||c.add({dest:p,permission:"write",inImage:!0,edit:!1})}})},addUserVolumeItem:function(d,r){var l,i=(l=s.current)===null||l===void 0?void 0:l.getList(),p=!1;if(i==null||i.map(function(c){if(c.dest==r){p=!0;return}}),!p){var o;(o=s.current)===null||o===void 0||o.add({host:d,dest:r})}}}}),(0,e.jsxs)(e.Fragment,{children:[n.showDefault&&(0,e.jsx)(I.Z,{title:"\u9ED8\u8BA4\u5B58\u50A8\uFF08Volume\uFF09",subTitle:"\u9ED8\u8BA4\u5B58\u50A8\u4E0E\u7AD9\u70B9\u6807\u8BC6\u4FDD\u6301\u4E00\u81F4",headerBordered:!0,children:(0,e.jsx)(ge.u,{name:"volumesDefault",creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u76EE\u5F55\u5230\u9ED8\u8BA4\u5B58\u50A8"},actionRef:E,copyIconProps:!1,min:0,children:function(d,r,l){var i=l.getCurrentRowData();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(h.Z,{width:"lg",name:"dest",label:"\u5BB9\u5668\u5185\u8DEF\u5F84",required:!0,rules:[{required:!0}],disabled:i.inImage}),(0,e.jsx)(Le.Z.Group,{hidden:!0,name:"inImage",label:"\u955C\u50CF\u5185\u6302\u8F7D",valueEnum:{1:"\u662F",0:"\u5426"}})]})}})}),(0,e.jsx)(I.Z,{title:"\u81EA\u5B9A\u4E49\u6302\u8F7D\u6216\u662F\u5B58\u50A8\u5377",tooltip:"\u6302\u8F7D\u53EF\u4EE5\u662F\u5BBF\u4E3B\u673A\u7684\u76EE\u5F55\u6216\u662F\u6587\u4EF6\uFF0C\u4E5F\u53EF\u4EE5\u6307\u5B9A\u5B58\u50A8\u5377\u540D\uFF08\u81EA\u52A8\u65B0\u5EFA\uFF09\u3002",headerBordered:!0,direction:"column",children:(0,e.jsx)(ge.u,{actionRef:s,name:"volumes",creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u6620\u5C04\u76EE\u5F55"},copyIconProps:!1,min:0,children:(0,e.jsxs)(G.UW,{children:[(0,e.jsxs)(M.Z.Compact,{children:[(0,e.jsx)(h.Z,{label:"\u5BBF\u4E3B\u673A\u6587\u4EF6\u3001\u76EE\u5F55\u6216\u5B58\u50A8\u5377",name:"host",width:n.showInDrawer?"sm":"md",required:!0,rules:[{required:!0}]}),(0,e.jsx)(Re.Z,{label:" ",valueEnum:{write:"\u8BFB\u5199",readonly:"\u53EA\u8BFB"},initialValue:"write",name:"permission"})]}),(0,e.jsx)(h.Z,{label:"\u5BB9\u5668\u5185\u8DEF\u5F84",name:"dest",width:n.showInDrawer?"sm":"md",required:!0,rules:[{required:!0}],disabled:n.disabledUserVolumeDest})]})})})]})}),uu=eu,tu=u(2831),pe=u(52688),Ne=u(86125),nu=u(97857),Ue=u.n(nu),au=(0,f.forwardRef)(function(n,B){var E=(0,f.useRef)();(0,f.useImperativeHandle)(B,function(){return{addItem:function(d,r){var l,i=(l=E.current)===null||l===void 0?void 0:l.getList(),p=!1;if(i==null||i.map(function(c){if(c.name==d){p=!0;return}}),!p){var o;(o=E.current)===null||o===void 0||o.add({name:d,value:r})}},clear:function(){var d;(d=E.current)===null||d===void 0||(d=d.getList())===null||d===void 0||d.map(function(r,l){var i;(i=E.current)===null||i===void 0||i.remove(l)})}}});var s={};return n.hideCopyButton===!0&&(s.copyIconProps=!1),n.hideDeleteButton===!0&&(s.deleteIconProps=!1),(0,e.jsx)(ge.u,Ue()(Ue()({label:n.label,name:n.name,actionRef:E,creatorButtonProps:n.showAddButton?{creatorButtonText:"\u6DFB\u52A0"+(n.label?n.label:n.name)}:!1,min:n.min?n.min:0},s),{},{children:function(d,r,l){return(0,e.jsx)(G.UW,{children:n.items.map(function(i){return i.render?(0,e.jsx)("div",{children:i.render&&i.render(d,r,l)},"".concat(n.name,"-").concat(i.name,"-").concat(d.key)):(0,e.jsx)(h.Z,{width:i.width,name:i.name,label:i.label,required:i.required,rules:[{required:i.required}],disabled:i.disabled,placeholder:i.placeholder},"".concat(n.name,"-").concat(i.name,"-").concat(d.key))})})}}))}),ru=au;function lu(n){var B,E=(0,f.useState)(),s=W()(E,2),v=s[0],d=s[1];return(0,f.useEffect)(function(){(0,tu.aF)().then(function(r){return d(r.data.info)})},[]),(0,e.jsxs)(I.Z,{children:[(0,e.jsx)(h.Z,{label:"\u5171\u4EAB\u5185\u5B58\u5927\u5C0F - /dev/shm",name:"shmsize",initialValue:"64M",tooltip:"0 \u4E3A\u4F7F\u7528\u9ED8\u8BA464M"}),(0,e.jsx)(re.Z,{label:"\u6700\u5927Cpu\u914D\u989D",name:"cpus",tooltip:"0 \u4E3A\u4E0D\u9650\u5236",children:(0,e.jsx)(Ne.Z,{step:.1,max:v==null?void 0:v.NCPU,marks:{0:"0",.5:"0.5\u6838",1:"1\u6838",1.5:"1.5\u6838",2:"2\u6838",4:"4\u6838",6:"6\u6838",8:"8\u6838"}})}),(0,e.jsx)(re.Z,{label:"\u6700\u5927\u5185\u5B58\u914D\u989D",name:"memory",tooltip:"0 \u4E3A\u4E0D\u9650\u5236",children:(0,e.jsx)(Ne.Z,{step:256,max:Math.round(((B=v==null?void 0:v.MemTotal)!==null&&B!==void 0?B:0)/1024/1024),marks:{0:"0",1024:"1G",2048:"2G",3072:"3G",4096:"4G"}})}),(0,e.jsx)(Re.Z,{label:"\u65E5\u5FD7\u7C7B\u578B",name:["log","driver"],tooltip:"\u9ED8\u8BA4\u4F7F\u7528 json-file \u9A71\u52A8\u7531 docker \u7EDF\u4E00\u7BA1\u7406\u3002\u91C7\u7528 journal \u65F6\u65E5\u5FD7\u5C06\u6765\u5BBF\u4E3B\u673A\u7BA1\u7406",initialValue:"json-file",valueEnum:{"json-file":"json-file",journald:"journal (\u5BBF\u4E3B\u9700\u8981\u5B89\u88C5journal\u670D\u52A1)"}}),(0,e.jsx)(k.Z,{name:["log"],children:function(l){var i=l.log;if(i.driver=="json-file")return(0,e.jsxs)(G.UW,{children:[(0,e.jsx)(h.Z,{label:"\u65E5\u5FD7\u5207\u5272\u5C3A\u5BF8",name:["log","maxSize"],placeholder:"\u4F8B\u5982\uFF1A10k,5M",tooltip:"\u9ED8\u8BA4 Docker \u5E76\u4E0D\u4F1A\u81EA\u52A8\u5207\u5272\u65E5\u5FD7"}),(0,e.jsx)(h.Z,{tooltip:"\u9ED8\u8BA4 Docker \u5E76\u4E0D\u4F1A\u81EA\u52A8\u6E05\u7406\u65E5\u5FD7\u6587\u4EF6",label:"\u4FDD\u7559\u65E5\u5FD7\u6587\u4EF6\u6570",name:["log","maxFile"],placeholder:"\u4F8B\u5982\uFF1A10"})]})}}),(0,e.jsx)(ru,{name:"device",label:"\u5173\u8054\u8BBE\u5907",hideCopyButton:!0,showAddButton:!0,items:[{label:"\u5BBF\u4E3B\u673A\u8DEF\u5F84",name:"host",width:"md",placeholder:"\u4F8B\u5982\uFF1A/dev/tty0"},{label:"\u5BB9\u5668\u5185\u8DEF\u5F84",name:"dest",width:"md",placeholder:"\u4F8B\u5982\uFF1A/dev/tty0"}]}),(0,e.jsxs)(de.Z,{children:[(0,e.jsx)(he.Z,{span:4,children:(0,e.jsx)(pe.Z,{label:"\u4F7F\u7528 Gpu",name:["gpus","enable"]})}),(0,e.jsx)(he.Z,{span:20,children:(0,e.jsx)(k.Z,{name:["gpus"],children:function(l){var i=l.gpus;if(i&&i.enable)return(0,e.jsx)(Re.Z,{mode:"tags",label:"\u8BBE\u5907\u5217\u8868",name:["gpus","device"],placeholder:"\u914D\u7F6E\u4F7F\u7528\u8BBE\u5907id\u6216\u662Fuuid\uFF0C\u4E0D\u586B\u6240\u4E3A\u6240\u6709\u8BBE\u5907"})}})})]}),(0,e.jsx)(k.Z,{name:["gpus"],children:function(l){var i=l.gpus;if(i&&i.enable)return(0,e.jsx)(Re.Z,{label:"\u8BA1\u7B97\u80FD\u529B",name:["gpus","capabilities"],mode:"multiple",fieldProps:{allowClear:!0},options:[{label:"compute - \u8BA1\u7B97\u80FD\u529B",value:"compute"},{label:"compat32 - \u517C\u5BB932\u4F4D",value:"compat32"},{label:"graphics - \u56FE\u5F62\u5904\u7406\u80FD\u529B",value:"graphics"},{label:"utility - \u76D1\u63A7\u548C\u7BA1\u7406\u80FD\u529B",value:"utility"},{label:"video - \u89C6\u9891\u5904\u7406\u80FD\u529B",value:"video"},{label:"display - \u663E\u793A\u56FE\u5F62\u754C\u9762\u80FD\u529B",value:"display"}]})}})]})}function ou(){return(0,e.jsx)(I.Z,{title:"\u5BB9\u5668\u6807\u7B7E",children:(0,e.jsx)(ge.u,{name:"label",label:"",creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u5BB9\u5668\u6807\u7B7E"},copyIconProps:!1,min:0,children:(0,e.jsxs)(G.UW,{children:[(0,e.jsx)(h.Z,{width:"md",name:"name",label:"\u540D\u79F0",placeholder:""}),(0,e.jsx)(h.Z,{width:"md",name:"value",label:"\u503C",placeholder:""})]})})})}var iu=u(44771),ju="default",gu="user";function su(n){return(0,e.jsx)(re.Z,{label:n.label,tooltip:n.tooltip,children:(0,e.jsxs)(M.Z.Compact,{block:!0,children:[(0,e.jsx)(Le.Z.Group,{radioType:"button",name:[n.name,"useDefault"],options:[{label:"\u4F7F\u7528\u9ED8\u8BA4",value:!0},{label:"\u81EA\u5B9A\u4E49",value:!1}]}),(0,e.jsx)(k.Z,{name:[n.name],children:function(E){return E[n.name]&&E[n.name].useDefault?(0,e.jsx)(h.Z,{name:[n.name,"default"],disabled:!0,placeholder:"\u672A\u8BBE\u7F6E"}):(0,e.jsx)(h.Z,{name:[n.name,"value"]})}})]})})}var Te=su;function du(){return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(I.Z,{children:[(0,e.jsx)(iu.Z,{label:"\u91CD\u542F\u7B56\u7565"}),(0,e.jsxs)(G.UW,{children:[(0,e.jsx)(pe.Z,{name:"privileged",label:"\u8D4B\u4E88\u5BB9\u5668Root\u6743\u9650",initialValue:!1}),(0,e.jsx)(pe.Z,{name:"autoRemove",label:"\u505C\u6B62\u540E\u81EA\u52A8\u5220\u9664",initialValue:!1})]}),(0,e.jsx)(Te,{label:"\u5DE5\u4F5C\u76EE\u5F55",tooltip:"\u9ED8\u8BA4\u4F7F\u7528\u955C\u50CF\u4E2D\u6307\u5B9A\u7684\u5DE5\u4F5C\u76EE\u5F55",name:"workDir"}),(0,e.jsx)(Te,{label:"User",tooltip:"\u5728\u5BB9\u5668\u4E2D\u8FD0\u884C\u547D\u4EE4\u7684\u7528\u6237",name:"user"}),(0,e.jsx)(Te,{label:"Command",tooltip:"\u542F\u52A8\u5BB9\u5668\u65F6\u8FD0\u884C\u7684\u547D\u4EE4\uFF0C\u4EE5\u7A7A\u683C\u5206\u9694",name:"command"}),(0,e.jsx)(Te,{label:"Entrypoint",tooltip:"\u65E0\u6CD5\u8986\u76D6\u955C\u50CF\u4E2D\u5DF2\u7ECF\u6307\u5B9A\u7684 Entrypoint \u547D\u4EE4",name:"entrypoint"})]})})}var cu=u(91845),We=u(62597),He=u(54006),mu=u(4798),vu=(0,f.forwardRef)(function(n,B){var E=(0,f.useState)(""),s=W()(E,2),v=s[0],d=s[1],r=(0,f.useRef)(),l=(0,f.useContext)(Z.Z),i=l.createFormRef;return(0,f.useImperativeHandle)(B,function(){return{setExposePort:function(o){if(o){var c,j,F=(c=(j=r.current)===null||j===void 0?void 0:j.getList())!==null&&c!==void 0?c:[];Object.keys(o).map(function(C){var m=!1;if(F.map(function(V){V.dest==C&&(m=!0)}),!m){var g;(g=r.current)===null||g===void 0||g.add({host:"",dest:C})}})}},setHostname:function(o){d(o)},addPortItem:function(o,c){var j,F=(j=r.current)===null||j===void 0?void 0:j.getList(),C=!1;if(F==null||F.map(function(g){if(g.host==o){C=!0;return}}),!C){var m;(m=r.current)===null||m===void 0||m.add({host:String(o),dest:String(c)})}}}}),(0,e.jsx)(I.Z,{title:"\u7ED1\u5B9A\u7AEF\u53E3",tooltip:"\u8BBF\u95EE\u7AEF\u53E3\u7559\u7A7A\u65F6\u968F\u673A\u751F\u6210\u7AEF\u53E3\uFF0C\u5168\u90E8\u5220\u9664\u5219\u8868\u793A\u4E0D\u66B4\u9732\u7AEF\u53E3",headerBordered:!0,extra:(0,e.jsxs)(M.Z,{children:[n.showBindHost&&(0,e.jsx)(pe.Z,{name:"useHostNetwork",fieldProps:{checkedChildren:"\u7ED1\u5B9AHost\u7F51\u7EDC",unCheckedChildren:"\u7ED1\u5B9AHost\u7F51\u7EDC",onChange:function(o){if(o){var c;(c=i.current)===null||c===void 0||c.setFieldsValue({bindIpV6:!1,publishAllPorts:!1})}}}}),n.showBindIpV6&&(0,e.jsx)(k.Z,{name:["siteName","useHostNetwork"],children:function(o){var c=o.useHostNetwork;return(0,e.jsx)(pe.Z,{name:"publishAllPorts",fieldProps:{checkedChildren:"\u7ED1\u5B9A\u5168\u90E8\u7AEF\u53E3",unCheckedChildren:"\u7ED1\u5B9A\u5168\u90E8\u7AEF\u53E3"},disabled:c},"publishAllPorts")}}),n.showBindIpV6&&(0,e.jsx)(k.Z,{name:["siteName","useHostNetwork"],children:function(o){var c=o.useHostNetwork;return(0,e.jsx)(pe.Z,{name:"bindIpV6",fieldProps:{checkedChildren:"IpV6",unCheckedChildren:"IpV6"},disabled:c},"bindIpV6")}})]}),children:(0,e.jsx)(k.Z,{name:["useHostNetwork","bindIpV6","publishAllPorts"],children:function(o){var c=o.useHostNetwork,j=o.bindIpV6,F=o.publishAllPorts;if(!c&&!F)return(0,e.jsx)(ge.u,{name:"ports",actionRef:r,creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u5BF9\u5916\u90E8\u8BBF\u95EE"},min:0,copyIconProps:!1,children:(0,e.jsxs)(G.UW,{children:[(0,e.jsx)(h.Z,{width:n.showInDrawer?"sm":"md",name:"host",label:"\u5916\u90E8\u8BBF\u95EE\u7AEF\u53E3",tooltip:"\u5BF9\u5916\u8BBF\u95EE\u53EF\u4EE5\u901A\u8FC7\u6DFB\u52A0\u8BBF\u95EE\u7AEF\u53E3\u6216\u662F\u521B\u5EFA\u5B8C\u6210\u540E\u5BF9\u5BB9\u5668\u7ED1\u5B9A\u57DF\u540D",placeholder:"\u7559\u7A7A\u5C06\u4F7F\u7528\u968F\u673A\u7AEF\u53E3\uFF0C\u7ED1\u5B9AIpV6\u5FC5\u586B",required:j,rules:[{required:j}]}),(0,e.jsx)(h.Z,{label:"\u5BB9\u5668\u5185\u7AEF\u53E3",width:n.showInDrawer?"sm":"md",name:"dest",placeholder:"\u6784\u5EFA\u65F6 Expose \u6307\u5B9A\u7684\u7AEF\u53E3",required:!0,rules:[{required:!0}]})]})})}})})}),fu=vu;function De(n){return(0,e.jsx)("div",{style:{display:n.show?"block":"none"},children:n.children})}function hu(){var n=(0,f.useRef)(),B=function(v){var d,r,l=!1,i=(d=(r=n.current)===null||r===void 0?void 0:r.getList())!==null&&d!==void 0?d:[];if(i.map(function(o){o.name==v.name&&(l=!0)}),!l){var p;(p=n.current)===null||p===void 0||p.add(v)}},E=function(v){var d,r,l=!1,i=(d=(r=n.current)===null||r===void 0?void 0:r.getList())!==null&&d!==void 0?d:[];i.map(function(p,o){if(p.name==v){var c;(c=n.current)===null||c===void 0||c.remove(o)}})};return(0,e.jsx)(I.Z,{title:"\u5173\u8054\u5BBF\u4E3B\u7F51\u7EDC\u4E3B\u673A",tooltip:"\u5BB9\u5668\u5185\u5982\u679C\u9700\u8981\u8BF7\u6C42\u5BBF\u4E3B\u673A\u6240\u5728\u7684\u7F51\u7EDC\u4E2D\u7684\u4E3B\u673A\uFF0C\u53EF\u4EE5\u901A\u8FC7\u6B64\u914D\u7F6E\u5C06Ip\u6CE8\u5165\u5230\u5BB9\u5668\u4E2D",extra:(0,e.jsx)(M.Z,{children:(0,e.jsx)(pe.Z,{name:"enableBindHost",fieldProps:{checkedChildren:"\u7ED1\u5B9A\u5BBF\u4E3B\u673AIp",unCheckedChildren:"\u7ED1\u5B9A\u5BBF\u4E3B\u673AIp",onChange:function(v){v?B({name:"host.dpanel.local",value:"host-gateway"}):E("host.dpanel.local")}}})}),children:(0,e.jsx)(ge.u,{name:"extraHosts",creatorButtonProps:{creatorButtonText:"\u6DFB\u52A0\u5BBF\u4E3B\u673A\u7F51\u7EDC\u5173\u8054"},actionRef:n,copyIconProps:!1,min:0,children:(0,e.jsxs)(G.UW,{children:[(0,e.jsx)(h.Z,{width:"md",name:"name",label:"Hostname",placeholder:""}),(0,e.jsx)(h.Z,{width:"md",name:"value",label:"ip",placeholder:""})]})})})}var Oe=u(90672),Eu=(0,f.forwardRef)(function(n,B){return(0,f.useImperativeHandle)(B,function(){return{}}),(0,e.jsxs)(I.Z,{title:"\u7F51\u7EDC\u914D\u7F6E",children:[(0,e.jsxs)(G.UW,{children:[(0,e.jsx)(h.Z,{label:"\u914D\u7F6E ipV4 \u5730\u5740",name:["ipV4","address"],width:"md",tooltip:"\u6307\u5B9A\u5BB9\u5668\u7684ipv4\u5730\u5740\uFF0C\u4F8B\u5982 192.168.1.5",placeholder:"192.168.1.5"}),(0,e.jsx)(k.Z,{name:["ipV4"],children:function(s){var v=s.ipV4;return(0,e.jsx)(h.Z,{label:"\u914D\u7F6E ipV4 \u5B50\u7F51",name:["ipV4","subnet"],width:"md",required:v&&v.address,tooltip:"\u6307\u5B9A\u5BB9\u5668\u7684ipv4\u6240\u5728\u7684\u5B50\u7F51\uFF0C\u4F8B\u5982 192.168.1.0/24",placeholder:"192.168.1.0/24",rules:[{required:v&&v.address}]})}}),(0,e.jsx)(h.Z,{label:"\u914D\u7F6E ipV4 \u7F51\u5173",name:["ipV4","gateway"],width:"md",tooltip:"\u6307\u5B9A\u5BB9\u5668\u7684ipv4\u7684\u7F51\u5173\uFF0C\u4F8B\u5982 192.168.1.1",placeholder:"192.168.1.1"}),(0,e.jsx)(pe.Z,{label:"\u81EA\u5B9A\u4E49ipV6",name:"enableIpV6Address"})]}),(0,e.jsx)(k.Z,{name:["enableIpV6Address"],children:function(s){var v=s.enableIpV6Address;if(v)return(0,e.jsxs)(G.UW,{children:[(0,e.jsx)(h.Z,{label:"\u914D\u7F6E ipV6 \u5730\u5740",name:["ipV6","address"],width:"md",tooltip:"\u6307\u5B9A\u5BB9\u5668\u7684ipV6\u5730\u5740\uFF0C\u4F8B\u5982 2001:db8::5",placeholder:"2001:db8::5"}),(0,e.jsx)(k.Z,{name:["ipV6"],children:function(r){var l=r.ipV6;return(0,e.jsx)(h.Z,{label:"\u914D\u7F6E ipV6 \u5B50\u7F51",name:["ipV6","subnet"],width:"md",required:l&&l.address,tooltip:"\u6307\u5B9A\u5BB9\u5668\u7684ipv4\u6240\u5728\u7684\u5B50\u7F51\uFF0C\u4F8B\u5982 2001:db8::/48",placeholder:"2001:db8::/48",rules:[{required:l&&l.address}]})}}),(0,e.jsx)(h.Z,{label:"\u914D\u7F6E ipV6 \u7F51\u5173",name:["ipV6","gateway"],width:"md",tooltip:"\u6307\u5B9A\u5BB9\u5668\u7684ipV6\u7684\u7F51\u5173\uFF0C\u4F8B\u5982 2001:db8::1",placeholder:"2001:db8::1"})]})}}),(0,e.jsx)(Oe.Z,{label:"DNS\u914D\u7F6E",name:"dns",placeholder:"\u8BF7\u6307\u5B9Adns\u5730\u5740\uFF0C\u4F8B\u5982\uFF1A8.8.8.8\uFF0C\u4E00\u884C\u6DFB\u4E00\u6761dns\u5730\u5740"})]})}),pu=Eu,Fu=u(24963),ke=u(31199),xu=u(86250);function Cu(){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(I.Z,{title:"\u9644\u52A0\u6267\u884C\u811A\u672C",headerBordered:!0,subTitle:"",children:(0,e.jsx)(Oe.Z,{label:"\u5BB9\u5668\u521B\u5EFA\u540E\u6267\u884C\u811A\u672C",name:["hook","containerCreate"],placeholder:"\u5BB9\u5668\u5728\u521B\u5EFA\u540E\u6267\u884C\u7684\u811A\u672C\uFF0C\u6B64\u811A\u672C\u5E76\u4E0D\u4F1A\u5F71\u54CD entrypoint \u53CA command\u3002\u4F8B\u5982\uFF1Als -al && touch abc.txt && apt update"})}),(0,e.jsxs)(I.Z,{title:"\u5065\u5EB7\u68C0\u67E5",headerBordered:!0,children:[(0,e.jsxs)(xu.Z,{gap:20,justify:"start",children:[(0,e.jsx)(ke.Z,{label:"\u91CD\u590D\u95F4\u9694\u65F6\u95F4\uFF08\u79D2\uFF09",name:["healthcheck","interval"],initialValue:30}),(0,e.jsx)(ke.Z,{label:"\u8D85\u65F6\u5931\u8D25\u65F6\u95F4\uFF08\u79D2\uFF09",name:["healthcheck","timeout"],initialValue:10}),(0,e.jsx)(ke.Z,{label:"\u5931\u8D25\u91CD\u590D\u6B21\u6570",name:["healthcheck","retries"],initialValue:3}),(0,e.jsx)(Re.Z,{width:"sm",label:"\u811A\u672C\u6267\u884C\u73AF\u5883",initialValue:"CMD",name:["healthcheck","shellType"],valueEnum:{CMD:"\u5728 Docker \u73AF\u5883\u6267\u884C","CMD-SHELL":"\u5728\u5BB9\u5668\u5185\u6267\u884C"}})]}),(0,e.jsx)(Oe.Z,{label:"\u6267\u884C\u811A\u672C",name:["healthcheck","cmd"],placeholder:"\u914D\u7F6E\u5BB9\u5668\u5065\u5EB7\u68C0\u67E5\u811A\u672C\uFF0C\u4F8B\u5982\uFF1Acurl -f http://localhost:8080/ || exit 1"})]})]})}var we="update",Ke="copy",Me="new";function Bu(){var n,B,E,s=(0,f.useContext)(Fu.Z),v=s.loading,d=(0,f.useContext)(Z.Z),r=d.createFormRef,l=d.volumeListRef,i=d.domainRef,p=d.createEnvRef,o=d.createLinkRef,c=(0,f.useState)(Me),j=W()(c,2),F=j[0],C=j[1],m=(0,He.useSearchParams)(),g=W()(m,2),V=g[0],U=g[1],y=(0,He.useNavigate)(),H=(0,f.useState)("basic"),q=W()(H,2),L=q[0],Ze=q[1],ee=parseInt((n=V.get("id"))!==null&&n!==void 0?n:""),te=(B=V.get("containerId"))!==null&&B!==void 0?B:"",Ae=(E=V.get("imageId"))!==null&&E!==void 0?E:"";return(0,f.useEffect)(function(){if(te||ee)v.show(),(0,We.iE)({md5:te,id:ee}).then(function(){var N=z()(A()().mark(function a(t){var K,ne,w,Fe,fe,Ve,Se,Ge;return A()().wrap(function(be){for(;;)switch(be.prev=be.next){case 0:if(w={info:{},layer:[]},V.get("op")==Ke?C(Ke):C(we),t.data.env.network&&t.data.env.network.map(function(O){return!O.alise&&O.name!="bridge"&&(O.alise=[t.data.siteName+".pod.dpanel.local"]),O}),t.data.env.ports&&t.data.env.ports.map(function(O){return O.host=="0"&&(O.host=""),O}),Fe=t.data.env.bindIpV6,t.data.containerInfo.Info&&t.data.containerInfo.Info.NetworkSettings.Networks&&Object.keys(t.data.containerInfo.Info.NetworkSettings.Networks).map(function(O){t.data.env.network&&(t.data.env.network=t.data.env.network.map(function(Ie){return O==Ie.name&&(Ie.subnet=t.data.containerInfo.Info.NetworkSettings.Networks[O].IPAddress+"/"+t.data.containerInfo.Info.NetworkSettings.Networks[O].IPPrefixLen),Ie})),t.data.containerInfo.Info.NetworkSettings.Networks[O].IPv6Gateway!=""&&(Fe=!0)}),t.data.env.extraHosts&&t.data.env.extraHosts.map(function(O){if(O.value=="host-gateway"){var Ie;(Ie=r.current)===null||Ie===void 0||Ie.setFieldValue("enableBindHost",!0)}}),fe=t.data.env.ports,t.data.env.ports&&(fe=t.data.env.ports.map(function(O){return O.host=(O.hostIp?O.hostIp+":":"")+O.host,O})),(K=r.current)===null||K===void 0||K.setFieldsValue({imageName:t.data.env.imageName,privileged:t.data.env.privileged,bindIpV6:t.data.env.useHostNetwork?!1:Fe,useHostNetwork:t.data.env.useHostNetwork,publishAllPorts:t.data.env.useHostNetwork?!1:t.data.env.publishAllPorts,workDir:{value:t.data.env.workDir,useDefault:!t.data.env.workDir,default:w&&w.info.Config&&w.info.Config.WorkingDir},user:{value:t.data.env.user,useDefault:!t.data.env.user,default:w&&w.info.Config&&w.info.Config.User},command:{value:t.data.env.command,useDefault:!t.data.env.command,default:w&&w.info.Config&&w.info.Config.Cmd&&w.info.Config.Cmd.join(" ")},entrypoint:{value:t.data.env.entrypoint,useDefault:!t.data.env.entrypoint,default:w&&w.info.Config&&w.info.Config.Entrypoint&&w.info.Config.Entrypoint.join(" ")},shmsize:(ne=t.data.env.shmsize)!==null&&ne!==void 0?ne:"64M",cpus:t.data.env.cpus,memory:t.data.env.memory,environment:t.data.env.environment,label:t.data.env.label,volumesDefault:t.data.env.volumesDefault,volumes:t.data.env.volumes,ports:fe,links:t.data.env.links,network:t.data.env.network,restart:t.data.env.restart,extraHosts:t.data.env.extraHosts,autoRemove:t.data.env.autoRemove,log:t.data.env.log,dns:t.data.env.dns&&t.data.env.dns.join(`
`),ipV4:t.data.env.ipV4,ipV6:t.data.env.ipV6,gpus:t.data.env.gpus,device:t.data.env.device,hook:t.data.env.hook}),t.data.env.healthcheck&&t.data.env.healthcheck.cmd&&t.data.env.healthcheck.cmd!=""&&((Ve=r.current)===null||Ve===void 0||Ve.setFieldsValue({healthcheck:t.data.env.healthcheck})),V.get("op")==we&&((Se=r.current)===null||Se===void 0||Se.setFieldsValue({siteTitle:t.data.siteTitle,siteName:t.data.siteName})),!t.data.env.imageName){be.next=17;break}return be.next=15,(0,me.YU)({md5:t.data.env.imageName});case 15:Ge=be.sent,w=Ge.data;case 17:case"end":return be.stop()}},a)}));return function(a){return N.apply(this,arguments)}}()).finally(function(){v.destroy()});else{var $;C(Me),($=r.current)===null||$===void 0||$.resetFields()}},[V]),(0,e.jsx)(Y._z,{children:(0,e.jsx)(I.Z,{direction:"column",gutter:[0,10],children:(0,e.jsxs)(J.A,{submitter:{render:function(N,a){return(0,e.jsx)(Q.S,{children:a})}},formRef:r,onFinish:function(){var $=z()(A()().mark(function N(a){var t,K,ne,w;return A()().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return console.log(a),w={siteTitle:a.siteTitle,siteName:a.siteName,imageName:a.imageName,environment:a.environment,links:a.links,ports:a.ports,volumes:a.volumes,volumesDefault:a.volumesDefault,network:a.network,privileged:(t=a.privileged)!==null&&t!==void 0?t:!1,autoRemove:(K=a.autoRemove)!==null&&K!==void 0?K:!1,restart:a.restart,cpus:a.cpus,memory:a.memory,shmsize:(ne=a.shmsize)!==null&&ne!==void 0?ne:0,workDir:a.workDir&&!a.workDir.useDefault?a.workDir.value:"",user:a.user&&!a.user.useDefault?a.user.value:"",command:a.command&&!a.command.useDefault?a.command.value:"",entrypoint:a.entrypoint&&!a.entrypoint.useDefault?a.entrypoint.value:"",useHostNetwork:a.useHostNetwork,bindIpV6:a.bindIpV6,log:a.log,dns:a.dns&&a.dns!=""?a.dns.split(`
`):[],label:a.label,publishAllPorts:a.publishAllPorts,extraHosts:a.extraHosts,ipV4:a.ipV4,ipV6:a.ipV6,device:a.device,gpus:a.gpus,hook:a.hook},a.healthcheck&&a.healthcheck.cmd&&a.healthcheck.cmd!=""&&(w.healthcheck=a.healthcheck),te&&F==we&&(w.containerId=te),fe.next=6,(0,We.$G)(w);case 6:return y("/app/list"),fe.abrupt("return",!0);case 8:case"end":return fe.stop()}},N)}));return function(N){return $.apply(this,arguments)}}(),children:[(0,e.jsxs)(I.Z,{title:"\u57FA\u7840\u4FE1\u606F",headerBordered:!0,children:[(0,e.jsx)(h.Z,{name:"siteTitle",label:"\u7AD9\u70B9\u540D\u79F0",required:!0,rules:[{required:!0}],fieldProps:{onChange:function(N){var a="";if(N.target.value&&F!=we){var t,K=(0,cu.N9)(N.target.value.trim(),{toneType:"none",type:"array"});a=K.join(""),(t=r.current)===null||t===void 0||t.setFieldValue("siteName",a)}}},placeholder:"\u8BF7\u8F93\u5165\u7AD9\u70B9\u540D\u79F0"}),(0,e.jsx)(h.Z,{name:"siteName",label:"\u7AD9\u70B9\u6807\u8BC6",tooltip:"\u7AD9\u70B9\u552F\u4E00\u6807\u8BC6\uFF0C\u7528\u4E8E\u6807\u8BC6\u7AD9\u70B9\u548C\u5185\u90E8\u8BBF\u95EE",required:!0,disabled:F==we,rules:[{required:!0}],placeholder:"\u8BF7\u8F93\u5165\u7AD9\u70B9\u540D\u79F0"}),(0,e.jsx)(je,{redeploy:F!=Me,fromImageId:Ae})]}),(0,e.jsx)(Pe.Z,{offsetTop:50,children:(0,e.jsx)(I.Z,{style:{marginBottom:-20},children:(0,e.jsx)(P.Z,{activeKey:L,onChange:function(N){Ze(N),window.scrollTo(0,450)},items:[{label:"\u57FA\u672C\u914D\u7F6E",key:"basic"},{label:"\u5173\u8054\u914D\u7F6E",key:"link"},{label:"\u5B58\u50A8\u914D\u7F6E",key:"storage"},{label:"\u8FD0\u884C\u914D\u7F6E",key:"run-command"},{label:"\u8D44\u6E90\u914D\u7F6E",key:"resource"},{label:"Hook",key:"hook"},{label:"\u5176\u5B83",key:"other"}]})})}),(0,e.jsxs)(De,{show:L=="basic",children:[(0,e.jsx)(fu,{ref:i,showBindHost:!0,showBindIpV6:!0}),(0,e.jsx)(qe.Z,{showAddButton:!0,showImportButton:!0,showCodeMode:!0,label:"\u73AF\u5883\u53D8\u91CF",ref:p}),(0,e.jsx)(k.Z,{name:["siteName","useHostNetwork"],children:function(N){var a=N.siteName,t=N.useHostNetwork;if(!t)return(0,e.jsx)(pu,{})}})]}),(0,e.jsx)(De,{show:L=="link",children:(0,e.jsx)(k.Z,{name:["siteName","useHostNetwork"],children:function(N){var a=N.siteName,t=N.useHostNetwork;return t?(0,e.jsx)(ae.Z,{showIcon:!0,description:"\u7ED1\u5B9A\u5230\u5BBF\u4E3B\u673A\u7F51\u7EDC\u65F6\uFF0C\u65E0\u6CD5\u901A\u8FC7 Docker \u5173\u8054\u5176\u5B83\u5BB9\u5668\u3002\u8BF7\u4F7F\u7528\u5BBF\u4E3B\u673A\u5185\u7F51IP\u6216\u662F127.0.0.1\u4E92\u8054\u5BB9\u5668\u66B4\u9732\u7AEF\u53E3\u3002"}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Xe,{onAddEnv:function(ne,w){var Fe;(Fe=p.current)===null||Fe===void 0||Fe.addEnvItem(ne,w)},ref:o}),(0,e.jsx)(mu.Z,{siteName:a}),(0,e.jsx)(hu,{})]})}})}),(0,e.jsx)(De,{show:L=="storage",children:(0,e.jsx)(uu,{showDefault:!0,ref:l})}),(0,e.jsx)(De,{show:L=="run-command",children:(0,e.jsx)(du,{})}),(0,e.jsx)(De,{show:L=="resource",children:(0,e.jsx)(lu,{})}),(0,e.jsx)(De,{show:L=="hook",children:(0,e.jsx)(Cu,{})}),(0,e.jsx)(De,{show:L=="other",children:(0,e.jsx)(ou,{})})]},"form")})})}}}]);
