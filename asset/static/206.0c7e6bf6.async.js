"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[206],{99922:function(xe,ue,e){var de=e(97857),J=e.n(de),ne=e(15009),t=e.n(ne),_e=e(99289),p=e.n(_e),te=e(5574),K=e.n(te),l=e(67294),U=e(85265),ae=e(42075),ge=e(83622),F=e(49610),X=e(3616),N=e(29463),oe=e(90581),be=e(5251),ce=e(36146),je=e(95591),$=e(85893),ye=new ce.Uo("components.console"),pe=(0,l.forwardRef)(function(Re,ve){var y,le,W,Ce=(0,l.useRef)(),k=(0,l.useRef)(),V=(0,l.useState)(!1),Q=K()(V,2),R=Q[0],re=Q[1],L=(0,l.useState)(),I=K()(L,2),m=I[0],we=I[1];return(0,l.useImperativeHandle)(ve,function(){return{show:function(z){return p()(t()().mark(function Ee(){var Oe;return t()().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:we(z),re(!0),(Oe=Ce.current)===null||Oe===void 0||Oe.resetFields();case 3:case"end":return Te.stop()}},Ee)}))()}}}),(0,l.useEffect)(function(){return setTimeout(function(){var S;m&&((S=k.current)===null||S===void 0||S.start(m.url,{cmd:m&&m.cmd,workDir:m&&m.workDir}))},1e3),function(){var S;(S=k.current)===null||S===void 0||S.close()}},[m,R]),(0,$.jsxs)(U.Z,{forceRender:!0,width:X.FK,open:R,onClose:function(){return[re(!1)]},title:ye.format("drawerTitle",{name:(0,be.fi)((y=m==null?void 0:m.title)!==null&&y!==void 0?y:"","/")}),children:[(0,$.jsxs)(ae.Z,{style:{marginBottom:20},children:[Re.showFileExplorer&&(0,$.jsx)(N.Z,{trigger:(0,$.jsx)(ge.ZP,{icon:(0,$.jsx)(je.Z,{}),type:"primary",children:ce.FD.format("listManageFilePath")}),type:"container",title:(0,be.fi)((le=m==null?void 0:m.title)!==null&&le!==void 0?le:"","/"),name:m&&m.url&&(W=m.url.split("/").pop())!==null&&W!==void 0?W:""}),(0,$.jsx)(oe.Z,{onChangeShell:function(z){var Ee;if(!m)return!1;(Ee=k.current)===null||Ee===void 0||Ee.close(),we(J()(J()({},m),{cmd:z!=null?z:m==null?void 0:m.cmd}))},onOpenNewWindow:function(z){return m?(z.workDir=m&&m.workDir?m.workDir:"","".concat(m.url,"?").concat(Object.keys(z).map(function(Ee){return"".concat(Ee,"=").concat(encodeURIComponent(z[Ee]))}).join("&"))):""},onOpenNewWindowFinish:function(){var z;(z=k.current)===null||z===void 0||z.close(),re(!1)},onBatchCommandFinish:function(z){k.current&&k.current.run(z)}})]}),R&&(0,$.jsx)(F.Z,{height:"80vh",ref:k})]})});ue.Z=pe},29463:function(xe,ue,e){e.d(ue,{Z:function(){return mn}});var de=e(97857),J=e.n(de),ne=e(15009),t=e.n(ne),_e=e(99289),p=e.n(_e),te=e(5574),K=e.n(te),l=e(67294),U=e(82346);function ae(r,i){return ge.apply(this,arguments)}function ge(){return ge=p()(t()().mark(function r(i,s){var P;return t()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return P="/api/".concat(i,"/explorer/get-path-list"),Z.next=3,(0,U.request)(P,{data:s,method:"POST"});case 3:return Z.abrupt("return",Z.sent);case 4:case"end":return Z.stop()}},r)})),ge.apply(this,arguments)}function F(r,i){return X.apply(this,arguments)}function X(){return X=p()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,U.request)("/api/".concat(i,"/explorer/export"),{data:s,method:"POST",responseType:"blob"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),X.apply(this,arguments)}function N(r,i){return oe.apply(this,arguments)}function oe(){return oe=p()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,U.request)("/api/".concat(i,"/explorer/import"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),oe.apply(this,arguments)}function be(r,i){return ce.apply(this,arguments)}function ce(){return ce=p()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,U.request)("/api/".concat(i,"/explorer/delete"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),ce.apply(this,arguments)}function je(r,i){return $.apply(this,arguments)}function $(){return $=p()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,U.request)("/api/".concat(i,"/explorer/unzip"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),$.apply(this,arguments)}function ye(r,i){return pe.apply(this,arguments)}function pe(){return pe=p()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,U.request)("/api/".concat(i,"/explorer/get-content"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),pe.apply(this,arguments)}function Re(r,i){return ve.apply(this,arguments)}function ve(){return ve=p()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,U.request)("/api/".concat(i,"/explorer/import-file-content"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),ve.apply(this,arguments)}function y(r,i){return le.apply(this,arguments)}function le(){return le=p()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,U.request)("/api/".concat(i,"/explorer/mkdir"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),le.apply(this,arguments)}function W(r,i){return Ce.apply(this,arguments)}function Ce(){return Ce=p()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,U.request)("/api/".concat(i,"/explorer/chmod"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),Ce.apply(this,arguments)}function k(r,i){return V.apply(this,arguments)}function V(){return V=p()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,U.request)("/api/".concat(i,"/explorer/get-user-list"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),V.apply(this,arguments)}function Q(r,i){return R.apply(this,arguments)}function R(){return R=p()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,U.request)("/api/".concat(i,"/explorer/get-file-stat"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),R.apply(this,arguments)}function re(r,i){return L.apply(this,arguments)}function L(){return L=p()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,U.request)("/api/".concat(i,"/explorer/attach-volume"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),L.apply(this,arguments)}function I(r){return m.apply(this,arguments)}function m(){return m=p()(t()().mark(function r(i){return t()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(0,U.request)("/api/".concat(i,"/explorer/destroy-proxy-container"),{data:{},method:"POST"});case 2:return P.abrupt("return",P.sent);case 3:case"end":return P.stop()}},r)})),m.apply(this,arguments)}var we=e(31112),S=e(81366),z=e(86615),Ee=e(97462),Oe=e(5966),Le=e(62370),Te=e(11106),Ue=e(24963),We=e(5251),Me=e(36146),Ze=e(27166),a=e(85893),me=new Me.Uo("components.explorer"),Ke=(0,l.forwardRef)(function(r,i){var s,P,n=(0,l.useContext)(Ue.Z),Z=n.notice,x=(0,l.useContext)(we.Z),T=x.currentPath,Y=x.refresh,B=x.name,M=x.apiPrefix,d=(0,l.useRef)(),se=(0,l.useState)(!1),q=K()(se,2),C=q[0],f=q[1],u=(0,l.useRef)();return(0,l.useImperativeHandle)(i,function(){return{newFile:function(){var _;f(!0),(_=d.current)===null||_===void 0||_.setFieldValue("type","newFile")},editFile:function(_,w,fe){return p()(t()().mark(function c(){var he,D,v,o,O;return t()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return f(!0),(he=u.current)===null||he===void 0||he.loading(),j.prev=2,j.next=5,ye(M,{name:B,file:w}).finally(function(){var ee;(ee=u.current)===null||ee===void 0||ee.finish()});case 5:if(O=j.sent,!(O.data.content==""&&fe!="0")){j.next=10;break}return Z.error(me.format("editFileMessageNotSupport")),f(!1),j.abrupt("return");case 10:(D=d.current)===null||D===void 0||D.setFieldValue("newValue",O.data.content),(v=d.current)===null||v===void 0||v.setFieldValue("newName",_),(o=d.current)===null||o===void 0||o.setFieldValue("type","editFile"),j.next=18;break;case 15:j.prev=15,j.t0=j.catch(2),f(!1);case 18:return j.abrupt("return");case 19:case"end":return j.stop()}},c,null,[[2,15]])}))()}}}),(0,a.jsxs)(Ze.Z,{drawerProps:{mask:!1,width:"50vw",forceRender:!0},onFinish:function(){var h=p()(t()().mark(function _(w){return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(w.type!="newDir"){c.next=13;break}return c.prev=1,c.next=4,y(M,{name:B,destPath:"".concat(T,"/").concat((0,We.fi)(w.newPath,"/"))});case 4:return Y(),f(!1),c.abrupt("return",!0);case 9:c.prev=9,c.t0=c.catch(1);case 11:c.next=23;break;case 13:return c.prev=13,c.next=16,Re(M,{destPath:T,file:w.newName,content:w.newValue,name:B});case 16:return Y(),f(!1),c.abrupt("return",!0);case 21:c.prev=21,c.t1=c.catch(13);case 23:return c.abrupt("return",!1);case 24:case"end":return c.stop()}},_,null,[[1,9],[13,21]])}));return function(_){return h.apply(this,arguments)}}(),ref:u,title:me.format("editFileTypeEditFile"),open:C,onOpenChange:function(_){if(f(_),!_){var w;(w=d.current)===null||w===void 0||w.resetFields(),r.onFinish&&r.onFinish()}},formRef:d,children:[(0,a.jsx)(z.Z.Group,{name:"type",options:[{label:me.format("editFileTypeEditFile"),value:"editFile",disabled:((s=d.current)===null||s===void 0?void 0:s.getFieldValue("type"))!="editFile"},{label:me.format("editFileTypeNewFile"),value:"newFile"},{label:me.format("editFileTypeNewDir"),value:"newDir"}],disabled:((P=d.current)===null||P===void 0?void 0:P.getFieldValue("type"))=="editFile"}),(0,a.jsx)(Ee.Z,{name:["type"],children:function(_){var w=_.type;return w!="newDir"?[(0,a.jsx)(Oe.Z,{label:me.format("editFileNewName"),tooltip:me.format("editFileNewNameTip"),name:"newName",fieldProps:{addonBefore:"".concat(T,"/")},placeholder:me.format("editFileNewNameEmpty"),disabled:w=="editFile"},"fileName"),(0,a.jsx)(Le.Z,{label:me.format("editFileNewValue"),name:"newValue",children:(0,a.jsx)(Te.ZP,{theme:"dark",height:"58vh",onChange:function(c){var he;(he=d.current)===null||he===void 0||he.setFieldValue("newValue",c)}})},"fileContent")]:(0,a.jsx)(Oe.Z,{name:"newPath",label:me.format("editFileNewPath"),placeholder:me.format("editFileNewPathEmpty")})}})]})}),Ne=Ke,Ie=e(68536),Be=e(83622),$e=e(83062),ke=e(66309),De=e(59683),Ve=e(51042),ze=e(86548),Ge=e(12119),He=e(23430),Je=e(58638),Qe=e(27461),Ye=e(82061),Xe=e(93162),qe=e(88484),Se=e(37476),en=e(91604),Ae=e(3616),nn=e(4813);function rn(){var r=(0,l.useRef)(),i=(0,l.useContext)(we.Z),s=i.refresh,P=i.name,n=i.apiPrefix,Z=i.currentPath,x=new Me.Uo("components.explorer");return(0,a.jsx)(Se.Y,{modalProps:{width:Ae.ob},formRef:r,trigger:(0,a.jsx)(Be.ZP,{icon:(0,a.jsx)(qe.Z,{}),children:x.format("toolbarUploadButton")}),title:x.format("toolbarUploadModalTitle"),onFinish:function(){var T=p()(t()().mark(function Y(B){var M,d;return t()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return d=[],B.importFileList&&B.importFileList.map(function(C){d.push({name:C.name,path:C.response.data.path})}),N(n,{fileList:d,name:P,destPath:Z}),(M=r.current)===null||M===void 0||M.resetFields(),s(),q.abrupt("return",!0);case 6:case"end":return q.stop()}},Y)}));return function(Y){return T.apply(this,arguments)}}(),children:(0,a.jsx)(en.Z,{name:"importFileList",fieldProps:{multiple:!0,name:"file",action:"/api/common/attach/upload",headers:{Authorization:"Bearer "+localStorage.getItem("token")},onRemove:function(Y){return new Promise(function(B){var M;(0,nn._)({path:(M=Y.response.data.path)!==null&&M!==void 0?M:""}).then(function(d){B(!0)})})}}})})}var Fe=e(38345),Pe=e(63434),tn=e(42075),an=(0,l.forwardRef)(function(r,i){var s=(0,l.useRef)(),P=(0,l.useContext)(we.Z),n=P.refresh,Z=P.name,x=P.apiPrefix,T=(0,l.useState)(!1),Y=K()(T,2),B=Y[0],M=Y[1],d=new Me.Uo("components.explorer");(0,l.useImperativeHandle)(i,function(){return{show:function(f){var u;M(!0),f.length==1&&q(se(f[0].modStr)),(u=s.current)===null||u===void 0||u.setFieldValue("fileList",f.map(function(h){return h.path}))}}});function se(C){var f=C.split(""),u=0,h=0,_=0;return f[1]=="r"&&(u+=4),f[2]=="w"&&(u+=2),f[3]=="x"&&(u+=1),f[4]=="r"&&(h+=4),f[5]=="w"&&(h+=2),f[6]=="x"&&(h+=1),f[7]=="r"&&(_+=4),f[8]=="w"&&(_+=2),f[9]=="x"&&(_+=1),"".concat(u).concat(h).concat(_)}function q(C){var f;if((f=s.current)===null||f===void 0||f.setFieldValue("permission",C),C.length>=1){var u;(u=s.current)===null||u===void 0||u.setFieldsValue({ownerRead:Number(C[0])&4,ownerWrite:Number(C[0])&2,ownerExec:Number(C[0])&1})}if(C.length>=2){var h;(h=s.current)===null||h===void 0||h.setFieldsValue({groupRead:Number(C[1])&4,groupWrite:Number(C[1])&2,groupExec:Number(C[1])&1})}if(C.length>=3){var _;(_=s.current)===null||_===void 0||_.setFieldsValue({everyoneRead:Number(C[2])&4,everyoneWrite:Number(C[2])&2,everyoneExec:Number(C[2])&1})}}return(0,a.jsxs)(Se.Y,{modalProps:{forceRender:!0,width:Ae.ob},title:d.format("toolbarPermissionModalTitle"),layout:"horizontal",open:B,onOpenChange:function(f){if(M(f),!f){var u;(u=s.current)===null||u===void 0||u.resetFields()}},formRef:s,onValuesChange:function(f,u){if(f.permission)q(f.permission);else{var h=["-",u.ownerRead?"r":"-",u.ownerWrite?"w":"-",u.ownerExec?"x":"-",u.groupRead?"r":"-",u.groupWrite?"w":"-",u.groupExec?"x":"-",u.everyoneRead?"r":"-",u.everyoneWrite?"w":"-",u.everyoneExec?"x":"-"];q(se(h.join("")))}},onFinish:function(){var C=p()(t()().mark(function f(u){var h,_,w;return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,W(x,{name:Z,fileList:u.fileList,mod:(h=u.permission)!==null&&h!==void 0?h:"600",hasChildren:(_=u.hasChildren)!==null&&_!==void 0?_:!0,user:u.user});case 2:return w=c.sent,n(),c.abrupt("return",!0);case 5:case"end":return c.stop()}},f)}));return function(f){return C.apply(this,arguments)}}(),children:[(0,a.jsxs)(Fe.Z,{ghost:!0,split:"vertical",bordered:!0,children:[(0,a.jsx)(Le.Z,{name:"fileList",hidden:!0}),(0,a.jsxs)(Fe.Z,{title:d.format("toolbarPermissionOwner"),headerBordered:!0,children:[(0,a.jsx)(Pe.Z,{label:d.format("toolbarPermissionRead"),name:"ownerRead"}),(0,a.jsx)(Pe.Z,{label:d.format("toolbarPermissionWrite"),name:"ownerWrite"}),(0,a.jsx)(Pe.Z,{label:d.format("toolbarPermissionExec"),name:"ownerExec"})]}),(0,a.jsxs)(Fe.Z,{title:d.format("toolbarPermissionGroup"),headerBordered:!0,children:[(0,a.jsx)(Pe.Z,{label:d.format("toolbarPermissionRead"),name:"groupRead"}),(0,a.jsx)(Pe.Z,{label:d.format("toolbarPermissionWrite"),name:"groupWrite"}),(0,a.jsx)(Pe.Z,{label:d.format("toolbarPermissionExec"),name:"groupExec"})]}),(0,a.jsxs)(Fe.Z,{title:d.format("toolbarPermissionEveryone"),headerBordered:!0,children:[(0,a.jsx)(Pe.Z,{label:d.format("toolbarPermissionRead"),name:"everyoneRead"}),(0,a.jsx)(Pe.Z,{label:d.format("toolbarPermissionWrite"),name:"everyoneWrite"}),(0,a.jsx)(Pe.Z,{label:d.format("toolbarPermissionExec"),name:"everyoneExec"})]})]}),(0,a.jsxs)(Fe.Z,{bordered:!0,style:{marginTop:10},children:[(0,a.jsx)(Oe.Z,{label:d.format("toolbarPermissionButton"),name:"permission",fieldProps:{maxLength:3},labelCol:{span:2}}),(0,a.jsxs)(tn.Z.Compact,{children:[(0,a.jsx)(Oe.Z,{width:"sm",placeholder:d.format("toolbarPermissionOwnerEmpty"),label:d.format("toolbarPermissionOwner"),name:"user",fieldProps:{addonAfter:":"}}),(0,a.jsx)(Oe.Z,{width:"sm",placeholder:d.format("toolbarPermissionGroupEmpty"),name:"group"})]}),(0,a.jsx)(Pe.Z,{label:d.format("toolbarPermissionHasChildren"),name:"hasChildren",initialValue:!0})]})]})}),on=an,fn=null,G=new Me.Uo("components.explorer"),sn=(0,l.forwardRef)(function(r,i){(0,l.useImperativeHandle)(i,function(){return{close:function(){se([]),fe("")}}});var s=r.type=="host"?"common":"app",P=(0,l.useContext)(Ue.Z),n=P.message,Z=(0,l.useRef)(),x=(0,l.useRef)(),T=(0,l.useRef)(),Y=(0,l.useRef)(),B=(0,U.useSearchParams)(),M=K()(B,2),d=M[0],se=M[1],q=(0,l.useState)(),C=K()(q,2),f=C[0],u=C[1],h=(0,l.useState)(""),_=K()(h,2),w=_[0],fe=_[1];(0,l.useEffect)(function(){var D;n.info(G.format("commonMessageCreateExplorerPlugin")),fe((D=r.workDir)!==null&&D!==void 0?D:"")},[]);function c(D,v){return he.apply(this,arguments)}function he(){return he=p()(t()().mark(function D(v,o){var O,A,j;return t()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:(O=Z.current)===null||O===void 0||O.addHistory(v,o),fe(o),!((A=T.current)===null||A===void 0)&&A.reloadAndRest&&((j=T.current)===null||j===void 0||j.reloadAndRest()),o=="/"?se([]):(d.set("path",o),se(d));case 4:case"end":return b.stop()}},D)})),he.apply(this,arguments)}return r&&(0,a.jsxs)(we.Z.Provider,{value:{name:r.name,apiPrefix:s,currentPath:w,showPath:c,redirectPath:function(v){var o;if(fe(v),T.current&&(o=T.current)!==null&&o!==void 0&&o.reloadAndRest){var O;(O=T.current)===null||O===void 0||O.reloadAndRest()}v=="/"?se([]):(d.set("path",v),se(d))},refresh:function(){var v;if(T&&typeof((v=T.current)===null||v===void 0?void 0:v.reloadAndRest)=="function"){var o;(o=T.current)===null||o===void 0||o.reloadAndRest()}}},children:[(0,a.jsx)(De.C,{sticky:!1,quickToolbarAffix:{offsetTop:10,target:function(){return document.querySelector(".file-explorer .ant-drawer-body")}},quickToolbarRender:function(v){var o=v.selectedRows,O=o.map(function(A){return A.path});return[r.onConsole&&(0,a.jsx)(Be.ZP,{onClick:function(){r.onConsole&&r.onConsole(w)},children:"Console"},"fileConsole"),(0,a.jsx)(rn,{},"upload"),(0,a.jsx)(Be.ZP,{icon:(0,a.jsx)(Ve.Z,{}),onClick:function(){x.current&&x.current.newFile()},type:"primary",children:G.format("toolbarNewButton")},"newfile")]},contextMenu:function(v){var o=v.selectedRow,O=v.selectedRows,A=v.isMultiple,j=v.loading,ee=v.finish;return{items:[{key:"edit",label:(0,a.jsx)(De.C.ContextMenuItem,{buttonProps:{icon:(0,a.jsx)(ze.Z,{}),disabled:A()||o&&o.isDir||O.length==0},action:p()(t()().mark(function b(){var E,g;return t()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,Q(s,{name:r.name,path:o.path});case 2:E=ie.sent,E.data.info.isDir?c(o.name,E.data.info.target):(g=x.current)===null||g===void 0||g.editFile(E.data.info.name,E.data.info.target,o.size);case 4:case"end":return ie.stop()}},b)})),children:Me.FD.format("listManageEdit")})},{key:"permission",label:(0,a.jsx)(De.C.ContextMenuItem,{buttonProps:{icon:(0,a.jsx)(Ge.Z,{}),disabled:O.length==0},action:p()(t()().mark(function b(){var E;return t()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:(E=Y.current)===null||E===void 0||E.show(O);case 1:case"end":return H.stop()}},b)})),children:G.format("toolbarPermissionButton")})},{key:"download",label:(0,a.jsx)(De.C.ContextMenuItem,{buttonProps:{icon:(0,a.jsx)(He.Z,{}),disabled:O.length==0},action:p()(t()().mark(function b(){return t()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",F(s,{name:r.name,fileList:O.map(function(H){return H.path})}));case 1:case"end":return g.stop()}},b)})),onSuccess:function(E){var g=new Blob([E],{type:"application/zip"});(0,Xe.saveAs)(g,"export.zip")},children:G.format("toolbarDownloadButton")})},(r.type=="container"||r.type=="volume")&&{key:"export",label:(0,a.jsx)(De.C.ContextMenuItem,{buttonProps:{icon:(0,a.jsx)(Je.Z,{}),disabled:O.length==0},action:p()(t()().mark(function b(){return t()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return j(),g.abrupt("return",F(s,{name:r.name,fileList:O.map(function(H){return H.path}),enableExportToPath:!0}).finally(function(){ee(!0)}));case 2:case"end":return g.stop()}},b)})),onSuccess:function(){},children:G.format("toolbarExportButton")})},{key:"unzip",label:(0,a.jsx)(De.C.ContextMenuItem,{buttonProps:{icon:(0,a.jsx)(Qe.Z,{}),disabled:O.length==0},action:p()(t()().mark(function b(){return t()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return j(),g.abrupt("return",je(s,{name:r.name,file:O.map(function(H){return H.path}),path:w}).finally(function(){ee(!0)}));case 2:case"end":return g.stop()}},b)})),children:G.format("toolbarUnzipButton")})},{type:"divider"},{key:"delete",label:(0,a.jsx)(De.C.ContextMenuItem,{buttonProps:{danger:!0,icon:(0,a.jsx)(Ye.Z,{})},confirmProps:{showCommonConfirm:!0},action:p()(t()().mark(function b(){return t()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return j(),g.abrupt("return",be(s,{name:r.name,fileList:O.map(function(H){return H.path})}).finally(function(){ee(!0)}));case 2:case"end":return g.stop()}},b)})),children:G.format("toolbarDeleteButton")},"deleteBatch")}]}},headerTitle:(0,a.jsx)(S.Z,{ref:Z}),actionRef:T,search:!1,rowKey:"name",pagination:{pageSize:500,position:["topRight","bottomRight"]},request:p()(t()().mark(function D(){var v,o,O,A,j;return t()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,ae(s,{name:r.name,path:w});case 2:if(o=b.sent,w==""&&o.data.currentPath!=""&&fe(o.data.currentPath),O=[],(v=Z.current)===null||v===void 0||v.initHistory(o.data.currentPath.split("/").filter(function(E){return E!=""}).map(function(E){return O.push(E),{title:E,path:"/".concat(O.join("/"))}}),o.data.rootDirs),A=f,A){b.next=13;break}return b.next=10,k(s,{name:r.name});case 10:j=b.sent,u(j.data),A=j.data;case 13:return b.abrupt("return",{data:o.data.list.map(function(E){if(A){var g,H;E.group=(g=(H=A.group.find(function(ie){return ie.gid==E.group}))===null||H===void 0?void 0:H.name)!==null&&g!==void 0?g:E.group}return E}),success:!0,total:o.data.list.length});case 14:case"end":return b.stop()}},D)})),columns:[{title:G.format("listName"),dataIndex:"name",key:"name",render:function(ee,o,O,A,j){var ee;return o.isDir?ee=(0,a.jsx)(Ie.Z,{isDir:!0,onClick:function(){return c(o.name,o.path)},showName:o.name}):o.isSymlink?ee=(0,a.jsx)(Ie.Z,{isLink:!0,showName:"".concat(o.name," -> ").concat(o.linkName),onClick:p()(t()().mark(function b(){var E,g;return t()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,Q(s,{name:r.name,path:o.path});case 2:E=ie.sent,E.data.info.isDir?c(o.name,E.data.info.target):(g=x.current)===null||g===void 0||g.editFile(E.data.info.name,E.data.info.target,o.size);case 4:case"end":return ie.stop()}},b)}))}):ee=(0,a.jsx)(Ie.Z,{showName:o.name,onClick:function(){var E;(E=x.current)===null||E===void 0||E.editFile(o.name,o.path,o.size)}}),ee}},{title:G.format("listStatus"),key:"status",width:110,render:function(v,o,O,A,j){return o.change>-1&&(0,a.jsx)($e.Z,{title:G.format("listStatusTipOption.".concat(o.change)),children:(0,a.jsx)(ke.Z,{color:G.format("listStatusColorOption.".concat(o.change)),children:G.format("listStatusOption.".concat(o.change))})})}},{title:G.format("listModStr"),dataIndex:"modStr",key:"mod"},{title:G.format("listUser"),dataIndex:"user"},{title:G.format("listGroup"),dataIndex:"group"},{title:G.format("listSize"),dataIndex:"size",key:"size",render:function(v,o,O,A,j){return(0,We.FI)(o.size)}},{title:G.format("listModTime"),dataIndex:"modTime",key:"modTime",sorter:function(v,o){return new Date(v.modTime).getTime()-new Date(o.modTime).getTime()},render:function(v,o,O,A,j){return(0,We.NF)(o.modTime)}}],cardProps:{ghost:!0}},"explorer-list"),(0,a.jsx)(Ne,{onFinish:function(){var v;!((v=T.current)===null||v===void 0)&&v.reset&&T.current.reset()},ref:x}),(0,a.jsx)(on,{ref:Y},"chmod")]})}),ln=sn,un=e(85265),dn=e(99922),cn=(0,l.forwardRef)(function(r,i){var s,P=(0,l.useState)(!1),n=K()(P,2),Z=n[0],x=n[1],T=(0,l.useState)(),Y=K()(T,2),B=Y[0],M=Y[1],d=(0,l.useRef)(),se=new Me.Uo("components.explorer"),q=(0,l.useContext)(Ue.Z),C=q.loading,f=(0,l.useRef)();return(0,l.useImperativeHandle)(i,function(){return{showContainer:function(h,_){M({name:(0,We.fi)(h,"/"),type:"container",workDir:_!=null?_:void 0}),x(!0)},showHost:function(h){M({name:h,type:"host"}),x(!0)},showVolume:function(h){return p()(t()().mark(function _(){var w;return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return C.show(),c.next=3,re("app",{name:h}).finally(function(){C.destroy()});case 3:w=c.sent,M({name:w.data.containerName,type:"container",workDir:w.data.path}),x(!0);case 6:case"end":return c.stop()}},_)}))()}}}),(0,a.jsxs)(a.Fragment,{children:[r.trigger?l.cloneElement(r.trigger,{onClick:function(){r.name&&r.type&&(M(r),x(!0))}}):null,(0,a.jsxs)(un.Z,{destroyOnHidden:!0,width:Ae.R_,title:se.format("drawerTitle",{name:(s=r.title)!==null&&s!==void 0?s:B==null?void 0:B.name}),onClose:p()(t()().mark(function u(){var h;return t()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(C.show(),x(!1),(h=d.current)===null||h===void 0||h.close(),M(void 0),!r.onCloseDestroy){w.next=7;break}return w.next=7,I("app");case 7:C.destroy();case 8:case"end":return w.stop()}},u)})),rootClassName:"file-explorer",open:Z,children:[r.showConsole&&(0,a.jsx)(dn.Z,{showFileExplorer:!1,ref:f}),Z&&B&&(0,a.jsx)(ln,J()(J()({ref:d},B),{},{onConsole:r.showConsole?function(u){var h;(h=f.current)===null||h===void 0||h.show({url:"/console/container/".concat(B.name),title:B.name,workDir:u})}:void 0}))]})]})}),mn=cn},90581:function(xe,ue,e){e.d(ue,{Z:function(){return le}});var de=e(15009),J=e.n(de),ne=e(99289),t=e.n(ne),_e=e(5574),p=e.n(_e),te=e(3616),K=e(97269),l=e(38345),U=e(64317),ae=e(37476),ge=e(62370),F=e(97462),X=e(11106),N=e(42075),oe=e(83622),be=e(83062),ce=e(67294),je=e(1883),$=e(33160),ye=e(58638),pe=e(82346),Re=e(75520),ve=e(36146),y=e(85893);function le(W){var Ce=(0,ce.useState)(!1),k=p()(Ce,2),V=k[0],Q=k[1],R=(0,ce.useRef)(),re=new ve.Uo("components.console");return(0,y.jsx)(K.A,{layout:"inline",submitter:!1,children:(0,y.jsx)(l.Z,{ghost:!0,children:(0,y.jsxs)(N.Z,{children:[(0,y.jsx)(U.Z,{width:"sm",name:"entryCmd",placeholder:re.format("toolbarEntryCmdEmpty"),valueEnum:{"/bin/sh":"/bin/sh","/bin/bash":"/bin/bash"},onChange:function(I){W.onChangeShell&&W.onChangeShell(I)}}),(0,y.jsx)(ae.Y,{modalProps:{width:te.ob,height:te.Ed},title:re.format("toolbarBatchCommandTitle"),name:"batchCommand",open:V,trigger:(0,y.jsx)(oe.ZP,{icon:(0,y.jsx)(je.Z,{}),children:re.format("toolbarBatchCommandTitle")}),formKey:"batchCommand",formRef:R,isKeyPressSubmit:!0,onFinish:function(){var L=t()(J()().mark(function I(m){return J()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:W.onBatchCommandFinish&&W.onBatchCommandFinish(m.shell.split(`
`)),Q(!1);case 2:case"end":return S.stop()}},I)}));return function(I){return L.apply(this,arguments)}}(),onOpenChange:function(I){Q(I),I&&R.current&&R.current.resetFields()},children:(0,y.jsx)(ge.Z,{name:"shell",children:(0,y.jsx)(X.ZP,{theme:"dark",height:te.Ed})})}),(0,y.jsx)(oe.ZP,{onClick:function(){W.onChangeShell&&W.onChangeShell()},icon:(0,y.jsx)($.Z,{}),type:"primary",children:ve.FD.format("listManageRefresh")}),(0,y.jsx)(F.Z,{name:["entryCmd"],children:function(I){var m=I.entryCmd;return(!m||m=="")&&(m="/bin/sh"),W.onOpenNewWindow&&(0,y.jsx)(pe.Link,{onClick:function(){W.onOpenNewWindowFinish&&W.onOpenNewWindowFinish()},target:"_blank",to:W.onOpenNewWindow({cmd:m}),children:(0,y.jsx)(be.Z,{title:re.format("toolbarOpenInNewWindowTip"),children:(0,y.jsx)(oe.ZP,{type:"dashed",icon:(0,y.jsx)(ye.Z,{})})})})}}),(0,y.jsx)(Re.Z,{buttonProps:{shape:"default",size:"middle"}})]})})})}},49610:function(xe,ue,e){var de=e(5574),J=e.n(de),ne=e(67294),t=e(52626),_e=e(78267),p=e.n(_e),te=e(12323),K=e(87662),l=e(4244),U=e.n(l),ae=e(24078),ge=e(85893),F,X,N,oe,be=(0,ne.forwardRef)(function(ce,je){var $,ye=(0,ne.useState)(),pe=J()(ye,2),Re=pe[0],ve=pe[1],y=(0,ne.useState)(""),le=J()(y,2),W=le[0],Ce=le[1];(0,ne.useImperativeHandle)(je,function(){return{start:function(Q,R){k(),X.fit(),R.width=F.cols,R.height=F.rows;var re=R?Object.keys(R).filter(function(L){return R&&R[L]}).map(function(L){if(R&&R[L])return"".concat(L,"=").concat(R[L])}):[];N=new WebSocket((0,t.R)(Q+"?"+re.join("&"))),N.addEventListener("message",function(L){var I=JSON.parse(L.data),m=I.type;if(m==Q&&(F.write(I.data),I.data.indexOf("exec failed")!=-1)){k();return}}),oe=F.onData(function(L){var I={content:{command:L},type:Q};N&&N.send(JSON.stringify(I))}),Ce(Q),ve(R)},close:function(){k()},fit:function(){return X.fit(),{width:F.cols,height:F.rows}},run:function(Q){Re&&Q&&Q.forEach(function(R){var re={content:{command:R+`
`},type:W};N&&N.send(JSON.stringify(re))})}}}),(0,ne.useEffect)(function(){return F=new l.Terminal(te.X),X=new _e.FitAddon,F.loadAddon(X),F.open(document.getElementById("terminal-container-console")),X.fit(),(0,K.pe)({groupName:"setting",name:"themeConsoleConfig"}).then(function(V){V.data&&V.data.fontSize&&Object.assign(F.options,V.data)}),function(){k()}},[]),(0,ne.useEffect)(function(){window.addEventListener("resize",function(){X.fit();var V={size:{width:F.cols,height:F.rows},type:W};W&&N&&N.send(JSON.stringify(V))})},[W]);function k(){oe&&(F.reset(),X.fit(),F.focus(),oe.dispose()),N&&(N.close(),N=null)}return(0,ge.jsx)("div",{style:{height:($=ce.height)!==null&&$!==void 0?$:"100vh"},id:"terminal-container-console"})});ue.Z=be},12323:function(xe,ue,e){e.d(ue,{X:function(){return de},n:function(){return J}});var de={convertEol:!0,fontFamily:'Menlo, Monaco, "Courier New", monospace',fontWeight:400,fontSize:16,lineHeight:1,cursorStyle:"block",cursorInactiveStyle:"outline",cursorBlink:!0,letterSpacing:0,theme:{foreground:"#bfbfbf",cursor:"gray",selectionForeground:"#ffffff"}},J=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"]},4813:function(xe,ue,e){e.d(ue,{_:function(){return p}});var de=e(15009),J=e.n(de),ne=e(99289),t=e.n(ne),_e=e(82346);function p(K){return te.apply(this,arguments)}function te(){return te=t()(J()().mark(function K(l){return J()().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return ae.next=2,(0,_e.request)("/api/common/attach/delete",{method:"POST",data:l});case 2:return ae.abrupt("return",ae.sent);case 3:case"end":return ae.stop()}},K)})),te.apply(this,arguments)}}}]);
