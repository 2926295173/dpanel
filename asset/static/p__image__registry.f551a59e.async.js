"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9013],{1699:function(X,T,e){e.d(T,{u:function(){return $}});var U=e(9783),i=e.n(U),p=e(97857),m=e.n(p),I=e(67294),W=e(82346),K=e(40411),O=e(42075),C=e(85893),$=function(c){var b=(0,W.useAccess)(),n=Array.isArray(c.access)?c.access:[c.access],_,g=c.fallback;if(typeof c.children=="function"?(_=c.children(n.reduce(function(a,D){return m()(m()({},a),{},i()({},D,b[D]))},{})),_||(_=g)):n.every(function(a){return b[a]})?_=c.children:_=g,!g&&_&&c.showProTips&&b.canSeeEnableCe){if(b.canSeeEnableHiddenProTips)return null;_=(0,C.jsx)(K.Z,{offset:c.showProTipsOffset,count:"PRO",color:"gold",style:{fontWeight:"bold"},children:_})}if(!g&&_&&c.showProRibbonTips&&b.canSeeEnableCe){if(b.canSeeEnableHiddenProTips)return null;_=(0,C.jsx)(K.Z.Ribbon,{text:"PRO",color:"gold",style:{fontWeight:"bold"},children:_})}return c.space?(0,C.jsx)(O.Z,m()(m()({},c.space),{},{children:_})):_}},80821:function(X,T,e){e.d(T,{Z:function(){return b}});var U=e(97857),i=e.n(U),p=e(5574),m=e.n(p),I=e(24963),W=e(36146),K=e(86738),O=e(83062),C=e(96074),$=e(83622),M=e(67294),c=e(85893);function b(n){var _=(0,M.useState)(!1),g=m()(_,2),a=g[0],D=g[1],o=(0,M.useContext)(I.Z),f=o.message,j=new W.Uo,r=function(){D(!0);var N=n.action();N instanceof Promise?N.then(function(A){if(D(!1),A){typeof n.onSuccess=="function"&&n.onSuccess(A);var L="";n.messageSuccess?typeof n.messageSuccess=="function"?L=n.messageSuccess(A):L=n.messageSuccess.indexOf("notification.")==0?j.format(n.messageSuccess):n.messageSuccess:L=j.format("notification.finish"),n.asynced?f.info(L):f.success(L)}}).catch(function(A){D(!1),typeof n.onError=="function"&&n.onError(A)}):D(!1)};return n.confirm?(0,c.jsx)(K.Z,i()(i()({style:{width:500},title:n.confirmTitle?n.confirmTitle:j.format("notification.title.tip"),description:typeof n.confirm=="string"&&n.confirm.indexOf("notification.")==0?j.format(n.confirm):n.confirm,onConfirm:r,okText:"Yes",cancelText:"No",onOpenChange:n.confirmOnOpenChange},n.confirmProps),{},{children:(0,c.jsxs)(O.Z,{title:n.tips,children:[n.showDivider&&(0,c.jsx)(C.Z,{type:"vertical",style:{marginRight:15}}),(0,c.jsx)($.ZP,{block:n.block,disabled:n.disabled,icon:!n.children&&a?void 0:n.icon,loading:a,danger:n.danger,type:n.type,children:n.children})]})})):(0,c.jsxs)(O.Z,{title:n.tips,children:[n.showDivider&&(0,c.jsx)(C.Z,{type:"vertical",style:{marginRight:15}}),(0,c.jsx)($.ZP,{block:n.block,style:n.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:n.disabled,icon:!n.children&&a?void 0:n.icon,loading:a,onClick:r,danger:n.danger,type:n.type,children:n.children})]})}},44349:function(X,T,e){var U=e(97857),i=e.n(U),p=e(15009),m=e.n(p),I=e(99289),W=e.n(I),K=e(74763),O=e(17186),C=e(5966),$=e(86250),M=e(67294),c=e(85893),b=(0,M.forwardRef)(function(n,_){var g=(0,M.useRef)();(0,M.useImperativeHandle)(_,function(){return{addItem:function(D){function o(f,j,r){return D.apply(this,arguments)}return o.toString=function(){return D.toString()},o}(function(D,o,f){var j,r=(j=g.current)===null||j===void 0?void 0:j.getList(),x;if(r==null||r.forEach(function(L,k){L[D]==o[D]&&(x=k)}),!(0,K.k)(x)&&f){var N;(N=g.current)===null||N===void 0||N.remove(x),x=void 0}if(!x){var A;(A=g.current)===null||A===void 0||A.add(o)}}),removeItemByKey:function(o,f){return W()(m()().mark(function j(){var r,x;return m()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return x=(r=g.current)===null||r===void 0?void 0:r.getList(),x==null||x.forEach(function(L,k){if(L[o]==f){var ee;(ee=g.current)===null||ee===void 0||ee.remove(k);return}}),A.abrupt("return");case 3:case"end":return A.stop()}},j)}))()},clear:function(o){if(!o){var f;o=(f=g.current)===null||f===void 0||(f=f.getList())===null||f===void 0?void 0:f.map(function(r,x){return x})}if(o){var j;(j=g.current)===null||j===void 0||j.remove(o)}},getList:function(){var o;return(o=g.current)===null||o===void 0?void 0:o.getList()}}});var a={};return n.hideCopyButton===!0&&(a.copyIconProps=!1),n.hideDeleteButton===!0&&(a.deleteIconProps=!1),(0,c.jsx)(O.u,i()(i()({initialValue:n.initialValue,label:n.label,name:n.name,actionRef:g,creatorButtonProps:n.showAddButton?{creatorButtonText:n.label?n.label:n.name}:!1,min:n.min?n.min:0},a),{},{children:function(o,f,j){return(0,c.jsx)($.Z,{justify:n.justify,gap:n.gap,children:n.items.map(function(r){return r.render?(0,c.jsx)("div",{children:r.render&&r.render(o,f,j)},"".concat(n.name,"-").concat(r.name,"-").concat(o.key)):(0,c.jsx)(C.Z,{width:r.width,name:r.name,label:r.label,required:r.required,rules:[{required:r.required}],disabled:r.disabled,placeholder:r.placeholder},"".concat(n.name,"-").concat(r.name,"-").concat(o.key))})})}}))});T.Z=b},36435:function(X,T,e){var U=e(15009),i=e.n(U),p=e(64599),m=e.n(p),I=e(99289),W=e.n(I),K=e(9783),O=e.n(K),C=e(5574),$=e.n(C),M=e(67294),c=e(184),b=e(38345),n=e(97269),_=e(97321),g=e(97462),a=e(64317),D=e(5966),o=e(86615),f=e(68602),j=e(83622),r=e(83403),x=e(24963),N=e(1699),A=e(29177),L=e(1883),k=e(43425),ee=e(44349),ae=e(3616),ne=e(36146),R=e(85893),se=(0,M.forwardRef)(function(s,ie){var le=(0,M.useState)(!1),te=$()(le,2),S=te[0],q=te[1],G=(0,M.useRef)(),J=(0,M.useContext)(x.Z),H=J.message,Z=(0,M.useState)([]),V=$()(Z,2),z=V[0],y=V[1],u=new ne.Uo("components.permissionButton"),F=O()(O()(O()(O()(O()({},r.W6.CONTAINER,"Id"),r.W6.APPSTORE,"name"),r.W6.COMPOSE,"name"),r.W6.REGISTRY,"serverAddress"),r.W6.DOCKER_ENV,"name"),oe=O()(O()(O()(O()(O()({},r.W6.CONTAINER,"name"),r.W6.APPSTORE,"name"),r.W6.COMPOSE,"name"),r.W6.REGISTRY,"title"),r.W6.DOCKER_ENV,"title"),re=F[s.type],B=oe[s.type],w=s.selected.map(function(l){return l[F[s.type]]});return M.useEffect(function(){if(S){if(!s.selected||s.selected.length==0){H.error(ne.FD.format("message.noDataSelect")),q(!1);return}(0,f.dP)({permission:{uri:s.type,key:re,value:w}}).then(function(l){var t;(t=G.current)===null||t===void 0||t.setFieldValue("list",Object.keys(l.data.list).map(function(d){return{name:d,type:l.data.list[d].type,users:l.data.list[d].users}}))}),(0,f.lE)().then(function(l){var t,d=(t=l.data)===null||t===void 0||(t=t.list)===null||t===void 0?void 0:t.map(function(v){return{label:v.username,value:v.username}});y(d)})}},[S]),(0,R.jsx)(N.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,R.jsxs)(c.a,{name:"create",title:u.format("drawerTitle"),open:S,onOpenChange:function(t){if(!t){var d;(d=G.current)===null||d===void 0||d.resetFields()}q(t)},drawerProps:{forceRender:!0,width:ae.R_},formRef:G,trigger:(0,R.jsx)(j.ZP,{icon:(0,R.jsx)(A.Z,{}),children:u.format("drawerTriggerButton")}),onFinish:function(){var l=W()(i()().mark(function t(d){var v,E,h;return i()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:v=m()(d.list),P.prev=1,v.s();case 3:if((E=v.n()).done){P.next=9;break}return h=E.value,P.next=7,(0,f.Db)({usernames:h.users,permissionType:h.type,permission:{uri:s.type,key:re,showKey:B,value:[h.name]}});case 7:P.next=3;break;case 9:P.next=14;break;case 11:P.prev=11,P.t0=P.catch(1),v.e(P.t0);case 14:return P.prev=14,v.f(),P.finish(14);case 17:H.success(ne.FD.format("finish")),q(!1),s.onSuccess();case 20:case"end":return P.stop()}},t,null,[[1,11,14,17]])}));return function(t){return l.apply(this,arguments)}}(),children:[(0,R.jsxs)(b.Z,{ghost:!0,title:(0,R.jsx)(L.Z,{}),subTitle:u.format("batchTitle"),children:[(0,R.jsx)(n.A.Item,{name:"type",style:{marginBottom:0},children:(0,R.jsx)(_.Z.Group,{defaultValue:"admin",onChange:function(t){var d,v,E=(d=G.current)===null||d===void 0?void 0:d.getFieldValue("list");E.forEach(function(h){h.type=t,h.users=[]}),(v=G.current)===null||v===void 0||v.setFieldValue("list",E)},children:["admin","restricted","public"].map(function(l){return(0,R.jsx)(_.Z,{style:{width:240},title:u.format("dataTypeOption.".concat(l)),description:u.format("dataTypeOptionDesc.".concat(l)),value:l},l)})})}),(0,R.jsx)(g.Z,{name:["type"],children:function(t){var d=t.type;if(d==="restricted")return(0,R.jsx)(a.Z,{mode:"multiple",name:"usernames",label:u.format("formUsernames"),onChange:function(E){var h,Y,P=(h=G.current)===null||h===void 0?void 0:h.getFieldValue("list");P.forEach(function(Q){Q.users=E}),(Y=G.current)===null||Y===void 0||Y.setFieldValue("list",P)},rules:[{required:!0}],request:W()(i()().mark(function v(){var E,h,Y;return i()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(!(z.length>0)){Q.next=2;break}return Q.abrupt("return",z);case 2:return Q.next=4,(0,f.lE)();case 4:return h=Q.sent,Y=(E=h.data)===null||E===void 0||(E=E.list)===null||E===void 0?void 0:E.map(function(_e){return{label:_e.username,value:_e.username}}),y(Y),Q.abrupt("return",Y);case 8:case"end":return Q.stop()}},v)}))})}})]}),(0,R.jsx)(b.Z,{ghost:!0,title:(0,R.jsx)(k.Z,{}),subTitle:u.format("dataTitle"),children:(0,R.jsx)(ee.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:u.format("dataName"),render:function(t,d,v){var E=v.getCurrentRowData();return(0,R.jsx)(D.Z,{disabled:!0,label:u.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:u.format("dataType"),render:function(t,d,v){var E=v.getCurrentRowData();return(0,R.jsx)(o.Z.Group,{label:u.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(h){return{label:u.format("dataTypeOption.".concat(h)),value:h}})})}},{name:"users",label:u.format("dataUsers"),render:function(t,d,v){return(0,R.jsx)(g.Z,{name:["type"],children:function(h){var Y=h.type;if(Y=="restricted")return(0,R.jsx)(a.Z,{width:"sm",mode:"tags",name:"users",label:u.format("dataUsers"),options:z})}})}}]})})]})})});T.Z=se},3616:function(X,T,e){e.d(T,{Ed:function(){return m},FK:function(){return i},R_:function(){return U},ob:function(){return p}});var U=window.innerWidth<=1024?"90vw":"65vw",i="90vw",p="60vw",m="50vh"},24963:function(X,T,e){var U=e(67294),i=(0,U.createContext)({});T.Z=i},39900:function(X,T,e){e.r(T),e.d(T,{default:function(){return te}});var U=e(15009),i=e.n(U),p=e(99289),m=e.n(p),I=e(1699),W=e(80821),K=e(36435),O=e(83403),C=e(75870),$=e(67255),M=e(86548),c=e(90078),b=e(56729),n=e(82346),_=e(42075),g=e(96074),a=e(83622),D=e(83062),o=e(67294),f=e(36146),j=e(5574),r=e.n(j),x=e(3616),N=e(24963),A=e(184),L=e(5966),k=e(52688),ee=e(97462),ae=e(90672),ne=e(62370),R=e(25593),se=e(66309),s=e(85893),ie=(0,o.forwardRef)(function(S,q){var G=(0,o.useState)(!1),J=r()(G,2),H=J[0],Z=J[1],V=(0,o.useRef)(),z=(0,o.useState)(0),y=r()(z,2),u=y[0],F=y[1],oe=(0,o.useContext)(N.Z),re=oe.message,B=new f.Uo("components.image");return(0,o.useImperativeHandle)(q,function(){return{setEditId:function(l){(0,C.t1)({id:l}).then(function(t){var d;Z(!0),F(l),(d=V.current)===null||d===void 0||d.setFieldsValue({title:t.data.info.title,serverAddress:t.data.info.serverAddress,username:t.data.info.setting.username,password:t.data.info.setting.password,proxy:t.data.info.setting.proxy.join(`
`),enableHttp:t.data.info.setting.enableHttp,enableAuth:!!t.data.info.setting.username})})}}}),(0,s.jsxs)(A.a,{drawerProps:{forceRender:!0,width:x.R_},name:"createRegisry",title:B.format("registryCreateTitle"),open:H,onOpenChange:function(l){Z(l)},layout:"horizontal",labelCol:{span:5,offset:0},formRef:V,trigger:(0,s.jsx)(a.ZP,{type:"primary",onClick:function(){var l;(l=V.current)===null||l===void 0||l.resetFields(),F(0)},children:B.format("registryCreateTirggerButton")}),onFinish:function(){var w=m()(i()().mark(function l(t){var d,v,E,h;return i()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(0,C.ZH)({id:u,title:t.title,serverAddress:t.serverAddress,username:(d=t.username)!==null&&d!==void 0?d:"",password:(v=t.password)!==null&&v!==void 0?v:"",proxy:t.proxy?t.proxy.split(`
`):[],enableHttp:t.enableHttp});case 2:if(E=P.sent,!(E&&E.data&&E.data.id>0)){P.next=8;break}return re.success(f.FD.format("finish")),S.onFinish&&S.onFinish(),(h=V.current)===null||h===void 0||h.resetFields(),P.abrupt("return",!0);case 8:case"end":return P.stop()}},l)}));return function(l){return w.apply(this,arguments)}}(),children:[(0,s.jsx)(L.Z,{label:B.format("registryCreateFormTitle"),name:"title",placeholder:B.format("registryCreateFormTitleEmpty"),disabled:u==-1,required:!0}),(0,s.jsx)(L.Z,{label:B.format("registryCreateFormServerAddress"),name:"serverAddress",placeholder:"ccr.ccs.tencentyun.com, docker.io, 127.0.0.1:5000",disabled:u==-1,required:!0,rules:[{required:!0}]}),(0,s.jsx)(k.Z,{tooltip:B.format("registryCreateFormEnableHttpTip"),label:B.format("registryCreateFormEnableHttp"),name:"enableHttp"}),(0,s.jsx)(k.Z,{label:B.format("registryCreateFormEnableAuth"),name:"enableAuth"}),(0,s.jsx)(ee.Z,{name:["enableAuth"],children:function(l){var t=l.enableAuth;return t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L.Z,{label:B.format("registryCreateFormUsername"),name:"username",placeholder:B.format("registryCreateFormUsernameEmpty"),tooltip:""},"username"),(0,s.jsx)(L.Z.Password,{label:B.format("registryCreateFormPassword"),name:"password",allowClear:!0,placeholder:B.format("registryCreateFormPasswordEmpty")},"password")]})}}),(0,s.jsx)(ae.Z,{label:B.format("registryCreateFormProxy"),name:"proxy",fieldProps:{autoSize:{minRows:10}},placeholder:B.format("registryCreateFormProxyTip")}),(0,s.jsx)(ne.Z,{label:B.format("registryCreateFormProxyRecommand"),children:(0,s.jsx)(_.Z,{wrap:!0,children:["docker.1panel.live","docker.m.daocloud.io","docker.1ms.run"].map(function(w,l){return(0,s.jsx)(R.Z.Link,{onClick:function(){var d,v,E=[];if((d=V.current)!==null&&d!==void 0&&d.getFieldValue("proxy")){var h;E=(h=V.current)===null||h===void 0?void 0:h.getFieldValue("proxy").split(`
`)}else E=[];E.includes(w)||E.push(w),(v=V.current)===null||v===void 0||v.setFieldValue("proxy",E.join(`
`))},children:(0,s.jsx)(se.Z,{color:"cyan",children:w})},l)})})},"recommend")]})}),le=ie;function te(){var S=(0,o.useRef)(),q=(0,o.useRef)(),G=(0,n.useAccess)();return(0,s.jsx)(c._z,{header:{extra:[(0,s.jsx)(I.u,{access:"canSeeImageRegistryManage",children:(0,s.jsx)(le,{onFinish:function(){var H,Z;!((H=S.current)===null||H===void 0)&&H.reloadAndRest&&((Z=S.current)===null||Z===void 0||Z.reloadAndRest())},ref:q},"create")},"create")]},children:(0,s.jsx)(b.Z,{scroll:{x:"max-content"},rowKey:"id",columns:[{title:f.FD.format("listTitle"),ellipsis:!0,dataIndex:"title"},{title:"Url",dataIndex:"serverAddress"},{title:f.FD.format("listUsername"),dataIndex:["setting","username"],search:!1},{title:f.FD.format("listManage"),width:100,search:!1,fixed:"right",hidden:!G.canSeeImageRegistryManage,render:function(H,Z,V,z,y){return(0,s.jsx)(_.Z,{split:(0,s.jsx)(g.Z,{type:"vertical"}),children:(0,s.jsx)(a.ZP,{type:"link",onClick:function(){var F;(F=q.current)===null||F===void 0||F.setEditId(Z.id)},children:(0,s.jsx)(D.Z,{title:f.FD.format("listManageEdit"),children:(0,s.jsx)(M.Z,{})})})})}}],request:function(){var J=m()(i()().mark(function H(Z,V,z){var y;return i()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,(0,C.Ot)({title:Z.title,serverAddress:Z.serverAddress});case 2:return y=F.sent,F.abrupt("return",{data:y.data.list,success:!0,total:y.data.list.length});case 4:case"end":return F.stop()}},H)}));return function(H,Z,V){return J.apply(this,arguments)}}(),toolBarRender:function(){return[]},rowSelection:G.canSeeImageRegistryManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0}:void 0,pagination:(0,$.O)(),actionRef:S,tableAlertOptionRender:function(H){var Z=H.selectedRowKeys,V=H.selectedRows;return(0,s.jsxs)(_.Z,{size:16,children:[(0,s.jsx)(K.Z,{type:O.W6.REGISTRY,selected:V,onSuccess:function(){var y,u;return!((y=S.current)===null||y===void 0)&&y.reloadAndRest&&((u=S.current)===null||u===void 0||u.reloadAndRest()),!0}}),(0,s.jsx)(W.Z,{danger:!0,type:"primary",action:function(){return(0,C.ix)({id:Z})},onSuccess:function(){var y,u;return!((y=S.current)===null||y===void 0)&&y.reloadAndRest&&((u=S.current)===null||u===void 0||u.reloadAndRest()),!0},onError:function(){var y,u;return!((y=S.current)===null||y===void 0)&&y.reset&&((u=S.current)===null||u===void 0||u.reset()),!0},confirm:"notification.confirm.title",children:f.FD.format("listManageDeleteBatch")})]})}})})}},75870:function(X,T,e){e.d(T,{Ot:function(){return W},ZH:function(){return O},ix:function(){return $},t1:function(){return c}});var U=e(15009),i=e.n(U),p=e(99289),m=e.n(p),I=e(82346);function W(n){return K.apply(this,arguments)}function K(){return K=m()(i()().mark(function n(_){return i()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,I.request)("/api/common/registry/get-list",{method:"POST",data:_}));case 1:case"end":return a.stop()}},n)})),K.apply(this,arguments)}function O(n){return C.apply(this,arguments)}function C(){return C=m()(i()().mark(function n(_){return i()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,I.request)("/api/common/registry/create",{method:"POST",data:_}));case 1:case"end":return a.stop()}},n)})),C.apply(this,arguments)}function $(n){return M.apply(this,arguments)}function M(){return M=m()(i()().mark(function n(_){return i()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,I.request)("/api/common/registry/delete",{method:"POST",data:_}));case 1:case"end":return a.stop()}},n)})),M.apply(this,arguments)}function c(n){return b.apply(this,arguments)}function b(){return b=m()(i()().mark(function n(_){return i()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,I.request)("/api/common/registry/get-detail",{method:"POST",data:_}));case 1:case"end":return a.stop()}},n)})),b.apply(this,arguments)}},67255:function(X,T,e){e.d(T,{O:function(){return U},j:function(){return i}});function U(p){var m=localStorage.getItem("dpanel-pagesize");return m=="all"?!1:{defaultCurrent:p==null?void 0:p.page,showSizeChanger:!0,defaultPageSize:parseInt(m!=null?m:"20"),onChange:function(W,K){localStorage.setItem("dpanel-page-"+location.pathname.split("/").slice(-2).join("-"),"".concat(W))}}}function i(p){var m="dpanel-table-column-".concat(p),I={};if(localStorage.getItem(m)){var W;I=JSON.parse((W=localStorage.getItem(m))!==null&&W!==void 0?W:"{}")}return{defaultValue:I,onChange:function(O){localStorage.setItem("dpanel-table-column-".concat(p),JSON.stringify(O))}}}}}]);
