"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8022],{91806:function(w,B,e){e.d(B,{Z:function(){return c}});var L=e(87462),C=e(67294),M={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},y=M,U=e(84089),j=function(G,P){return C.createElement(U.Z,(0,L.Z)({},G,{ref:P,icon:y}))},Z=C.forwardRef(j),c=Z},44349:function(w,B,e){var L=e(97857),C=e.n(L),M=e(17186),y=e(5966),U=e(86250),j=e(67294),Z=e(85893),c=(0,j.forwardRef)(function(_,G){var P=(0,j.useRef)();(0,j.useImperativeHandle)(G,function(){return{addItem:function(g,x){var A,u=(A=P.current)===null||A===void 0?void 0:A.getList(),N=!1;if(u==null||u.map(function(Q){if(Q.name==g){N=!0;return}}),!N){var S;(S=P.current)===null||S===void 0||S.add({name:g,value:x})}},clear:function(){var g;(g=P.current)===null||g===void 0||(g=g.getList())===null||g===void 0||g.map(function(x,A){var u;(u=P.current)===null||u===void 0||u.remove(A)})}}});var J={};return _.hideCopyButton===!0&&(J.copyIconProps=!1),_.hideDeleteButton===!0&&(J.deleteIconProps=!1),(0,Z.jsx)(M.u,C()(C()({initialValue:_.initialValue,label:_.label,name:_.name,actionRef:P,creatorButtonProps:_.showAddButton?{creatorButtonText:"\u6DFB\u52A0"+(_.label?_.label:_.name)}:!1,min:_.min?_.min:0},J),{},{children:function(g,x,A){return(0,Z.jsx)(U.Z,{justify:_.justify,gap:_.gap,children:_.items.map(function(u){return u.render?(0,Z.jsx)("div",{children:u.render&&u.render(g,x,A)},"".concat(_.name,"-").concat(u.name,"-").concat(g.key)):(0,Z.jsx)(y.Z,{width:u.width,name:u.name,label:u.label,required:u.required,rules:[{required:u.required}],disabled:u.disabled,placeholder:u.placeholder},"".concat(_.name,"-").concat(u.name,"-").concat(g.key))})})}}))});B.Z=c},8680:function(w,B,e){var L=e(15009),C=e.n(L),M=e(64599),y=e.n(M),U=e(99289),j=e.n(U),Z=e(9783),c=e.n(Z),_=e(5574),G=e.n(_),P=e(67294),J=e(184),z=e(38345),g=e(97269),x=e(97321),A=e(97462),u=e(64317),N=e(5966),S=e(86615),Q=e(68602),k=e(28036),W=e(83403),q=e(24963),K=e(1699),a=e(29177),ne=e(45742),te=e(43425),ae=e(44349),d=e(85893),re=(0,P.forwardRef)(function(H,se){var T=(0,P.useState)(!1),b=G()(T,2),Y=b[0],I=b[1],h=(0,P.useRef)(),X=(0,P.useContext)(q.Z),ee=X.message,D=(0,P.useState)([]),o=G()(D,2),n=o[0],i=o[1],s=c()(c()(c()(c()(c()({},W.W6.CONTAINER,"Id"),W.W6.APPSTORE,"name"),W.W6.COMPOSE,"name"),W.W6.REGISTRY,"serverAddress"),W.W6.DOCKER_ENV,"name"),r=c()(c()(c()(c()(c()({},W.W6.CONTAINER,"name"),W.W6.APPSTORE,"name"),W.W6.COMPOSE,"name"),W.W6.REGISTRY,"title"),W.W6.DOCKER_ENV,"title"),f=s[H.type],E=r[H.type],F=H.selected.map(function(t){return t[s[H.type]]});return P.useEffect(function(){Y&&((0,Q.dP)({permission:{uri:H.type,key:f,value:F}}).then(function(t){var l;(l=h.current)===null||l===void 0||l.setFieldValue("list",Object.keys(t.data.list).map(function(m){return{name:m,type:t.data.list[m].type,users:t.data.list[m].users}}))}),(0,Q.lE)().then(function(t){var l,m=(l=t.data)===null||l===void 0||(l=l.list)===null||l===void 0?void 0:l.map(function(v){return{label:v.username,value:v.username}});i(m)}))},[Y]),(0,d.jsx)(K.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,d.jsxs)(J.a,{name:"create",title:"\u6570\u636E\u6743\u9650\u8BBE\u7F6E",open:Y,onOpenChange:function(l){if(!l){var m;(m=h.current)===null||m===void 0||m.resetFields()}I(l)},drawerProps:{forceRender:!0},formRef:h,trigger:(0,d.jsx)(k.ZP,{icon:(0,d.jsx)(a.Z,{}),children:"\u6570\u636E\u6743\u9650"}),onFinish:function(){var t=j()(C()().mark(function l(m){var v,O,R;return C()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:v=y()(m.list),p.prev=1,v.s();case 3:if((O=v.n()).done){p.next=9;break}return R=O.value,p.next=7,(0,Q.Db)({usernames:R.users,permissionType:R.type,permission:{uri:H.type,key:f,showKey:E,value:[R.name]}});case 7:p.next=3;break;case 9:p.next=14;break;case 11:p.prev=11,p.t0=p.catch(1),v.e(p.t0);case 14:return p.prev=14,v.f(),p.finish(14);case 17:ee.success("\u6743\u9650\u8BBE\u7F6E\u6210\u529F"),I(!1),H.onSuccess();case 20:case"end":return p.stop()}},l,null,[[1,11,14,17]])}));return function(l){return t.apply(this,arguments)}}(),children:[(0,d.jsxs)(z.Z,{ghost:!0,title:(0,d.jsx)(ne.Z,{}),subTitle:"\u6279\u91CF\u8BBE\u7F6E",children:[(0,d.jsx)(g.A.Item,{name:"type",style:{marginBottom:0},children:(0,d.jsxs)(x.Z.Group,{defaultValue:"admin",onChange:function(l){var m,v,O=(m=h.current)===null||m===void 0?void 0:m.getFieldValue("list");O.forEach(function(R){R.type=l,R.users=[]}),(v=h.current)===null||v===void 0||v.setFieldValue("list",O)},children:[(0,d.jsx)(x.Z,{style:{width:240},title:"\u7BA1\u7406\u5458",description:"\u4EC5\u7BA1\u7406\u5458\u53EF\u89C1",value:"admin"}),(0,d.jsx)(x.Z,{style:{width:240},title:"\u6307\u5B9A\u7528\u6237",description:"\u4EC5\u9009\u4E2D\u7528\u6237\u53EF\u89C1",value:"restricted"}),(0,d.jsx)(x.Z,{style:{width:240},title:"\u516C\u5171",description:"\u6240\u6709\u4EBA\u53EF\u89C1",value:"public"})]})}),(0,d.jsx)(A.Z,{name:["type"],children:function(l){var m=l.type;if(m==="restricted")return(0,d.jsx)(u.Z,{mode:"multiple",name:"usernames",label:"\u9009\u62E9\u7528\u6237",onChange:function(O){var R,$,p=(R=h.current)===null||R===void 0?void 0:R.getFieldValue("list");p.forEach(function(V){V.users=O}),($=h.current)===null||$===void 0||$.setFieldValue("list",p)},rules:[{required:!0}],request:j()(C()().mark(function v(){var O,R,$;return C()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(!(n.length>0)){V.next=2;break}return V.abrupt("return",n);case 2:return V.next=4,(0,Q.lE)();case 4:return R=V.sent,$=(O=R.data)===null||O===void 0||(O=O.list)===null||O===void 0?void 0:O.map(function(le){return{label:le.username,value:le.username}}),i($),V.abrupt("return",$);case 8:case"end":return V.stop()}},v)}))})}})]}),(0,d.jsx)(z.Z,{ghost:!0,title:(0,d.jsx)(te.Z,{}),subTitle:"\u6570\u636E\u6743\u9650\u8BBE\u7F6E",children:(0,d.jsx)(ae.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:"\u540D\u79F0",render:function(l,m,v){var O=v.getCurrentRowData();return(0,d.jsx)(N.Z,{disabled:!0,label:"\u540D\u79F0",width:"sm",name:"name"})}},{name:"type",label:"\u6743\u9650\u7C7B\u578B",render:function(l,m,v){var O=v.getCurrentRowData();return(0,d.jsx)(S.Z.Group,{label:"\u6743\u9650\u7C7B\u578B",name:"type",radioType:"button",options:[{label:"\u7BA1\u7406\u5458",value:"admin"},{label:"\u516C\u5171",value:"public"},{label:"\u6307\u5B9A\u7528\u6237",value:"restricted"}]})}},{name:"users",label:"\u5173\u8054\u7528\u6237",render:function(l,m,v){return(0,d.jsx)(A.Z,{name:["type"],children:function(R){var $=R.type;if($=="restricted")return(0,d.jsx)(u.Z,{width:"sm",mode:"tags",name:"users",label:"\u5173\u8054\u7528\u6237",options:n})}})}}]})})]})})});B.Z=re},96781:function(w,B,e){var L=e(67294),C=(0,L.createContext)({});B.Z=C},83536:function(w,B,e){e.r(B),e.d(B,{default:function(){return se}});var L=e(64599),C=e.n(L),M=e(15009),y=e.n(M),U=e(99289),j=e.n(U),Z=e(80821),c=e(90098),_=e(43425),G=e(23430),P=e(90078),J=e(41482),z=e(82346),g=e(28036),x=e(25593),A=e(42075),u=e(96074),N=e(83062),S=e(67294),Q=e(94359),k=e(67255),W=e(93162),q=e(24963),K=e(66309),a=e(85893);function ne(T){var b=(0,z.useIntl)(),Y=(0,S.useContext)(q.Z),I=Y.lang,h;if(!T.type)h=(0,a.jsx)(K.Z,{children:I("compose.type.default")});else switch(T.type){case"remoteUrl":h=(0,a.jsx)(K.Z,{color:"cyan",children:I("compose.type.".concat(T.type))});break;case"serverPath":h=(0,a.jsx)(K.Z,{color:"blue",children:I("compose.type.".concat(T.type))});break;case"storagePath":h=(0,a.jsx)(K.Z,{color:"geekblue",children:I("compose.type.".concat(T.type))});break;case"outPath":h=(0,a.jsx)(K.Z,{color:"yellow",children:I("compose.type.".concat(T.type))});break;case"store":h=(0,a.jsx)(K.Z,{color:"green",children:I("compose.type.".concat(T.type))});break;case"dangling":h=(0,a.jsx)(K.Z,{color:"error",children:I("compose.type.".concat(T.type))});break;default:h=(0,a.jsx)(K.Z,{children:I("compose.type.".concat(T.type))})}return(0,a.jsx)(N.Z,{title:T.tootip,children:h})}var te=e(96781),ae=e(73587),d=e(1699),re=e(83403),H=e(8680);function se(){var T=(0,S.useContext)(te.Z),b=T.listTableRef,Y=(0,S.useContext)(q.Z),I=Y.lang,h=Y.notice,X=(0,S.useRef)(),ee=(0,z.useAccess)();return(0,a.jsxs)(P._z,{header:{extra:[(0,a.jsx)(d.u,{access:"canSeeComposeListManageCreate",children:(0,a.jsx)(z.Link,{to:"/compose/create",reloadDocument:location.search.length>0,children:(0,a.jsx)(g.ZP,{type:"primary",children:"\u521B\u5EFA\u4EFB\u52A1"},"createCompose")},"create")},"create")]},children:[(0,a.jsx)(ae.Z,{ref:X,onClose:function(){var o;!((o=b.current)===null||o===void 0)&&o.reloadAndRest&&b.current.reloadAndRest()}}),(0,a.jsx)(J.Z,{scroll:{x:"max-content"},request:function(){var D=j()(y()().mark(function o(n){var i;return y()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,c.pm)({title:n.title,name:n.name});case 2:return i=r.sent,r.abrupt("return",{data:i.data.list,success:!0,total:i.data.list.length});case 4:case"end":return r.stop()}},o)}));return function(o){return D.apply(this,arguments)}}(),rowKey:"name",columns:[{title:"\u6807\u8BC6",dataIndex:"name",width:200,render:function(o,n,i,s,r){return(0,a.jsx)(x.Z.Link,{onClick:function(){var E;(E=X.current)===null||E===void 0||E.show(n.id||n.name)},children:n.name})},sorter:function(o,n){return o.name.localeCompare(n.name)},sortDirections:["descend","ascend"]},{title:"\u9879\u76EE\u540D\u79F0",dataIndex:"title",width:200},{title:"\u7C7B\u578B",width:150,search:!1,render:function(o,n,i,s,r){var f;return(0,a.jsx)(ne,{tootip:(f=n.setting.uri)!==null&&f!==void 0?f:"",type:n.setting&&n.setting.type?n.setting.type:""})}},{title:"\u5BB9\u5668\u72B6\u6001",dataIndex:"status",search:!1,width:300,render:function(o,n,i,s,r){return(0,a.jsx)(A.Z,{children:n.setting.status.split(", ").map(function(f,E){var F="running",t=f.indexOf("(");return t>-1?F=f.slice(0,t):F=f,(0,a.jsx)(Q.Z,{status:F,message:{content:I("compose.status.".concat(F),{count:f.slice(t+1,f.length-1)}),title:n.setting.message,placement:"top",showInTag:!0}},E)})})},sorter:function(o,n){return o.setting.status.localeCompare(n.setting.status)}},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"",search:!1,width:150,render:function(o,n,i,s,r){return n.setting.createdAt?new Date(n.setting.createdAt).toLocaleString():"-"},sorter:function(o,n){var i,s;return new Date((i=o.setting.createdAt)!==null&&i!==void 0?i:"").toLocaleString().localeCompare(new Date((s=n.setting.createdAt)!==null&&s!==void 0?s:"").toLocaleString())}},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"",search:!1,width:150,render:function(o,n,i,s,r){return n.setting.updatedAt?new Date(n.setting.updatedAt).toLocaleString():"-"},sorter:function(o,n){var i,s;return new Date((i=o.setting.updatedAt)!==null&&i!==void 0?i:"").toLocaleString().localeCompare(new Date((s=n.setting.updatedAt)!==null&&s!==void 0?s:"").toLocaleString())}},{title:"\u64CD\u4F5C",width:80,valueType:"option",fixed:"right",key:"option",hidden:!ee.canSeeComposeListManage,render:function(o,n,i,s,r){return n.setting.type!="dangling"&&(0,a.jsxs)(A.Z,{split:(0,a.jsx)(u.Z,{type:"vertical"}),children:[(0,a.jsx)(x.Z.Link,{onClick:function(){var E;(E=X.current)===null||E===void 0||E.show(n.id||n.name)},children:(0,a.jsx)(N.Z,{title:"\u90E8\u7F72",children:(0,a.jsx)(_.Z,{})})},"3"),(0,a.jsx)(x.Z.Link,{onClick:j()(y()().mark(function f(){var E,F;return y()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,(0,c.tw)({id:n.id||n.name});case 2:E=l.sent,F=new Blob([E],{type:"application/zip"}),(0,W.saveAs)(F,"compose-"+n.name+".zip");case 5:case"end":return l.stop()}},f)})),children:(0,a.jsx)(N.Z,{title:"\u4E0B\u8F7D",children:(0,a.jsx)(G.Z,{})})},"2")]})}}],rowSelection:ee.canSeeComposeListManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0,getCheckboxProps:function(o){return{disabled:o.setting.type=="dangling"||o.setting.type=="outPath"}}}:void 0,tableAlertOptionRender:function(o){var n=o.selectedRows;return(0,a.jsxs)(A.Z,{size:16,children:[(0,a.jsx)(H.Z,{type:re.W6.COMPOSE,selected:n,onSuccess:function(){var s,r;return!((s=b.current)===null||s===void 0)&&s.reloadAndRest&&((r=b.current)===null||r===void 0||r.reloadAndRest()),!0}}),(0,a.jsx)(d.u,{access:"canSeeComposeListManageDelete",children:(0,a.jsx)(Z.Z,{danger:!0,type:"primary",action:j()(y()().mark(function i(){var s,r,f,E;return y()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,r=C()(n),t.prev=2,r.s();case 4:if((f=r.n()).done){t.next=11;break}return E=f.value,t.next=8,(0,c.mg)({id:E.id||E.name});case 8:s=t.sent;case 9:t.next=4;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(2),r.e(t.t0);case 16:return t.prev=16,r.f(),t.finish(16);case 19:t.next=23;break;case 21:t.prev=21,t.t1=t.catch(0);case 23:return t.abrupt("return",(0,c.ik)({id:n.map(function(l){return l.id})}));case 24:case"end":return t.stop()}},i,null,[[0,21],[2,13,16,19]])})),onSuccess:function(){var s,r;return!((s=b.current)===null||s===void 0)&&s.reloadAndRest&&((r=b.current)===null||r===void 0||r.reloadAndRest()),!0},onError:function(){var s,r;return!((s=b.current)===null||s===void 0)&&s.reset&&((r=b.current)===null||r===void 0||r.reset()),!0},confirm:"notification.confirm.title",children:"\u6279\u91CF\u5220\u9664"})})]})},pagination:(0,k.O)(),search:{collapsed:!1},actionRef:b,columnsState:(0,k.j)("compose-list")})]})}},67255:function(w,B,e){e.d(B,{O:function(){return L},j:function(){return C}});function L(){var M=localStorage.getItem("dpanel-pagesize");return M=="all"?!1:{showSizeChanger:!0,defaultPageSize:parseInt(M!=null?M:"20")}}function C(M){var y="dpanel-table-column-".concat(M),U={};if(localStorage.getItem(y)){var j;U=JSON.parse((j=localStorage.getItem(y))!==null&&j!==void 0?j:"{}")}return{defaultValue:U,onChange:function(c){localStorage.setItem("dpanel-table-column-".concat(M),JSON.stringify(c))}}}}}]);
