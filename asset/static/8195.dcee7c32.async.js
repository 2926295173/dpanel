"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8195],{31199:function(U,D,r){var c=r(1413),M=r(45987),g=r(67294),h=r(35510),A=r(85893),f=["fieldProps","min","proFieldProps","max"],p=function(l,d){var E=l.fieldProps,C=l.min,v=l.proFieldProps,j=l.max,F=(0,M.Z)(l,f);return(0,A.jsx)(h.Z,(0,c.Z)({valueType:"digit",fieldProps:(0,c.Z)({min:C,max:j},E),ref:d,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:v},F))},s=g.forwardRef(p);D.Z=s},52688:function(U,D,r){var c=r(1413),M=r(45987),g=r(67294),h=r(35510),A=r(85893),f=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],p=g.forwardRef(function(s,i){var l=s.fieldProps,d=s.unCheckedChildren,E=s.checkedChildren,C=s.proFieldProps,v=(0,M.Z)(s,f);return(0,A.jsx)(h.Z,(0,c.Z)({valueType:"switch",fieldProps:(0,c.Z)({unCheckedChildren:d,checkedChildren:E},l),ref:i,valuePropName:"checked",proFieldProps:C,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},v))});D.Z=p},90672:function(U,D,r){var c=r(1413),M=r(45987),g=r(67294),h=r(35510),A=r(85893),f=["fieldProps","proFieldProps"],p=function(i,l){var d=i.fieldProps,E=i.proFieldProps,C=(0,M.Z)(i,f);return(0,A.jsx)(h.Z,(0,c.Z)({ref:l,valueType:"textarea",fieldProps:d,proFieldProps:E},C))};D.Z=g.forwardRef(p)},77273:function(U,D,r){var c=r(15009),M=r.n(c),g=r(99289),h=r.n(g),A=r(5574),f=r.n(A),p=r(184),s=r(5966),i=r(86615),l=r(97462),d=r(52688),E=r(62370),C=r(38345),v=r(31199),j=r(90672),F=r(71230),O=r(15746),R=r(86250),L=r(67294),W=r(91845),S=r(87662),I=r(12491),u=r(52756),t=r(89035),e=r(85893),n=(0,L.forwardRef)(function(B,$){var K;(0,L.useImperativeHandle)($,function(){return{edit:function(a){var o;(o=T.current)===null||o===void 0||o.setFieldsValue({name:a.name,title:a.title,address:a.address,serverUrl:a.serverUrl,enableTLS:a.enableTLS,tlsCa:a.tlsCa,tlsCert:a.tlsCert,tlsKey:a.tlsKey,enableComposePath:a.enableComposePath,enableSSH:a.enableSSH,sshServerInfo:a.sshServerInfo,remoteType:a.remoteType?a.remoteType:"docker"}),H(!0),N(a.name)}}});var G=(0,L.useState)(!1),y=f()(G,2),z=y[0],H=y[1],T=(0,L.useRef)(),Y=(0,L.useState)(""),V=f()(Y,2),w=V[0],N=V[1];return(0,e.jsxs)(p.a,{drawerProps:{forceRender:!0},onOpenChange:function(a){if(!a){var o;N(""),(o=T.current)===null||o===void 0||o.resetFields()}H(a)},open:z,width:800,trigger:B.trigger,formRef:T,title:(K=T.current)!==null&&K!==void 0&&K.getFieldValue&&T.current.getFieldValue("name")=="local"?"\u914D\u7F6E\u9ED8\u8BA4Docker\u670D\u52A1\u7AEF":"\u6DFB\u52A0\u8FDC\u7A0BDocker\u670D\u52A1\u7AEF",onFinish:function(){var x=h()(M()().mark(function a(o){var _;return M()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return console.log(o),m.next=3,(0,S.ad)({name:o.name,title:o.title,address:o.address,serverUrl:o.serverUrl,enableTLS:o.enableTLS,tlsCa:o.tlsCa,tlsCert:o.tlsCert,tlsKey:o.tlsKey,enableComposePath:o.enableComposePath,composePath:o.enableComposePath?o.composePath:"",enableSSH:o.enableSSH||o.remoteType=="ssh",sshServerInfo:o.sshServerInfo,remoteType:o.remoteType});case 3:return _=m.sent,B.onFinish&&B.onFinish(),m.abrupt("return",!0);case 6:case"end":return m.stop()}},a)}));return function(a){return x.apply(this,arguments)}}(),children:[(0,e.jsx)(s.Z,{label:"\u540D\u79F0",name:"title",required:!0,rules:[{required:!0}],fieldProps:{id:"envTitle",onChange:function(a){var o="";if(a.target.value&&!w){var _,P=(0,W.N9)(a.target.value.trim(),{toneType:"none",type:"array"});o=P.join(""),(_=T.current)===null||_===void 0||_.setFieldValue("name",o)}}}},"envTitle"),(0,e.jsx)(s.Z,{label:"\u6807\u8BC6",name:"name",required:!0,disabled:w!="",rules:[{required:!0}],placeholder:"\u6807\u8BC6Docker\u73AF\u5883\uFF0C\u53EA\u5141\u8BB8\u4E3A\u82F1\u6587\u6216\u662F\u6570\u5B57"}),(0,e.jsx)(s.Z,{tooltip:"\u8BBE\u7F6E\u5BBF\u4E3B\u673A\u7684Ip\u6216\u662F\u57DF\u540D\uFF0C\u7528\u4E8E\u901A\u8FC7\u7AEF\u53E3\u7684\u5F62\u5F0F\u8BBF\u95EE\u5BB9\u5668\u3002\u652F\u6301IpV4\u53CAIpV6",label:"\u5BB9\u5668\u7AEF\u53E3\u8BBF\u95EE\u57DF\u540D",name:"serverUrl",placeholder:"\u4F8B\u5982:192.168.1.25\u30012001:db8:1::2\u3001example.com"}),(0,e.jsx)(i.Z.Group,{label:"\u8FDE\u63A5\u65B9\u5F0F",name:"remoteType",valueEnum:{docker:"Docker Api",ssh:"SSH"}}),(0,e.jsx)(l.Z,{name:["remoteType","name"],children:function(a){var o=a.remoteType,_=a.name;return(0,e.jsxs)(e.Fragment,{children:[o=="docker"&&(0,e.jsx)(F.Z,{children:(0,e.jsx)(O.Z,{span:24,children:(0,e.jsx)(s.Z,{label:"Docker Api \u5730\u5740",name:"address",required:!0,rules:[{required:!0}],tooltip:"\u8FDE\u63A5\u8FDC\u7A0B Docker \u65F6\u8BF7\u5148\u5F00\u542F Api \u5730\u5740\u8BBF\u95EE\u3002",placeholder:"\u4F8B\u5982\uFF1Aunix:///var/run/docker.sock\u3001tcp://192.16.0.5:2375"})})}),(0,e.jsxs)(F.Z,{gutter:[15,0],children:[o=="docker"&&(0,e.jsx)(O.Z,{children:(0,e.jsx)(d.Z,{label:"\u542F\u7528 Docker Api TLS",name:"enableTLS",tooltip:"\u751F\u6210\u6559\u7A0B\u89C1\uFF1Ahttps://donknap.github.io/dpanel-docs/#/zh-cn/manual/remote"})}),_!="local"&&typeof o!="undefined"&&(0,e.jsx)(O.Z,{children:(0,e.jsx)(d.Z,{label:(0,u.getLang)("system.env.createEnableComposePath"),name:"enableComposePath",tooltip:"\u5F00\u542F\u72EC\u7ACBcompose\u914D\u7F6E\u540E\uFF0C\u5207\u6362\u8FDC\u7A0B docker \u5BA2\u6237\u7AEF\u65F6\u5C06\u53EA\u4F1A\u8BFB\u53D6\u8BE5\u73AF\u5883\u4E13\u5C5E\u76EE\u5F55\u4E0B\u7684 compose \u4EFB\u52A1"})}),o=="docker"&&(0,e.jsx)(O.Z,{children:(0,e.jsx)(d.Z,{label:"\u542F\u7528\u5BBF\u4E3B\u673A SSH \u8FDE\u63A5",name:"enableSSH"})})]})]})}}),(0,e.jsx)(l.Z,{name:["enableTLS"],children:function(a){var o=a.enableTLS;if(o)return(0,e.jsxs)(R.Z,{gap:10,justify:"start",children:[(0,e.jsx)(E.Z,{name:"tlsCa",label:"\u4E0A\u4F20\u5BA2\u6237\u7AEF\u8BC1\u4E66",children:(0,e.jsx)(I.Z,{title:"ca.pem",onImport:function(P){var m;return(m=T.current)===null||m===void 0||m.setFieldValue("tlsCa",P),!0},onLoad:function(P){if(P.indexOf("CERTIFICATE")<0)throw new Error("\u5BFC\u5165ca.pem\u8BC1\u4E66\u9519\u8BEF");return!0}})}),(0,e.jsx)(E.Z,{name:"tlsCert",label:" ",children:(0,e.jsx)(I.Z,{title:"cert.pem",onImport:function(P){var m;return(m=T.current)===null||m===void 0||m.setFieldValue("tlsCert",P),!0},onLoad:function(P){if(P.indexOf("CERTIFICATE")<0)throw new Error("\u5BFC\u5165cert.pem\u8BC1\u4E66\u9519\u8BEF");return!0}})}),(0,e.jsx)(E.Z,{label:" ",name:"tlsKey",children:(0,e.jsx)(I.Z,{title:"key.pem",onImport:function(P){var m;return(m=T.current)===null||m===void 0||m.setFieldValue("tlsKey",P),!0},onLoad:function(P){if(P.indexOf("PRIVATE")<0)throw new Error("\u5BFC\u5165key.pem\u8BC1\u4E66\u9519\u8BEF");return!0}})})]})}}),(0,e.jsx)(l.Z,{name:["enableComposePath","name"],children:function(a){var o=a.enableComposePath,_=a.name;if(o)return(0,e.jsx)(s.Z,{label:(0,u.getLang)("system.env.createComposePath"),name:"composePath",disabled:!0,fieldProps:{value:"/dpanel/compose/compose-".concat(_!=null?_:"")}})}}),(0,e.jsx)(l.Z,{name:["enableSSH","sshServerInfo","remoteType"],children:function(a){var o=a.enableSSH,_=a.sshServerInfo,P=a.remoteType;return(o||P=="ssh")&&[(0,e.jsxs)(C.Z,{title:(0,e.jsx)(t.Z,{}),subTitle:"\u4E3B\u673ASSH",ghost:!0,children:[P=="ssh"&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(s.Z,{label:"\u4E3B\u673AIP\u5730\u5740",placeholder:"\u8F93\u5165\u4E3B\u673A\u7684IP\u8FDE\u63A5\u5730\u5740",name:"address"})}),(0,e.jsxs)(F.Z,{children:[(0,e.jsx)(O.Z,{children:(0,e.jsx)(v.Z,{initialValue:22,label:"\u7AEF\u53E3",name:["sshServerInfo","port"]})}),(0,e.jsx)(O.Z,{offset:2,children:(0,e.jsx)(i.Z.Group,{label:"\u9A8C\u8BC1\u65B9\u5F0F",name:["sshServerInfo","authType"],valueEnum:{basic:"\u5BC6\u7801\u8BA4\u8BC1",pem:"\u79C1\u94A5\u8BA4\u8BC1"}})})]}),_&&_.authType=="basic"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s.Z,{label:"\u7528\u6237\u540D",name:["sshServerInfo","username"]}),(0,e.jsx)(s.Z.Password,{label:"\u5BC6\u7801",name:["sshServerInfo","password"]})]}),_&&_.authType=="pem"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s.Z,{label:"\u7528\u6237\u540D",name:["sshServerInfo","username"]}),(0,e.jsx)(I.Z,{title:"\u5BFC\u5165\u5BC6\u94A5\u6587\u4EF6",onImport:function(Z){var b;return(b=T.current)===null||b===void 0||b.setFieldValue(["sshServerInfo","privateKey"],Z),!0},onLoad:function(Z){if(!Z.includes("PRIVATE KEY"))throw new Error((0,u.getLang)("system.env.sshImportKeyFileIncorrect"));return!0}}),(0,e.jsx)(j.Z,{name:["sshServerInfo","privateKey"],label:"\u5BC6\u94A5"}),(0,e.jsx)(s.Z.Password,{name:["sshServerInfo","password"],label:"\u5BC6\u94A5\u5BC6\u7801"})]})]},"sshSetting")]}})]})});D.Z=n},12491:function(U,D,r){r.d(D,{Z:function(){return s}});var c=r(24963),M=r(88484),g=r(62370),h=r(31418),A=r(28036),f=r(67294),p=r(85893);function s(i){var l=(0,f.useContext)(c.Z),d=l.message,E=l.notice,C=l.lang,v=(0,f.useRef)(null),j=h.Z.useApp(),F=function(){v.current&&(v.current.click(),v.current.onchange=function(R){if(!R||!R.target)return"";var L=new FileReader;L.onload=function(S){var I,u,t=(I=S.target)===null||I===void 0?void 0:I.result;if(i.onLoad)try{i.onLoad&&i.onLoad(t)}catch(e){E.error(e);return}typeof i.onImport=="function"&&(d.success("\u6210\u529F\u5BFC\u5165 ".concat(i.title)),i.onImport(t)),(u=v.current)!==null&&u!==void 0&&u.value&&(v.current.value="")};var W=R.target;if(W.files)try{L.readAsText(W.files[0])}catch(S){E.error("\u5BFC\u5165\u6587\u4EF6\u5FC5\u987B\u662F\u6587\u672C\u7C7B\u578B")}})};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(g.Z,{children:(0,p.jsx)(A.ZP,{icon:(0,p.jsx)(M.Z,{}),block:!0,onClick:F,children:i.title})}),(0,p.jsx)("input",{style:{display:"none"},type:"file",ref:v,name:"importFileInput"})]})}},52756:function(U,D,r){r.r(D),r.d(D,{default:function(){return l},getLang:function(){return i}});var c=r(82346),M=r(31418),g=r(26058),h=r(85137),A=r(24963),f=r(65913),p=r(67294),s=r(85893);function i(d,E){return(0,c.getIntl)((0,c.getLocale)()).formatMessage({id:d},E)}function l(){var d=(0,p.useRef)(),E=(0,c.useIntl)(),C=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),B=1;B<e;B++)n[B-1]=arguments[B];j.notification[t]({message:E.formatMessage({id:"notification.title."+t}),description:n.join(" "),placement:"topRight"})},v=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),B=1;B<e;B++)n[B-1]=arguments[B];j.message[t](n.join(" "))},j=M.Z.useApp(),F=(0,c.useModel)("@@initialState"),O=F.initialState,R=F.loading,L=F.error,W=F.refresh,S=F.setInitialState,I=(0,c.useModel)("subscriber");return O!=null&&O.user.username&&I.addDataHandler("user:permission:".concat(O==null?void 0:O.user.username),function(u){W()}),(0,s.jsx)(g.Z,{children:(0,s.jsx)(A.Z.Provider,{value:{notice:{success:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];C.apply(void 0,["success"].concat(e))},error:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];C.apply(void 0,["error"].concat(e))},warning:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];C.apply(void 0,["warning"].concat(e))},info:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];C.apply(void 0,["info"].concat(e))},destroy:function(){j.notification.destroy()}},message:{success:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];v.apply(void 0,["success"].concat(e))},error:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];v.apply(void 0,["error"].concat(e))},warning:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];v.apply(void 0,["warning"].concat(e))},info:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];v.apply(void 0,["info"].concat(e))},loading:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];v.apply(void 0,["loading"].concat(e))},destroy:function(){j.message.destroy()}},loading:{show:function(){d.current&&d.current.show()},destroy:function(){d.current&&d.current.destroy()}},lang:function(t,e){return E.formatMessage({id:t},e)}},children:(0,s.jsxs)(f.Z,{ref:d,children:[(0,s.jsx)(c.Outlet,{}),(0,s.jsx)(h.Z.BackTop,{duration:10,style:{bottom:100}})]})},R?"1":"2")})}},65913:function(U,D,r){var c=r(5574),M=r.n(c),g=r(74330),h=r(67294),A=r(85893),f=(0,h.forwardRef)(function(p,s){(0,h.useImperativeHandle)(s,function(){return{show:function(){E(!0)},destroy:function(){E(!1)}}});var i=(0,h.useState)(!1),l=M()(i,2),d=l[0],E=l[1];return(0,A.jsx)(g.Z,{spinning:d,size:"default",children:p.children})});D.Z=f}}]);
