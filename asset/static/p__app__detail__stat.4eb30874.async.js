"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745],{55809:function(G,b,e){var T=e(87462),r=e(67294),x=e(44805),i=e(84089),h=function(O,v){return r.createElement(i.Z,(0,T.Z)({},O,{ref:v,icon:x.Z}))},g=r.forwardRef(h);b.Z=g},60433:function(G,b,e){var T=e(87462),r=e(67294),x=e(69782),i=e(84089),h=function(O,v){return r.createElement(i.Z,(0,T.Z)({},O,{ref:v,icon:x.Z}))},g=r.forwardRef(h);b.Z=g},1699:function(G,b,e){e.d(b,{u:function(){return v}});var T=e(9783),r=e.n(T),x=e(97857),i=e.n(x),h=e(67294),g=e(82346),R=e(42075),O=e(85893),v=function(E){var u=(0,g.useAccess)(),j=Array.isArray(E.access)?E.access:[E.access],I;return typeof E.children=="function"?I=E.children(j.reduce(function(L,M){return i()(i()({},L),{},r()({},M,u[M]))},{})):j.every(function(L){return u[L]})?I=E.children:I=E.fallback,E.space?(0,O.jsx)(R.Z,i()(i()({},E.space),{},{children:I})):I}},27619:function(G,b,e){e.d(b,{Z:function(){return E}});var T=e(97857),r=e.n(T),x=e(19632),i=e.n(x),h=e(5574),g=e.n(h),R=e(64183),O=e(82346),v=e(67294),C=e(85893);function E(u){var j,I=(0,v.useState)("academy"),L=g()(I,2),M=L[0],m=L[1],W=Math.max.apply(Math,i()(u.data.map(function(c){var a;return(a=c[u.yField])!==null&&a!==void 0?a:0}))),f=(0,O.useModel)("@@initialState"),A=f.initialState,S=f.loading,F=f.error,K=f.refresh,o=f.setInitialState,t={xField:u.xField,yField:u.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:u.yLabelFormatter},scale:{y:{domainMin:(j=u.yDomainMin)!==null&&j!==void 0?j:0,domainMax:u.yDomainMax?u.yDomainMax:u.yDomainMaxCallback?u.yDomainMaxCallback(W):W}},data:u.data};return u.yLabelFormatter&&(t.axis.y.labelFormatter=u.yLabelFormatter),u.colorField&&(t.colorField=u.colorField),(0,v.useEffect)(function(){(A==null?void 0:A.theme.algorithm)=="dark"?m("classicDark"):m("academy")},[A]),(0,C.jsx)(R.Z,r()({theme:M},t))}},24963:function(G,b,e){var T=e(67294),r=(0,T.createContext)({});b.Z=r},50070:function(G,b,e){e.r(b),e.d(b,{AppDetailContext:function(){return W},default:function(){return f}});var T=e(15009),r=e.n(T),x=e(99289),i=e.n(x),h=e(5574),g=e.n(h),R=e(1699),O=e(24963),v=e(60335),C=e(55809),E=e(90078),u=e(82346),j=e(25593),I=e(28036),L=e(50136),M=e(67294),m=e(85893),W=(0,M.createContext)({});function f(){var A,S=(0,M.useContext)(O.Z),F=S.lang,K=S.loading,o=S.message,t=(0,u.useParams)(),c=(0,u.useSearchParams)(),a=g()(c,2),ee=a[0],U=a[1],k=(A=ee.get("tab"))!==null&&A!==void 0?A:"edit",Z=(0,M.useState)("edit"),y=g()(Z,2),N=y[0],w=y[1],s=(0,u.useNavigate)(),Q=(0,M.useState)(1),z=g()(Q,2),B=z[0],J=z[1],V=[{label:(0,m.jsx)(u.Link,{to:"/app/detail/edit/".concat(t.id,"?tab=edit"),children:"\u5BB9\u5668\u8BE6\u60C5"}),key:"edit"},{label:(0,m.jsx)(u.Link,{to:"/app/detail/network/".concat(t.id,"?tab=network"),children:"\u7F51\u7EDC\u7BA1\u7406"}),key:"network"},{label:(0,m.jsx)(j.Z.Link,{children:"\u6587\u4EF6\u7BA1\u7406"}),key:"file",onClick:function(){o.info(F("app.detail.createExplorerPlugin")),s("/app/detail/file/".concat(t.id,"?tab=file"))}},{label:(0,m.jsx)(j.Z.Link,{children:"\u8FD0\u884C\u65E5\u5FD7"}),key:"log",onClick:function(){s("/app/detail/log/".concat(t.id,"?tab=log"))}},{label:(0,m.jsx)(j.Z.Link,{children:"\u8FD0\u884C\u72B6\u6001"}),key:"stat",onClick:function(){s("/app/detail/stat/".concat(t.id,"?tab=stat"))}},{label:"",key:"containerName",icon:(0,m.jsx)(C.Z,{}),disabled:!0}],X=(0,M.useState)(V),Y=g()(X,2),_=Y[0],ae=Y[1];(0,M.useEffect)(function(){K.show(),w(k);var $=function(){var P=i()(r()().mark(function l(){var n,D,p;return r()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n=V,d.prev=1,d.next=4,(0,v.jV)({md5:(D=t.id)!==null&&D!==void 0?D:""});case 4:p=d.sent,n.map(function(H){return H.key=="containerName"&&(H.label=p.data.info.Name),(!p.data.info.State.Running||p.data.info.State.Restarting)&&(H.key=="file"||H.key=="stat")&&(H.disabled=!0),H}),ae(n),d.next=13;break;case 9:return d.prev=9,d.t0=d.catch(1),s("/app/list"),d.abrupt("return");case 13:return d.prev=13,K.destroy(),d.finish(13);case 16:case"end":return d.stop()}},l,null,[[1,9,13,16]])}));return function(){return P.apply(this,arguments)}}();$()},[B,t]);var te=function(P){w(P.key)};return(0,m.jsx)(W.Provider,{value:{reload:function(){J(B+1)}},children:(0,m.jsxs)(E._z,{header:{extra:[(0,m.jsx)(R.u,{access:"canSeeContainerListManageCreate",children:(0,m.jsx)(u.Link,{to:"/app/create/image",children:(0,m.jsx)(I.ZP,{type:"primary",children:"\u521B\u5EFA\u5BB9\u5668"})})},"create")]},children:[(0,m.jsx)(L.Z,{mode:"horizontal",onClick:te,selectedKeys:[N],items:_}),(0,m.jsx)(u.Outlet,{})]})})}},41748:function(G,b,e){e.r(b),e.d(b,{default:function(){return ee}});var T=e(15009),r=e.n(T),x=e(99289),i=e.n(x),h=e(5574),g=e.n(h),R=e(19632),O=e.n(R),v=e(27619),C=e(67294);function E(U){var k=U.reqFunction,Z=U.interval,y=U.maxPolling,N=U.pollingStatus,w=U.inPath,s=(0,C.useRef)(null),Q=0,z=function J(){s.current=window.setTimeout(i()(r()().mark(function V(){var X;return r()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!(Q++>=y)){_.next=3;break}return B(),_.abrupt("return");case 3:if(_.prev=3,!(w&&window.location.href.indexOf(w)==-1)){_.next=7;break}return B(),_.abrupt("return");case 7:return _.next=9,k();case 9:X=_.sent,J(),_.next=17;break;case 13:_.prev=13,_.t0=_.catch(3),B(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",_.t0);case 17:case"end":return _.stop()}},V,null,[[3,13]])})),Z)},B=function(){console.log("end polling"),s.current&&window.clearTimeout(s.current)};return(0,C.useEffect)(function(){return console.log((N?"start":"waiting")+" polling, max "+y),N&&z(),function(){B()}},[Z,y,N]),{endPolling:B}}var u=E,j=e(24963),I=e(82346);function L(U){return M.apply(this,arguments)}function M(){return M=i()(r()().mark(function U(k){return r()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",(0,I.request)("/api/app/container/get-stat-info",{method:"POST",data:k}));case 1:case"end":return y.stop()}},U)})),M.apply(this,arguments)}function m(U){return W.apply(this,arguments)}function W(){return W=i()(r()().mark(function U(k){return r()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",(0,I.request)("/api/app/container/get-process-info",{method:"POST",data:k}));case 1:case"end":return y.stop()}},U)})),W.apply(this,arguments)}var f=e(5251),A=e(12122),S=e(60433),F=e(38345),K=e(60940),o=e(50070),t=e(85893),c=new Date().toLocaleTimeString(),a={total:0,memory:[{date:c,usage:0,source:{usage:0,limit:0}}],cpu:[{date:c,usage:0}],network:[{usage:0,type:"rx",date:c,source:{usage:0}},{usage:0,type:"tx",date:c,source:{usage:0}}],io:[{usage:0,type:"read",date:c,source:{usage:0}},{usage:0,type:"write",date:c,source:{usage:0}}]};function ee(){var U=function(l,n){switch(n.type){case"update":var D=new Date(n.payload.read).toLocaleTimeString(),p=n.payload.cpu_stats.cpu_usage.total_usage-n.payload.precpu_stats.cpu_usage.total_usage,q=n.payload.cpu_stats.system_cpu_usage-n.payload.precpu_stats.system_cpu_usage,d={total:l.total+1,memory:[],cpu:[].concat(O()(l.cpu),[{date:D,usage:p/q*n.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return n.payload.memory_stats&&n.payload.memory_stats.limit&&n.payload.memory_stats.usage&&(d.memory=[].concat(O()(l.memory),[{date:D,usage:Math.round(n.payload.memory_stats.usage),source:{usage:n.payload.memory_stats.usage,limit:n.payload.memory_stats.limit}}])),n.payload.networks&&(d.network=[].concat(O()(l.network),[{date:D,usage:parseFloat(n.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:n.payload.networks.eth0.rx_bytes}},{date:D,usage:parseFloat(n.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:n.payload.networks.eth0.tx_bytes}}])),n.payload.blkio_stats&&n.payload.blkio_stats.io_service_bytes_recursive&&n.payload.blkio_stats.io_service_bytes_recursive.length>0&&(d.io=[].concat(O()(l.io),[{date:D,usage:parseFloat(n.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:n.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:n.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:D,usage:parseFloat(n.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:n.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:n.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),d}},k=(0,C.useContext)(j.Z),Z=k.loading,y=(0,I.useParams)(),N=(0,C.useReducer)(U,a),w=g()(N,2),s=w[0],Q=w[1],z=(0,C.useState)(0),B=g()(z,2),J=B[0],V=B[1],X=(0,C.useState)(),Y=g()(X,2),_=Y[0],ae=Y[1],te=u({reqFunction:function(){var P=i()(r()().mark(function n(){var D,p;return r()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,L({id:(D=y.id)!==null&&D!==void 0?D:""});case 2:p=d.sent,Z.destroy(),Q({type:"update",payload:p});case 5:case"end":return d.stop()}},n)}));function l(){return P.apply(this,arguments)}return l}(),interval:3e3,maxPolling:999,pollingStatus:J!=0,inPath:"tab=stat"}),$=(0,C.useContext)(o.AppDetailContext);return(0,C.useEffect)(function(){$.reload()},[]),(0,C.useEffect)(function(){var P,l;Z.show(),L({id:(P=y.id)!==null&&P!==void 0?P:""}).then(function(n){return V(Math.round(n.memory_stats.limit)),!0}),m({id:(l=y.id)!==null&&l!==void 0?l:""}).then(function(n){var D={columns:[],data:[]};n.data.list.Titles.map(function(p){D.columns.push({title:p,label:p,dataIndex:p})}),n.data.list.Processes.map(function(p,q){D.data.push({UID:p[0],PID:p[1],PPID:p[2],C:p[3],STIME:p[4],TTY:p[5],TIME:p[6],CMD:p[7]})}),ae(D)})},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(F.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[s.memory&&s.memory.length>0&&(0,t.jsx)(F.Z,{colSpan:12,title:(0,t.jsx)(A.Z,{}),subTitle:"Memory usage: ".concat((0,f.FI)(s.memory[s.memory.length-1].source.usage)," / ").concat((0,f.FI)(s.memory[s.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(v.Z,{yField:"usage",xField:"date",data:s.memory,yDomainMaxCallback:function(l){return l*2},yLabelFormatter:function(l){return(0,f.FI)(parseFloat(l))}})}),(0,t.jsx)(F.Z,{colSpan:12,title:(0,t.jsx)(A.Z,{}),subTitle:"Cpu usage: ".concat(s.cpu[s.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,t.jsx)(v.Z,{yField:"usage",xField:"date",data:s.cpu,yDomainMaxCallback:function(l){return l*1.5},yLabelFormatter:function(l){return"".concat(l,"%")}})}),s.io&&s.io.length>0&&(0,t.jsx)(F.Z,{colSpan:12,title:(0,t.jsx)(A.Z,{}),subTitle:"I/O: ".concat((0,f.FI)(s.io[s.io.length-1].source.usage)," / ").concat((0,f.FI)(s.io[s.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(v.Z,{yField:"usage",xField:"date",colorField:"type",data:s.io,yDomainMaxCallback:function(l){return l*2},yLabelFormatter:function(l){return(0,f.FI)(parseFloat(l))}})}),s.network&&s.network.length>0&&(0,t.jsx)(F.Z,{colSpan:12,title:(0,t.jsx)(A.Z,{}),subTitle:"Network: ".concat((0,f.FI)(s.network[s.network.length-1].source.usage)," / ").concat((0,f.FI)(s.network[s.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(v.Z,{yField:"usage",xField:"date",colorField:"type",data:s.network,yDomainMaxCallback:function(l){return l*2},yLabelFormatter:function(l){return(0,f.FI)(parseFloat(l))}})})]}),(0,t.jsx)(F.Z,{title:(0,t.jsx)(S.Z,{}),subTitle:"Progress",children:(0,t.jsx)(K.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:_==null?void 0:_.columns,dataSource:_==null?void 0:_.data,pagination:{pageSize:10}})})]})}},60335:function(G,b,e){e.d(b,{IE:function(){return O},IW:function(){return g},KK:function(){return I},LJ:function(){return M},RF:function(){return A},Re:function(){return W},aF:function(){return F},eE:function(){return u},jV:function(){return C}});var T=e(15009),r=e.n(T),x=e(99289),i=e.n(x),h=e(82346);function g(o){return R.apply(this,arguments)}function R(){return R=i()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/status",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),R.apply(this,arguments)}function O(o){return v.apply(this,arguments)}function v(){return v=i()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/get-list",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},o)})),v.apply(this,arguments)}function C(o){return E.apply(this,arguments)}function E(){return E=i()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/get-detail",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},o)})),E.apply(this,arguments)}function u(o){return j.apply(this,arguments)}function j(){return j=i()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/update",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},o)})),j.apply(this,arguments)}function I(){return L.apply(this,arguments)}function L(){return L=i()(r()().mark(function o(){return r()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,h.request)("/api/app/container/prune",{method:"POST"}));case 1:case"end":return c.stop()}},o)})),L.apply(this,arguments)}function M(o){return m.apply(this,arguments)}function m(){return m=i()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/export",{method:"POST",data:t,responseType:"blob"}));case 1:case"end":return a.stop()}},o)})),m.apply(this,arguments)}function W(o){return f.apply(this,arguments)}function f(){return f=i()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/commit",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),f.apply(this,arguments)}function A(o){return S.apply(this,arguments)}function S(){return S=i()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/upgrade",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),S.apply(this,arguments)}function F(o){return K.apply(this,arguments)}function K(){return K=i()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/copy",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),K.apply(this,arguments)}}}]);
