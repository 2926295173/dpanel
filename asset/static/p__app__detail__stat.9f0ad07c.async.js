"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745,5947],{60433:function(Q,M,e){var T=e(87462),n=e(67294),A=e(69782),_=e(84089),f=function(j,b){return n.createElement(_.Z,(0,T.Z)({},j,{ref:b,icon:A.Z}))},P=n.forwardRef(f);M.Z=P},27619:function(Q,M,e){e.d(M,{Z:function(){return U}});var T=e(97857),n=e.n(T),A=e(19632),_=e.n(A),f=e(5574),P=e.n(f),k=e(64183),j=e(82346),b=e(67294),c=e(85893);function U(m){var S,w=(0,b.useState)("academy"),I=P()(w,2),D=I[0],F=I[1],L=Math.max.apply(Math,_()(m.data.map(function(d){var a;return(a=d[m.yField])!==null&&a!==void 0?a:0}))),i=(0,j.useModel)("@@initialState"),E=i.initialState,W=i.loading,x=i.error,O=i.refresh,o=i.setInitialState,t={xField:m.xField,yField:m.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:m.yLabelFormatter},scale:{y:{domainMin:(S=m.yDomainMin)!==null&&S!==void 0?S:0,domainMax:m.yDomainMax?m.yDomainMax:m.yDomainMaxCallback?m.yDomainMaxCallback(L):L}},data:m.data};return m.yLabelFormatter&&(t.axis.y.labelFormatter=m.yLabelFormatter),m.colorField&&(t.colorField=m.colorField),(0,b.useEffect)(function(){(E==null?void 0:E.theme.algorithm)=="dark"?F("classicDark"):F("academy")},[E]),(0,c.jsx)(k.Z,n()({theme:D},t))}},24963:function(Q,M,e){var T=e(67294),n=(0,T.createContext)({});M.Z=n},34548:function(Q,M,e){e.r(M),e.d(M,{AppDetailContext:function(){return E},default:function(){return W}});var T=e(15009),n=e.n(T),A=e(99289),_=e.n(A),f=e(5574),P=e.n(f),k=e(24963),j=e(60335),b=e(87462),c=e(67294),U=e(44805),m=e(84089),S=function(O,o){return c.createElement(m.Z,(0,b.Z)({},O,{ref:o,icon:U.Z}))},w=c.forwardRef(S),I=w,D=e(82346),F=e(25593),L=e(50136),i=e(85893),E=(0,c.createContext)({});function W(){var x,O=(0,c.useContext)(k.Z),o=O.lang,t=O.loading,d=O.message,a=(0,D.useParams)(),ae=(0,D.useSearchParams)(),g=P()(ae,2),Z=g[0],B=g[1],y=(x=Z.get("tab"))!==null&&x!==void 0?x:"edit",$=(0,c.useState)("edit"),K=P()($,2),u=K[0],V=K[1],G=(0,D.useNavigate)(),R=(0,c.useState)(1),N=P()(R,2),J=N[0],X=N[1],Y=[{label:(0,i.jsx)(D.Link,{to:"/app/detail/edit/".concat(a.id,"?tab=edit"),children:"\u5BB9\u5668\u8BE6\u60C5"}),key:"edit"},{label:(0,i.jsx)(D.Link,{to:"/app/detail/network/".concat(a.id,"?tab=network"),children:"\u7F51\u7EDC\u7BA1\u7406"}),key:"network"},{label:(0,i.jsx)(F.Z.Link,{children:"\u6587\u4EF6\u7BA1\u7406"}),key:"file",onClick:function(){d.info(o("app.detail.createExplorerPlugin")),G("/app/detail/file/".concat(a.id,"?tab=file"))}},{label:(0,i.jsx)(F.Z.Link,{children:"\u8FD0\u884C\u65E5\u5FD7"}),key:"log",onClick:function(){G("/app/detail/log/".concat(a.id,"?tab=log"))}},{label:(0,i.jsx)(F.Z.Link,{children:"\u8FD0\u884C\u72B6\u6001"}),key:"stat",onClick:function(){G("/app/detail/stat/".concat(a.id,"?tab=stat"))}},{label:"",key:"containerName",icon:(0,i.jsx)(I,{}),disabled:!0}],l=(0,c.useState)(Y),ee=P()(l,2),re=ee[0],te=ee[1];(0,c.useEffect)(function(){t.show(),V(y);var s=function(){var r=_()(n()().mark(function h(){var p,z,C;return n()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return z=Y,q.next=3,(0,j.jV)({md5:(p=a.id)!==null&&p!==void 0?p:""});case 3:C=q.sent,z.map(function(H){return H.key=="containerName"&&(H.label=C.data.info.Name),(!C.data.info.State.Running||C.data.info.State.Restarting)&&(H.key=="file"||H.key=="stat")&&(H.disabled=!0),H}),te(z),t.destroy();case 7:case"end":return q.stop()}},h)}));return function(){return r.apply(this,arguments)}}();s()},[J]);var v=function(r){V(r.key)};return(0,i.jsxs)(E.Provider,{value:{reload:function(){X(J+1)}},children:[(0,i.jsx)(L.Z,{mode:"horizontal",onClick:v,selectedKeys:[u],items:re}),(0,i.jsx)(D.Outlet,{})]})}},41748:function(Q,M,e){e.r(M),e.d(M,{default:function(){return ae}});var T=e(15009),n=e.n(T),A=e(99289),_=e.n(A),f=e(5574),P=e.n(f),k=e(19632),j=e.n(k),b=e(27619),c=e(67294);function U(g){var Z=g.reqFunction,B=g.interval,y=g.maxPolling,$=g.pollingStatus,K=g.inPath,u=(0,c.useRef)(null),V=0,G=function N(){u.current=window.setTimeout(_()(n()().mark(function J(){var X;return n()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(V++>=y)){l.next=3;break}return R(),l.abrupt("return");case 3:if(l.prev=3,!(K&&window.location.href.indexOf(K)==-1)){l.next=7;break}return R(),l.abrupt("return");case 7:return l.next=9,Z();case 9:X=l.sent,N(),l.next=17;break;case 13:l.prev=13,l.t0=l.catch(3),R(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",l.t0);case 17:case"end":return l.stop()}},J,null,[[3,13]])})),B)},R=function(){console.log("end polling"),u.current&&window.clearTimeout(u.current)};return(0,c.useEffect)(function(){return console.log(($?"start":"waiting")+" polling, max "+y),$&&G(),function(){R()}},[B,y,$]),{endPolling:R}}var m=U,S=e(24963),w=e(82346);function I(g){return D.apply(this,arguments)}function D(){return D=_()(n()().mark(function g(Z){return n()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",(0,w.request)("/api/app/container/get-stat-info",{method:"POST",data:Z}));case 1:case"end":return y.stop()}},g)})),D.apply(this,arguments)}function F(g){return L.apply(this,arguments)}function L(){return L=_()(n()().mark(function g(Z){return n()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",(0,w.request)("/api/app/container/get-process-info",{method:"POST",data:Z}));case 1:case"end":return y.stop()}},g)})),L.apply(this,arguments)}var i=e(5251),E=e(12122),W=e(60433),x=e(38345),O=e(63490),o=e(34548),t=e(85893),d=new Date().toLocaleTimeString(),a={total:0,memory:[{date:d,usage:0,source:{usage:0,limit:0}}],cpu:[{date:d,usage:0}],network:[{usage:0,type:"rx",date:d,source:{usage:0}},{usage:0,type:"tx",date:d,source:{usage:0}}],io:[{usage:0,type:"read",date:d,source:{usage:0}},{usage:0,type:"write",date:d,source:{usage:0}}]};function ae(){var g=function(s,r){switch(r.type){case"update":var h=new Date(r.payload.read).toLocaleTimeString(),p=r.payload.cpu_stats.cpu_usage.total_usage-r.payload.precpu_stats.cpu_usage.total_usage,z=r.payload.cpu_stats.system_cpu_usage-r.payload.precpu_stats.system_cpu_usage,C={total:s.total+1,memory:[],cpu:[].concat(j()(s.cpu),[{date:h,usage:p/z*r.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return r.payload.memory_stats&&r.payload.memory_stats.limit&&r.payload.memory_stats.usage&&(C.memory=[].concat(j()(s.memory),[{date:h,usage:Math.round(r.payload.memory_stats.usage),source:{usage:r.payload.memory_stats.usage,limit:r.payload.memory_stats.limit}}])),r.payload.networks&&(C.network=[].concat(j()(s.network),[{date:h,usage:parseFloat(r.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:r.payload.networks.eth0.rx_bytes}},{date:h,usage:parseFloat(r.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:r.payload.networks.eth0.tx_bytes}}])),r.payload.blkio_stats&&r.payload.blkio_stats.io_service_bytes_recursive&&r.payload.blkio_stats.io_service_bytes_recursive.length>0&&(C.io=[].concat(j()(s.io),[{date:h,usage:parseFloat(r.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:r.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:r.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:h,usage:parseFloat(r.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:r.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:r.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),C}},Z=(0,c.useContext)(S.Z),B=Z.loading,y=(0,w.useParams)(),$=(0,c.useReducer)(g,a),K=P()($,2),u=K[0],V=K[1],G=(0,c.useState)(0),R=P()(G,2),N=R[0],J=R[1],X=(0,c.useState)(),Y=P()(X,2),l=Y[0],ee=Y[1],re=m({reqFunction:function(){var v=_()(n()().mark(function r(){var h,p;return n()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,I({id:(h=y.id)!==null&&h!==void 0?h:""});case 2:p=C.sent,B.destroy(),V({type:"update",payload:p});case 5:case"end":return C.stop()}},r)}));function s(){return v.apply(this,arguments)}return s}(),interval:3e3,maxPolling:999,pollingStatus:N!=0,inPath:"tab=stat"}),te=(0,c.useContext)(o.AppDetailContext);return(0,c.useEffect)(function(){te.reload()},[]),(0,c.useEffect)(function(){var v,s;B.show(),I({id:(v=y.id)!==null&&v!==void 0?v:""}).then(function(r){return J(Math.round(r.memory_stats.limit)),!0}),F({id:(s=y.id)!==null&&s!==void 0?s:""}).then(function(r){var h={columns:[],data:[]};r.data.list.Titles.map(function(p){h.columns.push({title:p,label:p,dataIndex:p})}),r.data.list.Processes.map(function(p,z){h.data.push({UID:p[0],PID:p[1],PPID:p[2],C:p[3],STIME:p[4],TTY:p[5],TIME:p[6],CMD:p[7]})}),ee(h)})},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[u.memory&&u.memory.length>0&&(0,t.jsx)(x.Z,{colSpan:12,title:(0,t.jsx)(E.Z,{}),subTitle:"Memory usage: ".concat((0,i.FI)(u.memory[u.memory.length-1].source.usage)," / ").concat((0,i.FI)(u.memory[u.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(b.Z,{yField:"usage",xField:"date",data:u.memory,yDomainMaxCallback:function(s){return s*2},yLabelFormatter:function(s){return(0,i.FI)(parseFloat(s))}})}),(0,t.jsx)(x.Z,{colSpan:12,title:(0,t.jsx)(E.Z,{}),subTitle:"Cpu usage: ".concat(u.cpu[u.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,t.jsx)(b.Z,{yField:"usage",xField:"date",data:u.cpu,yDomainMaxCallback:function(s){return s*1.5},yLabelFormatter:function(s){return"".concat(s,"%")}})}),u.io&&u.io.length>0&&(0,t.jsx)(x.Z,{colSpan:12,title:(0,t.jsx)(E.Z,{}),subTitle:"I/O: ".concat((0,i.FI)(u.io[u.io.length-1].source.usage)," / ").concat((0,i.FI)(u.io[u.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(b.Z,{yField:"usage",xField:"date",colorField:"type",data:u.io,yDomainMaxCallback:function(s){return s*2},yLabelFormatter:function(s){return(0,i.FI)(parseFloat(s))}})}),u.network&&u.network.length>0&&(0,t.jsx)(x.Z,{colSpan:12,title:(0,t.jsx)(E.Z,{}),subTitle:"Network: ".concat((0,i.FI)(u.network[u.network.length-1].source.usage)," / ").concat((0,i.FI)(u.network[u.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(b.Z,{yField:"usage",xField:"date",colorField:"type",data:u.network,yDomainMaxCallback:function(s){return s*2},yLabelFormatter:function(s){return(0,i.FI)(parseFloat(s))}})})]}),(0,t.jsx)(x.Z,{title:(0,t.jsx)(W.Z,{}),subTitle:"Progress",children:(0,t.jsx)(O.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:l==null?void 0:l.columns,dataSource:l==null?void 0:l.data,pagination:{pageSize:10}})})]})}},60335:function(Q,M,e){e.d(M,{IE:function(){return j},IW:function(){return P},KK:function(){return w},LJ:function(){return D},RF:function(){return E},Re:function(){return L},aF:function(){return x},eE:function(){return m},jV:function(){return c}});var T=e(15009),n=e.n(T),A=e(99289),_=e.n(A),f=e(82346);function P(o){return k.apply(this,arguments)}function k(){return k=_()(n()().mark(function o(t){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.request)("/api/app/container/status",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),k.apply(this,arguments)}function j(o){return b.apply(this,arguments)}function b(){return b=_()(n()().mark(function o(t){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.request)("/api/app/container/get-list",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},o)})),b.apply(this,arguments)}function c(o){return U.apply(this,arguments)}function U(){return U=_()(n()().mark(function o(t){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.request)("/api/app/container/get-detail",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},o)})),U.apply(this,arguments)}function m(o){return S.apply(this,arguments)}function S(){return S=_()(n()().mark(function o(t){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.request)("/api/app/container/update",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},o)})),S.apply(this,arguments)}function w(){return I.apply(this,arguments)}function I(){return I=_()(n()().mark(function o(){return n()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,f.request)("/api/app/container/prune",{method:"POST"}));case 1:case"end":return d.stop()}},o)})),I.apply(this,arguments)}function D(o){return F.apply(this,arguments)}function F(){return F=_()(n()().mark(function o(t){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.request)("/api/app/container/export",{method:"POST",data:t,responseType:"blob"}));case 1:case"end":return a.stop()}},o)})),F.apply(this,arguments)}function L(o){return i.apply(this,arguments)}function i(){return i=_()(n()().mark(function o(t){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.request)("/api/app/container/commit",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),i.apply(this,arguments)}function E(o){return W.apply(this,arguments)}function W(){return W=_()(n()().mark(function o(t){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.request)("/api/app/container/upgrade",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),W.apply(this,arguments)}function x(o){return O.apply(this,arguments)}function O(){return O=_()(n()().mark(function o(t){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,f.request)("/api/app/container/copy",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),O.apply(this,arguments)}}}]);
