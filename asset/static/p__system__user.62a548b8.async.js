"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2958],{80821:function(ue,W,e){e.d(W,{Z:function(){return oe}});var K=e(97857),l=e.n(K),T=e(5574),h=e.n(T),Q=e(24963),B=e(36146),te=e(86738),V=e(83062),q=e(96074),y=e(83622),le=e(67294),N=e(85893);function oe(a){var fe=(0,le.useState)(!1),ae=h()(fe,2),_=ae[0],J=ae[1],me=(0,le.useContext)(Q.Z),ee=me.message,Y=new B.Uo,c=function(){J(!0);var E=a.action();E instanceof Promise?E.then(function(re){if(J(!1),re){typeof a.onSuccess=="function"&&a.onSuccess(re);var z="";a.messageSuccess?typeof a.messageSuccess=="function"?z=a.messageSuccess(re):z=a.messageSuccess.indexOf("notification.")==0?Y.format(a.messageSuccess):a.messageSuccess:z=Y.format("notification.finish"),a.asynced?ee.info(z):ee.success(z)}}).catch(function(re){J(!1),typeof a.onError=="function"&&a.onError(re)}):J(!1)};return a.confirm?(0,N.jsx)(te.Z,l()(l()({style:{width:500},title:a.confirmTitle?a.confirmTitle:Y.format("notification.title.tip"),description:typeof a.confirm=="string"&&a.confirm.indexOf("notification.")==0?Y.format(a.confirm):a.confirm,onConfirm:c,okText:"Yes",cancelText:"No",onOpenChange:a.confirmOnOpenChange},a.confirmProps),{},{children:(0,N.jsxs)(V.Z,{title:a.tips,children:[a.showDivider&&(0,N.jsx)(q.Z,{type:"vertical",style:{marginRight:15}}),(0,N.jsx)(y.ZP,{block:a.block,disabled:a.disabled,icon:!a.children&&_?void 0:a.icon,loading:_,danger:a.danger,type:a.type,children:a.children})]})})):(0,N.jsxs)(V.Z,{title:a.tips,children:[a.showDivider&&(0,N.jsx)(q.Z,{type:"vertical",style:{marginRight:15}}),(0,N.jsx)(y.ZP,{block:a.block,style:a.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:a.disabled,icon:!a.children&&_?void 0:a.icon,loading:_,onClick:c,danger:a.danger,type:a.type,children:a.children})]})}},3616:function(ue,W,e){e.d(W,{Ed:function(){return h},FK:function(){return l},R_:function(){return K},ob:function(){return T}});var K=window.innerWidth<=1024?"90vw":"65vw",l="90vw",T="60vw",h="50vh"},24963:function(ue,W,e){var K=e(67294),l=(0,K.createContext)({});W.Z=l},59549:function(ue,W,e){e.r(W),e.d(W,{default:function(){return Ve}});var K=e(15009),l=e.n(K),T=e(99289),h=e.n(T),Q=e(9783),B=e.n(Q),te=e(19632),V=e.n(te),q=e(80821),y=e(68602),le=e(67255),N=e(36693),oe=e(43425),a=e(88641),fe=e(90078),ae=e(56729),_=e(66309),J=e(42075),me=e(96074),ee=e(25593),Y=e(83062),c=e(67294),ve=e(5574),E=e.n(ve),re=e(83622),z=e(184),ce=e(5966),he=e(64317),Pe=e(52688),pe=e(90672),se=e(3616),M=e(83403),ye=e(87662),F=e(36146),r=e(85893),Ce=(0,c.forwardRef)(function(C,k){var L=(0,c.useState)(!1),m=E()(L,2),R=m[0],g=m[1],u=(0,c.useRef)(),i=new F.Uo("components.userInvite"),s=new F.Uo("system.user");(0,c.useImperativeHandle)(k,function(){return{edit:function(o){var f;(f=u.current)===null||f===void 0||f.setFieldsValue({username:o.username}),g(!0)},show:function(){var o;(o=u.current)===null||o===void 0||o.resetFields(),g(!0)}}}),c.useEffect(function(){if(R){var d;(d=u.current)===null||d===void 0||d.resetFields()}},[R,u]);var n=function(){var d=h()(l()().mark(function o(){var f,t,O,x,b,H;return l()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,(f=u.current)===null||f===void 0?void 0:f.validateFields();case 3:return t=S.sent,O={username:t.username,userRole:t.userRole||"member",email:t.email,userStatus:t.userStatus||"enable",securityPassword:t.securityPassword||!0},S.next=7,(0,y.mX)(O);case 7:if(x=S.sent,O.userRole==="manager"&&(0,y.SS)({username:O.username,menuPermissionNames:M.Wy}),O.userStatus==="disable"&&(0,y.az)({username:O.username,status:1}),!O.email){S.next=15;break}return S.next=13,(0,ye.pe)({groupName:"setting",name:"emailServer"});case 13:H=S.sent,(b=H.data)!==null&&b!==void 0&&(b=b.status)!==null&&b!==void 0&&b.includes("register")&&(0,y.sI)({username:O.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(x.data.token)});case 15:return C.onFinish&&C.onFinish(),S.abrupt("return",!0);case 19:return S.prev=19,S.t0=S.catch(0),S.abrupt("return",!1);case 22:case"end":return S.stop()}},o,null,[[0,19]])}));return function(){return d.apply(this,arguments)}}();return(0,r.jsxs)(z.a,{name:"create",title:i.format("drawerTitle"),open:R,onOpenChange:function(o){if(!o){var f;(f=u.current)===null||f===void 0||f.resetFields()}g(o)},drawerProps:{forceRender:!0,width:se.R_},formRef:u,trigger:(0,r.jsx)(re.ZP,{type:"primary",children:i.format("drawerTitle")}),onFinish:h()(l()().mark(function d(){return l()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,n();case 2:return f.abrupt("return",f.sent);case 3:case"end":return f.stop()}},d)})),children:[(0,r.jsx)(ce.Z,{label:i.format("formUsername"),name:"username",required:!0,rules:[{required:!0}]}),(0,r.jsx)(ce.Z,{label:i.format("formEmail"),name:"email",placeholder:"",rules:[{type:"email"}]}),(0,r.jsx)(he.Z,{label:i.format("formUserRole"),name:"userRole",tooltip:i.format("formUserRoleTip"),required:!0,fieldProps:{defaultValue:"member"},options:s.option("listUserRoleOption",["manager","member"])}),(0,r.jsx)(he.Z,{label:i.format("formUserStatus"),name:"userStatus",fieldProps:{defaultValue:"enable"},required:!0,options:s.option("listStatusOption",["enable","disable"])}),(0,r.jsx)(Pe.Z,{label:i.format("formSecurityPassword"),name:"securityPassword",fieldProps:{defaultChecked:!0}}),(0,r.jsx)(pe.Z,{label:i.format("formRemark"),name:"remark",fieldProps:{rows:4}})]})}),Oe=Ce,be=e(38345),we=e(63434),Ee=e(71230),De=e(15746),xe=e(84567),Ze=e(85265),Ue=e(82346),Te=(0,c.forwardRef)(function(C,k){(0,c.useImperativeHandle)(k,function(){return{show:function(p){return h()(l()().mark(function $(){var D,I,U,ie,Se,X,je;return l()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return U=p.username,ie=p.uri,(D=O.current)===null||D===void 0||D.resetFields(),g(U),n(ie),G.next=6,(0,y.q4)({username:U});case 6:if(Se=G.sent,X=(I=Se.data)===null||I===void 0||(I=I.permissions)===null||I===void 0?void 0:I[ie],!X){G.next=16;break}return G.next=11,(0,Ue.request)(X.uri,{method:"POST"});case 11:je=G.sent,S(je.data.list.filter(function(de){return X.value.includes(de[X.key])}).map(function(de){return{id:de[X.key],name:de[X.showKey]}})),j(X),G.next=17;break;case 16:S([]);case 17:t(!0);case 18:case"end":return G.stop()}},$)}))()}}});var L=(0,c.useState)(""),m=E()(L,2),R=m[0],g=m[1],u=(0,c.useState)(""),i=E()(u,2),s=i[0],n=i[1],d=(0,c.useState)(!1),o=E()(d,2),f=o[0],t=o[1],O=(0,c.useRef)(),x=(0,c.useRef)(),b=(0,c.useState)([]),H=E()(b,2),A=H[0],S=H[1],ne=(0,c.useState)(),Z=E()(ne,2),v=Z[0],j=Z[1],P=new F.Uo("components.userPermission");return(0,r.jsx)(Ze.Z,{title:P.format("permissionTitle"),open:f,width:se.R_,destroyOnHidden:!0,onClose:function(){var p;(p=O.current)===null||p===void 0||p.resetFields(),t(!1)},children:(0,r.jsx)(ae.Z,{actionRef:x,search:!1,toolBarRender:!1,scroll:{x:"max-content"},columns:[{key:"name",title:F.FD.format("listTitle"),dataIndex:"name"}],rowKey:"id",dataSource:A,rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},tableAlertOptionRender:function(p){var $=p.selectedRows;return(0,r.jsx)(J.Z,{size:16,wrap:!0,children:(0,r.jsx)(q.Z,{danger:!0,type:"primary",action:h()(l()().mark(function D(){return l()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.next=2,(0,y.V9)({username:R,permission:{uri:s,key:"-",value:$.map(function(ie){return ie.id}),showKey:"-"}});case 2:return U.abrupt("return",!0);case 3:case"end":return U.stop()}},D)})),onSuccess:function(){return t(!1),!0},confirm:"notification.confirm.title",children:F.FD.format("listManageDeleteBatch")})})},pagination:!1})})}),ge=Te,Ae=e(31199),Ie=(0,c.forwardRef)(function(C,k){(0,c.useImperativeHandle)(k,function(){return{show:function(t){return h()(l()().mark(function O(){var x,b;return l()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:b=t.formData,(x=d.current)===null||x===void 0||x.resetFields(),n(b),g(!0);case 4:case"end":return A.stop()}},O)}))()}}});var L=(0,c.useState)(!1),m=E()(L,2),R=m[0],g=m[1],u=(0,c.useState)({}),i=E()(u,2),s=i[0],n=i[1],d=(0,c.useRef)(),o=new F.Uo("components.userPermission");return(0,r.jsxs)(z.a,{title:o.format("permissionTitle"),open:R,width:se.R_,formRef:d,onFinish:function(){var f=h()(l()().mark(function t(O){return l()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return C.onChange(O),g(!1),b.abrupt("return",!0);case 3:case"end":return b.stop()}},t)}));return function(t){return f.apply(this,arguments)}}(),initialValues:s,drawerProps:{width:se.R_,destroyOnHidden:!0,onClose:function(){var t;(t=d.current)===null||t===void 0||t.resetFields(),g(!1)}},children:[(0,r.jsx)(Ae.Z,{name:"limit",label:o.format("formContainerLimit"),min:0}),(0,r.jsx)(ce.Z,{name:"name",hidden:!0})]})}),Me=Ie,Fe=e(24963),Le=e(60532),$e=e(60433),Re=e(25449),We=(0,c.forwardRef)(function(C,k){(0,c.useImperativeHandle)(k,function(){return{edit:function(v){return h()(l()().mark(function j(){var P,w,p;return l()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return(P=i.current)===null||P===void 0||P.setFieldValue("username",v),D.next=3,(0,y.J5)({username:v});case 3:w=D.sent,w.data.resource?(p={},w.data.resource.forEach(function(I){p[I.name]=I}),S(p)):S({}),w.data.menus?(w.data.menus.map(function(I){var U;(U=i.current)===null||U===void 0||U.setFieldValue(["permission",I],!0)}),x([].concat(V()(w.data.menus||[]),V()(M.Io)))):x(M.Io),u(!0);case 7:case"end":return D.stop()}},j)}))()}}});var L={canSeeContainerList:M.W6.CONTAINER,canSeeImageRegistry:M.W6.REGISTRY,canSeeComposeList:M.W6.COMPOSE,canSeeSystemAppstore:M.W6.APPSTORE,canSeeSystemEnv:M.W6.DOCKER_ENV},m=(0,c.useState)(!1),R=E()(m,2),g=R[0],u=R[1],i=(0,c.useRef)(),s=(0,c.useContext)(Fe.Z),n=s.message,d=(0,c.useRef)(),o=(0,c.useRef)(),f=(0,c.useState)([]),t=E()(f,2),O=t[0],x=t[1],b=(0,c.useState)({}),H=E()(b,2),A=H[0],S=H[1],ne=new F.Uo("components.userPermission");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(z.a,{title:ne.format("drawerTitle"),open:g,onOpenChange:function(v){var j;!v&&((j=i.current)===null||j===void 0||j.resetFields()),u(v)},drawerProps:{forceRender:!0,width:se.R_},layout:"inline",formRef:i,onValuesChange:function(v,j){var P=Object.keys(v.permission)[0];if(v.permission[P]===!1){for(var w in j.permission)if(w.startsWith(P)){var p;(p=i.current)===null||p===void 0||p.setFieldValue(["permission",w],!1)}}x(Object.keys(j.permission).filter(function($){return j.permission[$]}))},onFinish:function(){var Z=h()(l()().mark(function v(j){var P;return l()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return P=j.permission&&Object.keys(j.permission).filter(function($){return j.permission[$]&&!M.Io.includes($)}),P.push.apply(P,V()(M.Io.filter(function($){return P.some(function(D){return D.startsWith($)})}))),p.next=4,(0,y.SS)({username:j.username,menuPermissionNames:P,resources:Object.values(A)});case 4:return n.success(F.FD.format("finish")),p.abrupt("return",!0);case 6:case"end":return p.stop()}},v)}));return function(v){return Z.apply(this,arguments)}}(),children:[(0,r.jsx)(ge,{ref:d}),(0,r.jsx)(ce.Z,{name:"username",hidden:!0}),M.d0.map(function(Z){return(0,r.jsxs)(be.Z,{headerBordered:!0,ghost:!0,bodyStyle:{paddingTop:10,paddingBottom:20},title:(0,r.jsx)(Le.Z,{}),subTitle:ne.format(Z.group),children:[(0,r.jsx)(we.Z,{name:["permission",Z.group],valuePropName:"checked",initialValue:!0,hidden:!0}),(0,r.jsx)(Ee.Z,{gutter:[16,16],children:Z.permissions.map(function(v){return(0,r.jsx)(De.Z,{span:6,children:(0,r.jsxs)(Re.Z,{children:[(0,r.jsx)(Re.Z,{noStyle:!0,name:["permission",v],valuePropName:"checked",children:(0,r.jsx)(xe.Z,{disabled:!O.includes(v.substring(0,v.search(/[A-Z][^A-Z]*$/))),children:ne.format(v)})}),L[v]&&(0,r.jsx)(Y.Z,{title:ne.format("dataPermissionButton"),children:(0,r.jsx)(ee.Z.Link,{onClick:function(){var P,w;(P=d.current)===null||P===void 0||P.show({username:((w=i.current)===null||w===void 0?void 0:w.getFieldValue("username"))||"",uri:L[v]||""})},children:(0,r.jsx)($e.Z,{})})}),["canSeeContainerListManageCreate"].includes(v)&&(0,r.jsx)(Y.Z,{title:ne.format("resourcePermssionButton"),children:(0,r.jsx)(ee.Z.Link,{onClick:function(){var P;(P=o.current)===null||P===void 0||P.show({formData:A[v]||{name:v,limit:0}})},children:(0,r.jsx)(oe.Z,{})})})]})},v)})})]},Z.group)})]}),(0,r.jsx)(ge,{ref:d}),(0,r.jsx)(Me,{onChange:function(v){var j;A[v.name]=v,(0,y.SS)({username:((j=i.current)===null||j===void 0?void 0:j.getFieldValue("username"))||"",menuPermissionNames:O,resources:Object.values(A)})},resourcePermissionsData:A,ref:o})]})}),Ke=We,Be=e(5251);function Ve(){var C=(0,c.useRef)(),k=(0,c.useRef)(),L=(0,c.useRef)(),m=new F.Uo("system.user");return(0,r.jsxs)(fe._z,{header:{extra:[(0,r.jsx)(Oe,{ref:k,onFinish:function(){var g,u;!((g=C.current)===null||g===void 0)&&g.reloadAndRest&&((u=C.current)===null||u===void 0||u.reloadAndRest())}},"invite-user")]},children:[(0,r.jsx)(Ke,{ref:L}),(0,r.jsx)(ae.Z,{scroll:{x:"max-content"},rowKey:"username",columns:[{title:F.FD.format("listUsername"),ellipsis:!0,dataIndex:"username"},{title:m.format("listEmail"),ellipsis:!0,dataIndex:"email"},{title:m.format("listUserRole"),ellipsis:!0,width:100,dataIndex:"userRole",valueEnum:Object.assign.apply(Object,[{}].concat(V()(m.option("listUserRoleOption",["manager","member"]).map(function(R){return B()({},R.value,{text:R.label,status:R.value})})))),render:function(g,u){return(0,r.jsx)(_.Z,{color:m.format("listUserRoleColor."+u.userRole),children:m.format("listUserRoleOption."+u.userRole)})}},{title:m.format("listRegisterAt"),ellipsis:!0,render:function(g,u,i,s){return(0,r.jsx)("div",{children:(0,Be.ZM)(u.registerAt*1e3)},u.username)},search:!1},{title:m.format("listRemark"),ellipsis:!0,dataIndex:"remark",search:!1},{title:m.format("listStatus"),width:100,dataIndex:"status",search:!1,render:function(g,u){return(0,r.jsx)(_.Z,{color:m.format("listStatusColor."+u.status),children:m.format("listStatusOption."+u.status)})}},{title:F.FD.format("listManage"),width:100,search:!1,fixed:"right",render:function(g,u,i){return(0,r.jsxs)(J.Z,{split:(0,r.jsx)(me.Z,{type:"vertical"}),children:[(0,r.jsx)(ee.Z.Link,{copyable:{tooltips:m.format("listManageCopyUrl"),icon:[(0,r.jsx)(N.Z,{})],text:function(){var s=h()(l()().mark(function d(){var o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,y.u1)({username:u.username});case 2:return o=t.sent,t.abrupt("return","".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(o.data.token));case 4:case"end":return t.stop()}},d)}));function n(){return s.apply(this,arguments)}return n}()},style:{color:"inherit"}},"copy-"+i),(0,r.jsx)(Y.Z,{title:m.format("listManageSetting"),children:(0,r.jsx)(ee.Z.Link,{onClick:function(){var n;(n=L.current)===null||n===void 0||n.edit(u.username)},children:(0,r.jsx)(oe.Z,{})})}),(0,r.jsx)(q.Z,{ghost:!0,type:"link",tips:m.format("listManageSendEmail"),icon:(0,r.jsx)(a.Z,{}),action:h()(l()().mark(function s(){var n;return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,y.u1)({username:u.username});case 2:return n=o.sent,o.abrupt("return",(0,y.sI)({username:u.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(n.data.token)}));case 4:case"end":return o.stop()}},s)}))})]})}}],request:function(){var R=h()(l()().mark(function g(u){var i;return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,y.lE)();case 2:return i=n.sent,n.abrupt("return",{data:i.data.list,success:!0,total:i.data.list.length});case 4:case"end":return n.stop()}},g)}));return function(g){return R.apply(this,arguments)}}(),rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},actionRef:C,tableAlertOptionRender:function(g){var u=g.selectedRowKeys;return(0,r.jsxs)(J.Z,{size:16,children:[(0,r.jsx)(q.Z,{action:h()(l()().mark(function i(){var s,n,d,o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:s=0,n=u;case 1:if(!(s<n.length)){t.next=9;break}return d=n[s],t.next=5,(0,y.az)({username:d,status:2});case 5:o=t.sent;case 6:s++,t.next=1;break;case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},i)})),onSuccess:function(){var s,n;return!((s=C.current)===null||s===void 0)&&s.reloadAndRest&&((n=C.current)===null||n===void 0||n.reloadAndRest()),!0},onError:function(){var s,n;return!((s=C.current)===null||s===void 0)&&s.reset&&((n=C.current)===null||n===void 0||n.reset()),!0},children:m.format("listManageEnable")},"batchEnable"),(0,r.jsx)(q.Z,{danger:!0,action:h()(l()().mark(function i(){var s,n,d,o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:s=0,n=u;case 1:if(!(s<n.length)){t.next=9;break}return d=n[s],t.next=5,(0,y.az)({username:d,status:1});case 5:o=t.sent;case 6:s++,t.next=1;break;case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},i)})),onSuccess:function(){var s,n;return!((s=C.current)===null||s===void 0)&&s.reloadAndRest&&((n=C.current)===null||n===void 0||n.reloadAndRest()),!0},onError:function(){var s,n;return!((s=C.current)===null||s===void 0)&&s.reset&&((n=C.current)===null||n===void 0||n.reset()),!0},children:m.format("listManageDisable")},"batchDisable")]})},pagination:(0,le.O)()})]})}},67255:function(ue,W,e){e.d(W,{O:function(){return K},j:function(){return l}});function K(T){var h=localStorage.getItem("dpanel-pagesize");return h=="all"?!1:{defaultCurrent:T==null?void 0:T.page,showSizeChanger:!0,defaultPageSize:parseInt(h!=null?h:"20"),onChange:function(B,te){localStorage.setItem("dpanel-page-"+location.pathname.split("/").slice(-2).join("-"),"".concat(B))}}}function l(T){var h="dpanel-table-column-".concat(T),Q={};if(localStorage.getItem(h)){var B;Q=JSON.parse((B=localStorage.getItem(h))!==null&&B!==void 0?B:"{}")}return{defaultValue:Q,onChange:function(V){localStorage.setItem("dpanel-table-column-".concat(T),JSON.stringify(V))}}}}}]);
