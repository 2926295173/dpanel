"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7499],{43774:function(oe,N,t){t.r(N),t.d(N,{default:function(){return ye}});var J=t(5574),h=t.n(J),Q=t(24963),x=t(15078),E=t(90078),U=t(97269),L=t(62370),H=t(97462),O=t(38345),re=t(45360),C=t(42075),V=t(65233),z=t(28036),X=t(92398),B=t(2487),Y=t(86250),P=t(32983),m=t(4393),r=t(67294),Z=t(15009),n=t.n(Z),le=t(99289),k=t.n(le),ce=t(184),de=t(5966),q=t(51652),K=t(71230),S=t(15746),he=t(34041),me=t(74842),_=t(25593),pe=t(83062),se=t(66309),e=t(85893);function ie(a){var A=(0,r.useState)(),p=h()(A,2),c=p[0],f=p[1];return(0,r.useEffect)(function(){var F=a.url.substring(0,a.url.indexOf("://"));switch(F){case"image":f((0,e.jsx)("img",{width:a.imageSize?a.imageSize.width:"auto",height:a.imageSize?a.imageSize.height:"auto",src:a.url.replace("image://","/dpanel/static/store/file/")}));break;case"http":case"https":f((0,e.jsx)("img",{width:a.imageSize?a.imageSize.width:"auto",height:a.imageSize?a.imageSize.height:"auto",src:a.url}));break;case"markdown-file":(0,x.yL)({path:a.url.replace("markdown-file://","/dpanel/static/store/file/")}).then(function(T){f((0,e.jsx)(q.Z,{source:T,style:{padding:5}},"content"))});break;case"markdown":f((0,e.jsx)(q.Z,{source:a.url.replace("markdown://",""),style:{padding:5}},"content"));break;default:f("")}},[a.url]),(0,e.jsx)(e.Fragment,{children:c})}function ue(a){return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(K.Z,{gutter:[10,10],children:[(0,e.jsx)(S.Z,{span:6,children:(0,e.jsx)(ie,{url:a.app.logo,imageSize:a.logoSize})}),(0,e.jsxs)(S.Z,{span:a.extra?12:18,children:[(0,e.jsx)(K.Z,{children:(0,e.jsx)(S.Z,{span:24,children:(0,e.jsxs)(C.Z,{direction:"horizontal",children:[(0,e.jsx)(_.Z.Title,{level:5,children:(0,e.jsx)("a",{href:a.app.website,target:"_blank",children:a.app.title})}),(0,e.jsx)(_.Z.Text,{children:a.app.name})]})})}),(0,e.jsx)(K.Z,{style:{height:"60px"},children:(0,e.jsx)(S.Z,{children:(0,e.jsx)(pe.Z,{title:a.app.description,children:(0,e.jsx)(_.Z.Paragraph,{ellipsis:{rows:2},children:a.app.description})})})}),(0,e.jsx)(K.Z,{style:{height:"35px"},children:(0,e.jsx)(S.Z,{children:(0,e.jsxs)(C.Z,{wrap:!0,children:[a.app.storeName?(0,e.jsx)(se.Z,{color:"blue-inverse",children:a.app.storeName}):"",a.app.tag&&a.app.tag.map(function(A,p){return(0,e.jsx)(se.Z,{children:A},p)})]})})})]}),(0,e.jsx)(S.Z,{span:a.extra?6:0,children:a.extra})]})})}var fe=t(80821),ve=t(90098),ee=t(82346),ge=t(58010),je=t(3616),xe=(0,r.forwardRef)(function(a,A){var p=(0,r.useState)(!1),c=h()(p,2),f=c[0],F=c[1],T=(0,r.useState)(),te=h()(T,2),o=te[0],W=te[1],v=(0,r.useState)(""),y=h()(v,2),I=y[0],M=y[1],ne=(0,ee.useNavigate)(),D=(0,r.useRef)(),w=(0,r.useRef)(),$=(0,r.useState)(),l=h()($,2),u=l[0],g=l[1];return(0,r.useImperativeHandle)(A,function(){return{show:function(s){F(!0),W(s),M(Object.keys(s.version)[0])}}}),(0,e.jsxs)(ce.a,{drawerProps:{width:je.R_},submitter:!1,open:f,onOpenChange:function(s){var d;F(s),(d=D.current)===null||d===void 0||d.resetFields()},title:"".concat(o==null?void 0:o.name," \u8BE6\u60C5\u4ECB\u7ECD"),children:[(0,e.jsx)(ge.Z,{showBackListButton:!0,ref:w,onDeployFinish:function(){ne("/compose/list")},onDeployFailed:function(){var i=k()(n()().mark(function s(d){return n()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:case"end":return j.stop()}},s)}));return function(s){return i.apply(this,arguments)}}(),onClose:k()(n()().mark(function i(){return n()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:case"end":return d.stop()}},i)}))}),o&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(O.Z,{ghost:!0,style:{marginBottom:"20px",paddingBottom:"20px",borderBottom:"#eeeeee solid 1px"},children:(0,e.jsx)(ue,{app:o,logoSize:{width:"130",height:"130"},extra:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(K.Z,{gutter:[10,10],children:[(0,e.jsx)(S.Z,{span:24,children:(0,e.jsx)(fe.Z,{block:!0,type:"primary",action:k()(n()().mark(function i(){var s,d,G,j,ae;return n()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,(0,ve.iE)({storeId:(s=o.storeId)!==null&&s!==void 0?s:0,name:(d=(G=D.current)===null||G===void 0?void 0:G.getFieldValue("name"))!==null&&d!==void 0?d:"".concat(o.name,"-%CURRENT_DATE%"),appName:o.name,title:o.title,composeFile:o.version[I].composeFile,environment:o.version[I].environment});case 2:j=b.sent,j&&j.data.id&&(g(j.data.id),(ae=w.current)===null||ae===void 0||ae.show(j.data.id));case 4:case"end":return b.stop()}},i)})),icon:(0,e.jsx)(me.Z,{}),confirm:(0,e.jsx)(U.A,{submitter:!1,formRef:D,layout:"horizontal",isKeyPressSubmit:!0,children:(0,e.jsx)(de.Z,{placeholder:"\u9ED8\u8BA4\u81EA\u52A8\u751F\u6210\u6807\u8BC6",width:"md",label:"\u81EA\u5B9A\u4E49\u4EFB\u52A1\u6807\u8BC6",name:"name"})}),children:"\u90E8\u7F72"},"deploy")}),(0,e.jsx)(S.Z,{span:24,children:o.version&&(0,e.jsx)(he.Z,{style:{width:"100%"},value:I,onChange:function(s){M(s)},options:Object.keys(o.version).map(function(i){return{value:i,label:i}})})})]})})})}),Object.keys(o.version).map(function(i){if(!(I!=i||!o.version[i].environment||o.version[i].environment.length==0)){var s="";return s+="## \u7248\u672C\u4FE1\u606F <sup>".concat(i,`</sup> 
 |\u53D8\u91CF\u540D|\u9ED8\u8BA4\u503C|\u8BF4\u660E| 
 |---|---|---|
`),o.version[i].environment.map(function(d){s+="|".concat(d.name,"|").concat(d.value,"|").concat(d.label,`| 
`)}),s+="<br />",(0,e.jsx)(q.Z,{source:s,style:{padding:5}},i)}}),(0,e.jsx)(ie,{url:o==null?void 0:o.content})]})]})}),Se=xe,R="dpanel-search-result";function ye(){var a=(0,r.useRef)(),A=(0,r.useState)(),p=h()(A,2),c=p[0],f=p[1],F=(0,r.useContext)(Q.Z),T=F.loading,te=F.lang,o=(0,r.useState)(""),W=h()(o,2),v=W[0],y=W[1],I=(0,r.useState)([]),M=h()(I,2),ne=M[0],D=M[1],w=(0,ee.useLocation)();(0,r.useEffect)(function(){T.show(),(0,x.eO)().then(function(l){l&&l.data&&l.data.list&&l.data.list.push({id:-1,name:R,title:"\u641C\u7D22\u7ED3\u679C",setting:{apps:[]}}),f(Object.fromEntries(l.data.list.map(function(u){return[u.name,u]}))),w.state&&w.state.name?y(w.state.name):l.data.list.length>0&&y(l.data.list[0].name)}).finally(function(){T.destroy()})},[]);var $=function(u){var g=[];u=u.toLowerCase(),c&&(Object.keys(c).map(function(i){i!=R&&c[i].setting.apps&&c[i].setting.apps.map(function(s){if(u&&(s.name.toLowerCase().indexOf(u)!==-1||s.title&&s.title.toLowerCase().indexOf(u)!==-1||s.description&&s.description.toLocaleLowerCase().indexOf(u)!==-1)){var d=JSON.parse(JSON.stringify(s));d.storeName="".concat(c[i].title),d.storeId=c[i].id,g.push(d)}})}),g.length>0?(D(g),y(R)):(re.ZP.error("\u672A\u80FD\u627E\u5230\u5305\u542B\u5173\u952E\u5B57\u7684\u5E94\u7528"),y(Object.keys(c)[0]),D([])))};return(0,e.jsxs)(E._z,{extra:[(0,e.jsx)(U.A,{isKeyPressSubmit:!0,submitter:!1,onFinish:function(u){$(u.search)},children:(0,e.jsxs)(C.Z.Compact,{children:[(0,e.jsx)(L.Z,{style:{margin:0},name:"search",children:(0,e.jsx)(V.Z,{allowClear:!0,addonBefore:"\u5168\u5546\u5E97\u67E5\u8BE2",placeholder:"\u6309\u56DE\u8F66\u67E5\u8BE2\u5E94\u7528",onClear:function(){$("")}})}),(0,e.jsx)(H.Z,{name:["search"],children:function(u){var g=u.search;return(0,e.jsx)(z.ZP,{onClick:function(){$(g)},children:"\u641C\u7D22"})}})]})},"form")],children:[(0,e.jsx)(Se,{ref:a}),(0,e.jsxs)(O.Z,{children:[v!=""&&c&&(0,e.jsx)(X.Z,{activeKey:v,onChange:function(u){D([]),y(u)},items:Object.keys(c).map(function(l){return{label:c[l].title,key:l,disabled:v!=R&&l==R}})}),(0,e.jsx)(B.Z,{locale:{emptyText:(0,e.jsx)(Y.Z,{justify:"center",style:{height:"40vh"},vertical:!0,children:(0,e.jsx)(P.Z,{image:P.Z.PRESENTED_IMAGE_SIMPLE,description:(0,e.jsxs)(e.Fragment,{children:["\u9762\u677F\u652F\u6301\u591A\u79CD\u7C7B\u578B\u7684\u7B2C\u4E09\u65B9\u5E94\u7528\u5546\u5E97\uFF0C",(0,e.jsx)(ee.Link,{to:"/system/appstore?op=create",children:"\u8BF7\u5148\u6DFB\u52A0\u7B2C\u4E09\u65B9\u5546\u5E97"})]})})})},pagination:{pageSize:36},rowKey:function(u){return"".concat(u.name).concat(u.storeName)},grid:{gutter:10,xs:1,sm:2,md:2,lg:2,xl:2,xxl:3},dataSource:v==R?ne:c&&c[v]&&c[v].setting.apps,renderItem:function(u,g){return(0,e.jsx)(B.Z.Item,{children:(0,e.jsx)(m.Z,{onClick:function(){if(c){var s;u.storeId||(u.storeId=c[v].id),(s=a.current)===null||s===void 0||s.show(u)}},hoverable:!0,children:(0,e.jsx)(ue,{app:u,logoSize:{width:"50",height:"50"}})})},g)}})]})]})}},15078:function(oe,N,t){t.d(N,{$c:function(){return U},Me:function(){return X},eO:function(){return V},ks:function(){return H},yL:function(){return Y}});var J=t(15009),h=t.n(J),Q=t(99289),x=t.n(Q),E=t(82346);function U(m){return L.apply(this,arguments)}function L(){return L=x()(h()().mark(function m(r){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,E.request)("/api/common/store/create",{method:"POST",data:r}));case 1:case"end":return n.stop()}},m)})),L.apply(this,arguments)}function H(m){return O.apply(this,arguments)}function O(){return O=x()(h()().mark(function m(r){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,E.request)("/api/common/store/sync",{method:"POST",data:r}));case 1:case"end":return n.stop()}},m)})),O.apply(this,arguments)}function re(m){return C.apply(this,arguments)}function C(){return C=_asyncToGenerator(_regeneratorRuntime().mark(function m(r){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",request("/api/common/store/get-detail",{method:"POST",data:r}));case 1:case"end":return n.stop()}},m)})),C.apply(this,arguments)}function V(m){return z.apply(this,arguments)}function z(){return z=x()(h()().mark(function m(r){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,E.request)("/api/common/store/get-list",{method:"POST",data:r}));case 1:case"end":return n.stop()}},m)})),z.apply(this,arguments)}function X(m){return B.apply(this,arguments)}function B(){return B=x()(h()().mark(function m(r){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,E.request)("/api/common/store/delete",{method:"POST",data:r});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},m)})),B.apply(this,arguments)}function Y(m){return P.apply(this,arguments)}function P(){return P=x()(h()().mark(function m(r){return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,E.request)(r==null?void 0:r.path,{method:"GET"}));case 1:case"end":return n.stop()}},m)})),P.apply(this,arguments)}}}]);
