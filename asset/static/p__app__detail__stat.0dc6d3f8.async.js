"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745],{55809:function(N,D,e){var C=e(87462),t=e(67294),x=e(44805),_=e(84089),y=function(O,f){return t.createElement(_.Z,(0,C.Z)({},O,{ref:f,icon:x.Z}))},g=t.forwardRef(y);D.Z=g},60433:function(N,D,e){var C=e(87462),t=e(67294),x=e(69782),_=e(84089),y=function(O,f){return t.createElement(_.Z,(0,C.Z)({},O,{ref:f,icon:x.Z}))},g=t.forwardRef(y);D.Z=g},1699:function(N,D,e){e.d(D,{u:function(){return M}});var C=e(9783),t=e.n(C),x=e(97857),_=e.n(x),y=e(67294),g=e(82346),L=e(40411),O=e(42075),f=e(85893),M=function(n){var P=(0,g.useAccess)(),U=Array.isArray(n.access)?n.access:[n.access],c,E=n.fallback;return typeof n.children=="function"?(c=n.children(U.reduce(function(d,R){return _()(_()({},d),{},t()({},R,P[R]))},{})),c||(c=E)):U.every(function(d){return P[d]})?c=n.children:c=E,!E&&c&&n.showProTips&&P.canSeeEnableCe&&(c=(0,f.jsx)(L.Z,{offset:n.showProTipsOffset,count:"PRO",color:"gold",style:{fontWeight:"bold"},children:c})),!E&&c&&n.showProRibbonTips&&P.canSeeEnableCe&&(c=(0,f.jsx)(L.Z.Ribbon,{text:"PRO",color:"gold",style:{fontWeight:"bold"},children:c})),n.space?(0,f.jsx)(O.Z,_()(_()({},n.space),{},{children:c})):c}},27619:function(N,D,e){e.d(D,{Z:function(){return B}});var C=e(97857),t=e.n(C),x=e(19632),_=e.n(x),y=e(5574),g=e.n(y),L=e(64183),O=e(82346),f=e(67294),M=e(85893);function B(n){var P,U=(0,f.useState)("academy"),c=g()(U,2),E=c[0],d=c[1],R=Math.max.apply(Math,_()(n.data.map(function(p){var a;return(a=p[n.yField])!==null&&a!==void 0?a:0}))),h=(0,O.useModel)("@@initialState"),j=h.initialState,$=h.loading,W=h.error,A=h.refresh,i=h.setInitialState,r={xField:n.xField,yField:n.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:n.yLabelFormatter},scale:{y:{domainMin:(P=n.yDomainMin)!==null&&P!==void 0?P:0,domainMax:n.yDomainMax?n.yDomainMax:n.yDomainMaxCallback?n.yDomainMaxCallback(R):R}},data:n.data};return n.yLabelFormatter&&(r.axis.y.labelFormatter=n.yLabelFormatter),n.colorField&&(r.colorField=n.colorField),(0,f.useEffect)(function(){(j==null?void 0:j.theme.algorithm)=="dark"?d("classicDark"):d("academy")},[j]),(0,M.jsx)(L.Z,t()({theme:E},r))}},24963:function(N,D,e){var C=e(67294),t=(0,C.createContext)({});D.Z=t},50070:function(N,D,e){e.r(D),e.d(D,{AppDetailContext:function(){return R},default:function(){return h}});var C=e(15009),t=e.n(C),x=e(99289),_=e.n(x),y=e(5574),g=e.n(y),L=e(1699),O=e(24963),f=e(60335),M=e(55809),B=e(90078),n=e(82346),P=e(25593),U=e(28036),c=e(50136),E=e(67294),d=e(85893),R=(0,E.createContext)({});function h(){var j,$=(0,E.useContext)(O.Z),W=$.loading,A=(0,n.useParams)(),i=(0,n.useSearchParams)(),r=g()(i,2),p=r[0],a=r[1],ae=(j=p.get("tab"))!==null&&j!==void 0?j:"edit",T=(0,E.useState)("edit"),S=g()(T,2),w=S[0],v=S[1],K=(0,n.useNavigate)(),z=(0,E.useState)(1),o=g()(z,2),J=o[0],H=o[1],F=[{label:(0,d.jsx)(n.Link,{to:"/app/detail/edit/".concat(A.id,"?tab=edit"),children:"\u5BB9\u5668\u8BE6\u60C5"}),key:"edit"},{label:(0,d.jsx)(n.Link,{to:"/app/detail/network/".concat(A.id,"?tab=network"),children:"\u7F51\u7EDC\u7BA1\u7406"}),key:"network"},{label:(0,d.jsx)(P.Z.Link,{children:"\u6587\u4EF6\u7BA1\u7406"}),key:"file",onClick:function(){K("/app/detail/file/".concat(A.id,"?tab=file"))}},{label:(0,d.jsx)(P.Z.Link,{children:"\u8FD0\u884C\u65E5\u5FD7"}),key:"log",onClick:function(){K("/app/detail/log/".concat(A.id,"?tab=log"))}},{label:(0,d.jsx)(P.Z.Link,{children:"\u8FD0\u884C\u72B6\u6001"}),key:"stat",onClick:function(){K("/app/detail/stat/".concat(A.id,"?tab=stat"))}},{label:"",key:"containerName",icon:(0,d.jsx)(M.Z,{}),disabled:!0}],V=(0,E.useState)(F),Y=g()(V,2),Q=Y[0],X=Y[1];(0,E.useEffect)(function(){W.show(),v(ae);var G=function(){var q=_()(t()().mark(function ee(){var b,u,s;return t()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return b=F,l.prev=1,l.next=4,(0,f.jV)({md5:(u=A.id)!==null&&u!==void 0?u:""});case 4:s=l.sent,b.map(function(k){return k.key=="containerName"&&(k.label=s.data.info.Name),(!s.data.info.State.Running||s.data.info.State.Restarting)&&(k.key=="file"||k.key=="stat")&&(k.disabled=!0),k}),X(b),l.next=13;break;case 9:return l.prev=9,l.t0=l.catch(1),K("/app/list"),l.abrupt("return");case 13:return l.prev=13,W.destroy(),l.finish(13);case 16:case"end":return l.stop()}},ee,null,[[1,9,13,16]])}));return function(){return q.apply(this,arguments)}}();G()},[J,A]);var m=function(q){v(q.key)};return(0,d.jsx)(R.Provider,{value:{reload:function(){H(J+1)}},children:(0,d.jsxs)(B._z,{header:{extra:[(0,d.jsx)(L.u,{access:"canSeeContainerListManageCreate",children:(0,d.jsx)(n.Link,{to:"/app/create/image",children:(0,d.jsx)(U.ZP,{type:"primary",children:"\u521B\u5EFA\u5BB9\u5668"})})},"create")]},children:[(0,d.jsx)(c.Z,{mode:"horizontal",onClick:m,selectedKeys:[w],items:Q}),(0,d.jsx)(n.Outlet,{})]})})}},41748:function(N,D,e){e.r(D),e.d(D,{default:function(){return ae}});var C=e(15009),t=e.n(C),x=e(99289),_=e.n(x),y=e(5574),g=e.n(y),L=e(19632),O=e.n(L),f=e(27619),M=e(67294);function B(T){var S=T.reqFunction,w=T.interval,v=T.maxPolling,K=T.pollingStatus,z=T.inPath,o=(0,M.useRef)(null),J=0,H=function V(){o.current=window.setTimeout(_()(t()().mark(function Y(){var Q;return t()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(J++>=v)){m.next=3;break}return F(),m.abrupt("return");case 3:if(m.prev=3,!(z&&window.location.href.indexOf(z)==-1)){m.next=7;break}return F(),m.abrupt("return");case 7:return m.next=9,S();case 9:Q=m.sent,V(),m.next=17;break;case 13:m.prev=13,m.t0=m.catch(3),F(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",m.t0);case 17:case"end":return m.stop()}},Y,null,[[3,13]])})),w)},F=function(){console.log("end polling"),o.current&&window.clearTimeout(o.current)};return(0,M.useEffect)(function(){return console.log((K?"start":"waiting")+" polling, max "+v),K&&H(),function(){F()}},[w,v,K]),{endPolling:F}}var n=B,P=e(24963),U=e(82346);function c(T){return E.apply(this,arguments)}function E(){return E=_()(t()().mark(function T(S){return t()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,U.request)("/api/app/container/get-stat-info",{method:"POST",data:S}));case 1:case"end":return v.stop()}},T)})),E.apply(this,arguments)}function d(T){return R.apply(this,arguments)}function R(){return R=_()(t()().mark(function T(S){return t()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,U.request)("/api/app/container/get-process-info",{method:"POST",data:S}));case 1:case"end":return v.stop()}},T)})),R.apply(this,arguments)}var h=e(5251),j=e(12122),$=e(60433),W=e(38345),A=e(60940),i=e(50070),r=e(85893),p=new Date().toLocaleTimeString(),a={total:0,memory:[{date:p,usage:0,source:{usage:0,limit:0}}],cpu:[{date:p,usage:0}],network:[{usage:0,type:"rx",date:p,source:{usage:0}},{usage:0,type:"tx",date:p,source:{usage:0}}],io:[{usage:0,type:"read",date:p,source:{usage:0}},{usage:0,type:"write",date:p,source:{usage:0}}]};function ae(){var T=function(u,s){switch(s.type){case"update":var I=new Date(s.payload.read).toLocaleTimeString(),l=s.payload.cpu_stats.cpu_usage.total_usage-s.payload.precpu_stats.cpu_usage.total_usage,k=s.payload.cpu_stats.system_cpu_usage-s.payload.precpu_stats.system_cpu_usage,Z={total:u.total+1,memory:[],cpu:[].concat(O()(u.cpu),[{date:I,usage:l/k*s.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return s.payload.memory_stats&&s.payload.memory_stats.limit&&s.payload.memory_stats.usage&&(Z.memory=[].concat(O()(u.memory),[{date:I,usage:Math.round(s.payload.memory_stats.usage),source:{usage:s.payload.memory_stats.usage,limit:s.payload.memory_stats.limit}}])),s.payload.networks&&(Z.network=[].concat(O()(u.network),[{date:I,usage:parseFloat(s.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:s.payload.networks.eth0.rx_bytes}},{date:I,usage:parseFloat(s.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:s.payload.networks.eth0.tx_bytes}}])),s.payload.blkio_stats&&s.payload.blkio_stats.io_service_bytes_recursive&&s.payload.blkio_stats.io_service_bytes_recursive.length>0&&(Z.io=[].concat(O()(u.io),[{date:I,usage:parseFloat(s.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:s.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:s.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:I,usage:parseFloat(s.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:s.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:s.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),Z}},S=(0,M.useContext)(P.Z),w=S.loading,v=(0,U.useParams)(),K=(0,M.useReducer)(T,a),z=g()(K,2),o=z[0],J=z[1],H=(0,M.useState)(0),F=g()(H,2),V=F[0],Y=F[1],Q=(0,M.useState)(),X=g()(Q,2),m=X[0],G=X[1],q=n({reqFunction:function(){var b=_()(t()().mark(function s(){var I,l;return t()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.next=2,c({id:(I=v.id)!==null&&I!==void 0?I:""});case 2:l=Z.sent,w.destroy(),J({type:"update",payload:l});case 5:case"end":return Z.stop()}},s)}));function u(){return b.apply(this,arguments)}return u}(),interval:3e3,maxPolling:999,pollingStatus:V!=0,inPath:"tab=stat"}),ee=(0,M.useContext)(i.AppDetailContext);return(0,M.useEffect)(function(){ee.reload()},[]),(0,M.useEffect)(function(){var b,u;w.show(),c({id:(b=v.id)!==null&&b!==void 0?b:""}).then(function(s){return Y(Math.round(s.memory_stats.limit)),!0}),d({id:(u=v.id)!==null&&u!==void 0?u:""}).then(function(s){var I={columns:[],data:[]};s.data.list.Titles.map(function(l){I.columns.push({title:l,label:l,dataIndex:l})}),s.data.list.Processes.map(function(l,k){I.data.push({UID:l[0],PID:l[1],PPID:l[2],C:l[3],STIME:l[4],TTY:l[5],TIME:l[6],CMD:l[7]})}),G(I)})},[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(W.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[o.memory&&o.memory.length>0&&(0,r.jsx)(W.Z,{colSpan:12,title:(0,r.jsx)(j.Z,{}),subTitle:"Memory usage: ".concat((0,h.FI)(o.memory[o.memory.length-1].source.usage)," / ").concat((0,h.FI)(o.memory[o.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,r.jsx)(f.Z,{yField:"usage",xField:"date",data:o.memory,yDomainMaxCallback:function(u){return u*2},yLabelFormatter:function(u){return(0,h.FI)(parseFloat(u))}})}),(0,r.jsx)(W.Z,{colSpan:12,title:(0,r.jsx)(j.Z,{}),subTitle:"Cpu usage: ".concat(o.cpu[o.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,r.jsx)(f.Z,{yField:"usage",xField:"date",data:o.cpu,yDomainMaxCallback:function(u){return u*1.5},yLabelFormatter:function(u){return"".concat(u,"%")}})}),o.io&&o.io.length>0&&(0,r.jsx)(W.Z,{colSpan:12,title:(0,r.jsx)(j.Z,{}),subTitle:"I/O: ".concat((0,h.FI)(o.io[o.io.length-1].source.usage)," / ").concat((0,h.FI)(o.io[o.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,r.jsx)(f.Z,{yField:"usage",xField:"date",colorField:"type",data:o.io,yDomainMaxCallback:function(u){return u*2},yLabelFormatter:function(u){return(0,h.FI)(parseFloat(u))}})}),o.network&&o.network.length>0&&(0,r.jsx)(W.Z,{colSpan:12,title:(0,r.jsx)(j.Z,{}),subTitle:"Network: ".concat((0,h.FI)(o.network[o.network.length-1].source.usage)," / ").concat((0,h.FI)(o.network[o.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,r.jsx)(f.Z,{yField:"usage",xField:"date",colorField:"type",data:o.network,yDomainMaxCallback:function(u){return u*2},yLabelFormatter:function(u){return(0,h.FI)(parseFloat(u))}})})]}),(0,r.jsx)(W.Z,{title:(0,r.jsx)($.Z,{}),subTitle:"Progress",children:(0,r.jsx)(A.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:m==null?void 0:m.columns,dataSource:m==null?void 0:m.data,pagination:{pageSize:10}})})]})}},60335:function(N,D,e){e.d(D,{IE:function(){return O},IW:function(){return g},KK:function(){return U},LJ:function(){return E},RF:function(){return j},Re:function(){return R},aF:function(){return W},eE:function(){return n},jV:function(){return M}});var C=e(15009),t=e.n(C),x=e(99289),_=e.n(x),y=e(82346);function g(i){return L.apply(this,arguments)}function L(){return L=_()(t()().mark(function i(r){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/status",{method:"POST",data:r}));case 1:case"end":return a.stop()}},i)})),L.apply(this,arguments)}function O(i){return f.apply(this,arguments)}function f(){return f=_()(t()().mark(function i(r){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/get-list",{data:r,method:"POST"}));case 1:case"end":return a.stop()}},i)})),f.apply(this,arguments)}function M(i){return B.apply(this,arguments)}function B(){return B=_()(t()().mark(function i(r){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/get-detail",{data:r,method:"POST"}));case 1:case"end":return a.stop()}},i)})),B.apply(this,arguments)}function n(i){return P.apply(this,arguments)}function P(){return P=_()(t()().mark(function i(r){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/update",{data:r,method:"POST"}));case 1:case"end":return a.stop()}},i)})),P.apply(this,arguments)}function U(){return c.apply(this,arguments)}function c(){return c=_()(t()().mark(function i(){return t()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,y.request)("/api/app/container/prune",{method:"POST"}));case 1:case"end":return p.stop()}},i)})),c.apply(this,arguments)}function E(i){return d.apply(this,arguments)}function d(){return d=_()(t()().mark(function i(r){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/export",{method:"POST",data:r,responseType:"blob"}));case 1:case"end":return a.stop()}},i)})),d.apply(this,arguments)}function R(i){return h.apply(this,arguments)}function h(){return h=_()(t()().mark(function i(r){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/commit",{method:"POST",data:r}));case 1:case"end":return a.stop()}},i)})),h.apply(this,arguments)}function j(i){return $.apply(this,arguments)}function $(){return $=_()(t()().mark(function i(r){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/upgrade",{method:"POST",data:r}));case 1:case"end":return a.stop()}},i)})),$.apply(this,arguments)}function W(i){return A.apply(this,arguments)}function A(){return A=_()(t()().mark(function i(r){return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,y.request)("/api/app/container/copy",{method:"POST",data:r}));case 1:case"end":return a.stop()}},i)})),A.apply(this,arguments)}}}]);
