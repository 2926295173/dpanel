"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9013],{1699:function(X,T,e){e.d(T,{u:function(){return f}});var W=e(9783),d=e.n(W),Z=e(97857),j=e.n(Z),F=e(67294),G=e(82346),x=e(40411),y=e(42075),M=e(85893),f=function(a){var D=(0,G.useAccess)(),n=Array.isArray(a.access)?a.access:[a.access],_,E=a.fallback;if(typeof a.children=="function"?(_=a.children(n.reduce(function(l,R){return j()(j()({},l),{},d()({},R,D[R]))},{})),_||(_=E)):n.every(function(l){return D[l]})?_=a.children:_=E,!E&&_&&a.showProTips&&D.canSeeEnableCe){if(D.canSeeEnableHiddenProTips)return null;_=(0,M.jsx)(x.Z,{offset:a.showProTipsOffset,count:"PRO",color:"gold",style:{fontWeight:"bold"},children:_})}if(!E&&_&&a.showProRibbonTips&&D.canSeeEnableCe){if(D.canSeeEnableHiddenProTips)return null;_=(0,M.jsx)(x.Z.Ribbon,{text:"PRO",color:"gold",style:{fontWeight:"bold"},children:_})}return a.space?(0,M.jsx)(y.Z,j()(j()({},a.space),{},{children:_})):_}},80821:function(X,T,e){e.d(T,{Z:function(){return D}});var W=e(97857),d=e.n(W),Z=e(5574),j=e.n(Z),F=e(24963),G=e(36146),x=e(86738),y=e(83062),M=e(96074),f=e(83622),r=e(67294),a=e(85893);function D(n){var _=(0,r.useState)(!1),E=j()(_,2),l=E[0],R=E[1],u=(0,r.useContext)(F.Z),v=u.message,b=new G.Uo,s=function(){R(!0);var z=n.action();z instanceof Promise?z.then(function(A){if(R(!1),A){typeof n.onSuccess=="function"&&n.onSuccess(A);var B="";n.messageSuccess?typeof n.messageSuccess=="function"?B=n.messageSuccess(A):B=n.messageSuccess.indexOf("notification.")==0?b.format(n.messageSuccess):n.messageSuccess:B=b.format("notification.finish"),n.asynced?v.info(B):v.success(B)}}).catch(function(A){R(!1),typeof n.onError=="function"&&n.onError(A)}):R(!1)};return n.confirm?(0,a.jsx)(x.Z,d()(d()({style:{width:500},title:n.confirmTitle?n.confirmTitle:b.format("notification.title.tip"),description:typeof n.confirm=="string"&&n.confirm.indexOf("notification.")==0?b.format(n.confirm):n.confirm,onConfirm:s,okText:"Yes",cancelText:"No",onOpenChange:n.confirmOnOpenChange},n.confirmProps),{},{children:(0,a.jsxs)(y.Z,{title:n.tips,children:[n.showDivider&&(0,a.jsx)(M.Z,{type:"vertical",style:{marginRight:15}}),(0,a.jsx)(f.ZP,{block:n.block,disabled:n.disabled,icon:!n.children&&l?void 0:n.icon,loading:l,danger:n.danger,type:n.type,children:n.children})]})})):(0,a.jsxs)(y.Z,{title:n.tips,children:[n.showDivider&&(0,a.jsx)(M.Z,{type:"vertical",style:{marginRight:15}}),(0,a.jsx)(f.ZP,{block:n.block,style:n.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:n.disabled,icon:!n.children&&l?void 0:n.icon,loading:l,onClick:s,danger:n.danger,type:n.type,children:n.children})]})}},44349:function(X,T,e){var W=e(97857),d=e.n(W),Z=e(15009),j=e.n(Z),F=e(99289),G=e.n(F),x=e(74763),y=e(17186),M=e(5966),f=e(86250),r=e(67294),a=e(85893),D=(0,r.forwardRef)(function(n,_){var E=(0,r.useRef)();(0,r.useImperativeHandle)(_,function(){return{addItem:function(R){function u(v,b,s){return R.apply(this,arguments)}return u.toString=function(){return R.toString()},u}(function(R,u,v){var b,s=(b=E.current)===null||b===void 0?void 0:b.getList(),U;if(s==null||s.forEach(function(B,k){B[R]==u[R]&&(U=k)}),!(0,x.k)(U)&&v){var z;(z=E.current)===null||z===void 0||z.remove(U),U=void 0}if(!U){var A;(A=E.current)===null||A===void 0||A.add(u)}}),removeItemByKey:function(u,v){return G()(j()().mark(function b(){var s,U;return j()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return U=(s=E.current)===null||s===void 0?void 0:s.getList(),U==null||U.forEach(function(B,k){if(B[u]==v){var ee;(ee=E.current)===null||ee===void 0||ee.remove(k);return}}),A.abrupt("return");case 3:case"end":return A.stop()}},b)}))()},clear:function(u){if(!u){var v;u=(v=E.current)===null||v===void 0||(v=v.getList())===null||v===void 0?void 0:v.map(function(s,U){return U})}if(u){var b;(b=E.current)===null||b===void 0||b.remove(u)}},getList:function(){var u;return(u=E.current)===null||u===void 0?void 0:u.getList()}}});var l={};return n.hideCopyButton===!0&&(l.copyIconProps=!1),n.hideDeleteButton===!0&&(l.deleteIconProps=!1),(0,a.jsx)(y.u,d()(d()({initialValue:n.initialValue,label:n.label,name:n.name,actionRef:E,creatorButtonProps:n.showAddButton?{creatorButtonText:n.label?n.label:n.name}:!1,min:n.min?n.min:0},l),{},{children:function(u,v,b){return(0,a.jsx)(f.Z,{justify:n.justify,gap:n.gap,children:n.items.map(function(s){return s.render?(0,a.jsx)("div",{children:s.render&&s.render(u,v,b)},"".concat(n.name,"-").concat(s.name,"-").concat(u.key)):(0,a.jsx)(M.Z,{width:s.width,name:s.name,label:s.label,required:s.required,rules:[{required:s.required}],disabled:s.disabled,placeholder:s.placeholder},"".concat(n.name,"-").concat(s.name,"-").concat(u.key))})})}}))});T.Z=D},36435:function(X,T,e){var W=e(15009),d=e.n(W),Z=e(64599),j=e.n(Z),F=e(99289),G=e.n(F),x=e(9783),y=e.n(x),M=e(5574),f=e.n(M),r=e(67294),a=e(184),D=e(38345),n=e(97269),_=e(97321),E=e(97462),l=e(64317),R=e(5966),u=e(86615),v=e(68602),b=e(83622),s=e(83403),U=e(24963),z=e(1699),A=e(29177),B=e(1883),k=e(43425),ee=e(44349),ae=e(3616),ne=e(36146),C=e(85893),se=(0,r.forwardRef)(function(o,ie){var le=(0,r.useState)(!1),te=f()(le,2),K=te[0],q=te[1],V=(0,r.useRef)(),J=(0,r.useContext)(U.Z),$=J.message,L=(0,r.useState)([]),H=f()(L,2),N=H[0],p=H[1],c=new ne.Uo("components.permissionButton"),S=y()(y()(y()(y()(y()({},s.W6.CONTAINER,"Id"),s.W6.APPSTORE,"name"),s.W6.COMPOSE,"name"),s.W6.REGISTRY,"serverAddress"),s.W6.DOCKER_ENV,"name"),oe=y()(y()(y()(y()(y()({},s.W6.CONTAINER,"name"),s.W6.APPSTORE,"name"),s.W6.COMPOSE,"name"),s.W6.REGISTRY,"title"),s.W6.DOCKER_ENV,"title"),re=S[o.type],I=oe[o.type],Y=o.selected.map(function(i){return i[S[o.type]]});return r.useEffect(function(){if(K){if(!o.selected||o.selected.length==0){$.error(ne.FD.format("message.noDataSelect")),q(!1);return}(0,v.dP)({permission:{uri:o.type,key:re,value:Y}}).then(function(i){var t;(t=V.current)===null||t===void 0||t.setFieldValue("list",Object.keys(i.data.list).map(function(m){return{name:m,type:i.data.list[m].type,users:i.data.list[m].users}}))}),(0,v.lE)().then(function(i){var t,m=(t=i.data)===null||t===void 0||(t=t.list)===null||t===void 0?void 0:t.map(function(h){return{label:h.username,value:h.username}});p(m)})}},[K]),(0,C.jsx)(z.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,C.jsxs)(a.a,{name:"create",title:c.format("drawerTitle"),open:K,onOpenChange:function(t){if(!t){var m;(m=V.current)===null||m===void 0||m.resetFields()}q(t)},drawerProps:{forceRender:!0,width:ae.R_},formRef:V,trigger:(0,C.jsx)(b.ZP,{icon:(0,C.jsx)(A.Z,{}),children:c.format("drawerTriggerButton")}),onFinish:function(){var i=G()(d()().mark(function t(m){var h,g,P;return d()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:h=j()(m.list),O.prev=1,h.s();case 3:if((g=h.n()).done){O.next=9;break}return P=g.value,O.next=7,(0,v.Db)({usernames:P.users,permissionType:P.type,permission:{uri:o.type,key:re,showKey:I,value:[P.name]}});case 7:O.next=3;break;case 9:O.next=14;break;case 11:O.prev=11,O.t0=O.catch(1),h.e(O.t0);case 14:return O.prev=14,h.f(),O.finish(14);case 17:$.success(ne.FD.format("finish")),q(!1),o.onSuccess();case 20:case"end":return O.stop()}},t,null,[[1,11,14,17]])}));return function(t){return i.apply(this,arguments)}}(),children:[(0,C.jsxs)(D.Z,{ghost:!0,title:(0,C.jsx)(B.Z,{}),subTitle:c.format("batchTitle"),children:[(0,C.jsx)(n.A.Item,{name:"type",style:{marginBottom:0},children:(0,C.jsx)(_.Z.Group,{defaultValue:"admin",onChange:function(t){var m,h,g=(m=V.current)===null||m===void 0?void 0:m.getFieldValue("list");g.forEach(function(P){P.type=t,P.users=[]}),(h=V.current)===null||h===void 0||h.setFieldValue("list",g)},children:["admin","restricted","public"].map(function(i){return(0,C.jsx)(_.Z,{style:{width:240},title:c.format("dataTypeOption.".concat(i)),description:c.format("dataTypeOptionDesc.".concat(i)),value:i},i)})})}),(0,C.jsx)(E.Z,{name:["type"],children:function(t){var m=t.type;if(m==="restricted")return(0,C.jsx)(l.Z,{mode:"multiple",name:"usernames",label:c.format("formUsernames"),onChange:function(g){var P,w,O=(P=V.current)===null||P===void 0?void 0:P.getFieldValue("list");O.forEach(function(Q){Q.users=g}),(w=V.current)===null||w===void 0||w.setFieldValue("list",O)},rules:[{required:!0}],request:G()(d()().mark(function h(){var g,P,w;return d()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(!(N.length>0)){Q.next=2;break}return Q.abrupt("return",N);case 2:return Q.next=4,(0,v.lE)();case 4:return P=Q.sent,w=(g=P.data)===null||g===void 0||(g=g.list)===null||g===void 0?void 0:g.map(function(_e){return{label:_e.username,value:_e.username}}),p(w),Q.abrupt("return",w);case 8:case"end":return Q.stop()}},h)}))})}})]}),(0,C.jsx)(D.Z,{ghost:!0,title:(0,C.jsx)(k.Z,{}),subTitle:c.format("dataTitle"),children:(0,C.jsx)(ee.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:c.format("dataName"),render:function(t,m,h){var g=h.getCurrentRowData();return(0,C.jsx)(R.Z,{disabled:!0,label:c.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:c.format("dataType"),render:function(t,m,h){var g=h.getCurrentRowData();return(0,C.jsx)(u.Z.Group,{label:c.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(P){return{label:c.format("dataTypeOption.".concat(P)),value:P}})})}},{name:"users",label:c.format("dataUsers"),render:function(t,m,h){return(0,C.jsx)(E.Z,{name:["type"],children:function(P){var w=P.type;if(w=="restricted")return(0,C.jsx)(l.Z,{width:"sm",mode:"tags",name:"users",label:c.format("dataUsers"),options:N})}})}}]})})]})})});T.Z=se},3616:function(X,T,e){e.d(T,{Ed:function(){return j},FK:function(){return d},R_:function(){return W},ob:function(){return Z}});var W=window.innerWidth<=1024?"90vw":"65vw",d="90vw",Z="60vw",j="50vh"},24963:function(X,T,e){var W=e(67294),d=(0,W.createContext)({});T.Z=d},39900:function(X,T,e){e.r(T),e.d(T,{default:function(){return te}});var W=e(15009),d=e.n(W),Z=e(99289),j=e.n(Z),F=e(1699),G=e(80821),x=e(36435),y=e(83403),M=e(75870),f=e(67255),r=e(86548),a=e(90078),D=e(56729),n=e(82346),_=e(42075),E=e(96074),l=e(83622),R=e(83062),u=e(67294),v=e(36146),b=e(5574),s=e.n(b),U=e(3616),z=e(24963),A=e(184),B=e(5966),k=e(52688),ee=e(97462),ae=e(90672),ne=e(62370),C=e(25593),se=e(66309),o=e(85893),ie=(0,u.forwardRef)(function(K,q){var V=(0,u.useState)(!1),J=s()(V,2),$=J[0],L=J[1],H=(0,u.useRef)(),N=(0,u.useState)(0),p=s()(N,2),c=p[0],S=p[1],oe=(0,u.useContext)(z.Z),re=oe.message,I=new v.Uo("components.image");return(0,u.useImperativeHandle)(q,function(){return{setEditId:function(i){(0,M.t1)({id:i}).then(function(t){var m;L(!0),S(i),(m=H.current)===null||m===void 0||m.setFieldsValue({title:t.data.info.title,serverAddress:t.data.info.serverAddress,username:t.data.info.setting.username,password:t.data.info.setting.password,proxy:t.data.info.setting.proxy.join(`
`),enableHttp:t.data.info.setting.enableHttp,enableAuth:!!t.data.info.setting.username})})}}}),(0,o.jsxs)(A.a,{drawerProps:{forceRender:!0,width:U.R_},name:"createRegisry",title:I.format("registryCreateTitle"),open:$,onOpenChange:function(i){L(i)},layout:"horizontal",labelCol:{span:5,offset:0},formRef:H,trigger:(0,o.jsx)(l.ZP,{type:"primary",onClick:function(){var i;(i=H.current)===null||i===void 0||i.resetFields(),S(0)},children:I.format("registryCreateTirggerButton")}),onFinish:function(){var Y=j()(d()().mark(function i(t){var m,h,g,P;return d()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,(0,M.ZH)({id:c,title:t.title,serverAddress:t.serverAddress,username:(m=t.username)!==null&&m!==void 0?m:"",password:(h=t.password)!==null&&h!==void 0?h:"",proxy:t.proxy?t.proxy.split(`
`):[],enableHttp:t.enableHttp});case 2:if(g=O.sent,!(g&&g.data&&g.data.id>0)){O.next=8;break}return re.success(v.FD.format("finish")),K.onFinish&&K.onFinish(),(P=H.current)===null||P===void 0||P.resetFields(),O.abrupt("return",!0);case 8:case"end":return O.stop()}},i)}));return function(i){return Y.apply(this,arguments)}}(),children:[(0,o.jsx)(B.Z,{label:I.format("registryCreateFormTitle"),name:"title",placeholder:I.format("registryCreateFormTitleEmpty"),disabled:c==-1,required:!0}),(0,o.jsx)(B.Z,{label:I.format("registryCreateFormServerAddress"),name:"serverAddress",placeholder:"ccr.ccs.tencentyun.com, docker.io, 127.0.0.1:5000",disabled:c==-1,required:!0,rules:[{required:!0}]}),(0,o.jsx)(k.Z,{tooltip:I.format("registryCreateFormEnableHttpTip"),label:I.format("registryCreateFormEnableHttp"),name:"enableHttp"}),(0,o.jsx)(k.Z,{label:I.format("registryCreateFormEnableAuth"),name:"enableAuth"}),(0,o.jsx)(ee.Z,{name:["enableAuth"],children:function(i){var t=i.enableAuth;return t&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(B.Z,{label:I.format("registryCreateFormUsername"),name:"username",placeholder:I.format("registryCreateFormUsernameEmpty"),tooltip:""},"username"),(0,o.jsx)(B.Z.Password,{label:I.format("registryCreateFormPassword"),name:"password",allowClear:!0,placeholder:I.format("registryCreateFormPasswordEmpty")},"password")]})}}),(0,o.jsx)(ae.Z,{label:I.format("registryCreateFormProxy"),name:"proxy",fieldProps:{autoSize:{minRows:10}},placeholder:I.format("registryCreateFormProxyTip")}),(0,o.jsx)(ne.Z,{label:I.format("registryCreateFormProxyRecommand"),children:(0,o.jsx)(_.Z,{wrap:!0,children:["docker.1panel.live","docker.m.daocloud.io","docker.1ms.run"].map(function(Y,i){return(0,o.jsx)(C.Z.Link,{onClick:function(){var m,h,g=[];if((m=H.current)!==null&&m!==void 0&&m.getFieldValue("proxy")){var P;g=(P=H.current)===null||P===void 0?void 0:P.getFieldValue("proxy").split(`
`)}else g=[];g.includes(Y)||g.push(Y),(h=H.current)===null||h===void 0||h.setFieldValue("proxy",g.join(`
`))},children:(0,o.jsx)(se.Z,{color:"cyan",children:Y})},i)})})},"recommend")]})}),le=ie;function te(){var K=(0,u.useRef)(),q=(0,u.useRef)(),V=(0,n.useAccess)();return(0,o.jsx)(a._z,{header:{extra:[(0,o.jsx)(F.u,{access:"canSeeImageRegistryManage",children:(0,o.jsx)(le,{onFinish:function(){var $,L;!(($=K.current)===null||$===void 0)&&$.reloadAndRest&&((L=K.current)===null||L===void 0||L.reloadAndRest())},ref:q},"create")},"create")]},children:(0,o.jsx)(D.Z,{scroll:{x:"max-content"},rowKey:"id",columns:[{title:v.FD.format("listTitle"),ellipsis:!0,dataIndex:"title"},{title:"Url",dataIndex:"serverAddress"},{title:v.FD.format("listUsername"),dataIndex:["setting","username"],search:!1},{title:v.FD.format("listManage"),width:100,search:!1,fixed:"right",hidden:!V.canSeeImageRegistryManage,render:function($,L,H,N,p){return(0,o.jsx)(_.Z,{split:(0,o.jsx)(E.Z,{type:"vertical"}),children:(0,o.jsx)(l.ZP,{type:"link",onClick:function(){var S;(S=q.current)===null||S===void 0||S.setEditId(L.id)},children:(0,o.jsx)(R.Z,{title:v.FD.format("listManageEdit"),children:(0,o.jsx)(r.Z,{})})})})}}],request:function(){var J=j()(d()().mark(function $(L,H,N){var p;return d()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,(0,M.Ot)({title:L.title,serverAddress:L.serverAddress});case 2:return p=S.sent,S.abrupt("return",{data:p.data.list,success:!0,total:p.data.list.length});case 4:case"end":return S.stop()}},$)}));return function($,L,H){return J.apply(this,arguments)}}(),toolBarRender:function(){return[]},rowSelection:V.canSeeImageRegistryManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0}:void 0,pagination:(0,f.Oh)(),actionRef:K,tableAlertOptionRender:function($){var L=$.selectedRowKeys,H=$.selectedRows;return(0,o.jsxs)(_.Z,{size:16,children:[(0,o.jsx)(x.Z,{type:y.W6.REGISTRY,selected:H,onSuccess:function(){var p,c;return!((p=K.current)===null||p===void 0)&&p.reloadAndRest&&((c=K.current)===null||c===void 0||c.reloadAndRest()),!0}}),(0,o.jsx)(G.Z,{danger:!0,type:"primary",action:function(){return(0,M.ix)({id:L})},onSuccess:function(){var p,c;return!((p=K.current)===null||p===void 0)&&p.reloadAndRest&&((c=K.current)===null||c===void 0||c.reloadAndRest()),!0},onError:function(){var p,c;return!((p=K.current)===null||p===void 0)&&p.reset&&((c=K.current)===null||c===void 0||c.reset()),!0},confirm:"notification.confirm.title",children:v.FD.format("listManageDeleteBatch")})]})}})})}},75870:function(X,T,e){e.d(T,{Ot:function(){return G},ZH:function(){return y},ix:function(){return f},t1:function(){return a}});var W=e(15009),d=e.n(W),Z=e(99289),j=e.n(Z),F=e(82346);function G(n){return x.apply(this,arguments)}function x(){return x=j()(d()().mark(function n(_){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,F.request)("/api/common/registry/get-list",{method:"POST",data:_}));case 1:case"end":return l.stop()}},n)})),x.apply(this,arguments)}function y(n){return M.apply(this,arguments)}function M(){return M=j()(d()().mark(function n(_){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,F.request)("/api/common/registry/create",{method:"POST",data:_}));case 1:case"end":return l.stop()}},n)})),M.apply(this,arguments)}function f(n){return r.apply(this,arguments)}function r(){return r=j()(d()().mark(function n(_){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,F.request)("/api/common/registry/delete",{method:"POST",data:_}));case 1:case"end":return l.stop()}},n)})),r.apply(this,arguments)}function a(n){return D.apply(this,arguments)}function D(){return D=j()(d()().mark(function n(_){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,F.request)("/api/common/registry/get-detail",{method:"POST",data:_}));case 1:case"end":return l.stop()}},n)})),D.apply(this,arguments)}},67255:function(X,T,e){e.d(T,{G$:function(){return F},LX:function(){return M},MJ:function(){return j},Oh:function(){return Z},h5:function(){return x},j_:function(){return G},rj:function(){return y}});var W=e(5574),d=e.n(W);function Z(f){var r=localStorage.getItem("dpanel-pagesize");return r=="all"?!1:{defaultCurrent:f==null?void 0:f.page,showSizeChanger:!0,defaultPageSize:parseInt(r!=null?r:"20"),showQuickJumper:!0}}function j(f,r){r?localStorage.setItem("dpanel-page-"+f,"".concat(r)):localStorage.removeItem("dpanel-page-"+f)}function F(f,r){var a=r?Math.ceil((r==null?void 0:r.total)/(r==null?void 0:r.pageSize)):void 0,D=localStorage.getItem("dpanel-page-"+f),n=1;return D&&(n=parseInt(D)),a&&n>a?1:n}function G(f){return{persistenceKey:f,persistenceType:"localStorage"}}var x=["descend","ascend"];function y(f,r){var a=localStorage.getItem("dpanel-table-sort-".concat(f));if(a){var D=a.split("|"),n=d()(D,2),_=n[0],E=n[1];if(_==r)return E}}function M(f,r,a){!r||!a?localStorage.removeItem("dpanel-table-sort-".concat(f)):localStorage.setItem("dpanel-table-sort-".concat(f),"".concat(r,"|").concat(a))}}}]);
