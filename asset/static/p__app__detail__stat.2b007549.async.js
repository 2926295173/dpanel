"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745],{16664:function(A,h,e){e.d(h,{Z:function(){return m}});var F=e(87462),i=e(67294),P={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0zm0 284a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"unordered-list",theme:"outlined"},n=P,a=e(84089),_=function(b,x){return i.createElement(a.Z,(0,F.Z)({},b,{ref:x,icon:n}))},d=i.forwardRef(_),m=d},27619:function(A,h,e){e.d(h,{Z:function(){return T}});var F=e(97857),i=e.n(F),P=e(19632),n=e.n(P),a=e(5574),_=e.n(a),d=e(64183),m=e(54006),f=e(9361),b=e(67294),x=e(85893);function T(s){var E,R=(0,b.useState)("academy"),M=_()(R,2),g=M[0],j=M[1],I=Math.max.apply(Math,n()(s.data.map(function(C){var o;return(o=C[s.yField])!==null&&o!==void 0?o:0}))),D=(0,m.useAntdConfig)(),l={xField:s.xField,yField:s.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:s.yLabelFormatter},scale:{y:{domainMin:(E=s.yDomainMin)!==null&&E!==void 0?E:0,domainMax:s.yDomainMax?s.yDomainMax:s.yDomainMaxCallback?s.yDomainMaxCallback(I):I}},data:s.data};return s.yLabelFormatter&&(l.axis.y.labelFormatter=s.yLabelFormatter),s.colorField&&(l.colorField=s.colorField),(0,b.useEffect)(function(){var C=D.theme.algorithm;C.includes(f.Z.darkAlgorithm)?j("classicDark"):j("academy")},[D]),(0,x.jsx)(d.Z,i()({theme:g},l))}},71890:function(A,h,e){var F=e(15009),i=e.n(F),P=e(99289),n=e.n(P),a=e(67294);function _(d){var m=d.reqFunction,f=d.interval,b=d.maxPolling,x=d.pollingStatus,T=d.inPath,s=(0,a.useRef)(null),E=0,R=function g(){s.current=window.setTimeout(n()(i()().mark(function j(){var I;return i()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(E++>=b)){l.next=3;break}return M(),l.abrupt("return");case 3:if(l.prev=3,!(T&&window.location.href.indexOf(T)==-1)){l.next=7;break}return M(),l.abrupt("return");case 7:return l.next=9,m();case 9:I=l.sent,g(),l.next=17;break;case 13:l.prev=13,l.t0=l.catch(3),M(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",l.t0);case 17:case"end":return l.stop()}},j,null,[[3,13]])})),f)},M=function(){console.log("end polling"),s.current&&window.clearTimeout(s.current)};return(0,a.useEffect)(function(){return console.log((x?"start":"waiting")+" polling, max "+b),x&&R(),function(){M()}},[f,b,x]),{endPolling:M}}h.Z=_},24963:function(A,h,e){var F=e(67294),i=(0,F.createContext)({});h.Z=i},42223:function(A,h,e){e.r(h),e.d(h,{default:function(){return $}});var F=e(15009),i=e.n(F),P=e(99289),n=e.n(P),a=e(5574),_=e.n(a),d=e(19632),m=e.n(d),f=e(27619),b=e(71890),x=e(24963),T=e(54006);function s(L){return E.apply(this,arguments)}function E(){return E=n()(i()().mark(function L(W){return i()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,T.request)("/api/app/container/get-stat-info",{method:"POST",data:W}));case 1:case"end":return p.stop()}},L)})),E.apply(this,arguments)}function R(L){return M.apply(this,arguments)}function M(){return M=n()(i()().mark(function L(W){return i()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,T.request)("/api/app/container/get-process-info",{method:"POST",data:W}));case 1:case"end":return p.stop()}},L)})),M.apply(this,arguments)}var g=e(5251),j=e(12122),I=e(16664),D=e(38345),l=e(63490),C=e(67294),o=e(85893),U=new Date().toLocaleTimeString(),z={total:0,memory:[{date:U,usage:0,source:{usage:0,limit:0}}],cpu:[{date:U,usage:0}],network:[{usage:0,type:"rx",date:U,source:{usage:0}},{usage:0,type:"tx",date:U,source:{usage:0}}],io:[{usage:0,type:"read",date:U,source:{usage:0}},{usage:0,type:"write",date:U,source:{usage:0}}]};function $(){var L=function(r,t){switch(t.type){case"update":var v=new Date(t.payload.read).toLocaleTimeString(),c=t.payload.cpu_stats.cpu_usage.total_usage-t.payload.precpu_stats.cpu_usage.total_usage,B=t.payload.cpu_stats.system_cpu_usage-t.payload.precpu_stats.system_cpu_usage,O={total:r.total+1,memory:[].concat(m()(r.memory),[{date:v,usage:Math.round(t.payload.memory_stats.usage),source:{usage:t.payload.memory_stats.usage,limit:t.payload.memory_stats.limit}}]),cpu:[].concat(m()(r.cpu),[{date:v,usage:c/B*t.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return t.payload.networks&&(O.network=[].concat(m()(r.network),[{date:v,usage:parseFloat(t.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:t.payload.networks.eth0.rx_bytes}},{date:v,usage:parseFloat(t.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:t.payload.networks.eth0.tx_bytes}}])),t.payload.blkio_stats&&t.payload.blkio_stats.io_service_bytes_recursive.length>0&&(O.io=[].concat(m()(r.io),[{date:v,usage:parseFloat(t.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:t.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:t.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:v,usage:parseFloat(t.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:t.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:t.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),O}},W=(0,C.useContext)(x.Z),Z=W.loading,p=(0,T.useParams)(),H=(0,C.useReducer)(L,z),k=_()(H,2),u=k[0],G=k[1],Y=(0,C.useState)(0),K=_()(Y,2),N=K[0],J=K[1],Q=(0,C.useState)(),w=_()(Q,2),S=w[0],V=w[1],X=(0,b.Z)({reqFunction:function(){var y=n()(i()().mark(function t(){var v,c;return i()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,s({id:(v=p.id)!==null&&v!==void 0?v:""});case 2:c=O.sent,Z.destroy(),G({type:"update",payload:c});case 5:case"end":return O.stop()}},t)}));function r(){return y.apply(this,arguments)}return r}(),interval:3e3,maxPolling:999,pollingStatus:N!=0,inPath:"tab=stat"});return(0,C.useEffect)(function(){var y,r;Z.show(),s({id:(y=p.id)!==null&&y!==void 0?y:""}).then(function(t){return J(Math.round(t.memory_stats.limit)),!0}),R({id:(r=p.id)!==null&&r!==void 0?r:""}).then(function(t){var v={columns:[],data:[]};t.data.list.Titles.map(function(c){v.columns.push({title:c,label:c,dataIndex:c})}),t.data.list.Processes.map(function(c,B){v.data.push({UID:c[0],PID:c[1],PPID:c[2],C:c[3],STIME:c[4],TTY:c[5],TIME:c[6],CMD:c[7]})}),V(v)})},[]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(D.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[(0,o.jsx)(D.Z,{colSpan:12,title:(0,o.jsx)(j.Z,{}),subTitle:"Memory usage: ".concat((0,g.FI)(u.memory[u.memory.length-1].source.usage)," / ").concat((0,g.FI)(u.memory[u.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,o.jsx)(f.Z,{yField:"usage",xField:"date",data:u.memory,yDomainMaxCallback:function(r){return r*2},yLabelFormatter:function(r){return(0,g.FI)(parseFloat(r))}})}),(0,o.jsx)(D.Z,{colSpan:12,title:(0,o.jsx)(j.Z,{}),subTitle:"Cpu usage: ".concat(u.cpu[u.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,o.jsx)(f.Z,{yField:"usage",xField:"date",data:u.cpu,yDomainMaxCallback:function(r){return r*1.5},yLabelFormatter:function(r){return"".concat(r,"%")}})}),u.io&&u.io.length>0&&(0,o.jsx)(D.Z,{colSpan:12,title:(0,o.jsx)(j.Z,{}),subTitle:"I/O: ".concat((0,g.FI)(u.io[u.io.length-1].source.usage)," / ").concat((0,g.FI)(u.io[u.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,o.jsx)(f.Z,{yField:"usage",xField:"date",colorField:"type",data:u.io,yDomainMaxCallback:function(r){return r*2},yLabelFormatter:function(r){return(0,g.FI)(parseFloat(r))}})}),u.network&&u.network.length>0&&(0,o.jsx)(D.Z,{colSpan:12,title:(0,o.jsx)(j.Z,{}),subTitle:"Network: ".concat((0,g.FI)(u.network[u.network.length-1].source.usage)," / ").concat((0,g.FI)(u.network[u.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,o.jsx)(f.Z,{yField:"usage",xField:"date",colorField:"type",data:u.network,yDomainMaxCallback:function(r){return r*2},yLabelFormatter:function(r){return(0,g.FI)(parseFloat(r))}})})]}),(0,o.jsx)(D.Z,{title:(0,o.jsx)(I.Z,{}),subTitle:"Progress",children:(0,o.jsx)(l.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:S==null?void 0:S.columns,dataSource:S==null?void 0:S.data,pagination:{pageSize:10}})})]})}},5251:function(A,h,e){e.d(h,{FI:function(){return i},ZM:function(){return P}});function F(n){return n.trim()}function i(n){var a="";n<.1*1024?a=n.toFixed(2)+"B":n<.1*1024*1024?a=(n/1024).toFixed(2)+"KB":n<1*1024*1024*1024?a=(n/(1024*1024)).toFixed(2)+"MB":a=(n/(1024*1024*1024)).toFixed(2)+"GB";var _=a+"",d=_.indexOf("."),m=_.substring(d+1,d+3);return m=="00"?_.substring(0,d)+_.substr(d+3,2):a}function P(n){if(n){var a=new Date(n),_=a.getFullYear()+"-",d=(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-",m=(a.getDate()<10?"0"+a.getDate():a.getDate())+" ",f=(a.getHours()<10?"0"+a.getHours():a.getHours())+":",b=(a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes())+":",x=a.getSeconds()<10?"0"+a.getSeconds():a.getSeconds();return _+d+m+f+b+x}}}}]);
