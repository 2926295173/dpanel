"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9013],{1699:function(Q,W,e){e.d(W,{u:function(){return p}});var U=e(9783),_=e.n(U),Z=e(97857),j=e.n(Z),F=e(67294),$=e(82346),D=e(40411),u=e(42075),d=e(85893),p=function(l){var R=(0,$.useAccess)(),n=Array.isArray(l.access)?l.access:[l.access],c,O=l.fallback;if(typeof l.children=="function"?(c=l.children(n.reduce(function(a,C){return j()(j()({},a),{},_()({},C,R[C]))},{})),c||(c=O)):n.every(function(a){return R[a]})?c=l.children:c=O,!O&&c&&l.showProTips&&R.canSeeEnableCe){if(R.canSeeEnableHiddenProTips)return null;c=(0,d.jsx)(D.Z,{offset:l.showProTipsOffset,count:"PRO",color:"gold",style:{fontWeight:"bold"},children:c})}if(!O&&c&&l.showProRibbonTips&&R.canSeeEnableCe){if(R.canSeeEnableHiddenProTips)return null;c=(0,d.jsx)(D.Z.Ribbon,{text:"PRO",color:"gold",style:{fontWeight:"bold"},children:c})}return l.space?(0,d.jsx)(u.Z,j()(j()({},l.space),{},{children:c})):c}},80821:function(Q,W,e){e.d(W,{Z:function(){return R}});var U=e(97857),_=e.n(U),Z=e(5574),j=e.n(Z),F=e(24963),$=e(36146),D=e(86738),u=e(83062),d=e(96074),p=e(83622),P=e(67294),l=e(85893);function R(n){var c=(0,P.useState)(!1),O=j()(c,2),a=O[0],C=O[1],i=(0,P.useContext)(F.Z),v=i.message,b=new $.Uo,r=function(){C(!0);var N=n.action();N instanceof Promise?N.then(function(A){if(C(!1),A){typeof n.onSuccess=="function"&&n.onSuccess(A);var B="";n.messageSuccess?typeof n.messageSuccess=="function"?B=n.messageSuccess(A):B=n.messageSuccess.indexOf("notification.")==0?b.format(n.messageSuccess):n.messageSuccess:B=b.format("notification.finish"),n.asynced?v.info(B):v.success(B)}}).catch(function(A){C(!1),typeof n.onError=="function"&&n.onError(A)}):C(!1)};return n.confirm?(0,l.jsx)(D.Z,_()(_()({style:{width:500},title:n.confirmTitle?n.confirmTitle:b.format("notification.title.tip"),description:typeof n.confirm=="string"&&n.confirm.indexOf("notification.")==0?b.format(n.confirm):n.confirm,onConfirm:r,okText:"Yes",cancelText:"No",onOpenChange:n.confirmOnOpenChange},n.confirmProps),{},{children:(0,l.jsxs)(u.Z,{title:n.tips,children:[n.showDivider&&(0,l.jsx)(d.Z,{type:"vertical",style:{marginRight:15}}),(0,l.jsx)(p.ZP,{block:n.block,disabled:n.disabled,icon:!n.children&&a?void 0:n.icon,loading:a,danger:n.danger,type:n.type,children:n.children})]})})):(0,l.jsxs)(u.Z,{title:n.tips,children:[n.showDivider&&(0,l.jsx)(d.Z,{type:"vertical",style:{marginRight:15}}),(0,l.jsx)(p.ZP,{block:n.block,style:n.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:n.disabled,icon:!n.children&&a?void 0:n.icon,loading:a,onClick:r,danger:n.danger,type:n.type,children:n.children})]})}},44349:function(Q,W,e){var U=e(97857),_=e.n(U),Z=e(15009),j=e.n(Z),F=e(99289),$=e.n(F),D=e(74763),u=e(17186),d=e(5966),p=e(86250),P=e(67294),l=e(85893),R=(0,P.forwardRef)(function(n,c){var O=(0,P.useRef)();(0,P.useImperativeHandle)(c,function(){return{addItem:function(C){function i(v,b,r){return C.apply(this,arguments)}return i.toString=function(){return C.toString()},i}(function(C,i,v){var b,r=(b=O.current)===null||b===void 0?void 0:b.getList(),I;if(r==null||r.forEach(function(B,k){B[C]==i[C]&&(I=k)}),!(0,D.k)(I)&&v){var N;(N=O.current)===null||N===void 0||N.remove(I),I=void 0}if(!I){var A;(A=O.current)===null||A===void 0||A.add(i)}}),removeItemByKey:function(i,v){return $()(j()().mark(function b(){var r,I;return j()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return I=(r=O.current)===null||r===void 0?void 0:r.getList(),I==null||I.forEach(function(B,k){if(B[i]==v){var ee;(ee=O.current)===null||ee===void 0||ee.remove(k);return}}),A.abrupt("return");case 3:case"end":return A.stop()}},b)}))()},clear:function(i){if(!i){var v;i=(v=O.current)===null||v===void 0||(v=v.getList())===null||v===void 0?void 0:v.map(function(r,I){return I})}if(i){var b;(b=O.current)===null||b===void 0||b.remove(i)}},getList:function(){var i;return(i=O.current)===null||i===void 0?void 0:i.getList()}}});var a={};return n.hideCopyButton===!0&&(a.copyIconProps=!1),n.hideDeleteButton===!0&&(a.deleteIconProps=!1),(0,l.jsx)(u.u,_()(_()({initialValue:n.initialValue,label:n.label,name:n.name,actionRef:O,creatorButtonProps:n.showAddButton?{creatorButtonText:n.label?n.label:n.name}:!1,min:n.min?n.min:0},a),{},{children:function(i,v,b){return(0,l.jsx)(p.Z,{justify:n.justify,gap:n.gap,children:n.items.map(function(r){return r.render?(0,l.jsx)("div",{children:r.render&&r.render(i,v,b)},"".concat(n.name,"-").concat(r.name,"-").concat(i.key)):(0,l.jsx)(d.Z,{width:r.width,name:r.name,label:r.label,required:r.required,rules:[{required:r.required}],disabled:r.disabled,placeholder:r.placeholder},"".concat(n.name,"-").concat(r.name,"-").concat(i.key))})})}}))});W.Z=R},36435:function(Q,W,e){var U=e(15009),_=e.n(U),Z=e(64599),j=e.n(Z),F=e(99289),$=e.n(F),D=e(9783),u=e.n(D),d=e(5574),p=e.n(d),P=e(67294),l=e(184),R=e(38345),n=e(97269),c=e(97321),O=e(97462),a=e(64317),C=e(5966),i=e(86615),v=e(68602),b=e(83622),r=e(83403),I=e(24963),N=e(1699),A=e(29177),B=e(1883),k=e(43425),ee=e(44349),ae=e(3616),ne=e(36146),T=e(85893),se=(0,P.forwardRef)(function(s,ie){var le=(0,P.useState)(!1),te=p()(le,2),K=te[0],q=te[1],G=(0,P.useRef)(),J=(0,P.useContext)(I.Z),H=J.message,L=(0,P.useState)([]),V=p()(L,2),z=V[0],M=V[1],m=new ne.Uo("components.permissionButton"),S=u()(u()(u()(u()(u()({},r.W6.CONTAINER,"Id"),r.W6.APPSTORE,"name"),r.W6.COMPOSE,"name"),r.W6.REGISTRY,"serverAddress"),r.W6.DOCKER_ENV,"name"),oe=u()(u()(u()(u()(u()({},r.W6.CONTAINER,"name"),r.W6.APPSTORE,"name"),r.W6.COMPOSE,"name"),r.W6.REGISTRY,"title"),r.W6.DOCKER_ENV,"title"),re=S[s.type],x=oe[s.type],Y=s.selected.map(function(o){return o[S[s.type]]});return P.useEffect(function(){if(K){if(!s.selected||s.selected.length==0){H.error(ne.FD.format("message.noDataSelect")),q(!1);return}(0,v.dP)({permission:{uri:s.type,key:re,value:Y}}).then(function(o){var t;(t=G.current)===null||t===void 0||t.setFieldValue("list",Object.keys(o.data.list).map(function(f){return{name:f,type:o.data.list[f].type,users:o.data.list[f].users}}))}),(0,v.lE)().then(function(o){var t,f=(t=o.data)===null||t===void 0||(t=t.list)===null||t===void 0?void 0:t.map(function(E){return{label:E.username,value:E.username}});M(f)})}},[K]),(0,T.jsx)(N.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,T.jsxs)(l.a,{name:"create",title:m.format("drawerTitle"),open:K,onOpenChange:function(t){if(!t){var f;(f=G.current)===null||f===void 0||f.resetFields()}q(t)},drawerProps:{forceRender:!0,width:ae.R_},formRef:G,trigger:(0,T.jsx)(b.ZP,{icon:(0,T.jsx)(A.Z,{}),children:m.format("drawerTriggerButton")}),onFinish:function(){var o=$()(_()().mark(function t(f){var E,h,g;return _()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:E=j()(f.list),y.prev=1,E.s();case 3:if((h=E.n()).done){y.next=9;break}return g=h.value,y.next=7,(0,v.Db)({usernames:g.users,permissionType:g.type,permission:{uri:s.type,key:re,showKey:x,value:[g.name]}});case 7:y.next=3;break;case 9:y.next=14;break;case 11:y.prev=11,y.t0=y.catch(1),E.e(y.t0);case 14:return y.prev=14,E.f(),y.finish(14);case 17:H.success(ne.FD.format("finish")),q(!1),s.onSuccess();case 20:case"end":return y.stop()}},t,null,[[1,11,14,17]])}));return function(t){return o.apply(this,arguments)}}(),children:[(0,T.jsxs)(R.Z,{ghost:!0,title:(0,T.jsx)(B.Z,{}),subTitle:m.format("batchTitle"),children:[(0,T.jsx)(n.A.Item,{name:"type",style:{marginBottom:0},children:(0,T.jsx)(c.Z.Group,{defaultValue:"admin",onChange:function(t){var f,E,h=(f=G.current)===null||f===void 0?void 0:f.getFieldValue("list");h.forEach(function(g){g.type=t,g.users=[]}),(E=G.current)===null||E===void 0||E.setFieldValue("list",h)},children:["admin","restricted","public"].map(function(o){return(0,T.jsx)(c.Z,{style:{width:240},title:m.format("dataTypeOption.".concat(o)),description:m.format("dataTypeOptionDesc.".concat(o)),value:o},o)})})}),(0,T.jsx)(O.Z,{name:["type"],children:function(t){var f=t.type;if(f==="restricted")return(0,T.jsx)(a.Z,{mode:"multiple",name:"usernames",label:m.format("formUsernames"),onChange:function(h){var g,w,y=(g=G.current)===null||g===void 0?void 0:g.getFieldValue("list");y.forEach(function(X){X.users=h}),(w=G.current)===null||w===void 0||w.setFieldValue("list",y)},rules:[{required:!0}],request:$()(_()().mark(function E(){var h,g,w;return _()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(!(z.length>0)){X.next=2;break}return X.abrupt("return",z);case 2:return X.next=4,(0,v.lE)();case 4:return g=X.sent,w=(h=g.data)===null||h===void 0||(h=h.list)===null||h===void 0?void 0:h.map(function(_e){return{label:_e.username,value:_e.username}}),M(w),X.abrupt("return",w);case 8:case"end":return X.stop()}},E)}))})}})]}),(0,T.jsx)(R.Z,{ghost:!0,title:(0,T.jsx)(k.Z,{}),subTitle:m.format("dataTitle"),children:(0,T.jsx)(ee.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:m.format("dataName"),render:function(t,f,E){var h=E.getCurrentRowData();return(0,T.jsx)(C.Z,{disabled:!0,label:m.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:m.format("dataType"),render:function(t,f,E){var h=E.getCurrentRowData();return(0,T.jsx)(i.Z.Group,{label:m.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(g){return{label:m.format("dataTypeOption.".concat(g)),value:g}})})}},{name:"users",label:m.format("dataUsers"),render:function(t,f,E){return(0,T.jsx)(O.Z,{name:["type"],children:function(g){var w=g.type;if(w=="restricted")return(0,T.jsx)(a.Z,{width:"sm",mode:"tags",name:"users",label:m.format("dataUsers"),options:z})}})}}]})})]})})});W.Z=se},3616:function(Q,W,e){e.d(W,{Ed:function(){return j},FK:function(){return _},R_:function(){return U},ob:function(){return Z}});var U=window.innerWidth<=1024?"90vw":"65vw",_="90vw",Z="60vw",j="50vh"},24963:function(Q,W,e){var U=e(67294),_=(0,U.createContext)({});W.Z=_},39900:function(Q,W,e){e.r(W),e.d(W,{default:function(){return te}});var U=e(15009),_=e.n(U),Z=e(99289),j=e.n(Z),F=e(1699),$=e(80821),D=e(36435),u=e(83403),d=e(75870),p=e(67255),P=e(86548),l=e(90078),R=e(56729),n=e(82346),c=e(42075),O=e(96074),a=e(83622),C=e(83062),i=e(67294),v=e(36146),b=e(5574),r=e.n(b),I=e(3616),N=e(24963),A=e(184),B=e(5966),k=e(52688),ee=e(97462),ae=e(90672),ne=e(62370),T=e(25593),se=e(66309),s=e(85893),ie=(0,i.forwardRef)(function(K,q){var G=(0,i.useState)(!1),J=r()(G,2),H=J[0],L=J[1],V=(0,i.useRef)(),z=(0,i.useState)(0),M=r()(z,2),m=M[0],S=M[1],oe=(0,i.useContext)(N.Z),re=oe.message,x=new v.Uo("components.image");return(0,i.useImperativeHandle)(q,function(){return{setEditId:function(o){(0,d.t1)({id:o}).then(function(t){var f;L(!0),S(o),(f=V.current)===null||f===void 0||f.setFieldsValue({title:t.data.info.title,serverAddress:t.data.info.serverAddress,username:t.data.info.setting.username,password:t.data.info.setting.password,proxy:t.data.info.setting.proxy.join(`
`),enableHttp:t.data.info.setting.enableHttp,enableAuth:!!t.data.info.setting.username})})}}}),(0,s.jsxs)(A.a,{drawerProps:{forceRender:!0,width:I.R_},name:"createRegisry",title:x.format("registryCreateTitle"),open:H,onOpenChange:function(o){L(o)},layout:"horizontal",labelCol:{span:5,offset:0},formRef:V,trigger:(0,s.jsx)(a.ZP,{type:"primary",onClick:function(){var o;(o=V.current)===null||o===void 0||o.resetFields(),S(0)},children:x.format("registryCreateTirggerButton")}),onFinish:function(){var Y=j()(_()().mark(function o(t){var f,E,h,g;return _()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,(0,d.ZH)({id:m,title:t.title,serverAddress:t.serverAddress,username:(f=t.username)!==null&&f!==void 0?f:"",password:(E=t.password)!==null&&E!==void 0?E:"",proxy:t.proxy?t.proxy.split(`
`):[],enableHttp:t.enableHttp});case 2:if(h=y.sent,!(h&&h.data&&h.data.id>0)){y.next=8;break}return re.success(v.FD.format("finish")),K.onFinish&&K.onFinish(),(g=V.current)===null||g===void 0||g.resetFields(),y.abrupt("return",!0);case 8:case"end":return y.stop()}},o)}));return function(o){return Y.apply(this,arguments)}}(),children:[(0,s.jsx)(B.Z,{label:x.format("registryCreateFormTitle"),name:"title",placeholder:x.format("registryCreateFormTitleEmpty"),disabled:m==-1,required:!0}),(0,s.jsx)(B.Z,{label:x.format("registryCreateFormServerAddress"),name:"serverAddress",placeholder:"ccr.ccs.tencentyun.com, docker.io, 127.0.0.1:5000",disabled:m==-1,required:!0,rules:[{required:!0}]}),(0,s.jsx)(k.Z,{tooltip:x.format("registryCreateFormEnableHttpTip"),label:x.format("registryCreateFormEnableHttp"),name:"enableHttp"}),(0,s.jsx)(k.Z,{label:x.format("registryCreateFormEnableAuth"),name:"enableAuth"}),(0,s.jsx)(ee.Z,{name:["enableAuth"],children:function(o){var t=o.enableAuth;return t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.Z,{label:x.format("registryCreateFormUsername"),name:"username",placeholder:x.format("registryCreateFormUsernameEmpty"),tooltip:""},"username"),(0,s.jsx)(B.Z.Password,{label:x.format("registryCreateFormPassword"),name:"password",allowClear:!0,placeholder:x.format("registryCreateFormPasswordEmpty")},"password")]})}}),(0,s.jsx)(ae.Z,{label:x.format("registryCreateFormProxy"),name:"proxy",fieldProps:{autoSize:{minRows:10}},placeholder:x.format("registryCreateFormProxyTip")}),(0,s.jsx)(ne.Z,{label:x.format("registryCreateFormProxyRecommand"),children:(0,s.jsx)(c.Z,{wrap:!0,children:["docker.1panel.live","docker.m.daocloud.io","docker.1ms.run"].map(function(Y,o){return(0,s.jsx)(T.Z.Link,{onClick:function(){var f,E,h=[];if((f=V.current)!==null&&f!==void 0&&f.getFieldValue("proxy")){var g;h=(g=V.current)===null||g===void 0?void 0:g.getFieldValue("proxy").split(`
`)}else h=[];h.includes(Y)||h.push(Y),(E=V.current)===null||E===void 0||E.setFieldValue("proxy",h.join(`
`))},children:(0,s.jsx)(se.Z,{color:"cyan",children:Y})},o)})})},"recommend")]})}),le=ie;function te(){var K=(0,i.useRef)(),q=(0,i.useRef)(),G=(0,n.useAccess)();return(0,s.jsx)(l._z,{header:{extra:[(0,s.jsx)(F.u,{access:"canSeeImageRegistryManage",children:(0,s.jsx)(le,{onFinish:function(){var H,L;!((H=K.current)===null||H===void 0)&&H.reloadAndRest&&((L=K.current)===null||L===void 0||L.reloadAndRest())},ref:q},"create")},"create")]},children:(0,s.jsx)(R.Z,{scroll:{x:"max-content"},rowKey:"id",columns:[{title:v.FD.format("listTitle"),ellipsis:!0,dataIndex:"title"},{title:"Url",dataIndex:"serverAddress"},{title:v.FD.format("listUsername"),dataIndex:["setting","username"],search:!1},{title:v.FD.format("listManage"),width:100,search:!1,fixed:"right",hidden:!G.canSeeImageRegistryManage,render:function(H,L,V,z,M){return(0,s.jsx)(c.Z,{split:(0,s.jsx)(O.Z,{type:"vertical"}),children:(0,s.jsx)(a.ZP,{type:"link",onClick:function(){var S;(S=q.current)===null||S===void 0||S.setEditId(L.id)},children:(0,s.jsx)(C.Z,{title:v.FD.format("listManageEdit"),children:(0,s.jsx)(P.Z,{})})})})}}],request:function(){var J=j()(_()().mark(function H(L,V,z){var M;return _()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,(0,d.Ot)({title:L.title,serverAddress:L.serverAddress});case 2:return M=S.sent,S.abrupt("return",{data:M.data.list,success:!0,total:M.data.list.length});case 4:case"end":return S.stop()}},H)}));return function(H,L,V){return J.apply(this,arguments)}}(),toolBarRender:function(){return[]},rowSelection:G.canSeeImageRegistryManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0}:void 0,pagination:(0,p.Oh)(),actionRef:K,tableAlertOptionRender:function(H){var L=H.selectedRowKeys,V=H.selectedRows;return(0,s.jsxs)(c.Z,{size:16,children:[(0,s.jsx)(D.Z,{type:u.W6.REGISTRY,selected:V,onSuccess:function(){var M,m;return!((M=K.current)===null||M===void 0)&&M.reloadAndRest&&((m=K.current)===null||m===void 0||m.reloadAndRest()),!0}}),(0,s.jsx)($.Z,{danger:!0,type:"primary",action:function(){return(0,d.ix)({id:L})},onSuccess:function(){var M,m;return!((M=K.current)===null||M===void 0)&&M.reloadAndRest&&((m=K.current)===null||m===void 0||m.reloadAndRest()),!0},onError:function(){var M,m;return!((M=K.current)===null||M===void 0)&&M.reset&&((m=K.current)===null||m===void 0||m.reset()),!0},confirm:"notification.confirm.title",children:v.FD.format("listManageDeleteBatch")})]})}})})}},75870:function(Q,W,e){e.d(W,{Ot:function(){return $},ZH:function(){return u},ix:function(){return p},t1:function(){return l}});var U=e(15009),_=e.n(U),Z=e(99289),j=e.n(Z),F=e(82346);function $(n){return D.apply(this,arguments)}function D(){return D=j()(_()().mark(function n(c){return _()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,F.request)("/api/common/registry/get-list",{method:"POST",data:c}));case 1:case"end":return a.stop()}},n)})),D.apply(this,arguments)}function u(n){return d.apply(this,arguments)}function d(){return d=j()(_()().mark(function n(c){return _()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,F.request)("/api/common/registry/create",{method:"POST",data:c}));case 1:case"end":return a.stop()}},n)})),d.apply(this,arguments)}function p(n){return P.apply(this,arguments)}function P(){return P=j()(_()().mark(function n(c){return _()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,F.request)("/api/common/registry/delete",{method:"POST",data:c}));case 1:case"end":return a.stop()}},n)})),P.apply(this,arguments)}function l(n){return R.apply(this,arguments)}function R(){return R=j()(_()().mark(function n(c){return _()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,F.request)("/api/common/registry/get-detail",{method:"POST",data:c}));case 1:case"end":return a.stop()}},n)})),R.apply(this,arguments)}},67255:function(Q,W,e){e.d(W,{O$:function(){return $},Oh:function(){return Z},j_:function(){return j},nX:function(){return F}});var U=e(5574),_=e.n(U);function Z(D){var u=localStorage.getItem("dpanel-pagesize");if(u=="all")return!1;var d=location.pathname.split("/").slice(-2).join("-");return{defaultCurrent:D==null?void 0:D.page,showSizeChanger:!0,defaultPageSize:parseInt(u!=null?u:"20"),onChange:function(P,l){["app-list","compose-list"].includes(d)&&localStorage.setItem("dpanel-page-"+d,"".concat(P))}}}function j(D){var u="dpanel-table-column-".concat(D),d={};if(localStorage.getItem(u)){var p;d=JSON.parse((p=localStorage.getItem(u))!==null&&p!==void 0?p:"{}")}return{defaultValue:d,onChange:function(l){localStorage.setItem("dpanel-table-column-".concat(D),JSON.stringify(l))}}}function F(D,u,d){var p=location.pathname.split("/").slice(-2).join("-");d.columnKey&&localStorage.setItem("dpanel-table-sort-".concat(p),"".concat(d.columnKey,"|").concat(d.order))}function $(D,u){var d=localStorage.getItem("dpanel-table-sort-".concat(D));if(d){var p=d.split("|"),P=_()(p,2),l=P[0],R=P[1];if(l==u)return R}}}}]);
