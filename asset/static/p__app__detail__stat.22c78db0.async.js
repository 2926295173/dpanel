"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745],{55809:function(N,b,e){var j=e(87462),a=e(67294),U=e(44805),_=e(84089),h=function(C,p){return a.createElement(_.Z,(0,j.Z)({},C,{ref:p,icon:U.Z}))},E=a.forwardRef(h);b.Z=E},60433:function(N,b,e){var j=e(87462),a=e(67294),U=e(69782),_=e(84089),h=function(C,p){return a.createElement(_.Z,(0,j.Z)({},C,{ref:p,icon:U.Z}))},E=a.forwardRef(h);b.Z=E},1699:function(N,b,e){e.d(b,{u:function(){return D}});var j=e(9783),a=e.n(j),U=e(97857),_=e.n(U),h=e(67294),E=e(82346),A=e(40411),C=e(42075),p=e(85893),D=function(r){var g=(0,E.useAccess)(),W=Array.isArray(r.access)?r.access:[r.access],c,v=r.fallback;return typeof r.children=="function"?(c=r.children(W.reduce(function(d,x){return _()(_()({},d),{},a()({},x,g[x]))},{})),c||(c=v)):W.every(function(d){return g[d]})?c=r.children:c=v,!v&&c&&r.showProTips&&g.canSeeEnableCe&&(c=(0,p.jsx)(A.Z,{offset:r.showProTipsOffset,count:"PRO",color:"gold",style:{fontWeight:"bold"},children:c})),!v&&c&&r.showProRibbonTips&&g.canSeeEnableCe&&(c=(0,p.jsx)(A.Z.Ribbon,{text:"PRO",color:"gold",style:{fontWeight:"bold"},children:c})),r.space?(0,p.jsx)(C.Z,_()(_()({},r.space),{},{children:c})):c}},27619:function(N,b,e){e.d(b,{Z:function(){return S}});var j=e(97857),a=e.n(j),U=e(19632),_=e.n(U),h=e(5574),E=e.n(h),A=e(64183),C=e(82346),p=e(67294),D=e(85893);function S(r){var g,W=(0,p.useState)("academy"),c=E()(W,2),v=c[0],d=c[1],x=Math.max.apply(Math,_()(r.data.map(function(L){var O;return(O=L[r.yField])!==null&&O!==void 0?O:0}))),M=(0,C.useModel)("@@initialState"),T=M.initialState,F={xField:r.xField,yField:r.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:r.yLabelFormatter},scale:{y:{domainMin:(g=r.yDomainMin)!==null&&g!==void 0?g:0,domainMax:r.yDomainMax?r.yDomainMax:r.yDomainMaxCallback?r.yDomainMaxCallback(x):x}},data:r.data};return r.yLabelFormatter&&(F.axis.y.labelFormatter=r.yLabelFormatter),r.colorField&&(F.colorField=r.colorField),(0,p.useEffect)(function(){var L=window.matchMedia("(prefers-color-scheme: dark)");(T==null?void 0:T.theme.algorithm)=="dark"||L.matches?d("classicDark"):d("academy")},[T]),(0,D.jsx)(A.Z,a()({theme:v},F))}},24963:function(N,b,e){var j=e(67294),a=(0,j.createContext)({});b.Z=a},50070:function(N,b,e){e.r(b),e.d(b,{AppDetailContext:function(){return x},default:function(){return M}});var j=e(15009),a=e.n(j),U=e(99289),_=e.n(U),h=e(5574),E=e.n(h),A=e(1699),C=e(24963),p=e(13822),D=e(55809),S=e(90078),r=e(82346),g=e(25593),W=e(28036),c=e(50136),v=e(67294),d=e(85893),x=(0,v.createContext)({});function M(){var T,F=(0,v.useContext)(C.Z),L=F.loading,O=(0,r.useParams)(),i=(0,r.useSearchParams)(),s=E()(i,2),f=s[0],t=s[1],ae=(T=f.get("tab"))!==null&&T!==void 0?T:"edit",I=(0,v.useState)("edit"),K=E()(I,2),$=K[0],y=K[1],k=(0,r.useNavigate)(),z=(0,v.useState)(1),o=E()(z,2),J=o[0],H=o[1],B=[{label:(0,d.jsx)(r.Link,{to:"/app/detail/edit/".concat(O.id,"?tab=edit"),children:"\u5BB9\u5668\u8BE6\u60C5"}),key:"edit"},{label:(0,d.jsx)(r.Link,{to:"/app/detail/network/".concat(O.id,"?tab=network"),children:"\u7F51\u7EDC\u7BA1\u7406"}),key:"network"},{label:(0,d.jsx)(g.Z.Link,{children:"\u6587\u4EF6\u7BA1\u7406"}),key:"file",onClick:function(){k("/app/detail/file/".concat(O.id,"?tab=file"))}},{label:(0,d.jsx)(g.Z.Link,{children:"\u8FD0\u884C\u65E5\u5FD7"}),key:"log",onClick:function(){k("/app/detail/log/".concat(O.id,"?tab=log"))}},{label:(0,d.jsx)(g.Z.Link,{children:"\u8FD0\u884C\u72B6\u6001"}),key:"stat",onClick:function(){k("/app/detail/stat/".concat(O.id,"?tab=stat"))}},{label:"",key:"containerName",icon:(0,d.jsx)(D.Z,{}),disabled:!0}],V=(0,v.useState)(B),Y=E()(V,2),Q=Y[0],X=Y[1];(0,v.useEffect)(function(){L.show(),y(ae);var G=function(){var q=_()(a()().mark(function ee(){var P,u,n;return a()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return P=B,l.prev=1,l.next=4,(0,p.jV)({md5:(u=O.id)!==null&&u!==void 0?u:""});case 4:n=l.sent,P.map(function(Z){return Z.key=="containerName"&&(Z.label=n.data.info.Name),(!n.data.info.State.Running||n.data.info.State.Restarting)&&(Z.key=="file"||Z.key=="stat")&&(Z.disabled=!0),Z}),X(P),l.next=13;break;case 9:return l.prev=9,l.t0=l.catch(1),k("/app/list"),l.abrupt("return");case 13:return l.prev=13,L.destroy(),l.finish(13);case 16:case"end":return l.stop()}},ee,null,[[1,9,13,16]])}));return function(){return q.apply(this,arguments)}}();G()},[J,O]);var m=function(q){y(q.key)};return(0,d.jsx)(x.Provider,{value:{reload:function(){H(J+1)}},children:(0,d.jsxs)(S._z,{header:{extra:[(0,d.jsx)(A.u,{access:"canSeeContainerListManageCreate",children:(0,d.jsx)(r.Link,{to:"/app/create/image",children:(0,d.jsx)(W.ZP,{type:"primary",children:"\u521B\u5EFA\u5BB9\u5668"})})},"create")]},children:[(0,d.jsx)(c.Z,{mode:"horizontal",onClick:m,selectedKeys:[$],items:Q}),(0,d.jsx)(r.Outlet,{})]})})}},41748:function(N,b,e){e.r(b),e.d(b,{default:function(){return ae}});var j=e(15009),a=e.n(j),U=e(99289),_=e.n(U),h=e(5574),E=e.n(h),A=e(19632),C=e.n(A),p=e(27619),D=e(67294);function S(I){var K=I.reqFunction,$=I.interval,y=I.maxPolling,k=I.pollingStatus,z=I.inPath,o=(0,D.useRef)(null),J=0,H=function V(){o.current=window.setTimeout(_()(a()().mark(function Y(){var Q;return a()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(J++>=y)){m.next=3;break}return B(),m.abrupt("return");case 3:if(m.prev=3,!(z&&window.location.href.indexOf(z)==-1)){m.next=7;break}return B(),m.abrupt("return");case 7:return m.next=9,K();case 9:Q=m.sent,V(),m.next=17;break;case 13:m.prev=13,m.t0=m.catch(3),B(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",m.t0);case 17:case"end":return m.stop()}},Y,null,[[3,13]])})),$)},B=function(){console.log("end polling"),o.current&&window.clearTimeout(o.current)};return(0,D.useEffect)(function(){return console.log((k?"start":"waiting")+" polling, max "+y),k&&H(),function(){B()}},[$,y,k]),{endPolling:B}}var r=S,g=e(24963),W=e(82346);function c(I){return v.apply(this,arguments)}function v(){return v=_()(a()().mark(function I(K){return a()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",(0,W.request)("/api/app/container/get-stat-info",{method:"POST",data:K}));case 1:case"end":return y.stop()}},I)})),v.apply(this,arguments)}function d(I){return x.apply(this,arguments)}function x(){return x=_()(a()().mark(function I(K){return a()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",(0,W.request)("/api/app/container/get-process-info",{method:"POST",data:K}));case 1:case"end":return y.stop()}},I)})),x.apply(this,arguments)}var M=e(5251),T=e(12122),F=e(60433),L=e(38345),O=e(60940),i=e(50070),s=e(85893),f=new Date().toLocaleTimeString(),t={total:0,memory:[{date:f,usage:0,source:{usage:0,limit:0}}],cpu:[{date:f,usage:0}],network:[{usage:0,type:"rx",date:f,source:{usage:0}},{usage:0,type:"tx",date:f,source:{usage:0}}],io:[{usage:0,type:"read",date:f,source:{usage:0}},{usage:0,type:"write",date:f,source:{usage:0}}]};function ae(){var I=function(u,n){switch(n.type){case"update":var R=new Date(n.payload.read).toLocaleTimeString(),l=n.payload.cpu_stats.cpu_usage.total_usage-n.payload.precpu_stats.cpu_usage.total_usage,Z=n.payload.cpu_stats.system_cpu_usage-n.payload.precpu_stats.system_cpu_usage,w={total:u.total+1,memory:[],cpu:[].concat(C()(u.cpu),[{date:R,usage:l/Z*n.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return n.payload.memory_stats&&n.payload.memory_stats.limit&&n.payload.memory_stats.usage&&(w.memory=[].concat(C()(u.memory),[{date:R,usage:Math.round(n.payload.memory_stats.usage),source:{usage:n.payload.memory_stats.usage,limit:n.payload.memory_stats.limit}}])),n.payload.networks&&(w.network=[].concat(C()(u.network),[{date:R,usage:parseFloat(n.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:n.payload.networks.eth0.rx_bytes}},{date:R,usage:parseFloat(n.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:n.payload.networks.eth0.tx_bytes}}])),n.payload.blkio_stats&&n.payload.blkio_stats.io_service_bytes_recursive&&n.payload.blkio_stats.io_service_bytes_recursive.length>0&&(w.io=[].concat(C()(u.io),[{date:R,usage:parseFloat(n.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:n.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:n.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:R,usage:parseFloat(n.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:n.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:n.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),w}},K=(0,D.useContext)(g.Z),$=K.loading,y=(0,W.useParams)(),k=(0,D.useReducer)(I,t),z=E()(k,2),o=z[0],J=z[1],H=(0,D.useState)(0),B=E()(H,2),V=B[0],Y=B[1],Q=(0,D.useState)(),X=E()(Q,2),m=X[0],G=X[1],q=r({reqFunction:function(){var P=_()(a()().mark(function n(){var R,l;return a()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,c({id:(R=y.id)!==null&&R!==void 0?R:""});case 2:l=w.sent,$.destroy(),J({type:"update",payload:l});case 5:case"end":return w.stop()}},n)}));function u(){return P.apply(this,arguments)}return u}(),interval:3e3,maxPolling:999,pollingStatus:V!=0,inPath:"tab=stat"}),ee=(0,D.useContext)(i.AppDetailContext);return(0,D.useEffect)(function(){ee.reload()},[]),(0,D.useEffect)(function(){var P,u;$.show(),c({id:(P=y.id)!==null&&P!==void 0?P:""}).then(function(n){return Y(Math.round(n.memory_stats.limit)),!0}),d({id:(u=y.id)!==null&&u!==void 0?u:""}).then(function(n){var R={columns:[],data:[]};n.data.list.Titles.map(function(l){R.columns.push({title:l,label:l,dataIndex:l})}),n.data.list.Processes.map(function(l,Z){R.data.push({UID:l[0],PID:l[1],PPID:l[2],C:l[3],STIME:l[4],TTY:l[5],TIME:l[6],CMD:l[7]})}),G(R)})},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(L.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[o.memory&&o.memory.length>0&&(0,s.jsx)(L.Z,{colSpan:12,title:(0,s.jsx)(T.Z,{}),subTitle:"Memory usage: ".concat((0,M.FI)(o.memory[o.memory.length-1].source.usage)," / ").concat((0,M.FI)(o.memory[o.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,s.jsx)(p.Z,{yField:"usage",xField:"date",data:o.memory,yDomainMaxCallback:function(u){return u*2},yLabelFormatter:function(u){return(0,M.FI)(parseFloat(u))}})}),(0,s.jsx)(L.Z,{colSpan:12,title:(0,s.jsx)(T.Z,{}),subTitle:"Cpu usage: ".concat(o.cpu[o.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,s.jsx)(p.Z,{yField:"usage",xField:"date",data:o.cpu,yDomainMaxCallback:function(u){return u*1.5},yLabelFormatter:function(u){return"".concat(u,"%")}})}),o.io&&o.io.length>0&&(0,s.jsx)(L.Z,{colSpan:12,title:(0,s.jsx)(T.Z,{}),subTitle:"I/O: ".concat((0,M.FI)(o.io[o.io.length-1].source.usage)," / ").concat((0,M.FI)(o.io[o.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,s.jsx)(p.Z,{yField:"usage",xField:"date",colorField:"type",data:o.io,yDomainMaxCallback:function(u){return u*2},yLabelFormatter:function(u){return(0,M.FI)(parseFloat(u))}})}),o.network&&o.network.length>0&&(0,s.jsx)(L.Z,{colSpan:12,title:(0,s.jsx)(T.Z,{}),subTitle:"Network: ".concat((0,M.FI)(o.network[o.network.length-1].source.usage)," / ").concat((0,M.FI)(o.network[o.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,s.jsx)(p.Z,{yField:"usage",xField:"date",colorField:"type",data:o.network,yDomainMaxCallback:function(u){return u*2},yLabelFormatter:function(u){return(0,M.FI)(parseFloat(u))}})})]}),(0,s.jsx)(L.Z,{title:(0,s.jsx)(F.Z,{}),subTitle:"Progress",children:(0,s.jsx)(O.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:m==null?void 0:m.columns,dataSource:m==null?void 0:m.data,pagination:{pageSize:10}})})]})}},13822:function(N,b,e){e.d(b,{IE:function(){return C},IW:function(){return E},KK:function(){return W},LJ:function(){return v},RF:function(){return T},Re:function(){return x},aF:function(){return L},eE:function(){return r},jV:function(){return D}});var j=e(15009),a=e.n(j),U=e(99289),_=e.n(U),h=e(82346);function E(i){return A.apply(this,arguments)}function A(){return A=_()(a()().mark(function i(s){return a()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,h.request)("/api/app/container/status",{method:"POST",data:s}));case 1:case"end":return t.stop()}},i)})),A.apply(this,arguments)}function C(i){return p.apply(this,arguments)}function p(){return p=_()(a()().mark(function i(s){return a()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,h.request)("/api/app/container/get-list",{data:s,method:"POST"}));case 1:case"end":return t.stop()}},i)})),p.apply(this,arguments)}function D(i){return S.apply(this,arguments)}function S(){return S=_()(a()().mark(function i(s){return a()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,h.request)("/api/app/container/get-detail",{data:s,method:"POST"}));case 1:case"end":return t.stop()}},i)})),S.apply(this,arguments)}function r(i){return g.apply(this,arguments)}function g(){return g=_()(a()().mark(function i(s){return a()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,h.request)("/api/app/container/update",{data:s,method:"POST"}));case 1:case"end":return t.stop()}},i)})),g.apply(this,arguments)}function W(){return c.apply(this,arguments)}function c(){return c=_()(a()().mark(function i(){return a()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",(0,h.request)("/api/app/container/prune",{method:"POST"}));case 1:case"end":return f.stop()}},i)})),c.apply(this,arguments)}function v(i){return d.apply(this,arguments)}function d(){return d=_()(a()().mark(function i(s){return a()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,h.request)("/api/app/container/export",{method:"POST",data:s,responseType:"blob"}));case 1:case"end":return t.stop()}},i)})),d.apply(this,arguments)}function x(i){return M.apply(this,arguments)}function M(){return M=_()(a()().mark(function i(s){return a()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,h.request)("/api/app/container/commit",{method:"POST",data:s}));case 1:case"end":return t.stop()}},i)})),M.apply(this,arguments)}function T(i){return F.apply(this,arguments)}function F(){return F=_()(a()().mark(function i(s){return a()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,h.request)("/api/app/container/upgrade",{method:"POST",data:s}));case 1:case"end":return t.stop()}},i)})),F.apply(this,arguments)}function L(i){return O.apply(this,arguments)}function O(){return O=_()(a()().mark(function i(s){return a()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,h.request)("/api/app/container/copy",{method:"POST",data:s}));case 1:case"end":return t.stop()}},i)})),O.apply(this,arguments)}}}]);
