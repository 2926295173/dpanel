"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9626],{69626:function(Ue,ge,n){n.d(ge,{Z:function(){return fn}});var ye=n(19632),p=n.n(ye),je=n(5574),v=n.n(je),M=n(15009),d=n.n(M),pe=n(99289),D=n.n(pe),s=n(67294),ne=n(80821),L=n(90098),Ce=n(52209),b=n(86548),ie=n(43425),Y=n(74842),ve=n(48689),U=n(33160),xe=n(87784),oe=n(30159),we=n(25035),W=n(38345),de=n(97269),ue=n(86615),k=n(62370),V=n(82346),Fe=n(85265),J=n(42075),he=n(96074),te=n(25593),me=n(83062),Se=n(40056),ce=n(84567),Re=n(28036),l=n(99861),i=n(91058),G=n(79245),r=n(60940),Ve=n(55241),be=n(78451),We=n(37413),Ke=n(94359),De=n(24963),Ge=n(91806),Ne=n(60433),Ae=n(89035),Qe=n(99922),ze=n(46357),Ye=n(87662),He=n(5251),e=n(85893);function Xe(o){var re=(0,s.useState)(""),H=v()(re,2),A=H[0],N=H[1],S=(0,s.useContext)(De.Z),j=S.loading,_=S.lang,C=S.notice,R=S.message,t=(0,s.useRef)(),T=(0,s.useRef)(),$=(0,s.useState)(!1),h=v()($,2),g=h[0],F=h[1];return(0,s.useEffect)(function(){(0,Ye.K3)().then(function(P){var Q;N((Q=P.data.serverUrl)!==null&&Q!==void 0?Q:"")}),F(!1)},[o.containerList]),o.containerList&&(0,e.jsxs)(W.Z,{ghost:!0,title:(0,e.jsx)(Ge.Z,{}),subTitle:"\u5BB9\u5668\u5217\u8868",extra:o.enableSelectService&&(0,e.jsx)(ce.Z,{onChange:function(Q){F(Q.target.checked)},children:"\u81EA\u5B9A\u4E49\u90E8\u7F72\u5BB9\u5668\u670D\u52A1\uFF1F"},"selectService"),children:[(0,e.jsx)(Qe.Z,{ref:t}),(0,e.jsx)(ze.Z,{ref:T}),(0,e.jsx)(r.Z,{scroll:{x:"max-content"},rowKey:"service",pagination:!1,columns:[{title:"\u5BB9\u5668\u540D\u79F0",dataIndex:"name",width:200,render:function(Q,c,q){return(0,e.jsx)(me.Z,{title:c.service,children:(0,e.jsx)(be.Z,{content:c.name?(0,He.fi)(c.name,"/"):c.service})})}},{title:"\u7AEF\u53E3",render:function(Q,c,q){var I=[],z=[];return c.publishers&&c.publishers.map(function(E){E.publishedPort?I.push({PrivatePort:E.targetPort,Type:E.protocol,IP:E.url,PublicPort:E.publishedPort}):E.publishedPort&&z.push({PrivatePort:E.targetPort,Type:E.protocol,IP:E.url,PublicPort:E.publishedPort})}),(0,e.jsx)(We.Z,{publicPort:I,privatePort:z,domain:[],serverIp:A})}},{title:"\u72B6\u6001",render:function(Q,c,q){return(0,e.jsx)(Ke.Z,{status:c.state,message:{content:_("container.status.".concat(c.state)),placement:"top",showInTag:!0}},c.name)}},{title:"\u64CD\u4F5C",fixed:"right",render:function(Q,c,q){return(0,e.jsxs)(J.Z,{split:(0,e.jsx)(he.Z,{type:"vertical"}),children:[c.name==""&&(0,e.jsx)(Ve.Z,{placement:"left",content:(0,e.jsx)(W.Z,{ghost:!0,title:"\u5BB9\u5668\u5185\u73AF\u5883\u53D8\u91CF",children:(0,e.jsx)(J.Z,{direction:"vertical",children:c.environment&&Object.keys(c.environment).map(function(I){if(c.environment&&c.environment[I])return(0,e.jsx)(te.Z.Text,{code:!0,children:"".concat(I,"=").concat(c.environment[I])},I)})})}),children:(0,e.jsx)(Ne.Z,{})}),c.name!=""&&(0,e.jsx)(te.Z.Link,{onClick:function(){var z;(z=T.current)===null||z===void 0||z.show(c.name)},children:(0,e.jsx)(ie.Z,{})},"container"),c.state=="running"&&(0,e.jsx)(te.Z.Link,{onClick:function(){var z;(z=t.current)===null||z===void 0||z.show({url:"/console/container/".concat(c.name),title:c.name})},children:(0,e.jsx)(Ae.Z,{})},"console")]})}}],dataSource:o.containerList,rowSelection:g&&o.containerList?{defaultSelectedRowKeys:o.containerList.map(function(P){return P.service}),onChange:function(Q,c,q){o.selectServiceFinish&&o.selectServiceFinish(Q)}}:void 0})]})}var Je=n(81146),_e=n(45742),Te=n(3616),qe=(0,s.forwardRef)(function(o,re){(0,s.useImperativeHandle)(re,function(){return{show:function($){return D()(d()().mark(function h(){return d()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:R(o.composeItem),S(!0);case 2:case"end":return F.stop()}},h)}))()}}});var H=(0,s.useState)(!1),A=v()(H,2),N=A[0],S=A[1],j=(0,s.useState)(),_=v()(j,2),C=_[0],R=_[1],t=(0,s.useRef)();return(0,e.jsxs)(e.Fragment,{children:[o.showTriggerButton&&(0,e.jsx)(te.Z.Link,{onClick:D()(d()().mark(function T(){return d()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:R(o.composeItem),S(!0);case 2:case"end":return h.stop()}},T)})),children:(0,e.jsx)(me.Z,{title:"\u8FD0\u884C\u65E5\u5FD7",children:(0,e.jsx)(_e.Z,{})})},"log"),(0,e.jsx)(Fe.Z,{title:"\u4EFB\u52A1\u65E5\u5FD7",open:N,forceRender:!0,onClose:function(){S(!1)},afterOpenChange:function($){if($)setTimeout(function(){var g,F;(g=t.current)===null||g===void 0||g.start(),(F=t.current)===null||F===void 0||F.fit()},1e3);else{var h;(h=t.current)===null||h===void 0||h.close()}},width:Te.FK,children:C&&N&&(0,e.jsx)(Je.Z,{ref:t,showInDrawer:!0,id:"compose:log:".concat(String(C.id||C.name)),request:function(){var T=D()(d()().mark(function $(h){var g;return d()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(0,L.Yz)({id:C.id||C.name,lineTotal:h.lineTotal,download:(g=h.download)!==null&&g!==void 0?g:!1,showTime:h.showTime});case 2:case"end":return P.stop()}},$)}));return function($){return T.apply(this,arguments)}}(),download:function(){var T=D()(d()().mark(function $(h){var g;return d()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(0,L.vf)({id:C.id||C.name,lineTotal:h.lineTotal,showTime:h.showTime,download:!0});case 2:return g=P.sent,P.abrupt("return",{data:new Blob([g],{type:"text/plain"}),name:o.composeItem.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return P.stop()}},$)}));return function($){return T.apply(this,arguments)}}()})})]})}),en=qe,Be=n(184),nn=n(95213),tn=n(95089),rn=n(92398);function an(o){var re=(0,s.useContext)(De.Z),H=re.message,A=(0,s.useRef)();return o.composeItem.yamlList&&(0,e.jsx)(Be.a,{drawerProps:{width:Te.R_},title:"\u7F16\u8F91\u4EFB\u52A1 Yaml",formRef:A,trigger:(0,e.jsx)(te.Z.Link,{children:(0,e.jsx)(me.Z,{title:"Yaml",children:"Yaml"})}),onFinish:function(){var N=D()(d()().mark(function S(j){return d()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,(0,L.im)({id:String(o.composeItem.id?o.composeItem.id:o.composeItem.name),name:o.composeItem.name,type:o.composeItem.setting.type,yaml:j.yaml,yamlOverride:j.yamlOverride});case 2:return C.next=4,(0,L.xC)({yaml:[j.yaml,j.yamlOverride],environment:o.composeItem.setting.environment,id:o.composeItem.id||o.composeItem.name});case 4:return o.onFinish&&o.onFinish(),C.abrupt("return",!0);case 6:case"end":return C.stop()}},S)}));return function(S){return N.apply(this,arguments)}}(),children:(0,e.jsx)(W.Z,{ghost:!0,children:(0,e.jsx)(rn.Z,{items:o.composeItem.yamlList.map(function(N,S){var j=[{label:"Yaml \u6587\u4EF6",key:"yaml"},{label:"\u8986\u76D6 Yaml \u6587\u4EF6",key:"yamlOverride"}];return{label:j[S].label,key:j[S].key,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(k.Z,{hidden:!0,name:j[S].key}),(0,e.jsx)(k.Z,{shouldUpdate:!0,children:function(C){return(0,e.jsx)(tn.ZP,{onFocus:function(){if(j[S].key=="yaml"&&o.composeItem.setting.type=="remoteUrl"){H.error("\u8FDC\u7A0Byaml\u6587\u4EF6\u65E0\u6CD5\u4FEE\u6539\uFF0C\u8BF7\u901A\u8FC7\u3010\u8986\u76D6 yaml \u6587\u4EF6\u3011\u7684\u65B9\u5F0F\u4FEE\u6539\u5185\u5BB9\u3002");return}},readOnly:j[S].key=="yaml"&&o.composeItem.setting.type=="remoteUrl",theme:"dark",minHeight:"550px",value:N,onChange:function(t){C.setFieldValue(j[S].key,t)},extensions:[nn.RI.yaml()]})}})]})}})})})})}var sn=n(65913),Oe=n(1699),on=n(28230),ln=n(35887),un=(0,s.forwardRef)(function(o,re){(0,s.useImperativeHandle)(re,function(){return{show:function(){return D()(d()().mark(function R(){var t;return d()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return _(!0),(t=A.current)===null||t===void 0||t.clear(),$.next=4,new Promise(function(h){return setTimeout(function(){var g;(g=A.current)===null||g===void 0||g.fit(),h(!0)},1e3)});case 4:case"end":return $.stop()}},R)}))()},close:function(){var R;_(!1),(R=A.current)===null||R===void 0||R.clear()}}});var H=(0,V.useModel)("subscriber"),A=(0,s.useRef)(),N=(0,s.useState)(!1),S=v()(N,2),j=S[0],_=S[1];return H.addDataHandler("compose:"+o.id,function(C){var R;(R=A.current)===null||R===void 0||R.write(C.data)}),(0,e.jsx)(W.Z,{hidden:!j,ghost:!0,title:(0,e.jsx)(Ae.Z,{}),subTitle:"\u63A7\u5236\u53F0",extra:(0,e.jsx)(J.Z,{children:(0,e.jsx)(ne.Z,{action:function(){var R;return(R=A.current)===null||R===void 0||R.clear(),(0,L.U_)({})},icon:(0,e.jsx)(ve.Z,{}),danger:!0,onSuccess:function(){},children:"\u4E2D\u6B62\u6267\u884C"},"kill")}),children:(0,e.jsx)(ln.Z,{id:"create-log-".concat(o.id),height:"200px",style:{fontSize:12},ref:A})})}),Me=un,Ze=n(36146),cn=(0,s.forwardRef)(function(o,re){var H=(0,s.useState)(!1),A=v()(H,2),N=A[0],S=A[1],j=new Ze.Uo("components.appCompose.composeDetailQuick"),_=(0,s.useState)(),C=v()(_,2),R=C[0],t=C[1],T=(0,s.useRef)(),$=(0,s.useRef)();return(0,s.useImperativeHandle)(re,function(){return{show:function(g){var F;S(!0),t(g),(F=T.current)===null||F===void 0||F.setFieldsValue({environment:g.detail.setting.environment})}}}),(0,e.jsxs)(Be.a,{formRef:T,open:N,drawerProps:{forceRender:!0},title:j.format("taskDrawerTitle",{name:""}),onOpenChange:function(g){S(g)},children:[(0,e.jsx)(W.Z,{title:(0,e.jsx)(ie.Z,{}),subTitle:j.format("managerTitle"),ghost:!0,children:R&&(0,e.jsx)(J.Z,{wrap:!0,split:(0,e.jsx)(he.Z,{type:"vertical"}),children:(0,e.jsx)(ne.Z,{icon:(0,e.jsx)(Y.Z,{}),type:"primary",confirmOnOpenChange:function(g){var F;g&&(!((F=T.current)===null||F===void 0)&&F.resetFields)&&T.current.resetFields()},action:D()(d()().mark(function h(){var g,F,P;return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return(g=$.current)===null||g===void 0||g.show(),P=(F=T.current)===null||F===void 0?void 0:F.getFieldValue("environment"),c.next=4,(0,L.Oh)({id:R.detail.name,environment:P,autoRemove:!0});case 4:S(!1),o.onFinish&&o.onFinish(P);case 6:case"end":return c.stop()}},h)})),children:j.format("managerCreateButton")},"create")})},"operator"),R&&(0,e.jsx)(Me,{ref:$,id:R.detail.name}),(0,e.jsx)(W.Z,{title:j.format("envTitle"),subTitle:j.format("envSubTitle"),tooltip:j.format("envTip"),ghost:!0,children:(0,e.jsx)(i.Z,{showCardGhost:!0,name:"environment",showDisableName:!0,requireValue:!0,showDeleteButton:!1})})]})}),dn=cn,mn=(0,s.forwardRef)(function(o,re){var H;(0,s.useImperativeHandle)(re,function(){return{show:function(u){return D()(d()().mark(function m(){var x;return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return(x=le.current)===null||x===void 0||x.close(),j(!0),a.prev=2,a.next=5,ke(u);case 5:a.next=12;break;case 7:a.prev=7,a.t0=a.catch(2),j(!1),T(void 0),o.onClose&&o.onClose();case 12:case"end":return a.stop()}},m,null,[[2,7]])}))()}}});var A=(0,s.useState)(!1),N=v()(A,2),S=N[0],j=N[1],_=(0,V.useNavigate)(),C=(0,s.useState)(),R=v()(C,2),t=R[0],T=R[1],$=(0,s.useState)(),h=v()($,2),g=h[0],F=h[1],P=(0,s.useState)(0),Q=v()(P,2),c=Q[0],q=Q[1],I=(0,s.useRef)(),z=(0,s.useRef)(),E=(0,s.useRef)(),Le=(0,s.useRef)(),le=(0,s.useRef)(),$e=(0,s.useRef)(),pn=(0,s.useContext)(De.Z),vn=pn.message,Pe=(0,V.useAccess)(),Z=new Ze.Uo("components.appCompose.composeDetailQuick"),hn=(0,s.useRef)();function gn(y){return Ie.apply(this,arguments)}function Ie(){return Ie=D()(d()().mark(function y(u){var m,x,w;return d()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(m=le.current)===null||m===void 0?void 0:m.show();case 2:if(!u.pullImageUseDPanel){f.next=6;break}return f.next=5,(x=Le.current)===null||x===void 0?void 0:x.start();case 5:(w=Le.current)===null||w===void 0||w.finish();case 6:return f.prev=6,f.next=9,(0,L.Oh)(u);case 9:o.onDeployFinish&&o.onDeployFinish(),f.next=15;break;case 12:f.prev=12,f.t0=f.catch(6),o.onDeployFailed&&o.onDeployFailed(t);case 15:q(c+1);case 16:case"end":return f.stop()}},y,null,[[6,12]])})),Ie.apply(this,arguments)}function ke(y){return Ee.apply(this,arguments)}function Ee(){return Ee=D()(d()().mark(function y(u){var m,x,w,a,f,ee,X;return d()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return(m=$e.current)===null||m===void 0||m.show(),(x=I.current)===null||x===void 0||x.resetFields(),K.next=4,(0,L.Pn)({id:u}).finally(D()(d()().mark(function O(){var B;return d()().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:(B=$e.current)===null||B===void 0||B.destroy();case 1:case"end":return ae.stop()}},O)}))).catch(function(O){throw O});case 4:w=K.sent,a=w.data.detail,a.setting.status&&a.setting.status.indexOf("running")>-1&&(a.isRunning=!0),a.setting.status&&a.setting.status.indexOf("paused")>-1&&(a.isPaused=!0),a.setting.status&&a.setting.status.indexOf("exited")>-1&&(a.isExited=!0),a.setting.status&&a.setting.status=="waiting"?a.isDeploy=!1:a.isDeploy=!0,a.setting.status&&a.setting.status.indexOf("created")>-1&&(a.isCreated=!0,a.isDeploy=!1),f=w.data.project,f&&(a.imageList=p()(new Set(Object.keys(f.services).map(function(O){var B;return(B=f.services[O].image)!==null&&B!==void 0?B:""})))),a.containerList=w.data.containerList,(!a.containerList||a.containerList.length==0)&&f&&f.services&&(a.containerList=Object.keys(f.services).map(function(O){return{name:"",service:O,publishers:f.services[O].ports?f.services[O].ports.map(function(B){var fe;return{url:"",targetPort:B.target,publishedPort:parseInt(B.published),protocol:(fe=B.protocol)!==null&&fe!==void 0?fe:""}}):[],state:"waiting",status:"",environment:f.services[O].environment}})),a.containerList&&((ee=I.current)===null||ee===void 0||ee.setFieldValue("deployServiceName",w.data.detail.setting.deployServiceName)),a.yamlList=w.data.yaml,T(a),F(w.data.task),w.data.yaml&&w.data.yaml.map(function(O){(0,G.m)(O).map(function(B){a.setting.environment&&!a.setting.environment.find(function(fe){return fe.name==B.name})&&a.setting.environment.push(B)})}),w.data.detail.setting.environment&&((X=I.current)===null||X===void 0||X.setFieldValue("environment",w.data.detail.setting.environment));case 21:case"end":return K.stop()}},y)})),Ee.apply(this,arguments)}return(0,s.useEffect)(function(){c>0&&t&&ke(t.id||t.name).catch(function(y){j(!1)})},[c]),(0,e.jsxs)(Fe.Z,{width:Te.R_,forceRender:!0,extra:t&&t.setting.type!="dangling"&&(0,e.jsxs)(J.Z,{split:(0,e.jsx)(he.Z,{type:"vertical"}),children:[t.isDeploy&&(0,e.jsx)(en,{composeItem:t,showTriggerButton:!0}),Pe.canSeeComposeListManage&&(0,e.jsx)(on.Z,{trigger:(0,e.jsx)(te.Z.Link,{children:(0,e.jsx)(Ce.Z,{})},"network")},"network-create"),Pe.canSeeComposeListManage&&(0,e.jsx)(an,{composeItem:t,onFinish:D()(d()().mark(function y(){return d()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:vn.info(Z.format("messageYamlEditFinish")),q(c+1);case 2:case"end":return m.stop()}},y)}))}),Pe.canSeeComposeListManageCreate&&(0,e.jsx)(V.Link,{to:"/compose/create?id="+(t.id||t.name),children:(0,e.jsx)(me.Z,{title:Z.format("drawerEditButtonTip"),children:(0,e.jsx)(b.Z,{})})})]}),title:(0,e.jsx)(J.Z,{children:Z.format("drawerTitle",{name:(H=t==null?void 0:t.name)!==null&&H!==void 0?H:""})}),open:S,onClose:function(){j(!1),T(void 0),o.onClose&&o.onClose()},children:[(0,e.jsx)(dn,{onFinish:function(u){var m,x,w,a=((m=I.current)===null||m===void 0?void 0:m.getFieldFormatValue)&&((x=I.current)===null||x===void 0?void 0:x.getFieldFormatValue("environment"));a==null||a.forEach(function(f,ee){var X=u.find(function(se){return se.name==f.name});X&&(a[ee].value=X.value)}),!((w=I.current)===null||w===void 0)&&w.setFieldValue&&I.current.setFieldValue("environment",a)},ref:hn}),(0,e.jsx)(sn.Z,{ref:$e,children:(0,e.jsxs)(W.Z,{direction:"column",ghost:!0,gutter:[10,10],children:[(0,e.jsxs)(W.Z,{title:(0,e.jsx)(ie.Z,{}),subTitle:Z.format("managerTitle"),ghost:!0,extra:(0,e.jsx)(e.Fragment,{children:t&&t.imageList&&t.imageList.length>0&&(0,e.jsx)(l.Z,{ref:Le,image:t.imageList})}),children:[t&&t.setting.type=="dangling"&&(0,e.jsx)(Se.Z,{type:"warning",showIcon:!0,description:(0,e.jsxs)("div",{children:[Z.format("managerStatusDanglingAlert",{name:t.name})," ",(0,e.jsx)("a",{href:"https://dpanel.cc/#/zh-cn/manual/compose/external",target:"_blank",children:Ze.FD.format("help")})]})}),t&&t.setting.type!="dangling"&&(0,e.jsxs)(J.Z,{wrap:!0,split:(0,e.jsx)(he.Z,{type:"vertical"}),children:[(0,e.jsx)(Oe.u,{access:"canSeeComposeList",children:(0,e.jsx)(ne.Z,{icon:(0,e.jsx)(Y.Z,{}),type:"primary",confirmOnOpenChange:function(u){var m;u&&(!((m=E.current)===null||m===void 0)&&m.resetFields)&&E.current.resetFields()},confirm:(0,e.jsxs)(J.Z,{style:{width:300},direction:"vertical",children:[(0,e.jsx)(te.Z.Text,{children:Z.format("managerCreateTip")}),(0,e.jsxs)(de.A,{name:"createForm",formRef:E,layout:"inline",submitter:!1,children:[(0,e.jsx)(ue.Z.Group,{name:"pullImageUse",layout:"vertical",fieldProps:{style:{display:"flex",flexDirection:"column",gap:8}},valueEnum:{useCommand:Z.format("managerCreatePullImageUseCommand"),useDPanel:Z.format("managerCreatePullImageUseDPanel")}}),(0,e.jsx)(k.Z,{initialValue:!0,name:"createPath",valuePropName:"checked",children:(0,e.jsx)(ce.Z,{defaultChecked:!0,children:Z.format("managerCreateCreatePath")})}),(0,e.jsx)(k.Z,{initialValue:!0,name:"removeOrphans",valuePropName:"checked",children:(0,e.jsx)(ce.Z,{defaultChecked:!0,children:Z.format("managerCreateRemoveOrphans")})})]})]}),action:D()(d()().mark(function y(){var u,m,x,w,a,f,ee,X,se,K,O,B;return d()().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:if(K={id:t.id||t.name},(u=E.current)!==null&&u!==void 0&&u.getFieldValue&&((m=E.current)===null||m===void 0?void 0:m.getFieldValue("pullImageUse"))=="useDPanel"&&(K.pullImage=!1,K.pullImageUseDPanel=!0),(x=E.current)!==null&&x!==void 0&&x.getFieldValue&&((w=E.current)===null||w===void 0?void 0:w.getFieldValue("pullImageUse"))=="useCommand"&&(K.pullImage=!0),O=((a=I.current)===null||a===void 0?void 0:a.getFieldsFormatValue)&&I.current.getFieldsFormatValue(),K.environment=O.environment,K.deployServiceName=O.deployServiceName,K.createPath=(f=(ee=E.current)===null||ee===void 0?void 0:ee.getFieldValue("createPath"))!==null&&f!==void 0?f:!0,K.removeOrphans=(X=(se=E.current)===null||se===void 0?void 0:se.getFieldValue("removeOrphans"))!==null&&X!==void 0?X:!0,!(t!=null&&t.isDeploy)){ae.next=12;break}if(!((B=E.current)!==null&&B!==void 0&&B.getFieldValue("pullImageUseCommand"))){ae.next=12;break}return ae.next=12,(0,L.GG)({id:t.id||t.name,op:"pull"});case 12:return ae.abrupt("return",gn(K));case 13:case"end":return ae.stop()}},y)})),children:Z.format(t.isDeploy?"managerUpgradeButton":"managerCreateButton")},"create")}),(t.isDeploy||t.isCreated)&&Pe.canSeeComposeListManage&&(0,e.jsx)(ne.Z,{action:function(){var u;return(u=le.current)===null||u===void 0||u.show(),(0,L.mg)({id:t.id||t.name,deleteImage:!1,deleteData:!1,deleteVolume:!1,deletePath:!1})},onSuccess:function(){q(c+1)},type:"primary",danger:!0,confirm:"notification.confirm.title",icon:(0,e.jsx)(ve.Z,{}),children:Z.format("managerDeleteContainerButton")}),t.isDeploy&&(0,e.jsxs)(Oe.u,{access:"canSeeComposeList",space:{direction:"horizontal"},children:[(0,e.jsx)(ne.Z,{icon:(0,e.jsx)(U.Z,{}),action:D()(d()().mark(function y(){var u;return d()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return(u=le.current)===null||u===void 0||u.show(),x.abrupt("return",(0,L.GG)({id:t.id||t.name,op:"restart"}));case 2:case"end":return x.stop()}},y)})),onSuccess:function(){q(c+1)},children:Z.format("managerRestartButton")},"restart"),(0,e.jsx)(ne.Z,{action:function(){var u;return(u=le.current)===null||u===void 0||u.show(),(0,L.GG)({id:t.id||t.name,op:"stop"})},icon:(0,e.jsx)(xe.Z,{}),disabled:t.isExited,onSuccess:function(){q(c+1)},children:Z.format("managerStopButton")}),t.isPaused&&(0,e.jsx)(ne.Z,{action:function(){var u;return(u=le.current)===null||u===void 0||u.show(),(0,L.GG)({id:t.id||t.name,op:"unpause"})},onSuccess:function(){q(c+1)},icon:(0,e.jsx)(Y.Z,{}),children:Z.format("managerUnpauseButton")}),!t.isPaused&&(0,e.jsx)(ne.Z,{action:function(){var u;return(u=le.current)===null||u===void 0||u.show(),(0,L.GG)({id:t.id||t.name,op:"pause"})},onSuccess:function(){q(c+1)},icon:(0,e.jsx)(oe.Z,{}),disabled:!t.isRunning,children:Z.format("managerPauseButton")})]}),t.id>0&&Pe.canSeeComposeListManageDelete&&(0,e.jsx)(ne.Z,{type:"primary",action:D()(d()().mark(function y(){var u,m,x,w,a,f,ee,X,se;return d()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return(u=le.current)===null||u===void 0||u.show(),O.next=3,(0,L.mg)({id:(m=t==null?void 0:t.id)!==null&&m!==void 0?m:t.name,deleteImage:(x=(w=z.current)===null||w===void 0?void 0:w.getFieldValue("deleteImage"))!==null&&x!==void 0?x:!1,deleteVolume:(a=(f=z.current)===null||f===void 0?void 0:f.getFieldValue("deleteVolume"))!==null&&a!==void 0?a:!1,deletePath:(ee=(X=z.current)===null||X===void 0?void 0:X.getFieldValue("deletePath"))!==null&&ee!==void 0?ee:!1});case 3:return O.next=5,(0,L.ik)({id:[(se=t.id)!==null&&se!==void 0?se:0]});case 5:q(c+1);case 6:case"end":return O.stop()}},y)})),danger:!0,onSuccess:function(){_("/compose/list")},confirm:(0,e.jsxs)(J.Z,{style:{width:240},direction:"vertical",children:[(0,e.jsx)(te.Z.Text,{children:Z.format("managerDeleteTaskTip")}),(0,e.jsxs)(de.A,{formRef:z,layout:"inline",submitter:!1,children:[(0,e.jsx)(k.Z,{initialValue:!1,name:"deleteImage",valuePropName:"checked",children:(0,e.jsx)(ce.Z,{children:Z.format("managerDeleteTaskDeleteImage")})}),(0,e.jsx)(k.Z,{addonAfter:(0,e.jsx)(me.Z,{title:Z.format("managerDeleteTaskDeleteVolumeTip"),children:(0,e.jsx)(we.Z,{})}),initialValue:!1,name:"deleteVolume",valuePropName:"checked",children:(0,e.jsx)(ce.Z,{children:Z.format("managerDeleteTaskDeleteVolume")})}),(0,e.jsx)(k.Z,{initialValue:!1,name:"deletePath",valuePropName:"checked",children:(0,e.jsx)(ce.Z,{children:Z.format("managerDeleteTaskDeletePath")})})]})]}),children:Z.format("managerDeleteTaskButton")}),o.showBackListButton&&(0,e.jsx)(V.Link,{to:"/compose/list",children:(0,e.jsx)(Re.ZP,{children:Ze.Ob.format("compose.list")})})]})]},"operator"),t&&(0,e.jsx)(Me,{ref:le,id:t.id||t.name}),t&&(0,e.jsx)(Xe,{containerList:t.containerList,enableSelectService:!t.isDeploy,selectServiceFinish:function(u){var m;(m=I.current)===null||m===void 0||m.setFieldValue("deployServiceName",u)}}),(0,e.jsx)(Oe.u,{access:"canSeeComposeList",children:(0,e.jsxs)(de.A,{submitter:!1,formRef:I,children:[(0,e.jsx)(k.Z,{name:"deployServiceName",hidden:!0}),t&&t.setting.type!="dangling"&&(0,e.jsx)(W.Z,{title:Z.format("envTitle"),subTitle:Z.format("envSubTitle"),tooltip:Z.format("envTip"),ghost:!0,children:(0,e.jsx)(i.Z,{showCardGhost:!0,name:"environment",showDisableName:!0,requireValue:!0,showDeleteButton:!1})})]})})]})})]})}),fn=mn},35887:function(Ue,ge,n){var ye=n(5574),p=n.n(ye),je=n(12323),v=n(78267),M=n.n(v),d=n(75458),pe=n.n(d),D=n(67294),s=n(4244),ne=n.n(s),L=n(24078),Ce=n(85893),b,ie,Y,ve=(0,D.forwardRef)(function(U,xe){var oe,we=(0,D.useState)(!0),W=p()(we,2),de=W[0],ue=W[1];return(0,D.useEffect)(function(){return b=new s.Terminal(je.X),ie=new d.SearchAddon,Y=new v.FitAddon,window.addEventListener("resize",function(){U.showInModal||Y.fit()}),U.style&&U.style.fontSize&&(b.options.fontSize=U.style.fontSize),b.loadAddon(Y),b.loadAddon(ie),b.open(document.getElementById(U.id?U.id:"terminal-container")),U.showInModal||Y.fit(),function(){b.reset(),ue(!0)}},[]),(0,D.useImperativeHandle)(xe,function(){return{write:function(V){de&&(Y.fit(),ue(!1)),b.write(V)},clear:function(){b.clear()},getTerminal:function(){return b},findNext:function(V){ie.findNext(V)},findPrev:function(V){ie.findPrevious(V)},fit:function(){Y.fit()},onData:function(V){return b.onData(V)}}}),(0,Ce.jsx)("div",{id:U.id?U.id:"terminal-container",style:{width:U.width?U.width:"100%",height:U.height?U.height:"500px",marginTop:(oe=U.style)===null||oe===void 0?void 0:oe.marginTop}})});ge.Z=ve},90098:function(Ue,ge,n){n.d(ge,{GG:function(){return xe},MG:function(){return Fe},Oh:function(){return ie},Pn:function(){return ne},U_:function(){return k},Yz:function(){return we},iE:function(){return me},ik:function(){return Ce},im:function(){return d},mg:function(){return ve},pm:function(){return D},tw:function(){return ce},vf:function(){return de},xC:function(){return he}});var ye=n(15009),p=n.n(ye),je=n(99289),v=n.n(je),M=n(82346);function d(l){return pe.apply(this,arguments)}function pe(){return pe=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,M.request)("/api/app/compose/create",{method:"POST",data:i}));case 1:case"end":return r.stop()}},l)})),pe.apply(this,arguments)}function D(l){return s.apply(this,arguments)}function s(){return s=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,M.request)("/api/app/compose/get-list",{method:"POST",data:i}));case 1:case"end":return r.stop()}},l)})),s.apply(this,arguments)}function ne(l){return L.apply(this,arguments)}function L(){return L=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i.id=String(i.id),r.abrupt("return",(0,M.request)("/api/app/compose/get-task",{method:"POST",data:i}));case 2:case"end":return r.stop()}},l)})),L.apply(this,arguments)}function Ce(l){return b.apply(this,arguments)}function b(){return b=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,M.request)("/api/app/compose/delete",{method:"POST",data:i}));case 1:case"end":return r.stop()}},l)})),b.apply(this,arguments)}function ie(l){return Y.apply(this,arguments)}function Y(){return Y=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i.id=String(i.id),r.abrupt("return",(0,M.request)("/api/app/compose/container-deploy",{method:"POST",data:i}));case 2:case"end":return r.stop()}},l)})),Y.apply(this,arguments)}function ve(l){return U.apply(this,arguments)}function U(){return U=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i.id=String(i.id),r.abrupt("return",(0,M.request)("/api/app/compose/container-destroy",{method:"POST",data:i}));case 2:case"end":return r.stop()}},l)})),U.apply(this,arguments)}function xe(l){return oe.apply(this,arguments)}function oe(){return oe=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i.id=String(i.id),r.abrupt("return",(0,M.request)("/api/app/compose/container-ctrl",{method:"POST",data:i}));case 2:case"end":return r.stop()}},l)})),oe.apply(this,arguments)}function we(l){return W.apply(this,arguments)}function W(){return W=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i.id=String(i.id),r.abrupt("return",(0,M.request)("/api/app/compose/container-log",{method:"POST",data:i}));case 2:case"end":return r.stop()}},l)})),W.apply(this,arguments)}function de(l){return ue.apply(this,arguments)}function ue(){return ue=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i.download=!0,i.id=String(i.id),r.next=4,(0,M.request)("/api/app/compose/container-log",{method:"POST",data:i,responseType:"blob"});case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}},l)})),ue.apply(this,arguments)}function k(l){return V.apply(this,arguments)}function V(){return V=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,M.request)("/api/app/compose/container-process-kill",{method:"POST",data:i}));case 1:case"end":return r.stop()}},l)})),V.apply(this,arguments)}function Fe(l){return J.apply(this,arguments)}function J(){return J=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,M.request)("/api/app/compose/get-from-uri",{method:"POST",data:i}));case 1:case"end":return r.stop()}},l)})),J.apply(this,arguments)}function he(l){return te.apply(this,arguments)}function te(){return te=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i.id=String(i.id),r.abrupt("return",(0,M.request)("/api/app/compose/parse",{method:"POST",data:i}));case 2:case"end":return r.stop()}},l)})),te.apply(this,arguments)}function me(l){return Se.apply(this,arguments)}function Se(){return Se=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,M.request)("/api/common/store/deploy",{method:"POST",data:i}));case 1:case"end":return r.stop()}},l)})),Se.apply(this,arguments)}function ce(l){return Re.apply(this,arguments)}function Re(){return Re=v()(p()().mark(function l(i){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i.id=String(i.id),r.abrupt("return",(0,M.request)("/api/app/compose/download",{method:"POST",data:i,responseType:"blob"}));case 2:case"end":return r.stop()}},l)})),Re.apply(this,arguments)}}}]);
