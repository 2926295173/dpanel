"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8195],{77273:function(G,C,r){var I=r(15009),c=r.n(I),O=r(99289),L=r.n(O),y=r(5574),U=r.n(y),z=r(184),d=r(5966),Z=r(86615),M=r(97462),B=r(64317),A=r(52688),f=r(62370),_=r(38345),Y=r(31199),u=r(90672),j=r(71230),E=r(15746),F=r(42075),h=r(86250),J=r(40056),p=r(67294),Q=r(91845),D=r(87662),x=r(12491),H=r(89035),R=r(36146),V=r(3616),e=r(85893),S=(0,p.forwardRef)(function(v,$){var P,g;(0,p.useImperativeHandle)($,function(){return{edit:function(o){var t,a=o.address.split("://"),s=U()(a,2),l=s[0],N=s[1];(t=i.current)===null||t===void 0||t.setFieldsValue({name:o.name,title:o.title,addressType:"".concat(l,"://"),address:N,serverUrl:o.serverUrl,enableTLS:o.enableTLS,tlsCa:o.tlsCa,tlsCert:o.tlsCert,tlsKey:o.tlsKey,enableComposePath:o.enableComposePath,enableSSH:o.enableSSH,sshServerInfo:o.sshServerInfo,remoteType:o.remoteType?o.remoteType:"docker"}),w(!0),ee(o.name)}}});var n=new R.Uo("components.dockerEnvCreate"),K=(0,p.useState)(!1),b=U()(K,2),W=b[0],w=b[1],i=(0,p.useRef)(),re=(0,p.useState)(""),k=U()(re,2),q=k[0],ee=k[1];return(0,e.jsxs)(z.a,{drawerProps:{forceRender:!0,width:V.R_},onOpenChange:function(o){if(!o){var t;ee(""),(t=i.current)===null||t===void 0||t.resetFields()}w(o)},open:W,width:800,trigger:v.trigger,formRef:i,title:n.format((P=i.current)!==null&&P!==void 0&&P.getFieldValue&&i.current.getFieldValue("name")=="local"?"drawerTitleDefault":"drawerTitle"),onFinish:function(){var T=L()(c()().mark(function o(t){var a,s,l;return c()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,(0,D.ad)({name:t.name,title:t.title,address:"".concat((a=t.addressType)!==null&&a!==void 0?a:"unix://").concat((s=t.address)!==null&&s!==void 0?s:"/dpanel/sock/".concat(t.name,".sock")),serverUrl:t.serverUrl,enableTLS:t.enableTLS,tlsCa:t.tlsCa,tlsCert:t.tlsCert,tlsKey:t.tlsKey,enableComposePath:t.enableComposePath,composePath:t.enableComposePath?t.composePath:"",enableSSH:t.enableSSH||t.remoteType=="ssh",sshServerInfo:t.sshServerInfo,remoteType:t.remoteType});case 2:return l=m.sent,v.onFinish&&v.onFinish(),m.abrupt("return",!0);case 5:case"end":return m.stop()}},o)}));return function(o){return T.apply(this,arguments)}}(),children:[(0,e.jsx)(d.Z,{label:n.format("formTitle"),name:"title",required:!0,rules:[{required:!0}],fieldProps:{id:"envTitle",onChange:function(o){var t="";if(o.target.value&&!q){var a,s=(0,Q.N9)(o.target.value.trim(),{toneType:"none",type:"array"});t=s.join(""),(a=i.current)===null||a===void 0||a.setFieldValue("name",t)}}}},"envTitle"),(0,e.jsx)(d.Z,{label:n.format("formName"),name:"name",required:!0,disabled:q!="",rules:[{required:!0}],placeholder:n.format("formNameEmpty")}),(0,e.jsx)(d.Z,{tooltip:n.format("formServerUrlTip"),label:n.format("formServerUrl"),name:"serverUrl",placeholder:n.format("formServerUrlEmpty")}),(0,e.jsx)(Z.Z.Group,{label:n.format("formRemoteType"),name:"remoteType",options:[{label:"DockerApi",value:"docker"},{label:"SSH",value:"ssh",disabled:((g=i.current)===null||g===void 0?void 0:g.getFieldValue("name"))=="local"}]}),(0,e.jsx)(M.Z,{name:["remoteType","name"],children:function(o){var t=o.remoteType,a=o.name;return(0,e.jsxs)(e.Fragment,{children:[t=="docker"&&(0,e.jsx)(j.Z,{children:(0,e.jsx)(E.Z,{span:24,children:(0,e.jsxs)(F.Z.Compact,{children:[(0,e.jsx)(B.Z,{name:"addressType",label:n.format("formAddressType"),valueEnum:{"unix://":"unix://","tcp://":"tcp://"},initialValue:"tcp://",fieldProps:{defaultValue:"tcp://"},tooltip:n.format("formAddressTypeTip")}),(0,e.jsx)(d.Z,{label:" ",name:"address",required:!0,width:"xl",rules:[{required:!0}],placeholder:n.format("formAddressEmpty")})]})})}),(0,e.jsxs)(j.Z,{gutter:[15,0],children:[t=="docker"&&(0,e.jsx)(E.Z,{children:(0,e.jsx)(A.Z,{label:n.format("formEnableTLS"),name:"enableTLS",tooltip:n.format("formEnableTLSTip")})}),a!="local"&&typeof t!="undefined"&&(0,e.jsx)(E.Z,{children:(0,e.jsx)(A.Z,{label:n.format("formEnableComposePath"),name:"enableComposePath",tooltip:n.format("formEnableComposePathTip")})}),t=="docker"&&(0,e.jsx)(E.Z,{children:(0,e.jsx)(A.Z,{label:n.format("formEnableSSH"),name:"enableSSH"})})]})]})}}),(0,e.jsx)(M.Z,{name:["enableTLS"],children:function(o){var t=o.enableTLS;if(t)return(0,e.jsxs)(h.Z,{gap:10,justify:"start",children:[(0,e.jsx)(f.Z,{name:"tlsCa",label:n.format("formTlsCa"),children:(0,e.jsx)(x.Z,{showPaset:!0,title:"ca.pem",onImport:function(s){var l;return(l=i.current)===null||l===void 0||l.setFieldValue("tlsCa",s),!0},onLoad:function(s){if(s.indexOf("CERTIFICATE")<0)throw new Error(n.format("formEnableTLSMessageUploadError",{name:"ca.pem"}));return!0}})}),(0,e.jsx)(f.Z,{name:"tlsCert",label:" ",children:(0,e.jsx)(x.Z,{showPaset:!0,title:"cert.pem",onImport:function(s){var l;return(l=i.current)===null||l===void 0||l.setFieldValue("tlsCert",s),!0},onLoad:function(s){if(s.indexOf("CERTIFICATE")<0)throw new Error(n.format("formEnableTLSMessageUploadError",{name:"cert.pem"}));return!0}})}),(0,e.jsx)(f.Z,{label:" ",name:"tlsKey",children:(0,e.jsx)(x.Z,{showPaset:!0,title:"key.pem",onImport:function(s){var l;return(l=i.current)===null||l===void 0||l.setFieldValue("tlsKey",s),!0},onLoad:function(s){if(s.indexOf("PRIVATE")<0)throw new Error(n.format("formEnableTLSMessageUploadError",{name:"key.pem"}));return!0}})})]})}}),(0,e.jsx)(M.Z,{name:["enableComposePath","name"],children:function(o){var t=o.enableComposePath,a=o.name;if(t)return(0,e.jsx)(d.Z,{label:n.format("formComposePath"),name:"composePath",disabled:!0,fieldProps:{value:"/dpanel/compose/compose-".concat(a!=null?a:"")}})}}),(0,e.jsx)(M.Z,{name:["enableSSH","sshServerInfo","remoteType","address"],children:function(o){var t=o.enableSSH,a=o.sshServerInfo,s=o.remoteType,l=o.address;return(t||s=="ssh")&&[(0,e.jsxs)(_.Z,{title:(0,e.jsx)(H.Z,{}),subTitle:n.format("formEnableSSHTitle"),ghost:!0,children:[(0,e.jsxs)(e.Fragment,{children:[s=="ssh"&&(0,e.jsx)(f.Z,{children:(0,e.jsx)(J.Z,{message:(0,e.jsxs)(e.Fragment,{children:[n.format("formEnableSSHAlert"),(0,e.jsx)("a",{href:"https://dpanel.cc/#/zh-cn/manual/setting/docker-env?id=%e9%80%9a%e8%bf%87-ssh-%e6%b7%bb%e5%8a%a0",target:"_blank",children:R.FD.format("help")})]})})}),(0,e.jsx)(d.Z,{label:n.format("formSshServerInfoAddress"),placeholder:n.format("formSshServerInfoAddressEmpty"),name:["sshServerInfo","address"],required:!0,rules:[{required:!0}]})]}),(0,e.jsxs)(j.Z,{children:[(0,e.jsx)(E.Z,{children:(0,e.jsx)(Y.Z,{initialValue:22,label:n.format("formSshServerInfoPort"),name:["sshServerInfo","port"]})}),(0,e.jsx)(E.Z,{offset:2,children:(0,e.jsx)(Z.Z.Group,{label:n.format("formSshServerInfoAuthType"),name:["sshServerInfo","authType"],valueEnum:{basic:n.format("formSshServerInfoAuthTypeBasic"),pem:n.format("formSshServerInfoAuthTypePem")},required:!0,rules:[{required:!0}]})})]}),a&&a.authType=="basic"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(d.Z,{label:n.format("formSshServerInfoUsername"),name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]}),(0,e.jsx)(d.Z.Password,{label:n.format("formSshServerInfoPassword"),name:["sshServerInfo","password"],required:!0,rules:[{required:!0}]})]}),a&&a.authType=="pem"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(d.Z,{label:n.format("formSshServerInfoUsername"),name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]}),(0,e.jsx)(x.Z,{title:n.format("formSshServerInfoPrivateKeyImport"),onImport:function(m){var X;return(X=i.current)===null||X===void 0||X.setFieldValue(["sshServerInfo","privateKey"],m),!0},onLoad:function(m){if(!m.includes("PRIVATE KEY"))throw new Error(n.format("formEnableTLSMessageUploadError",{name:"private.key"}));return!0}}),(0,e.jsx)(u.Z,{name:["sshServerInfo","privateKey"],label:n.format("formSshServerInfoPrivateKey"),required:!0,rules:[{required:!0}]}),(0,e.jsx)(d.Z.Password,{name:["sshServerInfo","password"],label:n.format("formSshServerInfoPrivateKeyPassword")})]})]},"sshSetting")]}})]})});C.Z=S},12491:function(G,C,r){r.d(C,{Z:function(){return Y}});var I=r(5574),c=r.n(I),O=r(3616),L=r(24963),y=r(36146),U=r(88484),z=r(57546),d=r(62370),Z=r(95089),M=r(42075),B=r(28036),A=r(85576),f=r(67294),_=r(85893);function Y(u){var j=(0,f.useContext)(L.Z),E=j.message,F=j.notice,h=(0,f.useRef)(null),J=(0,f.useState)(!1),p=c()(J,2),Q=p[0],D=p[1],x=(0,f.useState)(""),H=c()(x,2),R=H[0],V=H[1],e=function(){h.current&&(h.current.click(),h.current.onchange=function(v){if(!v||!v.target)return"";var $=new FileReader;$.onload=function(n){var K,b,W=(K=n.target)===null||K===void 0?void 0:K.result;if(u.onLoad)try{u.onLoad&&u.onLoad(W)}catch(w){F.error(w);return}V(W),typeof u.onImport=="function"&&(E.success(y.FD.format("finish")),u.onImport(W)),(b=h.current)!==null&&b!==void 0&&b.value&&(h.current.value="")};var P=v.target;if(P.files&&P.files[0]){var g=P.files[0];try{$.readAsText(g)}catch(n){F.error(y.FD.format("commonContentIncorrectFormat",{name:P.files[0].name}))}}})};return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(d.Z,{children:(0,_.jsxs)(M.Z.Compact,{block:!0,children:[(0,_.jsx)(B.ZP,{icon:(0,_.jsx)(U.Z,{}),block:!0,onClick:e,children:u.title}),u.showPaset&&(0,_.jsx)(B.ZP,{icon:(0,_.jsx)(z.Z,{}),onClick:function(){D(!0)}})]})}),(0,_.jsx)("input",{style:{display:"none"},type:"file",ref:h,name:"importFileInput"}),(0,_.jsx)(A.Z,{width:O.ob,open:Q,onClose:function(){D(!1)},onCancel:function(){D(!1)},onOk:function(){typeof u.onImport=="function"&&(E.success(y.FD.format("finish")),u.onImport(R)),D(!1)},children:(0,_.jsx)(Z.ZP,{height:O.Ed,theme:"dark",value:R,onChange:function(v){V(v)}})})]})}},3616:function(G,C,r){r.d(C,{Ed:function(){return L},FK:function(){return c},R_:function(){return I},ob:function(){return O}});var I=window.innerWidth<=1024?"90vw":"65vw",c="90vw",O="60vw",L="50vh"},24963:function(G,C,r){var I=r(67294),c=(0,I.createContext)({});C.Z=c}}]);
