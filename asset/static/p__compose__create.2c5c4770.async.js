"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1102],{37058:function(fe,X,n){n.r(X),n.d(X,{default:function(){return Be}});var ne=n(15009),l=n.n(ne),re=n(99289),g=n.n(re),R=n(64599),te=n.n(R),W=n(5574),E=n.n(W),G=n(184),S=n(38345),A=n(5966),s=n(67294),H=n(82034),k=n(91058),K=n(17186),ae=n(24739),L=n(83062),V=n(14726),Y=n(94668),ue=n(85576),z=n(92067),e=n(85893),c=(0,s.forwardRef)(function(M,B){var $=(0,s.useState)(!1),Z=E()($,2),x=Z[0],h=Z[1],p=(0,s.useState)(),C=E()(p,2),y=C[0],f=C[1];return(0,s.useImperativeHandle)(B,function(){return{show:function(F){f(F),h(!0)}}}),(0,e.jsx)(ue.Z,{title:"\u9009\u62E9\u5BB9\u5668",width:1024,footer:!1,open:x,onCancel:function(){return h(!1)},children:(0,e.jsx)(z.Z,{onSelect:function(F){y==null||y.setCurrentRowData({replaceName:F.Name}),h(!1)}})})}),I=c,r=(0,s.forwardRef)(function(M,B){var $=(0,s.useRef)(),Z=(0,s.useRef)();return(0,s.useImperativeHandle)(B,function(){return{setDepend:function(h){h.map(function(p){var C;(C=$.current)===null||C===void 0||C.add(p)})},addItem:function(h,p){}}}),(0,e.jsxs)(S.Z,{title:"\u670D\u52A1\u4F9D\u8D56\u66FF\u6362",subTitle:"\u66FF\u6362\u540ECompose\u4E2D\u7684\u670D\u52A1\u5C06\u4E0D\u4F1A\u521B\u5EFA",headerBordered:!0,children:[(0,e.jsx)(I,{ref:Z}),(0,e.jsx)(K.u,{name:"depends",actionRef:$,creatorButtonProps:!1,copyIconProps:!1,deleteIconProps:!1,min:0,children:function(h,p,C){return(0,e.jsxs)(ae.UW,{children:[(0,e.jsx)(A.Z,{label:"\u4F9D\u8D56\u670D\u52A1",name:"dependName",disabled:!0}),(0,e.jsx)(A.Z,{label:"\u66FF\u6362\u5DF2\u6709\u5BB9\u5668",name:"replaceName",disabled:!0,placeholder:"\u8BF7\u9009\u62E9\u5DF2\u6709\u5BB9\u5668",addonAfter:(0,e.jsx)(L.Z,{title:"\u9009\u62E9\u66FF\u6362\u7684\u5BB9\u5668",children:(0,e.jsx)(V.ZP,{type:"primary",icon:(0,e.jsx)(Y.Z,{}),onClick:function(){var f;(f=Z.current)===null||f===void 0||f.show(C)}})},h.key)})]})}})]})}),ve=r,he=(0,s.forwardRef)(function(M,B){var $=(0,s.useState)(!1),Z=E()($,2),x=Z[0],h=Z[1],p=(0,s.useRef)(),C=(0,s.useRef)(),y=(0,s.useRef)(),f=(0,s.useRef)();return(0,s.useImperativeHandle)(B,function(){return{edit:function(F,v){var w,P,q,b;!((w=p.current)===null||w===void 0)&&w.resetFields&&((P=p.current)===null||P===void 0||P.resetFields()),(q=p.current)===null||q===void 0||q.setFieldsValue({name:F}),v.environment&&v.environment instanceof Array?v.environment.map(function(i){var m,O=i.split("=");(m=y.current)===null||m===void 0||m.addEnvItem(O[0],O.slice(1).join("="))}):v.environment&&v.environment instanceof Object&&Object.keys(v.environment).map(function(i){var m;(m=y.current)===null||m===void 0||m.addEnvItem(i,v.environment[i])}),v.ports&&v.ports.map(function(i){var m,O=i.split(":");(m=C.current)===null||m===void 0||m.addPortItem(O[0],O[1])});var J=[];v.depends_on&&(J=v.depends_on.map(function(i){if(i.indexOf(":")==-1)return{dependName:i,replaceName:""};var m=i.split(":");return{dependName:m[1],replaceName:m[0]}})),(b=f.current)===null||b===void 0||b.setDepend(J),h(!0)}}}),(0,e.jsxs)(G.a,{open:x,onOpenChange:function(F){h(F)},drawerProps:{forceRender:!0},formRef:p,title:"\u7F16\u8F91\u5BB9\u5668\u670D\u52A1",onFinish:function(){var T=g()(l()().mark(function F(v){return l()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return M.onFinish&&M.onFinish(v),P.abrupt("return",!0);case 2:case"end":return P.stop()}},F)}));return function(F){return T.apply(this,arguments)}}(),children:[(0,e.jsx)(S.Z,{children:(0,e.jsx)(A.Z,{label:"\u670D\u52A1\u540D\u79F0",name:"name",disabled:!0})}),(0,e.jsx)(H.Z,{showInDrawer:!0,ref:C}),(0,e.jsx)(k.Z,{showAddButton:!0,showInDrawer:!0,ref:y}),(0,e.jsx)(ve,{ref:f})]},"create")}),Ce=he,le=n(24910),de=n(45742),Fe=n(91806),je=n(27496),ge=n(43425),xe=n(33862),ye=n(97269),Re=n(2236),Se=n(62370),Ze=n(97462),Pe=n(95213),De=n(95089),ce=n(54006),Ee=n(63490),se=n(42075),Ae=n(66309),Ie=n(96074),pe=n(1272),Oe=n(91845);function Be(){var M=(0,s.useState)([]),B=E()(M,2),$=B[0],Z=B[1],x=(0,s.useRef)(),h=(0,s.useRef)(),p=(0,s.useRef)(),C=(0,s.useState)({}),y=E()(C,2),f=y[0],T=y[1],F=(0,ce.useNavigate)(),v=(0,ce.useSearchParams)(),w=E()(v,2),P=w[0],q=w[1],b=(0,s.useState)(),J=E()(b,2),i=J[0],m=J[1],O=function(t,u){var o,a;if(t){var D=pe.ZP.load(t),d=D;(o=p.current)===null||o===void 0||o.setFieldValue("yaml",t),T(D),Z(Object.keys(d.services).map(function(U,ee){var N=Object.assign({},d.services[U]);return N.external_links&&N.external_links.map(function(oe){oe.indexOf(":")!=-1&&(N.depends_on||(N.depends_on=[]),N.depends_on.indexOf(oe)==-1&&N.depends_on.push(oe))}),N.name=U,N}));var $e=t.matchAll(/\$\{(\w+)[:-]?(.*)\}/g);(a=x.current)===null||a===void 0||a.clear(),u&&u.map(function(U){var ee;(ee=x.current)===null||ee===void 0||ee.addEnvItem(U.name,U.value)});var _=te()($e),me;try{for(_.s();!(me=_.n()).done;){var ie,Q=me.value;(ie=x.current)===null||ie===void 0||ie.addEnvItem(Q[1],Q[2]?Q[2].indexOf("-")==0?Q[2].substring(1):Q[2]:"")}}catch(U){_.e(U)}finally{_.f()}}};return(0,s.useEffect)(function(){var j=P.get("id");j&&(0,le.YZ)({id:parseInt(j)}).then(function(t){var u,o;m(t.data.detail),(u=p.current)===null||u===void 0||u.setFieldsValue({name:t.data.detail.name,title:t.data.detail.title}),O(t.data.detail.yaml,(o=t.data.detail.setting.environment)!==null&&o!==void 0?o:[])})},[]),(0,e.jsxs)(ye.A,{submitter:{render:function(t,u){return(0,e.jsx)(Re.S,{children:u})}},formRef:p,onFinish:function(){var j=g()(l()().mark(function t(u){var o,a;return l()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return i!=null&&i.id&&(u.id=i.id),d.next=3,(0,le.im)(u);case 3:if(o=d.sent,!o.data.id){d.next=8;break}return(a=p.current)===null||a===void 0||a.resetFields(),F("/compose/list"),d.abrupt("return",!0);case 8:return d.abrupt("return",!1);case 9:case"end":return d.stop()}},t)}));return function(t){return j.apply(this,arguments)}}(),children:[(0,e.jsx)(Ce,{ref:h,onFinish:function(t){var u,o=t.name;t.environment&&(f.services[o].environment=t.environment.map(function(a){return"".concat(a.name,"=").concat(a.value)})),t.ports&&(f.services[o].ports=t.ports.map(function(a){return"".concat(a.host,":").concat(a.dest)})),t.depends&&(f.services[o].external_links=t.depends.map(function(a){if(a.replaceName)return"".concat(a.replaceName,":").concat(a.dependName)}).filter(function(a){return a!=null}),f.services[o].depends_on=t.depends.map(function(a){if(!a.replaceName)return a.dependName}).filter(function(a){return a!=null})),O(pe.ZP.dump(f),(u=i==null?void 0:i.setting.environment)!==null&&u!==void 0?u:[])}}),(0,e.jsxs)(S.Z,{split:"vertical",children:[(0,e.jsxs)(S.Z,{split:"horizontal",colSpan:"70%",children:[(0,e.jsxs)(S.Z,{title:(0,e.jsx)(de.Z,{}),subTitle:"\u57FA\u7840\u4FE1\u606F",children:[(0,e.jsx)(A.Z,{label:"\u7AD9\u70B9\u540D\u79F0",name:"title",required:!0,rules:[{required:!0}],fieldProps:{onChange:function(t){var u="";if(t.target.value&&!i){var o,a=(0,Oe.N9)(t.target.value.trim(),{toneType:"none",type:"array"});u=a.join(""),(o=p.current)===null||o===void 0||o.setFieldValue("name",u)}}}}),(0,e.jsx)(A.Z,{label:"\u7AD9\u70B9\u6807\u8BC6",name:"name",required:!0,rules:[{required:!0}],disabled:!!i,placeholder:"\u6807\u8BC6Compose\u521B\u5EFA\u7684\u5BB9\u5668\u7EC4\uFF0C\u53EA\u5141\u8BB8\u4E3A\u82F1\u6587\u6216\u662F\u6570\u5B57"})]}),(0,e.jsx)(S.Z,{title:(0,e.jsx)(Fe.Z,{}),subTitle:"\u670D\u52A1\u5217\u8868",extra:(0,e.jsx)(V.ZP,{children:"\u4F7F\u7528\u52A0\u901F\u62C9\u53D6\u6240\u6709\u955C\u50CF"}),children:(0,e.jsx)(Ee.Z,{dataSource:$,rowKey:"name",pagination:!1,columns:[{title:"\u540D\u79F0",dataIndex:"name"},{title:"\u955C\u50CF",dataIndex:"image"},{title:"\u7AEF\u53E3",dataIndex:"ports",width:200,render:function(t,u,o){return u.ports&&u.ports.map(function(a,D){var d=a.split(":");return(0,e.jsx)(se.Z,{size:"large",wrap:!0,children:(0,e.jsxs)(Ae.Z,{color:"#2db7f5",icon:d[0]?(0,e.jsx)(je.Z,{}):"",style:{marginBottom:5},children:[d[0]," : ",d[1]]})},"space".concat(D))})}},{title:"\u4F9D\u8D56",dataIndex:"dependsOn",width:150,render:function(t,u,o){return(0,e.jsx)(se.Z,{wrap:!0,children:u.depends_on})}},{title:"\u64CD\u4F5C",width:80,render:function(t,u,o){return(0,e.jsx)(se.Z,{split:(0,e.jsx)(Ie.Z,{type:"vertical"}),children:(0,e.jsx)(V.ZP,{type:"link",onClick:function(){var D,d=f.services[u.name];return(D=h.current)===null||D===void 0||D.edit(u.name,d),!1},children:(0,e.jsx)(L.Z,{title:"\u7F16\u8F91\u670D\u52A1",children:(0,e.jsx)(ge.Z,{})})},"manage")})}}]})}),(0,e.jsx)(S.Z,{title:(0,e.jsx)(xe.Z,{}),subTitle:"\u914D\u7F6E Compose \u4E2D\u7684\u73AF\u5883\u53D8\u91CF\u4F7F\u7528\u7684\u53D8\u91CF\u503C",children:(0,e.jsx)(k.Z,{showDisableName:!0,requireValue:!0,ref:x})})]}),(0,e.jsx)(S.Z,{title:(0,e.jsx)(de.Z,{}),subTitle:"compose.yaml",children:(0,e.jsx)(Se.Z,{name:"yaml",children:(0,e.jsx)(Ze.Z,{name:["yaml"],children:function(t){var u=t.yaml;return(0,e.jsx)(De.ZP,{theme:"dark",minHeight:"550px",onChange:function(a,D){var d;O(a,(d=i==null?void 0:i.setting.environment)!==null&&d!==void 0?d:[])},value:u,extensions:[Pe.RI.yaml()]})}})})})]})]},"create")}},24910:function(fe,X,n){n.d(X,{GG:function(){return V},Oh:function(){return k},U_:function(){return ue},YZ:function(){return S},ik:function(){return s},im:function(){return te},mg:function(){return ae},pm:function(){return E}});var ne=n(15009),l=n.n(ne),re=n(99289),g=n.n(re),R=n(54006);function te(e){return W.apply(this,arguments)}function W(){return W=g()(l()().mark(function e(c){return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,R.request)("/api/app/compose/create",{method:"POST",data:c}));case 1:case"end":return r.stop()}},e)})),W.apply(this,arguments)}function E(e){return G.apply(this,arguments)}function G(){return G=g()(l()().mark(function e(c){return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,R.request)("/api/app/compose/get-list",{method:"POST",data:c}));case 1:case"end":return r.stop()}},e)})),G.apply(this,arguments)}function S(e){return A.apply(this,arguments)}function A(){return A=g()(l()().mark(function e(c){return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,R.request)("/api/app/compose/get-detail",{method:"POST",data:c}));case 1:case"end":return r.stop()}},e)})),A.apply(this,arguments)}function s(e){return H.apply(this,arguments)}function H(){return H=g()(l()().mark(function e(c){return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,R.request)("/api/app/compose/delete",{method:"POST",data:c}));case 1:case"end":return r.stop()}},e)})),H.apply(this,arguments)}function k(e){return K.apply(this,arguments)}function K(){return K=g()(l()().mark(function e(c){return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,R.request)("/api/app/compose/container-deploy",{method:"POST",data:c}));case 1:case"end":return r.stop()}},e)})),K.apply(this,arguments)}function ae(e){return L.apply(this,arguments)}function L(){return L=g()(l()().mark(function e(c){return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,R.request)("/api/app/compose/container-destroy",{method:"POST",data:c}));case 1:case"end":return r.stop()}},e)})),L.apply(this,arguments)}function V(e){return Y.apply(this,arguments)}function Y(){return Y=g()(l()().mark(function e(c){return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,R.request)("/api/app/compose/container-ctrl",{method:"POST",data:c}));case 1:case"end":return r.stop()}},e)})),Y.apply(this,arguments)}function ue(e){return z.apply(this,arguments)}function z(){return z=g()(l()().mark(function e(c){return l()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,R.request)("/api/app/compose/container-process-kill",{method:"POST",data:c}));case 1:case"end":return r.stop()}},e)})),z.apply(this,arguments)}}}]);
