"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3146],{80821:function(q,w,n){n.d(w,{Z:function(){return _}});var P=n(5574),s=n.n(P),R=n(24963),v=n(86738),I=n(14726),j=n(83062),k=n(67294),g=n(85893);function _(o){var ee=(0,k.useState)(!1),N=s()(ee,2),Y=N[0],O=N[1],z=(0,k.useContext)(R.Z),K=z.lang,ae=z.notice,L=z.message,H=function(){O(!0),o.action().then(function(W){if(O(!1),typeof o.onSuccess=="function"&&o.onSuccess(W),o.messageSuccess){var B="";typeof o.messageSuccess=="function"?B=o.messageSuccess(W):B=o.messageSuccess,B.indexOf(".")>-1&&(B=K(B)),o.asynced?L.info(B):L.success(B)}}).catch(function(W){O(!1),typeof o.onError=="function"&&o.onError(W)})};return o.confirm?(0,g.jsx)(v.Z,{style:{width:500},title:K("notification.title.tip"),description:o.confirm,onConfirm:H,okText:"Yes",cancelText:"No",children:(0,g.jsx)(I.ZP,{disabled:o.disabled,icon:o.icon,loading:Y,danger:o.danger,type:o.type,children:o.children})}):(0,g.jsx)(j.Z,{title:o.tips,children:(0,g.jsx)(I.ZP,{disabled:o.disabled,icon:o.icon,loading:Y,onClick:H,danger:o.danger,type:o.type,children:o.children})})}},24963:function(q,w,n){var P=n(67294),s=(0,P.createContext)({});w.Z=s},88041:function(q,w,n){n.r(w),n.d(w,{default:function(){return be}});var P=n(15009),s=n.n(P),R=n(99289),v=n.n(R),I=n(5574),j=n.n(I),k=n(24963),g=n(54006);function _(l){return o.apply(this,arguments)}function o(){return o=v()(s()().mark(function l(d){return s()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,g.request)("/api/app/site/get-domain-list",{method:"POST",data:d}));case 1:case"end":return u.stop()}},l)})),o.apply(this,arguments)}function ee(l){return N.apply(this,arguments)}function N(){return N=v()(s()().mark(function l(d){return s()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,g.request)("/api/app/site/create-domain",{method:"POST",data:d}));case 1:case"end":return u.stop()}},l)})),N.apply(this,arguments)}function Y(l){return O.apply(this,arguments)}function O(){return O=v()(s()().mark(function l(d){return s()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,g.request)("/api/app/site/update-domain",{method:"POST",data:d}));case 1:case"end":return u.stop()}},l)})),O.apply(this,arguments)}function z(l){return K.apply(this,arguments)}function K(){return K=v()(s()().mark(function l(d){return s()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,g.request)("/api/app/site/delete-domain",{method:"POST",data:d}));case 1:case"end":return u.stop()}},l)})),K.apply(this,arguments)}function ae(l){return L.apply(this,arguments)}function L(){return L=v()(s()().mark(function l(d){return s()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,g.request)("/api/app/site/get-domain-detail",{method:"POST",data:d}));case 1:case"end":return u.stop()}},l)})),L.apply(this,arguments)}function H(l){return J.apply(this,arguments)}function J(){return J=v()(s()().mark(function l(d){return s()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,g.request)("/api/app/site/apply-domain-cert",{method:"POST",data:d}));case 1:case"end":return u.stop()}},l)})),J.apply(this,arguments)}function W(){return B.apply(this,arguments)}function B(){return B=v()(s()().mark(function l(){return s()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,g.request)("/api//app/site/restart-nginx",{method:"POST"}));case 1:case"end":return h.stop()}},l)})),B.apply(this,arguments)}var se=n(184),le=n(5966),Q=n(62370),M=n(52688),X=n(95089),ce=n(31418),ne=n(42075),te=n(66309),me=n(34041),ue=n(71230),U=n(15746),ve=n(25449),F=n(67294),e=n(85893),re="",he=(0,F.forwardRef)(function(l,d){var h=(0,F.useContext)(k.Z),u=h.notice,y=h.message,m=h.lang,r=(0,g.useModel)("subscriber"),f=(0,F.useRef)(),p=(0,F.useState)(),t=j()(p,2),i=t[0],b=t[1],c=(0,F.useState)(!1),a=j()(c,2),Z=a[0],E=a[1],T=ce.Z.useApp();return r.addDataHandler("composeUp",function(){var D=r.getDataByType("composeUp");if(D){var A;D.map(function(C){re+=C.data}),(A=f.current)===null||A===void 0||A.setFieldValue("console",re)}}),(0,F.useImperativeHandle)(d,function(){return{apply:function(A){var C,S;if(A.length==0)return u.error("\u8BF7\u5148\u5728\u57DF\u540D\u5217\u8868\u52FE\u9009\u5F85\u7533\u8BF7\u7684\u57DF\u540D\uFF0C\u591A\u4E2A\u57DF\u540D\u53EF\u4EE5\u5171\u7528\u540C\u4E00\u5F20\u8BC1\u4E66"),!1;(C=f.current)===null||C===void 0||C.setFieldsValue({email:(S=localStorage.getItem("email"))!==null&&S!==void 0?S:"",console:""}),re="",b(A),E(!0)}}}),(0,e.jsx)(se.a,{drawerProps:{forceRender:!0},formRef:f,open:Z,onOpenChange:function(A){E(A)},onFinish:function(){var D=v()(s()().mark(function A(C){var S,V;return s()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return localStorage.setItem("email",C.email),$.next=3,H({id:i?i.map(function(x){return x.id}):[],email:C.email,certServer:C.certServer,autoUpgrade:C.autoUpgrade,renew:C.renew,debug:C.debug});case 3:return V=$.sent,V.data=="success"&&setTimeout(v()(s()().mark(function x(){var Ze;return s()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,W();case 2:Ze=G.sent;case 3:case"end":return G.stop()}},x)})),5e3),(S=f.current)===null||S===void 0||S.resetFields(),l.onFinish&&l.onFinish(),$.abrupt("return",!0);case 8:case"end":return $.stop()}},A)}));return function(A){return D.apply(this,arguments)}}(),children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ve.Z,{label:"\u57DF\u540D\u5217\u8868",name:"serverName",children:(0,e.jsx)(ne.Z,{children:i==null?void 0:i.map(function(D){return(0,e.jsx)(te.Z,{children:D.serverName},D.id)})})}),(0,e.jsx)(le.Z,{label:"\u90AE\u7BB1",name:"email",placeholder:"\u8BF7\u8F93\u5165\u7533\u8BF7\u7684\u90AE\u7BB1"}),(0,e.jsx)(Q.Z,{label:"\u7B7E\u53D1\u670D\u52A1",name:"certServer",initialValue:"letsencrypt",children:(0,e.jsx)(me.Z,{options:[{value:"letsencrypt",label:"Let's Encrypt"},{value:"zerossl",label:"ZeroSSL"}]})}),(0,e.jsxs)(ue.Z,{children:[(0,e.jsx)(U.Z,{span:8,children:(0,e.jsx)(M.Z,{label:"\u81EA\u52A8\u7EED\u7B7E",name:"autoUpgrade",initialValue:!0})}),(0,e.jsx)(U.Z,{span:8,children:(0,e.jsx)(M.Z,{tooltip:"\u901A\u5E38\u60C5\u51B5\u7CFB\u7EDF\u4F1A\u81EA\u52A8\u7EED\u7B7E\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u5F00\u542F\u6B64\u9879\u5F3A\u5236\u7EED\u7B7E",label:"\u7ACB\u5373\u7EED\u7B7E",name:"renew",initialValue:!1})}),(0,e.jsx)(U.Z,{span:8,children:(0,e.jsx)(M.Z,{tooltip:"\u663E\u793A\u5B8C\u6574\u7684\u9519\u8BEF\u4FE1\u606F\uFF0C\u65B9\u4FBF\u6392\u67E5",label:"Debug",name:"debug",initialValue:!1})})]}),(0,e.jsx)(Q.Z,{label:"\u63A7\u5236\u53F0\u8F93\u51FA",name:"console",children:(0,e.jsx)(X.ZP,{theme:"dark",style:{marginTop:"10px",backgroundColor:"#282c34"},height:"350px",extensions:[X.tk.lineWrapping]})})]})})}),fe=he,pe=n(31199),Ee=n(50335),ie=n(90672),oe=n(14726),ge=n(92398),Ce=n(40056),Fe=(0,F.forwardRef)(function(l,d){var h=(0,F.useState)(!1),u=j()(h,2),y=u[0],m=u[1],r=(0,F.useRef)(),f=(0,F.useState)(),p=j()(f,2),t=p[0],i=p[1];return(0,F.useImperativeHandle)(d,function(){return{showEdit:function(c){ae({id:c.id}).then(function(a){var Z;if((Z=r.current)===null||Z===void 0||Z.setFieldsValue({serverName:c.serverName,port:c.setting.port,enableBlockCommonExploits:c.setting.enableBlockCommonExploits,enableAssetCache:c.setting.enableAssetCache,enableWs:c.setting.enableWs,extraNginx:c.setting.extraNginx,vhost:a.data.vhost,sslCrt:a.data.domain.setting.sslCrt,sslKey:a.data.domain.setting.sslKey}),c.setting.sslCrtRenewTime){var E;(E=r.current)===null||E===void 0||E.setFieldValue("sslCrtRenewTime",a.data.domain.setting.sslCrtRenewTime)}i(a.data),m(!0)})}}}),(0,e.jsx)(se.a,{drawerProps:{forceRender:!0},open:y,onOpenChange:function(c){m(c)},title:"\u57DF\u540D\u7BA1\u7406",trigger:(0,e.jsx)(oe.ZP,{onClick:function(){var c;i(void 0),(c=r.current)===null||c===void 0||c.resetFields()},type:"primary",children:"\u7ED1\u5B9A\u57DF\u540D"}),formRef:r,onFinish:function(){var b=v()(s()().mark(function c(a){var Z,E,T,D,A,C,S,V,de;return s()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!(t&&(t==null?void 0:t.domain.id)>0)){x.next=6;break}return x.next=3,Y({id:t==null?void 0:t.domain.id,port:a.port,enableBlockCommonExploits:a.enableBlockCommonExploits,enableAssetCache:a.enableAssetCache,enableWs:a.enableWs,extraNginx:a.extraNginx,sslCrt:(E=a.sslCrt)!==null&&E!==void 0?E:"",sslKey:(T=a.sslKey)!==null&&T!==void 0?T:"",sslCrtRenewTime:(D=a.sslCrtRenewTime)!==null&&D!==void 0?D:""});case 3:A=x.sent,x.next=9;break;case 6:return x.next=8,ee({containerId:l.containerId,serverName:a.serverName,port:a.port,enableBlockCommonExploits:a.enableBlockCommonExploits,enableAssetCache:a.enableAssetCache,enableWs:a.enableWs,extraNginx:a.extraNginx,sslCrt:(C=a.sslCrt)!==null&&C!==void 0?C:"",sslKey:(S=a.sslKey)!==null&&S!==void 0?S:"",sslCrtRenewTime:(V=a.sslCrtRenewTime)!==null&&V!==void 0?V:""});case 8:de=x.sent;case 9:return(Z=r.current)===null||Z===void 0||Z.resetFields(),l.onFinish(),x.abrupt("return",!0);case 12:case"end":return x.stop()}},c)}));return function(c){return b.apply(this,arguments)}}(),children:(0,e.jsx)(ge.Z,{items:[{key:"1",label:"\u914D\u7F6E\u57DF\u540D",children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(le.Z,{width:"lg",label:"\u57DF\u540D",tooltip:"\u6307\u5B9A\u8981\u7ED1\u5B9A\u7684\u57DF\u540D,\u5E76\u5C06\u8BE5\u57DF\u540D\u89E3\u6790\u5230\u5F53\u524D\u670D\u52A1\u5668",name:"serverName",placeholder:"\u8BF7\u6307\u5B9A\u8981\u7ED1\u5B9A\u7684\u57DF\u540D\uFF0C\u4F8B\u5982 www.explame.com, test.explame.com",rules:[{required:!0}],disabled:t&&t.domain.id>0}),(0,e.jsx)(pe.Z,{label:"\u5BB9\u5668\u5185\u7684\u7AEF\u53E3",name:"port",placeholder:"\u8F6C\u53D1\u5230\u76EE\u6807\u5BB9\u5668\u4E2D\u7684\u7AEF\u53E3\uFF0C\u4E00\u822C\u4E3A80",required:!0,rules:[{required:!0}]}),(0,e.jsxs)(ue.Z,{children:[(0,e.jsx)(U.Z,{span:12,children:(0,e.jsx)(M.Z,{label:"\u963B\u6B62\u5E38\u89C1\u6F0F\u6D1E\u5229\u7528",name:"enableBlockCommonExploits"})}),(0,e.jsx)(U.Z,{children:(0,e.jsx)(M.Z,{width:"md",label:"\u9759\u6001\u8D44\u6E90\u7F13\u5B58",name:"enableAssetCache"})})]}),(0,e.jsx)(ue.Z,{children:(0,e.jsx)(U.Z,{span:12,children:(0,e.jsx)(M.Z,{label:"\u652F\u6301 Websocket",name:"enableWs",initialValue:!0})})}),(0,e.jsx)(Q.Z,{name:"extraNginx",label:"\u81EA\u5B9A\u4E49\u6269\u5C55\u914D\u7F6E",tooltip:"\u81EA\u5B9A\u4E49\u6269\u5C55\u7F51\u7AD9 Vhost \u914D\u7F6E\u5185\u5BB9",children:(0,e.jsx)(X.ZP,{height:"300px",theme:"dark",style:{backgroundColor:"#282c34"}})})]})},{key:"2",label:"SSL",children:(0,e.jsxs)(e.Fragment,{children:[t&&t.domain.setting.autoSsl&&(0,e.jsx)(Ce.Z,{message:"\u5F53\u524D\u8BC1\u4E66\u4E3A\u81EA\u52A8\u7B7E\u53D1\uFF0C\u8BF7\u52FF\u4FEE\u6539\u3002\u8BC1\u4E66\u8DEF\u5F84\u4E3A\uFF1A/dpanel/cert \u76EE\u5F55",style:{margin:"15px 0"}}),(0,e.jsx)(Ee.Z,{label:"\u8BC1\u4E66\u5230\u671F\u65F6\u95F4",name:"sslCrtRenewTime",width:"lg",required:!0,disabled:t&&t.domain.setting.autoSsl}),(0,e.jsx)(ie.Z,{fieldProps:{autoSize:{minRows:10}},label:"\u8BC1\u4E66\u5185\u5BB9 .crt ",name:"sslCrt",tooltip:"1.\u901A\u5E38\u8BC1\u4E66\u662F\u4EE5 .crt \u6216 .pem \u7B49\u4E3A\u6269\u5C55\u540D\u7684\u6587\u4EF6\uFF0C\u8BF7\u4F7F\u7528\u76F8\u5E94\u6587\u672C\u7F16\u8F91\u5668\u6253\u5F00\u8BC1\u4E66\u6587\u4EF6\u3002 2.\u8BC1\u4E66\u683C\u5F0F\u4EE5\u201C-----BEGIN CERTIFICATE-----\u201D\u5F00\u5934\uFF0C\u4EE5\u201C-----END CERTIFICATE-----\u201D\u7ED3\u5C3E\u3002 3.\u8BC1\u4E66\u5185\u5BB9\u8BF7\u5305\u542B\u5B8C\u6574\u7684\u8BC1\u4E66\u94FE\u3002",placeholder:"-----BEGIN CERTIFICATE-----",disabled:t&&t.domain.setting.autoSsl,required:!0},"sslCrt"),(0,e.jsx)(ie.Z,{fieldProps:{autoSize:{minRows:10}},label:"\u79C1\u94A5\u5185\u5BB9 .key ",name:"sslKey",tooltip:"1.\u901A\u5E38\u79C1\u94A5\u662F\u4EE5 .key \u6216 .pem \u7B49\u4E3A\u6269\u5C55\u540D\u7684\u6587\u4EF6\uFF0C\u8BF7\u4F7F\u7528\u76F8\u5E94\u6587\u672C\u7F16\u8F91\u5668\u6253\u5F00\u79C1\u94A5\u6587\u4EF6\u3002 2.\u79C1\u94A5\u683C\u5F0F\u4EE5\u201C-----BEGIN PRIVATE KEY-----\u201D\u5F00\u5934\uFF0C\u4EE5\u201C-----END PRIVATE KEY-----\u201D\u7ED3\u5C3E\u3002",placeholder:"-----BEGIN PRIVATE KEY-----",disabled:t&&t.domain.setting.autoSsl,required:!0},"sslKey")]})},{key:"3",label:"\u67E5\u770B vhost \u914D\u7F6E",children:(0,e.jsx)(Q.Z,{name:"vhost",label:" ",children:(0,e.jsx)(X.ZP,{height:"600px",theme:"dark",readOnly:!0,style:{backgroundColor:"#282c34"}})})}]})})}),xe=Fe,De=n(80821),Ae=n(67255),Be=n(43425),ye=n(10641),Se=n(96074),Re=n(60922),je=n(83062);function be(){var l=(0,g.useParams)(),d=(0,F.useRef)(),h=(0,F.useRef)(),u=(0,F.useRef)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(fe,{ref:u,onFinish:function(){var m,r;!((m=d.current)===null||m===void 0)&&m.reloadAndRest&&((r=d.current)===null||r===void 0||r.reloadAndRest())}}),(0,e.jsx)(ye.Z,{scroll:{x:"max-content"},rowKey:"id",actionRef:d,columns:[{title:"\u57DF\u540D",dataIndex:"serverName",render:function(m,r,f,p,t){return(0,e.jsx)("a",{href:"".concat(r.setting.enableSSL?"https":"http","://").concat(r.serverName),target:"_blank",children:r.serverName})}},{title:"\u5BB9\u5668\u5185\u7AEF\u53E3",dataIndex:["setting","port"],search:!1},{title:"SSL\u8BC1\u4E66",search:!1,render:function(m,r,f,p,t){var i;return r.setting.enableSSL?(0,e.jsxs)(te.Z,{color:"success",children:["\u8BC1\u4E66\u6709\u6548\u81F3\uFF1A",new Date((i=r.setting.sslCrtRenewTime)!==null&&i!==void 0?i:"").toLocaleDateString()]}):(0,e.jsx)(te.Z,{color:"red",children:"\u5426"})}},{title:"\u521B\u5EFA\u65F6\u95F4",search:!1,width:180,ellipsis:!0,dataIndex:"createdAt",render:function(m,r,f,p,t){return new Date(r.createdAt).toLocaleString()}},{title:"\u64CD\u4F5C",valueType:"option",key:"option",width:50,render:function(m,r,f,p){return(0,e.jsx)(ne.Z,{split:(0,e.jsx)(Se.Z,{type:"vertical"}),children:(0,e.jsx)(Re.Z.Link,{onClick:function(){var i;return(i=h.current)===null||i===void 0||i.showEdit(r),!0},children:(0,e.jsx)(je.Z,{title:"\u7BA1\u7406\u57DF\u540D",children:(0,e.jsx)(Be.Z,{})})})})}}],request:function(){var y=v()(s()().mark(function m(r,f,p){var t,i,b,c,a;return s()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,_({containerId:(t=(i=l.id)!==null&&i!==void 0?i:"")!==null&&t!==void 0?t:"",pageSize:(b=r.pageSize)!==null&&b!==void 0?b:10,page:(c=r.current)!==null&&c!==void 0?c:1,serverName:r.serverName,port:r.port});case 2:return a=E.sent,E.abrupt("return",{data:a.data.list.map(function(T){return T.setting||(T.setting={autoSsl:!1}),T}),success:!0,total:a.data.list.length});case 4:case"end":return E.stop()}},m)}));return function(m,r,f){return y.apply(this,arguments)}}(),toolBarRender:function(){var m;return[(0,e.jsx)(xe,{ref:h,containerId:(m=l.id)!==null&&m!==void 0?m:"",onFinish:function(){var f,p;!((f=d.current)===null||f===void 0)&&f.reloadAndRest&&((p=d.current)===null||p===void 0||p.reloadAndRest())}})]},rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},tableAlertOptionRender:function(m){var r=m.selectedRowKeys,f=m.selectedRows;return(0,e.jsxs)(ne.Z,{size:16,children:[(0,e.jsx)(De.Z,{danger:!0,type:"primary",action:function(){return z({id:r})},onSuccess:function(){var t,i;return!((t=d.current)===null||t===void 0)&&t.reloadAndRest&&((i=d.current)===null||i===void 0||i.reloadAndRest()),!0},onError:function(){var t,i;return!((t=d.current)===null||t===void 0)&&t.reset&&((i=d.current)===null||i===void 0||i.reset()),!0},messageSuccess:"\u5220\u9664\u6210\u529F",children:"\u6279\u91CF\u5220\u9664"}),(0,e.jsx)(oe.ZP,{onClick:function(){var t;(t=u.current)===null||t===void 0||t.apply(f)},children:"\u514D\u8D39\u8BC1\u4E66"})]})},pagination:(0,Ae.O)()})]})}},67255:function(q,w,n){n.d(w,{O:function(){return P},j:function(){return s}});function P(){var R,v=parseInt((R=localStorage.getItem("dpanel-pagesize"))!==null&&R!==void 0?R:"0");return{showSizeChanger:!0,defaultPageSize:v!=null?v:20}}function s(R){var v="dpanel-table-column-".concat(R),I={};if(localStorage.getItem(v)){var j;I=JSON.parse((j=localStorage.getItem(v))!==null&&j!==void 0?j:"{}")}return{defaultValue:I,onChange:function(g){localStorage.setItem("dpanel-table-column-".concat(R),JSON.stringify(g))}}}}}]);
