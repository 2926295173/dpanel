"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745,5947],{55809:function(H,b,e){var j=e(87462),u=e(67294),x=e(44805),v=e(84089),I=function(P,p){return u.createElement(v.Z,(0,j.Z)({},P,{ref:p,icon:x.Z}))},h=u.forwardRef(I);b.Z=h},60433:function(H,b,e){var j=e(87462),u=e(67294),x=e(69782),v=e(84089),I=function(P,p){return u.createElement(v.Z,(0,j.Z)({},P,{ref:p,icon:x.Z}))},h=u.forwardRef(I);b.Z=h},1699:function(H,b,e){e.d(b,{u:function(){return g}});var j=e(9783),u=e.n(j),x=e(97857),v=e.n(x),I=e(67294),h=e(82346),L=e(40411),P=e(42075),p=e(85893),g=function(a){var D=(0,h.useAccess)(),A=Array.isArray(a.access)?a.access:[a.access],d,f=a.fallback;return typeof a.children=="function"?(d=a.children(A.reduce(function(i,C){return v()(v()({},i),{},u()({},C,D[C]))},{})),d||(d=f)):A.every(function(i){return D[i]})?d=a.children:d=f,!f&&d&&a.showProTips&&D.canSeeEnableCe&&(d=(0,p.jsx)(L.Z,{offset:a.showProTipsOffset,count:"PRO",color:"gold",style:{fontWeight:"bold"},children:d})),!f&&d&&a.showProRibbonTips&&D.canSeeEnableCe&&(d=(0,p.jsx)(L.Z.Ribbon,{text:"PRO",color:"gold",style:{fontWeight:"bold"},children:d})),a.space?(0,p.jsx)(P.Z,v()(v()({},a.space),{},{children:d})):d}},27619:function(H,b,e){e.d(b,{Z:function(){return Z}});var j=e(97857),u=e.n(j),x=e(19632),v=e.n(x),I=e(5574),h=e.n(I),L=e(64183),P=e(82346),p=e(67294),g=e(85893);function Z(a){var D,A=(0,p.useState)("academy"),d=h()(A,2),f=d[0],i=d[1],C=Math.max.apply(Math,v()(a.data.map(function(R){var B;return(B=R[a.yField])!==null&&B!==void 0?B:0}))),E=(0,P.useModel)("@@initialState"),O=E.initialState,$=E.loading,F=E.error,J=E.refresh,X=E.setInitialState,n={xField:a.xField,yField:a.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:a.yLabelFormatter},scale:{y:{domainMin:(D=a.yDomainMin)!==null&&D!==void 0?D:0,domainMax:a.yDomainMax?a.yDomainMax:a.yDomainMaxCallback?a.yDomainMaxCallback(C):C}},data:a.data};return a.yLabelFormatter&&(n.axis.y.labelFormatter=a.yLabelFormatter),a.colorField&&(n.colorField=a.colorField),(0,p.useEffect)(function(){(O==null?void 0:O.theme.algorithm)=="dark"?i("classicDark"):i("academy")},[O]),(0,g.jsx)(L.Z,u()({theme:f},n))}},50070:function(H,b,e){e.r(b),e.d(b,{AppDetailContext:function(){return C},default:function(){return E}});var j=e(15009),u=e.n(j),x=e(99289),v=e.n(x),I=e(5574),h=e.n(I),L=e(1699),P=e(24963),p=e(60335),g=e(55809),Z=e(90078),a=e(82346),D=e(25593),A=e(28036),d=e(50136),f=e(67294),i=e(85893),C=(0,f.createContext)({});function E(){var O,$=(0,f.useContext)(P.Z),F=$.lang,J=$.loading,X=$.message,n=(0,a.useParams)(),R=(0,a.useSearchParams)(),B=h()(R,2),ee=B[0],M=B[1],U=(O=ee.get("tab"))!==null&&O!==void 0?O:"edit",W=(0,f.useState)("edit"),c=h()(W,2),k=c[0],S=c[1],r=(0,a.useNavigate)(),Q=(0,f.useState)(1),N=h()(Q,2),T=N[0],G=N[1],z=[{label:(0,i.jsx)(a.Link,{to:"/app/detail/edit/".concat(n.id,"?tab=edit"),children:"\u5BB9\u5668\u8BE6\u60C5"}),key:"edit"},{label:(0,i.jsx)(a.Link,{to:"/app/detail/network/".concat(n.id,"?tab=network"),children:"\u7F51\u7EDC\u7BA1\u7406"}),key:"network"},{label:(0,i.jsx)(D.Z.Link,{children:"\u6587\u4EF6\u7BA1\u7406"}),key:"file",onClick:function(){X.info(F("app.detail.createExplorerPlugin")),r("/app/detail/file/".concat(n.id,"?tab=file"))}},{label:(0,i.jsx)(D.Z.Link,{children:"\u8FD0\u884C\u65E5\u5FD7"}),key:"log",onClick:function(){r("/app/detail/log/".concat(n.id,"?tab=log"))}},{label:(0,i.jsx)(D.Z.Link,{children:"\u8FD0\u884C\u72B6\u6001"}),key:"stat",onClick:function(){r("/app/detail/stat/".concat(n.id,"?tab=stat"))}},{label:"",key:"containerName",icon:(0,i.jsx)(g.Z,{}),disabled:!0}],V=(0,f.useState)(z),Y=h()(V,2),o=Y[0],ae=Y[1];(0,f.useEffect)(function(){J.show(),S(U);var K=function(){var m=v()(u()().mark(function s(){var t,y,_;return u()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t=z,l.prev=1,l.next=4,(0,p.jV)({md5:(y=n.id)!==null&&y!==void 0?y:""});case 4:_=l.sent,t.map(function(w){return w.key=="containerName"&&(w.label=_.data.info.Name),(!_.data.info.State.Running||_.data.info.State.Restarting)&&(w.key=="file"||w.key=="stat")&&(w.disabled=!0),w}),ae(t),l.next=13;break;case 9:return l.prev=9,l.t0=l.catch(1),r("/app/list"),l.abrupt("return");case 13:return l.prev=13,J.destroy(),l.finish(13);case 16:case"end":return l.stop()}},s,null,[[1,9,13,16]])}));return function(){return m.apply(this,arguments)}}();K()},[T,n]);var te=function(m){S(m.key)};return(0,i.jsx)(C.Provider,{value:{reload:function(){G(T+1)}},children:(0,i.jsxs)(Z._z,{header:{extra:[(0,i.jsx)(L.u,{access:"canSeeContainerListManageCreate",children:(0,i.jsx)(a.Link,{to:"/app/create/image",children:(0,i.jsx)(A.ZP,{type:"primary",children:"\u521B\u5EFA\u5BB9\u5668"})})},"create")]},children:[(0,i.jsx)(d.Z,{mode:"horizontal",onClick:te,selectedKeys:[k],items:o}),(0,i.jsx)(a.Outlet,{})]})})}},41748:function(H,b,e){e.r(b),e.d(b,{default:function(){return ee}});var j=e(15009),u=e.n(j),x=e(99289),v=e.n(x),I=e(5574),h=e.n(I),L=e(19632),P=e.n(L),p=e(27619),g=e(67294);function Z(M){var U=M.reqFunction,W=M.interval,c=M.maxPolling,k=M.pollingStatus,S=M.inPath,r=(0,g.useRef)(null),Q=0,N=function G(){r.current=window.setTimeout(v()(u()().mark(function z(){var V;return u()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(Q++>=c)){o.next=3;break}return T(),o.abrupt("return");case 3:if(o.prev=3,!(S&&window.location.href.indexOf(S)==-1)){o.next=7;break}return T(),o.abrupt("return");case 7:return o.next=9,U();case 9:V=o.sent,G(),o.next=17;break;case 13:o.prev=13,o.t0=o.catch(3),T(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",o.t0);case 17:case"end":return o.stop()}},z,null,[[3,13]])})),W)},T=function(){console.log("end polling"),r.current&&window.clearTimeout(r.current)};return(0,g.useEffect)(function(){return console.log((k?"start":"waiting")+" polling, max "+c),k&&N(),function(){T()}},[W,c,k]),{endPolling:T}}var a=Z,D=e(24963),A=e(82346);function d(M){return f.apply(this,arguments)}function f(){return f=v()(u()().mark(function M(U){return u()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,A.request)("/api/app/container/get-stat-info",{method:"POST",data:U}));case 1:case"end":return c.stop()}},M)})),f.apply(this,arguments)}function i(M){return C.apply(this,arguments)}function C(){return C=v()(u()().mark(function M(U){return u()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,A.request)("/api/app/container/get-process-info",{method:"POST",data:U}));case 1:case"end":return c.stop()}},M)})),C.apply(this,arguments)}var E=e(5251),O=e(12122),$=e(60433),F=e(38345),J=e(60940),X=e(50070),n=e(85893),R=new Date().toLocaleTimeString(),B={total:0,memory:[{date:R,usage:0,source:{usage:0,limit:0}}],cpu:[{date:R,usage:0}],network:[{usage:0,type:"rx",date:R,source:{usage:0}},{usage:0,type:"tx",date:R,source:{usage:0}}],io:[{usage:0,type:"read",date:R,source:{usage:0}},{usage:0,type:"write",date:R,source:{usage:0}}]};function ee(){var M=function(s,t){switch(t.type){case"update":var y=new Date(t.payload.read).toLocaleTimeString(),_=t.payload.cpu_stats.cpu_usage.total_usage-t.payload.precpu_stats.cpu_usage.total_usage,q=t.payload.cpu_stats.system_cpu_usage-t.payload.precpu_stats.system_cpu_usage,l={total:s.total+1,memory:[],cpu:[].concat(P()(s.cpu),[{date:y,usage:_/q*t.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return t.payload.memory_stats&&t.payload.memory_stats.limit&&t.payload.memory_stats.usage&&(l.memory=[].concat(P()(s.memory),[{date:y,usage:Math.round(t.payload.memory_stats.usage),source:{usage:t.payload.memory_stats.usage,limit:t.payload.memory_stats.limit}}])),t.payload.networks&&(l.network=[].concat(P()(s.network),[{date:y,usage:parseFloat(t.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:t.payload.networks.eth0.rx_bytes}},{date:y,usage:parseFloat(t.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:t.payload.networks.eth0.tx_bytes}}])),t.payload.blkio_stats&&t.payload.blkio_stats.io_service_bytes_recursive&&t.payload.blkio_stats.io_service_bytes_recursive.length>0&&(l.io=[].concat(P()(s.io),[{date:y,usage:parseFloat(t.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:t.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:t.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:y,usage:parseFloat(t.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:t.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:t.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),l}},U=(0,g.useContext)(D.Z),W=U.loading,c=(0,A.useParams)(),k=(0,g.useReducer)(M,B),S=h()(k,2),r=S[0],Q=S[1],N=(0,g.useState)(0),T=h()(N,2),G=T[0],z=T[1],V=(0,g.useState)(),Y=h()(V,2),o=Y[0],ae=Y[1],te=a({reqFunction:function(){var m=v()(u()().mark(function t(){var y,_;return u()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,d({id:(y=c.id)!==null&&y!==void 0?y:""});case 2:_=l.sent,W.destroy(),Q({type:"update",payload:_});case 5:case"end":return l.stop()}},t)}));function s(){return m.apply(this,arguments)}return s}(),interval:3e3,maxPolling:999,pollingStatus:G!=0,inPath:"tab=stat"}),K=(0,g.useContext)(X.AppDetailContext);return(0,g.useEffect)(function(){K.reload()},[]),(0,g.useEffect)(function(){var m,s;W.show(),d({id:(m=c.id)!==null&&m!==void 0?m:""}).then(function(t){return z(Math.round(t.memory_stats.limit)),!0}),i({id:(s=c.id)!==null&&s!==void 0?s:""}).then(function(t){var y={columns:[],data:[]};t.data.list.Titles.map(function(_){y.columns.push({title:_,label:_,dataIndex:_})}),t.data.list.Processes.map(function(_,q){y.data.push({UID:_[0],PID:_[1],PPID:_[2],C:_[3],STIME:_[4],TTY:_[5],TIME:_[6],CMD:_[7]})}),ae(y)})},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(F.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[r.memory&&r.memory.length>0&&(0,n.jsx)(F.Z,{colSpan:12,title:(0,n.jsx)(O.Z,{}),subTitle:"Memory usage: ".concat((0,E.FI)(r.memory[r.memory.length-1].source.usage)," / ").concat((0,E.FI)(r.memory[r.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,n.jsx)(p.Z,{yField:"usage",xField:"date",data:r.memory,yDomainMaxCallback:function(s){return s*2},yLabelFormatter:function(s){return(0,E.FI)(parseFloat(s))}})}),(0,n.jsx)(F.Z,{colSpan:12,title:(0,n.jsx)(O.Z,{}),subTitle:"Cpu usage: ".concat(r.cpu[r.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,n.jsx)(p.Z,{yField:"usage",xField:"date",data:r.cpu,yDomainMaxCallback:function(s){return s*1.5},yLabelFormatter:function(s){return"".concat(s,"%")}})}),r.io&&r.io.length>0&&(0,n.jsx)(F.Z,{colSpan:12,title:(0,n.jsx)(O.Z,{}),subTitle:"I/O: ".concat((0,E.FI)(r.io[r.io.length-1].source.usage)," / ").concat((0,E.FI)(r.io[r.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,n.jsx)(p.Z,{yField:"usage",xField:"date",colorField:"type",data:r.io,yDomainMaxCallback:function(s){return s*2},yLabelFormatter:function(s){return(0,E.FI)(parseFloat(s))}})}),r.network&&r.network.length>0&&(0,n.jsx)(F.Z,{colSpan:12,title:(0,n.jsx)(O.Z,{}),subTitle:"Network: ".concat((0,E.FI)(r.network[r.network.length-1].source.usage)," / ").concat((0,E.FI)(r.network[r.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,n.jsx)(p.Z,{yField:"usage",xField:"date",colorField:"type",data:r.network,yDomainMaxCallback:function(s){return s*2},yLabelFormatter:function(s){return(0,E.FI)(parseFloat(s))}})})]}),(0,n.jsx)(F.Z,{title:(0,n.jsx)($.Z,{}),subTitle:"Progress",children:(0,n.jsx)(J.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:o==null?void 0:o.columns,dataSource:o==null?void 0:o.data,pagination:{pageSize:10}})})]})}}}]);
