"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5738],{38978:function(oe,Q,t){t.r(Q),t.d(Q,{default:function(){return Ne}});var _=t(5574),E=t.n(_),ee=t(15009),D=t.n(ee),W=t(99289),$=t.n(W),S=t(28031),K=t(10641),s=t(67294),G=(0,s.createContext)({}),M=G,Y=t(24969),te=t(48689),N=t(42075),U=t(14726),z=t(80821),B=t(88484),b=t(37476),I=t(91604),x=t(97961),ne=t(54006),e=t(85893);function se(){var n=(0,s.useRef)(),u=(0,s.useContext)(M),p=u.fileListRef,v=u.containerMd5,w=u.currentPath,h=(0,ne.useModel)("@@initialState"),m=h.initialState,g=h.loading,T=h.error,P=h.refresh,c=h.setInitialState;return(0,e.jsx)(b.Y,{formRef:n,trigger:(0,e.jsx)(U.ZP,{icon:(0,e.jsx)(B.Z,{}),children:"\u4E0A\u4F20"}),title:"\u4E0A\u4F20\u6587\u4EF6\u5230\u5BB9\u5668",onFinish:function(){var Z=$()(D()().mark(function y(j){var i,r,f,l;return D()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return f=[],j.importFileList&&j.importFileList.map(function(L){f.push({name:L.name,path:L.response.data.path})}),(0,S.ZU)({fileList:f,md5:v,destPath:w}),(i=n.current)===null||i===void 0||i.resetFields(),p&&typeof((r=p.current)===null||r===void 0?void 0:r.reloadAndRest)=="function"&&((l=p.current)===null||l===void 0||l.reloadAndRest()),C.abrupt("return",!0);case 6:case"end":return C.stop()}},y)}));return function(y){return Z.apply(this,arguments)}}(),children:(0,e.jsx)(I.Z,{name:"importFileList",fieldProps:{multiple:!0,name:"file",action:"/api/common/attach/upload",headers:{Authorization:"Bearer "+localStorage.getItem("token")},onRemove:function(y){return new Promise(function(j){var i;(0,x._2)({path:(i=y.response.data.path)!==null&&i!==void 0?i:""}).then(function(r){j(!0)})})}}})})}var ce=t(23430),de=t(93162);function he(n){var u=(0,s.useContext)(M),p=u.containerMd5;return(0,e.jsx)(z.Z,{action:function(){return(0,S._U)({md5:p,fileList:n.selectFileList})},onSuccess:function(w){var h=new Blob([w],{type:"application/zip"});(0,de.saveAs)(h,"export.zip")},icon:(0,e.jsx)(ce.Z,{}),children:"\u4E0B\u8F7D"})}var k=t(38345),V=t(63434),me=t(24739),le=t(5966),fe=t(64317),re=t(31418),ae=t(24963);function ve(n){var u=(0,s.useContext)(ae.Z),p=u.message,v=u.notice,w=u.lang,h=(0,s.useRef)(),m=(0,s.useContext)(M),g=m.currentPath,T=m.reloadFileList,P=m.containerMd5,c=(0,s.useState)(),Z=E()(c,2),y=Z[0],j=Z[1],i=re.Z.useApp(),r=(0,s.useState)(!1),f=E()(r,2),l=f[0],d=f[1],C=function(o){var a=o.split(""),R=0,O=0,A=0;return a[1]=="r"&&(R+=4),a[2]=="w"&&(R+=2),a[3]=="x"&&(R+=1),a[4]=="r"&&(O+=4),a[5]=="w"&&(O+=2),a[6]=="x"&&(O+=1),a[7]=="r"&&(A+=4),a[8]=="w"&&(A+=2),a[9]=="x"&&(A+=1),"".concat(R).concat(O).concat(A)},L=function(o){var a;if((a=h.current)===null||a===void 0||a.setFieldValue("permission",o),o.length>=1){var R;(R=h.current)===null||R===void 0||R.setFieldsValue({ownerRead:o[0]&4,ownerWrite:o[0]&2,ownerExec:o[0]&1})}if(o.length>=2){var O;(O=h.current)===null||O===void 0||O.setFieldsValue({groupRead:o[1]&4,groupWrite:o[1]&2,groupExec:o[1]&1})}if(o.length>=3){var A;(A=h.current)===null||A===void 0||A.setFieldsValue({everyoneRead:o[2]&4,everyoneWrite:o[2]&2,everyoneExec:o[2]&1})}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(U.ZP,{onClick:function(){if(n.selectFileObject.length==0){var o;return(o=h.current)===null||o===void 0||o.resetFields(),v.error("\u8BF7\u5148\u9009\u62E9\u8981\u4FEE\u6539\u7684\u6587\u4EF6\u6216\u662F\u76EE\u5F55"),d(!1),!1}else(0,S.lE)({md5:P}).then(function(a){if(a.data.list.length==0)return v.error("\u8BE5\u5BB9\u5668\u4E0D\u652F\u6301\u4FEE\u6539\u6587\u4EF6\u6743\u9650"),d(!1),!1;j(a.data.list),d(!0)})},children:"\u6743\u9650"}),(0,e.jsxs)(b.Y,{modalProps:{forceRender:!0},title:n.selectFileObject.length==1?"\u4FEE\u6539 ".concat(n.selectFileObject[0].name," \u6743\u9650"):"\u6279\u91CF\u6587\u4EF6\u4FEE\u6539\u6743\u9650",layout:"horizontal",open:l,onOpenChange:function(o){if(d(o),n.selectFileObject.length==1){var a;L(C(n.selectFileObject[0].mode));var R=n.selectFileObject[0].owner;y&&y.map(function(O){O.uid==R&&(R=O.username)}),(a=h.current)===null||a===void 0||a.setFieldValue("owner",R)}},formRef:h,onValuesChange:function(o,a){if(o.permission)L(o.permission);else{var R=["-",a.ownerRead?"r":"-",a.ownerWrite?"w":"-",a.ownerExec?"x":"-",a.groupRead?"r":"-",a.groupWrite?"w":"-",a.groupExec?"x":"-",a.everyoneRead?"r":"-",a.everyoneWrite?"w":"-",a.everyoneExec?"x":"-"];L(C(R.join("")))}},onFinish:function(){var F=$()(D()().mark(function o(a){var R,O,A,We;return D()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return A=[],n.selectFileObject.map(function(Ue){A.push(Ue.name)}),H.next=4,(0,S.OQ)({md5:P,fileList:A,mod:parseInt((R=a.permission)!==null&&R!==void 0?R:"600"),hasChildren:(O=a.hasChildren)!==null&&O!==void 0?O:!0,owner:a.owner});case 4:return We=H.sent,T(),H.abrupt("return",!0);case 7:case"end":return H.stop()}},o)}));return function(o){return F.apply(this,arguments)}}(),children:[(0,e.jsxs)(k.Z,{direction:"row",gutter:[20,10],children:[(0,e.jsxs)(k.Z,{bordered:!0,title:"\u6240\u6709\u8005",headerBordered:!0,children:[(0,e.jsx)(V.Z,{label:"\u8BFB\u53D6",name:"ownerRead"}),(0,e.jsx)(V.Z,{label:"\u5199\u5165",name:"ownerWrite"}),(0,e.jsx)(V.Z,{label:"\u6267\u884C",name:"ownerExec"})]}),(0,e.jsxs)(k.Z,{bordered:!0,title:"\u7528\u6237\u7EC4",headerBordered:!0,children:[(0,e.jsx)(V.Z,{label:"\u8BFB\u53D6",name:"groupRead"}),(0,e.jsx)(V.Z,{label:"\u5199\u5165",name:"groupWrite"}),(0,e.jsx)(V.Z,{label:"\u6267\u884C",name:"groupExec"})]}),(0,e.jsxs)(k.Z,{bordered:!0,title:"\u516C\u5171",headerBordered:!0,children:[(0,e.jsx)(V.Z,{label:"\u8BFB\u53D6",name:"everyoneRead"}),(0,e.jsx)(V.Z,{label:"\u5199\u5165",name:"everyoneWrite"}),(0,e.jsx)(V.Z,{label:"\u6267\u884C",name:"everyoneExec"})]})]}),(0,e.jsx)(k.Z,{children:(0,e.jsxs)(me.UW,{children:[(0,e.jsx)(le.Z,{label:"\u6743\u9650",name:"permission",fieldProps:{maxLength:3},width:"xs"}),(0,e.jsx)(fe.Z,{label:"\u6240\u6709\u8005",name:"owner",width:"sm",options:y==null?void 0:y.map(function(F){return F.username})}),(0,e.jsx)(V.Z,{label:"\u5E94\u7528\u5230\u5B50\u76EE\u5F55",name:"hasChildren",initialValue:!0})]})})]})]})}function Fe(n){var u=(0,s.useContext)(M),p=u.currentPath,v=u.reloadFileList,w=u.containerMd5,h=re.Z.useApp(),m=(0,s.useContext)(ae.Z),g=m.notice,T=m.message,P=m.lang;return(0,e.jsx)(U.ZP,{onClick:function(){if(n.selectFileObject.length==0)return g.error("\u8BF7\u5148\u9009\u62E9\u8981\u89E3\u538B\u7684 zip \u6587\u4EF6"),!1;if(n.selectFileObject.length>1)return g.error("\u89E3\u538B\u64CD\u4F5C\u53EA\u652F\u6301\u5355\u6587\u4EF6\u64CD\u4F5C"),!1;var Z=n.selectFileObject[0];if(Z.name.lastIndexOf(".zip")!=Z.name.length-4)return g.error("\u89E3\u538B\u64CD\u4F5C\u53EA\u652F\u6301 zip \u6587\u4EF6"),!1;(0,S.gb)({md5:w,file:Z.name}).then(function(y){v()})},children:"\u89E3\u538B"})}function xe(n){var u=(0,s.useContext)(M),p=u.fileListRef,v=u.containerMd5,w=u.currentPath,h=u.editFileRef;return(0,e.jsxs)(N.Z,{size:16,wrap:!0,children:[(0,e.jsx)(he,{selectFileList:n.selectFileList}),(0,e.jsx)(se,{}),(0,e.jsx)(ve,{selectFileObject:n.selectFileObject}),(0,e.jsx)(Fe,{selectFileObject:n.selectFileObject}),(0,e.jsx)(U.ZP,{type:"primary",icon:(0,e.jsx)(Y.Z,{}),onClick:function(){var g;(g=h.current)===null||g===void 0||g.newFile()},children:"\u65B0\u5EFA\u6587\u4EF6"}),(0,e.jsx)(z.Z,{danger:!0,type:"default",icon:(0,e.jsx)(te.Z,{}),action:function(){return(0,S.Yx)({md5:v,fileList:n.selectFileList})},onSuccess:function(){var g;if(p&&typeof((g=p.current)===null||g===void 0?void 0:g.reloadAndRest)=="function"){var T;(T=p.current)===null||T===void 0||T.reloadAndRest()}},messageSuccess:"delete",children:"\u5220\u9664"})]})}var J=t(83062),X=t(66309);function pe(n){return n.change==0?(0,e.jsx)(J.Z,{title:"\u5728\u5BB9\u5668\u8FD0\u884C\u65F6\u88AB\u4FEE\u6539",children:(0,e.jsx)(X.Z,{color:"blue",children:"MODIFIED"})}):n.change==1?(0,e.jsx)(J.Z,{title:"\u5728\u5BB9\u5668\u8FD0\u884C\u65F6\u65B0\u589E\u7684\u6587\u4EF6",children:(0,e.jsx)(X.Z,{color:"green",children:"ADD"})}):n.change==2?(0,e.jsx)(J.Z,{title:"\u5728\u5BB9\u5668\u8FD0\u884C\u65F6\u88AB\u5220\u9664\u6587\u4EF6",children:(0,e.jsx)(X.Z,{color:"error",children:"DELETED"})}):n.change==100?(0,e.jsx)(J.Z,{title:"\u6302\u8F7D\u7684\u6301\u4E45\u5316\u76EE\u5F55",children:(0,e.jsx)(X.Z,{color:"cyan",children:"VOLUME"})}):(0,e.jsx)(e.Fragment,{})}var je=t(19632),ie=t.n(je),ge=t(27254),q=t(25593),Ce=(0,s.forwardRef)(function(n,u){var p=(0,s.useContext)(M),v=p.showPath,w=(0,s.useState)([{title:"\u6839\u76EE\u5F55",path:"/"}]),h=E()(w,2),m=h[0],g=h[1];(0,s.useImperativeHandle)(u,function(){return{addHistory:function(c,Z){g([].concat(ie()(m),[{title:c,path:Z}]))},initHistory:function(c){g([{title:"\u6839\u76EE\u5F55",path:"/"}].concat(ie()(c)))}}});var T=function(c){v(m[c].title,m[c].path);var Z=m.filter(function(y,j){return j<=c});g(ie()(Z))};return(0,e.jsx)(N.Z.Compact,{children:m.map(function(P,c){return(0,e.jsx)(U.ZP,{icon:(0,e.jsx)(ge.Z,{}),type:"dashed",onClick:function(){T(c)},children:c==m.length-1?(0,e.jsx)(q.Z.Text,{copyable:{text:P.path},children:P.title}):P.title},c)})})}),we=Ce,ye=t(97269),Ee=t(62370),Ze=t(90672),Re=t(97462),Pe=t(85576),Be=t(95089),Le=(0,s.forwardRef)(function(n,u){var p,v=(0,s.useContext)(ae.Z),w=v.message,h=v.notice,m=(0,s.useContext)(M),g=m.currentPath,T=m.reloadFileList,P=m.containerMd5,c=(0,s.useRef)(),Z=(0,s.useState)(!1),y=E()(Z,2),j=y[0],i=y[1],r=re.Z.useApp();return(0,s.useImperativeHandle)(u,function(){return{newFile:function(){var l;i(!0),(l=c.current)===null||l===void 0||l.resetFields()},editFile:function(l,d,C){var L;(L=c.current)===null||L===void 0||L.resetFields(),w.loading("\u6B63\u5728\u83B7\u53D6\u6587\u4EF6\u5185\u5BB9"),(0,S.LK)({md5:P,file:d}).then(function(F){var o,a;if(F.data.content==""&&C!="0"){w.error("\u4E0D\u652F\u6301\u7F16\u8F91\u7684\u6587\u4EF6\u7C7B\u578B"),i(!1);return}(o=c.current)===null||o===void 0||o.setFieldValue("newValue",F.data.content),(a=c.current)===null||a===void 0||a.setFieldValue("newName",l),w.destroy(),i(!0)}).finally(function(){w.destroy()})}}}),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Pe.Z,{width:"800px",title:(p=c.current)!==null&&p!==void 0&&p.getFieldValue("newName")?"\u7F16\u8F91\u6587\u4EF6":"\u65B0\u5EFA\u6587\u4EF6",open:j,onCancel:function(){return i(!1)},footer:!1,forceRender:!0,children:(0,e.jsxs)(ye.A,{formRef:c,onFinish:function(){var f=$()(D()().mark(function l(d){var C;return D()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return(0,S.C4)({destPath:g,file:d.newName.indexOf("/")!==0?"/"+d.newName:d.newName,content:d.newValue,md5:P}),(C=c.current)===null||C===void 0||C.resetFields(),i(!1),T(),F.abrupt("return",!0);case 5:case"end":return F.stop()}},l)}));return function(l){return f.apply(this,arguments)}}(),children:[(0,e.jsx)(le.Z,{label:"\u6587\u4EF6\u540D",tooltip:"\u7F16\u8F91\u6587\u4EF6\u65F6\u4FEE\u6539\u6587\u4EF6\u540D\u53EF\u5B9E\u73B0\u590D\u5236\u529F\u80FD",name:"newName",fieldProps:{addonBefore:g},placeholder:"\u8BF7\u8F93\u5165\u6587\u4EF6\u540D\uFF1B\u652F\u6301\u65B0\u5EFA\u76EE\u5F55\uFF0C\u9700\u8981\u6307\u5B9A\u5B8C\u6574\u8DEF\u5F84\uFF0C\u4F8B\u5982\uFF1A/test/test.txt"}),(0,e.jsxs)(Ee.Z,{label:"\u5185\u5BB9",children:[(0,e.jsx)(Ze.Z,{hidden:!0,name:"newValue"}),(0,e.jsx)(Re.Z,{name:["newValue"],children:function(l){var d=l.newValue;return(0,e.jsx)(Be.ZP,{theme:"dark",height:"500px",value:d,onChange:function(L){var F;(F=c.current)===null||F===void 0||F.setFieldValue("newValue",L)}})}})]})]})})})}),Oe=Le,De=t(75516),Te=t(60335),Ae=t(93613),Se=t(29158),be=t(2741);function ue(n){return n.isDir?(0,e.jsx)(q.Z.Link,{onClick:function(){n.onClick&&n.onClick()},children:(0,e.jsxs)(N.Z,{children:[(0,e.jsx)(Ae.Z,{}),n.showName]})}):n.isLink?(0,e.jsx)(q.Z.Text,{children:(0,e.jsxs)(N.Z,{children:[(0,e.jsx)(Se.Z,{}),n.showName]})}):(0,e.jsx)(q.Z.Text,{onClick:function(){n.onClick&&n.onClick()},style:{cursor:"pointer"},children:(0,e.jsxs)(N.Z,{children:[(0,e.jsx)(be.Z,{}),n.showName]})})}function Me(n){var u=(0,s.useRef)(),p=(0,s.useRef)(),v=(0,s.useRef)(),w=(0,s.useState)("/"),h=E()(w,2),m=h[0],g=h[1],T=(0,s.useState)(),P=E()(T,2),c=P[0],Z=P[1];(0,s.useEffect)(function(){if(n.initialValue){for(var j,i=n.initialValue.split("/"),r=[],f="",l=1;l<i.length;l++)f+="/"+i[l],r.push({title:i[l],path:f});y(i[i.length-1],n.initialValue),(j=u.current)===null||j===void 0||j.initHistory([].concat(r))}(0,Te.jV)({md5:n.md5}).then(function(d){d.data&&Z(d.data.info)})},[n.initialValue]);var y=function(i,r){var f,l;if((f=u.current)===null||f===void 0||f.addHistory(i,r),g(r),v&&typeof((l=v.current)===null||l===void 0?void 0:l.reloadAndRest)=="function"){var d;(d=v.current)===null||d===void 0||d.reloadAndRest()}};return(0,e.jsxs)(M.Provider,{value:{fileListRef:v,containerMd5:n.md5,currentPath:m,showPath:y,reloadFileList:function(){var i;if(v&&typeof((i=v.current)===null||i===void 0?void 0:i.reloadAndRest)=="function"){var r;(r=v.current)===null||r===void 0||r.reloadAndRest()}},editFileRef:p},children:[(0,e.jsx)(K.Z,{scroll:{x:"max-content"},rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},toolBarRender:function(){var i=[];return c!=null&&c.Id&&i.push((0,e.jsx)(De.Z,{container:c,workDir:m},"console")),[].concat(i)},tableAlertOptionRender:function(i){var r=i.selectedRowKeys,f=i.selectedRows,l=[];return f.map(function(d){l.push(d.name)}),[(0,e.jsx)(xe,{selectFileList:l,selectFileObject:f},"1")]},headerTitle:(0,e.jsx)(we,{ref:u}),actionRef:v,search:!1,rowKey:"showName",pagination:{pageSize:1e3},request:$()(D()().mark(function j(){return D()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(f,l){n.md5&&(0,S.V9)({md5:n.md5,path:m}).then(function(d){if(d.data.list){var C={data:d.data.list,success:!0,total:d.data.list.length};f(C)}else f({data:[],success:!0,total:0})})}));case 1:case"end":return r.stop()}},j)})),columns:[{title:"\u540D\u79F0",dataIndex:"showName",key:"name",render:function(C,r,f,l,d){var C;return r.isDir?C=(0,e.jsx)(ue,{isDir:!0,onClick:function(){return y(r.showName,r.name)},showName:r.showName}):r.linkName?C=(0,e.jsx)(ue,{isLink:!0,showName:"".concat(r.showName)}):C=(0,e.jsx)(ue,{showName:r.showName,onClick:function(){var F;(F=p.current)===null||F===void 0||F.editFile(r.showName,r.name,r.size)}}),C}},{title:"\u72B6\u6001",key:"status",width:110,render:function(i,r,f,l,d){return(0,e.jsx)(pe,{change:r.change})}},{title:"\u6743\u9650",dataIndex:"mode",key:"mode"},{title:"\u7528\u6237",dataIndex:"owner"},{title:"\u7528\u6237\u7EC4",dataIndex:"group"},{title:"\u5927\u5C0F",dataIndex:"size",key:"size"},{title:"\u4FEE\u6539\u65F6\u95F4",dataIndex:"modTime",key:"modTime",sorter:function(i,r){return new Date(i.modTime).getTime()-new Date(r.modTime).getTime()}}]}),(0,e.jsx)(Oe,{ref:p})]})}var Ie=Me;function Ve(){var n,u,p=(0,ne.useParams)(),v=(0,ne.useSearchParams)(),w=E()(v,2),h=w[0],m=w[1];return(0,e.jsx)("div",{children:(0,e.jsx)(Ie,{md5:(n=p.id)!==null&&n!==void 0?n:"",initialValue:(u=h.get("path"))!==null&&u!==void 0?u:""})})}var Ne=Ve},97961:function(oe,Q,t){t.d(Q,{GH:function(){return M},MF:function(){return U},_2:function(){return te},fN:function(){return S},ii:function(){return $},vC:function(){return s}});var _=t(15009),E=t.n(_),ee=t(99289),D=t.n(ee),W=t(54006),$=[{name:"linux/amd64",arch:"amd64",search:["amd64","x86_64","86_64"]},{name:"linux/arm64",arch:"arm64",search:["arm64","arrch64"]},{name:"linux/i386",arch:"386",search:[]},{name:"linux/arm/v6",arch:"arm",search:[]},{name:"linux/arm/v7",arch:"arm",search:[]},{name:"linux/arm/v8",arch:"arm64",search:[]},{name:"linux/ppc64le",arch:"ppc64le",search:[]},{name:"linux/riscv64",arch:"riscv64",search:[]}];function S(B){return K.apply(this,arguments)}function K(){return K=D()(E()().mark(function B(b){return E()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.abrupt("return",(0,W.request)("/api/app/image/create-by-dockerfile",{method:"POST",data:b}));case 1:case"end":return x.stop()}},B)})),K.apply(this,arguments)}function s(B){return G.apply(this,arguments)}function G(){return G=D()(E()().mark(function B(b){return E()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.abrupt("return",(0,W.request)("/api/app/image/import-by-container-tar",{method:"POST",data:b}));case 1:case"end":return x.stop()}},B)})),G.apply(this,arguments)}function M(B){return Y.apply(this,arguments)}function Y(){return Y=D()(E()().mark(function B(b){return E()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.abrupt("return",(0,W.request)("/api/app/image/import-by-image-tar",{method:"POST",data:b}));case 1:case"end":return x.stop()}},B)})),Y.apply(this,arguments)}function te(B){return N.apply(this,arguments)}function N(){return N=D()(E()().mark(function B(b){return E()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,W.request)("/api/common/attach/delete",{method:"POST",data:b});case 2:return x.abrupt("return",x.sent);case 3:case"end":return x.stop()}},B)})),N.apply(this,arguments)}function U(){return z.apply(this,arguments)}function z(){return z=D()(E()().mark(function B(){return E()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.abrupt("return",(0,W.request)("/api/app/image/get-template-list",{method:"POST"}));case 1:case"end":return I.stop()}},B)})),z.apply(this,arguments)}}}]);
