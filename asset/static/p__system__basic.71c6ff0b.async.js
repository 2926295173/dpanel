"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1050],{86615:function(Y,w,e){var O=e(1413),s=e(45987),L=e(22270),E=e(78045),N=e(67294),B=e(90789),A=e(40284),R=e(85893),W=["fieldProps","options","radioType","layout","proFieldProps","valueEnum"],T=N.forwardRef(function(a,i){var p=a.fieldProps,C=a.options,D=a.radioType,o=a.layout,t=a.proFieldProps,F=a.valueEnum,l=(0,s.Z)(a,W);return(0,R.jsx)(A.Z,(0,O.Z)((0,O.Z)({valueType:D==="button"?"radioButton":"radio",ref:i,valueEnum:(0,L.h)(F,void 0)},l),{},{fieldProps:(0,O.Z)({options:C,layout:o},p),proFieldProps:t,filedConfig:{customLightMode:!0}}))}),m=N.forwardRef(function(a,i){var p=a.fieldProps,C=a.children;return(0,R.jsx)(E.ZP,(0,O.Z)((0,O.Z)({},p),{},{ref:i,children:C}))}),n=(0,B.G)(m,{valuePropName:"checked",ignoreWidth:!0}),h=n;h.Group=T,h.Button=E.ZP.Button,h.displayName="ProFormComponent",w.Z=h},5966:function(Y,w,e){var O=e(97685),s=e(1413),L=e(45987),E=e(21770),N=e(21054),B=e(55241),A=e(98423),R=e(67294),W=e(40284),T=e(85893),m=["fieldProps","proFieldProps"],n=["fieldProps","proFieldProps"],h="text",a=function(o){var t=o.fieldProps,F=o.proFieldProps,l=(0,L.Z)(o,m);return(0,T.jsx)(W.Z,(0,s.Z)({valueType:h,fieldProps:t,filedConfig:{valueType:h},proFieldProps:F},l))},i=function(o){var t=(0,E.Z)(o.open||!1,{value:o.open,onChange:o.onOpenChange}),F=(0,O.Z)(t,2),l=F[0],G=F[1];return(0,T.jsx)(N.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(I){var S,X=I.getFieldValue(o.name||[]);return(0,T.jsx)(B.Z,(0,s.Z)((0,s.Z)({getPopupContainer:function(y){return y&&y.parentNode?y.parentNode:y},onOpenChange:function(y){return G(y)},content:(0,T.jsxs)("div",{style:{padding:"4px 0"},children:[(S=o.statusRender)===null||S===void 0?void 0:S.call(o,X),o.strengthText?(0,T.jsx)("div",{style:{marginTop:10},children:(0,T.jsx)("span",{children:o.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},o.popoverProps),{},{open:l,children:o.children}))}})},p=function(o){var t=o.fieldProps,F=o.proFieldProps,l=(0,L.Z)(o,n),G=(0,R.useState)(!1),H=(0,O.Z)(G,2),I=H[0],S=H[1];return t!=null&&t.statusRender&&l.name?(0,T.jsx)(i,{name:l.name,statusRender:t==null?void 0:t.statusRender,popoverProps:t==null?void 0:t.popoverProps,strengthText:t==null?void 0:t.strengthText,open:I,onOpenChange:S,children:(0,T.jsx)("div",{children:(0,T.jsx)(W.Z,(0,s.Z)({valueType:"password",fieldProps:(0,s.Z)((0,s.Z)({},(0,A.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(J){var y;t==null||(y=t.onBlur)===null||y===void 0||y.call(t,J),S(!1)},onClick:function(J){var y;t==null||(y=t.onClick)===null||y===void 0||y.call(t,J),S(!0)}}),proFieldProps:F,filedConfig:{valueType:h}},l))})}):(0,T.jsx)(W.Z,(0,s.Z)({valueType:"password",fieldProps:t,proFieldProps:F,filedConfig:{valueType:h}},l))},C=a;C.Password=p,C.displayName="ProFormComponent",w.Z=C},1699:function(Y,w,e){e.d(w,{u:function(){return T}});var O=e(9783),s=e.n(O),L=e(97857),E=e.n(L),N=e(67294),B=e(82346),A=e(40411),R=e(42075),W=e(85893),T=function(n){var h=(0,B.useAccess)(),a=Array.isArray(n.access)?n.access:[n.access],i,p=n.fallback;if(typeof n.children=="function"?(i=n.children(a.reduce(function(C,D){return E()(E()({},C),{},s()({},D,h[D]))},{})),i||(i=p)):a.every(function(C){return h[C]})?i=n.children:i=p,!p&&i&&n.showProTips&&h.canSeeEnableCe){if(h.canSeeEnableHiddenProTips)return null;i=(0,W.jsx)(A.Z,{offset:n.showProTipsOffset,count:"PRO",color:"gold",style:{fontWeight:"bold"},children:i})}if(!p&&i&&n.showProRibbonTips&&h.canSeeEnableCe){if(h.canSeeEnableHiddenProTips)return null;i=(0,W.jsx)(A.Z.Ribbon,{text:"PRO",color:"gold",style:{fontWeight:"bold"},children:i})}return n.space?(0,W.jsx)(R.Z,E()(E()({},n.space),{},{children:i})):i}},80821:function(Y,w,e){e.d(w,{Z:function(){return h}});var O=e(97857),s=e.n(O),L=e(5574),E=e.n(L),N=e(24963),B=e(36146),A=e(86738),R=e(83062),W=e(96074),T=e(83622),m=e(67294),n=e(85893);function h(a){var i=(0,m.useState)(!1),p=E()(i,2),C=p[0],D=p[1],o=(0,m.useContext)(N.Z),t=o.message,F=new B.Uo,l=function(){D(!0);var H=a.action();H instanceof Promise?H.then(function(I){if(D(!1),I){typeof a.onSuccess=="function"&&a.onSuccess(I);var S="";a.messageSuccess?typeof a.messageSuccess=="function"?S=a.messageSuccess(I):S=a.messageSuccess.indexOf("notification.")==0?F.format(a.messageSuccess):a.messageSuccess:S=F.format("notification.finish"),a.asynced?t.info(S):t.success(S)}}).catch(function(I){D(!1),typeof a.onError=="function"&&a.onError(I)}):D(!1)};return a.confirm?(0,n.jsx)(A.Z,s()(s()({style:{width:500},title:a.confirmTitle?a.confirmTitle:F.format("notification.title.tip"),description:typeof a.confirm=="string"&&a.confirm.indexOf("notification.")==0?F.format(a.confirm):a.confirm,onConfirm:l,okText:"Yes",cancelText:"No",onOpenChange:a.confirmOnOpenChange},a.confirmProps),{},{children:(0,n.jsxs)(R.Z,{title:a.tips,children:[a.showDivider&&(0,n.jsx)(W.Z,{type:"vertical",style:{marginRight:15}}),(0,n.jsx)(T.ZP,{block:a.block,disabled:a.disabled,icon:!a.children&&C?void 0:a.icon,loading:C,danger:a.danger,type:a.type,children:a.children})]})})):(0,n.jsxs)(R.Z,{title:a.tips,children:[a.showDivider&&(0,n.jsx)(W.Z,{type:"vertical",style:{marginRight:15}}),(0,n.jsx)(T.ZP,{block:a.block,style:a.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:a.disabled,icon:!a.children&&C?void 0:a.icon,loading:C,onClick:l,danger:a.danger,type:a.type,children:a.children})]})}},3616:function(Y,w,e){e.d(w,{Ed:function(){return E},FK:function(){return s},R_:function(){return O},ob:function(){return L}});var O=window.innerWidth<=1024?"90vw":"65vw",s="90vw",L="60vw",E="50vh"},24963:function(Y,w,e){var O=e(67294),s=(0,O.createContext)({});w.Z=s},32053:function(Y,w,e){e.r(w),e.d(w,{default:function(){return de}});var O=e(15009),s=e.n(O),L=e(99289),E=e.n(L),N=e(5574),B=e.n(N),A=e(62370),R=e(97462),W=e(42075),T=e(80821),m=e(36146),n=e(85893);function h(P){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(A.Z,{name:P.name,hidden:!0}),(0,n.jsx)(R.Z,{name:[P.name],children:function(v){var g=v[P.name];return(0,n.jsx)(A.Z,{label:P.label,children:(0,n.jsxs)(W.Z.Compact,{children:[(0,n.jsx)(T.Z,{confirm:m.FD.format("confirm.disable"),action:function(){return P.onDisable()},danger:P.disable(g),type:P.disable(g)?"primary":"default",onSuccess:function(){P.onFinish&&P.onFinish()},children:m.FD.format("listManageDisable")}),P.settingComponent&&(0,n.jsx)(P.settingComponent,{data:g,onFinish:P.onFinish})]})})}})]})}var a=e(24963),i=e(87662),p=e(86548),C=e(97937),D=e(184),o=e(5966),t=e(82346),F=e(83622),l=e(67294),G=e(3616),H=function(_){var v=(0,l.useRef)(),g=(0,t.useModel)("@@initialState"),M=g.refresh,V=(0,l.useContext)(a.Z),U=V.message,b=new m.Uo("components.systemBasic"),z=(0,l.useState)(!1),Q=B()(z,2),Z=Q[0],j=Q[1];return(0,n.jsxs)(D.a,{trigger:(0,n.jsx)(F.ZP,{type:"primary",children:m.FD.format("listManageSetting")}),onOpenChange:function(f){var r;j(f),f&&((r=v.current)===null||r===void 0||r.setFieldValue("username",_.data.username))},open:Z,drawerProps:{width:G.R_,forceRender:!0},title:b.format("adminTitle"),formRef:v,onFinish:function(){var x=E()(s()().mark(function f(r){var d,u;return s()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,(0,i.Jn)({username:r.username,password:r.password,newPassword:r.newPassword});case 2:if(d=c.sent,!(d&&d.data)){c.next=9;break}return(u=v.current)===null||u===void 0||u.resetFields(),U.success(m.FD.format("finish")),localStorage.removeItem("token"),M(),c.abrupt("return",!0);case 9:case"end":return c.stop()}},f)}));return function(f){return x.apply(this,arguments)}}(),children:[(0,n.jsx)(R.Z,{name:["enableUsername"],children:function(f){var r=f.enableUsername;return(0,n.jsx)(o.Z,{label:b.format("adminUsername"),name:"username",width:"lg",disabled:!r,addonAfter:[(0,n.jsx)(F.ZP,{type:"link",hidden:!!r,icon:(0,n.jsx)(p.Z,{}),onClick:function(){var u;(u=v.current)===null||u===void 0||u.setFieldValue("enableUsername",!0)}},"editBtn"),(0,n.jsx)(F.ZP,{type:"link",hidden:!r,icon:(0,n.jsx)(C.Z,{}),onClick:function(){var u;(u=v.current)===null||u===void 0||u.setFieldValue("enableUsername",!1)}},"closeBtn")]},"username")}}),(0,n.jsx)(o.Z.Password,{label:b.format("adminPassword"),name:"password",placeholder:b.format("adminPasswordEmpty"),rules:[{required:!0}]},"password"),(0,n.jsx)(o.Z.Password,{label:b.format("adminNewPassword"),name:"newPassword"},"newPasword"),(0,n.jsx)(R.Z,{name:["newPassword"],children:function(f){var r=f.newPassword;return(0,n.jsx)(o.Z.Password,{label:b.format("adminNewPassword2"),name:"newPassword2",dependencies:["newPassword"],rules:[{required:typeof r!="undefined"&&r!=""},function(d){var u=d.getFieldValue;return{validator:function(c,$){return!$||u("newPassword")===$?Promise.resolve():Promise.reject(new Error(b.format("adminMessagePasswordNotMatch")))}}}]},"newPasword2")}})]},"drawer")},I=H,S=e(86615),X=function(_){var v,g,M=(0,l.useContext)(a.Z),V=M.message,U=(0,l.useRef)(),b=new m.Uo("components.systemBasic"),z=(0,l.useState)(!1),Q=B()(z,2),Z=Q[0],j=Q[1];return(0,n.jsxs)(D.a,{drawerProps:{width:G.R_,forceRender:!0},trigger:(0,n.jsx)(F.ZP,{type:(v=_.data)!==null&&v!==void 0&&v.failedEnable?"primary":"default",children:(g=_.data)!==null&&g!==void 0&&g.failedEnable?m.FD.format("listManageSetting"):m.FD.format("listManageEnable")}),onOpenChange:function(f){var r,d;j(f),!f&&((r=U.current)===null||r===void 0||r.resetFields()),f&&_.data&&((d=U.current)===null||d===void 0||d.setFieldsValue({loginFailedTotal:_.data.failedTotal===0?5:_.data.failedTotal,loginFailedLockTime:_.data.failedLockTime?_.data.failedLockTime.toString():"900"}))},open:Z,title:b.format("loginFailedTitle"),onFinish:function(){var x=E()(s()().mark(function f(r){return s()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,(0,i.bv)({login:{failedEnable:!0,failedTotal:parseInt(r.loginFailedTotal),failedLockTime:parseInt(r.loginFailedLockTime)}});case 2:j(!1),V.success(m.FD.format("finish")),_.onFinish&&_.onFinish();case 5:case"end":return u.stop()}},f)}));return function(f){return x.apply(this,arguments)}}(),formRef:U,children:[(0,n.jsx)(o.Z,{name:"loginFailedTotal",label:b.format("loginFailedTotal"),fieldProps:{addonAfter:m.FD.format("unitTimes")}}),(0,n.jsx)(S.Z.Group,{name:"loginFailedLockTime",label:b.format("loginFailedLockTime"),options:b.option("loginFailedLockTimeOption",["300","900","3600","18000","-1"])})]})},J=X;function y(P){return k.apply(this,arguments)}function k(){return k=E()(s()().mark(function P(_){return s()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,t.request)("/api/pro/two-fa/enable",{method:"POST",data:_}));case 1:case"end":return g.stop()}},P)})),k.apply(this,arguments)}function ee(){return q.apply(this,arguments)}function q(){return q=E()(s()().mark(function P(){return s()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,t.request)("/api/pro/two-fa/get-setting",{method:"POST"}));case 1:case"end":return v.stop()}},P)})),q.apply(this,arguments)}var ne=e(29104),ae=e(1699),te=function(_){var v,g,M=new m.Uo("components.systemBasic"),V=(0,t.useAccess)(),U=(0,l.useRef)(),b=(0,l.useContext)(a.Z),z=b.message,Q=(0,l.useState)(!1),Z=B()(Q,2),j=Z[0],x=Z[1];return(0,n.jsx)(D.a,{drawerProps:{width:G.R_,forceRender:!0},trigger:(0,n.jsx)(F.ZP,{type:(v=_.data)!==null&&v!==void 0&&v.enable?"primary":"default",children:(g=_.data)!==null&&g!==void 0&&g.enable?m.FD.format("listManageSetting"):m.FD.format("listManageEnable")}),onOpenChange:function(r){var d;x(r),!r&&((d=U.current)===null||d===void 0||d.resetFields())},open:j,title:M.format("twoFaTitle"),onFinish:function(){var f=E()(s()().mark(function r(d){var u,K;return s()().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(V.canSeeEnableCe){$.next=5;break}return $.next=3,y({email:d.twoFaEmail,enable:d.twoFaEnable});case 3:u=$.sent,u&&u.data.qrcode&&((K=U.current)===null||K===void 0||K.setFieldValue("towFaQrcode",u.data.qrcode));case 5:return $.next=7,(0,i.bv)({login:{failedEnable:d.loginFailedEnable,failedTotal:parseInt(d.loginFailedTotal),failedLockTime:parseInt(d.loginFailedLockTime)}});case 7:z.success(m.FD.format("finish"));case 8:case"end":return $.stop()}},r)}));return function(r){return f.apply(this,arguments)}}(),formRef:U,children:(0,n.jsx)(ae.u,{access:"canSeeEnableCe",showProRibbonTips:!0,children:function(r){var d=r.canSeeEnableCe;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(R.Z,{name:["twoFaEnable"],children:function(K){var c=K.twoFaEnable;return(0,n.jsx)(o.Z,{label:M.format("twoFaEmail"),name:"twoFaEmail",disabled:d,placeholder:M.format("twoFaEmailEmpty"),rules:[{required:c},{type:"email"}]})}}),(0,n.jsx)(A.Z,{name:"towFaQrcode",hidden:!0}),(0,n.jsx)(R.Z,{name:["towFaQrcode"],children:function(K){var c=K.towFaQrcode;if(c)return(0,n.jsx)(A.Z,{label:M.format("twoFaQrcode"),tooltip:M.format("twoFaQrcodeTip"),children:(0,n.jsx)(ne.Z,{style:{border:"#d1d9e0b3 solid 1px",padding:"10px",borderRadius:"10px"},width:200,src:"data:image/png;base64,".concat(c)})})}})]})}})})},re=te,se=e(29177),oe=e(90078),ie=e(38345),le=e(97269);function de(){var P=(0,l.useRef)(),_=new m.Uo("components.systemBasic"),v=(0,l.useState)(0),g=B()(v,2),M=g[0],V=g[1],U=(0,l.useRef)(),b=(0,l.useContext)(a.Z),z=b.loading,Q=(0,t.useAccess)();return(0,l.useEffect)(function(){z.show(),E()(s()().mark(function Z(){var j,x,f,r,d,u;return s()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,(0,i.pe)({groupName:"user",name:"founder"});case 2:return f=c.sent,(j=U.current)===null||j===void 0||j.setFieldsValue({admin:f.data}),c.next=6,(0,i.pe)({groupName:"setting",name:"login"});case 6:if(r=c.sent,(x=U.current)===null||x===void 0||x.setFieldsValue({loginFailed:r.data}),Q.canSeeEnableCe){c.next=13;break}return c.next=11,ee();case 11:u=c.sent,(d=U.current)===null||d===void 0||d.setFieldsValue({twoFa:u.data});case 13:z.destroy();case 14:case"end":return c.stop()}},Z)}))()},[M]),(0,n.jsx)(oe._z,{children:(0,n.jsx)(ie.Z,{children:(0,n.jsxs)(le.A,{layout:"horizontal",labelAlign:"left",labelCol:{xs:7,sm:6,md:5,lg:5,xl:4,xxl:3,offset:0},submitter:!1,formRef:U,children:[(0,n.jsx)(R.Z,{name:["admin"],children:function(j){var x=j.admin;return x&&(0,n.jsx)(o.Z,{label:_.format("adminTitle"),disabled:!0,width:"md",fieldProps:{prefix:(0,n.jsx)(se.Z,{}),value:x.username},addonAfter:(0,n.jsx)(I,{data:x,onFinish:function(){V(M+1)}}),name:"adminUsername"})}}),(0,n.jsx)(h,{label:_.format("loginFailedTitle"),name:"loginFailed",disable:function(j){return j?!j.failedEnable:!1},onDisable:function(){return(0,i.bv)({login:{failedEnable:!1}})},settingComponent:J,onFinish:function(){V(M+1)}}),(0,n.jsx)(h,{label:_.format("twoFaTitle"),name:"twoFa",disable:function(j){return j?!j.enable:!1},onDisable:function(){return(0,i.bv)({login:{failedEnable:!1}})},settingComponent:re,onFinish:function(){V(M+1)}})]})})})}}}]);
