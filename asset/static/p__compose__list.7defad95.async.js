"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8022],{91806:function(ee,y,e){e.d(y,{Z:function(){return g}});var B=e(87462),_=e(67294),F={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},C=F,$=e(84089),Z=function(S,W){return _.createElement($.Z,(0,B.Z)({},S,{ref:W,icon:C}))},I=_.forwardRef(Z),g=I},33862:function(ee,y,e){e.d(y,{Z:function(){return g}});var B=e(87462),_=e(67294),F={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 289.1a362.49 362.49 0 00-79.9-115.7 370.83 370.83 0 00-118.2-77.8C610.7 76.6 562.1 67 512 67c-50.1 0-98.7 9.6-144.5 28.5-44.3 18.3-84 44.5-118.2 77.8A363.6 363.6 0 00169.4 289c-19.5 45-29.4 92.8-29.4 142 0 70.6 16.9 140.9 50.1 208.7 26.7 54.5 64 107.6 111 158.1 80.3 86.2 164.5 138.9 188.4 153a43.9 43.9 0 0022.4 6.1c7.8 0 15.5-2 22.4-6.1 23.9-14.1 108.1-66.8 188.4-153 47-50.4 84.3-103.6 111-158.1C867.1 572 884 501.8 884 431.1c0-49.2-9.9-97-29.4-142zM512 880.2c-65.9-41.9-300-207.8-300-449.1 0-77.9 31.1-151.1 87.6-206.3C356.3 169.5 431.7 139 512 139s155.7 30.5 212.4 85.9C780.9 280 812 353.2 812 431.1c0 241.3-234.1 407.2-300 449.1zm0-617.2c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 551c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 439c0-29.9 11.7-58 32.8-79.2C454 338.6 482.1 327 512 327c29.9 0 58 11.6 79.2 32.8C612.4 381 624 409.1 624 439c0 29.9-11.6 58-32.8 79.2z"}}]},name:"environment",theme:"outlined"},C=F,$=e(84089),Z=function(S,W){return _.createElement($.Z,(0,B.Z)({},S,{ref:W,icon:C}))},I=_.forwardRef(Z),g=I},36435:function(ee,y,e){var B=e(15009),_=e.n(B),F=e(64599),C=e.n(F),$=e(99289),Z=e.n($),I=e(9783),g=e.n(I),Q=e(5574),S=e.n(Q),W=e(67294),de=e(184),ne=e(38345),ce=e(97269),te=e(97321),ae=e(97462),re=e(64317),se=e(5966),w=e(86615),G=e(68602),me=e(83622),j=e(83403),fe=e(24963),b=e(1699),Ee=e(29177),V=e(1883),pe=e(43425),ve=e(44349),oe=e(3616),H=e(36146),P=e(85893),f=(0,W.forwardRef)(function(T,Pe){var Oe=(0,W.useState)(!1),ie=S()(Oe,2),Y=ie[0],J=ie[1],K=(0,W.useRef)(),Me=(0,W.useContext)(fe.Z),_e=Me.message,L=(0,W.useState)([]),le=S()(L,2),X=le[0],ue=le[1],R=new H.Uo("components.permissionButton"),r=g()(g()(g()(g()(g()({},j.W6.CONTAINER,"Id"),j.W6.APPSTORE,"name"),j.W6.COMPOSE,"name"),j.W6.REGISTRY,"serverAddress"),j.W6.DOCKER_ENV,"name"),De=g()(g()(g()(g()(g()({},j.W6.CONTAINER,"name"),j.W6.APPSTORE,"name"),j.W6.COMPOSE,"name"),j.W6.REGISTRY,"title"),j.W6.DOCKER_ENV,"title"),k=r[T.type],x=De[T.type],N=T.selected.map(function(u){return u[r[T.type]]});return W.useEffect(function(){if(Y){if(!T.selected||T.selected.length==0){_e.error(H.FD.format("title.noDataSelect")),J(!1);return}(0,G.dP)({permission:{uri:T.type,key:k,value:N}}).then(function(u){var d;(d=K.current)===null||d===void 0||d.setFieldValue("list",Object.keys(u.data.list).map(function(c){return{name:c,type:u.data.list[c].type,users:u.data.list[c].users}}))}),(0,G.lE)().then(function(u){var d,c=(d=u.data)===null||d===void 0||(d=d.list)===null||d===void 0?void 0:d.map(function(m){return{label:m.username,value:m.username}});ue(c)})}},[Y]),(0,P.jsx)(b.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,P.jsxs)(de.a,{name:"create",title:R.format("drawerTitle"),open:Y,onOpenChange:function(d){if(!d){var c;(c=K.current)===null||c===void 0||c.resetFields()}J(d)},drawerProps:{forceRender:!0,width:oe.R_},formRef:K,trigger:(0,P.jsx)(me.ZP,{icon:(0,P.jsx)(Ee.Z,{}),children:R.format("drawerTriggerButton")}),onFinish:function(){var u=Z()(_()().mark(function d(c){var m,O,E;return _()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:m=C()(c.list),D.prev=1,m.s();case 3:if((O=m.n()).done){D.next=9;break}return E=O.value,D.next=7,(0,G.Db)({usernames:E.users,permissionType:E.type,permission:{uri:T.type,key:k,showKey:x,value:[E.name]}});case 7:D.next=3;break;case 9:D.next=14;break;case 11:D.prev=11,D.t0=D.catch(1),m.e(D.t0);case 14:return D.prev=14,m.f(),D.finish(14);case 17:_e.success(H.FD.format("finish")),J(!1),T.onSuccess();case 20:case"end":return D.stop()}},d,null,[[1,11,14,17]])}));return function(d){return u.apply(this,arguments)}}(),children:[(0,P.jsxs)(ne.Z,{ghost:!0,title:(0,P.jsx)(V.Z,{}),subTitle:R.format("batchTitle"),children:[(0,P.jsx)(ce.A.Item,{name:"type",style:{marginBottom:0},children:(0,P.jsx)(te.Z.Group,{defaultValue:"admin",onChange:function(d){var c,m,O=(c=K.current)===null||c===void 0?void 0:c.getFieldValue("list");O.forEach(function(E){E.type=d,E.users=[]}),(m=K.current)===null||m===void 0||m.setFieldValue("list",O)},children:["admin","restricted","public"].map(function(u){return(0,P.jsx)(te.Z,{style:{width:240},title:R.format("dataTypeOption.".concat(u)),description:R.format("dataTypeDescOption.".concat(u)),value:u},u)})})}),(0,P.jsx)(ae.Z,{name:["type"],children:function(d){var c=d.type;if(c==="restricted")return(0,P.jsx)(re.Z,{mode:"multiple",name:"usernames",label:R.format("formUsernames"),onChange:function(O){var E,U,D=(E=K.current)===null||E===void 0?void 0:E.getFieldValue("list");D.forEach(function(A){A.users=O}),(U=K.current)===null||U===void 0||U.setFieldValue("list",D)},rules:[{required:!0}],request:Z()(_()().mark(function m(){var O,E,U;return _()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!(X.length>0)){A.next=2;break}return A.abrupt("return",X);case 2:return A.next=4,(0,G.lE)();case 4:return E=A.sent,U=(O=E.data)===null||O===void 0||(O=O.list)===null||O===void 0?void 0:O.map(function(q){return{label:q.username,value:q.username}}),ue(U),A.abrupt("return",U);case 8:case"end":return A.stop()}},m)}))})}})]}),(0,P.jsx)(ne.Z,{ghost:!0,title:(0,P.jsx)(pe.Z,{}),subTitle:R.format("dataTitle"),children:(0,P.jsx)(ve.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:R.format("dataName"),render:function(d,c,m){var O=m.getCurrentRowData();return(0,P.jsx)(se.Z,{disabled:!0,label:R.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:R.format("dataType"),render:function(d,c,m){var O=m.getCurrentRowData();return(0,P.jsx)(w.Z.Group,{label:R.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(E){return{label:R.format("dataTypeOption.".concat(E)),value:E}})})}},{name:"users",label:R.format("dataUsers"),render:function(d,c,m){return(0,P.jsx)(ae.Z,{name:["type"],children:function(E){var U=E.type;if(U=="restricted")return(0,P.jsx)(re.Z,{width:"sm",mode:"tags",name:"users",label:R.format("dataUsers"),options:X})}})}}]})})]})})});y.Z=f},96781:function(ee,y,e){var B=e(67294),_=(0,B.createContext)({});y.Z=_},92922:function(ee,y,e){e.r(y),e.d(y,{default:function(){return De}});var B=e(15009),_=e.n(B),F=e(99289),C=e.n(F),$=e(5574),Z=e.n($),I=e(90098),g=e(33160),Q=e(87784),S=e(30159),W=e(74842),de=e(99611),ne=e(1883),ce=e(95591),te=e(23430),ae=e(43425),re=e(74453),se=e(82346),w=e(83062),G=e(25593),me=e(66309),j=e(42075),fe=e(96074),b=e(67294),Ee=e(94359),V=e(67255),pe=e(96781),ve=e(91218),oe=e(1699),H=e(83403),P=e(36435),f=e(36146),T=e(55375),Pe=e(96486),Oe=e.n(Pe),ie=e(37413),Y=e(87662),J=e(5251),K=e(93162),Me=e.n(K),_e=e(82848),L=e(98510),le=e(80821),X=e(83002),ue=e(29463),R=e(2831),r=e(85893);function De(){var k=(0,b.useContext)(pe.Z),x=k.listTableRef,N=k.reload,u=(0,b.useRef)(),d=(0,se.useAccess)(),c=(0,se.useLocation)(),m=new f.Uo("compose"),O=(0,b.useState)(""),E=Z()(O,2),U=E[0],D=E[1],A=(0,b.useRef)(),q=(0,b.useRef)();return(0,b.useEffect)(function(){(0,Y.K3)().then(function(p){var o;D((o=p.data.serverUrl)!==null&&o!==void 0?o:"")})},[]),(0,b.useEffect)(function(){var p;c.state&&!((p=x.current)===null||p===void 0)&&p.setPageInfo&&x.current.setPageInfo({current:(0,V.G$)(T.q9,x.current.pageInfo)})},[c.state,x.current]),(0,r.jsxs)(re._z,{header:{extra:[(0,r.jsx)(oe.u,{access:"canSeeComposeListManageCreate",children:(0,r.jsx)(_e.Z,{onFinish:function(o){var n,l;!((n=u.current)===null||n===void 0)&&n.show&&((l=u.current)===null||l===void 0||l.show(o)),N()}})},"create")]},children:[(0,r.jsx)(X.Z,{ref:A},"composeLog"),(0,r.jsx)(ve.Z,{ref:u,onClose:function(){N()}}),(0,r.jsx)(ue.Z,{ref:q}),(0,r.jsx)(L.C,{tableKey:T.q9,contextMenu:function(o){var n=o.selectedRows,l=o.finish,h=o.loading;return{items:[{type:"group",label:f.FD.format("listManageManage"),key:"manage",children:[{access:"canSeeComposeList",label:(0,r.jsx)(L.C.ContextMenuItem,{buttonProps:{icon:(0,r.jsx)(g.Z,{})},action:C()(_()().mark(function i(){return _()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h(),t.abrupt("return",Promise.all(n.map(function(s){return(0,I.GG)({id:s.id||s.name,op:"restart"})})).finally(function(){l(!0)}));case 2:case"end":return t.stop()}},i)})),children:f.FD.format("listManageRestart")}),key:"restart"},{label:(0,r.jsx)(L.C.ContextMenuItem,{action:C()(_()().mark(function i(){return _()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h(),t.abrupt("return",Promise.all(n.map(function(s){return(0,I.GG)({id:s.id||s.name,op:"stop"})})).finally(function(){l(!0)}));case 2:case"end":return t.stop()}},i)})),buttonProps:{icon:(0,r.jsx)(Q.Z,{})},children:f.FD.format("listManageStop")}),key:"stop"},{label:(0,r.jsx)(L.C.ContextMenuItem,{action:C()(_()().mark(function i(){return _()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h(),t.abrupt("return",Promise.all(n.map(function(s){return(0,I.GG)({id:s.id||s.name,op:"pause"})})).finally(function(){l(!0)}));case 2:case"end":return t.stop()}},i)})),buttonProps:{icon:(0,r.jsx)(S.Z,{})},children:f.FD.format("listManagePause")}),key:"pause"},{label:(0,r.jsx)(L.C.ContextMenuItem,{action:C()(_()().mark(function i(){return _()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h(),t.abrupt("return",Promise.all(n.map(function(s){return(0,I.GG)({id:s.id||s.name,op:"unpause"})})).finally(function(){l(!0)}));case 2:case"end":return t.stop()}},i)})),buttonProps:{icon:(0,r.jsx)(W.Z,{})},children:f.FD.format("listManageUnpause")}),key:"unpause"}]},{type:"group",label:f.FD.format("listManage"),key:"operator",children:[{label:(0,r.jsx)(L.C.ContextMenuItem,{buttonProps:{icon:(0,r.jsx)(de.Z,{}),disabled:n.length>1},action:C()(_()().mark(function i(){var a,t;return _()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:l(!0),n!=null&&n[0]&&((a=u.current)===null||a===void 0||a.show((t=n[0].id)!==null&&t!==void 0?t:n[0].name));case 2:case"end":return M.stop()}},i)})),children:f.FD.format("listManageView")}),key:"view"},{label:(0,r.jsx)(L.C.ContextMenuItem,{buttonProps:{icon:(0,r.jsx)(ne.Z,{}),disabled:n.length>1},action:C()(_()().mark(function i(){var a,t;return _()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(t=n==null?void 0:n[0],t){M.next=3;break}return M.abrupt("return");case 3:(a=A.current)===null||a===void 0||a.show(t),l(!0);case 5:case"end":return M.stop()}},i)})),children:f.FD.format("listManageLog")}),key:"log"},{label:(0,r.jsx)(L.C.ContextMenuItem,{buttonProps:{icon:(0,r.jsx)(ce.Z,{}),disabled:n.length>1},action:C()(_()().mark(function i(){var a,t,s,M,v;return _()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(t=n==null?void 0:n[0],t){z.next=3;break}return z.abrupt("return");case 3:return z.next=5,(0,R.aF)();case 5:s=z.sent,s.data&&(a=s.data.dpanel.containerInfo)!==null&&a!==void 0&&a.Name&&((M=q.current)===null||M===void 0||M.showContainer((v=s.data.dpanel.containerInfo)===null||v===void 0?void 0:v.Name,"/dpanel/compose/".concat(t.name))),l(!0);case 8:case"end":return z.stop()}},i)})),children:f.FD.format("listManageFilePath")}),key:"file"},{key:"download",label:(0,r.jsx)(L.C.ContextMenuItem,{buttonProps:{icon:(0,r.jsx)(te.Z,{}),disabled:n.length>1},action:C()(_()().mark(function i(){var a,t,s;return _()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(h(),a=n==null?void 0:n[0],a){v.next=4;break}return v.abrupt("return");case 4:return v.next=6,(0,I.tw)({id:a.id||a.name}).finally(function(){l(!0)});case 6:t=v.sent,s=new Blob([t],{type:"application/zip"}),(0,K.saveAs)(s,"compose-"+a.name+".zip");case 9:case"end":return v.stop()}},i)})),children:f.FD.format("listManageDownload")})}]}]}},request:function(){var p=C()(_()().mark(function o(n){var l;return _()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,I.pm)({title:n.title,name:n.name});case 2:return l=i.sent,i.abrupt("return",{data:l.data.list.map(function(a){var t=l.data.containerList.filter(function(s){return s.project==a.name});return t&&(a.containerList=t),a}),success:!0,total:l.data.list.length});case 4:case"end":return i.stop()}},o)}));return function(o){return p.apply(this,arguments)}}(),rowKey:function(o){return o.id>0?o.id:o.name},columns:[{key:"name",title:f.FD.format("listTitle"),dataIndex:"name",width:300,render:function(o,n,l,h,i){return(0,r.jsx)(w.Z,{title:"".concat(n.title),placement:"right",children:(0,r.jsx)(G.Z.Link,{onClick:function(){var t;(t=u.current)===null||t===void 0||t.show(n.id||n.name)},children:n.name})})},sorter:function(o,n){return o.name.localeCompare(n.name)},defaultSortOrder:(0,V.rj)(T.q9,"name"),sortDirections:V.h5},{key:"ports",title:f.FD.format("listAccess"),tooltip:f.FD.format("listAccessTip"),width:150,dataIndex:"ports",search:!1,render:function(o,n,l,h){if((0,Pe.isEmpty)(n.containerList))return null;var i=[],a=[];return n.containerList&&n.containerList.forEach(function(t){t.publishers.forEach(function(s){s.publishedPort?i.push({PrivatePort:s.targetPort,Type:s.protocol,IP:s.url,PublicPort:s.publishedPort}):s.publishedPort&&a.push({PrivatePort:s.targetPort,Type:s.protocol,IP:s.url,PublicPort:s.publishedPort})})}),(0,r.jsx)(ie.Z,{publicPort:i,privatePort:a,domain:[],serverIp:U})}},{title:f.FD.format("listType"),width:150,search:!1,render:function(o,n,l,h,i){var a,t=n.setting&&n.setting.type?n.setting.type:"default";return(0,r.jsx)(w.Z,{placement:"right",title:((a=n.setting.uri)!==null&&a!==void 0?a:[]).join(", "),children:(0,r.jsx)(me.Z,{color:m.format("listTypeColorOption.".concat(t)),children:m.format("listTypeOption.".concat(t))})})}},{title:f.FD.format("listStatus"),dataIndex:"status",search:!1,key:"status",render:function(o,n,l,h,i){return(0,r.jsx)(j.Z,{children:n.setting.status.split(", ").map(function(a,t){var s,M="running",v=a.indexOf("(");return v>-1?M=a.slice(0,v):M=a,(0,r.jsx)(Ee.Z,{status:"compose.".concat(M),statusValue:{count:a.slice(v+1,a.length-1)},tip:"".concat(a," ").concat((s=n.setting.message)!==null&&s!==void 0?s:"")},t)})})},sorter:function(o,n){return o.setting.status.localeCompare(n.setting.status)},defaultSortOrder:(0,V.rj)(T.q9,"status")},{title:f.FD.format("listUpdatedAt"),dataIndex:"",search:!1,width:180,render:function(o,n,l,h,i){return(0,J.NF)(n.setting.updatedAt)},sorter:function(o,n){var l,h;return new Date((l=o.setting.updatedAt)!==null&&l!==void 0?l:"").toLocaleString().localeCompare(new Date((h=n.setting.updatedAt)!==null&&h!==void 0?h:"").toLocaleString())},key:"updated",defaultSortOrder:(0,V.rj)(T.q9,"updated")},{title:f.FD.format("listManage"),width:60,valueType:"option",fixed:"right",key:"option",hidden:!d.canSeeComposeListManage,render:function(o,n,l,h,i){return n.setting.type!="dangling"&&(0,r.jsx)(j.Z,{split:(0,r.jsx)(fe.Z,{type:"vertical"}),children:(0,r.jsx)(G.Z.Link,{onClick:function(){var t;(t=u.current)===null||t===void 0||t.show(n.id||n.name)},children:(0,r.jsx)(w.Z,{title:f.FD.format("listManageDetail"),children:(0,r.jsx)(ae.Z,{})})},"3")})}}],rowSelection:d.canSeeComposeListManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0,getCheckboxProps:function(o){return{disabled:o.setting.type=="dangling"||o.setting.type=="outPath"}}}:void 0,actionRef:x,quickToolbarRender:function(o){var n=o.selectedRows,l=o.finish,h=o.loading;return(0,r.jsxs)(j.Z,{size:16,children:[(0,r.jsx)(P.Z,{type:H.W6.COMPOSE,selected:n,onSuccess:function(){return N(),!0}}),(0,r.jsx)(oe.u,{access:"canSeeComposeListManageDelete",children:(0,r.jsx)(le.Z,{buttonProps:{danger:!0,type:"primary"},confirmProps:{showCommonConfirm:!0},action:function(){return h(),Promise.all(n.map(function(){var a=C()(_()().mark(function t(s){return _()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,(0,I.j6)({id:s.id||s.name,deleteData:!0,deletePath:!0});case 2:return v.abrupt("return",v.sent);case 3:case"end":return v.stop()}},t)}));return function(t){return a.apply(this,arguments)}}())).finally(function(){l(!0)})},onSuccess:function(){var a;return!((a=x.current)===null||a===void 0)&&a.reloadAndRest&&x.current.reloadAndRest(),!0},onError:function(){return N(),!0},children:f.FD.format("listManageDeleteBatch")})})]})}},"table")]})}}}]);
