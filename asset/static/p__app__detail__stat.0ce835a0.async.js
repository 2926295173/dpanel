"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745,5947],{60433:function(K,j,e){var F=e(87462),n=e(67294),k=e(69782),m=e(84089),_=function(O,f){return n.createElement(m.Z,(0,F.Z)({},O,{ref:f,icon:k.Z}))},P=n.forwardRef(_);j.Z=P},27619:function(K,j,e){e.d(j,{Z:function(){return S}});var F=e(97857),n=e.n(F),k=e(19632),m=e.n(k),_=e(5574),P=e.n(_),C=e(64183),O=e(82346),f=e(67294),h=e(85893);function S(l){var E,A=(0,f.useState)("academy"),L=P()(A,2),p=L[0],d=L[1],I=Math.max.apply(Math,m()(l.data.map(function(v){var a;return(a=v[l.yField])!==null&&a!==void 0?a:0}))),c=(0,O.useModel)("@@initialState"),b=c.initialState,i=c.loading,M=c.error,R=c.refresh,t=c.setInitialState,s={xField:l.xField,yField:l.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:l.yLabelFormatter},scale:{y:{domainMin:(E=l.yDomainMin)!==null&&E!==void 0?E:0,domainMax:l.yDomainMax?l.yDomainMax:l.yDomainMaxCallback?l.yDomainMaxCallback(I):I}},data:l.data};return l.yLabelFormatter&&(s.axis.y.labelFormatter=l.yLabelFormatter),l.colorField&&(s.colorField=l.colorField),(0,f.useEffect)(function(){(b==null?void 0:b.theme.algorithm)=="dark"?d("classicDark"):d("academy")},[b]),(0,h.jsx)(C.Z,n()({theme:p},s))}},71890:function(K,j,e){var F=e(15009),n=e.n(F),k=e(99289),m=e.n(k),_=e(67294);function P(C){var O=C.reqFunction,f=C.interval,h=C.maxPolling,S=C.pollingStatus,l=C.inPath,E=(0,_.useRef)(null),A=0,L=function d(){E.current=window.setTimeout(m()(n()().mark(function I(){var c;return n()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(A++>=h)){i.next=3;break}return p(),i.abrupt("return");case 3:if(i.prev=3,!(l&&window.location.href.indexOf(l)==-1)){i.next=7;break}return p(),i.abrupt("return");case 7:return i.next=9,O();case 9:c=i.sent,d(),i.next=17;break;case 13:i.prev=13,i.t0=i.catch(3),p(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",i.t0);case 17:case"end":return i.stop()}},I,null,[[3,13]])})),f)},p=function(){console.log("end polling"),E.current&&window.clearTimeout(E.current)};return(0,_.useEffect)(function(){return console.log((S?"start":"waiting")+" polling, max "+h),S&&L(),function(){p()}},[f,h,S]),{endPolling:p}}j.Z=P},24963:function(K,j,e){var F=e(67294),n=(0,F.createContext)({});j.Z=n},34548:function(K,j,e){e.r(j),e.d(j,{AppDetailContext:function(){return b},default:function(){return i}});var F=e(15009),n=e.n(F),k=e(99289),m=e.n(k),_=e(5574),P=e.n(_),C=e(24963),O=e(60335),f=e(87462),h=e(67294),S=e(44805),l=e(84089),E=function(R,t){return h.createElement(l.Z,(0,f.Z)({},R,{ref:t,icon:S.Z}))},A=h.forwardRef(E),L=A,p=e(82346),d=e(25593),I=e(50136),c=e(85893),b=(0,h.createContext)({});function i(){var M,R=(0,h.useContext)(C.Z),t=R.lang,s=R.loading,v=R.message,a=(0,p.useParams)(),U=(0,p.useSearchParams)(),B=P()(U,2),w=B[0],x=B[1],X=(M=w.get("tab"))!==null&&M!==void 0?M:"edit",z=(0,h.useState)("edit"),u=P()(z,2),q=u[0],V=u[1],$=(0,p.useNavigate)(),ee=(0,h.useState)(1),J=P()(ee,2),Y=J[0],H=J[1],W=[{label:(0,c.jsx)(p.Link,{to:"/app/detail/edit/".concat(a.id,"?tab=edit"),children:"\u5BB9\u5668\u8BE6\u60C5"}),key:"edit"},{label:(0,c.jsx)(p.Link,{to:"/app/detail/network/".concat(a.id,"?tab=network"),children:"\u7F51\u7EDC\u7BA1\u7406"}),key:"network"},{label:(0,c.jsx)(d.Z.Link,{children:"\u6587\u4EF6\u7BA1\u7406"}),key:"file",onClick:function(){v.info(t("app.detail.createExplorerPlugin")),$("/app/detail/file/".concat(a.id,"?tab=file"))}},{label:(0,c.jsx)(d.Z.Link,{children:"\u8FD0\u884C\u65E5\u5FD7"}),key:"log",onClick:function(){$("/app/detail/log/".concat(a.id,"?tab=log"))}},{label:(0,c.jsx)(d.Z.Link,{children:"\u8FD0\u884C\u72B6\u6001"}),key:"stat",onClick:function(){$("/app/detail/stat/".concat(a.id,"?tab=stat"))}},{label:"",key:"containerName",icon:(0,c.jsx)(L,{}),disabled:!0}],ae=(0,h.useState)(W),te=P()(ae,2),re=te[0],D=te[1];(0,h.useEffect)(function(){s.show(),V(X);var r=function(){var g=m()(n()().mark(function y(){var Z,T,Q;return n()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return T=W,N.next=3,(0,O.jV)({md5:(Z=a.id)!==null&&Z!==void 0?Z:""});case 3:Q=N.sent,T.map(function(G){return G.key=="containerName"&&(G.label=Q.data.info.Name),(!Q.data.info.State.Running||Q.data.info.State.Restarting)&&(G.key=="file"||G.key=="stat")&&(G.disabled=!0),G}),D(T),s.destroy();case 7:case"end":return N.stop()}},y)}));return function(){return g.apply(this,arguments)}}();r()},[Y]);var o=function(g){V(g.key)};return(0,c.jsxs)(b.Provider,{value:{reload:function(){H(Y+1)}},children:[(0,c.jsx)(I.Z,{mode:"horizontal",onClick:o,selectedKeys:[q],items:re}),(0,c.jsx)(p.Outlet,{})]})}},42223:function(K,j,e){e.r(j),e.d(j,{default:function(){return a}});var F=e(15009),n=e.n(F),k=e(99289),m=e.n(k),_=e(5574),P=e.n(_),C=e(19632),O=e.n(C),f=e(27619),h=e(71890),S=e(24963),l=e(82346);function E(U){return A.apply(this,arguments)}function A(){return A=m()(n()().mark(function U(B){return n()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.abrupt("return",(0,l.request)("/api/app/container/get-stat-info",{method:"POST",data:B}));case 1:case"end":return x.stop()}},U)})),A.apply(this,arguments)}function L(U){return p.apply(this,arguments)}function p(){return p=m()(n()().mark(function U(B){return n()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.abrupt("return",(0,l.request)("/api/app/container/get-process-info",{method:"POST",data:B}));case 1:case"end":return x.stop()}},U)})),p.apply(this,arguments)}var d=e(5251),I=e(12122),c=e(60433),b=e(38345),i=e(63490),M=e(67294),R=e(34548),t=e(85893),s=new Date().toLocaleTimeString(),v={total:0,memory:[{date:s,usage:0,source:{usage:0,limit:0}}],cpu:[{date:s,usage:0}],network:[{usage:0,type:"rx",date:s,source:{usage:0}},{usage:0,type:"tx",date:s,source:{usage:0}}],io:[{usage:0,type:"read",date:s,source:{usage:0}},{usage:0,type:"write",date:s,source:{usage:0}}]};function a(){var U=function(o,r){switch(r.type){case"update":var g=new Date(r.payload.read).toLocaleTimeString(),y=r.payload.cpu_stats.cpu_usage.total_usage-r.payload.precpu_stats.cpu_usage.total_usage,Z=r.payload.cpu_stats.system_cpu_usage-r.payload.precpu_stats.system_cpu_usage,T={total:o.total+1,memory:[],cpu:[].concat(O()(o.cpu),[{date:g,usage:y/Z*r.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return r.payload.memory_stats&&r.payload.memory_stats.limit&&r.payload.memory_stats.usage&&(T.memory=[].concat(O()(o.memory),[{date:g,usage:Math.round(r.payload.memory_stats.usage),source:{usage:r.payload.memory_stats.usage,limit:r.payload.memory_stats.limit}}])),r.payload.networks&&(T.network=[].concat(O()(o.network),[{date:g,usage:parseFloat(r.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:r.payload.networks.eth0.rx_bytes}},{date:g,usage:parseFloat(r.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:r.payload.networks.eth0.tx_bytes}}])),r.payload.blkio_stats&&r.payload.blkio_stats.io_service_bytes_recursive&&r.payload.blkio_stats.io_service_bytes_recursive.length>0&&(T.io=[].concat(O()(o.io),[{date:g,usage:parseFloat(r.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:r.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:r.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:g,usage:parseFloat(r.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:r.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:r.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),T}},B=(0,M.useContext)(S.Z),w=B.loading,x=(0,l.useParams)(),X=(0,M.useReducer)(U,v),z=P()(X,2),u=z[0],q=z[1],V=(0,M.useState)(0),$=P()(V,2),ee=$[0],J=$[1],Y=(0,M.useState)(),H=P()(Y,2),W=H[0],ae=H[1],te=(0,h.Z)({reqFunction:function(){var D=m()(n()().mark(function r(){var g,y;return n()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,E({id:(g=x.id)!==null&&g!==void 0?g:""});case 2:y=T.sent,w.destroy(),q({type:"update",payload:y});case 5:case"end":return T.stop()}},r)}));function o(){return D.apply(this,arguments)}return o}(),interval:3e3,maxPolling:999,pollingStatus:ee!=0,inPath:"tab=stat"}),re=(0,M.useContext)(R.AppDetailContext);return(0,M.useEffect)(function(){re.reload()},[]),(0,M.useEffect)(function(){var D,o;w.show(),E({id:(D=x.id)!==null&&D!==void 0?D:""}).then(function(r){return J(Math.round(r.memory_stats.limit)),!0}),L({id:(o=x.id)!==null&&o!==void 0?o:""}).then(function(r){var g={columns:[],data:[]};r.data.list.Titles.map(function(y){g.columns.push({title:y,label:y,dataIndex:y})}),r.data.list.Processes.map(function(y,Z){g.data.push({UID:y[0],PID:y[1],PPID:y[2],C:y[3],STIME:y[4],TTY:y[5],TIME:y[6],CMD:y[7]})}),ae(g)})},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(b.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[u.memory&&u.memory.length>0&&(0,t.jsx)(b.Z,{colSpan:12,title:(0,t.jsx)(I.Z,{}),subTitle:"Memory usage: ".concat((0,d.FI)(u.memory[u.memory.length-1].source.usage)," / ").concat((0,d.FI)(u.memory[u.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(f.Z,{yField:"usage",xField:"date",data:u.memory,yDomainMaxCallback:function(o){return o*2},yLabelFormatter:function(o){return(0,d.FI)(parseFloat(o))}})}),(0,t.jsx)(b.Z,{colSpan:12,title:(0,t.jsx)(I.Z,{}),subTitle:"Cpu usage: ".concat(u.cpu[u.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,t.jsx)(f.Z,{yField:"usage",xField:"date",data:u.cpu,yDomainMaxCallback:function(o){return o*1.5},yLabelFormatter:function(o){return"".concat(o,"%")}})}),u.io&&u.io.length>0&&(0,t.jsx)(b.Z,{colSpan:12,title:(0,t.jsx)(I.Z,{}),subTitle:"I/O: ".concat((0,d.FI)(u.io[u.io.length-1].source.usage)," / ").concat((0,d.FI)(u.io[u.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(f.Z,{yField:"usage",xField:"date",colorField:"type",data:u.io,yDomainMaxCallback:function(o){return o*2},yLabelFormatter:function(o){return(0,d.FI)(parseFloat(o))}})}),u.network&&u.network.length>0&&(0,t.jsx)(b.Z,{colSpan:12,title:(0,t.jsx)(I.Z,{}),subTitle:"Network: ".concat((0,d.FI)(u.network[u.network.length-1].source.usage)," / ").concat((0,d.FI)(u.network[u.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(f.Z,{yField:"usage",xField:"date",colorField:"type",data:u.network,yDomainMaxCallback:function(o){return o*2},yLabelFormatter:function(o){return(0,d.FI)(parseFloat(o))}})})]}),(0,t.jsx)(b.Z,{title:(0,t.jsx)(c.Z,{}),subTitle:"Progress",children:(0,t.jsx)(i.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:W==null?void 0:W.columns,dataSource:W==null?void 0:W.data,pagination:{pageSize:10}})})]})}},60335:function(K,j,e){e.d(j,{IE:function(){return O},IW:function(){return P},KK:function(){return A},LJ:function(){return p},RF:function(){return b},Re:function(){return I},aF:function(){return M},eE:function(){return l},jV:function(){return h}});var F=e(15009),n=e.n(F),k=e(99289),m=e.n(k),_=e(82346);function P(t){return C.apply(this,arguments)}function C(){return C=m()(n()().mark(function t(s){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,_.request)("/api/app/container/status",{method:"POST",data:s}));case 1:case"end":return a.stop()}},t)})),C.apply(this,arguments)}function O(t){return f.apply(this,arguments)}function f(){return f=m()(n()().mark(function t(s){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,_.request)("/api/app/container/get-list",{data:s,method:"POST"}));case 1:case"end":return a.stop()}},t)})),f.apply(this,arguments)}function h(t){return S.apply(this,arguments)}function S(){return S=m()(n()().mark(function t(s){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,_.request)("/api/app/container/get-detail",{data:s,method:"POST"}));case 1:case"end":return a.stop()}},t)})),S.apply(this,arguments)}function l(t){return E.apply(this,arguments)}function E(){return E=m()(n()().mark(function t(s){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,_.request)("/api/app/container/update",{data:s,method:"POST"}));case 1:case"end":return a.stop()}},t)})),E.apply(this,arguments)}function A(){return L.apply(this,arguments)}function L(){return L=m()(n()().mark(function t(){return n()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,_.request)("/api/app/container/prune",{method:"POST"}));case 1:case"end":return v.stop()}},t)})),L.apply(this,arguments)}function p(t){return d.apply(this,arguments)}function d(){return d=m()(n()().mark(function t(s){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,_.request)("/api/app/container/export",{method:"POST",data:s,responseType:"blob"}));case 1:case"end":return a.stop()}},t)})),d.apply(this,arguments)}function I(t){return c.apply(this,arguments)}function c(){return c=m()(n()().mark(function t(s){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,_.request)("/api/app/container/commit",{method:"POST",data:s}));case 1:case"end":return a.stop()}},t)})),c.apply(this,arguments)}function b(t){return i.apply(this,arguments)}function i(){return i=m()(n()().mark(function t(s){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,_.request)("/api/app/container/upgrade",{method:"POST",data:s}));case 1:case"end":return a.stop()}},t)})),i.apply(this,arguments)}function M(t){return R.apply(this,arguments)}function R(){return R=m()(n()().mark(function t(s){return n()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,_.request)("/api/app/container/copy",{method:"POST",data:s}));case 1:case"end":return a.stop()}},t)})),R.apply(this,arguments)}}}]);
