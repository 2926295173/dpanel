"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745],{60433:function(R,f,e){var M=e(87462),i=e(67294),x=e(69782),n=e(84089),t=function(m,v){return i.createElement(n.Z,(0,M.Z)({},m,{ref:v,icon:x.Z}))},c=i.forwardRef(t);f.Z=c},27619:function(R,f,e){e.d(f,{Z:function(){return T}});var M=e(97857),i=e.n(M),x=e(19632),n=e.n(x),t=e(5574),c=e.n(t),d=e(64183),m=e(63713),v=e(9361),D=e(67294),F=e(85893);function T(o){var C,S=(0,D.useState)("academy"),b=c()(S,2),y=b[0],j=b[1],L=Math.max.apply(Math,n()(o.data.map(function(O){var l;return(l=O[o.yField])!==null&&l!==void 0?l:0}))),E=(0,m.useAntdConfig)(),u={xField:o.xField,yField:o.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:o.yLabelFormatter},scale:{y:{domainMin:(C=o.yDomainMin)!==null&&C!==void 0?C:0,domainMax:o.yDomainMax?o.yDomainMax:o.yDomainMaxCallback?o.yDomainMaxCallback(L):L}},data:o.data};return o.yLabelFormatter&&(u.axis.y.labelFormatter=o.yLabelFormatter),o.colorField&&(u.colorField=o.colorField),(0,D.useEffect)(function(){var O=E.theme.algorithm;O.includes(v.Z.darkAlgorithm)?j("classicDark"):j("academy")},[E]),(0,F.jsx)(d.Z,i()({theme:y},u))}},71890:function(R,f,e){var M=e(15009),i=e.n(M),x=e(99289),n=e.n(x),t=e(67294);function c(d){var m=d.reqFunction,v=d.interval,D=d.maxPolling,F=d.pollingStatus,T=d.inPath,o=(0,t.useRef)(null),C=0,S=function y(){o.current=window.setTimeout(n()(i()().mark(function j(){var L;return i()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(C++>=D)){u.next=3;break}return b(),u.abrupt("return");case 3:if(u.prev=3,!(T&&window.location.href.indexOf(T)==-1)){u.next=7;break}return b(),u.abrupt("return");case 7:return u.next=9,m();case 9:L=u.sent,y(),u.next=17;break;case 13:u.prev=13,u.t0=u.catch(3),b(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",u.t0);case 17:case"end":return u.stop()}},j,null,[[3,13]])})),v)},b=function(){console.log("end polling"),o.current&&window.clearTimeout(o.current)};return(0,t.useEffect)(function(){return console.log((F?"start":"waiting")+" polling, max "+D),F&&S(),function(){b()}},[v,D,F]),{endPolling:b}}f.Z=c},24963:function(R,f,e){var M=e(67294),i=(0,M.createContext)({});f.Z=i},42223:function(R,f,e){e.r(f),e.d(f,{default:function(){return G}});var M=e(15009),i=e.n(M),x=e(99289),n=e.n(x),t=e(5574),c=e.n(t),d=e(19632),m=e.n(d),v=e(27619),D=e(71890),F=e(24963),T=e(63713);function o(I){return C.apply(this,arguments)}function C(){return C=n()(i()().mark(function I(W){return i()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,T.request)("/api/app/container/get-stat-info",{method:"POST",data:W}));case 1:case"end":return h.stop()}},I)})),C.apply(this,arguments)}function S(I){return b.apply(this,arguments)}function b(){return b=n()(i()().mark(function I(W){return i()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",(0,T.request)("/api/app/container/get-process-info",{method:"POST",data:W}));case 1:case"end":return h.stop()}},I)})),b.apply(this,arguments)}var y=e(5251),j=e(12122),L=e(60433),E=e(38345),u=e(63490),O=e(67294),l=e(85893),A=new Date().toLocaleTimeString(),$={total:0,memory:[{date:A,usage:0,source:{usage:0,limit:0}}],cpu:[{date:A,usage:0}],network:[{usage:0,type:"rx",date:A,source:{usage:0}},{usage:0,type:"tx",date:A,source:{usage:0}}],io:[{usage:0,type:"read",date:A,source:{usage:0}},{usage:0,type:"write",date:A,source:{usage:0}}]};function G(){var I=function(r,a){switch(a.type){case"update":var p=new Date(a.payload.read).toLocaleTimeString(),_=a.payload.cpu_stats.cpu_usage.total_usage-a.payload.precpu_stats.cpu_usage.total_usage,Z=a.payload.cpu_stats.system_cpu_usage-a.payload.precpu_stats.system_cpu_usage,P={total:r.total+1,memory:[],cpu:[].concat(m()(r.cpu),[{date:p,usage:_/Z*a.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return a.payload.memory_stats&&a.payload.memory_stats.limit&&a.payload.memory_stats.usage&&(P.memory=[].concat(m()(r.memory),[{date:p,usage:Math.round(a.payload.memory_stats.usage),source:{usage:a.payload.memory_stats.usage,limit:a.payload.memory_stats.limit}}])),a.payload.networks&&(P.network=[].concat(m()(r.network),[{date:p,usage:parseFloat(a.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:a.payload.networks.eth0.rx_bytes}},{date:p,usage:parseFloat(a.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:a.payload.networks.eth0.tx_bytes}}])),a.payload.blkio_stats&&a.payload.blkio_stats.io_service_bytes_recursive&&a.payload.blkio_stats.io_service_bytes_recursive.length>0&&(P.io=[].concat(m()(r.io),[{date:p,usage:parseFloat(a.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:a.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:a.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:p,usage:parseFloat(a.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:a.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:a.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),P}},W=(0,O.useContext)(F.Z),B=W.loading,h=(0,T.useParams)(),z=(0,O.useReducer)(I,$),k=c()(z,2),s=k[0],H=k[1],Y=(0,O.useState)(0),K=c()(Y,2),N=K[0],J=K[1],Q=(0,O.useState)(),w=c()(Q,2),U=w[0],V=w[1],X=(0,D.Z)({reqFunction:function(){var g=n()(i()().mark(function a(){var p,_;return i()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,o({id:(p=h.id)!==null&&p!==void 0?p:""});case 2:_=P.sent,B.destroy(),H({type:"update",payload:_});case 5:case"end":return P.stop()}},a)}));function r(){return g.apply(this,arguments)}return r}(),interval:3e3,maxPolling:999,pollingStatus:N!=0,inPath:"tab=stat"});return(0,O.useEffect)(function(){var g,r;B.show(),o({id:(g=h.id)!==null&&g!==void 0?g:""}).then(function(a){return J(Math.round(a.memory_stats.limit)),!0}),S({id:(r=h.id)!==null&&r!==void 0?r:""}).then(function(a){var p={columns:[],data:[]};a.data.list.Titles.map(function(_){p.columns.push({title:_,label:_,dataIndex:_})}),a.data.list.Processes.map(function(_,Z){p.data.push({UID:_[0],PID:_[1],PPID:_[2],C:_[3],STIME:_[4],TTY:_[5],TIME:_[6],CMD:_[7]})}),V(p)})},[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(E.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[s.memory&&s.memory.length>0&&(0,l.jsx)(E.Z,{colSpan:12,title:(0,l.jsx)(j.Z,{}),subTitle:"Memory usage: ".concat((0,y.FI)(s.memory[s.memory.length-1].source.usage)," / ").concat((0,y.FI)(s.memory[s.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,l.jsx)(v.Z,{yField:"usage",xField:"date",data:s.memory,yDomainMaxCallback:function(r){return r*2},yLabelFormatter:function(r){return(0,y.FI)(parseFloat(r))}})}),(0,l.jsx)(E.Z,{colSpan:12,title:(0,l.jsx)(j.Z,{}),subTitle:"Cpu usage: ".concat(s.cpu[s.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,l.jsx)(v.Z,{yField:"usage",xField:"date",data:s.cpu,yDomainMaxCallback:function(r){return r*1.5},yLabelFormatter:function(r){return"".concat(r,"%")}})}),s.io&&s.io.length>0&&(0,l.jsx)(E.Z,{colSpan:12,title:(0,l.jsx)(j.Z,{}),subTitle:"I/O: ".concat((0,y.FI)(s.io[s.io.length-1].source.usage)," / ").concat((0,y.FI)(s.io[s.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,l.jsx)(v.Z,{yField:"usage",xField:"date",colorField:"type",data:s.io,yDomainMaxCallback:function(r){return r*2},yLabelFormatter:function(r){return(0,y.FI)(parseFloat(r))}})}),s.network&&s.network.length>0&&(0,l.jsx)(E.Z,{colSpan:12,title:(0,l.jsx)(j.Z,{}),subTitle:"Network: ".concat((0,y.FI)(s.network[s.network.length-1].source.usage)," / ").concat((0,y.FI)(s.network[s.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,l.jsx)(v.Z,{yField:"usage",xField:"date",colorField:"type",data:s.network,yDomainMaxCallback:function(r){return r*2},yLabelFormatter:function(r){return(0,y.FI)(parseFloat(r))}})})]}),(0,l.jsx)(E.Z,{title:(0,l.jsx)(L.Z,{}),subTitle:"Progress",children:(0,l.jsx)(u.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:U==null?void 0:U.columns,dataSource:U==null?void 0:U.data,pagination:{pageSize:10}})})]})}},5251:function(R,f,e){e.d(f,{FI:function(){return i},ZM:function(){return x}});function M(n){return n.trim()}function i(n){var t="";n<.1*1024?t=n.toFixed(2)+"B":n<.1*1024*1024?t=(n/1024).toFixed(2)+"KB":n<1*1024*1024*1024?t=(n/(1024*1024)).toFixed(2)+"MB":t=(n/(1024*1024*1024)).toFixed(2)+"GB";var c=t+"",d=c.indexOf("."),m=c.substring(d+1,d+3);return m=="00"?c.substring(0,d)+c.substr(d+3,2):t}function x(n){if(n){var t=new Date(n),c=t.getFullYear()+"-",d=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",m=(t.getDate()<10?"0"+t.getDate():t.getDate())+" ",v=(t.getHours()<10?"0"+t.getHours():t.getHours())+":",D=(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":",F=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds();return c+d+m+v+D+F}}}}]);
