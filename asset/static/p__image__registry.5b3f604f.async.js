"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9013],{1699:function(Y,C,e){e.d(C,{u:function(){return S}});var b=e(9783),u=e.n(b),D=e(97857),c=e.n(D),T=e(67294),R=e(82346),p=e(40411),O=e(42075),o=e(85893),S=function(P){var n=(0,R.useAccess)(),i=Array.isArray(P.access)?P.access:[P.access],s,E=P.fallback;if(typeof P.children=="function"?(s=P.children(i.reduce(function(t,F){return c()(c()({},t),{},u()({},F,n[F]))},{})),s||(s=E)):i.every(function(t){return n[t]})?s=P.children:s=E,!E&&s&&P.showProTips&&n.canSeeEnableCe){if(n.canSeeEnableHiddenProTips)return null;s=(0,o.jsx)(p.Z,{offset:P.showProTipsOffset,count:"PRO",color:"gold",style:{fontWeight:"bold"},children:s})}if(!E&&s&&P.showProRibbonTips&&n.canSeeEnableCe){if(n.canSeeEnableHiddenProTips)return null;s=(0,o.jsx)(p.Z.Ribbon,{text:"PRO",color:"gold",style:{fontWeight:"bold"},children:s})}return P.space?(0,o.jsx)(O.Z,c()(c()({},P.space),{},{children:s})):s}},80821:function(Y,C,e){e.d(C,{Z:function(){return P}});var b=e(97857),u=e.n(b),D=e(5574),c=e.n(D),T=e(24963),R=e(36146),p=e(86738),O=e(83062),o=e(28036),S=e(67294),g=e(85893);function P(n){var i=(0,S.useState)(!1),s=c()(i,2),E=s[0],t=s[1],F=(0,S.useContext)(T.Z),A=F.message,M=new R.Uo,Q=function(){t(!0);var X=n.action();X instanceof Promise?X.then(function(z){if(t(!1),z){typeof n.onSuccess=="function"&&n.onSuccess(z);var w="";n.messageSuccess?typeof n.messageSuccess=="function"?w=n.messageSuccess(z):w=n.messageSuccess.indexOf("notification.")==0?M.format(n.messageSuccess):n.messageSuccess:w=M.format("notification.finish"),n.asynced?A.info(w):A.success(w)}}).catch(function(z){t(!1),typeof n.onError=="function"&&n.onError(z)}):t(!1)};return n.confirm?(0,g.jsx)(p.Z,u()(u()({style:{width:500},title:n.confirmTitle?n.confirmTitle:M.format("notification.title.tip"),description:typeof n.confirm=="string"&&n.confirm.indexOf("notification.")==0?M.format(n.confirm):n.confirm,onConfirm:Q,okText:"Yes",cancelText:"No",onOpenChange:n.confirmOnOpenChange},n.confirmProps),{},{children:(0,g.jsx)(O.Z,{title:n.tips,children:(0,g.jsx)(o.ZP,{block:n.block,disabled:n.disabled,icon:!n.children&&E?void 0:n.icon,loading:E,danger:n.danger,type:n.type,children:n.children})})})):(0,g.jsx)(O.Z,{title:n.tips,children:(0,g.jsx)(o.ZP,{block:n.block,style:n.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:n.disabled,icon:!n.children&&E?void 0:n.icon,loading:E,onClick:Q,danger:n.danger,type:n.type,children:n.children})})}},44349:function(Y,C,e){var b=e(97857),u=e.n(b),D=e(17186),c=e(5966),T=e(86250),R=e(67294),p=e(85893),O=(0,R.forwardRef)(function(o,S){var g=(0,R.useRef)();(0,R.useImperativeHandle)(S,function(){return{addItem:function(i,s){var E,t=(E=g.current)===null||E===void 0?void 0:E.getList(),F=!1;if(t==null||t.map(function(M){if(M.name==i){F=!0;return}}),!F){var A;(A=g.current)===null||A===void 0||A.add({name:i,value:s})}},clear:function(){var i;(i=g.current)===null||i===void 0||(i=i.getList())===null||i===void 0||i.map(function(s,E){var t;(t=g.current)===null||t===void 0||t.remove(E)})}}});var P={};return o.hideCopyButton===!0&&(P.copyIconProps=!1),o.hideDeleteButton===!0&&(P.deleteIconProps=!1),(0,p.jsx)(D.u,u()(u()({initialValue:o.initialValue,label:o.label,name:o.name,actionRef:g,creatorButtonProps:o.showAddButton?{creatorButtonText:o.label?o.label:o.name}:!1,min:o.min?o.min:0},P),{},{children:function(i,s,E){return(0,p.jsx)(T.Z,{justify:o.justify,gap:o.gap,children:o.items.map(function(t){return t.render?(0,p.jsx)("div",{children:t.render&&t.render(i,s,E)},"".concat(o.name,"-").concat(t.name,"-").concat(i.key)):(0,p.jsx)(c.Z,{width:t.width,name:t.name,label:t.label,required:t.required,rules:[{required:t.required}],disabled:t.disabled,placeholder:t.placeholder},"".concat(o.name,"-").concat(t.name,"-").concat(i.key))})})}}))});C.Z=O},36435:function(Y,C,e){var b=e(15009),u=e.n(b),D=e(64599),c=e.n(D),T=e(99289),R=e.n(T),p=e(9783),O=e.n(p),o=e(5574),S=e.n(o),g=e(67294),P=e(184),n=e(38345),i=e(97269),s=e(97321),E=e(97462),t=e(64317),F=e(5966),A=e(86615),M=e(68602),Q=e(28036),K=e(83403),X=e(24963),z=e(1699),w=e(29177),k=e(45742),ee=e(43425),re=e(44349),ae=e(3616),q=e(36146),j=e(85893),se=(0,g.forwardRef)(function(a,ie){var le=(0,g.useState)(!1),ne=S()(le,2),U=ne[0],J=ne[1],Z=(0,g.useRef)(),G=(0,g.useContext)(X.Z),B=G.message,I=(0,g.useState)([]),L=S()(I,2),$=L[0],y=L[1],d=new q.Uo("components.permissionButton"),x=O()(O()(O()(O()(O()({},K.W6.CONTAINER,"Id"),K.W6.APPSTORE,"name"),K.W6.COMPOSE,"name"),K.W6.REGISTRY,"serverAddress"),K.W6.DOCKER_ENV,"name"),oe=O()(O()(O()(O()(O()({},K.W6.CONTAINER,"name"),K.W6.APPSTORE,"name"),K.W6.COMPOSE,"name"),K.W6.REGISTRY,"title"),K.W6.DOCKER_ENV,"title"),te=x[a.type],W=oe[a.type],H=a.selected.map(function(l){return l[x[a.type]]});return g.useEffect(function(){if(U){if(!a.selected||a.selected.length==0){B.error(q.FD.format("message.noDataSelect")),J(!1);return}(0,M.dP)({permission:{uri:a.type,key:te,value:H}}).then(function(l){var r;(r=Z.current)===null||r===void 0||r.setFieldValue("list",Object.keys(l.data.list).map(function(_){return{name:_,type:l.data.list[_].type,users:l.data.list[_].users}}))}),(0,M.lE)().then(function(l){var r,_=(r=l.data)===null||r===void 0||(r=r.list)===null||r===void 0?void 0:r.map(function(m){return{label:m.username,value:m.username}});y(_)})}},[U]),(0,j.jsx)(z.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,j.jsxs)(P.a,{name:"create",title:d.format("drawerTitle"),open:U,onOpenChange:function(r){if(!r){var _;(_=Z.current)===null||_===void 0||_.resetFields()}J(r)},drawerProps:{forceRender:!0,width:ae.R_},formRef:Z,trigger:(0,j.jsx)(Q.ZP,{icon:(0,j.jsx)(w.Z,{}),children:d.format("drawerTriggerButton")}),onFinish:function(){var l=R()(u()().mark(function r(_){var m,f,v;return u()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:m=c()(_.list),h.prev=1,m.s();case 3:if((f=m.n()).done){h.next=9;break}return v=f.value,h.next=7,(0,M.Db)({usernames:v.users,permissionType:v.type,permission:{uri:a.type,key:te,showKey:W,value:[v.name]}});case 7:h.next=3;break;case 9:h.next=14;break;case 11:h.prev=11,h.t0=h.catch(1),m.e(h.t0);case 14:return h.prev=14,m.f(),h.finish(14);case 17:B.success(q.FD.format("finish")),J(!1),a.onSuccess();case 20:case"end":return h.stop()}},r,null,[[1,11,14,17]])}));return function(r){return l.apply(this,arguments)}}(),children:[(0,j.jsxs)(n.Z,{ghost:!0,title:(0,j.jsx)(k.Z,{}),subTitle:d.format("batchTitle"),children:[(0,j.jsx)(i.A.Item,{name:"type",style:{marginBottom:0},children:(0,j.jsx)(s.Z.Group,{defaultValue:"admin",onChange:function(r){var _,m,f=(_=Z.current)===null||_===void 0?void 0:_.getFieldValue("list");f.forEach(function(v){v.type=r,v.users=[]}),(m=Z.current)===null||m===void 0||m.setFieldValue("list",f)},children:["admin","restricted","public"].map(function(l){return(0,j.jsx)(s.Z,{style:{width:240},title:d.format("dataTypeOption.".concat(l)),description:d.format("dataTypeOptionDesc.".concat(l)),value:l},l)})})}),(0,j.jsx)(E.Z,{name:["type"],children:function(r){var _=r.type;if(_==="restricted")return(0,j.jsx)(t.Z,{mode:"multiple",name:"usernames",label:d.format("formUsernames"),onChange:function(f){var v,V,h=(v=Z.current)===null||v===void 0?void 0:v.getFieldValue("list");h.forEach(function(N){N.users=f}),(V=Z.current)===null||V===void 0||V.setFieldValue("list",h)},rules:[{required:!0}],request:R()(u()().mark(function m(){var f,v,V;return u()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(!($.length>0)){N.next=2;break}return N.abrupt("return",$);case 2:return N.next=4,(0,M.lE)();case 4:return v=N.sent,V=(f=v.data)===null||f===void 0||(f=f.list)===null||f===void 0?void 0:f.map(function(ue){return{label:ue.username,value:ue.username}}),y(V),N.abrupt("return",V);case 8:case"end":return N.stop()}},m)}))})}})]}),(0,j.jsx)(n.Z,{ghost:!0,title:(0,j.jsx)(ee.Z,{}),subTitle:d.format("dataTitle"),children:(0,j.jsx)(re.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:d.format("dataName"),render:function(r,_,m){var f=m.getCurrentRowData();return(0,j.jsx)(F.Z,{disabled:!0,label:d.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:d.format("dataType"),render:function(r,_,m){var f=m.getCurrentRowData();return(0,j.jsx)(A.Z.Group,{label:d.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(v){return{label:d.format("dataTypeOption.".concat(v)),value:v}})})}},{name:"users",label:d.format("dataUsers"),render:function(r,_,m){return(0,j.jsx)(E.Z,{name:["type"],children:function(v){var V=v.type;if(V=="restricted")return(0,j.jsx)(t.Z,{width:"sm",mode:"tags",name:"users",label:d.format("dataUsers"),options:$})}})}}]})})]})})});C.Z=se},3616:function(Y,C,e){e.d(C,{Ed:function(){return c},FK:function(){return u},R_:function(){return b},ob:function(){return D}});var b=window.innerWidth<=1024?"90vw":"65vw",u="90vw",D="60vw",c="50vh"},24963:function(Y,C,e){var b=e(67294),u=(0,b.createContext)({});C.Z=u},39900:function(Y,C,e){e.r(C),e.d(C,{default:function(){return ne}});var b=e(15009),u=e.n(b),D=e(99289),c=e.n(D),T=e(1699),R=e(80821),p=e(36435),O=e(83403),o=e(75870),S=e(67255),g=e(86548),P=e(90078),n=e(78099),i=e(82346),s=e(42075),E=e(96074),t=e(28036),F=e(83062),A=e(67294),M=e(36146),Q=e(5574),K=e.n(Q),X=e(3616),z=e(24963),w=e(184),k=e(5966),ee=e(52688),re=e(97462),ae=e(90672),q=e(62370),j=e(25593),se=e(66309),a=e(85893),ie=(0,A.forwardRef)(function(U,J){var Z=(0,A.useState)(!1),G=K()(Z,2),B=G[0],I=G[1],L=(0,A.useRef)(),$=(0,A.useState)(0),y=K()($,2),d=y[0],x=y[1],oe=(0,A.useContext)(z.Z),te=oe.message,W=new M.Uo("components.image");return(0,A.useImperativeHandle)(J,function(){return{setEditId:function(l){(0,o.t1)({id:l}).then(function(r){var _;I(!0),x(l),(_=L.current)===null||_===void 0||_.setFieldsValue({title:r.data.info.title,serverAddress:r.data.info.serverAddress,username:r.data.info.setting.username,password:r.data.info.setting.password,proxy:r.data.info.setting.proxy.join(`
`),enableHttp:r.data.info.setting.enableHttp,enableAuth:!!r.data.info.setting.username})})}}}),(0,a.jsxs)(w.a,{drawerProps:{forceRender:!0,width:X.R_},name:"createRegisry",title:W.format("registryCreateTitle"),open:B,onOpenChange:function(l){I(l)},layout:"horizontal",labelCol:{span:5,offset:0},formRef:L,trigger:(0,a.jsx)(t.ZP,{type:"primary",onClick:function(){var l;(l=L.current)===null||l===void 0||l.resetFields(),x(0)},children:W.format("registryCreateTirggerButton")}),onFinish:function(){var H=c()(u()().mark(function l(r){var _,m,f,v;return u()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,(0,o.ZH)({id:d,title:r.title,serverAddress:r.serverAddress,username:(_=r.username)!==null&&_!==void 0?_:"",password:(m=r.password)!==null&&m!==void 0?m:"",proxy:r.proxy?r.proxy.split(`
`):[],enableHttp:r.enableHttp});case 2:if(f=h.sent,!(f&&f.data&&f.data.id>0)){h.next=8;break}return te.success(M.FD.format("finish")),U.onFinish&&U.onFinish(),(v=L.current)===null||v===void 0||v.resetFields(),h.abrupt("return",!0);case 8:case"end":return h.stop()}},l)}));return function(l){return H.apply(this,arguments)}}(),children:[(0,a.jsx)(k.Z,{label:W.format("registryCreateFormTitle"),name:"title",placeholder:W.format("registryCreateFormTitleEmpty"),disabled:d==-1,required:!0}),(0,a.jsx)(k.Z,{label:W.format("registryCreateFormServerAddress"),name:"serverAddress",placeholder:"ccr.ccs.tencentyun.com, docker.io, 127.0.0.1:5000",disabled:d==-1,required:!0,rules:[{required:!0}]}),(0,a.jsx)(ee.Z,{tooltip:W.format("registryCreateFormEnableHttpTip"),label:W.format("registryCreateFormEnableHttp"),name:"enableHttp"}),(0,a.jsx)(ee.Z,{label:W.format("registryCreateFormEnableAuth"),name:"enableAuth"}),(0,a.jsx)(re.Z,{name:["enableAuth"],children:function(l){var r=l.enableAuth;return r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.Z,{label:W.format("registryCreateFormUsername"),name:"username",placeholder:W.format("registryCreateFormUsernameEmpty"),tooltip:""},"username"),(0,a.jsx)(k.Z.Password,{label:W.format("registryCreateFormPassword"),name:"password",allowClear:!0,placeholder:W.format("registryCreateFormPasswordEmpty")},"password")]})}}),(0,a.jsx)(ae.Z,{label:W.format("registryCreateFormProxy"),name:"proxy",fieldProps:{autoSize:{minRows:10}},placeholder:W.format("registryCreateFormProxyTip")}),(0,a.jsx)(q.Z,{label:W.format("registryCreateFormProxyRecommand"),children:(0,a.jsx)(s.Z,{wrap:!0,children:["docker.1panel.live","docker.m.daocloud.io","docker.1ms.run"].map(function(H,l){return(0,a.jsx)(j.Z.Link,{onClick:function(){var _,m,f=[];if((_=L.current)!==null&&_!==void 0&&_.getFieldValue("proxy")){var v;f=(v=L.current)===null||v===void 0?void 0:v.getFieldValue("proxy").split(`
`)}else f=[];f.includes(H)||f.push(H),(m=L.current)===null||m===void 0||m.setFieldValue("proxy",f.join(`
`))},children:(0,a.jsx)(se.Z,{color:"cyan",children:H})},l)})})},"recommend")]})}),le=ie;function ne(){var U=(0,A.useRef)(),J=(0,A.useRef)(),Z=(0,i.useAccess)();return(0,a.jsx)(P._z,{header:{extra:[(0,a.jsx)(T.u,{access:"canSeeImageRegistryManage",children:(0,a.jsx)(le,{onFinish:function(){var B,I;!((B=U.current)===null||B===void 0)&&B.reloadAndRest&&((I=U.current)===null||I===void 0||I.reloadAndRest())},ref:J},"create")},"create")]},children:(0,a.jsx)(n.Z,{scroll:{x:"max-content"},rowKey:"id",columns:[{title:M.FD.format("listTitle"),ellipsis:!0,dataIndex:"title"},{title:"Url",dataIndex:"serverAddress"},{title:M.FD.format("listUsername"),dataIndex:["setting","username"],search:!1},{title:M.FD.format("listManage"),width:100,search:!1,fixed:"right",hidden:!Z.canSeeImageRegistryManage,render:function(B,I,L,$,y){return(0,a.jsx)(s.Z,{split:(0,a.jsx)(E.Z,{type:"vertical"}),children:(0,a.jsx)(t.ZP,{type:"link",onClick:function(){var x;(x=J.current)===null||x===void 0||x.setEditId(I.id)},children:(0,a.jsx)(F.Z,{title:M.FD.format("listManageEdit"),children:(0,a.jsx)(g.Z,{})})})})}}],request:function(){var G=c()(u()().mark(function B(I,L,$){var y;return u()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,o.Ot)({title:I.title,serverAddress:I.serverAddress});case 2:return y=x.sent,x.abrupt("return",{data:y.data.list,success:!0,total:y.data.list.length});case 4:case"end":return x.stop()}},B)}));return function(B,I,L){return G.apply(this,arguments)}}(),toolBarRender:function(){return[]},rowSelection:Z.canSeeImageRegistryManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0}:void 0,pagination:(0,S.O)(),actionRef:U,tableAlertOptionRender:function(B){var I=B.selectedRowKeys,L=B.selectedRows;return(0,a.jsxs)(s.Z,{size:16,children:[(0,a.jsx)(p.Z,{type:O.W6.REGISTRY,selected:L,onSuccess:function(){var y,d;return!((y=U.current)===null||y===void 0)&&y.reloadAndRest&&((d=U.current)===null||d===void 0||d.reloadAndRest()),!0}}),(0,a.jsx)(R.Z,{danger:!0,type:"primary",action:function(){return(0,o.ix)({id:I})},onSuccess:function(){var y,d;return!((y=U.current)===null||y===void 0)&&y.reloadAndRest&&((d=U.current)===null||d===void 0||d.reloadAndRest()),!0},onError:function(){var y,d;return!((y=U.current)===null||y===void 0)&&y.reset&&((d=U.current)===null||d===void 0||d.reset()),!0},confirm:"notification.confirm.title",children:M.FD.format("listManageDeleteBatch")})]})}})})}},75870:function(Y,C,e){e.d(C,{Ot:function(){return R},ZH:function(){return O},ix:function(){return S},t1:function(){return P}});var b=e(15009),u=e.n(b),D=e(99289),c=e.n(D),T=e(82346);function R(i){return p.apply(this,arguments)}function p(){return p=c()(u()().mark(function i(s){return u()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,T.request)("/api/common/registry/get-list",{method:"POST",data:s}));case 1:case"end":return t.stop()}},i)})),p.apply(this,arguments)}function O(i){return o.apply(this,arguments)}function o(){return o=c()(u()().mark(function i(s){return u()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,T.request)("/api/common/registry/create",{method:"POST",data:s}));case 1:case"end":return t.stop()}},i)})),o.apply(this,arguments)}function S(i){return g.apply(this,arguments)}function g(){return g=c()(u()().mark(function i(s){return u()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,T.request)("/api/common/registry/delete",{method:"POST",data:s}));case 1:case"end":return t.stop()}},i)})),g.apply(this,arguments)}function P(i){return n.apply(this,arguments)}function n(){return n=c()(u()().mark(function i(s){return u()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,T.request)("/api/common/registry/get-detail",{method:"POST",data:s}));case 1:case"end":return t.stop()}},i)})),n.apply(this,arguments)}},67255:function(Y,C,e){e.d(C,{O:function(){return b},j:function(){return u}});function b(D){var c=localStorage.getItem("dpanel-pagesize");return c=="all"?!1:{defaultCurrent:D==null?void 0:D.page,showSizeChanger:!0,defaultPageSize:parseInt(c!=null?c:"20"),onChange:function(R,p){localStorage.setItem("dpanel-page-"+location.pathname.split("/").slice(-2).join("-"),"".concat(R))}}}function u(D){var c="dpanel-table-column-".concat(D),T={};if(localStorage.getItem(c)){var R;T=JSON.parse((R=localStorage.getItem(c))!==null&&R!==void 0?R:"{}")}return{defaultValue:T,onChange:function(O){localStorage.setItem("dpanel-table-column-".concat(D),JSON.stringify(O))}}}}}]);
