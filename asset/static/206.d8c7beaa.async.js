"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[206],{99922:function(Fe,ce,e){var me=e(97857),Y=e.n(me),re=e(15009),t=e.n(re),_e=e(99289),_=e.n(_e),ae=e(5574),k=e.n(ae),l=e(67294),L=e(85265),oe=e(42075),ge=e(83622),U=e(49610),ee=e(3616),V=e(29463),se=e(90581),we=e(5251),fe=e(36146),ye=e(95591),z=e(85893),je=new fe.Uo("components.console"),ve=(0,l.forwardRef)(function(Re,Pe){var R,le,I,Ce=(0,l.useRef)(),G=(0,l.useRef)(),H=(0,l.useState)(!1),X=k()(H,2),D=X[0],te=X[1],B=(0,l.useState)(),S=k()(B,2),h=S[0],Me=S[1];return(0,l.useImperativeHandle)(Pe,function(){return{show:function(J){return _()(t()().mark(function ne(){var Oe;return t()().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:Me(J),te(!0),(Oe=Ce.current)===null||Oe===void 0||Oe.resetFields();case 3:case"end":return Te.stop()}},ne)}))()}}}),(0,l.useEffect)(function(){return setTimeout(function(){var A;h&&((A=G.current)===null||A===void 0||A.start(h.url,{cmd:h&&h.cmd,workDir:h&&h.workDir}))},1e3),function(){var A;(A=G.current)===null||A===void 0||A.close()}},[h,D]),(0,z.jsxs)(L.Z,{forceRender:!0,width:ee.FK,open:D,onClose:function(){return[te(!1)]},title:je.format("drawerTitle",{name:(0,we.fi)((R=h==null?void 0:h.title)!==null&&R!==void 0?R:"","/")}),children:[(0,z.jsxs)(oe.Z,{style:{marginBottom:20},children:[Re.showFileExplorer&&(0,z.jsx)(V.Z,{trigger:(0,z.jsx)(ge.ZP,{icon:(0,z.jsx)(ye.Z,{}),type:"primary",children:fe.FD.format("listManageFilePath")}),type:"container",title:(0,we.fi)((le=h==null?void 0:h.title)!==null&&le!==void 0?le:"","/"),name:h&&h.url&&(I=h.url.split("/").pop())!==null&&I!==void 0?I:""}),(0,z.jsx)(se.Z,{onChangeShell:function(J){var ne;if(!h)return!1;(ne=G.current)===null||ne===void 0||ne.close(),Me(Y()(Y()({},h),{cmd:J!=null?J:h==null?void 0:h.cmd}))},onOpenNewWindow:function(J){return h?(J.workDir=h&&h.workDir?h.workDir:"","".concat(h.url,"?").concat(Object.keys(J).map(function(ne){return"".concat(ne,"=").concat(encodeURIComponent(J[ne]))}).join("&"))):""},onOpenNewWindowFinish:function(){var J;(J=G.current)===null||J===void 0||J.close(),te(!1)},onBatchCommandFinish:function(J){G.current&&G.current.run(J)}})]}),D&&(0,z.jsx)(U.Z,{height:"80vh",ref:G})]})});ce.Z=ve},29463:function(Fe,ce,e){e.d(ce,{Z:function(){return vn}});var me=e(97857),Y=e.n(me),re=e(15009),t=e.n(re),_e=e(99289),_=e.n(_e),ae=e(5574),k=e.n(ae),l=e(67294),L=e(82346);function oe(r,i){return ge.apply(this,arguments)}function ge(){return ge=_()(t()().mark(function r(i,s){var P;return t()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return P="/api/".concat(i,"/explorer/get-path-list"),K.next=3,(0,L.request)(P,{data:s,method:"POST"});case 3:return K.abrupt("return",K.sent);case 4:case"end":return K.stop()}},r)})),ge.apply(this,arguments)}function U(r,i){return ee.apply(this,arguments)}function ee(){return ee=_()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,L.request)("/api/".concat(i,"/explorer/export"),{data:s,method:"POST",responseType:"blob"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),ee.apply(this,arguments)}function V(r,i){return se.apply(this,arguments)}function se(){return se=_()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,L.request)("/api/".concat(i,"/explorer/import"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),se.apply(this,arguments)}function we(r,i){return fe.apply(this,arguments)}function fe(){return fe=_()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,L.request)("/api/".concat(i,"/explorer/delete"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),fe.apply(this,arguments)}function ye(r,i){return z.apply(this,arguments)}function z(){return z=_()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,L.request)("/api/".concat(i,"/explorer/unzip"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),z.apply(this,arguments)}function je(r,i){return ve.apply(this,arguments)}function ve(){return ve=_()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,L.request)("/api/".concat(i,"/explorer/get-content"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),ve.apply(this,arguments)}function Re(r,i){return Pe.apply(this,arguments)}function Pe(){return Pe=_()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,L.request)("/api/".concat(i,"/explorer/import-file-content"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),Pe.apply(this,arguments)}function R(r,i){return le.apply(this,arguments)}function le(){return le=_()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,L.request)("/api/".concat(i,"/explorer/mkdir"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),le.apply(this,arguments)}function I(r,i){return Ce.apply(this,arguments)}function Ce(){return Ce=_()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,L.request)("/api/".concat(i,"/explorer/chmod"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),Ce.apply(this,arguments)}function G(r,i){return H.apply(this,arguments)}function H(){return H=_()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,L.request)("/api/".concat(i,"/explorer/get-user-list"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),H.apply(this,arguments)}function X(r,i){return D.apply(this,arguments)}function D(){return D=_()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,L.request)("/api/".concat(i,"/explorer/get-file-stat"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),D.apply(this,arguments)}function te(r,i){return B.apply(this,arguments)}function B(){return B=_()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,L.request)("/api/".concat(i,"/explorer/attach-volume"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),B.apply(this,arguments)}function S(r){return h.apply(this,arguments)}function h(){return h=_()(t()().mark(function r(i){return t()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,(0,L.request)("/api/".concat(i,"/explorer/destroy-proxy-container"),{data:{},method:"POST"});case 2:return P.abrupt("return",P.sent);case 3:case"end":return P.stop()}},r)})),h.apply(this,arguments)}function Me(r,i){return A.apply(this,arguments)}function A(){return A=_()(t()().mark(function r(i,s){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,L.request)("/api/".concat(i,"/explorer/copy"),{data:s,method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},r)})),A.apply(this,arguments)}var J=e(97269),ne=e(5966),Oe=e(31112),Ze=e(81366),Te=e(86615),Ue=e(62370),$e=e(97462),Ne=e(11106),Ie=e(24963),Le=e(5251),xe=e(36146),ke=e(27166),a=e(85893),he=new xe.Uo("components.explorer"),Ve=(0,l.forwardRef)(function(r,i){var s,P,n=(0,l.useContext)(Ie.Z),K=n.notice,x=(0,l.useContext)(Oe.Z),F=x.currentPath,q=x.refresh,T=x.name,W=x.apiPrefix,m=(0,l.useRef)(),ue=(0,l.useState)(!1),$=k()(ue,2),O=$[0],f=$[1],u=(0,l.useRef)();return(0,l.useImperativeHandle)(i,function(){return{newFile:function(){var E;f(!0),(E=m.current)===null||E===void 0||E.setFieldValue("type","newFile")},editFile:function(E,y,pe){return _()(t()().mark(function c(){var de,De,M,g,o,w;return t()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return f(!0),(de=u.current)===null||de===void 0||de.loading(),b.prev=2,b.next=5,je(W,{name:T,file:y}).finally(function(){var Q;(Q=u.current)===null||Q===void 0||Q.finish()});case 5:if(w=b.sent,!(w.data.content==""&&pe!="0")){b.next=10;break}return K.error(he.format("editFileMessageNotSupport")),f(!1),b.abrupt("return");case 10:(De=m.current)===null||De===void 0||De.setFieldValue("newValue",w.data.content),(M=m.current)===null||M===void 0||M.setFieldValue("newName",E),(g=m.current)===null||g===void 0||g.setFieldValue("type","editFile"),(o=m.current)===null||o===void 0||o.setFieldValue("fileMode",w.data.fileMode),b.next=19;break;case 16:b.prev=16,b.t0=b.catch(2),f(!1);case 19:return b.abrupt("return");case 20:case"end":return b.stop()}},c,null,[[2,16]])}))()}}}),(0,a.jsxs)(ke.Z,{drawerProps:{width:"50vw",forceRender:!0},onFinish:function(){var p=_()(t()().mark(function E(y){return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(y.type!="newDir"){c.next=13;break}return c.prev=1,c.next=4,R(W,{name:T,destPath:"".concat(F,"/").concat((0,Le.fi)(y.newPath,"/"))});case 4:return q(),f(!1),c.abrupt("return",!0);case 9:c.prev=9,c.t0=c.catch(1);case 11:c.next=23;break;case 13:return c.prev=13,c.next=16,Re(W,{destPath:F,file:y.newName,content:y.newValue,name:T,fileMode:y.fileMode});case 16:return q(),f(!1),c.abrupt("return",!0);case 21:c.prev=21,c.t1=c.catch(13);case 23:return c.abrupt("return",!1);case 24:case"end":return c.stop()}},E,null,[[1,9],[13,21]])}));return function(E){return p.apply(this,arguments)}}(),ref:u,title:he.format("editFileTypeEditFile"),open:O,onOpenChange:function(E){if(f(E),!E){var y;(y=m.current)===null||y===void 0||y.resetFields(),r.onFinish&&r.onFinish()}},formRef:m,children:[(0,a.jsx)(Te.Z.Group,{name:"type",options:[{label:he.format("editFileTypeEditFile"),value:"editFile",disabled:((s=m.current)===null||s===void 0?void 0:s.getFieldValue("type"))!="editFile"},{label:he.format("editFileTypeNewFile"),value:"newFile"},{label:he.format("editFileTypeNewDir"),value:"newDir"}],disabled:((P=m.current)===null||P===void 0?void 0:P.getFieldValue("type"))=="editFile"}),(0,a.jsx)(Ue.Z,{name:"fileMode",hidden:!0}),(0,a.jsx)($e.Z,{name:["type"],children:function(E){var y=E.type;return y!="newDir"?[(0,a.jsx)(ne.Z,{label:he.format("editFileNewName"),tooltip:he.format("editFileNewNameTip"),name:"newName",fieldProps:{addonBefore:"".concat(F,"/")},placeholder:he.format("editFileNewNameEmpty"),disabled:y=="editFile"},"fileName"),(0,a.jsx)(Ue.Z,{label:he.format("editFileNewValue"),name:"newValue",children:(0,a.jsx)(Ne.ZP,{theme:"dark",height:"58vh",onChange:function(c){var de;(de=m.current)===null||de===void 0||de.setFieldValue("newValue",c)}})},"fileContent")]:(0,a.jsx)(ne.Z,{name:"newPath",label:he.format("editFileNewPath"),placeholder:he.format("editFileNewPathEmpty")})}})]})}),ze=Ve,Be=e(68536),Ae=e(83622),Ge=e(83062),He=e(66309),be=e(98510),Je=e(51042),Qe=e(86548),Ye=e(12119),Xe=e(51947),qe=e(27461),en=e(23430),nn=e(58638),rn=e(82061),tn=e(93162),an=e(88484),Ke=e(37476),on=e(91604),Se=e(3616),sn=e(4813);function ln(){var r=(0,l.useRef)(),i=(0,l.useContext)(Oe.Z),s=i.refresh,P=i.name,n=i.apiPrefix,K=i.currentPath,x=new xe.Uo("components.explorer");return(0,a.jsx)(Ke.Y,{modalProps:{width:Se.ob},formRef:r,trigger:(0,a.jsx)(Ae.ZP,{icon:(0,a.jsx)(an.Z,{}),children:x.format("toolbarUploadButton")}),title:x.format("toolbarUploadModalTitle"),onFinish:function(){var F=_()(t()().mark(function q(T){var W,m;return t()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return m=[],T.importFileList&&T.importFileList.map(function(O){m.push({name:O.name,path:O.response.data.path})}),V(n,{fileList:m,name:P,destPath:K}),(W=r.current)===null||W===void 0||W.resetFields(),s(),$.abrupt("return",!0);case 6:case"end":return $.stop()}},q)}));return function(q){return F.apply(this,arguments)}}(),children:(0,a.jsx)(on.Z,{name:"importFileList",fieldProps:{multiple:!0,name:"file",action:"/api/common/attach/upload",headers:{Authorization:"Bearer "+localStorage.getItem("token")},onRemove:function(q){return new Promise(function(T){var W;(0,sn._)({path:(W=q.response.data.path)!==null&&W!==void 0?W:""}).then(function(m){T(!0)})})}}})})}var We=e(38345),Ee=e(63434),un=e(42075),dn=(0,l.forwardRef)(function(r,i){var s=(0,l.useRef)(),P=(0,l.useContext)(Oe.Z),n=P.refresh,K=P.name,x=P.apiPrefix,F=(0,l.useState)(!1),q=k()(F,2),T=q[0],W=q[1],m=new xe.Uo("components.explorer");(0,l.useImperativeHandle)(i,function(){return{show:function(f){var u;W(!0),f.length==1&&$(ue(f[0].modStr)),(u=s.current)===null||u===void 0||u.setFieldValue("fileList",f.map(function(p){return p.path}))}}});function ue(O){var f=O.split(""),u=0,p=0,E=0;return f[1]=="r"&&(u+=4),f[2]=="w"&&(u+=2),f[3]=="x"&&(u+=1),f[4]=="r"&&(p+=4),f[5]=="w"&&(p+=2),f[6]=="x"&&(p+=1),f[7]=="r"&&(E+=4),f[8]=="w"&&(E+=2),f[9]=="x"&&(E+=1),"".concat(u).concat(p).concat(E)}function $(O){var f;if((f=s.current)===null||f===void 0||f.setFieldValue("permission",O),O.length>=1){var u;(u=s.current)===null||u===void 0||u.setFieldsValue({ownerRead:Number(O[0])&4,ownerWrite:Number(O[0])&2,ownerExec:Number(O[0])&1})}if(O.length>=2){var p;(p=s.current)===null||p===void 0||p.setFieldsValue({groupRead:Number(O[1])&4,groupWrite:Number(O[1])&2,groupExec:Number(O[1])&1})}if(O.length>=3){var E;(E=s.current)===null||E===void 0||E.setFieldsValue({everyoneRead:Number(O[2])&4,everyoneWrite:Number(O[2])&2,everyoneExec:Number(O[2])&1})}}return(0,a.jsxs)(Ke.Y,{modalProps:{forceRender:!0,width:Se.ob},title:m.format("toolbarPermissionModalTitle"),layout:"horizontal",open:T,onOpenChange:function(f){if(W(f),!f){var u;(u=s.current)===null||u===void 0||u.resetFields()}},formRef:s,onValuesChange:function(f,u){if(f.permission)$(f.permission);else{var p=["-",u.ownerRead?"r":"-",u.ownerWrite?"w":"-",u.ownerExec?"x":"-",u.groupRead?"r":"-",u.groupWrite?"w":"-",u.groupExec?"x":"-",u.everyoneRead?"r":"-",u.everyoneWrite?"w":"-",u.everyoneExec?"x":"-"];$(ue(p.join("")))}},onFinish:function(){var O=_()(t()().mark(function f(u){var p,E,y;return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,I(x,{name:K,fileList:u.fileList,mod:(p=u.permission)!==null&&p!==void 0?p:"600",hasChildren:(E=u.hasChildren)!==null&&E!==void 0?E:!0,user:u.user});case 2:return y=c.sent,n(),c.abrupt("return",!0);case 5:case"end":return c.stop()}},f)}));return function(f){return O.apply(this,arguments)}}(),children:[(0,a.jsxs)(We.Z,{ghost:!0,split:"vertical",bordered:!0,children:[(0,a.jsx)(Ue.Z,{name:"fileList",hidden:!0}),(0,a.jsxs)(We.Z,{title:m.format("toolbarPermissionOwner"),headerBordered:!0,children:[(0,a.jsx)(Ee.Z,{label:m.format("toolbarPermissionRead"),name:"ownerRead"}),(0,a.jsx)(Ee.Z,{label:m.format("toolbarPermissionWrite"),name:"ownerWrite"}),(0,a.jsx)(Ee.Z,{label:m.format("toolbarPermissionExec"),name:"ownerExec"})]}),(0,a.jsxs)(We.Z,{title:m.format("toolbarPermissionGroup"),headerBordered:!0,children:[(0,a.jsx)(Ee.Z,{label:m.format("toolbarPermissionRead"),name:"groupRead"}),(0,a.jsx)(Ee.Z,{label:m.format("toolbarPermissionWrite"),name:"groupWrite"}),(0,a.jsx)(Ee.Z,{label:m.format("toolbarPermissionExec"),name:"groupExec"})]}),(0,a.jsxs)(We.Z,{title:m.format("toolbarPermissionEveryone"),headerBordered:!0,children:[(0,a.jsx)(Ee.Z,{label:m.format("toolbarPermissionRead"),name:"everyoneRead"}),(0,a.jsx)(Ee.Z,{label:m.format("toolbarPermissionWrite"),name:"everyoneWrite"}),(0,a.jsx)(Ee.Z,{label:m.format("toolbarPermissionExec"),name:"everyoneExec"})]})]}),(0,a.jsxs)(We.Z,{bordered:!0,style:{marginTop:10},children:[(0,a.jsx)(ne.Z,{label:m.format("toolbarPermissionButton"),name:"permission",fieldProps:{maxLength:3},labelCol:{span:2}}),(0,a.jsxs)(un.Z.Compact,{children:[(0,a.jsx)(ne.Z,{width:"sm",placeholder:m.format("toolbarPermissionOwnerEmpty"),label:m.format("toolbarPermissionOwner"),name:"user",fieldProps:{addonAfter:":"}}),(0,a.jsx)(ne.Z,{width:"sm",placeholder:m.format("toolbarPermissionGroupEmpty"),name:"group"})]}),(0,a.jsx)(Ee.Z,{label:m.format("toolbarPermissionHasChildren"),name:"hasChildren",initialValue:!0})]})]})}),cn=dn,Pn=null,N=new xe.Uo("components.explorer"),mn=(0,l.forwardRef)(function(r,i){(0,l.useImperativeHandle)(i,function(){return{close:function(){$([]),c("")}}});var s=r.type=="host"?"common":"app",P=(0,l.useContext)(Ie.Z),n=P.message,K=(0,l.useRef)(),x=(0,l.useRef)(),F=(0,l.useRef)(),q=(0,l.useRef)(),T=(0,l.useRef)(),W=(0,L.useSearchParams)(),m=k()(W,2),ue=m[0],$=m[1],O=(0,l.useState)(),f=k()(O,2),u=f[0],p=f[1],E=(0,l.useState)(""),y=k()(E,2),pe=y[0],c=y[1];(0,l.useEffect)(function(){var M;n.info(N.format("commonMessageCreateExplorerPlugin")),c((M=r.workDir)!==null&&M!==void 0?M:"")},[]);function de(M,g){return De.apply(this,arguments)}function De(){return De=_()(t()().mark(function M(g,o){var w,Z,b;return t()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:(w=K.current)===null||w===void 0||w.addHistory(g,o),c(o),!((Z=F.current)===null||Z===void 0)&&Z.reloadAndRest&&((b=F.current)===null||b===void 0||b.reloadAndRest()),o=="/"?$([]):(ue.set("path",o),$(ue));case 4:case"end":return C.stop()}},M)})),De.apply(this,arguments)}return r&&(0,a.jsxs)(Oe.Z.Provider,{value:{name:r.name,apiPrefix:s,currentPath:pe,showPath:de,redirectPath:function(g){var o;if(c(g),F.current&&(o=F.current)!==null&&o!==void 0&&o.reloadAndRest){var w;(w=F.current)===null||w===void 0||w.reloadAndRest()}g=="/"?$([]):(ue.set("path",g),$(ue))},refresh:function(){var g;if(F&&typeof((g=F.current)===null||g===void 0?void 0:g.reloadAndRest)=="function"){var o;(o=F.current)===null||o===void 0||o.reloadAndRest()}}},children:[(0,a.jsx)(be.C,{sticky:!1,quickToolbarAffix:{offsetTop:10,target:function(){return document.querySelector(".file-explorer .ant-drawer-body")}},quickToolbarRender:function(g){var o=g.selectedRows,w=o.map(function(Z){return Z.path});return[r.onConsole&&(0,a.jsx)(Ae.ZP,{onClick:function(){r.onConsole&&r.onConsole(pe)},children:"Console"},"fileConsole"),(0,a.jsx)(ln,{},"upload"),(0,a.jsx)(Ae.ZP,{icon:(0,a.jsx)(Je.Z,{}),onClick:function(){x.current&&x.current.newFile()},type:"primary",children:N.format("toolbarNewButton")},"newfile")]},contextMenu:function(g){var o=g.selectedRow,w=g.selectedRows,Z=g.isMultiple,b=g.loading,Q=g.finish;return{items:[{key:"edit",label:(0,a.jsx)(be.C.ContextMenuItem,{buttonProps:{icon:(0,a.jsx)(Qe.Z,{}),disabled:Z()||o&&o.isDir||w.length==0},action:_()(t()().mark(function C(){var d,v;return t()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,X(s,{name:r.name,path:o.path});case 2:d=ie.sent,d.data.info.isDir?de(o.name,d.data.info.target):(v=x.current)===null||v===void 0||v.editFile(d.data.info.name,d.data.info.target,o.size);case 4:case"end":return ie.stop()}},C)})),children:xe.FD.format("listManageEdit")})},{key:"permission",label:(0,a.jsx)(be.C.ContextMenuItem,{buttonProps:{icon:(0,a.jsx)(Ye.Z,{}),disabled:w.length==0},action:_()(t()().mark(function C(){var d;return t()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:(d=q.current)===null||d===void 0||d.show(w);case 1:case"end":return j.stop()}},C)})),children:N.format("toolbarPermissionButton")})},{key:"rename",label:(0,a.jsx)(be.C.ContextMenuItem,{buttonProps:{icon:(0,a.jsx)(Xe.Z,{}),disabled:w.length!=1},action:_()(t()().mark(function C(){var d;return t()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return b(),j.abrupt("return",Me(s,{name:r.name,sourceFile:o.path,targetFile:"./".concat((d=T.current)===null||d===void 0?void 0:d.getFieldValue("targetFile")),isMove:!0}).finally(function(){Q(!0)}));case 2:case"end":return j.stop()}},C)})),confirmProps:{onOpenChange:function(d,v){var j;(j=T.current)===null||j===void 0||j.resetFields(),d&&Q()},getPopupContainer:function(d){return document.querySelector(".file-explorer .ant-pro-table")},zIndex:9999,description:(0,a.jsx)(J.A,{submitter:!1,style:{width:300,paddingTop:10,paddingRight:10},formRef:T,children:(0,a.jsx)(ne.Z,{name:"targetFile"})})},children:N.format("toolbarRenameButton")})},{key:"unzip",label:(0,a.jsx)(be.C.ContextMenuItem,{buttonProps:{icon:(0,a.jsx)(qe.Z,{}),disabled:w.length==0},action:_()(t()().mark(function C(){return t()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return b(),v.abrupt("return",ye(s,{name:r.name,file:w.map(function(j){return j.path}),path:pe}).finally(function(){Q(!0)}));case 2:case"end":return v.stop()}},C)})),children:N.format("toolbarUnzipButton")})},{type:"divider"},{key:"download",label:(0,a.jsx)(be.C.ContextMenuItem,{buttonProps:{icon:(0,a.jsx)(en.Z,{}),disabled:w.length==0},action:_()(t()().mark(function C(){return t()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",U(s,{name:r.name,fileList:w.map(function(j){return j.path})}));case 1:case"end":return v.stop()}},C)})),onSuccess:function(d){var v=new Blob([d],{type:"application/zip"});(0,tn.saveAs)(v,"export.zip")},children:N.format("toolbarDownloadButton")})},r.type=="container"||r.type=="volume"?{key:"export",label:(0,a.jsx)(be.C.ContextMenuItem,{buttonProps:{icon:(0,a.jsx)(nn.Z,{}),disabled:w.length==0},action:_()(t()().mark(function C(){return t()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return b(),v.abrupt("return",U(s,{name:r.name,fileList:w.map(function(j){return j.path}),enableExportToPath:!0}).finally(function(){Q(!0)}));case 2:case"end":return v.stop()}},C)})),onSuccess:function(){},children:N.format("toolbarExportButton")})}:null,{type:"divider"},{key:"delete",label:(0,a.jsx)(be.C.ContextMenuItem,{buttonProps:{danger:!0,icon:(0,a.jsx)(rn.Z,{})},confirmProps:{showCommonConfirm:!0},action:_()(t()().mark(function C(){return t()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return b(),v.abrupt("return",we(s,{name:r.name,fileList:w.map(function(j){return j.path})}).finally(function(){Q(!0)}));case 2:case"end":return v.stop()}},C)})),children:N.format("toolbarDeleteButton")},"deleteBatch")}]}},headerTitle:(0,a.jsx)(Ze.Z,{ref:K}),actionRef:F,search:!1,rowKey:"name",pagination:{pageSize:500,position:["topRight","bottomRight"]},request:_()(t()().mark(function M(){var g,o,w,Z,b;return t()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,oe(s,{name:r.name,path:pe});case 2:if(o=C.sent,pe==""&&o.data.currentPath!=""&&c(o.data.currentPath),w=[],(g=K.current)===null||g===void 0||g.initHistory(o.data.currentPath.split("/").filter(function(d){return d!=""}).map(function(d){return w.push(d),{title:d,path:"/".concat(w.join("/"))}}),o.data.rootDirs),Z=u,Z){C.next=13;break}return C.next=10,G(s,{name:r.name});case 10:b=C.sent,p(b.data),Z=b.data;case 13:return C.abrupt("return",{data:o.data.list.map(function(d){if(Z){var v,j;d.group=(v=(j=Z.group.find(function(ie){return ie.gid==d.group}))===null||j===void 0?void 0:j.name)!==null&&v!==void 0?v:d.group}return d}),success:!0,total:o.data.list.length});case 14:case"end":return C.stop()}},M)})),columns:[{title:N.format("listName"),dataIndex:"name",key:"name",render:function(Q,o,w,Z,b){var Q;return o.isDir?Q=(0,a.jsx)(Be.Z,{isDir:!0,onClick:function(){return de(o.name,o.path)},showName:o.name}):o.isSymlink?Q=(0,a.jsx)(Be.Z,{isLink:!0,showName:"".concat(o.name," -> ").concat(o.linkName),onClick:_()(t()().mark(function C(){var d,v;return t()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,X(s,{name:r.name,path:o.path});case 2:d=ie.sent,d.data.info.isDir?de(o.name,d.data.info.target):(v=x.current)===null||v===void 0||v.editFile(d.data.info.name,d.data.info.target,o.size);case 4:case"end":return ie.stop()}},C)}))}):Q=(0,a.jsx)(Be.Z,{showName:o.name,onClick:function(){var d;(d=x.current)===null||d===void 0||d.editFile(o.name,o.path,o.size)}}),Q}},{title:N.format("listStatus"),key:"status",width:110,render:function(g,o,w,Z,b){return o.change>-1&&(0,a.jsx)(Ge.Z,{title:N.format("listStatusTipOption.".concat(o.change)),children:(0,a.jsx)(He.Z,{color:N.format("listStatusColorOption.".concat(o.change)),children:N.format("listStatusOption.".concat(o.change))})})}},{title:N.format("listModStr"),dataIndex:"modStr",key:"mod"},{title:N.format("listUser"),dataIndex:"user"},{title:N.format("listGroup"),dataIndex:"group"},{title:N.format("listSize"),dataIndex:"size",key:"size",render:function(g,o,w,Z,b){return(0,Le.FI)(o.size)}},{title:N.format("listModTime"),dataIndex:"modTime",key:"modTime",sorter:function(g,o){return new Date(g.modTime).getTime()-new Date(o.modTime).getTime()},render:function(g,o,w,Z,b){return(0,Le.NF)(o.modTime)}}],cardProps:{ghost:!0}},"explorer-list"),(0,a.jsx)(ze,{onFinish:function(){var g;!((g=F.current)===null||g===void 0)&&g.reset&&F.current.reset()},ref:x}),(0,a.jsx)(cn,{ref:q},"chmod")]})}),fn=mn,hn=e(85265),pn=e(99922),_n=(0,l.forwardRef)(function(r,i){var s,P=(0,l.useState)(!1),n=k()(P,2),K=n[0],x=n[1],F=(0,l.useState)(),q=k()(F,2),T=q[0],W=q[1],m=(0,l.useRef)(),ue=new xe.Uo("components.explorer"),$=(0,l.useContext)(Ie.Z),O=$.loading,f=(0,l.useRef)();return(0,l.useImperativeHandle)(i,function(){return{showContainer:function(p,E){W({name:(0,Le.fi)(p,"/"),type:"container",workDir:E!=null?E:void 0}),x(!0)},showHost:function(p){W({name:p,type:"host"}),x(!0)},showVolume:function(p){return _()(t()().mark(function E(){var y;return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return O.show(),c.next=3,te("app",{name:p}).finally(function(){O.destroy()});case 3:y=c.sent,W({name:y.data.containerName,type:"container",workDir:y.data.path}),x(!0);case 6:case"end":return c.stop()}},E)}))()}}}),(0,a.jsxs)(a.Fragment,{children:[r.trigger?l.cloneElement(r.trigger,{onClick:function(){r.name&&r.type&&(W(r),x(!0))}}):null,(0,a.jsxs)(hn.Z,{destroyOnHidden:!0,width:Se.R_,title:ue.format("drawerTitle",{name:(s=r.title)!==null&&s!==void 0?s:T==null?void 0:T.name}),onClose:_()(t()().mark(function u(){var p;return t()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(O.show(),x(!1),(p=m.current)===null||p===void 0||p.close(),W(void 0),!r.onCloseDestroy){y.next=7;break}return y.next=7,S("app");case 7:O.destroy();case 8:case"end":return y.stop()}},u)})),rootClassName:"file-explorer",open:K,children:[r.showConsole&&(0,a.jsx)(pn.Z,{showFileExplorer:!1,ref:f}),K&&T&&(0,a.jsx)(fn,Y()(Y()({ref:m},T),{},{onConsole:r.showConsole?function(u){var p;(p=f.current)===null||p===void 0||p.show({url:"/console/container/".concat(T.name),title:T.name,workDir:u})}:void 0}))]})]})}),vn=_n},90581:function(Fe,ce,e){e.d(ce,{Z:function(){return le}});var me=e(15009),Y=e.n(me),re=e(99289),t=e.n(re),_e=e(5574),_=e.n(_e),ae=e(3616),k=e(97269),l=e(38345),L=e(64317),oe=e(37476),ge=e(62370),U=e(97462),ee=e(11106),V=e(42075),se=e(83622),we=e(83062),fe=e(67294),ye=e(1883),z=e(33160),je=e(58638),ve=e(82346),Re=e(75520),Pe=e(36146),R=e(85893);function le(I){var Ce=(0,fe.useState)(!1),G=_()(Ce,2),H=G[0],X=G[1],D=(0,fe.useRef)(),te=new Pe.Uo("components.console");return(0,R.jsx)(k.A,{layout:"inline",submitter:!1,children:(0,R.jsx)(l.Z,{ghost:!0,children:(0,R.jsxs)(V.Z,{children:[(0,R.jsx)(L.Z,{width:"sm",name:"entryCmd",placeholder:te.format("toolbarEntryCmdEmpty"),valueEnum:{"/bin/sh":"/bin/sh","/bin/bash":"/bin/bash"},onChange:function(S){I.onChangeShell&&I.onChangeShell(S)}}),(0,R.jsx)(oe.Y,{modalProps:{width:ae.ob,height:ae.Ed},title:te.format("toolbarBatchCommandTitle"),name:"batchCommand",open:H,trigger:(0,R.jsx)(se.ZP,{icon:(0,R.jsx)(ye.Z,{}),children:te.format("toolbarBatchCommandTitle")}),formKey:"batchCommand",formRef:D,isKeyPressSubmit:!0,onFinish:function(){var B=t()(Y()().mark(function S(h){return Y()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:I.onBatchCommandFinish&&I.onBatchCommandFinish(h.shell.split(`
`)),X(!1);case 2:case"end":return A.stop()}},S)}));return function(S){return B.apply(this,arguments)}}(),onOpenChange:function(S){X(S),S&&D.current&&D.current.resetFields()},children:(0,R.jsx)(ge.Z,{name:"shell",children:(0,R.jsx)(ee.ZP,{theme:"dark",height:ae.Ed})})}),(0,R.jsx)(se.ZP,{onClick:function(){I.onChangeShell&&I.onChangeShell()},icon:(0,R.jsx)(z.Z,{}),type:"primary",children:Pe.FD.format("listManageRefresh")}),(0,R.jsx)(U.Z,{name:["entryCmd"],children:function(S){var h=S.entryCmd;return(!h||h=="")&&(h="/bin/sh"),I.onOpenNewWindow&&(0,R.jsx)(ve.Link,{onClick:function(){I.onOpenNewWindowFinish&&I.onOpenNewWindowFinish()},target:"_blank",to:I.onOpenNewWindow({cmd:h}),children:(0,R.jsx)(we.Z,{title:te.format("toolbarOpenInNewWindowTip"),children:(0,R.jsx)(se.ZP,{type:"dashed",icon:(0,R.jsx)(je.Z,{})})})})}}),(0,R.jsx)(Re.Z,{buttonProps:{shape:"default",size:"middle"}})]})})})}},49610:function(Fe,ce,e){var me=e(5574),Y=e.n(me),re=e(67294),t=e(52626),_e=e(78267),_=e.n(_e),ae=e(12323),k=e(87662),l=e(4244),L=e.n(l),oe=e(24078),ge=e(85893),U,ee,V,se,we=(0,re.forwardRef)(function(fe,ye){var z,je=(0,re.useState)(),ve=Y()(je,2),Re=ve[0],Pe=ve[1],R=(0,re.useState)(""),le=Y()(R,2),I=le[0],Ce=le[1];(0,re.useImperativeHandle)(ye,function(){return{start:function(X,D){G(),ee.fit(),D.width=U.cols,D.height=U.rows;var te=D?Object.keys(D).filter(function(B){return D&&D[B]}).map(function(B){if(D&&D[B])return"".concat(B,"=").concat(D[B])}):[];V=new WebSocket((0,t.R)(X+"?"+te.join("&"))),V.addEventListener("message",function(B){var S=JSON.parse(B.data),h=S.type;if(h==X&&(U.write(S.data),S.data.indexOf("exec failed")!=-1)){G();return}}),se=U.onData(function(B){var S={content:{command:B},type:X};V&&V.send(JSON.stringify(S))}),Ce(X),Pe(D)},close:function(){G()},fit:function(){return ee.fit(),{width:U.cols,height:U.rows}},run:function(X){Re&&X&&X.forEach(function(D){var te={content:{command:D+`
`},type:I};V&&V.send(JSON.stringify(te))})}}}),(0,re.useEffect)(function(){return U=new l.Terminal(ae.X),ee=new _e.FitAddon,U.loadAddon(ee),U.open(document.getElementById("terminal-container-console")),ee.fit(),(0,k.pe)({groupName:"setting",name:"themeConsoleConfig"}).then(function(H){H.data&&H.data.fontSize&&Object.assign(U.options,H.data)}),function(){G()}},[]),(0,re.useEffect)(function(){window.addEventListener("resize",function(){ee.fit();var H={size:{width:U.cols,height:U.rows},type:I};I&&V&&V.send(JSON.stringify(H))})},[I]);function G(){se&&(U.reset(),ee.fit(),U.focus(),se.dispose()),V&&(V.close(),V=null)}return(0,ge.jsx)("div",{style:{height:(z=fe.height)!==null&&z!==void 0?z:"100vh"},id:"terminal-container-console"})});ce.Z=we},12323:function(Fe,ce,e){e.d(ce,{X:function(){return me},n:function(){return Y}});var me={convertEol:!0,fontFamily:'Menlo, Monaco, "Courier New", monospace',fontWeight:400,fontSize:16,lineHeight:1,cursorStyle:"block",cursorInactiveStyle:"outline",cursorBlink:!0,letterSpacing:0,theme:{foreground:"#bfbfbf",cursor:"gray",selectionForeground:"#ffffff"}},Y=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"]},4813:function(Fe,ce,e){e.d(ce,{_:function(){return _}});var me=e(15009),Y=e.n(me),re=e(99289),t=e.n(re),_e=e(82346);function _(k){return ae.apply(this,arguments)}function ae(){return ae=t()(Y()().mark(function k(l){return Y()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return oe.next=2,(0,_e.request)("/api/common/attach/delete",{method:"POST",data:l});case 2:return oe.abrupt("return",oe.sent);case 3:case"end":return oe.stop()}},k)})),ae.apply(this,arguments)}}}]);
