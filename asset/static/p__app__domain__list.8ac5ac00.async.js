"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7750],{92067:function(re,H,e){e.d(H,{Z:function(){return a}});var X=e(15009),d=e.n(X),Y=e(99289),Z=e.n(Y),$=e(60335),N=e(64789),Q=e(41482),x=e(42075),V=e(28036),L=e(37413),z=e(5251),T=e(85893);function a(U){return(0,T.jsx)(Q.Z,{columns:[{title:"\u5BB9\u5668\u540D\u79F0",dataIndex:"name",render:function(p,m,c,b){return(0,T.jsx)(x.Z,{direction:"vertical",style:{textAlign:"left"},children:m==null?void 0:m.Names.map(function(D){return(0,z.fi)(D,"/")})},m.Id)}},{title:"\u7AEF\u53E3",dataIndex:"ports",search:!1,render:function(p,m,c,b){var D=[],h=[];return m!=null&&m.Ports&&m.Ports.map(function(v,y){v.PublicPort?D.push(v):h.push(v)}),(0,T.jsx)(L.Z,{publicPort:D,privatePort:h,domain:[]})}},{title:"\u64CD\u4F5C",valueType:"option",key:"option",ellipsis:!0,width:100,render:function(p,m,c,b){return[(0,T.jsx)(V.ZP,{type:"link",onClick:Z()(d()().mark(function D(){var h;return d()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,(0,$.jV)({md5:m.Id});case 2:h=y.sent,U.onSelect&&U.onSelect(h.data.info);case 4:case"end":return y.stop()}},D)})),children:(0,T.jsx)(N.Z,{})},m.Id)]}}],rowKey:"Id",request:function(){var r=Z()(d()().mark(function p(m,c,b){var D;return d()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,(0,$.IE)({siteTitle:m.name});case 2:return D=v.sent,v.abrupt("return",{data:D.data.list,success:!0,total:D.data.list.length});case 4:case"end":return v.stop()}},p)}));return function(p,m,c){return r.apply(this,arguments)}}(),pagination:{pageSize:9}})}},37413:function(re,H,e){e.d(H,{Z:function(){return U}});var X=e(19632),d=e.n(X),Y=e(85577),Z=e(58638),$=e(36693),N=e(35995),Q=e(99611),x=e(38345),V=e(42075),L=e(66309),z=e(55241),T=e(67294),a=e(85893);function U(r){var p=[];r.publicPort&&(p=d()(r.publicPort)),r.privatePort&&(p=[].concat(d()(p),d()(r.privatePort)));var m=(0,a.jsxs)(x.Z,{direction:r.layout=="inline"?"row":"column",style:{width:r.layout!="inline"?750:"auto"},ghost:!0,children:[p.length>0&&(0,a.jsx)(x.Z,{title:(0,a.jsx)(Y.Z,{}),subTitle:"\u7ED1\u5B9A\u7AEF\u53E3",ghost:r.ghost,children:p.map(function(c,b){var D,h=(D=r.serverIp)!==null&&D!==void 0?D:"localhost";if(h!=""&&h.indexOf("http")===-1&&h.indexOf(":")>-1&&(h="[".concat(h,"]")),h==""){var v=document.location.protocol+"//"+document.location.hostname;h=v}return h==""&&(h=c.IP),(0,a.jsx)(V.Z,{size:"large",wrap:!0,children:(0,a.jsx)(L.Z,{color:c.PublicPort?"#2db7f5":"warning",icon:c.PublicPort?(0,a.jsx)(Z.Z,{}):"",style:{marginBottom:10,marginRight:15,width:210},children:c.PublicPort?(0,a.jsx)("a",{href:"".concat(h.indexOf("http")===0?h:"http://"+h,":").concat(c.PublicPort),target:"_blank",children:"".concat(c.PublicPort?c.IP+":"+c.PublicPort+" -> ":"").concat(c.PrivatePort,"/").concat(c.Type)},"link".concat(b)):"".concat(c.PrivatePort,"/").concat(c.Type)})},"space".concat(b))})}),r.domain&&r.domain.length>0&&(0,a.jsx)(x.Z,{title:(0,a.jsx)($.Z,{}),subTitle:"\u7ED1\u5B9A\u57DF\u540D",ghost:r.ghost,children:(0,a.jsx)(V.Z,{wrap:!0,style:{textAlign:"left"},children:r.domain&&r.domain.map(function(c,b){return(0,a.jsx)(L.Z,{color:"blue",icon:(0,a.jsx)(Z.Z,{}),children:(0,a.jsx)("a",{href:c,target:"_blank",children:c})},"domain".concat(b))})})})]});return r.showInDetail?m:(0,a.jsx)(z.Z,{placement:"bottom",content:m,children:(0,a.jsxs)(V.Z,{direction:"vertical",children:[r.privatePort&&r.privatePort.length>0&&(0,a.jsxs)(L.Z,{color:"warning",icon:(0,a.jsx)(N.Z,{}),children:["\u5185\u90E8\u7AEF\u53E3: ",r.privatePort.length]}),r.publicPort&&r.publicPort.length>0&&(0,a.jsxs)(L.Z,{color:"#2db7f5",icon:(0,a.jsx)(Q.Z,{}),children:["\u5BF9\u5916\u7AEF\u53E3: ",r.publicPort.length]}),r.domain&&r.domain.length>0&&(0,a.jsx)(L.Z,{color:"blue",icon:(0,a.jsx)($.Z,{}),children:r.domainTitle?r.domainTitle:"\u7ED1\u5B9A\u57DF\u540D: ".concat(r.domain.length)})]})})}},96668:function(re,H,e){e.r(H),e.d(H,{default:function(){return Ze}});var X=e(15009),d=e.n(X),Y=e(99289),Z=e.n(Y),$=e(5574),N=e.n($),Q=e(1699),x=e(66554),V=e(184),L=e(24739),z=e(97462),T=e(5966),a=e(62370),U=e(64317),r=e(86615),p=e(31199),m=e(52688),c=e(95089),b=e(28036),D=e(92398),h=e(84567),v=e(42075),y=e(66309),le=e(85265),ae=e(71230),ee=e(15746),oe=e(38925),I=e(67294),de=e(92067),ce=e(74026),n=e(85893),me=(0,I.forwardRef)(function(g,K){var _=(0,I.useState)(!1),W=N()(_,2),G=W[0],J=W[1],B=(0,I.useRef)(),j=(0,I.useState)(),f=N()(j,2),t=f[0],O=f[1],C=(0,I.useState)(!1),o=N()(C,2),u=o[0],E=o[1],ue=(0,I.useState)(1),M=N()(ue,2),R=M[0],k=M[1];return(0,I.useImperativeHandle)(K,function(){return{showEdit:function(i){return Z()(d()().mark(function s(){var A,w,l;return d()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,(0,x.lQ)({id:i});case 2:w=F.sent,l=w.data,(A=B.current)===null||A===void 0||A.setFieldsValue({containerId:l.domain.containerId,serverName:l.domain.serverName,serverNameAlias:l.domain.setting.serverNameAlias,protocol:l.domain.setting.serverProtocol,port:l.domain.setting.port,enableBlockCommonExploits:l.domain.setting.enableBlockCommonExploits,enableAssetCache:l.domain.setting.enableAssetCache,enableWs:l.domain.setting.enableWs,extraNginx:l.domain.setting.extraNginx,enableSSL:l.domain.setting.enableSSL,certName:l.domain.setting.certName,vhost:l.vhost,hostname:l.domain.setting.serverAddress}),O(l),J(!0);case 7:case"end":return F.stop()}},s)}))()}}}),(0,n.jsx)(V.a,{drawerProps:{forceRender:!0},open:G,onOpenChange:function(i){J(i)},title:"\u6DFB\u52A0&\u7F16\u8F91\u8F6C\u53D1\u89C4\u5219",trigger:(0,n.jsx)(b.ZP,{onClick:function(){var i;O(void 0),(i=B.current)===null||i===void 0||i.resetFields()},type:"primary",children:"\u6DFB\u52A0\u57DF\u540D\u8F6C\u53D1"}),formRef:B,onFinish:function(){var P=Z()(d()().mark(function i(s){var A,w,l,q,F;return d()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(!s.vhost){S.next=8;break}return S.next=3,(0,x.Ss)({id:t&&(t==null?void 0:t.domain.id)>0?t.domain.id:0,vhost:s.vhost});case 3:return w=S.sent,S.next=6,(0,x.hZ)();case 6:S.next=11;break;case 8:return S.next=10,(0,x.Fj)({id:t&&(t==null?void 0:t.domain.id)>0?t.domain.id:0,containerId:s.containerId,serverName:s.serverName,serverNameAlias:s.serverNameAlias,hostname:s.hostname,protocol:(l=s.protocol)!==null&&l!==void 0?l:"http",port:parseInt((q=s.port)!==null&&q!==void 0?q:"80"),enableBlockCommonExploits:s.enableBlockCommonExploits,enableAssetCache:s.enableAssetCache,enableWs:s.enableWs,enableSSL:s.enableSSL,extraNginx:s.extraNginx,certName:s.certName});case 10:F=S.sent;case 11:return(A=B.current)===null||A===void 0||A.resetFields(),g.onFinish(),S.abrupt("return",!0);case 14:case"end":return S.stop()}},i)}));return function(i){return P.apply(this,arguments)}}(),children:(0,n.jsx)(D.Z,{items:[{key:"1",label:"\u914D\u7F6E\u57DF\u540D",destroyInactiveTabPane:!0,children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(L.UW,{children:[(0,n.jsx)(z.Z,{name:["enableSSL"],children:function(i){var s=i.enableSSL;return(0,n.jsx)(T.Z,{width:"lg",label:"\u4E3B\u57DF\u540D",tooltip:"\u6307\u5B9A\u8981\u7ED1\u5B9A\u7684\u57DF\u540D,\u5E76\u5C06\u8BE5\u57DF\u540D\u89E3\u6790\u5230\u5F53\u524D\u670D\u52A1\u5668",name:"serverName",placeholder:"www.explame.com, demo.com:8807",rules:[{required:!0}],fieldProps:{addonBefore:s?"https://":"http://"},disabled:t&&t.domain.id>0})}}),(0,n.jsx)(a.Z,{label:" ",valuePropName:"checked",name:"enableSSL",children:(0,n.jsx)(h.Z,{children:"Https?"})})]}),(0,n.jsx)(U.Z,{label:"\u522B\u540D",name:"serverNameAlias",mode:"tags",placeholder:"\u914D\u7F6E\u57DF\u540D\u522B\u540D\uFF0C\u53EF\u586B\u6DFB\u52A0\u4E2A\u3002\u8BC1\u4E66\u4E0E\u4E3B\u57DF\u540D\u5171\u7528"}),(0,n.jsx)(z.Z,{name:["enableSSL","serverName"],children:function(i){var s=i.enableSSL,A=i.serverName;if(s)return(0,n.jsxs)(v.Z.Compact,{children:[(0,n.jsx)(U.Z,{label:"\u8BC1\u4E66",width:"lg",name:"certName",fieldProps:{labelRender:function(l){return l.value}},required:!0,rules:[{required:!0}],request:Z()(d()().mark(function w(){var l;return d()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,(0,x.dZ)();case 2:return l=F.sent,F.abrupt("return",l.data&&l.data.list.map(function(te,S){return{label:(0,n.jsx)(v.Z,{wrap:!0,children:te.domain.map(function(pe,Be){return(0,n.jsx)(y.Z,{children:pe})})},S),value:"".concat(te.domain[0])}}));case 4:case"end":return F.stop()}},w)}))},R),(0,n.jsx)(a.Z,{label:" ",children:(0,n.jsx)(ce.Z,{domain:A?[A]:[],onFinish:function(){k(R+1)}})})]})}}),(0,n.jsx)(r.Z.Group,{label:"\u8F6C\u53D1\u7C7B\u578B",name:"type",initialValue:"proxy",valueEnum:{proxy:"\u53CD\u5411\u4EE3\u7406",redirect:"\u91CD\u5B9A\u5411"}}),(0,n.jsxs)(v.Z.Compact,{children:[(0,n.jsx)(U.Z,{label:"\u76EE\u6807\u5730\u5740",tooltip:"\u76EE\u6807\u5730\u5740\u53EF\u4EE5\u4E3Aip\u3001\u57DF\u540D\u3001\u5BB9\u5668\u540D\u79F0\u3001\u5BB9\u5668ip",initialValue:"http",name:"protocol",fieldProps:{allowClear:!1},valueEnum:{http:"http",https:"https"}}),(0,n.jsx)(z.Z,{name:["containerId"],children:function(i){var s=i.containerId;return(0,n.jsx)(T.Z,{width:"lg",label:" ",name:"hostname",placeholder:"\u6307\u5B9A\u8F6C\u53D1\u76EE\u6807\u8D44\u6E90\u5730\u5740",required:!0,disabled:s,rules:[{required:!0}]})}}),(0,n.jsx)(a.Z,{label:" ",name:"containerId",children:(0,n.jsx)(b.ZP,{type:"primary",onClick:function(){E(!0)},children:"\u9009\u62E9\u5BB9\u5668"})}),(0,n.jsx)(a.Z,{label:" ",name:"containerId",children:(0,n.jsx)(b.ZP,{onClick:function(){var i,s;(i=B.current)===null||i===void 0||i.setFieldValue("containerId",""),(s=B.current)===null||s===void 0||s.setFieldValue("hostname","")},children:"\u81EA\u5B9A\u4E49"})}),(0,n.jsx)(le.Z,{open:u,width:800,onClose:function(){return E(!1)},children:(0,n.jsx)(de.Z,{onSelect:function(i){var s,A;(s=B.current)===null||s===void 0||s.setFieldValue("hostname",i.Name),(A=B.current)===null||A===void 0||A.setFieldValue("containerId",i.Id),E(!1)}})})]}),(0,n.jsx)(p.Z,{label:"\u76EE\u6807\u7AEF\u53E3",name:"port",placeholder:"\u8F6C\u53D1\u5230\u76EE\u6807\u7684\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u4E3A 80"}),(0,n.jsxs)(ae.Z,{children:[(0,n.jsx)(ee.Z,{span:12,children:(0,n.jsx)(m.Z,{label:"\u963B\u6B62\u5E38\u89C1\u6F0F\u6D1E\u5229\u7528",name:"enableBlockCommonExploits"})}),(0,n.jsx)(ee.Z,{children:(0,n.jsx)(m.Z,{width:"md",label:"\u9759\u6001\u8D44\u6E90\u7F13\u5B58",name:"enableAssetCache"})})]}),(0,n.jsx)(ae.Z,{children:(0,n.jsx)(ee.Z,{span:12,children:(0,n.jsx)(m.Z,{label:"\u652F\u6301 Websocket",name:"enableWs",initialValue:!0})})}),(0,n.jsx)(a.Z,{name:"extraNginx",label:"\u6269\u5C55 Nginx \u914D\u7F6E",tooltip:"\u81EA\u5B9A\u4E49\u6269\u5C55\u7F51\u7AD9 Vhost \u914D\u7F6E\u5185\u5BB9",children:(0,n.jsx)(c.ZP,{height:"300px",theme:"dark",style:{backgroundColor:"#282c34"}})})]})},{key:"3",label:"vhost.conf",destroyInactiveTabPane:!0,children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(oe.Z,{message:"\u8BF7\u8C28\u614E\u4FEE\u6539 vhost.conf \u914D\u7F6E\u3002\u5982\u679C\u914D\u7F6E\u4FEE\u6539\u9519\u8BEF\uFF0C\u4F1A\u5BFC\u81F4\u9762\u677F\u5BB9\u5668\u91CD\u542F\u540E\u65E0\u6CD5\u6B63\u5E38\u542F\u52A8 nginx \u670D\u52A1",showIcon:!0}),(0,n.jsx)(a.Z,{name:"vhost",label:" ",children:(0,n.jsx)(c.ZP,{height:"600px",theme:"dark",style:{backgroundColor:"#282c34"},onChange:function(){}})})]})}]})})}),he=me,ve=e(5251),se=e(83062),fe=e(38703);function Ee(g){var K,_=0;if(g.sslCrtCreatedAt&&g.sslCrtRenewAt){var W,G,J=new Date,B=new Date((W=g.sslCrtRenewAt)!==null&&W!==void 0?W:""),j=new Date((G=g.sslCrtCreatedAt)!==null&&G!==void 0?G:""),f=Math.ceil((B.getTime()-j.getTime())/86400/1e3),t=Math.ceil((J.getTime()-j.getTime())/86400/1e3);_=Math.min(Math.ceil(t/f*100),100)}return g.certName?(0,n.jsx)(se.Z,{placement:"right",title:"\u5230\u671F\u65F6\u95F4\uFF1A".concat((0,ve.NF)((K=g.sslCrtRenewAt)!==null&&K!==void 0?K:"")),children:(0,n.jsx)(y.Z,{icon:(0,n.jsxs)(v.Z,{children:[(0,n.jsx)(fe.Z,{type:"circle",percent:_,status:_==100?"exception":"active",strokeWidth:20,size:14}),(0,n.jsx)("span",{})]}),children:g.certName})}):"-"}var ie=e(80821),xe=e(37413),ge=e(67255),je=e(86548),De=e(90078),Ce=e(41482),ne=e(82346),Pe=e(96074),Ae=e(25593),Fe=e(50136);function Ze(){var g=(0,I.useRef)(),K=(0,I.useRef)(),_=(0,I.useState)({}),W=N()(_,2),G=W[0],J=W[1],B=(0,ne.useAccess)();return(0,n.jsx)(De._z,{extra:[(0,n.jsx)(Q.u,{access:"canSeeContainerDomainManage",children:(0,n.jsx)(he,{ref:K,onFinish:Z()(d()().mark(function j(){var f,t;return d()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return!((f=g.current)===null||f===void 0)&&f.reloadAndRest&&((t=g.current)===null||t===void 0||t.reloadAndRest()),C.next=3,(0,x.hZ)();case 3:case"end":return C.stop()}},j)}))},"addDomain")},"addDomain"),(0,n.jsx)(Q.u,{access:"canSeeContainerDomainManage",children:(0,n.jsx)(ie.Z,{tips:"\u91CD\u8F7D Nginx \u914D\u7F6E\u65E0\u6CD5\u751F\u6548\u65F6\uFF0C\u8BF7\u5C1D\u8BD5\u91CD\u542F DPanel \u9762\u677F\u5BB9\u5668\u3002",action:Z()(d()().mark(function j(){return d()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,x.hZ)();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},j)})),children:"\u91CD\u8F7D Nginx \u914D\u7F6E"},"nginx")},"nginx")],children:(0,n.jsx)(Ce.Z,{scroll:{x:"max-content"},rowKey:"id",actionRef:g,columns:[{title:"\u57DF\u540D",dataIndex:"serverName",render:function(f,t,O,C,o){var u=[];return t.serverName&&u.push(t.setting.enableSSL?"https://"+t.serverName:"http://"+t.serverName),t.setting.serverNameAlias&&t.setting.serverNameAlias.map(function(E){u.push(t.setting.enableSSL?"https://"+E:"http://"+E)}),(0,n.jsx)(xe.Z,{domain:u,domainTitle:"".concat(t.serverName," (").concat(u.length,")")})}},{title:"\u76EE\u6807",search:!1,render:function(f,t,O,C,o){return"".concat(t.setting.serverAddress,":").concat(t.setting.port)}},{title:"\u8BC1\u4E66",search:!0,dataIndex:"certName",width:300,valueEnum:G,render:function(f,t,O,C,o){return t.setting.enableSSL?(0,n.jsx)(Ee,{certName:t.setting.certName,sslCrtRenewAt:t.setting.sslCrtRenewAt,sslCrtCreatedAt:t.setting.sslCrtCreatedAt}):"-"}},{title:"\u521B\u5EFA\u65F6\u95F4",search:!1,width:180,ellipsis:!0,dataIndex:"createdAt",render:function(f,t,O,C,o){return new Date(t.createdAt).toLocaleString()}},{title:"\u64CD\u4F5C",key:"option",width:50,search:!1,fixed:"right",hidden:!B.canSeeContainerDomainManage,render:function(f,t,O,C){return(0,n.jsx)(v.Z,{split:(0,n.jsx)(Pe.Z,{type:"vertical"}),children:(0,n.jsx)(Ae.Z.Link,{onClick:function(){var u;return(u=K.current)===null||u===void 0||u.showEdit(t.id),!0},children:(0,n.jsx)(se.Z,{title:"\u7F16\u8F91\u57DF\u540D",children:(0,n.jsx)(je.Z,{})})},"edit")})}}],request:function(){var j=Z()(d()().mark(function f(t,O,C){var o,u,E;return d()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,(0,x.i7)({serverName:t.serverName,certName:t.certName});case 2:return o=M.sent,M.next=5,(0,x.dZ)();case 5:return u=M.sent,E={},o.data.list.map(function(R){R.setting.certName&&typeof R.setting.certName=="string"&&(E[R.setting.certName]=R.setting.certName)}),J(E),M.abrupt("return",{data:o.data.list&&o.data.list.map(function(R){if(u&&u.data.list){var k,P;R.setting.sslCrtCreatedAt=(k=u.data.list.find(function(i){return i.domain[0]==R.setting.certName}))===null||k===void 0?void 0:k.createdAt,R.setting.sslCrtRenewAt=(P=u.data.list.find(function(i){return i.domain[0]==R.setting.certName}))===null||P===void 0?void 0:P.renewAt}return R}),success:!0,total:o.data.list.length});case 10:case"end":return M.stop()}},f)}));return function(f,t,O){return j.apply(this,arguments)}}(),rowSelection:B.canSeeContainerDomainManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0}:void 0,tableAlertOptionRender:function(f){var t=f.selectedRowKeys,O=f.selectedRows;return(0,n.jsx)(v.Z,{size:16,children:(0,n.jsx)(ie.Z,{danger:!0,confirm:"notification.confirm.title",type:"primary",action:Z()(d()().mark(function C(){var o;return d()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,(0,x.dj)({id:t});case 2:return o=E.sent,E.next=5,(0,x.hZ)();case 5:return E.abrupt("return",o);case 6:case"end":return E.stop()}},C)})),onSuccess:function(){var o,u;return!((o=g.current)===null||o===void 0)&&o.reloadAndRest&&((u=g.current)===null||u===void 0||u.reloadAndRest()),!0},onError:function(){var o,u;return!((o=g.current)===null||o===void 0)&&o.reset&&((u=g.current)===null||u===void 0||u.reset()),!0},children:"\u6279\u91CF\u5220\u9664"})})},tableExtraRender:function(){return(0,n.jsx)(Fe.Z,{mode:"horizontal",selectedKeys:["domain"],items:[{label:(0,n.jsx)(ne.Link,{to:"/app/domain/list",replace:!0,children:"\u57DF\u540D\u7BA1\u7406"}),key:"domain"},{label:(0,n.jsx)(ne.Link,{to:"/app/domain/cert",replace:!0,children:"\u8BC1\u4E66\u7BA1\u7406"}),key:"cert"}]})},pagination:(0,ge.O)()})})}}}]);
