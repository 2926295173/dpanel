"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2958],{80821:function(re,B,r){r.d(B,{Z:function(){return le}});var M=r(97857),i=r.n(M),D=r(5574),m=r.n(D),T=r(24963),S=r(86738),H=r(28036),_=r(83062),ee=r(67294),G=r(85893);function le(u){var ne=(0,ee.useState)(!1),J=m()(ne,2),Y=J[0],W=J[1],X=(0,ee.useContext)(T.Z),o=X.lang,te=X.message,P=function(){W(!0);var Q=u.action();Q instanceof Promise?Q.then(function($){if(W(!1),$){typeof u.onSuccess=="function"&&u.onSuccess($);var V="";u.messageSuccess?typeof u.messageSuccess=="function"?V=u.messageSuccess($):V=u.messageSuccess.indexOf("notification.")==0?o(u.messageSuccess):u.messageSuccess:V=o("notification.finish"),u.asynced?te.info(V):te.success(V)}}).catch(function($){W(!1),typeof u.onError=="function"&&u.onError($)}):W(!1)};return u.confirm?(0,G.jsx)(S.Z,i()(i()({style:{width:500},title:u.confirmTitle?u.confirmTitle:o("notification.title.tip"),description:typeof u.confirm=="string"&&u.confirm.indexOf("notification.")==0?o(u.confirm):u.confirm,onConfirm:P,okText:"Yes",cancelText:"No",onOpenChange:u.confirmOnOpenChange},u.confirmProps),{},{children:(0,G.jsx)(H.ZP,{block:u.block,disabled:u.disabled,icon:!u.children&&Y?void 0:u.icon,loading:Y,danger:u.danger,type:u.type,children:u.children})})):(0,G.jsx)(_.Z,{title:u.tips,children:(0,G.jsx)(H.ZP,{block:u.block,style:u.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:u.disabled,icon:!u.children&&Y?void 0:u.icon,loading:Y,onClick:P,danger:u.danger,type:u.type,children:u.children})})}},3616:function(re,B,r){r.d(B,{Ed:function(){return m},FK:function(){return i},R_:function(){return M},ob:function(){return D}});var M=window.innerWidth<=1024?"90vw":"65vw",i="90vw",D="60vw",m="50vh"},24963:function(re,B,r){var M=r(67294),i=(0,M.createContext)({});B.Z=i},76718:function(re,B,r){r.r(B),r.d(B,{default:function(){return We}});var M=r(15009),i=r.n(M),D=r(99289),m=r.n(D),T=r(80821),S=r(68602),H=r(67255),_=r(36693),ee=r(43425),G=r(88641),le=r(90078),u=r(41482),ne=r(66309),J=r(42075),Y=r(96074),W=r(25593),X=r(83062),o=r(67294),te=r(5574),P=r.n(te),ce=r(28036),Q=r(184),$=r(5966),V=r(64317),he=r(52688),ge=r(90672),ae=r(3616),t=r(85893),Re=(0,o.forwardRef)(function(b,U){var I=(0,o.useState)(!1),x=P()(I,2),Z=x[0],p=x[1],f=(0,o.useRef)();(0,o.useImperativeHandle)(U,function(){return{edit:function(n){var e;(e=f.current)===null||e===void 0||e.setFieldsValue({username:n.username}),p(!0)},show:function(){var n;(n=f.current)===null||n===void 0||n.resetFields(),p(!0)}}}),o.useEffect(function(){if(Z){var l;(l=f.current)===null||l===void 0||l.resetFields()}},[Z,f]);var a=function(){var l=m()(i()().mark(function n(){var e,c;return i()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.prev=0,v.next=3,(e=f.current)===null||e===void 0?void 0:e.validateFields();case 3:return c=v.sent,v.next=6,b.onSubmit({username:c.username,userRole:c.userRole||"member",email:c.email,userStatus:c.userStatus||"enable",securityPassword:c.securityPassword||!0});case 6:return v.abrupt("return",!0);case 9:return v.prev=9,v.t0=v.catch(0),v.abrupt("return",!1);case 12:case"end":return v.stop()}},n,null,[[0,9]])}));return function(){return l.apply(this,arguments)}}();return(0,t.jsxs)(Q.a,{name:"create",title:"\u6DFB\u52A0\u7528\u6237",open:Z,onOpenChange:function(n){if(!n){var e;(e=f.current)===null||e===void 0||e.resetFields()}p(n)},drawerProps:{forceRender:!0,width:ae.R_},formRef:f,trigger:(0,t.jsx)(ce.ZP,{type:"primary",children:"\u6DFB\u52A0\u7528\u6237"}),onFinish:m()(i()().mark(function l(){return i()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},l)})),children:[(0,t.jsx)($.Z,{label:"\u7528\u6237\u540D",name:"username",required:!0,rules:[{required:!0}]}),(0,t.jsx)($.Z,{label:"\u90AE\u7BB1",name:"email",placeholder:"",rules:[{type:"email",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740"}]}),(0,t.jsx)(V.Z,{label:"\u89D2\u8272",name:"userRole",tooltip:"\u7BA1\u7406\u5458\u9ED8\u8BA4\u5177\u6709\u9664\u3010\u7CFB\u7EDF\u3011\u5916\u7684\u6240\u6709\u6743\u9650\uFF0C\u64CD\u4F5C\u5458\u9ED8\u8BA4\u6743\u9650\u4E3A\u7A7A",required:!0,fieldProps:{defaultValue:"member"},options:[{label:"\u7BA1\u7406\u5458",value:"manager"},{label:"\u64CD\u4F5C\u5458",value:"member"}]}),(0,t.jsx)(V.Z,{label:"\u72B6\u6001",name:"userStatus",fieldProps:{defaultValue:"enable"},required:!0,options:[{label:"\u542F\u7528",value:"enable"},{label:"\u7981\u7528",value:"disable"}]}),(0,t.jsx)(he.Z,{label:"\u5F3A\u5BC6\u7801",name:"securityPassword",fieldProps:{defaultChecked:!0}}),(0,t.jsx)(ge.Z,{label:"\u5907\u6CE8",name:"remark",placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",fieldProps:{rows:4}})]})}),Se=Re,pe=r(19632),oe=r.n(pe),je=r(38345),be=r(63434),Ce=r(71230),Ee=r(15746),Pe=r(84567),F=r(83403),ye=r(85265),we=r(82346),xe=(0,o.forwardRef)(function(b,U){(0,o.useImperativeHandle)(U,function(){return{show:function(R){return m()(i()().mark(function C(){var y,E,w,K,me,z,ve;return i()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return w=R.username,K=R.uri,(y=s.current)===null||y===void 0||y.resetFields(),p(w),n(K),L.next=6,(0,S.q4)({username:w});case 6:if(me=L.sent,z=(E=me.data)===null||E===void 0||(E=E.permissions)===null||E===void 0?void 0:E[K],!z){L.next=16;break}return L.next=11,(0,we.request)(z.uri,{method:"POST"});case 11:ve=L.sent,N(ve.data.list.filter(function(ie){return z.value.includes(ie[z.key])}).map(function(ie){return{id:ie[z.key],name:ie[z.showKey]}})),j(z),L.next=17;break;case 16:N([]);case 17:v(!0);case 18:case"end":return L.stop()}},C)}))()}}});var I=(0,o.useState)(""),x=P()(I,2),Z=x[0],p=x[1],f=(0,o.useState)(""),a=P()(f,2),l=a[0],n=a[1],e=(0,o.useState)(!1),c=P()(e,2),d=c[0],v=c[1],s=(0,o.useRef)(),A=(0,o.useRef)(),q=(0,o.useState)([]),k=P()(q,2),se=k[0],N=k[1],ue=(0,o.useState)(),O=P()(ue,2),h=O[0],j=O[1];return(0,t.jsx)(ye.Z,{title:"\u6743\u9650\u8BBE\u7F6E",open:d,width:ae.R_,destroyOnClose:!0,onClose:function(){var R;(R=s.current)===null||R===void 0||R.resetFields(),v(!1)},children:(0,t.jsx)(u.Z,{actionRef:A,search:!1,toolBarRender:!1,scroll:{x:"max-content"},columns:[{key:"name",title:"\u540D\u79F0",dataIndex:"name"}],rowKey:"id",dataSource:se,rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},tableAlertOptionRender:function(R){var C=R.selectedRows;return(0,t.jsx)(J.Z,{size:16,wrap:!0,children:(0,t.jsx)(T.Z,{danger:!0,type:"primary",action:m()(i()().mark(function y(){return i()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,(0,S.V9)({username:Z,permission:{uri:l,key:"-",value:C.map(function(K){return K.id}),showKey:"-"}});case 2:return w.abrupt("return",!0);case 3:case"end":return w.stop()}},y)})),onSuccess:function(){return v(!1),!0},confirm:"notification.confirm.title",children:"\u6279\u91CF\u5220\u9664"})})},pagination:!1})})}),de=xe,Oe=r(24963),De=r(34646),Ze=r(60433),fe=r(25449),Ae=r(31199),Fe=(0,o.forwardRef)(function(b,U){(0,o.useImperativeHandle)(U,function(){return{show:function(d){return m()(i()().mark(function v(){var s,A;return i()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:A=d.formData,(s=e.current)===null||s===void 0||s.resetFields(),n(A),p(!0);case 4:case"end":return k.stop()}},v)}))()}}});var I=(0,o.useState)(!1),x=P()(I,2),Z=x[0],p=x[1],f=(0,o.useState)({}),a=P()(f,2),l=a[0],n=a[1],e=(0,o.useRef)();return(0,t.jsxs)(Q.a,{title:"\u6743\u9650\u8BBE\u7F6E",open:Z,width:800,formRef:e,onFinish:function(){var c=m()(i()().mark(function d(v){return i()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return b.onChange(v),p(!1),A.abrupt("return",!0);case 3:case"end":return A.stop()}},d)}));return function(d){return c.apply(this,arguments)}}(),initialValues:l,drawerProps:{width:ae.R_,destroyOnClose:!0,onClose:function(){var d;(d=e.current)===null||d===void 0||d.resetFields(),p(!1)}},children:[(0,t.jsx)(Ae.Z,{name:"limit",label:"\u5BB9\u5668\u6570\u91CF",min:0}),(0,t.jsx)($.Z,{name:"name",hidden:!0})]})}),Ie=Fe,Be=(0,o.forwardRef)(function(b,U){(0,o.useImperativeHandle)(U,function(){return{edit:function(h){return m()(i()().mark(function j(){var g,R,C;return i()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return(g=a.current)===null||g===void 0||g.setFieldValue("username",h),E.next=3,(0,S.J5)({username:h});case 3:R=E.sent,R.data.resource?(C={},R.data.resource.forEach(function(w){C[w.name]=w}),ue(C)):ue({}),R.data.menus?(R.data.menus.map(function(w){var K;(K=a.current)===null||K===void 0||K.setFieldValue(["permission",w],!0)}),q([].concat(oe()(R.data.menus||[]),oe()(F.Io)))):q(F.Io),f(!0);case 7:case"end":return E.stop()}},j)}))()}}});var I={canSeeContainerList:F.W6.CONTAINER,canSeeImageRegistry:F.W6.REGISTRY,canSeeComposeList:F.W6.COMPOSE,canSeeSystemAppstore:F.W6.APPSTORE,canSeeSystemEnv:F.W6.DOCKER_ENV},x=(0,o.useState)(!1),Z=P()(x,2),p=Z[0],f=Z[1],a=(0,o.useRef)(),l=(0,o.useContext)(Oe.Z),n=l.message,e=l.lang,c=(0,o.useRef)(),d=(0,o.useRef)(),v=(0,o.useState)([]),s=P()(v,2),A=s[0],q=s[1],k=(0,o.useState)({}),se=P()(k,2),N=se[0],ue=se[1];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(Q.a,{title:"\u6743\u9650\u8BBE\u7F6E",open:p,onOpenChange:function(h){var j;!h&&((j=a.current)===null||j===void 0||j.resetFields()),f(h)},drawerProps:{forceRender:!0,width:ae.R_},layout:"inline",formRef:a,onValuesChange:function(h,j){var g=Object.keys(h.permission)[0];if(h.permission[g]===!1){for(var R in j.permission)if(R.startsWith(g)){var C;(C=a.current)===null||C===void 0||C.setFieldValue(["permission",R],!1)}}q(Object.keys(j.permission).filter(function(y){return j.permission[y]}))},onFinish:function(){var O=m()(i()().mark(function h(j){var g;return i()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return g=j.permission&&Object.keys(j.permission).filter(function(y){return j.permission[y]&&!F.Io.includes(y)}),g.push.apply(g,oe()(F.Io.filter(function(y){return g.some(function(E){return E.startsWith(y)})}))),C.next=4,(0,S.SS)({username:j.username,menuPermissionNames:g,resources:Object.values(N)});case 4:return C.abrupt("return",!0);case 5:case"end":return C.stop()}},h)}));return function(h){return O.apply(this,arguments)}}(),children:[(0,t.jsx)(de,{ref:c}),(0,t.jsx)($.Z,{name:"username",hidden:!0}),F.d0.map(function(O){return(0,t.jsxs)(je.Z,{headerBordered:!0,ghost:!0,bodyStyle:{paddingTop:10,paddingBottom:20},title:(0,t.jsx)(De.Z,{}),subTitle:e("system.user.permissions.".concat(O.group)),children:[(0,t.jsx)(be.Z,{name:["permission",O.group],valuePropName:"checked",initialValue:!0,hidden:!0}),(0,t.jsx)(Ce.Z,{gutter:[16,16],children:O.permissions.map(function(h){return(0,t.jsx)(Ee.Z,{span:6,children:(0,t.jsxs)(fe.Z,{children:[(0,t.jsx)(fe.Z,{noStyle:!0,name:["permission",h],valuePropName:"checked",children:(0,t.jsx)(Pe.Z,{disabled:!A.includes(h.substring(0,h.search(/[A-Z][^A-Z]*$/))),children:e("system.user.permissions.".concat(h))})}),I[h]&&(0,t.jsx)(X.Z,{title:"\u67E5\u770B\u6570\u636E\u6743\u9650",children:(0,t.jsx)(W.Z.Link,{onClick:function(){var g,R;(g=c.current)===null||g===void 0||g.show({username:((R=a.current)===null||R===void 0?void 0:R.getFieldValue("username"))||"",uri:I[h]||""})},children:(0,t.jsx)(Ze.Z,{})})}),["canSeeContainerListManageCreate"].includes(h)&&(0,t.jsx)(X.Z,{title:"\u914D\u7F6E\u8D44\u6E90\u6743\u9650",children:(0,t.jsx)(W.Z.Link,{onClick:function(){var g;(g=d.current)===null||g===void 0||g.show({formData:N[h]||{name:h,limit:0}})},children:(0,t.jsx)(ee.Z,{})})})]})},h)})})]},O.group)})]}),(0,t.jsx)(de,{ref:c}),(0,t.jsx)(Ie,{onChange:function(h){var j;N[h.name]=h,(0,S.SS)({username:((j=a.current)===null||j===void 0?void 0:j.getFieldValue("username"))||"",menuPermissionNames:A,resources:Object.values(N)})},resourcePermissionsData:N,ref:d})]})}),Te=Be,$e=r(5251),Me=r(87662);function We(){var b=(0,o.useRef)(),U=(0,o.useRef)(),I=(0,o.useRef)(),x=function(){var p=m()(i()().mark(function f(a){return i()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:(0,S.sI)(a);case 1:case"end":return n.stop()}},f)}));return function(a){return p.apply(this,arguments)}}(),Z=function(){var p=m()(i()().mark(function f(a){var l,n,e,c,d;return i()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,S.mX)(a);case 2:if(e=s.sent,a.userRole==="manager"&&(0,S.SS)({username:a.username,menuPermissionNames:F.Wy}),a.userStatus==="disable"&&(0,S.az)({username:a.username,status:1}),!a.email){s.next=10;break}return s.next=8,(0,Me.pe)({groupName:"setting",name:"emailServer"});case 8:d=s.sent,(c=d.data)!==null&&c!==void 0&&(c=c.status)!==null&&c!==void 0&&c.includes("register")&&x({username:a.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(e.data.token)});case 10:return!((l=b.current)===null||l===void 0)&&l.reloadAndRest&&((n=b.current)===null||n===void 0||n.reloadAndRest()),s.abrupt("return",!0);case 12:case"end":return s.stop()}},f)}));return function(a){return p.apply(this,arguments)}}();return(0,t.jsxs)(le._z,{header:{extra:[(0,t.jsx)(Se,{ref:U,onSubmit:Z},"invite-user")]},children:[(0,t.jsx)(Te,{ref:I}),(0,t.jsx)(u.Z,{scroll:{x:"max-content"},rowKey:"username",columns:[{title:"\u7528\u6237\u540D",ellipsis:!0,dataIndex:"username"},{title:"\u90AE\u7BB1",ellipsis:!0,dataIndex:"email"},{title:"\u89D2\u8272",ellipsis:!0,width:100,dataIndex:"userRole",valueEnum:{manager:{text:"\u7BA1\u7406\u5458",status:"manager"},member:{text:"\u64CD\u4F5C\u5458",status:"member"}},render:function(f,a){return(0,t.jsx)(ne.Z,{color:a.userRole==="member"?"gold":"blue",children:a.userRole==="member"?"\u64CD\u4F5C\u5458":"\u7BA1\u7406\u5458"})}},{title:"\u6CE8\u518C\u65F6\u95F4",ellipsis:!0,render:function(f,a,l,n){return(0,t.jsx)("div",{children:(0,$e.ZM)(a.registerAt*1e3)},a.username)},search:!1},{title:"\u5907\u6CE8",ellipsis:!0,dataIndex:"remark",search:!1},{title:"\u72B6\u6001",width:100,dataIndex:"status",valueEnum:{1:{text:"\u7981\u7528",status:"error"},2:{text:"\u6B63\u5E38",status:"success"}},search:!1,render:function(f,a){return(0,t.jsx)(ne.Z,{color:a.status===2?"green":"red",children:a.status===2?"\u6B63\u5E38":"\u7981\u7528"})}},{title:"\u64CD\u4F5C",width:100,search:!1,fixed:"right",render:function(f,a,l){return(0,t.jsxs)(J.Z,{split:(0,t.jsx)(Y.Z,{type:"vertical"}),children:[(0,t.jsx)(W.Z.Link,{copyable:{tooltips:"\u590D\u5236\u91CD\u7F6E\u94FE\u63A5",icon:[(0,t.jsx)(_.Z,{})],text:function(){var n=m()(i()().mark(function c(){var d;return i()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,S.u1)({username:a.username});case 2:return d=s.sent,s.abrupt("return","".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(d.data.token));case 4:case"end":return s.stop()}},c)}));function e(){return n.apply(this,arguments)}return e}()},style:{color:"inherit"}},"copy-"+l),(0,t.jsx)(X.Z,{title:"\u7528\u6237\u6743\u9650\u8BBE\u7F6E",children:(0,t.jsx)(W.Z.Link,{onClick:function(){var e;(e=I.current)===null||e===void 0||e.edit(a.username)},children:(0,t.jsx)(ee.Z,{})})}),(0,t.jsx)(T.Z,{ghost:!0,type:"link",tips:"\u53D1\u9001\u91CD\u7F6E\u94FE\u63A5\u5230\u90AE\u7BB1",icon:(0,t.jsx)(G.Z,{}),action:m()(i()().mark(function n(){var e;return i()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,(0,S.u1)({username:a.username});case 2:return e=d.sent,d.abrupt("return",x({username:a.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(e.data.token)}));case 4:case"end":return d.stop()}},n)}))})]})}}],request:function(){var p=m()(i()().mark(function f(a){var l;return i()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,S.lE)();case 2:return l=e.sent,e.abrupt("return",{data:l.data.list,success:!0,total:l.data.list.length});case 4:case"end":return e.stop()}},f)}));return function(f){return p.apply(this,arguments)}}(),rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},actionRef:b,tableAlertOptionRender:function(f){var a=f.selectedRowKeys;return(0,t.jsxs)(J.Z,{size:16,children:[(0,t.jsx)(T.Z,{action:m()(i()().mark(function l(){var n,e,c,d;return i()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:n=0,e=a;case 1:if(!(n<e.length)){s.next=9;break}return c=e[n],s.next=5,(0,S.az)({username:c,status:2});case 5:d=s.sent;case 6:n++,s.next=1;break;case 9:return s.abrupt("return",!0);case 10:case"end":return s.stop()}},l)})),onSuccess:function(){var n,e;return!((n=b.current)===null||n===void 0)&&n.reloadAndRest&&((e=b.current)===null||e===void 0||e.reloadAndRest()),!0},onError:function(){var n,e;return!((n=b.current)===null||n===void 0)&&n.reset&&((e=b.current)===null||e===void 0||e.reset()),!0},children:"\u542F\u7528"},"batchEnable"),(0,t.jsx)(T.Z,{danger:!0,action:m()(i()().mark(function l(){var n,e,c,d;return i()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:n=0,e=a;case 1:if(!(n<e.length)){s.next=9;break}return c=e[n],s.next=5,(0,S.az)({username:c,status:1});case 5:d=s.sent;case 6:n++,s.next=1;break;case 9:return s.abrupt("return",!0);case 10:case"end":return s.stop()}},l)})),onSuccess:function(){var n,e;return!((n=b.current)===null||n===void 0)&&n.reloadAndRest&&((e=b.current)===null||e===void 0||e.reloadAndRest()),!0},onError:function(){var n,e;return!((n=b.current)===null||n===void 0)&&n.reset&&((e=b.current)===null||e===void 0||e.reset()),!0},children:"\u7981\u7528"},"batchDisable")]})},pagination:(0,H.O)()})]})}},67255:function(re,B,r){r.d(B,{O:function(){return M},j:function(){return i}});function M(D){var m=localStorage.getItem("dpanel-pagesize");return m=="all"?!1:{defaultCurrent:D==null?void 0:D.page,showSizeChanger:!0,defaultPageSize:parseInt(m!=null?m:"20"),onChange:function(S,H){localStorage.setItem("dpanel-page-"+location.pathname.split("/").slice(-2).join("-"),"".concat(S))}}}function i(D){var m="dpanel-table-column-".concat(D),T={};if(localStorage.getItem(m)){var S;T=JSON.parse((S=localStorage.getItem(m))!==null&&S!==void 0?S:"{}")}return{defaultValue:T,onChange:function(_){localStorage.setItem("dpanel-table-column-".concat(D),JSON.stringify(_))}}}}}]);
