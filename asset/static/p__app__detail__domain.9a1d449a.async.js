"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3146],{80821:function(te,T,n){n.d(T,{Z:function(){return z}});var W=n(5574),i=n.n(W),A=n(93246),h=n(54006),P=n(31418),y=n(86738),C=n(14726),U=n(83062),V=n(67294),w=n(85893);function z(d){var k=(0,V.useState)(!1),H=i()(k,2),I=H[0],G=H[1],O=P.Z.useApp(),X=(0,h.useIntl)(),$=function(){G(!0),d.action().then(function(b){if(G(!1),typeof d.onSuccess=="function"&&d.onSuccess(b),d.messageSuccess){var j="";typeof d.messageSuccess=="function"?j=d.messageSuccess(b):j=d.messageSuccess,j.indexOf(".")>-1&&(j=X.formatMessage({id:j})),d.asynced?(0,A.Rk)(O,j):(0,A.$h)(O,j)}}).catch(function(b){G(!1),typeof d.onError=="function"&&d.onError(b)})};return d.confirm?(0,w.jsx)(y.Z,{style:{width:500},title:"\u63D0\u793A",description:d.confirm,onConfirm:$,okText:"Yes",cancelText:"No",children:(0,w.jsx)(C.ZP,{disabled:d.disabled,icon:d.icon,loading:I,danger:d.danger,type:d.type,children:d.children})}):(0,w.jsx)(U.Z,{title:d.tips,children:(0,w.jsx)(C.ZP,{disabled:d.disabled,icon:d.icon,loading:I,onClick:$,danger:d.danger,type:d.type,children:d.children})})}},88041:function(te,T,n){n.r(T),n.d(T,{default:function(){return je}});var W=n(15009),i=n.n(W),A=n(99289),h=n.n(A),P=n(5574),y=n.n(P),C=n(54006);function U(l){return V.apply(this,arguments)}function V(){return V=h()(i()().mark(function l(o){return i()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.request)("/api/app/site/get-domain-list",{method:"POST",data:o}));case 1:case"end":return t.stop()}},l)})),V.apply(this,arguments)}function w(l){return z.apply(this,arguments)}function z(){return z=h()(i()().mark(function l(o){return i()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.request)("/api/app/site/create-domain",{method:"POST",data:o}));case 1:case"end":return t.stop()}},l)})),z.apply(this,arguments)}function d(l){return k.apply(this,arguments)}function k(){return k=h()(i()().mark(function l(o){return i()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.request)("/api/app/site/update-domain",{method:"POST",data:o}));case 1:case"end":return t.stop()}},l)})),k.apply(this,arguments)}function H(l){return I.apply(this,arguments)}function I(){return I=h()(i()().mark(function l(o){return i()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.request)("/api/app/site/delete-domain",{method:"POST",data:o}));case 1:case"end":return t.stop()}},l)})),I.apply(this,arguments)}function G(l){return O.apply(this,arguments)}function O(){return O=h()(i()().mark(function l(o){return i()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.request)("/api/app/site/get-domain-detail",{method:"POST",data:o}));case 1:case"end":return t.stop()}},l)})),O.apply(this,arguments)}function X(l){return $.apply(this,arguments)}function $(){return $=h()(i()().mark(function l(o){return i()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.request)("/api/app/site/apply-domain-cert",{method:"POST",data:o}));case 1:case"end":return t.stop()}},l)})),$.apply(this,arguments)}function ue(){return b.apply(this,arguments)}function b(){return b=h()(i()().mark(function l(){return i()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,C.request)("/api//app/site/restart-nginx",{method:"POST"}));case 1:case"end":return p.stop()}},l)})),b.apply(this,arguments)}var j=n(93246),re=n(184),ae=n(5966),J=n(62370),N=n(52688),Q=n(95089),de=n(31418),q=n(42075),_=n(66309),ce=n(34041),ee=n(71230),K=n(15746),me=n(25449),D=n(67294),e=n(85893),ne="",ve=(0,D.forwardRef)(function(l,o){var p=(0,C.useModel)("subscriber"),t=(0,D.useRef)(),x=(0,D.useState)(),m=y()(x,2),a=m[0],g=m[1],E=(0,D.useState)(!1),u=y()(E,2),c=u[0],B=u[1],v=de.Z.useApp();return p.addDataHandler("composeUp",function(){var r=p.getDataByType("composeUp");if(r){var f;r.map(function(s){ne+=s.data}),(f=t.current)===null||f===void 0||f.setFieldValue("console",ne)}}),(0,D.useImperativeHandle)(o,function(){return{apply:function(f){var s,F;if(f.length==0)return(0,j.YZ)(v,"\u8BF7\u5148\u5728\u57DF\u540D\u5217\u8868\u52FE\u9009\u5F85\u7533\u8BF7\u7684\u57DF\u540D\uFF0C\u591A\u4E2A\u57DF\u540D\u53EF\u4EE5\u5171\u7528\u540C\u4E00\u5F20\u8BC1\u4E66"),!1;(s=t.current)===null||s===void 0||s.setFieldsValue({email:(F=localStorage.getItem("email"))!==null&&F!==void 0?F:"",console:""}),ne="",g(f),B(!0)}}}),(0,e.jsx)(re.a,{drawerProps:{forceRender:!0},formRef:t,open:c,onOpenChange:function(f){B(f)},onFinish:function(){var r=h()(i()().mark(function f(s){var F,L;return i()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return localStorage.setItem("email",s.email),R.next=3,X({id:a?a.map(function(Z){return Z.id}):[],email:s.email,certServer:s.certServer,autoUpgrade:s.autoUpgrade,renew:s.renew,debug:s.debug});case 3:return L=R.sent,L.data=="success"&&setTimeout(h()(i()().mark(function Z(){var Y;return i()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,ue();case 2:Y=M.sent;case 3:case"end":return M.stop()}},Z)})),5e3),(F=t.current)===null||F===void 0||F.resetFields(),l.onFinish&&l.onFinish(),R.abrupt("return",!0);case 8:case"end":return R.stop()}},f)}));return function(f){return r.apply(this,arguments)}}(),children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(me.Z,{label:"\u57DF\u540D\u5217\u8868",name:"serverName",children:(0,e.jsx)(q.Z,{children:a==null?void 0:a.map(function(r){return(0,e.jsx)(_.Z,{children:r.serverName},r.id)})})}),(0,e.jsx)(ae.Z,{label:"\u90AE\u7BB1",name:"email",placeholder:"\u8BF7\u8F93\u5165\u7533\u8BF7\u7684\u90AE\u7BB1"}),(0,e.jsx)(J.Z,{label:"\u7B7E\u53D1\u670D\u52A1",name:"certServer",initialValue:"letsencrypt",children:(0,e.jsx)(ce.Z,{options:[{value:"letsencrypt",label:"Let's Encrypt"},{value:"zerossl",label:"ZeroSSL"}]})}),(0,e.jsxs)(ee.Z,{children:[(0,e.jsx)(K.Z,{span:8,children:(0,e.jsx)(N.Z,{label:"\u81EA\u52A8\u7EED\u7B7E",name:"autoUpgrade",initialValue:!0})}),(0,e.jsx)(K.Z,{span:8,children:(0,e.jsx)(N.Z,{tooltip:"\u901A\u5E38\u60C5\u51B5\u7CFB\u7EDF\u4F1A\u81EA\u52A8\u7EED\u7B7E\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u5F00\u542F\u6B64\u9879\u5F3A\u5236\u7EED\u7B7E",label:"\u7ACB\u5373\u7EED\u7B7E",name:"renew",initialValue:!1})}),(0,e.jsx)(K.Z,{span:8,children:(0,e.jsx)(N.Z,{tooltip:"\u663E\u793A\u5B8C\u6574\u7684\u9519\u8BEF\u4FE1\u606F\uFF0C\u65B9\u4FBF\u6392\u67E5",label:"Debug",name:"debug",initialValue:!1})})]}),(0,e.jsx)(J.Z,{label:"\u63A7\u5236\u53F0\u8F93\u51FA",name:"console",children:(0,e.jsx)(Q.ZP,{theme:"dark",style:{marginTop:"10px",backgroundColor:"#282c34"},height:"350px",extensions:[Q.tk.lineWrapping]})})]})})}),he=ve,fe=n(31199),pe=n(50335),le=n(90672),se=n(14726),Ee=n(92398),ge=n(40056),Fe=(0,D.forwardRef)(function(l,o){var p=(0,D.useState)(!1),t=y()(p,2),x=t[0],m=t[1],a=(0,D.useRef)(),g=(0,D.useState)(),E=y()(g,2),u=E[0],c=E[1];return(0,D.useImperativeHandle)(o,function(){return{showEdit:function(v){G({id:v.id}).then(function(r){var f;if((f=a.current)===null||f===void 0||f.setFieldsValue({serverName:v.serverName,port:v.setting.port,enableBlockCommonExploits:v.setting.enableBlockCommonExploits,enableAssetCache:v.setting.enableAssetCache,enableWs:v.setting.enableWs,extraNginx:v.setting.extraNginx,vhost:r.data.vhost,sslCrt:r.data.domain.setting.sslCrt,sslKey:r.data.domain.setting.sslKey}),v.setting.sslCrtRenewTime){var s;(s=a.current)===null||s===void 0||s.setFieldValue("sslCrtRenewTime",r.data.domain.setting.sslCrtRenewTime)}c(r.data),m(!0)})}}}),(0,e.jsx)(re.a,{drawerProps:{forceRender:!0},open:x,onOpenChange:function(v){m(v)},title:"\u57DF\u540D\u7BA1\u7406",trigger:(0,e.jsx)(se.ZP,{onClick:function(){var v;c(void 0),(v=a.current)===null||v===void 0||v.resetFields()},type:"primary",children:"\u7ED1\u5B9A\u57DF\u540D"}),formRef:a,onFinish:function(){var B=h()(i()().mark(function v(r){var f,s,F,L,ie,R,Z,Y,oe;return i()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(!(u&&(u==null?void 0:u.domain.id)>0)){S.next=6;break}return S.next=3,d({id:u==null?void 0:u.domain.id,port:r.port,enableBlockCommonExploits:r.enableBlockCommonExploits,enableAssetCache:r.enableAssetCache,enableWs:r.enableWs,extraNginx:r.extraNginx,sslCrt:(s=r.sslCrt)!==null&&s!==void 0?s:"",sslKey:(F=r.sslKey)!==null&&F!==void 0?F:"",sslCrtRenewTime:(L=r.sslCrtRenewTime)!==null&&L!==void 0?L:""});case 3:ie=S.sent,S.next=9;break;case 6:return S.next=8,w({containerId:l.containerId,serverName:r.serverName,port:r.port,enableBlockCommonExploits:r.enableBlockCommonExploits,enableAssetCache:r.enableAssetCache,enableWs:r.enableWs,extraNginx:r.extraNginx,sslCrt:(R=r.sslCrt)!==null&&R!==void 0?R:"",sslKey:(Z=r.sslKey)!==null&&Z!==void 0?Z:"",sslCrtRenewTime:(Y=r.sslCrtRenewTime)!==null&&Y!==void 0?Y:""});case 8:oe=S.sent;case 9:return(f=a.current)===null||f===void 0||f.resetFields(),l.onFinish(),S.abrupt("return",!0);case 12:case"end":return S.stop()}},v)}));return function(v){return B.apply(this,arguments)}}(),children:(0,e.jsx)(Ee.Z,{items:[{key:"1",label:"\u914D\u7F6E\u57DF\u540D",children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ae.Z,{width:"lg",label:"\u57DF\u540D",tooltip:"\u6307\u5B9A\u8981\u7ED1\u5B9A\u7684\u57DF\u540D,\u5E76\u5C06\u8BE5\u57DF\u540D\u89E3\u6790\u5230\u5F53\u524D\u670D\u52A1\u5668",name:"serverName",placeholder:"\u8BF7\u6307\u5B9A\u8981\u7ED1\u5B9A\u7684\u57DF\u540D\uFF0C\u4F8B\u5982 www.explame.com, test.explame.com",rules:[{required:!0}],disabled:u&&u.domain.id>0}),(0,e.jsx)(fe.Z,{label:"\u7AEF\u53E3",name:"port",placeholder:"\u8F6C\u53D1\u5230\u76EE\u6807\u5BB9\u5668\u4E2D\u7684\u7AEF\u53E3\uFF0C\u4E00\u822C\u4E3A80",required:!0,rules:[{required:!0}]}),(0,e.jsxs)(ee.Z,{children:[(0,e.jsx)(K.Z,{span:12,children:(0,e.jsx)(N.Z,{label:"\u963B\u6B62\u5E38\u89C1\u6F0F\u6D1E\u5229\u7528",name:"enableBlockCommonExploits"})}),(0,e.jsx)(K.Z,{children:(0,e.jsx)(N.Z,{width:"md",label:"\u9759\u6001\u8D44\u6E90\u7F13\u5B58",name:"enableAssetCache"})})]}),(0,e.jsx)(ee.Z,{children:(0,e.jsx)(K.Z,{span:12,children:(0,e.jsx)(N.Z,{label:"\u652F\u6301 Websocket",name:"enableWs"})})}),(0,e.jsx)(J.Z,{name:"extraNginx",label:"\u81EA\u5B9A\u4E49\u6269\u5C55\u914D\u7F6E",tooltip:"\u81EA\u5B9A\u4E49\u6269\u5C55\u7F51\u7AD9 Vhost \u914D\u7F6E\u5185\u5BB9",children:(0,e.jsx)(Q.ZP,{height:"300px",theme:"dark",style:{backgroundColor:"#282c34"}})})]})},{key:"2",label:"SSL",children:(0,e.jsxs)(e.Fragment,{children:[u&&u.domain.setting.autoSsl&&(0,e.jsx)(ge.Z,{message:"\u5F53\u524D\u8BC1\u4E66\u4E3A\u81EA\u52A8\u7B7E\u53D1\uFF0C\u8BF7\u52FF\u4FEE\u6539\u3002\u8BC1\u4E66\u8DEF\u5F84\u4E3A\uFF1A/dpanel/cert \u76EE\u5F55",style:{margin:"15px 0"}}),(0,e.jsx)(pe.Z,{label:"\u8BC1\u4E66\u5230\u671F\u65F6\u95F4",name:"sslCrtRenewTime",width:"lg",required:!0,disabled:u&&u.domain.setting.autoSsl}),(0,e.jsx)(le.Z,{fieldProps:{autoSize:{minRows:10}},label:"\u8BC1\u4E66\u5185\u5BB9 .crt ",name:"sslCrt",tooltip:"1.\u901A\u5E38\u8BC1\u4E66\u662F\u4EE5 .crt \u6216 .pem \u7B49\u4E3A\u6269\u5C55\u540D\u7684\u6587\u4EF6\uFF0C\u8BF7\u4F7F\u7528\u76F8\u5E94\u6587\u672C\u7F16\u8F91\u5668\u6253\u5F00\u8BC1\u4E66\u6587\u4EF6\u3002 2.\u8BC1\u4E66\u683C\u5F0F\u4EE5\u201C-----BEGIN CERTIFICATE-----\u201D\u5F00\u5934\uFF0C\u4EE5\u201C-----END CERTIFICATE-----\u201D\u7ED3\u5C3E\u3002 3.\u8BC1\u4E66\u5185\u5BB9\u8BF7\u5305\u542B\u5B8C\u6574\u7684\u8BC1\u4E66\u94FE\u3002",placeholder:"-----BEGIN CERTIFICATE-----",disabled:u&&u.domain.setting.autoSsl,required:!0},"sslCrt"),(0,e.jsx)(le.Z,{fieldProps:{autoSize:{minRows:10}},label:"\u79C1\u94A5\u5185\u5BB9 .key ",name:"sslKey",tooltip:"1.\u901A\u5E38\u79C1\u94A5\u662F\u4EE5 .key \u6216 .pem \u7B49\u4E3A\u6269\u5C55\u540D\u7684\u6587\u4EF6\uFF0C\u8BF7\u4F7F\u7528\u76F8\u5E94\u6587\u672C\u7F16\u8F91\u5668\u6253\u5F00\u79C1\u94A5\u6587\u4EF6\u3002 2.\u79C1\u94A5\u683C\u5F0F\u4EE5\u201C-----BEGIN PRIVATE KEY-----\u201D\u5F00\u5934\uFF0C\u4EE5\u201C-----END PRIVATE KEY-----\u201D\u7ED3\u5C3E\u3002",placeholder:"-----BEGIN PRIVATE KEY-----",disabled:u&&u.domain.setting.autoSsl,required:!0},"sslKey")]})},{key:"3",label:"\u67E5\u770B vhost \u914D\u7F6E",children:(0,e.jsx)(J.Z,{name:"vhost",label:" ",children:(0,e.jsx)(Q.ZP,{height:"600px",theme:"dark",readOnly:!0,style:{backgroundColor:"#282c34"}})})}]})})}),Ce=Fe,De=n(80821),xe=n(67255),Ae=n(43425),Be=n(10641),ye=n(96074),Re=n(60922),Se=n(83062);function je(){var l=(0,C.useParams)(),o=(0,D.useRef)(),p=(0,D.useRef)(),t=(0,D.useRef)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(he,{ref:t,onFinish:function(){var m,a;!((m=o.current)===null||m===void 0)&&m.reloadAndRest&&((a=o.current)===null||a===void 0||a.reloadAndRest())}}),(0,e.jsx)(Be.Z,{scroll:{x:"max-content"},rowKey:"id",actionRef:o,columns:[{title:"\u57DF\u540D",dataIndex:"serverName",render:function(m,a,g,E,u){return(0,e.jsx)("a",{href:"".concat(a.setting.enableSSL?"https":"http","://").concat(a.serverName),target:"_blank",children:a.serverName})}},{title:"\u5BB9\u5668\u5185\u7AEF\u53E3",dataIndex:["setting","port"],search:!1},{title:"SSL\u8BC1\u4E66",search:!1,render:function(m,a,g,E,u){var c;return a.setting.enableSSL?(0,e.jsxs)(_.Z,{color:"success",children:["\u8BC1\u4E66\u6709\u6548\u81F3\uFF1A",new Date((c=a.setting.sslCrtRenewTime)!==null&&c!==void 0?c:"").toLocaleDateString()]}):(0,e.jsx)(_.Z,{color:"red",children:"\u5426"})}},{title:"\u521B\u5EFA\u65F6\u95F4",search:!1,width:180,ellipsis:!0,dataIndex:"createdAt",render:function(m,a,g,E,u){return new Date(a.createdAt).toLocaleString()}},{title:"\u64CD\u4F5C",valueType:"option",key:"option",width:50,render:function(m,a,g,E){return(0,e.jsx)(q.Z,{split:(0,e.jsx)(ye.Z,{type:"vertical"}),children:(0,e.jsx)(Re.Z.Link,{onClick:function(){var c;return(c=p.current)===null||c===void 0||c.showEdit(a),!0},children:(0,e.jsx)(Se.Z,{title:"\u7BA1\u7406\u57DF\u540D",children:(0,e.jsx)(Ae.Z,{})})})})}}],request:function(){var x=h()(i()().mark(function m(a,g,E){var u,c,B,v,r;return i()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,U({containerId:(u=(c=l.id)!==null&&c!==void 0?c:"")!==null&&u!==void 0?u:"",pageSize:(B=a.pageSize)!==null&&B!==void 0?B:10,page:(v=a.current)!==null&&v!==void 0?v:1,serverName:a.serverName,port:a.port});case 2:return r=s.sent,s.abrupt("return",{data:r.data.list.map(function(F){return F.setting||(F.setting={autoSsl:!1}),F}),success:!0,total:r.data.list.length});case 4:case"end":return s.stop()}},m)}));return function(m,a,g){return x.apply(this,arguments)}}(),toolBarRender:function(){var m;return[(0,e.jsx)(Ce,{ref:p,containerId:(m=l.id)!==null&&m!==void 0?m:"",onFinish:function(){var g,E;!((g=o.current)===null||g===void 0)&&g.reloadAndRest&&((E=o.current)===null||E===void 0||E.reloadAndRest())}})]},rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},tableAlertOptionRender:function(m){var a=m.selectedRowKeys,g=m.selectedRows;return(0,e.jsxs)(q.Z,{size:16,children:[(0,e.jsx)(De.Z,{danger:!0,type:"primary",action:function(){return H({id:a})},onSuccess:function(){var u,c;return!((u=o.current)===null||u===void 0)&&u.reloadAndRest&&((c=o.current)===null||c===void 0||c.reloadAndRest()),!0},onError:function(){var u,c;return!((u=o.current)===null||u===void 0)&&u.reset&&((c=o.current)===null||c===void 0||c.reset()),!0},messageSuccess:"\u5220\u9664\u6210\u529F",children:"\u6279\u91CF\u5220\u9664"}),(0,e.jsx)(se.ZP,{onClick:function(){var u;(u=t.current)===null||u===void 0||u.apply(g)},children:"\u514D\u8D39\u8BC1\u4E66"})]})},pagination:(0,xe.O)()})]})}},67255:function(te,T,n){n.d(T,{O:function(){return W},j:function(){return i}});function W(){var A,h=parseInt((A=localStorage.getItem("dpanel-pagesize"))!==null&&A!==void 0?A:"0");return{showSizeChanger:!0,defaultPageSize:h!=null?h:20}}function i(A){var h="dpanel-table-column-".concat(A),P={};if(localStorage.getItem(h)){var y;P=JSON.parse((y=localStorage.getItem(h))!==null&&y!==void 0?y:"{}")}return{defaultValue:P,onChange:function(U){localStorage.setItem("dpanel-table-column-".concat(A),JSON.stringify(U))}}}}}]);
