"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1147],{99922:function(N,R,e){var T=e(97857),D=e.n(T),P=e(15009),U=e.n(P),b=e(99289),Z=e.n(b),A=e(5574),B=e.n(A),r=e(67294),w=e(85265),F=e(42075),L=e(83622),i=e(49610),O=e(3616),m=e(93362),C=e(90581),K=e(5251),v=e(36146),M=e(85893),c=new v.Uo("components.appDetail.appDetailQuickConsole"),y=(0,r.forwardRef)(function(p,x){var o,j,a=(0,r.useRef)(),f=(0,r.useRef)(),g=(0,r.useState)(!1),E=B()(g,2),s=E[0],d=E[1],l=(0,r.useState)(),h=B()(l,2),_=h[0],u=h[1];return(0,r.useImperativeHandle)(x,function(){return{show:function(n){return Z()(U()().mark(function W(){var S;return U()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:u(n),d(!0),(S=a.current)===null||S===void 0||S.resetFields();case 3:case"end":return I.stop()}},W)}))()}}}),(0,r.useEffect)(function(){return setTimeout(function(){var t;_&&((t=f.current)===null||t===void 0||t.start(_.url,{cmd:_&&_.cmd,workDir:_&&_.workDir}))},1e3),function(){var t;(t=f.current)===null||t===void 0||t.close()}},[_,s]),(0,M.jsxs)(w.Z,{forceRender:!0,width:O.FK,open:s,onClose:function(){return[d(!1)]},title:c.format("drawerTitle",{name:_==null?void 0:_.title}),children:[(0,M.jsxs)(F.Z,{style:{marginBottom:20},children:[p.showFileExplorer&&(0,M.jsx)(m.Z,{trigger:(0,M.jsx)(L.ZP,{type:"primary",children:c.format("fileExplorerButton")}),type:"container",title:(0,K.fi)((o=_==null?void 0:_.title)!==null&&o!==void 0?o:"","/"),name:_&&_.url&&(j=_.url.split("/").pop())!==null&&j!==void 0?j:""}),(0,M.jsx)(C.Z,{onChangeShell:function(n){var W;if(!_)return!1;(W=f.current)===null||W===void 0||W.close(),u(D()(D()({},_),{cmd:n!=null?n:_==null?void 0:_.cmd}))},onOpenNewWindow:function(n){return _?(n.workDir=_&&_.workDir?_.workDir:"","".concat(_.url,"?").concat(Object.keys(n).map(function(W){return"".concat(W,"=").concat(encodeURIComponent(n[W]))}).join("&"))):""},onOpenNewWindowFinish:function(){var n;(n=f.current)===null||n===void 0||n.close(),d(!1)},onBatchCommandFinish:function(n){f.current&&f.current.run(n)}})]}),s&&(0,M.jsx)(i.Z,{height:"80vh",ref:f})]})});R.Z=y},93362:function(N,R,e){var T=e(97857),D=e.n(T),P=e(15009),U=e.n(P),b=e(99289),Z=e.n(b),A=e(5574),B=e.n(A),r=e(67294),w=e(57221),F=e(85265),L=e(3616),i=e(5251),O=e(36146),m=e(28031),C=e(24963),K=e(99922),v=e(85893),M=(0,r.forwardRef)(function(c,y){var p,x=(0,r.useState)(!1),o=B()(x,2),j=o[0],a=o[1],f=(0,r.useState)(),g=B()(f,2),E=g[0],s=g[1],d=(0,r.useRef)(),l=new O.Uo("components.appDetail.appDetailQuickFile"),h=(0,r.useContext)(C.Z),_=h.loading,u=(0,r.useRef)();return(0,r.useImperativeHandle)(y,function(){return{showContainer:function(n){s({name:(0,i.fi)(n,"/"),type:"container"}),a(!0)},showHost:function(n){s({name:n,type:"host"}),a(!0)},showVolume:function(n){return Z()(U()().mark(function W(){var S;return U()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return _.show(),I.next=3,(0,m.Ak)("app",{name:n}).finally(function(){_.destroy()});case 3:S=I.sent,s({name:S.data.containerName,type:"container",workDir:S.data.path}),a(!0);case 6:case"end":return I.stop()}},W)}))()}}}),(0,v.jsxs)(v.Fragment,{children:[c.trigger?r.cloneElement(c.trigger,{onClick:function(){c.name&&c.type&&(s(c),a(!0))}}):null,(0,v.jsxs)(F.Z,{width:L.R_,title:l.format("drawerTitle",{name:(p=c.title)!==null&&p!==void 0?p:E==null?void 0:E.name}),onClose:function(){var n;(n=d.current)===null||n===void 0||n.close(),a(!1),s(void 0)},open:j,children:[c.showConsole&&(0,v.jsx)(K.Z,{showFileExplorer:!1,ref:u}),j&&E&&(0,v.jsx)(w.Z,D()(D()({ref:d},E),{},{onConsole:c.showConsole?function(t){var n;(n=u.current)===null||n===void 0||n.show({url:"/console/container/".concat(E.name),title:E.name,workDir:t})}:void 0}))]})]})});R.Z=M},90581:function(N,R,e){e.d(R,{Z:function(){return j}});var T=e(15009),D=e.n(T),P=e(99289),U=e.n(P),b=e(5574),Z=e.n(b),A=e(3616),B=e(97269),r=e(38345),w=e(64317),F=e(37476),L=e(62370),i=e(97462),O=e(11106),m=e(42075),C=e(83622),K=e(83062),v=e(67294),M=e(33160),c=e(58638),y=e(82346),p=e(2974),x=e(36146),o=e(85893);function j(a){var f=(0,v.useState)(!1),g=Z()(f,2),E=g[0],s=g[1],d=(0,v.useRef)(),l=new x.Uo("components.console");return(0,o.jsx)(B.A,{layout:"inline",submitter:!1,children:(0,o.jsx)(r.Z,{ghost:!0,children:(0,o.jsxs)(m.Z,{children:[(0,o.jsx)(w.Z,{width:"sm",name:"entryCmd",placeholder:l.format("toolbarEntryCmdEmpty"),valueEnum:{"/bin/sh":"/bin/sh","/bin/bash":"/bin/bash"},onChange:function(_){a.onChangeShell&&a.onChangeShell(_)}}),(0,o.jsx)(F.Y,{modalProps:{width:A.ob,height:A.Ed},title:l.format("toolbarBatchCommandTitle"),name:"batchCommand",open:E,trigger:(0,o.jsx)(C.ZP,{children:l.format("toolbarBatchCommandTitle")}),formKey:"batchCommand",formRef:d,isKeyPressSubmit:!0,onFinish:function(){var h=U()(D()().mark(function _(u){return D()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:a.onBatchCommandFinish&&a.onBatchCommandFinish(u.shell.split(`
`)),s(!1);case 2:case"end":return n.stop()}},_)}));return function(_){return h.apply(this,arguments)}}(),onOpenChange:function(_){s(_),_&&d.current&&d.current.resetFields()},children:(0,o.jsx)(L.Z,{name:"shell",children:(0,o.jsx)(O.ZP,{theme:"dark",height:A.Ed})})}),(0,o.jsx)(C.ZP,{onClick:function(){a.onChangeShell&&a.onChangeShell()},icon:(0,o.jsx)(M.Z,{}),type:"primary"}),(0,o.jsx)(i.Z,{name:["entryCmd"],children:function(_){var u=_.entryCmd;return(!u||u=="")&&(u="/bin/sh"),a.onOpenNewWindow&&(0,o.jsx)(y.Link,{onClick:function(){a.onOpenNewWindowFinish&&a.onOpenNewWindowFinish()},target:"_blank",to:a.onOpenNewWindow({cmd:u}),children:(0,o.jsx)(K.Z,{title:l.format("toolbarOpenInNewWindowTip"),children:(0,o.jsx)(C.ZP,{type:"dashed",icon:(0,o.jsx)(c.Z,{})})})})}}),(0,o.jsx)(p.Z,{buttonProps:{shape:"default",size:"middle"}})]})})})}},49610:function(N,R,e){var T=e(5574),D=e.n(T),P=e(67294),U=e(52626),b=e(78267),Z=e.n(b),A=e(12323),B=e(87662),r=e(4244),w=e.n(r),F=e(24078),L=e(85893),i,O,m,C,K=(0,P.forwardRef)(function(v,M){var c,y=(0,P.useState)(),p=D()(y,2),x=p[0],o=p[1],j=(0,P.useState)(""),a=D()(j,2),f=a[0],g=a[1];(0,P.useImperativeHandle)(M,function(){return{start:function(d,l){E(),O.fit(),l.width=i.cols,l.height=i.rows;var h=l?Object.keys(l).filter(function(_){return l&&l[_]}).map(function(_){if(l&&l[_])return"".concat(_,"=").concat(l[_])}):[];m=new WebSocket((0,U.R)(d+"?"+h.join("&"))),m.addEventListener("message",function(_){var u=JSON.parse(_.data),t=u.type;if(t==d&&(i.write(u.data),u.data.indexOf("exec failed")!=-1)){E();return}}),C=i.onData(function(_){var u={content:{command:_},type:d};m&&m.send(JSON.stringify(u))}),g(d),o(l)},close:function(){E()},fit:function(){return O.fit(),{width:i.cols,height:i.rows}},run:function(d){x&&d&&d.forEach(function(l){var h={content:{command:l+`
`},type:f};m&&m.send(JSON.stringify(h))})}}}),(0,P.useEffect)(function(){return i=new r.Terminal(A.X),O=new b.FitAddon,i.loadAddon(O),i.open(document.getElementById("terminal-container-console")),O.fit(),(0,B.pe)({groupName:"setting",name:"themeConsoleConfig"}).then(function(s){s.data&&s.data.fontSize&&Object.assign(i.options,s.data)}),function(){E()}},[]),(0,P.useEffect)(function(){window.addEventListener("resize",function(){O.fit();var s={size:{width:i.cols,height:i.rows},type:f};f&&m&&m.send(JSON.stringify(s))})},[f]);function E(){C&&(i.reset(),O.fit(),i.focus(),C.dispose()),m&&(m.close(),m=null)}return(0,L.jsx)("div",{style:{height:(c=v.height)!==null&&c!==void 0?c:"100vh"},id:"terminal-container-console"})});R.Z=K},12323:function(N,R,e){e.d(R,{X:function(){return T}});var T={convertEol:!0,fontFamily:'Menlo, Monaco, "Courier New", monospace',fontWeight:400,fontSize:16,lineHeight:1,cursorStyle:"block",cursorInactiveStyle:"outline",cursorBlink:!0,letterSpacing:0,theme:{foreground:"#bfbfbf",cursor:"gray",selectionForeground:"#ffffff"}},D=null}}]);
