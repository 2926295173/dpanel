"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8022],{91806:function(J,I,e){e.d(I,{Z:function(){return v}});var W=e(87462),P=e(67294),A={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},h=A,L=e(84089),p=function(z,D){return P.createElement(L.Z,(0,W.Z)({},z,{ref:D,icon:h}))},b=P.forwardRef(p),v=b},44349:function(J,I,e){var W=e(97857),P=e.n(W),A=e(17186),h=e(5966),L=e(86250),p=e(67294),b=e(85893),v=(0,p.forwardRef)(function(f,z){var D=(0,p.useRef)();(0,p.useImperativeHandle)(z,function(){return{addItem:function(O,x){var T,d=(T=D.current)===null||T===void 0?void 0:T.getList(),H=!1;if(d==null||d.map(function(G){if(G.name==O){H=!0;return}}),!H){var U;(U=D.current)===null||U===void 0||U.add({name:O,value:x})}},clear:function(){var O;(O=D.current)===null||O===void 0||(O=O.getList())===null||O===void 0||O.map(function(x,T){var d;(d=D.current)===null||d===void 0||d.remove(T)})}}});var N={};return f.hideCopyButton===!0&&(N.copyIconProps=!1),f.hideDeleteButton===!0&&(N.deleteIconProps=!1),(0,b.jsx)(A.u,P()(P()({initialValue:f.initialValue,label:f.label,name:f.name,actionRef:D,creatorButtonProps:f.showAddButton?{creatorButtonText:"\u6DFB\u52A0"+(f.label?f.label:f.name)}:!1,min:f.min?f.min:0},N),{},{children:function(O,x,T){return(0,b.jsx)(L.Z,{justify:f.justify,gap:f.gap,children:f.items.map(function(d){return d.render?(0,b.jsx)("div",{children:d.render&&d.render(O,x,T)},"".concat(f.name,"-").concat(d.name,"-").concat(O.key)):(0,b.jsx)(h.Z,{width:d.width,name:d.name,label:d.label,required:d.required,rules:[{required:d.required}],disabled:d.disabled,placeholder:d.placeholder},"".concat(f.name,"-").concat(d.name,"-").concat(O.key))})})}}))});I.Z=v},8680:function(J,I,e){var W=e(15009),P=e.n(W),A=e(64599),h=e.n(A),L=e(99289),p=e.n(L),b=e(9783),v=e.n(b),f=e(5574),z=e.n(f),D=e(67294),N=e(184),Z=e(38345),O=e(97269),x=e(97321),T=e(97462),d=e(64317),H=e(5966),U=e(86615),G=e(68602),k=e(28036),B=e(83403),q=e(24963),S=e(1699),a=e(29177),te=e(45742),ae=e(43425),re=e(44349),ee=e(3616),_=e(85893),se=(0,D.forwardRef)(function(F,M){var Q=(0,D.useState)(!1),Y=z()(Q,2),m=Y[0],y=Y[1],V=(0,D.useRef)(),le=(0,D.useContext)(q.Z),w=le.message,ne=(0,D.useState)([]),X=z()(ne,2),E=X[0],u=X[1],t=v()(v()(v()(v()(v()({},B.W6.CONTAINER,"Id"),B.W6.APPSTORE,"name"),B.W6.COMPOSE,"name"),B.W6.REGISTRY,"serverAddress"),B.W6.DOCKER_ENV,"name"),c=v()(v()(v()(v()(v()({},B.W6.CONTAINER,"name"),B.W6.APPSTORE,"name"),B.W6.COMPOSE,"name"),B.W6.REGISTRY,"title"),B.W6.DOCKER_ENV,"title"),o=t[F.type],r=c[F.type],g=F.selected.map(function(s){return s[t[F.type]]});return D.useEffect(function(){m&&((0,G.dP)({permission:{uri:F.type,key:o,value:g}}).then(function(s){var l;(l=V.current)===null||l===void 0||l.setFieldValue("list",Object.keys(s.data.list).map(function(n){return{name:n,type:s.data.list[n].type,users:s.data.list[n].users}}))}),(0,G.lE)().then(function(s){var l,n=(l=s.data)===null||l===void 0||(l=l.list)===null||l===void 0?void 0:l.map(function(i){return{label:i.username,value:i.username}});u(n)}))},[m]),(0,_.jsx)(S.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,_.jsxs)(N.a,{name:"create",title:"\u6570\u636E\u6743\u9650\u8BBE\u7F6E",open:m,onOpenChange:function(l){if(!l){var n;(n=V.current)===null||n===void 0||n.resetFields()}y(l)},drawerProps:{forceRender:!0,width:ee.R_},formRef:V,trigger:(0,_.jsx)(k.ZP,{icon:(0,_.jsx)(a.Z,{}),children:"\u6570\u636E\u6743\u9650"}),onFinish:function(){var s=p()(P()().mark(function l(n){var i,j,R;return P()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:i=h()(n.list),C.prev=1,i.s();case 3:if((j=i.n()).done){C.next=9;break}return R=j.value,C.next=7,(0,G.Db)({usernames:R.users,permissionType:R.type,permission:{uri:F.type,key:o,showKey:r,value:[R.name]}});case 7:C.next=3;break;case 9:C.next=14;break;case 11:C.prev=11,C.t0=C.catch(1),i.e(C.t0);case 14:return C.prev=14,i.f(),C.finish(14);case 17:w.success("\u6743\u9650\u8BBE\u7F6E\u6210\u529F"),y(!1),F.onSuccess();case 20:case"end":return C.stop()}},l,null,[[1,11,14,17]])}));return function(l){return s.apply(this,arguments)}}(),children:[(0,_.jsxs)(Z.Z,{ghost:!0,title:(0,_.jsx)(te.Z,{}),subTitle:"\u6279\u91CF\u8BBE\u7F6E",children:[(0,_.jsx)(O.A.Item,{name:"type",style:{marginBottom:0},children:(0,_.jsxs)(x.Z.Group,{defaultValue:"admin",onChange:function(l){var n,i,j=(n=V.current)===null||n===void 0?void 0:n.getFieldValue("list");j.forEach(function(R){R.type=l,R.users=[]}),(i=V.current)===null||i===void 0||i.setFieldValue("list",j)},children:[(0,_.jsx)(x.Z,{style:{width:240},title:"\u7BA1\u7406\u5458",description:"\u4EC5\u7BA1\u7406\u5458\u53EF\u89C1",value:"admin"}),(0,_.jsx)(x.Z,{style:{width:240},title:"\u6307\u5B9A\u7528\u6237",description:"\u4EC5\u9009\u4E2D\u7528\u6237\u53EF\u89C1",value:"restricted"}),(0,_.jsx)(x.Z,{style:{width:240},title:"\u516C\u5171",description:"\u6240\u6709\u4EBA\u53EF\u89C1",value:"public"})]})}),(0,_.jsx)(T.Z,{name:["type"],children:function(l){var n=l.type;if(n==="restricted")return(0,_.jsx)(d.Z,{mode:"multiple",name:"usernames",label:"\u9009\u62E9\u7528\u6237",onChange:function(j){var R,K,C=(R=V.current)===null||R===void 0?void 0:R.getFieldValue("list");C.forEach(function($){$.users=j}),(K=V.current)===null||K===void 0||K.setFieldValue("list",C)},rules:[{required:!0}],request:p()(P()().mark(function i(){var j,R,K;return P()().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(!(E.length>0)){$.next=2;break}return $.abrupt("return",E);case 2:return $.next=4,(0,G.lE)();case 4:return R=$.sent,K=(j=R.data)===null||j===void 0||(j=j.list)===null||j===void 0?void 0:j.map(function(oe){return{label:oe.username,value:oe.username}}),u(K),$.abrupt("return",K);case 8:case"end":return $.stop()}},i)}))})}})]}),(0,_.jsx)(Z.Z,{ghost:!0,title:(0,_.jsx)(ae.Z,{}),subTitle:"\u6570\u636E\u6743\u9650\u8BBE\u7F6E",children:(0,_.jsx)(re.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:"\u540D\u79F0",render:function(l,n,i){var j=i.getCurrentRowData();return(0,_.jsx)(H.Z,{disabled:!0,label:"\u540D\u79F0",width:"sm",name:"name"})}},{name:"type",label:"\u6743\u9650\u7C7B\u578B",render:function(l,n,i){var j=i.getCurrentRowData();return(0,_.jsx)(U.Z.Group,{label:"\u6743\u9650\u7C7B\u578B",name:"type",radioType:"button",options:[{label:"\u7BA1\u7406\u5458",value:"admin"},{label:"\u516C\u5171",value:"public"},{label:"\u6307\u5B9A\u7528\u6237",value:"restricted"}]})}},{name:"users",label:"\u5173\u8054\u7528\u6237",render:function(l,n,i){return(0,_.jsx)(T.Z,{name:["type"],children:function(R){var K=R.type;if(K=="restricted")return(0,_.jsx)(d.Z,{width:"sm",mode:"tags",name:"users",label:"\u5173\u8054\u7528\u6237",options:E})}})}}]})})]})})});I.Z=se},96781:function(J,I,e){var W=e(67294),P=(0,W.createContext)({});I.Z=P},83536:function(J,I,e){e.r(I),e.d(I,{default:function(){return F}});var W=e(64599),P=e.n(W),A=e(15009),h=e.n(A),L=e(99289),p=e.n(L),b=e(80821),v=e(90098),f=e(43425),z=e(23430),D=e(90078),N=e(41482),Z=e(82346),O=e(28036),x=e(25593),T=e(42075),d=e(96074),H=e(83062),U=e(67294),G=e(94359),k=e(67255),B=e(93162),q=e(24963),S=e(66309),a=e(85893);function te(M){var Q=(0,Z.useIntl)(),Y=(0,U.useContext)(q.Z),m=Y.lang,y;if(!M.type)y=(0,a.jsx)(S.Z,{children:m("compose.type.default")});else switch(M.type){case"remoteUrl":y=(0,a.jsx)(S.Z,{color:"cyan",children:m("compose.type.".concat(M.type))});break;case"serverPath":y=(0,a.jsx)(S.Z,{color:"blue",children:m("compose.type.".concat(M.type))});break;case"storagePath":y=(0,a.jsx)(S.Z,{color:"geekblue",children:m("compose.type.".concat(M.type))});break;case"outPath":y=(0,a.jsx)(S.Z,{color:"yellow",children:m("compose.type.".concat(M.type))});break;case"store":y=(0,a.jsx)(S.Z,{color:"green",children:m("compose.type.".concat(M.type))});break;case"dangling":y=(0,a.jsx)(S.Z,{color:"error",children:m("compose.type.".concat(M.type))});break;default:y=(0,a.jsx)(S.Z,{children:m("compose.type.".concat(M.type))})}return(0,a.jsx)(H.Z,{title:M.tootip,children:y})}var ae=e(96781),re=e(58010),ee=e(1699),_=e(83403),se=e(8680);function F(){var M,Q,Y=(0,U.useContext)(ae.Z),m=Y.listTableRef,y=(0,U.useContext)(q.Z),V=y.lang,le=y.notice,w=(0,U.useRef)(),ne=(0,Z.useAccess)(),X=(0,Z.useLocation)();return(0,a.jsxs)(D._z,{header:{extra:[(0,a.jsx)(ee.u,{access:"canSeeComposeListManageCreate",children:(0,a.jsx)(Z.Link,{to:"/compose/create",reloadDocument:X.search.length>0,children:(0,a.jsx)(O.ZP,{type:"primary",children:"\u521B\u5EFA\u4EFB\u52A1"},"createCompose")},"create")},"create")]},children:[(0,a.jsx)(re.Z,{ref:w,onClose:function(){var u;!((u=m.current)===null||u===void 0)&&u.reloadAndRest&&m.current.reloadAndRest()}}),(0,a.jsx)(N.Z,{scroll:{x:"max-content"},request:function(){var E=p()(h()().mark(function u(t){var c;return h()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,v.pm)({title:t.title,name:t.name});case 2:return c=r.sent,r.abrupt("return",{data:c.data.list,success:!0,total:c.data.list.length});case 4:case"end":return r.stop()}},u)}));return function(u){return E.apply(this,arguments)}}(),rowKey:"name",columns:[{title:"\u6807\u8BC6",dataIndex:"name",width:200,render:function(u,t,c,o,r){return(0,a.jsx)(x.Z.Link,{onClick:function(){var s;(s=w.current)===null||s===void 0||s.show(t.id||t.name)},children:t.name})},sorter:function(u,t){return u.name.localeCompare(t.name)},sortDirections:["descend","ascend"]},{title:"\u9879\u76EE\u540D\u79F0",dataIndex:"title",width:200},{title:"\u7C7B\u578B",width:150,search:!1,render:function(u,t,c,o,r){var g;return(0,a.jsx)(te,{tootip:(g=t.setting.uri)!==null&&g!==void 0?g:"",type:t.setting&&t.setting.type?t.setting.type:""})}},{title:"\u5BB9\u5668\u72B6\u6001",dataIndex:"status",search:!1,width:300,render:function(u,t,c,o,r){return(0,a.jsx)(T.Z,{children:t.setting.status.split(", ").map(function(g,s){var l="running",n=g.indexOf("(");return n>-1?l=g.slice(0,n):l=g,(0,a.jsx)(G.Z,{status:l,message:{content:V("compose.status.".concat(l),{count:g.slice(n+1,g.length-1)}),title:t.setting.message,placement:"top",showInTag:!0}},s)})})},sorter:function(u,t){return u.setting.status.localeCompare(t.setting.status)}},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"",search:!1,width:150,render:function(u,t,c,o,r){return t.setting.createdAt?new Date(t.setting.createdAt).toLocaleString():"-"},sorter:function(u,t){var c,o;return new Date((c=u.setting.createdAt)!==null&&c!==void 0?c:"").toLocaleString().localeCompare(new Date((o=t.setting.createdAt)!==null&&o!==void 0?o:"").toLocaleString())}},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"",search:!1,width:150,render:function(u,t,c,o,r){return t.setting.updatedAt?new Date(t.setting.updatedAt).toLocaleString():"-"},sorter:function(u,t){var c,o;return new Date((c=u.setting.updatedAt)!==null&&c!==void 0?c:"").toLocaleString().localeCompare(new Date((o=t.setting.updatedAt)!==null&&o!==void 0?o:"").toLocaleString())}},{title:"\u64CD\u4F5C",width:80,valueType:"option",fixed:"right",key:"option",hidden:!ne.canSeeComposeListManage,render:function(u,t,c,o,r){return t.setting.type!="dangling"&&(0,a.jsxs)(T.Z,{split:(0,a.jsx)(d.Z,{type:"vertical"}),children:[(0,a.jsx)(x.Z.Link,{onClick:function(){var s;(s=w.current)===null||s===void 0||s.show(t.id||t.name)},children:(0,a.jsx)(H.Z,{title:"\u90E8\u7F72",children:(0,a.jsx)(f.Z,{})})},"3"),(0,a.jsx)(x.Z.Link,{onClick:p()(h()().mark(function g(){var s,l;return h()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,v.tw)({id:t.id||t.name});case 2:s=i.sent,l=new Blob([s],{type:"application/zip"}),(0,B.saveAs)(l,"compose-"+t.name+".zip");case 5:case"end":return i.stop()}},g)})),children:(0,a.jsx)(H.Z,{title:"\u4E0B\u8F7D",children:(0,a.jsx)(z.Z,{})})},"2")]})}}],rowSelection:ne.canSeeComposeListManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0,getCheckboxProps:function(u){return{disabled:u.setting.type=="dangling"||u.setting.type=="outPath"}}}:void 0,tableAlertOptionRender:function(u){var t=u.selectedRows;return(0,a.jsxs)(T.Z,{size:16,children:[(0,a.jsx)(se.Z,{type:_.W6.COMPOSE,selected:t,onSuccess:function(){var o,r;return!((o=m.current)===null||o===void 0)&&o.reloadAndRest&&((r=m.current)===null||r===void 0||r.reloadAndRest()),!0}}),(0,a.jsx)(ee.u,{access:"canSeeComposeListManageDelete",children:(0,a.jsx)(b.Z,{danger:!0,type:"primary",action:p()(h()().mark(function c(){var o,r,g,s;return h()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0,r=P()(t),n.prev=2,r.s();case 4:if((g=r.n()).done){n.next=11;break}return s=g.value,n.next=8,(0,v.mg)({id:s.id||s.name});case 8:o=n.sent;case 9:n.next=4;break;case 11:n.next=16;break;case 13:n.prev=13,n.t0=n.catch(2),r.e(n.t0);case 16:return n.prev=16,r.f(),n.finish(16);case 19:n.next=23;break;case 21:n.prev=21,n.t1=n.catch(0);case 23:return n.abrupt("return",(0,v.ik)({id:t.map(function(i){return i.id})}));case 24:case"end":return n.stop()}},c,null,[[0,21],[2,13,16,19]])})),onSuccess:function(){var o,r;return!((o=m.current)===null||o===void 0)&&o.reloadAndRest&&((r=m.current)===null||r===void 0||r.reloadAndRest()),!0},onError:function(){var o,r;return!((o=m.current)===null||o===void 0)&&o.reset&&((r=m.current)===null||r===void 0||r.reset()),!0},confirm:"notification.confirm.title",children:"\u6279\u91CF\u5220\u9664"})})]})},pagination:(0,k.O)({page:(M=(Q=X.state)===null||Q===void 0?void 0:Q.page)!==null&&M!==void 0?M:1}),search:{collapsed:!1},actionRef:m,columnsState:(0,k.j)("compose-list")})]})}},67255:function(J,I,e){e.d(I,{O:function(){return W},j:function(){return P}});function W(A){var h=localStorage.getItem("dpanel-pagesize");return h=="all"?!1:{current:A==null?void 0:A.page,showSizeChanger:!0,defaultPageSize:parseInt(h!=null?h:"20"),onChange:function(p,b){localStorage.setItem("dpanel-page-"+location.pathname.split("/").slice(-2).join("-"),"".concat(p))}}}function P(A){var h="dpanel-table-column-".concat(A),L={};if(localStorage.getItem(h)){var p;L=JSON.parse((p=localStorage.getItem(h))!==null&&p!==void 0?p:"{}")}return{defaultValue:L,onChange:function(v){localStorage.setItem("dpanel-table-column-".concat(A),JSON.stringify(v))}}}}}]);
