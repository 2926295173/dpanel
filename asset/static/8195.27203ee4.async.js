"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8195],{75293:function(w,p,r){r.d(p,{Z:function(){return T}});var v=r(25593),u=r(85893);function T(h){return(0,u.jsx)(v.Z.Text,{copyable:!0,style:{padding:10,display:h.block?"block":"",background:"#24292f",color:"#ffffff"},children:h.content})}},77273:function(w,p,r){var v=r(15009),u=r.n(v),T=r(99289),h=r.n(T),I=r(5574),M=r.n(I),U=r(184),i=r(5966),j=r(86615),y=r(97462),g=r(64317),L=r(52688),c=r(62370),_=r(38345),W=r(31199),n=r(90672),R=r(71230),S=r(15746),$=r(42075),b=r(86250),N=r(40056),O=r(67294),Q=r(91845),k=r(87662),K=r(12491),X=r(89035),H=r(36146),z=r(3616),J=r(75293),Z=r(2831),e=r(85893),Y=(0,O.forwardRef)(function(A,q){var B,x;(0,O.useImperativeHandle)(q,function(){return{edit:function(a){var t,o=a.address.split("://"),d=M()(o,2),C=d[0],D=d[1];(t=m.current)===null||t===void 0||t.setFieldsValue({name:a.name,title:a.title,addressType:"".concat(C,"://"),address:D,serverUrl:a.serverUrl,enableTLS:a.enableTLS,tlsCa:a.tlsCa,tlsCert:a.tlsCert,tlsKey:a.tlsKey,enableComposePath:a.enableComposePath,enableSSH:a.enableSSH,sshServerInfo:a.sshServerInfo,remoteType:a.remoteType?a.remoteType:"docker"}),re(!0),se(a.name)}}}),(0,O.useEffect)(function(){(0,Z.aF)().then(function(E){E.data.rsa.public&&ae(E.data.rsa.public)})},[]);var G=(0,O.useState)(),F=M()(G,2),V=F[0],ae=F[1],s=new H.Uo("components.dockerEnvCreate"),oe=(0,O.useState)(!1),ee=M()(oe,2),le=ee[0],re=ee[1],m=(0,O.useRef)(),_e=(0,O.useState)(""),ne=M()(_e,2),te=ne[0],se=ne[1];return(0,e.jsxs)(U.a,{drawerProps:{forceRender:!0,width:z.R_},onOpenChange:function(a){if(!a){var t;se(""),(t=m.current)===null||t===void 0||t.resetFields()}re(a)},open:le,width:800,trigger:A.trigger,formRef:m,title:s.format((B=m.current)!==null&&B!==void 0&&B.getFieldValue&&m.current.getFieldValue("name")=="local"?"drawerTitleDefault":"drawerTitle"),onFinish:function(){var E=h()(u()().mark(function a(t){var o,d,C,D;return u()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return d="",t.remoteType&&t.remoteType=="ssh"?d="ssh://":d=(C=t.addressType)!==null&&C!==void 0?C:"unix://",l.next=4,(0,k.ad)({name:t.name,title:t.title,address:"".concat(d).concat((o=t.address)!==null&&o!==void 0?o:t.sshServerInfo.address),serverUrl:t.serverUrl,enableTLS:t.enableTLS,tlsCa:t.tlsCa,tlsCert:t.tlsCert,tlsKey:t.tlsKey,enableComposePath:t.enableComposePath,composePath:t.enableComposePath?t.composePath:"",enableSSH:t.enableSSH||t.remoteType=="ssh",sshServerInfo:t.sshServerInfo,remoteType:t.remoteType});case 4:return D=l.sent,A.onFinish&&A.onFinish(),l.abrupt("return",!0);case 7:case"end":return l.stop()}},a)}));return function(a){return E.apply(this,arguments)}}(),children:[(0,e.jsx)(i.Z,{label:s.format("formTitle"),name:"title",required:!0,rules:[{required:!0}],fieldProps:{id:"envTitle",onChange:function(a){var t="";if(a.target.value&&!te){var o,d=(0,Q.N9)(a.target.value.trim(),{toneType:"none",type:"array"});t=d.join(""),(o=m.current)===null||o===void 0||o.setFieldValue("name",t)}}}},"envTitle"),(0,e.jsx)(i.Z,{label:s.format("formName"),name:"name",required:!0,disabled:te!="",rules:[{required:!0}],placeholder:s.format("formNameEmpty")}),(0,e.jsx)(i.Z,{tooltip:s.format("formServerUrlTip"),label:s.format("formServerUrl"),name:"serverUrl",placeholder:s.format("formServerUrlEmpty")}),(0,e.jsx)(j.Z.Group,{label:s.format("formRemoteType"),name:"remoteType",options:[{label:"DockerApi",value:"docker"},{label:"SSH",value:"ssh",disabled:((x=m.current)===null||x===void 0?void 0:x.getFieldValue("name"))=="local"}]}),(0,e.jsx)(y.Z,{name:["remoteType","name"],children:function(a){var t=a.remoteType,o=a.name;return(0,e.jsxs)(e.Fragment,{children:[t=="docker"&&(0,e.jsx)(R.Z,{children:(0,e.jsx)(S.Z,{span:24,children:(0,e.jsxs)($.Z.Compact,{children:[(0,e.jsx)(g.Z,{name:"addressType",label:s.format("formAddressType"),valueEnum:{"unix://":"unix://","tcp://":"tcp://"},initialValue:"tcp://",fieldProps:{defaultValue:"tcp://"},width:"sm",tooltip:s.format("formAddressTypeTip")}),(0,e.jsx)(i.Z,{label:" ",name:"address",required:!0,width:"xl",rules:[{required:!0}],placeholder:s.format("formAddressEmpty")})]})})}),(0,e.jsxs)(R.Z,{gutter:[15,0],children:[t=="docker"&&(0,e.jsx)(S.Z,{children:(0,e.jsx)(L.Z,{label:s.format("formEnableTLS"),name:"enableTLS",tooltip:s.format("formEnableTLSTip")})}),o!="local"&&typeof t!="undefined"&&(0,e.jsx)(S.Z,{children:(0,e.jsx)(L.Z,{label:s.format("formEnableComposePath"),name:"enableComposePath",tooltip:s.format("formEnableComposePathTip")})}),t=="docker"&&(0,e.jsx)(S.Z,{children:(0,e.jsx)(L.Z,{label:s.format("formEnableSSH"),name:"enableSSH"})})]})]})}}),(0,e.jsx)(y.Z,{name:["enableTLS","remoteType"],children:function(a){var t=a.enableTLS,o=a.remoteType;if(t&&o=="docker"){var d,C,D;return(0,e.jsxs)(b.Z,{gap:10,justify:"start",children:[(0,e.jsx)(c.Z,{name:"tlsCa",label:s.format("formTlsCa"),children:(0,e.jsx)(K.Z,{showPaset:!0,data:(d=m.current)===null||d===void 0?void 0:d.getFieldValue("tlsCa"),title:"ca.pem",onImport:function(l){var P;return(P=m.current)===null||P===void 0||P.setFieldValue("tlsCa",l),!0},onLoad:function(l){if(l.indexOf("CERTIFICATE")<0)throw new Error(s.format("formEnableTLSMessageUploadError",{name:"ca.pem"}));return!0}})}),(0,e.jsx)(c.Z,{name:"tlsCert",label:" ",children:(0,e.jsx)(K.Z,{showPaset:!0,data:(C=m.current)===null||C===void 0?void 0:C.getFieldValue("tlsCert"),title:"cert.pem",onImport:function(l){var P;return(P=m.current)===null||P===void 0||P.setFieldValue("tlsCert",l),!0},onLoad:function(l){if(l.indexOf("CERTIFICATE")<0)throw new Error(s.format("formEnableTLSMessageUploadError",{name:"cert.pem"}));return!0}})}),(0,e.jsx)(c.Z,{label:" ",name:"tlsKey",children:(0,e.jsx)(K.Z,{showPaset:!0,data:(D=m.current)===null||D===void 0?void 0:D.getFieldValue("tlsKey"),title:"key.pem",onImport:function(l){var P;return(P=m.current)===null||P===void 0||P.setFieldValue("tlsKey",l),!0},onLoad:function(l){if(l.indexOf("PRIVATE")<0)throw new Error(s.format("formEnableTLSMessageUploadError",{name:"key.pem"}));return!0}})})]})}}}),(0,e.jsx)(y.Z,{name:["enableComposePath","name"],children:function(a){var t=a.enableComposePath,o=a.name;if(t)return(0,e.jsx)(i.Z,{label:s.format("formComposePath"),name:"composePath",disabled:!0,fieldProps:{value:"/dpanel/compose/compose-".concat(o!=null?o:"")}})}}),(0,e.jsx)(y.Z,{name:["enableSSH","sshServerInfo","remoteType","address"],children:function(a){var t=a.enableSSH,o=a.sshServerInfo,d=a.remoteType,C=a.address;return(t||d=="ssh")&&[(0,e.jsxs)(_.Z,{title:(0,e.jsx)(X.Z,{}),subTitle:s.format("formEnableSSHTitle"),ghost:!0,children:[(0,e.jsxs)(e.Fragment,{children:[d=="ssh"&&(0,e.jsx)(c.Z,{children:(0,e.jsx)(N.Z,{message:(0,e.jsxs)(e.Fragment,{children:[s.format("formEnableSSHAlert")," \xA0",(0,e.jsx)("a",{href:"https://dpanel.cc/manual/system-env#ssh",target:"_blank",children:H.FD.format("help")})]})})}),(0,e.jsx)(i.Z,{label:s.format("formSshServerInfoAddress"),placeholder:s.format("formSshServerInfoAddressEmpty"),name:["sshServerInfo","address"],required:!0,rules:[{required:!0}]})]}),(0,e.jsxs)(R.Z,{children:[(0,e.jsx)(S.Z,{children:(0,e.jsx)(W.Z,{initialValue:22,label:s.format("formSshServerInfoPort"),name:["sshServerInfo","port"]})}),(0,e.jsx)(S.Z,{offset:2,children:(0,e.jsx)(j.Z.Group,{label:s.format("formSshServerInfoAuthType"),name:["sshServerInfo","authType"],options:s.option("formSshServerInfoAuthTypeOption",["basic","pem","pemDefault"]),fieldProps:{onChange:function(){var f;(f=m.current)===null||f===void 0||f.setFieldValue(["sshServerInfo","password"],"")}},required:!0,rules:[{required:!0}]})})]}),o&&o.authType=="basic"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.Z,{label:s.format("formSshServerInfoUsername"),name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]}),(0,e.jsx)(i.Z.Password,{label:s.format("formSshServerInfoPassword"),name:["sshServerInfo","password"],required:!0,rules:[{required:!0}]})]}),o&&o.authType=="pem"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.Z,{label:s.format("formSshServerInfoUsername"),name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]}),(0,e.jsx)(K.Z,{title:s.format("formSshServerInfoPrivateKeyImport"),onImport:function(f){var l;return(l=m.current)===null||l===void 0||l.setFieldValue(["sshServerInfo","privateKey"],f),!0},onLoad:function(f){if(!f.includes("PRIVATE KEY"))throw new Error(s.format("formEnableTLSMessageUploadError",{name:"private.key"}));return!0}}),(0,e.jsx)(n.Z,{name:["sshServerInfo","privateKey"],label:s.format("formSshServerInfoPrivateKey"),required:!0,rules:[{required:!0}]}),(0,e.jsx)(i.Z.Password,{name:["sshServerInfo","password"],label:s.format("formSshServerInfoPrivateKeyPassword")})]}),o&&o.authType=="pemDefault"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.Z,{label:s.format("formSshServerInfoUsername"),name:["sshServerInfo","username"],required:!0,rules:[{required:!0}]}),(0,e.jsx)(N.Z,{message:s.format("formSshServerInfoAddPublicKey"),style:{marginBottom:15}}),V&&(0,e.jsx)(J.Z,{content:'mkdir -p ~/.ssh && chmod 700 ~/.ssh && ! grep -q "'.concat(V.substring(V.length/2,V.length/2+18),`" ~/.ssh/authorized_keys 2>/dev/null && echo "
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCWkAEp59e2qWSPMdJv8e+0XQD78C9AABwlUIxD6oMTRsDX/VA3ED48jt5sPQtSiVg6w/q/owlFF6ocvYp1W0JGgXKbCvMu6FX7+1hIZ9kDr2Y6RSiSDseLYAyzZ5dtO/DkZd0idsdd4HA6CYItFkTGaVRhAuH2Bh3vzBziPvxZ8kt0WcF8PzGR0W+1V4ooLuFok2hLIEI7lnWbcTw2at6FZyIvim2ZP/lVlOnSf+c0DqTIfSqsQchGqhizMbRvt0ZGzXsFC8BNZ/1fEeenHOY5eCWHm/M7SusIkXxeuTVO+/hp/EmSzwnlSSvyDx57ufPID6vrX9OrrIHmeodl3H8j renchao@localhost" >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys`),block:!0})]})]},"sshSetting")]}})]})});p.Z=Y},12491:function(w,p,r){r.d(p,{Z:function(){return W}});var v=r(5574),u=r.n(v),T=r(3616),h=r(24963),I=r(36146),M=r(88484),U=r(57546),i=r(62370),j=r(11106),y=r(42075),g=r(83622),L=r(85576),c=r(67294),_=r(85893);function W(n){var R=(0,c.useContext)(h.Z),S=R.message,$=R.notice,b=(0,c.useRef)(null),N=(0,c.useState)(!1),O=u()(N,2),Q=O[0],k=O[1],K=(0,c.useState)(""),X=u()(K,2),H=X[0],z=X[1];(0,c.useEffect)(function(){n.data&&z(n.data)},[n.data]);var J=function(){b.current&&(b.current.click(),b.current.onchange=function(e){if(!e||!e.target)return"";var Y=new FileReader;Y.onload=function(B){var x,G,F=(x=B.target)===null||x===void 0?void 0:x.result;if(n.onLoad)try{n.onLoad&&n.onLoad(F)}catch(V){$.error(V);return}z(F),typeof n.onImport=="function"&&(S.success(I.FD.format("finish")),n.onImport(F)),(G=b.current)!==null&&G!==void 0&&G.value&&(b.current.value="")};var A=e.target;if(A.files&&A.files[0]){var q=A.files[0];try{Y.readAsText(q)}catch(B){$.error(I.FD.format("commonContentIncorrectFormat",{name:A.files[0].name}))}}})};return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(i.Z,{children:(0,_.jsxs)(y.Z.Compact,{block:!0,children:[(0,_.jsx)(g.ZP,{icon:(0,_.jsx)(M.Z,{}),block:!0,onClick:J,children:n.title}),n.showPaset&&(0,_.jsx)(g.ZP,{icon:(0,_.jsx)(U.Z,{}),onClick:function(){k(!0)}})]})}),(0,_.jsx)("input",{style:{display:"none"},type:"file",ref:b,name:"importFileInput"}),(0,_.jsx)(L.Z,{width:T.ob,open:Q,onCancel:function(){k(!1)},onOk:function(){typeof n.onImport=="function"&&(S.success(I.FD.format("finish")),n.onImport(H)),k(!1)},children:(0,_.jsx)(j.ZP,{height:T.Ed,theme:"dark",value:H,onChange:function(e){z(e)}})})]})}},3616:function(w,p,r){r.d(p,{Ed:function(){return h},FK:function(){return u},R_:function(){return v},ob:function(){return T}});var v=window.innerWidth<=1024?"90vw":"65vw",u="90vw",T="60vw",h="50vh"},24963:function(w,p,r){var v=r(67294),u=(0,v.createContext)({});p.Z=u},2831:function(w,p,r){r.d(p,{Ll:function(){return y},aF:function(){return M},d6:function(){return L},u5:function(){return i}});var v=r(15009),u=r.n(v),T=r(99289),h=r.n(T),I=r(82346);function M(){return U.apply(this,arguments)}function U(){return U=h()(u()().mark(function _(){return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,I.request)("/api/common/home/info",{method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},_)})),U.apply(this,arguments)}function i(){return j.apply(this,arguments)}function j(){return j=h()(u()().mark(function _(){return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,I.request)("/api/common/home/check-new-version",{method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},_)})),j.apply(this,arguments)}function y(){return g.apply(this,arguments)}function g(){return g=h()(u()().mark(function _(){return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,I.request)("/api/common/home/usage",{method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},_)})),g.apply(this,arguments)}function L(){return c.apply(this,arguments)}function c(){return c=h()(u()().mark(function _(){return u()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,I.request)("/api/common/home/upgrade-script",{method:"POST"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},_)})),c.apply(this,arguments)}}}]);
