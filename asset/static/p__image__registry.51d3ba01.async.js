"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9013],{1699:function(Y,M,e){e.d(M,{u:function(){return U}});var C=e(9783),u=e.n(C),y=e(97857),c=e.n(y),b=e(67294),D=e(82346),R=e(40411),g=e(42075),i=e(85893),U=function(n){var j=(0,D.useAccess)(),o=Array.isArray(n.access)?n.access:[n.access],a,h=n.fallback;if(typeof n.children=="function"?(a=n.children(o.reduce(function(t,Z){return c()(c()({},t),{},u()({},Z,j[Z]))},{})),a||(a=h)):o.every(function(t){return j[t]})?a=n.children:a=h,!h&&a&&n.showProTips&&j.canSeeEnableCe){if(j.canSeeEnableHiddenProTips)return null;a=(0,i.jsx)(R.Z,{offset:n.showProTipsOffset,count:"PRO",color:"gold",style:{fontWeight:"bold"},children:a})}if(!h&&a&&n.showProRibbonTips&&j.canSeeEnableCe){if(j.canSeeEnableHiddenProTips)return null;a=(0,i.jsx)(R.Z.Ribbon,{text:"PRO",color:"gold",style:{fontWeight:"bold"},children:a})}return n.space?(0,i.jsx)(g.Z,c()(c()({},n.space),{},{children:a})):a}},80821:function(Y,M,e){e.d(M,{Z:function(){return O}});var C=e(97857),u=e.n(C),y=e(5574),c=e.n(y),b=e(24963),D=e(86738),R=e(83062),g=e(28036),i=e(67294),U=e(85893);function O(n){var j=(0,i.useState)(!1),o=c()(j,2),a=o[0],h=o[1],t=(0,i.useContext)(b.Z),Z=t.lang,T=t.message,A=function(){h(!0);var I=n.action();I instanceof Promise?I.then(function(z){if(h(!1),z){typeof n.onSuccess=="function"&&n.onSuccess(z);var w="";n.messageSuccess?typeof n.messageSuccess=="function"?w=n.messageSuccess(z):w=n.messageSuccess.indexOf("notification.")==0?Z(n.messageSuccess):n.messageSuccess:w=Z("notification.finish"),n.asynced?T.info(w):T.success(w)}}).catch(function(z){h(!1),typeof n.onError=="function"&&n.onError(z)}):h(!1)};return n.confirm?(0,U.jsx)(D.Z,u()(u()({style:{width:500},title:n.confirmTitle?n.confirmTitle:Z("notification.title.tip"),description:typeof n.confirm=="string"&&n.confirm.indexOf("notification.")==0?Z(n.confirm):n.confirm,onConfirm:A,okText:"Yes",cancelText:"No",onOpenChange:n.confirmOnOpenChange},n.confirmProps),{},{children:(0,U.jsx)(R.Z,{title:n.tips,children:(0,U.jsx)(g.ZP,{block:n.block,disabled:n.disabled,icon:!n.children&&a?void 0:n.icon,loading:a,danger:n.danger,type:n.type,children:n.children})})})):(0,U.jsx)(R.Z,{title:n.tips,children:(0,U.jsx)(g.ZP,{block:n.block,style:n.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:n.disabled,icon:!n.children&&a?void 0:n.icon,loading:a,onClick:A,danger:n.danger,type:n.type,children:n.children})})}},44349:function(Y,M,e){var C=e(97857),u=e.n(C),y=e(17186),c=e(5966),b=e(86250),D=e(67294),R=e(85893),g=(0,D.forwardRef)(function(i,U){var O=(0,D.useRef)();(0,D.useImperativeHandle)(U,function(){return{addItem:function(o,a){var h,t=(h=O.current)===null||h===void 0?void 0:h.getList(),Z=!1;if(t==null||t.map(function(A){if(A.name==o){Z=!0;return}}),!Z){var T;(T=O.current)===null||T===void 0||T.add({name:o,value:a})}},clear:function(){var o;(o=O.current)===null||o===void 0||(o=o.getList())===null||o===void 0||o.map(function(a,h){var t;(t=O.current)===null||t===void 0||t.remove(h)})}}});var n={};return i.hideCopyButton===!0&&(n.copyIconProps=!1),i.hideDeleteButton===!0&&(n.deleteIconProps=!1),(0,R.jsx)(y.u,u()(u()({initialValue:i.initialValue,label:i.label,name:i.name,actionRef:O,creatorButtonProps:i.showAddButton?{creatorButtonText:i.label?i.label:i.name}:!1,min:i.min?i.min:0},n),{},{children:function(o,a,h){return(0,R.jsx)(b.Z,{justify:i.justify,gap:i.gap,children:i.items.map(function(t){return t.render?(0,R.jsx)("div",{children:t.render&&t.render(o,a,h)},"".concat(i.name,"-").concat(t.name,"-").concat(o.key)):(0,R.jsx)(c.Z,{width:t.width,name:t.name,label:t.label,required:t.required,rules:[{required:t.required}],disabled:t.disabled,placeholder:t.placeholder},"".concat(i.name,"-").concat(t.name,"-").concat(o.key))})})}}))});M.Z=g},36435:function(Y,M,e){var C=e(15009),u=e.n(C),y=e(64599),c=e.n(y),b=e(99289),D=e.n(b),R=e(9783),g=e.n(R),i=e(5574),U=e.n(i),O=e(67294),n=e(184),j=e(38345),o=e(97269),a=e(97321),h=e(97462),t=e(64317),Z=e(5966),T=e(86615),A=e(68602),k=e(28036),I=e(83403),z=e(24963),w=e(1699),te=e(29177),Q=e(45742),q=e(43425),re=e(44349),ae=e(3616),X=e(36146),p=e(85893),se=(0,O.forwardRef)(function(s,ie){var le=(0,O.useState)(!1),ee=U()(le,2),x=ee[0],J=ee[1],F=(0,O.useRef)(),G=(0,O.useContext)(z.Z),K=G.message,B=(0,O.useState)([]),S=U()(B,2),$=S[0],P=S[1],d=new X.Uo("components.permissionButton"),L=g()(g()(g()(g()(g()({},I.W6.CONTAINER,"Id"),I.W6.APPSTORE,"name"),I.W6.COMPOSE,"name"),I.W6.REGISTRY,"serverAddress"),I.W6.DOCKER_ENV,"name"),oe=g()(g()(g()(g()(g()({},I.W6.CONTAINER,"name"),I.W6.APPSTORE,"name"),I.W6.COMPOSE,"name"),I.W6.REGISTRY,"title"),I.W6.DOCKER_ENV,"title"),ne=L[s.type],W=oe[s.type],H=s.selected.map(function(l){return l[L[s.type]]});return O.useEffect(function(){if(x){if(!s.selected||s.selected.length==0){K.error(X.FD.format("message.noDataSelect")),J(!1);return}(0,A.dP)({permission:{uri:s.type,key:ne,value:H}}).then(function(l){var r;(r=F.current)===null||r===void 0||r.setFieldValue("list",Object.keys(l.data.list).map(function(_){return{name:_,type:l.data.list[_].type,users:l.data.list[_].users}}))}),(0,A.lE)().then(function(l){var r,_=(r=l.data)===null||r===void 0||(r=r.list)===null||r===void 0?void 0:r.map(function(m){return{label:m.username,value:m.username}});P(_)})}},[x]),(0,p.jsx)(w.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,p.jsxs)(n.a,{name:"create",title:d.format("drawerTitle"),open:x,onOpenChange:function(r){if(!r){var _;(_=F.current)===null||_===void 0||_.resetFields()}J(r)},drawerProps:{forceRender:!0,width:ae.R_},formRef:F,trigger:(0,p.jsx)(k.ZP,{icon:(0,p.jsx)(te.Z,{}),children:d.format("drawerTriggerButton")}),onFinish:function(){var l=D()(u()().mark(function r(_){var m,f,v;return u()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:m=c()(_.list),E.prev=1,m.s();case 3:if((f=m.n()).done){E.next=9;break}return v=f.value,E.next=7,(0,A.Db)({usernames:v.users,permissionType:v.type,permission:{uri:s.type,key:ne,showKey:W,value:[v.name]}});case 7:E.next=3;break;case 9:E.next=14;break;case 11:E.prev=11,E.t0=E.catch(1),m.e(E.t0);case 14:return E.prev=14,m.f(),E.finish(14);case 17:K.success(X.FD.format("finish")),J(!1),s.onSuccess();case 20:case"end":return E.stop()}},r,null,[[1,11,14,17]])}));return function(r){return l.apply(this,arguments)}}(),children:[(0,p.jsxs)(j.Z,{ghost:!0,title:(0,p.jsx)(Q.Z,{}),subTitle:d.format("batchTitle"),children:[(0,p.jsx)(o.A.Item,{name:"type",style:{marginBottom:0},children:(0,p.jsx)(a.Z.Group,{defaultValue:"admin",onChange:function(r){var _,m,f=(_=F.current)===null||_===void 0?void 0:_.getFieldValue("list");f.forEach(function(v){v.type=r,v.users=[]}),(m=F.current)===null||m===void 0||m.setFieldValue("list",f)},children:["admin","restricted","public"].map(function(l){return(0,p.jsx)(a.Z,{style:{width:240},title:d.format("dataTypeOption.".concat(l)),description:d.format("dataTypeOptionDesc.".concat(l)),value:l},l)})})}),(0,p.jsx)(h.Z,{name:["type"],children:function(r){var _=r.type;if(_==="restricted")return(0,p.jsx)(t.Z,{mode:"multiple",name:"usernames",label:d.format("formUsernames"),onChange:function(f){var v,V,E=(v=F.current)===null||v===void 0?void 0:v.getFieldValue("list");E.forEach(function(N){N.users=f}),(V=F.current)===null||V===void 0||V.setFieldValue("list",E)},rules:[{required:!0}],request:D()(u()().mark(function m(){var f,v,V;return u()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(!($.length>0)){N.next=2;break}return N.abrupt("return",$);case 2:return N.next=4,(0,A.lE)();case 4:return v=N.sent,V=(f=v.data)===null||f===void 0||(f=f.list)===null||f===void 0?void 0:f.map(function(ue){return{label:ue.username,value:ue.username}}),P(V),N.abrupt("return",V);case 8:case"end":return N.stop()}},m)}))})}})]}),(0,p.jsx)(j.Z,{ghost:!0,title:(0,p.jsx)(q.Z,{}),subTitle:d.format("dataTitle"),children:(0,p.jsx)(re.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:d.format("dataName"),render:function(r,_,m){var f=m.getCurrentRowData();return(0,p.jsx)(Z.Z,{disabled:!0,label:d.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:d.format("dataType"),render:function(r,_,m){var f=m.getCurrentRowData();return(0,p.jsx)(T.Z.Group,{label:d.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(v){return{label:d.format("dataTypeOption.".concat(v)),value:v}})})}},{name:"users",label:d.format("dataUsers"),render:function(r,_,m){return(0,p.jsx)(h.Z,{name:["type"],children:function(v){var V=v.type;if(V=="restricted")return(0,p.jsx)(t.Z,{width:"sm",mode:"tags",name:"users",label:d.format("dataUsers"),options:$})}})}}]})})]})})});M.Z=se},3616:function(Y,M,e){e.d(M,{Ed:function(){return c},FK:function(){return u},R_:function(){return C},ob:function(){return y}});var C=window.innerWidth<=1024?"90vw":"65vw",u="90vw",y="60vw",c="50vh"},24963:function(Y,M,e){var C=e(67294),u=(0,C.createContext)({});M.Z=u},39900:function(Y,M,e){e.r(M),e.d(M,{default:function(){return ee}});var C=e(15009),u=e.n(C),y=e(99289),c=e.n(y),b=e(1699),D=e(80821),R=e(36435),g=e(83403),i=e(75870),U=e(67255),O=e(86548),n=e(90078),j=e(78099),o=e(82346),a=e(42075),h=e(96074),t=e(28036),Z=e(83062),T=e(67294),A=e(36146),k=e(5574),I=e.n(k),z=e(3616),w=e(24963),te=e(184),Q=e(5966),q=e(52688),re=e(97462),ae=e(90672),X=e(62370),p=e(25593),se=e(66309),s=e(85893),ie=(0,T.forwardRef)(function(x,J){var F=(0,T.useState)(!1),G=I()(F,2),K=G[0],B=G[1],S=(0,T.useRef)(),$=(0,T.useState)(0),P=I()($,2),d=P[0],L=P[1],oe=(0,T.useContext)(w.Z),ne=oe.message,W=new A.Uo("components.image");return(0,T.useImperativeHandle)(J,function(){return{setEditId:function(l){(0,i.t1)({id:l}).then(function(r){var _;B(!0),L(l),(_=S.current)===null||_===void 0||_.setFieldsValue({title:r.data.info.title,serverAddress:r.data.info.serverAddress,username:r.data.info.setting.username,password:r.data.info.setting.password,proxy:r.data.info.setting.proxy.join(`
`),enableHttp:r.data.info.setting.enableHttp,enableAuth:!!r.data.info.setting.username})})}}}),(0,s.jsxs)(te.a,{drawerProps:{forceRender:!0,width:z.R_},name:"createRegisry",title:W.format("registryCreateTitle"),open:K,onOpenChange:function(l){B(l)},layout:"horizontal",labelCol:{span:5,offset:0},formRef:S,trigger:(0,s.jsx)(t.ZP,{type:"primary",onClick:function(){var l;(l=S.current)===null||l===void 0||l.resetFields(),L(0)},children:W.format("registryCreateTirggerButton")}),onFinish:function(){var H=c()(u()().mark(function l(r){var _,m,f,v;return u()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,(0,i.ZH)({id:d,title:r.title,serverAddress:r.serverAddress,username:(_=r.username)!==null&&_!==void 0?_:"",password:(m=r.password)!==null&&m!==void 0?m:"",proxy:r.proxy?r.proxy.split(`
`):[],enableHttp:r.enableHttp});case 2:if(f=E.sent,!(f&&f.data&&f.data.id>0)){E.next=8;break}return ne.success(A.FD.format("finish")),x.onFinish&&x.onFinish(),(v=S.current)===null||v===void 0||v.resetFields(),E.abrupt("return",!0);case 8:case"end":return E.stop()}},l)}));return function(l){return H.apply(this,arguments)}}(),children:[(0,s.jsx)(Q.Z,{label:W.format("registryCreateFormTitle"),name:"title",placeholder:W.format("registryCreateFormTitleEmpty"),disabled:d==-1,required:!0}),(0,s.jsx)(Q.Z,{label:W.format("registryCreateFormServerAddress"),name:"serverAddress",placeholder:"ccr.ccs.tencentyun.com, docker.io, 127.0.0.1:5000",disabled:d==-1,required:!0,rules:[{required:!0}]}),(0,s.jsx)(q.Z,{tooltip:W.format("registryCreateFormEnableHttpTip"),label:W.format("registryCreateFormEnableHttp"),name:"enableHttp"}),(0,s.jsx)(q.Z,{label:W.format("registryCreateFormEnableAuth"),name:"enableAuth"}),(0,s.jsx)(re.Z,{name:["enableAuth"],children:function(l){var r=l.enableAuth;return r&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Q.Z,{label:W.format("registryCreateFormUsername"),name:"username",placeholder:W.format("registryCreateFormUsernameEmpty"),tooltip:""},"username"),(0,s.jsx)(Q.Z.Password,{label:W.format("registryCreateFormPassword"),name:"password",allowClear:!0,placeholder:W.format("registryCreateFormPasswordEmpty")},"password")]})}}),(0,s.jsx)(ae.Z,{label:W.format("registryCreateFormProxy"),name:"proxy",fieldProps:{autoSize:{minRows:10}},placeholder:W.format("registryCreateFormProxyTip")}),(0,s.jsx)(X.Z,{label:W.format("registryCreateFormProxyRecommand"),children:(0,s.jsx)(a.Z,{wrap:!0,children:["docker.1panel.live","docker.m.daocloud.io","docker.1ms.run"].map(function(H,l){return(0,s.jsx)(p.Z.Link,{onClick:function(){var _,m,f=[];if((_=S.current)!==null&&_!==void 0&&_.getFieldValue("proxy")){var v;f=(v=S.current)===null||v===void 0?void 0:v.getFieldValue("proxy").split(`
`)}else f=[];f.includes(H)||f.push(H),(m=S.current)===null||m===void 0||m.setFieldValue("proxy",f.join(`
`))},children:(0,s.jsx)(se.Z,{color:"cyan",children:H})},l)})})},"recommend")]})}),le=ie;function ee(){var x=(0,T.useRef)(),J=(0,T.useRef)(),F=(0,o.useAccess)();return(0,s.jsx)(n._z,{header:{extra:[(0,s.jsx)(b.u,{access:"canSeeImageRegistryManage",children:(0,s.jsx)(le,{onFinish:function(){var K,B;!((K=x.current)===null||K===void 0)&&K.reloadAndRest&&((B=x.current)===null||B===void 0||B.reloadAndRest())},ref:J},"create")},"create")]},children:(0,s.jsx)(j.Z,{scroll:{x:"max-content"},rowKey:"id",columns:[{title:A.FD.format("listTitle"),ellipsis:!0,dataIndex:"title"},{title:"Url",dataIndex:"serverAddress"},{title:A.FD.format("listUsername"),dataIndex:["setting","username"],search:!1},{title:A.FD.format("listManage"),width:100,search:!1,fixed:"right",hidden:!F.canSeeImageRegistryManage,render:function(K,B,S,$,P){return(0,s.jsx)(a.Z,{split:(0,s.jsx)(h.Z,{type:"vertical"}),children:(0,s.jsx)(t.ZP,{type:"link",onClick:function(){var L;(L=J.current)===null||L===void 0||L.setEditId(B.id)},children:(0,s.jsx)(Z.Z,{title:A.FD.format("listManageEdit"),children:(0,s.jsx)(O.Z,{})})})})}}],request:function(){var G=c()(u()().mark(function K(B,S,$){var P;return u()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.next=2,(0,i.Ot)({title:B.title,serverAddress:B.serverAddress});case 2:return P=L.sent,L.abrupt("return",{data:P.data.list,success:!0,total:P.data.list.length});case 4:case"end":return L.stop()}},K)}));return function(K,B,S){return G.apply(this,arguments)}}(),toolBarRender:function(){return[]},rowSelection:F.canSeeImageRegistryManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0}:void 0,pagination:(0,U.O)(),actionRef:x,tableAlertOptionRender:function(K){var B=K.selectedRowKeys,S=K.selectedRows;return(0,s.jsxs)(a.Z,{size:16,children:[(0,s.jsx)(R.Z,{type:g.W6.REGISTRY,selected:S,onSuccess:function(){var P,d;return!((P=x.current)===null||P===void 0)&&P.reloadAndRest&&((d=x.current)===null||d===void 0||d.reloadAndRest()),!0}}),(0,s.jsx)(D.Z,{danger:!0,type:"primary",action:function(){return(0,i.ix)({id:B})},onSuccess:function(){var P,d;return!((P=x.current)===null||P===void 0)&&P.reloadAndRest&&((d=x.current)===null||d===void 0||d.reloadAndRest()),!0},onError:function(){var P,d;return!((P=x.current)===null||P===void 0)&&P.reset&&((d=x.current)===null||d===void 0||d.reset()),!0},confirm:"notification.confirm.title",children:A.FD.format("listManageDeleteBatch")})]})}})})}},75870:function(Y,M,e){e.d(M,{Ot:function(){return D},ZH:function(){return g},ix:function(){return U},t1:function(){return n}});var C=e(15009),u=e.n(C),y=e(99289),c=e.n(y),b=e(82346);function D(o){return R.apply(this,arguments)}function R(){return R=c()(u()().mark(function o(a){return u()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,b.request)("/api/common/registry/get-list",{method:"POST",data:a}));case 1:case"end":return t.stop()}},o)})),R.apply(this,arguments)}function g(o){return i.apply(this,arguments)}function i(){return i=c()(u()().mark(function o(a){return u()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,b.request)("/api/common/registry/create",{method:"POST",data:a}));case 1:case"end":return t.stop()}},o)})),i.apply(this,arguments)}function U(o){return O.apply(this,arguments)}function O(){return O=c()(u()().mark(function o(a){return u()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,b.request)("/api/common/registry/delete",{method:"POST",data:a}));case 1:case"end":return t.stop()}},o)})),O.apply(this,arguments)}function n(o){return j.apply(this,arguments)}function j(){return j=c()(u()().mark(function o(a){return u()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,b.request)("/api/common/registry/get-detail",{method:"POST",data:a}));case 1:case"end":return t.stop()}},o)})),j.apply(this,arguments)}},67255:function(Y,M,e){e.d(M,{O:function(){return C},j:function(){return u}});function C(y){var c=localStorage.getItem("dpanel-pagesize");return c=="all"?!1:{defaultCurrent:y==null?void 0:y.page,showSizeChanger:!0,defaultPageSize:parseInt(c!=null?c:"20"),onChange:function(D,R){localStorage.setItem("dpanel-page-"+location.pathname.split("/").slice(-2).join("-"),"".concat(D))}}}function u(y){var c="dpanel-table-column-".concat(y),b={};if(localStorage.getItem(c)){var D;b=JSON.parse((D=localStorage.getItem(c))!==null&&D!==void 0?D:"{}")}return{defaultValue:b,onChange:function(g){localStorage.setItem("dpanel-table-column-".concat(y),JSON.stringify(g))}}}}}]);
