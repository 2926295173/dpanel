"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8022],{91806:function(Y,x,e){e.d(x,{Z:function(){return c}});var L=e(87462),M=e(67294),A={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-40 824H232V687h97.9c11.6 32.8 32 62.3 59.1 84.7 34.5 28.5 78.2 44.3 123 44.3s88.5-15.7 123-44.3c27.1-22.4 47.5-51.9 59.1-84.7H792v-63H643.6l-5.2 24.7C626.4 708.5 573.2 752 512 752s-114.4-43.5-126.5-103.3l-5.2-24.7H232V136h560v752zM320 341h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm0 160h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}}]},name:"container",theme:"outlined"},v=A,U=e(84089),O=function(z,y){return M.createElement(U.Z,(0,L.Z)({},z,{ref:y,icon:v}))},b=M.forwardRef(O),c=b},44349:function(Y,x,e){var L=e(97857),M=e.n(L),A=e(17186),v=e(5966),U=e(86250),O=e(67294),b=e(85893),c=(0,O.forwardRef)(function(m,z){var y=(0,O.useRef)();(0,O.useImperativeHandle)(z,function(){return{addItem:function(P,B){var I,u=(I=y.current)===null||I===void 0?void 0:I.getList(),H=!1;if(u==null||u.map(function(N){if(N.name==P){H=!0;return}}),!H){var S;(S=y.current)===null||S===void 0||S.add({name:P,value:B})}},clear:function(){var P;(P=y.current)===null||P===void 0||(P=P.getList())===null||P===void 0||P.map(function(B,I){var u;(u=y.current)===null||u===void 0||u.remove(I)})}}});var Q={};return m.hideCopyButton===!0&&(Q.copyIconProps=!1),m.hideDeleteButton===!0&&(Q.deleteIconProps=!1),(0,b.jsx)(A.u,M()(M()({initialValue:m.initialValue,label:m.label,name:m.name,actionRef:y,creatorButtonProps:m.showAddButton?{creatorButtonText:"\u6DFB\u52A0"+(m.label?m.label:m.name)}:!1,min:m.min?m.min:0},Q),{},{children:function(P,B,I){return(0,b.jsx)(U.Z,{justify:m.justify,gap:m.gap,children:m.items.map(function(u){return u.render?(0,b.jsx)("div",{children:u.render&&u.render(P,B,I)},"".concat(m.name,"-").concat(u.name,"-").concat(P.key)):(0,b.jsx)(v.Z,{width:u.width,name:u.name,label:u.label,required:u.required,rules:[{required:u.required}],disabled:u.disabled,placeholder:u.placeholder},"".concat(m.name,"-").concat(u.name,"-").concat(P.key))})})}}))});x.Z=c},36435:function(Y,x,e){var L=e(15009),M=e.n(L),A=e(64599),v=e.n(A),U=e(99289),O=e.n(U),b=e(9783),c=e.n(b),m=e(5574),z=e.n(m),y=e(67294),Q=e(184),Z=e(38345),P=e(97269),B=e(97321),I=e(97462),u=e(64317),H=e(5966),S=e(86615),N=e(68602),ne=e(28036),W=e(83403),te=e(24963),K=e(1699),r=e(29177),se=e(45742),oe=e(43425),le=e(44349),ae=e(3616),J=e(36146),f=e(85893),ie=(0,y.forwardRef)(function(d,w){var X=(0,y.useState)(!1),_=z()(X,2),T=_[0],k=_[1],G=(0,y.useRef)(),q=(0,y.useContext)(te.Z),ee=q.message,re=(0,y.useState)([]),j=z()(re,2),i=j[0],t=j[1],a=new J.Uo("components.permissionButton"),o=c()(c()(c()(c()(c()({},W.W6.CONTAINER,"Id"),W.W6.APPSTORE,"name"),W.W6.COMPOSE,"name"),W.W6.REGISTRY,"serverAddress"),W.W6.DOCKER_ENV,"name"),s=c()(c()(c()(c()(c()({},W.W6.CONTAINER,"name"),W.W6.APPSTORE,"name"),W.W6.COMPOSE,"name"),W.W6.REGISTRY,"title"),W.W6.DOCKER_ENV,"title"),E=o[d.type],C=s[d.type],$=d.selected.map(function(n){return n[o[d.type]]});return y.useEffect(function(){if(T){if(!d.selected||d.selected.length==0){ee.error(J.FD.format("message.noDataSelect")),k(!1);return}(0,N.dP)({permission:{uri:d.type,key:E,value:$}}).then(function(n){var l;(l=G.current)===null||l===void 0||l.setFieldValue("list",Object.keys(n.data.list).map(function(h){return{name:h,type:n.data.list[h].type,users:n.data.list[h].users}}))}),(0,N.lE)().then(function(n){var l,h=(l=n.data)===null||l===void 0||(l=l.list)===null||l===void 0?void 0:l.map(function(p){return{label:p.username,value:p.username}});t(h)})}},[T]),(0,f.jsx)(K.u,{access:["canSeeEnableEe","canSeeFounder","canSeeManage"],children:(0,f.jsxs)(Q.a,{name:"create",title:a.format("drawerTitle"),open:T,onOpenChange:function(l){if(!l){var h;(h=G.current)===null||h===void 0||h.resetFields()}k(l)},drawerProps:{forceRender:!0,width:ae.R_},formRef:G,trigger:(0,f.jsx)(ne.ZP,{icon:(0,f.jsx)(r.Z,{}),children:a.format("drawerTriggerButton")}),onFinish:function(){var n=O()(M()().mark(function l(h){var p,R,g;return M()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:p=v()(h.list),D.prev=1,p.s();case 3:if((R=p.n()).done){D.next=9;break}return g=R.value,D.next=7,(0,N.Db)({usernames:g.users,permissionType:g.type,permission:{uri:d.type,key:E,showKey:C,value:[g.name]}});case 7:D.next=3;break;case 9:D.next=14;break;case 11:D.prev=11,D.t0=D.catch(1),p.e(D.t0);case 14:return D.prev=14,p.f(),D.finish(14);case 17:ee.success(J.FD.format("finish")),k(!1),d.onSuccess();case 20:case"end":return D.stop()}},l,null,[[1,11,14,17]])}));return function(l){return n.apply(this,arguments)}}(),children:[(0,f.jsxs)(Z.Z,{ghost:!0,title:(0,f.jsx)(se.Z,{}),subTitle:a.format("batchTitle"),children:[(0,f.jsx)(P.A.Item,{name:"type",style:{marginBottom:0},children:(0,f.jsx)(B.Z.Group,{defaultValue:"admin",onChange:function(l){var h,p,R=(h=G.current)===null||h===void 0?void 0:h.getFieldValue("list");R.forEach(function(g){g.type=l,g.users=[]}),(p=G.current)===null||p===void 0||p.setFieldValue("list",R)},children:["admin","restricted","public"].map(function(n){return(0,f.jsx)(B.Z,{style:{width:240},title:a.format("dataTypeOption.".concat(n)),description:a.format("dataTypeOptionDesc.".concat(n)),value:n},n)})})}),(0,f.jsx)(I.Z,{name:["type"],children:function(l){var h=l.type;if(h==="restricted")return(0,f.jsx)(u.Z,{mode:"multiple",name:"usernames",label:a.format("formUsernames"),onChange:function(R){var g,F,D=(g=G.current)===null||g===void 0?void 0:g.getFieldValue("list");D.forEach(function(V){V.users=R}),(F=G.current)===null||F===void 0||F.setFieldValue("list",D)},rules:[{required:!0}],request:O()(M()().mark(function p(){var R,g,F;return M()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(!(i.length>0)){V.next=2;break}return V.abrupt("return",i);case 2:return V.next=4,(0,N.lE)();case 4:return g=V.sent,F=(R=g.data)===null||R===void 0||(R=R.list)===null||R===void 0?void 0:R.map(function(ue){return{label:ue.username,value:ue.username}}),t(F),V.abrupt("return",F);case 8:case"end":return V.stop()}},p)}))})}})]}),(0,f.jsx)(Z.Z,{ghost:!0,title:(0,f.jsx)(oe.Z,{}),subTitle:a.format("dataTitle"),children:(0,f.jsx)(le.Z,{name:"list",hideCopyButton:!0,gap:10,items:[{name:"name",label:a.format("dataName"),render:function(l,h,p){var R=p.getCurrentRowData();return(0,f.jsx)(H.Z,{disabled:!0,label:a.format("dataName"),width:"sm",name:"name"})}},{name:"type",label:a.format("dataType"),render:function(l,h,p){var R=p.getCurrentRowData();return(0,f.jsx)(S.Z.Group,{label:a.format("dataType"),name:"type",radioType:"button",options:["admin","public","restricted"].map(function(g){return{label:a.format("dataTypeOption.".concat(g)),value:g}})})}},{name:"users",label:a.format("dataUsers"),render:function(l,h,p){return(0,f.jsx)(I.Z,{name:["type"],children:function(g){var F=g.type;if(F=="restricted")return(0,f.jsx)(u.Z,{width:"sm",mode:"tags",name:"users",label:a.format("dataUsers"),options:i})}})}}]})})]})})});x.Z=ie},96781:function(Y,x,e){var L=e(67294),M=(0,L.createContext)({});x.Z=M},83536:function(Y,x,e){e.r(x),e.d(x,{default:function(){return ie}});var L=e(64599),M=e.n(L),A=e(15009),v=e.n(A),U=e(99289),O=e.n(U),b=e(80821),c=e(90098),m=e(43425),z=e(23430),y=e(90078),Q=e(41482),Z=e(82346),P=e(28036),B=e(25593),I=e(42075),u=e(96074),H=e(83062),S=e(67294),N=e(94359),ne=e(67255),W=e(93162),te=e(24963),K=e(66309),r=e(85893);function se(d){var w=(0,Z.useIntl)(),X=(0,S.useContext)(te.Z),_=X.lang,T;if(!d.type)T=(0,r.jsx)(K.Z,{children:_("compose.type.default")});else switch(d.type){case"remoteUrl":T=(0,r.jsx)(K.Z,{color:"cyan",children:_("compose.type.".concat(d.type))});break;case"serverPath":T=(0,r.jsx)(K.Z,{color:"blue",children:_("compose.type.".concat(d.type))});break;case"storagePath":T=(0,r.jsx)(K.Z,{color:"geekblue",children:_("compose.type.".concat(d.type))});break;case"outPath":T=(0,r.jsx)(K.Z,{color:"yellow",children:_("compose.type.".concat(d.type))});break;case"store":T=(0,r.jsx)(K.Z,{color:"green",children:_("compose.type.".concat(d.type))});break;case"dangling":T=(0,r.jsx)(K.Z,{color:"error",children:_("compose.type.".concat(d.type))});break;default:T=(0,r.jsx)(K.Z,{children:_("compose.type.".concat(d.type))})}return(0,r.jsx)(H.Z,{title:d.tootip,children:T})}var oe=e(96781),le=e(69626),ae=e(1699),J=e(83403),f=e(36435);function ie(){var d,w,X=(0,S.useContext)(oe.Z),_=X.listTableRef,T=(0,S.useContext)(te.Z),k=T.lang,G=T.notice,q=(0,S.useRef)(),ee=(0,Z.useAccess)(),re=(0,Z.useLocation)();return(0,r.jsxs)(y._z,{header:{extra:[(0,r.jsx)(ae.u,{access:"canSeeComposeListManageCreate",children:(0,r.jsx)(Z.Link,{to:"/compose/create",reloadDocument:re.search.length>0,children:(0,r.jsx)(P.ZP,{type:"primary",children:"\u521B\u5EFA\u4EFB\u52A1"},"createCompose")},"create")},"create")]},children:[(0,r.jsx)(le.Z,{ref:q,onClose:function(){var i;!((i=_.current)===null||i===void 0)&&i.reloadAndRest&&_.current.reloadAndRest()}}),(0,r.jsx)(Q.Z,{scroll:{x:"max-content"},request:function(){var j=O()(v()().mark(function i(t){var a;return v()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,c.pm)({title:t.title,name:t.name});case 2:return a=s.sent,s.abrupt("return",{data:a.data.list,success:!0,total:a.data.list.length});case 4:case"end":return s.stop()}},i)}));return function(i){return j.apply(this,arguments)}}(),rowKey:"name",columns:[{title:"\u6807\u8BC6",dataIndex:"name",width:200,render:function(i,t,a,o,s){return(0,r.jsx)(B.Z.Link,{onClick:function(){var C;(C=q.current)===null||C===void 0||C.show(t.id||t.name)},children:t.name})},sorter:function(i,t){return i.name.localeCompare(t.name)},sortDirections:["descend","ascend"]},{title:"\u9879\u76EE\u540D\u79F0",dataIndex:"title",width:200},{title:"\u7C7B\u578B",width:150,search:!1,render:function(i,t,a,o,s){var E;return(0,r.jsx)(se,{tootip:(E=t.setting.uri)!==null&&E!==void 0?E:"",type:t.setting&&t.setting.type?t.setting.type:""})}},{title:"\u5BB9\u5668\u72B6\u6001",dataIndex:"status",search:!1,width:300,render:function(i,t,a,o,s){return(0,r.jsx)(I.Z,{children:t.setting.status.split(", ").map(function(E,C){var $="running",n=E.indexOf("(");return n>-1?$=E.slice(0,n):$=E,(0,r.jsx)(N.Z,{status:$,message:{content:k("compose.status.".concat($),{count:E.slice(n+1,E.length-1)}),title:t.setting.message,placement:"top",showInTag:!0}},C)})})},sorter:function(i,t){return i.setting.status.localeCompare(t.setting.status)}},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"",search:!1,width:150,render:function(i,t,a,o,s){return t.setting.createdAt?new Date(t.setting.createdAt).toLocaleString():"-"},sorter:function(i,t){var a,o;return new Date((a=i.setting.createdAt)!==null&&a!==void 0?a:"").toLocaleString().localeCompare(new Date((o=t.setting.createdAt)!==null&&o!==void 0?o:"").toLocaleString())}},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"",search:!1,width:150,render:function(i,t,a,o,s){return t.setting.updatedAt?new Date(t.setting.updatedAt).toLocaleString():"-"},sorter:function(i,t){var a,o;return new Date((a=i.setting.updatedAt)!==null&&a!==void 0?a:"").toLocaleString().localeCompare(new Date((o=t.setting.updatedAt)!==null&&o!==void 0?o:"").toLocaleString())}},{title:"\u64CD\u4F5C",width:80,valueType:"option",fixed:"right",key:"option",hidden:!ee.canSeeComposeListManage,render:function(i,t,a,o,s){return t.setting.type!="dangling"&&(0,r.jsxs)(I.Z,{split:(0,r.jsx)(u.Z,{type:"vertical"}),children:[(0,r.jsx)(B.Z.Link,{onClick:function(){var C;(C=q.current)===null||C===void 0||C.show(t.id||t.name)},children:(0,r.jsx)(H.Z,{title:"\u90E8\u7F72",children:(0,r.jsx)(m.Z,{})})},"3"),(0,r.jsx)(B.Z.Link,{onClick:O()(v()().mark(function E(){var C,$;return v()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,(0,c.tw)({id:t.id||t.name});case 2:C=l.sent,$=new Blob([C],{type:"application/zip"}),(0,W.saveAs)($,"compose-"+t.name+".zip");case 5:case"end":return l.stop()}},E)})),children:(0,r.jsx)(H.Z,{title:"\u4E0B\u8F7D",children:(0,r.jsx)(z.Z,{})})},"2")]})}}],rowSelection:ee.canSeeComposeListManage?{defaultSelectedRowKeys:[],alwaysShowAlert:!0,getCheckboxProps:function(i){return{disabled:i.setting.type=="dangling"||i.setting.type=="outPath"}}}:void 0,tableAlertOptionRender:function(i){var t=i.selectedRows;return(0,r.jsxs)(I.Z,{size:16,children:[(0,r.jsx)(f.Z,{type:J.W6.COMPOSE,selected:t,onSuccess:function(){var o,s;return!((o=_.current)===null||o===void 0)&&o.reloadAndRest&&((s=_.current)===null||s===void 0||s.reloadAndRest()),!0}}),(0,r.jsx)(ae.u,{access:"canSeeComposeListManageDelete",children:(0,r.jsx)(b.Z,{danger:!0,type:"primary",action:O()(v()().mark(function a(){var o,s,E,C;return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0,s=M()(t),n.prev=2,s.s();case 4:if((E=s.n()).done){n.next=11;break}return C=E.value,n.next=8,(0,c.mg)({id:C.id||C.name});case 8:o=n.sent;case 9:n.next=4;break;case 11:n.next=16;break;case 13:n.prev=13,n.t0=n.catch(2),s.e(n.t0);case 16:return n.prev=16,s.f(),n.finish(16);case 19:n.next=23;break;case 21:n.prev=21,n.t1=n.catch(0);case 23:return n.abrupt("return",(0,c.ik)({id:t.map(function(l){return l.id})}));case 24:case"end":return n.stop()}},a,null,[[0,21],[2,13,16,19]])})),onSuccess:function(){var o,s;return!((o=_.current)===null||o===void 0)&&o.reloadAndRest&&((s=_.current)===null||s===void 0||s.reloadAndRest()),!0},onError:function(){var o,s;return!((o=_.current)===null||o===void 0)&&o.reset&&((s=_.current)===null||s===void 0||s.reset()),!0},confirm:"notification.confirm.title",children:"\u6279\u91CF\u5220\u9664"})})]})},pagination:(0,ne.O)({page:(d=(w=re.state)===null||w===void 0?void 0:w.page)!==null&&d!==void 0?d:1}),search:{collapsed:!1},actionRef:_,columnsState:(0,ne.j)("compose-list")})]})}},67255:function(Y,x,e){e.d(x,{O:function(){return L},j:function(){return M}});function L(A){var v=localStorage.getItem("dpanel-pagesize");return v=="all"?!1:{defaultCurrent:A==null?void 0:A.page,showSizeChanger:!0,defaultPageSize:parseInt(v!=null?v:"20"),onChange:function(O,b){localStorage.setItem("dpanel-page-"+location.pathname.split("/").slice(-2).join("-"),"".concat(O))}}}function M(A){var v="dpanel-table-column-".concat(A),U={};if(localStorage.getItem(v)){var O;U=JSON.parse((O=localStorage.getItem(v))!==null&&O!==void 0?O:"{}")}return{defaultValue:U,onChange:function(c){localStorage.setItem("dpanel-table-column-".concat(A),JSON.stringify(c))}}}}}]);
