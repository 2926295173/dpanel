"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2958],{80821:function(oe,V,e){e.d(V,{Z:function(){return te}});var z=e(97857),l=e.n(z),_=e(5574),C=e.n(_),ae=e(24963),se=e(36146),T=e(86738),O=e(83062),y=e(96074),m=e(83622),N=e(67294),x=e(85893);function te(a){var fe=(0,N.useState)(!1),ie=C()(fe,2),q=ie[0],X=ie[1],me=(0,N.useContext)(ae.Z),ee=me.message,Y=new se.Uo,c=function(){X(!0);var Z=a.action();Z instanceof Promise?Z.then(function(re){if(X(!1),re){typeof a.onSuccess=="function"&&a.onSuccess(re);var k="";a.messageSuccess?typeof a.messageSuccess=="function"?k=a.messageSuccess(re):k=a.messageSuccess.indexOf("notification.")==0?Y.format(a.messageSuccess):a.messageSuccess:k=Y.format("notification.finish"),a.asynced?ee.info(k):ee.success(k)}}).catch(function(re){X(!1),typeof a.onError=="function"&&a.onError(re)}):X(!1)};return a.confirm?(0,x.jsx)(T.Z,l()(l()({style:{width:500},title:a.confirmTitle?a.confirmTitle:Y.format("notification.title.tip"),description:typeof a.confirm=="string"&&a.confirm.indexOf("notification.")==0?Y.format(a.confirm):a.confirm,onConfirm:c,okText:"Yes",cancelText:"No",onOpenChange:a.confirmOnOpenChange},a.confirmProps),{},{children:(0,x.jsxs)(O.Z,{title:a.tips,children:[a.showDivider&&(0,x.jsx)(y.Z,{type:"vertical",style:{marginRight:15}}),(0,x.jsx)(m.ZP,{block:a.block,disabled:a.disabled,icon:!a.children&&q?void 0:a.icon,loading:q,danger:a.danger,type:a.type,children:a.children})]})})):(0,x.jsxs)(O.Z,{title:a.tips,children:[a.showDivider&&(0,x.jsx)(y.Z,{type:"vertical",style:{marginRight:15}}),(0,x.jsx)(m.ZP,{block:a.block,style:a.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:a.disabled,icon:!a.children&&q?void 0:a.icon,loading:q,onClick:c,danger:a.danger,type:a.type,children:a.children})]})}},3616:function(oe,V,e){e.d(V,{Ed:function(){return C},FK:function(){return l},R_:function(){return z},ob:function(){return _}});var z=window.innerWidth<=1024?"90vw":"65vw",l="90vw",_="60vw",C="50vh"},24963:function(oe,V,e){var z=e(67294),l=(0,z.createContext)({});V.Z=l},59549:function(oe,V,e){e.r(V),e.d(V,{default:function(){return Ve}});var z=e(15009),l=e.n(z),_=e(99289),C=e.n(_),ae=e(9783),se=e.n(ae),T=e(19632),O=e.n(T),y=e(80821),m=e(68602),N=e(67255),x=e(36693),te=e(43425),a=e(88641),fe=e(90078),ie=e(56729),q=e(66309),X=e(42075),me=e(96074),ee=e(25593),Y=e(83062),c=e(67294),ve=e(5574),Z=e.n(ve),re=e(83622),k=e(184),ce=e(5966),he=e(64317),je=e(52688),Pe=e(90672),ue=e(3616),F=e(83403),ye=e(87662),$=e(36146),r=e(85893),Ce=(0,c.forwardRef)(function(b,H){var K=(0,c.useState)(!1),v=Z()(K,2),R=v[0],g=v[1],u=(0,c.useRef)(),i=new $.Uo("components.userInvite"),s=new $.Uo("system.user");(0,c.useImperativeHandle)(H,function(){return{edit:function(o){var f;(f=u.current)===null||f===void 0||f.setFieldsValue({username:o.username}),g(!0)},show:function(){var o;(o=u.current)===null||o===void 0||o.resetFields(),g(!0)}}}),c.useEffect(function(){if(R){var d;(d=u.current)===null||d===void 0||d.resetFields()}},[R,u]);var n=function(){var d=C()(l()().mark(function o(){var f,t,E,A,D,G;return l()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,(f=u.current)===null||f===void 0?void 0:f.validateFields();case 3:return t=S.sent,E={username:t.username,userRole:t.userRole||"member",email:t.email,userStatus:t.userStatus||"enable",securityPassword:t.securityPassword||!0},S.next=7,(0,m.mX)(E);case 7:if(A=S.sent,E.userRole==="manager"&&(0,m.SS)({username:E.username,menuPermissionNames:F.Wy}),E.userStatus==="disable"&&(0,m.az)({username:E.username,status:1}),!E.email){S.next=15;break}return S.next=13,(0,ye.pe)({groupName:"setting",name:"emailServer"});case 13:G=S.sent,(D=G.data)!==null&&D!==void 0&&(D=D.status)!==null&&D!==void 0&&D.includes("register")&&(0,m.sI)({username:E.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(A.data.token)});case 15:return b.onFinish&&b.onFinish(),S.abrupt("return",!0);case 19:return S.prev=19,S.t0=S.catch(0),S.abrupt("return",!1);case 22:case"end":return S.stop()}},o,null,[[0,19]])}));return function(){return d.apply(this,arguments)}}();return(0,r.jsxs)(k.a,{name:"create",title:i.format("drawerTitle"),open:R,onOpenChange:function(o){if(!o){var f;(f=u.current)===null||f===void 0||f.resetFields()}g(o)},drawerProps:{forceRender:!0,width:ue.R_},formRef:u,trigger:(0,r.jsx)(re.ZP,{type:"primary",children:i.format("drawerTitle")}),onFinish:C()(l()().mark(function d(){return l()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,n();case 2:return f.abrupt("return",f.sent);case 3:case"end":return f.stop()}},d)})),children:[(0,r.jsx)(ce.Z,{label:i.format("formUsername"),name:"username",required:!0,rules:[{required:!0}]}),(0,r.jsx)(ce.Z,{label:i.format("formEmail"),name:"email",placeholder:"",rules:[{type:"email"}]}),(0,r.jsx)(he.Z,{label:i.format("formUserRole"),name:"userRole",tooltip:i.format("formUserRoleTip"),required:!0,fieldProps:{defaultValue:"member"},options:s.option("listUserRoleOption",["manager","member"])}),(0,r.jsx)(he.Z,{label:i.format("formUserStatus"),name:"userStatus",fieldProps:{defaultValue:"enable"},required:!0,options:s.option("listStatusOption",["enable","disable"])}),(0,r.jsx)(je.Z,{label:i.format("formSecurityPassword"),name:"securityPassword",fieldProps:{defaultChecked:!0}}),(0,r.jsx)(Pe.Z,{label:i.format("formRemark"),name:"remark",fieldProps:{rows:4}})]})}),Oe=Ce,be=e(38345),Ee=e(63434),De=e(71230),we=e(15746),xe=e(84567),Ze=e(85265),Ue=e(82346),Te=(0,c.forwardRef)(function(b,H){(0,c.useImperativeHandle)(H,function(){return{show:function(P){return C()(l()().mark(function B(){var U,W,M,le,Se,Q,pe;return l()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return M=P.username,le=P.uri,(U=E.current)===null||U===void 0||U.resetFields(),g(M),n(le),J.next=6,(0,m.q4)({username:M});case 6:if(Se=J.sent,Q=(W=Se.data)===null||W===void 0||(W=W.permissions)===null||W===void 0?void 0:W[le],!Q){J.next=16;break}return J.next=11,(0,Ue.request)(Q.uri,{method:"POST"});case 11:pe=J.sent,S(pe.data.list.filter(function(de){return Q.value.includes(de[Q.key])}).map(function(de){return{id:de[Q.key],name:de[Q.showKey]}})),p(Q),J.next=17;break;case 16:S([]);case 17:t(!0);case 18:case"end":return J.stop()}},B)}))()}}});var K=(0,c.useState)(""),v=Z()(K,2),R=v[0],g=v[1],u=(0,c.useState)(""),i=Z()(u,2),s=i[0],n=i[1],d=(0,c.useState)(!1),o=Z()(d,2),f=o[0],t=o[1],E=(0,c.useRef)(),A=(0,c.useRef)(),D=(0,c.useState)([]),G=Z()(D,2),L=G[0],S=G[1],ne=(0,c.useState)(),I=Z()(ne,2),h=I[0],p=I[1],j=new $.Uo("components.userPermission");return(0,r.jsx)(Ze.Z,{title:j.format("permissionTitle"),open:f,width:ue.R_,destroyOnHidden:!0,onClose:function(){var P;(P=E.current)===null||P===void 0||P.resetFields(),t(!1)},children:(0,r.jsx)(ie.Z,{actionRef:A,search:!1,toolBarRender:!1,scroll:{x:"max-content"},columns:[{key:"name",title:$.FD.format("listTitle"),dataIndex:"name"}],rowKey:"id",dataSource:L,rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},tableAlertOptionRender:function(P){var B=P.selectedRows;return(0,r.jsx)(X.Z,{size:16,wrap:!0,children:(0,r.jsx)(y.Z,{danger:!0,type:"primary",action:C()(l()().mark(function U(){return l()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,(0,m.V9)({username:R,permission:{uri:s,key:"-",value:B.map(function(le){return le.id}),showKey:"-"}});case 2:return M.abrupt("return",!0);case 3:case"end":return M.stop()}},U)})),onSuccess:function(){return t(!1),!0},confirm:"notification.confirm.title",children:$.FD.format("listManageDeleteBatch")})})},pagination:!1})})}),ge=Te,Ae=e(31199),Ie=(0,c.forwardRef)(function(b,H){(0,c.useImperativeHandle)(H,function(){return{show:function(t){return C()(l()().mark(function E(){var A,D;return l()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:D=t.formData,(A=d.current)===null||A===void 0||A.resetFields(),n(D),g(!0);case 4:case"end":return L.stop()}},E)}))()}}});var K=(0,c.useState)(!1),v=Z()(K,2),R=v[0],g=v[1],u=(0,c.useState)({}),i=Z()(u,2),s=i[0],n=i[1],d=(0,c.useRef)(),o=new $.Uo("components.userPermission");return(0,r.jsxs)(k.a,{title:o.format("permissionTitle"),open:R,width:ue.R_,formRef:d,onFinish:function(){var f=C()(l()().mark(function t(E){return l()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return b.onChange(E),g(!1),D.abrupt("return",!0);case 3:case"end":return D.stop()}},t)}));return function(t){return f.apply(this,arguments)}}(),initialValues:s,drawerProps:{width:ue.R_,destroyOnHidden:!0,onClose:function(){var t;(t=d.current)===null||t===void 0||t.resetFields(),g(!1)}},children:[(0,r.jsx)(Ae.Z,{name:"limit",label:o.format("formContainerLimit"),min:0}),(0,r.jsx)(ce.Z,{name:"name",hidden:!0})]})}),Me=Ie,Le=e(24963),We=e(60532),Fe=e(60433),Re=e(25449),$e=(0,c.forwardRef)(function(b,H){(0,c.useImperativeHandle)(H,function(){return{edit:function(h){return C()(l()().mark(function p(){var j,w,P;return l()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return(j=i.current)===null||j===void 0||j.setFieldValue("username",h),U.next=3,(0,m.J5)({username:h});case 3:w=U.sent,w.data.resource?(P={},w.data.resource.forEach(function(W){P[W.name]=W}),S(P)):S({}),w.data.menus?(w.data.menus.map(function(W){var M;(M=i.current)===null||M===void 0||M.setFieldValue(["permission",W],!0)}),A([].concat(O()(w.data.menus||[]),O()(F.Io)))):A(F.Io),u(!0);case 7:case"end":return U.stop()}},p)}))()}}});var K={canSeeContainerList:F.W6.CONTAINER,canSeeImageRegistry:F.W6.REGISTRY,canSeeComposeList:F.W6.COMPOSE,canSeeSystemAppstore:F.W6.APPSTORE,canSeeSystemEnv:F.W6.DOCKER_ENV},v=(0,c.useState)(!1),R=Z()(v,2),g=R[0],u=R[1],i=(0,c.useRef)(),s=(0,c.useContext)(Le.Z),n=s.message,d=(0,c.useRef)(),o=(0,c.useRef)(),f=(0,c.useState)([]),t=Z()(f,2),E=t[0],A=t[1],D=(0,c.useState)({}),G=Z()(D,2),L=G[0],S=G[1],ne=new $.Uo("components.userPermission");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(k.a,{title:ne.format("drawerTitle"),open:g,onOpenChange:function(h){var p;!h&&((p=i.current)===null||p===void 0||p.resetFields()),u(h)},drawerProps:{forceRender:!0,width:ue.R_},layout:"inline",formRef:i,onValuesChange:function(h,p){var j=Object.keys(h.permission)[0];if(h.permission[j]===!1){for(var w in p.permission)if(w.startsWith(j)){var P;(P=i.current)===null||P===void 0||P.setFieldValue(["permission",w],!1)}}A(Object.keys(p.permission).filter(function(B){return p.permission[B]}))},onFinish:function(){var I=C()(l()().mark(function h(p){var j;return l()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return j=p.permission&&Object.keys(p.permission).filter(function(B){return p.permission[B]&&!F.Io.includes(B)}),j.push.apply(j,O()(F.Io.filter(function(B){return j.some(function(U){return U.startsWith(B)})}))),P.next=4,(0,m.SS)({username:p.username,menuPermissionNames:j,resources:Object.values(L)});case 4:return n.success($.FD.format("finish")),P.abrupt("return",!0);case 6:case"end":return P.stop()}},h)}));return function(h){return I.apply(this,arguments)}}(),children:[(0,r.jsx)(ge,{ref:d}),(0,r.jsx)(ce.Z,{name:"username",hidden:!0}),F.d0.map(function(I){return(0,r.jsxs)(be.Z,{headerBordered:!0,ghost:!0,bodyStyle:{paddingTop:10,paddingBottom:20},title:(0,r.jsx)(We.Z,{}),subTitle:ne.format(I.group),children:[(0,r.jsx)(Ee.Z,{name:["permission",I.group],valuePropName:"checked",initialValue:!0,hidden:!0}),(0,r.jsx)(De.Z,{gutter:[16,16],children:I.permissions.map(function(h){return(0,r.jsx)(we.Z,{span:6,children:(0,r.jsxs)(Re.Z,{children:[(0,r.jsx)(Re.Z,{noStyle:!0,name:["permission",h],valuePropName:"checked",children:(0,r.jsx)(xe.Z,{disabled:!E.includes(h.substring(0,h.search(/[A-Z][^A-Z]*$/))),children:ne.format(h)})}),K[h]&&(0,r.jsx)(Y.Z,{title:ne.format("dataPermissionButton"),children:(0,r.jsx)(ee.Z.Link,{onClick:function(){var j,w;(j=d.current)===null||j===void 0||j.show({username:((w=i.current)===null||w===void 0?void 0:w.getFieldValue("username"))||"",uri:K[h]||""})},children:(0,r.jsx)(Fe.Z,{})})}),["canSeeContainerListManageCreate"].includes(h)&&(0,r.jsx)(Y.Z,{title:ne.format("resourcePermssionButton"),children:(0,r.jsx)(ee.Z.Link,{onClick:function(){var j;(j=o.current)===null||j===void 0||j.show({formData:L[h]||{name:h,limit:0}})},children:(0,r.jsx)(te.Z,{})})})]})},h)})})]},I.group)})]}),(0,r.jsx)(ge,{ref:d}),(0,r.jsx)(Me,{onChange:function(h){var p;L[h.name]=h,(0,m.SS)({username:((p=i.current)===null||p===void 0?void 0:p.getFieldValue("username"))||"",menuPermissionNames:E,resources:Object.values(L)})},resourcePermissionsData:L,ref:o})]})}),Ke=$e,Be=e(5251);function Ve(){var b=(0,c.useRef)(),H=(0,c.useRef)(),K=(0,c.useRef)(),v=new $.Uo("system.user");return(0,r.jsxs)(fe._z,{header:{extra:[(0,r.jsx)(Oe,{ref:H,onFinish:function(){var g,u;!((g=b.current)===null||g===void 0)&&g.reloadAndRest&&((u=b.current)===null||u===void 0||u.reloadAndRest())}},"invite-user")]},children:[(0,r.jsx)(Ke,{ref:K}),(0,r.jsx)(ie.Z,{scroll:{x:"max-content"},rowKey:"username",columns:[{title:$.FD.format("listUsername"),ellipsis:!0,dataIndex:"username"},{title:v.format("listEmail"),ellipsis:!0,dataIndex:"email"},{title:v.format("listUserRole"),ellipsis:!0,width:100,dataIndex:"userRole",valueEnum:Object.assign.apply(Object,[{}].concat(O()(v.option("listUserRoleOption",["manager","member"]).map(function(R){return se()({},R.value,{text:R.label,status:R.value})})))),render:function(g,u){return(0,r.jsx)(q.Z,{color:v.format("listUserRoleColor."+u.userRole),children:v.format("listUserRoleOption."+u.userRole)})}},{title:v.format("listRegisterAt"),ellipsis:!0,render:function(g,u,i,s){return(0,r.jsx)("div",{children:(0,Be.ZM)(u.registerAt*1e3)},u.username)},search:!1},{title:v.format("listRemark"),ellipsis:!0,dataIndex:"remark",search:!1},{title:v.format("listStatus"),width:100,dataIndex:"status",search:!1,render:function(g,u){return(0,r.jsx)(q.Z,{color:v.format("listStatusColor."+u.status),children:v.format("listStatusOption."+u.status)})}},{title:$.FD.format("listManage"),width:100,search:!1,fixed:"right",render:function(g,u,i){return(0,r.jsxs)(X.Z,{split:(0,r.jsx)(me.Z,{type:"vertical"}),children:[(0,r.jsx)(ee.Z.Link,{copyable:{tooltips:v.format("listManageCopyUrl"),icon:[(0,r.jsx)(x.Z,{})],text:function(){var s=C()(l()().mark(function d(){var o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,m.u1)({username:u.username});case 2:return o=t.sent,t.abrupt("return","".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(o.data.token));case 4:case"end":return t.stop()}},d)}));function n(){return s.apply(this,arguments)}return n}()},style:{color:"inherit"}},"copy-"+i),(0,r.jsx)(Y.Z,{title:v.format("listManageSetting"),children:(0,r.jsx)(ee.Z.Link,{onClick:function(){var n;(n=K.current)===null||n===void 0||n.edit(u.username)},children:(0,r.jsx)(te.Z,{})})}),(0,r.jsx)(y.Z,{ghost:!0,type:"link",tips:v.format("listManageSendEmail"),icon:(0,r.jsx)(a.Z,{}),action:C()(l()().mark(function s(){var n;return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,m.u1)({username:u.username});case 2:return n=o.sent,o.abrupt("return",(0,m.sI)({username:u.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(n.data.token)}));case 4:case"end":return o.stop()}},s)}))})]})}}],request:function(){var R=C()(l()().mark(function g(u){var i;return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,m.lE)();case 2:return i=n.sent,n.abrupt("return",{data:i.data.list,success:!0,total:i.data.list.length});case 4:case"end":return n.stop()}},g)}));return function(g){return R.apply(this,arguments)}}(),rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},actionRef:b,tableAlertOptionRender:function(g){var u=g.selectedRowKeys;return(0,r.jsxs)(X.Z,{size:16,children:[(0,r.jsx)(y.Z,{action:C()(l()().mark(function i(){var s,n,d,o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:s=0,n=u;case 1:if(!(s<n.length)){t.next=9;break}return d=n[s],t.next=5,(0,m.az)({username:d,status:2});case 5:o=t.sent;case 6:s++,t.next=1;break;case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},i)})),onSuccess:function(){var s,n;return!((s=b.current)===null||s===void 0)&&s.reloadAndRest&&((n=b.current)===null||n===void 0||n.reloadAndRest()),!0},onError:function(){var s,n;return!((s=b.current)===null||s===void 0)&&s.reset&&((n=b.current)===null||n===void 0||n.reset()),!0},children:v.format("listManageEnable")},"batchEnable"),(0,r.jsx)(y.Z,{danger:!0,action:C()(l()().mark(function i(){var s,n,d,o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:s=0,n=u;case 1:if(!(s<n.length)){t.next=9;break}return d=n[s],t.next=5,(0,m.az)({username:d,status:1});case 5:o=t.sent;case 6:s++,t.next=1;break;case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},i)})),onSuccess:function(){var s,n;return!((s=b.current)===null||s===void 0)&&s.reloadAndRest&&((n=b.current)===null||n===void 0||n.reloadAndRest()),!0},onError:function(){var s,n;return!((s=b.current)===null||s===void 0)&&s.reset&&((n=b.current)===null||n===void 0||n.reset()),!0},children:v.format("listManageDisable")},"batchDisable")]})},pagination:(0,N.Oh)()})]})}},67255:function(oe,V,e){e.d(V,{O$:function(){return se},Oh:function(){return _},j_:function(){return C},nX:function(){return ae}});var z=e(5574),l=e.n(z);function _(T){var O=localStorage.getItem("dpanel-pagesize");if(O=="all")return!1;var y=location.pathname.split("/").slice(-2).join("-");return{defaultCurrent:T==null?void 0:T.page,showSizeChanger:!0,defaultPageSize:parseInt(O!=null?O:"20"),onChange:function(N,x){["app-list","compose-list"].includes(y)&&localStorage.setItem("dpanel-page-"+y,"".concat(N))}}}function C(T){var O="dpanel-table-column-".concat(T),y={};if(localStorage.getItem(O)){var m;y=JSON.parse((m=localStorage.getItem(O))!==null&&m!==void 0?m:"{}")}return{defaultValue:y,onChange:function(x){localStorage.setItem("dpanel-table-column-".concat(T),JSON.stringify(x))}}}function ae(T,O,y){var m=location.pathname.split("/").slice(-2).join("-");y.columnKey&&localStorage.setItem("dpanel-table-sort-".concat(m),"".concat(y.columnKey,"|").concat(y.order))}function se(T,O){var y=localStorage.getItem("dpanel-table-sort-".concat(T));if(y){var m=y.split("|"),N=l()(m,2),x=N[0],te=N[1];if(x==O)return te}}}}]);
