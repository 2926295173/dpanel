"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2958],{80821:function(ie,W,e){e.d(W,{Z:function(){return fe}});var K=e(97857),l=e.n(K),T=e(5574),h=e.n(T),J=e(24963),B=e(36146),ne=e(86738),V=e(83062),Y=e(28036),y=e(67294),X=e(85893);function fe(a){var me=(0,y.useState)(!1),ue=h()(me,2),Q=ue[0],q=ue[1],te=(0,y.useContext)(J.Z),le=te.message,N=new B.Uo,re=function(){q(!0);var oe=a.action();oe instanceof Promise?oe.then(function(w){if(q(!1),w){typeof a.onSuccess=="function"&&a.onSuccess(w);var _="";a.messageSuccess?typeof a.messageSuccess=="function"?_=a.messageSuccess(w):_=a.messageSuccess.indexOf("notification.")==0?N.format(a.messageSuccess):a.messageSuccess:_=N.format("notification.finish"),a.asynced?le.info(_):le.success(_)}}).catch(function(w){q(!1),typeof a.onError=="function"&&a.onError(w)}):q(!1)};return a.confirm?(0,X.jsx)(ne.Z,l()(l()({style:{width:500},title:a.confirmTitle?a.confirmTitle:N.format("notification.title.tip"),description:typeof a.confirm=="string"&&a.confirm.indexOf("notification.")==0?N.format(a.confirm):a.confirm,onConfirm:re,okText:"Yes",cancelText:"No",onOpenChange:a.confirmOnOpenChange},a.confirmProps),{},{children:(0,X.jsx)(V.Z,{title:a.tips,children:(0,X.jsx)(Y.ZP,{block:a.block,disabled:a.disabled,icon:!a.children&&Q?void 0:a.icon,loading:Q,danger:a.danger,type:a.type,children:a.children})})})):(0,X.jsx)(V.Z,{title:a.tips,children:(0,X.jsx)(Y.ZP,{block:a.block,style:a.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:a.disabled,icon:!a.children&&Q?void 0:a.icon,loading:Q,onClick:re,danger:a.danger,type:a.type,children:a.children})})}},3616:function(ie,W,e){e.d(W,{Ed:function(){return h},FK:function(){return l},R_:function(){return K},ob:function(){return T}});var K=window.innerWidth<=1024?"90vw":"65vw",l="90vw",T="60vw",h="50vh"},24963:function(ie,W,e){var K=e(67294),l=(0,K.createContext)({});W.Z=l},59549:function(ie,W,e){e.r(W),e.d(W,{default:function(){return Ve}});var K=e(15009),l=e.n(K),T=e(99289),h=e.n(T),J=e(9783),B=e.n(J),ne=e(19632),V=e.n(ne),Y=e(80821),y=e(68602),X=e(67255),fe=e(36693),a=e(43425),me=e(88641),ue=e(90078),Q=e(78099),q=e(66309),te=e(42075),le=e(96074),N=e(25593),re=e(83062),c=e(67294),oe=e(5574),w=e.n(oe),_=e(28036),ve=e(184),ce=e(5966),he=e(64317),je=e(52688),Pe=e(90672),ae=e(3616),M=e(83403),ye=e(87662),F=e(36146),r=e(85893),Ce=(0,c.forwardRef)(function(C,k){var $=(0,c.useState)(!1),m=w()($,2),R=m[0],g=m[1],u=(0,c.useRef)(),i=new F.Uo("components.userInvite"),s=new F.Uo("system.user");(0,c.useImperativeHandle)(k,function(){return{edit:function(o){var f;(f=u.current)===null||f===void 0||f.setFieldsValue({username:o.username}),g(!0)},show:function(){var o;(o=u.current)===null||o===void 0||o.resetFields(),g(!0)}}}),c.useEffect(function(){if(R){var d;(d=u.current)===null||d===void 0||d.resetFields()}},[R,u]);var n=function(){var d=h()(l()().mark(function o(){var f,t,O,D,b,z;return l()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,(f=u.current)===null||f===void 0?void 0:f.validateFields();case 3:return t=S.sent,O={username:t.username,userRole:t.userRole||"member",email:t.email,userStatus:t.userStatus||"enable",securityPassword:t.securityPassword||!0},S.next=7,(0,y.mX)(O);case 7:if(D=S.sent,O.userRole==="manager"&&(0,y.SS)({username:O.username,menuPermissionNames:M.Wy}),O.userStatus==="disable"&&(0,y.az)({username:O.username,status:1}),!O.email){S.next=15;break}return S.next=13,(0,ye.pe)({groupName:"setting",name:"emailServer"});case 13:z=S.sent,(b=z.data)!==null&&b!==void 0&&(b=b.status)!==null&&b!==void 0&&b.includes("register")&&(0,y.sI)({username:O.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(D.data.token)});case 15:return C.onFinish&&C.onFinish(),S.abrupt("return",!0);case 19:return S.prev=19,S.t0=S.catch(0),S.abrupt("return",!1);case 22:case"end":return S.stop()}},o,null,[[0,19]])}));return function(){return d.apply(this,arguments)}}();return(0,r.jsxs)(ve.a,{name:"create",title:i.format("drawerTitle"),open:R,onOpenChange:function(o){if(!o){var f;(f=u.current)===null||f===void 0||f.resetFields()}g(o)},drawerProps:{forceRender:!0,width:ae.R_},formRef:u,trigger:(0,r.jsx)(_.ZP,{type:"primary",children:i.format("drawerTitle")}),onFinish:h()(l()().mark(function d(){return l()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,n();case 2:return f.abrupt("return",f.sent);case 3:case"end":return f.stop()}},d)})),children:[(0,r.jsx)(ce.Z,{label:i.format("formUsername"),name:"username",required:!0,rules:[{required:!0}]}),(0,r.jsx)(ce.Z,{label:i.format("formEmail"),name:"email",placeholder:"",rules:[{type:"email"}]}),(0,r.jsx)(he.Z,{label:i.format("formUserRole"),name:"userRole",tooltip:i.format("formUserRoleTip"),required:!0,fieldProps:{defaultValue:"member"},options:s.option("listUserRoleOption",["manager","member"])}),(0,r.jsx)(he.Z,{label:i.format("formUserStatus"),name:"userStatus",fieldProps:{defaultValue:"enable"},required:!0,options:s.option("listStatusOption",["enable","disable"])}),(0,r.jsx)(je.Z,{label:i.format("formSecurityPassword"),name:"securityPassword",fieldProps:{defaultChecked:!0}}),(0,r.jsx)(Pe.Z,{label:i.format("formRemark"),name:"remark",fieldProps:{rows:4}})]})}),Oe=Ce,be=e(38345),we=e(63434),Ee=e(71230),xe=e(15746),De=e(84567),Ze=e(85265),Ue=e(82346),Te=(0,c.forwardRef)(function(C,k){(0,c.useImperativeHandle)(k,function(){return{show:function(P){return h()(l()().mark(function L(){var x,I,U,se,Se,G,pe;return l()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return U=P.username,se=P.uri,(x=O.current)===null||x===void 0||x.resetFields(),g(U),n(se),H.next=6,(0,y.q4)({username:U});case 6:if(Se=H.sent,G=(I=Se.data)===null||I===void 0||(I=I.permissions)===null||I===void 0?void 0:I[se],!G){H.next=16;break}return H.next=11,(0,Ue.request)(G.uri,{method:"POST"});case 11:pe=H.sent,S(pe.data.list.filter(function(de){return G.value.includes(de[G.key])}).map(function(de){return{id:de[G.key],name:de[G.showKey]}})),p(G),H.next=17;break;case 16:S([]);case 17:t(!0);case 18:case"end":return H.stop()}},L)}))()}}});var $=(0,c.useState)(""),m=w()($,2),R=m[0],g=m[1],u=(0,c.useState)(""),i=w()(u,2),s=i[0],n=i[1],d=(0,c.useState)(!1),o=w()(d,2),f=o[0],t=o[1],O=(0,c.useRef)(),D=(0,c.useRef)(),b=(0,c.useState)([]),z=w()(b,2),A=z[0],S=z[1],ee=(0,c.useState)(),Z=w()(ee,2),v=Z[0],p=Z[1],j=new F.Uo("components.userPermission");return(0,r.jsx)(Ze.Z,{title:j.format("permissionTitle"),open:f,width:ae.R_,destroyOnClose:!0,onClose:function(){var P;(P=O.current)===null||P===void 0||P.resetFields(),t(!1)},children:(0,r.jsx)(Q.Z,{actionRef:D,search:!1,toolBarRender:!1,scroll:{x:"max-content"},columns:[{key:"name",title:F.FD.format("listTitle"),dataIndex:"name"}],rowKey:"id",dataSource:A,rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},tableAlertOptionRender:function(P){var L=P.selectedRows;return(0,r.jsx)(te.Z,{size:16,wrap:!0,children:(0,r.jsx)(Y.Z,{danger:!0,type:"primary",action:h()(l()().mark(function x(){return l()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.next=2,(0,y.V9)({username:R,permission:{uri:s,key:"-",value:L.map(function(se){return se.id}),showKey:"-"}});case 2:return U.abrupt("return",!0);case 3:case"end":return U.stop()}},x)})),onSuccess:function(){return t(!1),!0},confirm:"notification.confirm.title",children:F.FD.format("listManageDeleteBatch")})})},pagination:!1})})}),ge=Te,Ae=e(31199),Ie=(0,c.forwardRef)(function(C,k){(0,c.useImperativeHandle)(k,function(){return{show:function(t){return h()(l()().mark(function O(){var D,b;return l()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:b=t.formData,(D=d.current)===null||D===void 0||D.resetFields(),n(b),g(!0);case 4:case"end":return A.stop()}},O)}))()}}});var $=(0,c.useState)(!1),m=w()($,2),R=m[0],g=m[1],u=(0,c.useState)({}),i=w()(u,2),s=i[0],n=i[1],d=(0,c.useRef)(),o=new F.Uo("components.userPermission");return(0,r.jsxs)(ve.a,{title:o.format("permissionTitle"),open:R,width:ae.R_,formRef:d,onFinish:function(){var f=h()(l()().mark(function t(O){return l()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return C.onChange(O),g(!1),b.abrupt("return",!0);case 3:case"end":return b.stop()}},t)}));return function(t){return f.apply(this,arguments)}}(),initialValues:s,drawerProps:{width:ae.R_,destroyOnClose:!0,onClose:function(){var t;(t=d.current)===null||t===void 0||t.resetFields(),g(!1)}},children:[(0,r.jsx)(Ae.Z,{name:"limit",label:o.format("formContainerLimit"),min:0}),(0,r.jsx)(ce.Z,{name:"name",hidden:!0})]})}),Me=Ie,Fe=e(24963),$e=e(34646),Le=e(60433),Re=e(25449),We=(0,c.forwardRef)(function(C,k){(0,c.useImperativeHandle)(k,function(){return{edit:function(v){return h()(l()().mark(function p(){var j,E,P;return l()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return(j=i.current)===null||j===void 0||j.setFieldValue("username",v),x.next=3,(0,y.J5)({username:v});case 3:E=x.sent,E.data.resource?(P={},E.data.resource.forEach(function(I){P[I.name]=I}),S(P)):S({}),E.data.menus?(E.data.menus.map(function(I){var U;(U=i.current)===null||U===void 0||U.setFieldValue(["permission",I],!0)}),D([].concat(V()(E.data.menus||[]),V()(M.Io)))):D(M.Io),u(!0);case 7:case"end":return x.stop()}},p)}))()}}});var $={canSeeContainerList:M.W6.CONTAINER,canSeeImageRegistry:M.W6.REGISTRY,canSeeComposeList:M.W6.COMPOSE,canSeeSystemAppstore:M.W6.APPSTORE,canSeeSystemEnv:M.W6.DOCKER_ENV},m=(0,c.useState)(!1),R=w()(m,2),g=R[0],u=R[1],i=(0,c.useRef)(),s=(0,c.useContext)(Fe.Z),n=s.message,d=(0,c.useRef)(),o=(0,c.useRef)(),f=(0,c.useState)([]),t=w()(f,2),O=t[0],D=t[1],b=(0,c.useState)({}),z=w()(b,2),A=z[0],S=z[1],ee=new F.Uo("components.userPermission");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(ve.a,{title:ee.format("drawerTitle"),open:g,onOpenChange:function(v){var p;!v&&((p=i.current)===null||p===void 0||p.resetFields()),u(v)},drawerProps:{forceRender:!0,width:ae.R_},layout:"inline",formRef:i,onValuesChange:function(v,p){var j=Object.keys(v.permission)[0];if(v.permission[j]===!1){for(var E in p.permission)if(E.startsWith(j)){var P;(P=i.current)===null||P===void 0||P.setFieldValue(["permission",E],!1)}}D(Object.keys(p.permission).filter(function(L){return p.permission[L]}))},onFinish:function(){var Z=h()(l()().mark(function v(p){var j;return l()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return j=p.permission&&Object.keys(p.permission).filter(function(L){return p.permission[L]&&!M.Io.includes(L)}),j.push.apply(j,V()(M.Io.filter(function(L){return j.some(function(x){return x.startsWith(L)})}))),P.next=4,(0,y.SS)({username:p.username,menuPermissionNames:j,resources:Object.values(A)});case 4:return n.success(F.FD.format("finish")),P.abrupt("return",!0);case 6:case"end":return P.stop()}},v)}));return function(v){return Z.apply(this,arguments)}}(),children:[(0,r.jsx)(ge,{ref:d}),(0,r.jsx)(ce.Z,{name:"username",hidden:!0}),M.d0.map(function(Z){return(0,r.jsxs)(be.Z,{headerBordered:!0,ghost:!0,bodyStyle:{paddingTop:10,paddingBottom:20},title:(0,r.jsx)($e.Z,{}),subTitle:ee.format(Z.group),children:[(0,r.jsx)(we.Z,{name:["permission",Z.group],valuePropName:"checked",initialValue:!0,hidden:!0}),(0,r.jsx)(Ee.Z,{gutter:[16,16],children:Z.permissions.map(function(v){return(0,r.jsx)(xe.Z,{span:6,children:(0,r.jsxs)(Re.Z,{children:[(0,r.jsx)(Re.Z,{noStyle:!0,name:["permission",v],valuePropName:"checked",children:(0,r.jsx)(De.Z,{disabled:!O.includes(v.substring(0,v.search(/[A-Z][^A-Z]*$/))),children:ee.format(v)})}),$[v]&&(0,r.jsx)(re.Z,{title:ee.format("dataPermissionButton"),children:(0,r.jsx)(N.Z.Link,{onClick:function(){var j,E;(j=d.current)===null||j===void 0||j.show({username:((E=i.current)===null||E===void 0?void 0:E.getFieldValue("username"))||"",uri:$[v]||""})},children:(0,r.jsx)(Le.Z,{})})}),["canSeeContainerListManageCreate"].includes(v)&&(0,r.jsx)(re.Z,{title:ee.format("resourcePermssionButton"),children:(0,r.jsx)(N.Z.Link,{onClick:function(){var j;(j=o.current)===null||j===void 0||j.show({formData:A[v]||{name:v,limit:0}})},children:(0,r.jsx)(a.Z,{})})})]})},v)})})]},Z.group)})]}),(0,r.jsx)(ge,{ref:d}),(0,r.jsx)(Me,{onChange:function(v){var p;A[v.name]=v,(0,y.SS)({username:((p=i.current)===null||p===void 0?void 0:p.getFieldValue("username"))||"",menuPermissionNames:O,resources:Object.values(A)})},resourcePermissionsData:A,ref:o})]})}),Ke=We,Be=e(5251);function Ve(){var C=(0,c.useRef)(),k=(0,c.useRef)(),$=(0,c.useRef)(),m=new F.Uo("system.user");return(0,r.jsxs)(ue._z,{header:{extra:[(0,r.jsx)(Oe,{ref:k,onFinish:function(){var g,u;!((g=C.current)===null||g===void 0)&&g.reloadAndRest&&((u=C.current)===null||u===void 0||u.reloadAndRest())}},"invite-user")]},children:[(0,r.jsx)(Ke,{ref:$}),(0,r.jsx)(Q.Z,{scroll:{x:"max-content"},rowKey:"username",columns:[{title:F.FD.format("listUsername"),ellipsis:!0,dataIndex:"username"},{title:m.format("listEmail"),ellipsis:!0,dataIndex:"email"},{title:m.format("listUserRole"),ellipsis:!0,width:100,dataIndex:"userRole",valueEnum:Object.assign.apply(Object,[{}].concat(V()(m.option("listUserRoleOption",["manager","member"]).map(function(R){return B()({},R.value,{text:R.label,status:R.value})})))),render:function(g,u){return(0,r.jsx)(q.Z,{color:m.format("listUserRoleColor."+u.userRole),children:m.format("listUserRoleOption."+u.userRole)})}},{title:m.format("listRegisterAt"),ellipsis:!0,render:function(g,u,i,s){return(0,r.jsx)("div",{children:(0,Be.ZM)(u.registerAt*1e3)},u.username)},search:!1},{title:m.format("listRemark"),ellipsis:!0,dataIndex:"remark",search:!1},{title:m.format("listStatus"),width:100,dataIndex:"status",search:!1,render:function(g,u){return(0,r.jsx)(q.Z,{color:m.format("listStatusColor."+u.status),children:m.format("listStatusOption."+u.status)})}},{title:F.FD.format("listManage"),width:100,search:!1,fixed:"right",render:function(g,u,i){return(0,r.jsxs)(te.Z,{split:(0,r.jsx)(le.Z,{type:"vertical"}),children:[(0,r.jsx)(N.Z.Link,{copyable:{tooltips:m.format("listManageCopyUrl"),icon:[(0,r.jsx)(fe.Z,{})],text:function(){var s=h()(l()().mark(function d(){var o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,y.u1)({username:u.username});case 2:return o=t.sent,t.abrupt("return","".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(o.data.token));case 4:case"end":return t.stop()}},d)}));function n(){return s.apply(this,arguments)}return n}()},style:{color:"inherit"}},"copy-"+i),(0,r.jsx)(re.Z,{title:m.format("listManageSetting"),children:(0,r.jsx)(N.Z.Link,{onClick:function(){var n;(n=$.current)===null||n===void 0||n.edit(u.username)},children:(0,r.jsx)(a.Z,{})})}),(0,r.jsx)(Y.Z,{ghost:!0,type:"link",tips:m.format("listManageSendEmail"),icon:(0,r.jsx)(me.Z,{}),action:h()(l()().mark(function s(){var n;return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,y.u1)({username:u.username});case 2:return n=o.sent,o.abrupt("return",(0,y.sI)({username:u.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(n.data.token)}));case 4:case"end":return o.stop()}},s)}))})]})}}],request:function(){var R=h()(l()().mark(function g(u){var i;return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,y.lE)();case 2:return i=n.sent,n.abrupt("return",{data:i.data.list,success:!0,total:i.data.list.length});case 4:case"end":return n.stop()}},g)}));return function(g){return R.apply(this,arguments)}}(),rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},actionRef:C,tableAlertOptionRender:function(g){var u=g.selectedRowKeys;return(0,r.jsxs)(te.Z,{size:16,children:[(0,r.jsx)(Y.Z,{action:h()(l()().mark(function i(){var s,n,d,o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:s=0,n=u;case 1:if(!(s<n.length)){t.next=9;break}return d=n[s],t.next=5,(0,y.az)({username:d,status:2});case 5:o=t.sent;case 6:s++,t.next=1;break;case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},i)})),onSuccess:function(){var s,n;return!((s=C.current)===null||s===void 0)&&s.reloadAndRest&&((n=C.current)===null||n===void 0||n.reloadAndRest()),!0},onError:function(){var s,n;return!((s=C.current)===null||s===void 0)&&s.reset&&((n=C.current)===null||n===void 0||n.reset()),!0},children:m.format("listManageEnable")},"batchEnable"),(0,r.jsx)(Y.Z,{danger:!0,action:h()(l()().mark(function i(){var s,n,d,o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:s=0,n=u;case 1:if(!(s<n.length)){t.next=9;break}return d=n[s],t.next=5,(0,y.az)({username:d,status:1});case 5:o=t.sent;case 6:s++,t.next=1;break;case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},i)})),onSuccess:function(){var s,n;return!((s=C.current)===null||s===void 0)&&s.reloadAndRest&&((n=C.current)===null||n===void 0||n.reloadAndRest()),!0},onError:function(){var s,n;return!((s=C.current)===null||s===void 0)&&s.reset&&((n=C.current)===null||n===void 0||n.reset()),!0},children:m.format("listManageDisable")},"batchDisable")]})},pagination:(0,X.O)()})]})}},67255:function(ie,W,e){e.d(W,{O:function(){return K},j:function(){return l}});function K(T){var h=localStorage.getItem("dpanel-pagesize");return h=="all"?!1:{defaultCurrent:T==null?void 0:T.page,showSizeChanger:!0,defaultPageSize:parseInt(h!=null?h:"20"),onChange:function(B,ne){localStorage.setItem("dpanel-page-"+location.pathname.split("/").slice(-2).join("-"),"".concat(B))}}}function l(T){var h="dpanel-table-column-".concat(T),J={};if(localStorage.getItem(h)){var B;J=JSON.parse((B=localStorage.getItem(h))!==null&&B!==void 0?B:"{}")}return{defaultValue:J,onChange:function(V){localStorage.setItem("dpanel-table-column-".concat(T),JSON.stringify(V))}}}}}]);
