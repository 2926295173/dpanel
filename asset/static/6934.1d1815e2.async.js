"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6934],{46934:function(le,q,t){t.d(q,{Z:function(){return Ne}});var _=t(15009),C=t.n(_),ee=t(99289),T=t.n(ee),U=t(5574),V=t.n(U),O=t(28031),H=t(10641),s=t(67294),K=(0,s.createContext)({}),A=K,k=t(51042),te=t(48689),S=t(42075),W=t(28036),$=t(80821),P=t(88484),D=t(37476),M=t(91604),x=t(97961),e=t(85893);function oe(){var r=(0,s.useRef)(),h=(0,s.useContext)(A),p=h.fileListRef,v=h.containerMd5,E=h.currentPath;return(0,e.jsx)(D.Y,{formRef:r,trigger:(0,e.jsx)(W.ZP,{icon:(0,e.jsx)(P.Z,{}),children:"\u4E0A\u4F20"}),title:"\u4E0A\u4F20\u6587\u4EF6\u5230\u5BB9\u5668",onFinish:function(){var F=T()(C()().mark(function o(m){var j,w,c,y;return C()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return c=[],m.importFileList&&m.importFileList.map(function(L){c.push({name:L.name,path:L.response.data.path})}),(0,O.ZU)({fileList:c,md5:v,destPath:E}),(j=r.current)===null||j===void 0||j.resetFields(),p&&typeof((w=p.current)===null||w===void 0?void 0:w.reloadAndRest)=="function"&&((y=p.current)===null||y===void 0||y.reloadAndRest()),b.abrupt("return",!0);case 6:case"end":return b.stop()}},o)}));return function(o){return F.apply(this,arguments)}}(),children:(0,e.jsx)(M.Z,{name:"importFileList",fieldProps:{multiple:!0,name:"file",action:"/api/common/attach/upload",headers:{Authorization:"Bearer "+localStorage.getItem("token")},onRemove:function(o){return new Promise(function(m){var j;(0,x._2)({path:(j=o.response.data.path)!==null&&j!==void 0?j:""}).then(function(w){m(!0)})})}}})})}var se=t(23430),ce=t(93162);function de(r){var h=(0,s.useContext)(A),p=h.containerMd5;return(0,e.jsx)($.Z,{action:function(){return(0,O._U)({md5:p,fileList:r.selectFileList})},onSuccess:function(E){var F=new Blob([E],{type:"application/zip"});(0,ce.saveAs)(F,"export.zip")},icon:(0,e.jsx)(se.Z,{}),children:"\u4E0B\u8F7D"})}var G=t(38345),N=t(63434),he=t(24739),ie=t(5966),me=t(64317),ne=t(31418),re=t(24963);function fe(r){var h=(0,s.useContext)(re.Z),p=h.message,v=h.notice,E=h.lang,F=(0,s.useRef)(),o=(0,s.useContext)(A),m=o.currentPath,j=o.reloadFileList,w=o.containerMd5,c=(0,s.useState)(),y=V()(c,2),B=y[0],b=y[1],L=ne.Z.useApp(),Q=(0,s.useState)(!1),I=V()(Q,2),Z=I[0],f=I[1],d=function(u){var n=u.split(""),l=0,g=0,R=0;return n[1]=="r"&&(l+=4),n[2]=="w"&&(l+=2),n[3]=="x"&&(l+=1),n[4]=="r"&&(g+=4),n[5]=="w"&&(g+=2),n[6]=="x"&&(g+=1),n[7]=="r"&&(R+=4),n[8]=="w"&&(R+=2),n[9]=="x"&&(R+=1),"".concat(l).concat(g).concat(R)},a=function(u){var n;if((n=F.current)===null||n===void 0||n.setFieldValue("permission",u),u.length>=1){var l;(l=F.current)===null||l===void 0||l.setFieldsValue({ownerRead:Number(u[0])&4,ownerWrite:Number(u[0])&2,ownerExec:Number(u[0])&1})}if(u.length>=2){var g;(g=F.current)===null||g===void 0||g.setFieldsValue({groupRead:Number(u[1])&4,groupWrite:Number(u[1])&2,groupExec:Number(u[1])&1})}if(u.length>=3){var R;(R=F.current)===null||R===void 0||R.setFieldsValue({everyoneRead:Number(u[2])&4,everyoneWrite:Number(u[2])&2,everyoneExec:Number(u[2])&1})}};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(W.ZP,{onClick:function(){if(r.selectFileObject.length==0){var u;return(u=F.current)===null||u===void 0||u.resetFields(),v.error("\u8BF7\u5148\u9009\u62E9\u8981\u4FEE\u6539\u7684\u6587\u4EF6\u6216\u662F\u76EE\u5F55"),f(!1),!1}else(0,O.lE)({md5:w}).then(function(n){if(n.data.list.length==0)return v.error("\u8BE5\u5BB9\u5668\u4E0D\u652F\u6301\u4FEE\u6539\u6587\u4EF6\u6743\u9650"),f(!1),!1;b(n.data.list),f(!0)})},children:"\u6743\u9650"}),(0,e.jsxs)(D.Y,{modalProps:{forceRender:!0},title:r.selectFileObject.length==1?"\u4FEE\u6539 ".concat(r.selectFileObject[0].name," \u6743\u9650"):"\u6279\u91CF\u6587\u4EF6\u4FEE\u6539\u6743\u9650",layout:"horizontal",open:Z,onOpenChange:function(u){if(f(u),r.selectFileObject.length==1){var n;a(d(r.selectFileObject[0].mode));var l=r.selectFileObject[0].owner;B&&B.map(function(g){g.uid==l&&(l=g.username)}),(n=F.current)===null||n===void 0||n.setFieldValue("owner",l)}},formRef:F,onValuesChange:function(u,n){if(u.permission)a(u.permission);else{var l=["-",n.ownerRead?"r":"-",n.ownerWrite?"w":"-",n.ownerExec?"x":"-",n.groupRead?"r":"-",n.groupWrite?"w":"-",n.groupExec?"x":"-",n.everyoneRead?"r":"-",n.everyoneWrite?"w":"-",n.everyoneExec?"x":"-"];a(d(l.join("")))}},onFinish:function(){var i=T()(C()().mark(function u(n){var l,g,R,Ie;return C()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return R=[],r.selectFileObject.map(function(Ve){R.push(Ve.name)}),z.next=4,(0,O.OQ)({md5:w,fileList:R,mod:parseInt((l=n.permission)!==null&&l!==void 0?l:"600"),hasChildren:(g=n.hasChildren)!==null&&g!==void 0?g:!0,owner:n.owner});case 4:return Ie=z.sent,j(),z.abrupt("return",!0);case 7:case"end":return z.stop()}},u)}));return function(u){return i.apply(this,arguments)}}(),children:[(0,e.jsxs)(G.Z,{direction:"row",gutter:[20,10],children:[(0,e.jsxs)(G.Z,{bordered:!0,title:"\u6240\u6709\u8005",headerBordered:!0,children:[(0,e.jsx)(N.Z,{label:"\u8BFB\u53D6",name:"ownerRead"}),(0,e.jsx)(N.Z,{label:"\u5199\u5165",name:"ownerWrite"}),(0,e.jsx)(N.Z,{label:"\u6267\u884C",name:"ownerExec"})]}),(0,e.jsxs)(G.Z,{bordered:!0,title:"\u7528\u6237\u7EC4",headerBordered:!0,children:[(0,e.jsx)(N.Z,{label:"\u8BFB\u53D6",name:"groupRead"}),(0,e.jsx)(N.Z,{label:"\u5199\u5165",name:"groupWrite"}),(0,e.jsx)(N.Z,{label:"\u6267\u884C",name:"groupExec"})]}),(0,e.jsxs)(G.Z,{bordered:!0,title:"\u516C\u5171",headerBordered:!0,children:[(0,e.jsx)(N.Z,{label:"\u8BFB\u53D6",name:"everyoneRead"}),(0,e.jsx)(N.Z,{label:"\u5199\u5165",name:"everyoneWrite"}),(0,e.jsx)(N.Z,{label:"\u6267\u884C",name:"everyoneExec"})]})]}),(0,e.jsx)(G.Z,{children:(0,e.jsxs)(he.UW,{children:[(0,e.jsx)(ie.Z,{label:"\u6743\u9650",name:"permission",fieldProps:{maxLength:3},width:"xs"}),(0,e.jsx)(me.Z,{label:"\u6240\u6709\u8005",name:"owner",width:"sm",options:B==null?void 0:B.map(function(i){return i.username})}),(0,e.jsx)(N.Z,{label:"\u5E94\u7528\u5230\u5B50\u76EE\u5F55",name:"hasChildren",initialValue:!0})]})})]})]})}function ve(r){var h=(0,s.useContext)(A),p=h.currentPath,v=h.reloadFileList,E=h.containerMd5,F=ne.Z.useApp(),o=(0,s.useContext)(re.Z),m=o.notice,j=o.message,w=o.lang;return(0,e.jsx)(W.ZP,{onClick:function(){if(r.selectFileObject.length==0)return m.error("\u8BF7\u5148\u9009\u62E9\u8981\u89E3\u538B\u7684 zip \u6587\u4EF6"),!1;if(r.selectFileObject.length>1)return m.error("\u89E3\u538B\u64CD\u4F5C\u53EA\u652F\u6301\u5355\u6587\u4EF6\u64CD\u4F5C"),!1;var y=r.selectFileObject[0];if(y.name.lastIndexOf(".zip")!=y.name.length-4)return m.error("\u89E3\u538B\u64CD\u4F5C\u53EA\u652F\u6301 zip \u6587\u4EF6"),!1;(0,O.gb)({md5:E,file:y.name}).then(function(B){v()})},children:"\u89E3\u538B"})}function xe(r){var h=(0,s.useContext)(A),p=h.fileListRef,v=h.containerMd5,E=h.currentPath,F=h.editFileRef;return(0,e.jsxs)(S.Z,{size:16,wrap:!0,children:[(0,e.jsx)(de,{selectFileList:r.selectFileList}),(0,e.jsx)(oe,{}),(0,e.jsx)(fe,{selectFileObject:r.selectFileObject}),(0,e.jsx)(ve,{selectFileObject:r.selectFileObject}),(0,e.jsx)(W.ZP,{type:"primary",icon:(0,e.jsx)(k.Z,{}),onClick:function(){var m;(m=F.current)===null||m===void 0||m.newFile()},children:"\u65B0\u5EFA"}),(0,e.jsx)($.Z,{danger:!0,type:"default",icon:(0,e.jsx)(te.Z,{}),action:function(){return(0,O.Yx)({md5:v,fileList:r.selectFileList})},onSuccess:function(){var m;if(p&&typeof((m=p.current)===null||m===void 0?void 0:m.reloadAndRest)=="function"){var j;(j=p.current)===null||j===void 0||j.reloadAndRest()}},confirm:"notification.confirm.title",children:"\u5220\u9664"})]})}var Y=t(83062),J=t(66309);function Fe(r){return r.change==0?(0,e.jsx)(Y.Z,{title:"\u5728\u5BB9\u5668\u8FD0\u884C\u65F6\u88AB\u4FEE\u6539",children:(0,e.jsx)(J.Z,{color:"blue",children:"MODIFIED"})}):r.change==1?(0,e.jsx)(Y.Z,{title:"\u5728\u5BB9\u5668\u8FD0\u884C\u65F6\u65B0\u589E\u7684\u6587\u4EF6",children:(0,e.jsx)(J.Z,{color:"green",children:"ADD"})}):r.change==2?(0,e.jsx)(Y.Z,{title:"\u5728\u5BB9\u5668\u8FD0\u884C\u65F6\u88AB\u5220\u9664\u6587\u4EF6",children:(0,e.jsx)(J.Z,{color:"error",children:"DELETED"})}):r.change==100?(0,e.jsx)(Y.Z,{title:"\u6302\u8F7D\u7684\u6301\u4E45\u5316\u76EE\u5F55",children:(0,e.jsx)(J.Z,{color:"cyan",children:"VOLUME"})}):(0,e.jsx)(e.Fragment,{})}var pe=t(19632),ae=t.n(pe),je=t(27254),X=t(25593),ge=(0,s.forwardRef)(function(r,h){var p=(0,s.useContext)(A),v=p.showPath,E=(0,s.useState)([{title:"\u6839\u76EE\u5F55",path:"/"}]),F=V()(E,2),o=F[0],m=F[1];(0,s.useImperativeHandle)(h,function(){return{addHistory:function(c,y){m([].concat(ae()(o),[{title:c,path:y}]))},initHistory:function(c){m([{title:"\u6839\u76EE\u5F55",path:"/"}].concat(ae()(c)))}}});var j=function(c){v(o[c].title,o[c].path);var y=o.filter(function(B,b){return b<=c});m(ae()(y))};return(0,e.jsxs)(S.Z,{children:[(0,e.jsx)(S.Z.Compact,{children:o.map(function(w,c){return(0,e.jsx)(W.ZP,{icon:(0,e.jsx)(je.Z,{}),type:"dashed",onClick:function(){j(c)},children:w.title},c)})}),o.length>=2&&(0,e.jsx)(X.Z.Text,{copyable:{text:o[o.length-1].path}})]})}),Ce=ge,we=t(97269),ye=t(62370),Ee=t(90672),Ze=t(97462),Re=t(85576),Pe=t(95089),Be=(0,s.forwardRef)(function(r,h){var p,v=(0,s.useContext)(re.Z),E=v.message,F=v.notice,o=(0,s.useContext)(A),m=o.currentPath,j=o.reloadFileList,w=o.containerMd5,c=(0,s.useRef)(),y=(0,s.useState)(!1),B=V()(y,2),b=B[0],L=B[1],Q=ne.Z.useApp();return(0,s.useImperativeHandle)(h,function(){return{newFile:function(){var Z;L(!0),(Z=c.current)===null||Z===void 0||Z.resetFields()},editFile:function(Z,f,d){var a;(a=c.current)===null||a===void 0||a.resetFields(),E.loading("\u6B63\u5728\u83B7\u53D6\u6587\u4EF6\u5185\u5BB9"),(0,O.LK)({md5:w,file:f}).then(function(i){var u,n;if(i.data.content==""&&d!="0"){E.error("\u4E0D\u652F\u6301\u7F16\u8F91\u7684\u6587\u4EF6\u7C7B\u578B"),L(!1);return}(u=c.current)===null||u===void 0||u.setFieldValue("newValue",i.data.content),(n=c.current)===null||n===void 0||n.setFieldValue("newName",Z),E.destroy(),L(!0)}).finally(function(){E.destroy()})}}}),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Re.Z,{width:"800px",title:(p=c.current)!==null&&p!==void 0&&p.getFieldValue("newName")?"\u7F16\u8F91\u6587\u4EF6":"\u65B0\u5EFA\u6587\u4EF6",open:b,onCancel:function(){return L(!1)},footer:!1,forceRender:!0,children:(0,e.jsxs)(we.A,{formRef:c,onFinish:function(){var I=T()(C()().mark(function Z(f){var d;return C()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return(0,O.C4)({destPath:m,file:f.newName.indexOf("/")!==0?"/"+f.newName:f.newName,content:f.newValue,md5:w}),(d=c.current)===null||d===void 0||d.resetFields(),L(!1),j(),i.abrupt("return",!0);case 5:case"end":return i.stop()}},Z)}));return function(Z){return I.apply(this,arguments)}}(),children:[(0,e.jsx)(ie.Z,{label:"\u6587\u4EF6\u540D",tooltip:"\u7F16\u8F91\u6587\u4EF6\u65F6\u4FEE\u6539\u6587\u4EF6\u540D\u53EF\u5B9E\u73B0\u590D\u5236\u529F\u80FD",name:"newName",fieldProps:{addonBefore:m},placeholder:"\u8BF7\u8F93\u5165\u6587\u4EF6\u540D\uFF1B\u652F\u6301\u65B0\u5EFA\u76EE\u5F55\uFF0C\u9700\u8981\u6307\u5B9A\u5B8C\u6574\u8DEF\u5F84\uFF0C\u4F8B\u5982\uFF1A/test/test.txt"}),(0,e.jsxs)(ye.Z,{label:"\u5185\u5BB9",children:[(0,e.jsx)(Ee.Z,{hidden:!0,name:"newValue"}),(0,e.jsx)(Ze.Z,{name:["newValue"],children:function(Z){var f=Z.newValue;return(0,e.jsx)(Pe.ZP,{theme:"dark",height:"500px",value:f,onChange:function(a){var i;(i=c.current)===null||i===void 0||i.setFieldValue("newValue",a)}})}})]})]})})})}),be=Be,Le=t(57716),Oe=t(60335),De=t(93613),Te=t(36693),Ae=t(2741);function ue(r){return r.isDir?(0,e.jsx)(X.Z.Link,{onClick:function(){r.onClick&&r.onClick()},children:(0,e.jsxs)(S.Z,{children:[(0,e.jsx)(De.Z,{}),r.showName]})}):r.isLink?(0,e.jsx)(X.Z.Text,{children:(0,e.jsxs)(S.Z,{children:[(0,e.jsx)(Te.Z,{}),r.showName]})}):(0,e.jsx)(X.Z.Text,{onClick:function(){r.onClick&&r.onClick()},style:{cursor:"pointer"},children:(0,e.jsxs)(S.Z,{children:[(0,e.jsx)(Ae.Z,{}),r.showName]})})}var Se=t(82346);function Me(r){var h=(0,s.useRef)(),p=(0,s.useRef)(),v=(0,s.useRef)(),E=(0,s.useState)("/"),F=V()(E,2),o=F[0],m=F[1],j=(0,s.useState)(),w=V()(j,2),c=w[0],y=w[1],B=(0,s.useRef)(),b=(0,Se.useSearchParams)(),L=V()(b,2),Q=L[0],I=L[1];(0,s.useEffect)(function(){var f,d=(f=r.initPath)!==null&&f!==void 0?f:Q.get("path");if(d){for(var a,i=d.split("/"),u=[],n="",l=1;l<i.length;l++)n+="/"+i[l],u.push({title:i[l],path:n});Z(i[i.length-1],d),(a=h.current)===null||a===void 0||a.initHistory([].concat(u))}(0,Oe.jV)({md5:r.md5}).then(function(g){g.data&&y(g.data.info)})},[r.md5]);var Z=function(d,a){var i,u;if((i=h.current)===null||i===void 0||i.addHistory(d,a),m(a),v&&typeof((u=v.current)===null||u===void 0?void 0:u.reloadAndRest)=="function"){var n;(n=v.current)===null||n===void 0||n.reloadAndRest()}var l=new URLSearchParams(Q);l.set("path",a),I(l)};return(0,e.jsxs)(A.Provider,{value:{fileListRef:v,containerMd5:r.md5,currentPath:o,showPath:Z,reloadFileList:function(){var d;if(v&&typeof((d=v.current)===null||d===void 0?void 0:d.reloadAndRest)=="function"){var a;(a=v.current)===null||a===void 0||a.reloadAndRest()}},editFileRef:p},children:[(0,e.jsx)(H.Z,{scroll:{x:"max-content"},rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},toolBarRender:function(){var d=[];return c!=null&&c.Id&&d.push((0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Le.Z,{ref:B}),(0,e.jsx)(W.ZP,{type:"dashed",onClick:function(){var i;(i=B.current)===null||i===void 0||i.show(c.Id,o)},children:"Console"})]})),[].concat(d)},tableAlertOptionRender:function(d){var a=d.selectedRowKeys,i=d.selectedRows,u=[];return i.map(function(n){u.push(n.name)}),[(0,e.jsx)(xe,{selectFileList:u,selectFileObject:i},"1")]},headerTitle:(0,e.jsx)(Ce,{ref:h}),actionRef:v,search:!1,rowKey:"showName",pagination:{pageSize:500,position:["topRight","bottomRight"]},request:T()(C()().mark(function f(){return C()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(i,u){r.md5&&(0,O.V9)({md5:r.md5,path:o}).then(function(n){if(n.data.list){var l={data:n.data.list,success:!0,total:n.data.list.length};i(l)}else i({data:[],success:!0,total:0})})}));case 1:case"end":return a.stop()}},f)})),columns:[{title:"\u540D\u79F0",dataIndex:"showName",key:"name",render:function(l,a,i,u,n){var l;return a.isDir?l=(0,e.jsx)(ue,{isDir:!0,onClick:function(){return Z(a.showName,a.name)},showName:a.showName}):a.linkName?l=(0,e.jsx)(ue,{isLink:!0,showName:"".concat(a.showName)}):l=(0,e.jsx)(ue,{showName:a.showName,onClick:function(){var R;(R=p.current)===null||R===void 0||R.editFile(a.showName,a.name,a.size)}}),l}},{title:"\u72B6\u6001",key:"status",width:110,render:function(d,a,i,u,n){return(0,e.jsx)(Fe,{change:a.change})}},{title:"\u6743\u9650",dataIndex:"mode",key:"mode"},{title:"\u7528\u6237",dataIndex:"owner"},{title:"\u7528\u6237\u7EC4",dataIndex:"group"},{title:"\u5927\u5C0F",dataIndex:"size",key:"size"},{title:"\u4FEE\u6539\u65F6\u95F4",dataIndex:"modTime",key:"modTime",sorter:function(d,a){return new Date(d.modTime).getTime()-new Date(a.modTime).getTime()}}],cardProps:{ghost:!0}}),(0,e.jsx)(be,{ref:p})]})}var Ne=Me},97961:function(le,q,t){t.d(q,{GH:function(){return A},MF:function(){return W},_2:function(){return te},fN:function(){return O},ii:function(){return V},vC:function(){return s}});var _=t(15009),C=t.n(_),ee=t(99289),T=t.n(ee),U=t(82346),V=[{name:"linux/amd64",arch:"amd64",search:["amd64","x86_64","86_64"]},{name:"linux/arm64",arch:"arm64",search:["arm64","arrch64"]},{name:"linux/i386",arch:"386",search:[]},{name:"linux/arm/v6",arch:"arm",search:[]},{name:"linux/arm/v7",arch:"arm",search:[]},{name:"linux/arm/v8",arch:"arm64",search:[]},{name:"linux/ppc64le",arch:"ppc64le",search:[]},{name:"linux/riscv64",arch:"riscv64",search:[]}];function O(P){return H.apply(this,arguments)}function H(){return H=T()(C()().mark(function P(D){return C()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.abrupt("return",(0,U.request)("/api/app/image/create-by-dockerfile",{method:"POST",data:D}));case 1:case"end":return x.stop()}},P)})),H.apply(this,arguments)}function s(P){return K.apply(this,arguments)}function K(){return K=T()(C()().mark(function P(D){return C()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.abrupt("return",(0,U.request)("/api/app/image/import-by-container-tar",{method:"POST",data:D}));case 1:case"end":return x.stop()}},P)})),K.apply(this,arguments)}function A(P){return k.apply(this,arguments)}function k(){return k=T()(C()().mark(function P(D){return C()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.abrupt("return",(0,U.request)("/api/app/image/import-by-image-tar",{method:"POST",data:D}));case 1:case"end":return x.stop()}},P)})),k.apply(this,arguments)}function te(P){return S.apply(this,arguments)}function S(){return S=T()(C()().mark(function P(D){return C()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,U.request)("/api/common/attach/delete",{method:"POST",data:D});case 2:return x.abrupt("return",x.sent);case 3:case"end":return x.stop()}},P)})),S.apply(this,arguments)}function W(){return $.apply(this,arguments)}function $(){return $=T()(C()().mark(function P(){return C()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.abrupt("return",(0,U.request)("/api/app/image/get-template-list",{method:"POST"}));case 1:case"end":return M.stop()}},P)})),$.apply(this,arguments)}}}]);
