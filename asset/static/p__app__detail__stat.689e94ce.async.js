"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745,5947],{55809:function(k,b,e){var M=e(87462),r=e(67294),R=e(44805),l=e(84089),h=function(d,m){return r.createElement(l.Z,(0,M.Z)({},d,{ref:m,icon:R.Z}))},g=r.forwardRef(h);b.Z=g},60433:function(k,b,e){var M=e(87462),r=e(67294),R=e(69782),l=e(84089),h=function(d,m){return r.createElement(l.Z,(0,M.Z)({},d,{ref:m,icon:R.Z}))},g=r.forwardRef(h);b.Z=g},1699:function(k,b,e){e.d(b,{u:function(){return c}});var M=e(9783),r=e.n(M),R=e(97857),l=e.n(R),h=e(67294),g=e(82346),O=e(40411),d=e(42075),m=e(85893),c=function(y){var u=(0,g.useAccess)(),D=Array.isArray(y.access)?y.access:[y.access],i,j=y.fallback;if(typeof y.children=="function"?(i=y.children(D.reduce(function(C,t){return l()(l()({},C),{},r()({},t,u[t]))},{})),i||(i=j)):D.every(function(C){return u[C]})?i=y.children:i=j,!j&&i&&y.showProTips&&u.canSeeEnableCe){if(u.canSeeEnableHiddenProTips)return null;i=(0,m.jsx)(O.Z,{offset:y.showProTipsOffset,count:"PRO",color:"gold",style:{fontWeight:"bold"},children:i})}if(!j&&i&&y.showProRibbonTips&&u.canSeeEnableCe){if(u.canSeeEnableHiddenProTips)return null;i=(0,m.jsx)(O.Z.Ribbon,{text:"PRO",color:"gold",style:{fontWeight:"bold"},children:i})}return y.space?(0,m.jsx)(d.Z,l()(l()({},y.space),{},{children:i})):i}},27619:function(k,b,e){e.d(b,{Z:function(){return O}});var M=e(5574),r=e.n(M),R=e(82346),l=e(67294),h=e(64389),g=e(85893);function O(d){var m=(0,R.useModel)("@@initialState"),c=m.initialState,A="chart-area-".concat(d.name),y=(0,l.useState)(),u=r()(y,2),D=u[0],i=u[1],j={};d.data.forEach(function(t){t.show===!1?j[t.name]=!1:j[t.name]=!0});var C={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}},valueFormatter:function(T){return d.yValueFormatter?d.yValueFormatter(T):T}},legend:{selected:j},grid:{left:"0",right:"0",bottom:"0",top:"30",containLabel:!0},xAxis:{type:"category",data:d.data[0].data.map(function(t){return t.date}),boundaryGap:!1,axisLabel:{rotate:20}},yAxis:{type:"value",axisLabel:{formatter:d.yLabelFormatter},max:function(T){if(d.yDomainMaxCallback)return d.yDomainMaxCallback(T)}},series:[]};return(0,l.useEffect)(function(){var t="",T=window.matchMedia("(prefers-color-scheme: dark)");(c==null?void 0:c.theme.algorithm)=="dark"||T.matches?t="dark":t="",D&&!D.isDisposed()&&D.dispose();var F=document.getElementById(A),U=h.S1(F,t);U.setOption(C);var p=new ResizeObserver(function(){U.resize()});F&&p.observe(F),i(U)},[c]),(0,l.useEffect)(function(){D&&!D.isDisposed()&&D.setOption({legend:{data:d.data.map(function(t){return t.name})},xAxis:{data:d.data[0].data.map(function(t){return t.date})},series:d.data.map(function(t){return{name:t.name,type:"line",stack:"Total",areaStyle:{},emphasis:{focus:"series"},data:t.data.map(function(T){return T.value})}})})},[d.data]),(0,g.jsx)("div",{style:{height:200},id:A})}},24963:function(k,b,e){var M=e(67294),r=(0,M.createContext)({});b.Z=r},50070:function(k,b,e){e.r(b),e.d(b,{AppDetailContext:function(){return T},default:function(){return F}});var M=e(15009),r=e.n(M),R=e(99289),l=e.n(R),h=e(5574),g=e.n(h),O=e(1699),d=e(24963),m=e(13822),c=e(36146),A=e(55809),y=e(90078),u=e(82346),D=e(25593),i=e(28036),j=e(50136),C=e(67294),t=e(85893),T=(0,C.createContext)({});function F(){var U,p=(0,C.useContext)(d.Z),W=p.loading,s=(0,u.useParams)(),P=(0,u.useSearchParams)(),v=g()(P,2),a=v[0],N=v[1],K=(U=a.get("tab"))!==null&&U!==void 0?U:"edit",$=(0,C.useState)("edit"),Z=g()($,2),_=Z[0],V=Z[1],w=(0,u.useNavigate)(),S=(0,C.useState)(1),G=g()(S,2),H=G[0],Q=G[1],J=[{label:(0,t.jsx)(u.Link,{to:"/app/detail/edit/".concat(s.id,"?tab=edit"),children:"\u5BB9\u5668\u8BE6\u60C5"}),key:"edit"},{label:(0,t.jsx)(u.Link,{to:"/app/detail/network/".concat(s.id,"?tab=network"),children:"\u7F51\u7EDC\u7BA1\u7406"}),key:"network"},{label:(0,t.jsx)(D.Z.Link,{children:"\u6587\u4EF6\u7BA1\u7406"}),key:"file",onClick:function(){w("/app/detail/file/".concat(s.id,"?tab=file"))}},{label:(0,t.jsx)(D.Z.Link,{children:"\u8FD0\u884C\u65E5\u5FD7"}),key:"log",onClick:function(){w("/app/detail/log/".concat(s.id,"?tab=log"))}},{label:(0,t.jsx)(D.Z.Link,{children:"\u8FD0\u884C\u72B6\u6001"}),key:"stat",onClick:function(){w("/app/detail/stat/".concat(s.id,"?tab=stat"))}},{label:"",key:"containerName",icon:(0,t.jsx)(A.Z,{}),disabled:!0}],f=(0,C.useState)(J),X=g()(f,2),ee=X[0],q=X[1];(0,C.useEffect)(function(){W.show(),V(K);var o=function(){var n=l()(r()().mark(function I(){var E,z,x;return r()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return E=J,B.prev=1,B.next=4,(0,m.jV)({md5:(z=s.id)!==null&&z!==void 0?z:""});case 4:x=B.sent,E.map(function(Y){return Y.key=="containerName"&&(Y.label=x.data.info.Name),(!x.data.info.State.Running||x.data.info.State.Restarting)&&(Y.key=="file"||Y.key=="stat")&&(Y.disabled=!0),Y}),q(E),B.next=13;break;case 9:return B.prev=9,B.t0=B.catch(1),w("/app/list"),B.abrupt("return");case 13:return B.prev=13,W.destroy(),B.finish(13);case 16:case"end":return B.stop()}},I,null,[[1,9,13,16]])}));return function(){return n.apply(this,arguments)}}();o()},[H,s]);var L=function(n){V(n.key)};return(0,t.jsx)(T.Provider,{value:{reload:function(){Q(H+1)}},children:(0,t.jsxs)(y._z,{header:{extra:[(0,t.jsx)(O.u,{access:"canSeeContainerListManageCreate",children:(0,t.jsx)(u.Link,{to:"/app/create/image",children:(0,t.jsx)(i.ZP,{type:"primary",children:c.Ob.format("container.create")})})},"create")]},children:[(0,t.jsx)(j.Z,{mode:"horizontal",onClick:L,selectedKeys:[_],items:ee}),(0,t.jsx)(u.Outlet,{})]})})}},91629:function(k,b,e){e.r(b),e.d(b,{default:function(){return P}});var M=e(15009),r=e.n(M),R=e(99289),l=e.n(R),h=e(5574),g=e.n(h),O=e(19632),d=e.n(O),m=e(27619),c=e(67294);function A(v){var a=v.reqFunction,N=v.interval,K=v.maxPolling,$=v.pollingStatus,Z=v.inPath,_=(0,c.useRef)(null),V=0,w=function G(){_.current=window.setTimeout(l()(r()().mark(function H(){var Q;return r()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(V++>=K)){f.next=3;break}return S(),f.abrupt("return");case 3:if(f.prev=3,!(Z&&window.location.href.indexOf(Z)==-1)){f.next=7;break}return S(),f.abrupt("return");case 7:return f.next=9,a();case 9:Q=f.sent,G(),f.next=17;break;case 13:f.prev=13,f.t0=f.catch(3),S(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",f.t0);case 17:case"end":return f.stop()}},H,null,[[3,13]])})),N)},S=function(){console.log("end polling"),_.current&&window.clearTimeout(_.current)};return(0,c.useEffect)(function(){return console.log(($?"start":"waiting")+" polling, max "+K),$&&w(),function(){S()}},[N,K,$]),{endPolling:S}}var y=A,u=e(24963),D=e(84410),i=e(5251),j=e(12122),C=e(60433),t=e(38345),T=e(82346),F=e(60940),U=e(50070),p=e(85893),W=new Date().toLocaleTimeString(),s={total:0,memory:[{date:W,usage:0,source:{usage:0,limit:0}}],cpu:[{date:W,usage:0}],network:[{usage:0,type:"rx",date:W,source:{usage:0}},{usage:0,type:"tx",date:W,source:{usage:0}}],io:[{usage:0,type:"read",date:W,source:{usage:0}},{usage:0,type:"write",date:W,source:{usage:0}}]};function P(){var v=function(o,n){switch(n.type){case"update":var I=new Date(n.payload.read).toLocaleTimeString(),E=n.payload.cpu_stats.cpu_usage.total_usage-n.payload.precpu_stats.cpu_usage.total_usage,z=n.payload.cpu_stats.system_cpu_usage-n.payload.precpu_stats.system_cpu_usage,x={total:o.total+1,memory:[],cpu:[].concat(d()(o.cpu),[{date:I,usage:E/z*n.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return n.payload.memory_stats&&n.payload.memory_stats.limit&&n.payload.memory_stats.usage&&(x.memory=[].concat(d()(o.memory),[{date:I,usage:Math.round(n.payload.memory_stats.usage),source:{usage:n.payload.memory_stats.usage,limit:n.payload.memory_stats.limit}}])),n.payload.networks&&(x.network=[].concat(d()(o.network),[{date:I,usage:parseFloat(n.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:n.payload.networks.eth0.rx_bytes}},{date:I,usage:parseFloat(n.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:n.payload.networks.eth0.tx_bytes}}])),n.payload.blkio_stats&&n.payload.blkio_stats.io_service_bytes_recursive&&n.payload.blkio_stats.io_service_bytes_recursive.length>0&&(x.io=[].concat(d()(o.io),[{date:I,usage:parseFloat(n.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:n.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:n.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:I,usage:parseFloat(n.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:n.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:n.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),x}},a=(0,c.useContext)(u.Z),N=a.loading,K=(0,T.useParams)(),$=(0,c.useReducer)(v,s),Z=g()($,2),_=Z[0],V=Z[1],w=(0,c.useState)(0),S=g()(w,2),G=S[0],H=S[1],Q=(0,c.useState)(),J=g()(Q,2),f=J[0],X=J[1],ee=y({reqFunction:function(){var L=l()(r()().mark(function n(){var I,E;return r()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,D.i)({id:(I=K.id)!==null&&I!==void 0?I:""});case 2:E=x.sent,N.destroy(),V({type:"update",payload:E});case 5:case"end":return x.stop()}},n)}));function o(){return L.apply(this,arguments)}return o}(),interval:3e3,maxPolling:999,pollingStatus:G!=0,inPath:"tab=stat"}),q=(0,c.useContext)(U.AppDetailContext);return(0,c.useEffect)(function(){q.reload()},[]),(0,c.useEffect)(function(){var L,o;N.show(),(0,D.i)({id:(L=K.id)!==null&&L!==void 0?L:""}).then(function(n){return H(Math.round(n.memory_stats.limit)),!0}),(0,D.a)({id:(o=K.id)!==null&&o!==void 0?o:""}).then(function(n){var I={columns:[],data:[]};n.data.list.Titles.map(function(E){I.columns.push({title:E,label:E,dataIndex:E})}),n.data.list.Processes.map(function(E,z){I.data.push({UID:E[0],PID:E[1],PPID:E[2],C:E[3],STIME:E[4],TTY:E[5],TIME:E[6],CMD:E[7]})}),X(I)})},[]),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(t.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[_.memory&&_.memory.length>0&&(0,p.jsx)(t.Z,{colSpan:12,title:(0,p.jsx)(j.Z,{}),subTitle:"Memory usage: ".concat((0,i.FI)(_.memory[_.memory.length-1].source.usage)," / ").concat((0,i.FI)(_.memory[_.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,p.jsx)(m.Z,{yField:"usage",xField:"date",data:_.memory,yDomainMaxCallback:function(o){return o*2},yLabelFormatter:function(o){return(0,i.FI)(parseFloat(o))}})}),(0,p.jsx)(t.Z,{colSpan:12,title:(0,p.jsx)(j.Z,{}),subTitle:"Cpu usage: ".concat(_.cpu[_.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,p.jsx)(m.Z,{yField:"usage",xField:"date",data:_.cpu,yDomainMaxCallback:function(o){return o*1.5},yLabelFormatter:function(o){return"".concat(o,"%")}})}),_.io&&_.io.length>0&&(0,p.jsx)(t.Z,{colSpan:12,title:(0,p.jsx)(j.Z,{}),subTitle:"I/O: ".concat((0,i.FI)(_.io[_.io.length-1].source.usage)," / ").concat((0,i.FI)(_.io[_.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,p.jsx)(m.Z,{yField:"usage",xField:"date",colorField:"type",data:_.io,yDomainMaxCallback:function(o){return o*2},yLabelFormatter:function(o){return(0,i.FI)(parseFloat(o))}})}),_.network&&_.network.length>0&&(0,p.jsx)(t.Z,{colSpan:12,title:(0,p.jsx)(j.Z,{}),subTitle:"Network: ".concat((0,i.FI)(_.network[_.network.length-1].source.usage)," / ").concat((0,i.FI)(_.network[_.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,p.jsx)(m.Z,{yField:"usage",xField:"date",colorField:"type",data:_.network,yDomainMaxCallback:function(o){return o*2},yLabelFormatter:function(o){return(0,i.FI)(parseFloat(o))}})})]}),(0,p.jsx)(t.Z,{title:(0,p.jsx)(C.Z,{}),subTitle:"Progress",children:(0,p.jsx)(F.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:f==null?void 0:f.columns,dataSource:f==null?void 0:f.data,pagination:{pageSize:10}})})]})}},13822:function(k,b,e){e.d(b,{IE:function(){return d},IW:function(){return g},KK:function(){return D},LJ:function(){return j},RF:function(){return F},Re:function(){return t},aF:function(){return p},eE:function(){return y},jV:function(){return c}});var M=e(15009),r=e.n(M),R=e(99289),l=e.n(R),h=e(82346);function g(s){return O.apply(this,arguments)}function O(){return O=l()(r()().mark(function s(P){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/status",{method:"POST",data:P}));case 1:case"end":return a.stop()}},s)})),O.apply(this,arguments)}function d(s){return m.apply(this,arguments)}function m(){return m=l()(r()().mark(function s(P){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/get-list",{data:P,method:"POST"}));case 1:case"end":return a.stop()}},s)})),m.apply(this,arguments)}function c(s){return A.apply(this,arguments)}function A(){return A=l()(r()().mark(function s(P){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/get-detail",{data:P,method:"POST"}));case 1:case"end":return a.stop()}},s)})),A.apply(this,arguments)}function y(s){return u.apply(this,arguments)}function u(){return u=l()(r()().mark(function s(P){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/update",{data:P,method:"POST"}));case 1:case"end":return a.stop()}},s)})),u.apply(this,arguments)}function D(){return i.apply(this,arguments)}function i(){return i=l()(r()().mark(function s(){return r()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,h.request)("/api/app/container/prune",{method:"POST"}));case 1:case"end":return v.stop()}},s)})),i.apply(this,arguments)}function j(s){return C.apply(this,arguments)}function C(){return C=l()(r()().mark(function s(P){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/export",{method:"POST",data:P,responseType:"blob"}));case 1:case"end":return a.stop()}},s)})),C.apply(this,arguments)}function t(s){return T.apply(this,arguments)}function T(){return T=l()(r()().mark(function s(P){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/commit",{method:"POST",data:P}));case 1:case"end":return a.stop()}},s)})),T.apply(this,arguments)}function F(s){return U.apply(this,arguments)}function U(){return U=l()(r()().mark(function s(P){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/upgrade",{method:"POST",data:P}));case 1:case"end":return a.stop()}},s)})),U.apply(this,arguments)}function p(s){return W.apply(this,arguments)}function W(){return W=l()(r()().mark(function s(P){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/copy",{method:"POST",data:P}));case 1:case"end":return a.stop()}},s)})),W.apply(this,arguments)}},84410:function(k,b,e){e.d(b,{a:function(){return d},i:function(){return g}});var M=e(15009),r=e.n(M),R=e(99289),l=e.n(R),h=e(82346);function g(c){return O.apply(this,arguments)}function O(){return O=l()(r()().mark(function c(A){return r()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,h.request)("/api/app/container/get-stat-info",{method:"POST",data:A}));case 1:case"end":return u.stop()}},c)})),O.apply(this,arguments)}function d(c){return m.apply(this,arguments)}function m(){return m=l()(r()().mark(function c(A){return r()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,h.request)("/api/app/container/get-process-info",{method:"POST",data:A}));case 1:case"end":return u.stop()}},c)})),m.apply(this,arguments)}}}]);
