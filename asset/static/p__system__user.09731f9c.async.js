"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2958],{80821:function(se,L,e){e.d(L,{Z:function(){return fe}});var W=e(97857),l=e.n(W),A=e(5574),h=e.n(A),J=e(24963),K=e(86738),ee=e(28036),z=e(83062),Y=e(67294),y=e(85893);function fe(s){var ie=(0,Y.useState)(!1),ue=h()(ie,2),re=ue[0],X=ue[1],ne=(0,Y.useContext)(J.Z),H=ne.lang,le=ne.message,Q=function(){X(!0);var c=s.action();c instanceof Promise?c.then(function(q){if(X(!1),q){typeof s.onSuccess=="function"&&s.onSuccess(q);var w="";s.messageSuccess?typeof s.messageSuccess=="function"?w=s.messageSuccess(q):w=s.messageSuccess.indexOf("notification.")==0?H(s.messageSuccess):s.messageSuccess:w=H("notification.finish"),s.asynced?le.info(w):le.success(w)}}).catch(function(q){X(!1),typeof s.onError=="function"&&s.onError(q)}):X(!1)};return s.confirm?(0,y.jsx)(K.Z,l()(l()({style:{width:500},title:s.confirmTitle?s.confirmTitle:H("notification.title.tip"),description:typeof s.confirm=="string"&&s.confirm.indexOf("notification.")==0?H(s.confirm):s.confirm,onConfirm:Q,okText:"Yes",cancelText:"No",onOpenChange:s.confirmOnOpenChange},s.confirmProps),{},{children:(0,y.jsx)(ee.ZP,{block:s.block,disabled:s.disabled,icon:!s.children&&re?void 0:s.icon,loading:re,danger:s.danger,type:s.type,children:s.children})})):(0,y.jsx)(z.Z,{title:s.tips,children:(0,y.jsx)(ee.ZP,{block:s.block,style:s.ghost?{padding:0,height:"auto",width:"auto"}:{},disabled:s.disabled,icon:!s.children&&re?void 0:s.icon,loading:re,onClick:Q,danger:s.danger,type:s.type,children:s.children})})}},3616:function(se,L,e){e.d(L,{Ed:function(){return h},FK:function(){return l},R_:function(){return W},ob:function(){return A}});var W=window.innerWidth<=1024?"90vw":"65vw",l="90vw",A="60vw",h="50vh"},24963:function(se,L,e){var W=e(67294),l=(0,W.createContext)({});L.Z=l},59549:function(se,L,e){e.r(L),e.d(L,{default:function(){return Ve}});var W=e(15009),l=e.n(W),A=e(99289),h=e.n(A),J=e(9783),K=e.n(J),ee=e(19632),z=e.n(ee),Y=e(80821),y=e(68602),fe=e(67255),s=e(36693),ie=e(43425),ue=e(88641),re=e(90078),X=e(41482),ne=e(66309),H=e(42075),le=e(96074),Q=e(25593),oe=e(83062),c=e(67294),q=e(5574),w=e.n(q),pe=e(28036),me=e(184),ce=e(5966),ve=e(64317),je=e(52688),Pe=e(90672),te=e(3616),M=e(83403),ye=e(87662),B=e(36146),r=e(85893),Ce=(0,c.forwardRef)(function(C,V){var $=(0,c.useState)(!1),m=w()($,2),S=m[0],g=m[1],u=(0,c.useRef)(),i=new B.Uo("components.userInvite"),a=new B.Uo("system.user");(0,c.useImperativeHandle)(V,function(){return{edit:function(o){var f;(f=u.current)===null||f===void 0||f.setFieldsValue({username:o.username}),g(!0)},show:function(){var o;(o=u.current)===null||o===void 0||o.resetFields(),g(!0)}}}),c.useEffect(function(){if(S){var d;(d=u.current)===null||d===void 0||d.resetFields()}},[S,u]);var n=function(){var d=h()(l()().mark(function o(){var f,t,b,Z,O,N;return l()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.prev=0,p.next=3,(f=u.current)===null||f===void 0?void 0:f.validateFields();case 3:return t=p.sent,b={username:t.username,userRole:t.userRole||"member",email:t.email,userStatus:t.userStatus||"enable",securityPassword:t.securityPassword||!0},p.next=7,(0,y.mX)(b);case 7:if(Z=p.sent,b.userRole==="manager"&&(0,y.SS)({username:b.username,menuPermissionNames:M.Wy}),b.userStatus==="disable"&&(0,y.az)({username:b.username,status:1}),!b.email){p.next=15;break}return p.next=13,(0,ye.pe)({groupName:"setting",name:"emailServer"});case 13:N=p.sent,(O=N.data)!==null&&O!==void 0&&(O=O.status)!==null&&O!==void 0&&O.includes("register")&&(0,y.sI)({username:b.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(Z.data.token)});case 15:return C.onFinish&&C.onFinish(),p.abrupt("return",!0);case 19:return p.prev=19,p.t0=p.catch(0),p.abrupt("return",!1);case 22:case"end":return p.stop()}},o,null,[[0,19]])}));return function(){return d.apply(this,arguments)}}();return(0,r.jsxs)(me.a,{name:"create",title:i.format("drawerTitle"),open:S,onOpenChange:function(o){if(!o){var f;(f=u.current)===null||f===void 0||f.resetFields()}g(o)},drawerProps:{forceRender:!0,width:te.R_},formRef:u,trigger:(0,r.jsx)(pe.ZP,{type:"primary",children:i.format("drawerTitle")}),onFinish:h()(l()().mark(function d(){return l()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,n();case 2:return f.abrupt("return",f.sent);case 3:case"end":return f.stop()}},d)})),children:[(0,r.jsx)(ce.Z,{label:i.format("formUsername"),name:"username",required:!0,rules:[{required:!0}]}),(0,r.jsx)(ce.Z,{label:i.format("formEmail"),name:"email",placeholder:"",rules:[{type:"email"}]}),(0,r.jsx)(ve.Z,{label:i.format("formUserRole"),name:"userRole",tooltip:i.format("formUserRoleTip"),required:!0,fieldProps:{defaultValue:"member"},options:a.option("listUserRoleOption",["manager","member"])}),(0,r.jsx)(ve.Z,{label:i.format("formUserStatus"),name:"userStatus",fieldProps:{defaultValue:"enable"},required:!0,options:a.option("listStatusOption",["enable","disable"])}),(0,r.jsx)(je.Z,{label:i.format("formSecurityPassword"),name:"securityPassword",fieldProps:{defaultChecked:!0}}),(0,r.jsx)(Pe.Z,{label:i.format("formRemark"),name:"remark",fieldProps:{rows:4}})]})}),be=Ce,Oe=e(38345),we=e(63434),xe=e(71230),Ee=e(15746),Ze=e(84567),De=e(85265),Ue=e(82346),Ae=(0,c.forwardRef)(function(C,V){(0,c.useImperativeHandle)(V,function(){return{show:function(P){return h()(l()().mark(function F(){var E,T,U,ae,Re,G,Se;return l()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return U=P.username,ae=P.uri,(E=b.current)===null||E===void 0||E.resetFields(),g(U),n(ae),k.next=6,(0,y.q4)({username:U});case 6:if(Re=k.sent,G=(T=Re.data)===null||T===void 0||(T=T.permissions)===null||T===void 0?void 0:T[ae],!G){k.next=16;break}return k.next=11,(0,Ue.request)(G.uri,{method:"POST"});case 11:Se=k.sent,p(Se.data.list.filter(function(de){return G.value.includes(de[G.key])}).map(function(de){return{id:de[G.key],name:de[G.showKey]}})),j(G),k.next=17;break;case 16:p([]);case 17:t(!0);case 18:case"end":return k.stop()}},F)}))()}}});var $=(0,c.useState)(""),m=w()($,2),S=m[0],g=m[1],u=(0,c.useState)(""),i=w()(u,2),a=i[0],n=i[1],d=(0,c.useState)(!1),o=w()(d,2),f=o[0],t=o[1],b=(0,c.useRef)(),Z=(0,c.useRef)(),O=(0,c.useState)([]),N=w()(O,2),I=N[0],p=N[1],_=(0,c.useState)(),D=w()(_,2),v=D[0],j=D[1],R=new B.Uo("components.userPermission");return(0,r.jsx)(De.Z,{title:R.format("permissionTitle"),open:f,width:te.R_,destroyOnClose:!0,onClose:function(){var P;(P=b.current)===null||P===void 0||P.resetFields(),t(!1)},children:(0,r.jsx)(X.Z,{actionRef:Z,search:!1,toolBarRender:!1,scroll:{x:"max-content"},columns:[{key:"name",title:R.format("listName"),dataIndex:"name"}],rowKey:"id",dataSource:I,rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},tableAlertOptionRender:function(P){var F=P.selectedRows;return(0,r.jsx)(H.Z,{size:16,wrap:!0,children:(0,r.jsx)(Y.Z,{danger:!0,type:"primary",action:h()(l()().mark(function E(){return l()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.next=2,(0,y.V9)({username:S,permission:{uri:a,key:"-",value:F.map(function(ae){return ae.id}),showKey:"-"}});case 2:return U.abrupt("return",!0);case 3:case"end":return U.stop()}},E)})),onSuccess:function(){return t(!1),!0},confirm:"notification.confirm.title",children:B.FD.format("deleteBatch")})})},pagination:!1})})}),he=Ae,Ie=e(31199),Te=(0,c.forwardRef)(function(C,V){(0,c.useImperativeHandle)(V,function(){return{show:function(t){return h()(l()().mark(function b(){var Z,O;return l()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:O=t.formData,(Z=d.current)===null||Z===void 0||Z.resetFields(),n(O),g(!0);case 4:case"end":return I.stop()}},b)}))()}}});var $=(0,c.useState)(!1),m=w()($,2),S=m[0],g=m[1],u=(0,c.useState)({}),i=w()(u,2),a=i[0],n=i[1],d=(0,c.useRef)(),o=new B.Uo("components.userPermission");return(0,r.jsxs)(me.a,{title:o.format("permissionTitle"),open:S,width:te.R_,formRef:d,onFinish:function(){var f=h()(l()().mark(function t(b){return l()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return C.onChange(b),g(!1),O.abrupt("return",!0);case 3:case"end":return O.stop()}},t)}));return function(t){return f.apply(this,arguments)}}(),initialValues:a,drawerProps:{width:te.R_,destroyOnClose:!0,onClose:function(){var t;(t=d.current)===null||t===void 0||t.resetFields(),g(!1)}},children:[(0,r.jsx)(Ie.Z,{name:"limit",label:o.format("formContainerLimit"),min:0}),(0,r.jsx)(ce.Z,{name:"name",hidden:!0})]})}),Me=Te,$e=e(24963),Fe=e(34646),Le=e(60433),ge=e(25449),We=(0,c.forwardRef)(function(C,V){(0,c.useImperativeHandle)(V,function(){return{edit:function(v){return h()(l()().mark(function j(){var R,x,P;return l()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return(R=i.current)===null||R===void 0||R.setFieldValue("username",v),E.next=3,(0,y.J5)({username:v});case 3:x=E.sent,x.data.resource?(P={},x.data.resource.forEach(function(T){P[T.name]=T}),p(P)):p({}),x.data.menus?(x.data.menus.map(function(T){var U;(U=i.current)===null||U===void 0||U.setFieldValue(["permission",T],!0)}),Z([].concat(z()(x.data.menus||[]),z()(M.Io)))):Z(M.Io),u(!0);case 7:case"end":return E.stop()}},j)}))()}}});var $={canSeeContainerList:M.W6.CONTAINER,canSeeImageRegistry:M.W6.REGISTRY,canSeeComposeList:M.W6.COMPOSE,canSeeSystemAppstore:M.W6.APPSTORE,canSeeSystemEnv:M.W6.DOCKER_ENV},m=(0,c.useState)(!1),S=w()(m,2),g=S[0],u=S[1],i=(0,c.useRef)(),a=(0,c.useContext)($e.Z),n=a.message,d=(0,c.useRef)(),o=(0,c.useRef)(),f=(0,c.useState)([]),t=w()(f,2),b=t[0],Z=t[1],O=(0,c.useState)({}),N=w()(O,2),I=N[0],p=N[1],_=new B.Uo("components.userPermission");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(me.a,{title:_.format("drawerTitle"),open:g,onOpenChange:function(v){var j;!v&&((j=i.current)===null||j===void 0||j.resetFields()),u(v)},drawerProps:{forceRender:!0,width:te.R_},layout:"inline",formRef:i,onValuesChange:function(v,j){var R=Object.keys(v.permission)[0];if(v.permission[R]===!1){for(var x in j.permission)if(x.startsWith(R)){var P;(P=i.current)===null||P===void 0||P.setFieldValue(["permission",x],!1)}}Z(Object.keys(j.permission).filter(function(F){return j.permission[F]}))},onFinish:function(){var D=h()(l()().mark(function v(j){var R;return l()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return R=j.permission&&Object.keys(j.permission).filter(function(F){return j.permission[F]&&!M.Io.includes(F)}),R.push.apply(R,z()(M.Io.filter(function(F){return R.some(function(E){return E.startsWith(F)})}))),P.next=4,(0,y.SS)({username:j.username,menuPermissionNames:R,resources:Object.values(I)});case 4:return n.success(B.FD.format("finish")),P.abrupt("return",!0);case 6:case"end":return P.stop()}},v)}));return function(v){return D.apply(this,arguments)}}(),children:[(0,r.jsx)(he,{ref:d}),(0,r.jsx)(ce.Z,{name:"username",hidden:!0}),M.d0.map(function(D){return(0,r.jsxs)(Oe.Z,{headerBordered:!0,ghost:!0,bodyStyle:{paddingTop:10,paddingBottom:20},title:(0,r.jsx)(Fe.Z,{}),subTitle:_.format(D.group),children:[(0,r.jsx)(we.Z,{name:["permission",D.group],valuePropName:"checked",initialValue:!0,hidden:!0}),(0,r.jsx)(xe.Z,{gutter:[16,16],children:D.permissions.map(function(v){return(0,r.jsx)(Ee.Z,{span:6,children:(0,r.jsxs)(ge.Z,{children:[(0,r.jsx)(ge.Z,{noStyle:!0,name:["permission",v],valuePropName:"checked",children:(0,r.jsx)(Ze.Z,{disabled:!b.includes(v.substring(0,v.search(/[A-Z][^A-Z]*$/))),children:_.format(v)})}),$[v]&&(0,r.jsx)(oe.Z,{title:_.format("dataPermissionButton"),children:(0,r.jsx)(Q.Z.Link,{onClick:function(){var R,x;(R=d.current)===null||R===void 0||R.show({username:((x=i.current)===null||x===void 0?void 0:x.getFieldValue("username"))||"",uri:$[v]||""})},children:(0,r.jsx)(Le.Z,{})})}),["canSeeContainerListManageCreate"].includes(v)&&(0,r.jsx)(oe.Z,{title:_.format("resourcePermssionButton"),children:(0,r.jsx)(Q.Z.Link,{onClick:function(){var R;(R=o.current)===null||R===void 0||R.show({formData:I[v]||{name:v,limit:0}})},children:(0,r.jsx)(ie.Z,{})})})]})},v)})})]},D.group)})]}),(0,r.jsx)(he,{ref:d}),(0,r.jsx)(Me,{onChange:function(v){var j;I[v.name]=v,(0,y.SS)({username:((j=i.current)===null||j===void 0?void 0:j.getFieldValue("username"))||"",menuPermissionNames:b,resources:Object.values(I)})},resourcePermissionsData:I,ref:o})]})}),Ke=We,Be=e(5251);function Ve(){var C=(0,c.useRef)(),V=(0,c.useRef)(),$=(0,c.useRef)(),m=new B.Uo("system.user");return(0,r.jsxs)(re._z,{header:{extra:[(0,r.jsx)(be,{ref:V,onFinish:function(){var g,u;!((g=C.current)===null||g===void 0)&&g.reloadAndRest&&((u=C.current)===null||u===void 0||u.reloadAndRest())}},"invite-user")]},children:[(0,r.jsx)(Ke,{ref:$}),(0,r.jsx)(X.Z,{scroll:{x:"max-content"},rowKey:"username",columns:[{title:m.format("listUsername"),ellipsis:!0,dataIndex:"username"},{title:m.format("listEmail"),ellipsis:!0,dataIndex:"email"},{title:m.format("listUserRole"),ellipsis:!0,width:100,dataIndex:"userRole",valueEnum:Object.assign.apply(Object,[{}].concat(z()(m.option("listUserRoleOption",["manager","member"]).map(function(S){return K()({},S.value,{text:S.label,status:S.value})})))),render:function(g,u){return(0,r.jsx)(ne.Z,{color:m.format("listUserRoleColor."+u.userRole),children:m.format("listUserRoleOption."+u.userRole)})}},{title:m.format("listRegisterAt"),ellipsis:!0,render:function(g,u,i,a){return(0,r.jsx)("div",{children:(0,Be.ZM)(u.registerAt*1e3)},u.username)},search:!1},{title:m.format("listRemark"),ellipsis:!0,dataIndex:"remark",search:!1},{title:m.format("listStatus"),width:100,dataIndex:"status",search:!1,render:function(g,u){return(0,r.jsx)(ne.Z,{color:m.format("listStatusColor."+u.status),children:m.format("listStatusOption."+u.status)})}},{title:B.FD.format("operation"),width:100,search:!1,fixed:"right",render:function(g,u,i){return(0,r.jsxs)(H.Z,{split:(0,r.jsx)(le.Z,{type:"vertical"}),children:[(0,r.jsx)(Q.Z.Link,{copyable:{tooltips:m.format("listManageCopyUrl"),icon:[(0,r.jsx)(s.Z,{})],text:function(){var a=h()(l()().mark(function d(){var o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,y.u1)({username:u.username});case 2:return o=t.sent,t.abrupt("return","".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(o.data.token));case 4:case"end":return t.stop()}},d)}));function n(){return a.apply(this,arguments)}return n}()},style:{color:"inherit"}},"copy-"+i),(0,r.jsx)(oe.Z,{title:m.format("listManageSetting"),children:(0,r.jsx)(Q.Z.Link,{onClick:function(){var n;(n=$.current)===null||n===void 0||n.edit(u.username)},children:(0,r.jsx)(ie.Z,{})})}),(0,r.jsx)(Y.Z,{ghost:!0,type:"link",tips:m.format("listManageSendEmail"),icon:(0,r.jsx)(ue.Z,{}),action:h()(l()().mark(function a(){var n;return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,y.u1)({username:u.username});case 2:return n=o.sent,o.abrupt("return",(0,y.sI)({username:u.username,uri:"".concat(window.location.origin,"/dpanel/ui/user/register?token=").concat(n.data.token)}));case 4:case"end":return o.stop()}},a)}))})]})}}],request:function(){var S=h()(l()().mark(function g(u){var i;return l()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,y.lE)();case 2:return i=n.sent,n.abrupt("return",{data:i.data.list,success:!0,total:i.data.list.length});case 4:case"end":return n.stop()}},g)}));return function(g){return S.apply(this,arguments)}}(),rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},actionRef:C,tableAlertOptionRender:function(g){var u=g.selectedRowKeys;return(0,r.jsxs)(H.Z,{size:16,children:[(0,r.jsx)(Y.Z,{action:h()(l()().mark(function i(){var a,n,d,o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=0,n=u;case 1:if(!(a<n.length)){t.next=9;break}return d=n[a],t.next=5,(0,y.az)({username:d,status:2});case 5:o=t.sent;case 6:a++,t.next=1;break;case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},i)})),onSuccess:function(){var a,n;return!((a=C.current)===null||a===void 0)&&a.reloadAndRest&&((n=C.current)===null||n===void 0||n.reloadAndRest()),!0},onError:function(){var a,n;return!((a=C.current)===null||a===void 0)&&a.reset&&((n=C.current)===null||n===void 0||n.reset()),!0},children:m.format("listManageEnable")},"batchEnable"),(0,r.jsx)(Y.Z,{danger:!0,action:h()(l()().mark(function i(){var a,n,d,o;return l()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=0,n=u;case 1:if(!(a<n.length)){t.next=9;break}return d=n[a],t.next=5,(0,y.az)({username:d,status:1});case 5:o=t.sent;case 6:a++,t.next=1;break;case 9:return t.abrupt("return",!0);case 10:case"end":return t.stop()}},i)})),onSuccess:function(){var a,n;return!((a=C.current)===null||a===void 0)&&a.reloadAndRest&&((n=C.current)===null||n===void 0||n.reloadAndRest()),!0},onError:function(){var a,n;return!((a=C.current)===null||a===void 0)&&a.reset&&((n=C.current)===null||n===void 0||n.reset()),!0},children:m.format("listManageDisable")},"batchDisable")]})},pagination:(0,fe.O)()})]})}},67255:function(se,L,e){e.d(L,{O:function(){return W},j:function(){return l}});function W(A){var h=localStorage.getItem("dpanel-pagesize");return h=="all"?!1:{defaultCurrent:A==null?void 0:A.page,showSizeChanger:!0,defaultPageSize:parseInt(h!=null?h:"20"),onChange:function(K,ee){localStorage.setItem("dpanel-page-"+location.pathname.split("/").slice(-2).join("-"),"".concat(K))}}}function l(A){var h="dpanel-table-column-".concat(A),J={};if(localStorage.getItem(h)){var K;J=JSON.parse((K=localStorage.getItem(h))!==null&&K!==void 0?K:"{}")}return{defaultValue:J,onChange:function(z){localStorage.setItem("dpanel-table-column-".concat(A),JSON.stringify(z))}}}}}]);
